{"version":3,"file":"core.service.js","sourceRoot":"","sources":["../../src/modules/core.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Widget } from '@fui/core';\nimport jss from 'jss';\nimport jssGlobal from 'jss-plugin-global';\nimport jssNested from 'jss-plugin-nested';\nimport { ICON_FONT_MAP } from './core.constants';\nimport type { Background, FrListener } from './core.types';\n\nexport const { shortcut, model, store, Model, provider } = BI.Decorators;\n\n/**\n * 转换背景配置为stylesheet\n * @param background 背景配置\n */\nexport function generateBackgroundStyle(background: Background): {\n    [key: string]: any;\n} | undefined {\n    if (BI.isNull(background)) {\n        return {};\n    }\n\n    if ('background' in background) {\n        return {\n            background: background.background,\n        };\n    }\n\n    let style: {\n        [key: string]: any,\n    } = {};\n\n\n    switch (background.backgroundType) {\n        case 'ColorBackground':\n            style['background-color'] = transformColor(background.color);\n            break;\n        case 'TextureBackground':\n        case 'ImageBackground':\n        case 'PatternBackground':\n            style = {\n                'background-image': `url(${background.imgUrl})`,\n                ...getImgStyle(background.layout),\n            };\n            break;\n        case 'GradientBackground':\n            style.background = transformGradientBackground({\n                direction: background.direction,\n                startColor: background.startColor,\n                begin: background.begin || 0,\n                endColor: background.endColor,\n                finish: background.finish || 0,\n            });\n            break;\n        default:\n            return;\n    }\n\n    return style;\n}\n\nfunction transformGradientBackground(background: {\n    direction?: number;\n    begin: number;\n    startColor?: number;\n    finish: number;\n    endColor?: number;\n}) {\n    const startColor = transformColor(background.startColor);\n    const endColor = transformColor(background.endColor);\n    const total = 160;\n    const begin = transformNumer2Percentage(background.begin / total);\n    const finish = transformNumer2Percentage((background.finish || total) / total);\n\n    return `linear-gradient(${background.direction === 1 ? 180 : 90}deg, ${startColor}, ${startColor} ${begin}, ${endColor} ${finish}, ${endColor})`;\n}\n\n/**\n * 根据layout转换为样式sheet\n * @param type layou类型\n */\nfunction getImgStyle(type?: number): {\n    [key: string]: any\n} {\n    switch (type) {\n        // 平铺\n        case 0:\n            return {\n                'background-repeat': 'repeat',\n            };\n        // 拉伸\n        case 2:\n            return {\n                'background-repeat': 'no-repeat',\n                'background-position': 'center',\n                'background-size': '100% 100%',\n            };\n        case 4:\n            return {\n                'background-size': 'contain',\n                'background-repeat': 'no-repeat',\n                'background-position': 'center',\n            };\n        // 默认\n        case 1:\n        case 3:\n        default:\n            return {\n                'background-repeat': 'no-repeat',\n                'background-position': 'center',\n            };\n    }\n}\n\nfunction transformNumer2Percentage(v: number):string {\n    return `${v * 100}%`;\n}\n\nexport function warnWhenDeparture(name: string) {\n    console.warn(BI.i18nText('Fine-Report_Js_Warning', name));\n}\n\n/**\n * departure触发装饰器\n */\nexport function departure() {\n    return function (_target: any, propertyKey: string, descriptor: PropertyDescriptor) {\n        const render = descriptor.value;\n        descriptor.value = function(this: {fireEvent: (name: FrListener['eventName']) => void}, ...args: any[]) {\n            warnWhenDeparture(propertyKey);\n            const result = render.apply(this, args);\n\n            return result;\n        };\n        \n        return descriptor;\n    };\n}\n\n/**\n * basic button包装器\n */\n@shortcut()\nclass BasicButtonWrapper extends BI.BasicButton {\n    public static xtype = 'report.core.basic_button_wrapper';\n\n    public props: {\n        render(): any;\n        doClick(): void;\n        value: '';\n    }\n\n    public render() {\n        return this.options.render();\n    }\n\n    public doClick() {\n        this.options.doClick();\n    }\n}\n\n/**\n * 给控件render外包装basicButton\n */\nexport function click() {\n    return function (_target: any, _propertyKey: string, descriptor: PropertyDescriptor) {\n        const render = descriptor.value;\n\n        descriptor.value = function(this:any, ...args: any[]) {\n            return {\n                type: BasicButtonWrapper.xtype,\n                cls: 'cursor-default',\n                render: () => render.apply(this, args),\n                doClick: () => {\n                    this.fireEvent('click');\n                },\n            };\n        };\n\n        return descriptor;\n    };\n}\n\n/**\n * resize方法的装饰方法\n * 如果宽高没有发生变化则不触发resize\n */\nexport function exResize() {\n    return function (_target: any, _propertyKey: string, descriptor: PropertyDescriptor) {\n        const render = descriptor.value;\n\n        descriptor.value = function(this: Widget & {\n            options: {\n                width: number;\n                height: number\n            }\n        }, width: number, height: number) {\n            if (this.options.width !== width || this.options.height !== height) {\n                this.options.width = width;\n                this.options.height = height;\n                \n                return render.apply(this, [width, height]);\n            }\n        };\n\n        return descriptor;\n    };\n}\n\n/**\n * 将数字类color转换为十六进制颜色\n * @param color 颜色\n */\nexport function transformColor(color?: number | string): string {\n    if (BI.isString(color)) {\n        return color;\n    }\n\n    if (!color) {\n        return '#000';\n    }\n    const tem = (~color).toString(16);\n    const OldColorValue = parseInt(`0x${tem.replace(/#/g, '')}`, 16);\n    const str = `000000${(0xffffff - OldColorValue).toString(16)}`;\n\n    return `#${str.substring(str.length - 6, str.length)}`;\n}\n\nexport function getIconCls(iconInfo: {\n    iconName: string;\n    iconPosition: string;\n    toolbarImage: string;\n}) {\n    return ICON_FONT_MAP.get(iconInfo.iconName) || getIconImageCls(iconInfo);\n}\n\nfunction getIconImageCls(iconInfo: {\n    iconName: string;\n    iconPosition: string;\n    toolbarImage: string;\n}) {\n    const cls = `icon-${BI.UUID()}`;\n    const { iconPosition, toolbarImage } = iconInfo;\n\n    jss.use(jssGlobal(), jssNested());\n\n    jss.createStyleSheet({\n        '@global': {\n            [`.${cls} .b-font`]: {\n                'background-image': `url(${toolbarImage})`,\n                'background-repeat': 'no-repeat',\n                'background-position': iconPosition,\n                height: '16px',\n                width: '16px',\n            },\n            [`.base-disabled .${cls} .b-font`]: {\n                opacity: '.5',\n            },\n        },\n    }).attach();\n\n    return cls;\n}\n\n/**\n * 找到最上层符合条件的父亲dom\n * @param filter 需要包含哪些条件\n * @returns boolean\n */\nexport function findTargetParent(filter: (parent: $Window) => boolean = () => true): $Window {\n    let parent = window as unknown as $Window;\n\n    // 跨域获取不到parent时，catch error\n    try {\n        let fullScreenParent: $Window | null = null;\n        // REPORT-68408 FVS页面不是fineUI写的，但有Report全局变量，找parent还要加上有无BI的逻辑\n        while (parent && parent.parent !== parent) {\n            const tmp = parent.parent as $Window;\n\n            if (!tmp) break;\n            \n            if (!filter(tmp)) break;\n\n            fullScreenParent = parent;\n            parent = parent.parent as unknown as $Window;\n        }\n        // 平台首页弹出parent=平台;全屏情况弹出fullScreenParent=模板，parent=平台\n        if (BI.FullScreen.isFullScreen(parent.document) && fullScreenParent && fullScreenParent.document) {\n            parent = fullScreenParent;\n        }\n    } catch (e) {\n        // catch error\n    }\n\n    return parent;\n}\n\n/**\n * 判断是否是全屏状态\n */\nexport function isFullScreen() {\n    const wicket = findTargetParent();\n\n    // IE 和 firefox 可以用此方式判断，chrome 和 safari 在未缩放的情况下也能获得正确结果\n    if (wicket.innerHeight === wicket.screen.height || BI.FullScreen.isFullScreen(wicket.document)) {\n        return true;\n    }\n\n    // 缩放的情况下需要转换一下再比较，这里只能获得近似值\n    const browserZoomLevel = wicket.outerWidth / wicket.innerWidth;\n    if (browserZoomLevel < 0.98 || browserZoomLevel > 1.02) {\n        const windowHeightBeforeZoom = wicket.innerHeight * browserZoomLevel;\n\n        return Math.abs(wicket.screen.height - windowHeightBeforeZoom) < 30;\n    }\n\n    return false;\n}\n\n/**\n * 转换HTML部分标签的方法\n */\nexport function htmlDecode(v?: string): string {\n    if (BI.isNull(v)) return '';\n\n    return v.replace(/<br\\/>/g, '\\n')\n        .replace(/&quot;/g, '\"')\n        .replace(/&amp;/g, '&')\n        .replace(/&lt;/g, '<')\n        .replace(/&gt;/g, '>')\n        .replace(/&nbsp;/g, ' ');\n}\n"]}