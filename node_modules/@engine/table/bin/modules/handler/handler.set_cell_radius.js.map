{"version":3,"file":"handler.set_cell_radius.js","sourceRoot":"","sources":["../../../src/modules/handler/handler.set_cell_radius.ts"],"names":[],"mappings":"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","sourcesContent":["import { PageResult, TableRadiusRangeArgs } from '../table.types';\nimport { AbstractCellHandler } from './handler.abstract';\n\nenum DirectionRadius {\n    TL = 'tlRadius',\n    TR = 'trRadius',\n    BR = 'brRadius',\n    BL = 'blRadius',\n}\n\n/**\n * 设置单元格弧度\n */\nexport class CellSetRadiusHandler extends AbstractCellHandler {\n    public eventNames = ['CELL_SET_RADIUS'];\n\n    public name = 'CELL_SET_RADIUS';\n\n    public merger = 'uniqe';\n\n    public action({ radius, range = {}, single }: TableCellSetRadiusHandler) {\n        const pageResult = this.tableData;\n\n        const { row = [], column = [], cell = [] } = range;\n        let [rowStart = 1, rowEnd = Number.MAX_VALUE] = row;\n        let [colStart = 1, colEnd = Number.MAX_VALUE] = column;\n\n        if (BI.size(cell)) {\n            rowStart = rowEnd = cell[0] || 1;\n            colStart = colEnd = cell[1] || 1;\n        }\n\n        // 设置范围边缘弧度还是设置范围内所有单元格\n        if (!single) {\n            const rowCount = BI.size(pageResult);\n            const columnCount = pageResult.reduce((max, rowCells) => Math.max(max, BI.size(rowCells)), 0);\n\n            const maxRow = Math.min(rowEnd - 1, rowCount - 1),\n                maxColumn = Math.min(colEnd - 1, columnCount - 1),\n                minRow = Math.max(rowStart - 1, 0),\n                minColumn = Math.max(colStart - 1, 0);\n\n            this.setCellRadius(pageResult[minRow][minColumn], radius, DirectionRadius.TL);\n            this.setCellRadius(pageResult[minRow][maxColumn], radius, DirectionRadius.TR);\n            this.setCellRadius(pageResult[maxRow][minColumn], radius, DirectionRadius.BL);\n            this.setCellRadius(pageResult[maxRow][maxColumn], radius, DirectionRadius.BR);\n        } else {\n            pageResult.forEach((rowCells, rowIndex) => {\n                if (!(rowIndex >= rowStart - 1 && rowIndex < rowEnd)) {\n                    return;\n                }\n                rowCells.forEach((cell, columnIndex) => {\n                    if (!(columnIndex >= colStart - 1 && columnIndex < colEnd)) {\n                        return;\n                    }\n                    this.setCellRadius(cell, radius);\n                });\n            });\n        }\n\n        this.externalContext.populate(pageResult);\n    }\n\n    /**\n    * 设置单元格圆角\n    * @param cell 单元格\n    * @param radius 圆角\n    * @param direction 位置\n    */\n    private setCellRadius(cell: PageResult, radius: number, direction?: string) {\n        const { sourceCellPosition } = cell, realCell = BI.isNull(sourceCellPosition)\n            ? cell\n            : this.tableData[sourceCellPosition.y][sourceCellPosition.x];\n\n        const cellRadiusConfig = realCell.cellstyle?.cellBackground?.background.radiusConfig || {};\n\n        const radiusConfig = {\n            radius,\n            tlRadius: !direction,\n            trRadius: !direction,\n            blRadius: !direction,\n            brRadius: !direction,\n            ...cellRadiusConfig,\n        };\n\n        BI.deepExtend(realCell, {\n            cellstyle: {\n                cellBackground: {\n                    background: {\n                        radiusConfig: direction\n                            ? {\n                                ...radiusConfig,\n                                [direction]: true,\n                            }\n                            : radiusConfig,\n                    },\n                },\n            },\n        });\n    }\n}\n\nexport type TableCellSetRadiusHandler = Parameters<AbstractCellHandler['action']>[0] & {\n    radius: number,\n    range?: TableRadiusRangeArgs,\n    single?: boolean\n}\n"]}