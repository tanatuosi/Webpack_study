{"version":3,"file":"cell.filter.js","sourceRoot":"","sources":["../../../src/modules/cell/cell.filter.ts"],"names":[],"mappings":"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","sourcesContent":["import { Combo, IconChangeButton } from '@fui/core';\nimport jss from 'jss';\nimport jssGlobal from 'jss-plugin-global';\nimport jssNested from 'jss-plugin-nested';\nimport { getCompleteImageUrl } from '../table.service';\nimport { AbstractTableCell, CellHtml } from './cell.abstract';\n\nenum type2DescriptionEnum {\n    'Fine-Engine_Sort_No_Order',\n    'Fine-Engine_Sort_Ascending_Order',\n    'Fine-Engine_Sort_Descending_Order'\n}\n\n/**\n * 创建排序表头\n */\nexport function transformCell2Filter(this: AbstractTableCell): CellHtml | undefined {\n    if (!this.options.sortHeader) return;\n\n    const { sortItems, headerArea, sortArea, index, direction, currentSortItem } = this.options.sortHeader;\n\n    return {\n        id: `${this.id}_filter`,\n        init: e => {\n            const iconSize = 16;\n\n            let trigger: IconChangeButton;\n\n            const leftIconCls = 'triangle-left-font', downIconCls = 'triangle-down-font';\n\n            const iconClsMap: { [key: string]: string } = {};\n\n            jss.use(jssGlobal(), jssNested());\n\n            let currentIconCls: string | undefined = undefined;\n\n            const items = sortItems.map(({ iconId, type }) => {\n                const { classes } = jss.createStyleSheet({\n                    icon: {\n                        background: `url(${getCompleteImageUrl(iconId, true)}) no-repeat center center`,\n                        'background-size': 'contain',\n                    },\n                }).attach();\n\n                iconClsMap[iconId] = classes.icon;\n\n                const description = BI.i18nText(type2DescriptionEnum[type]);\n\n                return {\n                    type: BI.DownListGroupItem.xtype,\n                    cls: 'bi-list-item-active',\n                    height: 24,\n                    iconCls1: classes.icon,\n                    iconCls2: '',\n                    value: iconId,\n                    text: description,\n                    logic: {\n                        dynamic: true,\n                    },\n                    seleted: currentSortItem === description,\n                    listeners: [{\n                        eventName: BI.DownListGroupItem.EVENT_CHANGE,\n                        action: () => {\n                            currentIconCls = classes.icon;\n\n                            this.fireEvent('CELL_FILTER_CLICK', {\n                                e: {} as any,\n                                x: 0,\n                                y: 0,\n                                cell: {} as any,\n                                id: this.id,\n                                headerArea,\n                                sortArea,\n                                sortRule: type,\n                                index,\n                                direction,\n                            } as FilterTableCellEventArgs);\n                        },\n                    }],\n                };\n            });\n\n            const currentIcon = currentSortItem ? sortItems.find(item => item.description === currentSortItem)?.iconId : undefined;\n\n            currentIconCls = currentIcon ? iconClsMap[currentIcon] : undefined;\n\n            let combo: Combo | undefined;\n\n            BI.createWidget({\n                element: e.el,\n                type: BI.AbsoluteLayout.xtype,\n                items: [{\n                    el: {\n                        type: BI.Combo.xtype,\n                        ref: (ref: Combo) => {\n                            combo = ref;\n                        },\n                        adjustLength: 2,\n                        hideWhenAnotherComboOpen: true,\n                        el: {\n                            type: BI.IconChangeButton.xtype,\n                            iconCls: currentIconCls || leftIconCls,\n                            cls: 'icon-size-16',\n                            width: iconSize,\n                            height: iconSize,\n                            ref: (_ref: IconChangeButton) => {\n                                trigger = _ref;\n                            },\n                        },\n                        popup: {\n                            minWidth: 80,\n                            minHeight: 25,\n                            maxHeight: 500,\n                            el: {\n                                type: BI.ButtonGroup.xtype,\n                                items,\n                                layouts: [{\n                                    type: BI.VerticalLayout.xtype,\n                                }],\n                            },\n                        },\n                        listeners: [\n                            {\n                                eventName: BI.Combo.EVENT_BEFORE_POPUPVIEW,\n                                action: () => {\n                                    trigger.setIcon(currentIconCls || downIconCls);\n                                },\n                            },\n                            {\n                                eventName: BI.Combo.EVENT_BEFORE_HIDEVIEW,\n                                action: () => {\n                                    trigger.setIcon(currentIconCls || leftIconCls);\n                                },\n                            },\n                        ],\n                    },\n                    bottom: 1,\n                    right: 0,\n                    width: iconSize,\n                    height: iconSize,\n                }],\n            });\n\n            combo?.element.mousedown((e: MouseEvent) => {\n                e.stopPropagation();\n            });\n\n            combo?.element.mouseup((e: MouseEvent) => {\n                e.stopPropagation();\n            });\n        },\n        value: '',\n    };\n}\n\nexport type FilterTableCellEventArgs = Parameters<AbstractTableCell['fireEvent']>[1] & {\n    headerArea: string;\n    sortArea: string;\n    sortRule: number;\n    index: number;\n    direction: number;\n}\n"]}