{"version":3,"file":"multiselectsearchpopup.js","sourceRoot":"","sources":["../../../../src/modules/tag_combo_checkbox/multiselectcombo/multiselectsearchpopup.ts"],"names":[],"mappings":"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","sourcesContent":["import { shortcut } from '@engine/core';\nimport { ParameterMultiSelectPopup } from './multiselectpopup';\n\n@shortcut()\nexport class ParameterMultiSelectSearchPopup extends ParameterMultiSelectPopup {\n    public static xtype = 'report-multi-select-search-popup';\n\n    public props = {\n        itemsCreator: BI.emptyFn as Function,\n        keywordGetter: () => undefined as undefined | string,\n        valueGetter: () => [] as {text: string; value: string}[],\n        unmatchedValueGetter: () => [] as {text: string; value: string}[],\n        itemHeightGetter: () => 24,\n        minWidth: 135,\n        maxHeight: 400,\n        height: undefined,\n        value: [] as {text: string;value: string;}[],\n        customData: true,\n        repopulateGetter: () => false,\n    }\n\n    protected transformItems(items: {text: string; value: string, [key: string]: any}[]) {\n        const { valueGetter, unmatchedValueGetter, keywordGetter, customData } = this.options;\n\n        const keyword = keywordGetter() || '';\n\n        const unmatchedValues = unmatchedValueGetter().slice(0) as typeof items;\n\n        const selectedValues = valueGetter();\n\n        items.forEach(item => {\n            const index = selectedValues.findIndex(value => value.text === item.text && value.value === item.value);\n\n            item.selected = index !== -1;\n\n            if (item.selected) {\n                selectedValues.splice(index, 1);\n            }\n\n            const unmatchedValueIndex = unmatchedValues.findIndex(value => value.text === item.text && value.value === item.value);\n\n            if (unmatchedValueIndex !== -1) {\n                unmatchedValues.splice(unmatchedValueIndex, 1);\n            }\n        });\n\n        // 匹配下自定义项的选中\n        unmatchedValues.forEach(item => {\n            const index = selectedValues.findIndex(value => value.text === item.text && value.value === item.value);\n\n            item.selected = index !== -1;\n\n            if (item.selected) {\n                selectedValues.splice(index, 1);\n            }\n        });\n\n        // 剩下的值如果能匹配的肯定不是在数据字典中的，也就是text和item相同的项\n        const { match, find } = BI.Func.getSearchResult(unmatchedValues, keyword, 'value') as { match: typeof items, find: typeof items };\n\n        const allItems = find.concat(items, match);\n\n        if (BI.size(allItems) === 0 && customData) {\n            this.addTextBtn.setText(BI.i18nText('BI-Basic_Click_To_Add_Text', keywordGetter()));\n\n            this.addTextBtn.visible();\n        } else {\n            this.addTextBtn.invisible();\n        }\n\n        return match.concat(items, find);\n    }\n}\n"]}