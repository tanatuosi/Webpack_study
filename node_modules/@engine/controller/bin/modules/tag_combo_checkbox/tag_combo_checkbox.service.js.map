{"version":3,"file":"tag_combo_checkbox.service.js","sourceRoot":"","sources":["../../../src/modules/tag_combo_checkbox/tag_combo_checkbox.service.ts"],"names":[],"mappings":"AAAA,OAAO,GAAG,MAAM,KAAK,CAAC;AACtB,OAAO,SAAS,MAAM,mBAAmB,CAAC;AAC1C,OAAO,SAAS,MAAM,mBAAmB,CAAC;AAE1C,OAAO,EAAE,gBAAgB,EAAE,yBAAyB,EAAE,MAAM,uBAAuB,CAAC;AACpF,OAAO,EAAE,6BAA6B,EAAE,MAAM,2BAA2B,CAAC;AAE1E,MAAM,CAAC,MAAM,aAAa,GAAG,EAAE,CAAC;AAChC,MAAM,CAAC,MAAM,cAAc,GAAG,EAAE,CAAC;AAEjC;;;;GAIG;AACH,MAAM,UAAU,kBAAkB,CAAC,KAA2C,EAAE,UAAkB,GAAG,EAAE,WAAW,GAAG,EAAE,EAAE,SAAS,GAAG,EAAE;IACnI,IAAI,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;QACnB,OAAO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;KACjC;IAED,OAAO,yBAAyB,CAAC,KAAK,EAAE,OAAO,EAAE,WAAW,EAAE,SAAS,CAAC,CAAC;AAC7E,CAAC;AAED;;;;GAIG;AACH,MAAM,UAAU,qBAAqB,CACjC,OAAiB,EAAE,EACnB,kBAAuC,EAAE,EACzC,UAAkF;IAElF,MAAM,cAAc,GAAG,eAAe,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,CAAC,CAAC;IAEhE,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC;SAClB,MAAM,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,KAAK,EAAE,CAAC,CAAC;SACvE,GAAG,CAAC,WAAW,CAAC,EAAE;QACf,uCACO,CAAC,UAAU;YACV,CAAC,CAAC,EAAE;YACJ,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,UAAU,CAAC;gBACvB,CAAC,CAAC,UAAU,CAAC,WAAW,CAAC;gBACzB,CAAC,CAAC,UAAU,KACpB,IAAI,EAAE,GAAG,WAAW,CAAC,IAAI,EAAE,EAC3B,KAAK,EAAE,GAAG,WAAW,CAAC,KAAK,EAAE,EAC7B,KAAK,EAAE,GAAG,WAAW,CAAC,IAAI,EAAE,IAC9B;IACN,CAAC,CAAC,CAAC;AACX,CAAC;AAED,MAAM,UAAU,gCAAgC,CAC5C,CAAyE,EACzE,gBAAiD,EACjD,SAAiB,EACjB,WAAoB,EACpB,UAAmB,EACnB,WAAmB,EACnB,SAAiB;IAEjB,MAAM,MAAM,GAA+C,mCAAmC,CAAC,CAAC,EAAE,SAAS,EAAE,WAAW,EAAE,WAAW,EAAE,SAAS,CAAC,CAAC;IAElJ,MAAM,eAAe,GAAG,gBAAgB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAElD,eAAe;IACf,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE;QAC5B,MAAM,oBAAoB,GAAG,eAAe,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,KAAK,KAAK,CAAC,CAAC;QAErF,IAAI,oBAAoB,KAAK,CAAC,CAAC,EAAE;YAC7B,OAAO;SACV;QAED,MAAM,CAAC,KAAK,CAAC,GAAG,eAAe,CAAC,oBAAoB,CAAC,CAAC;QAEtD,eAAe,CAAC,MAAM,CAAC,oBAAoB,EAAE,CAAC,CAAC,CAAC;IACpD,CAAC,CAAC,CAAC;IAEH,eAAe;IACf,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE;QAC5B,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;YACrB,OAAO;SACV;QAED,MAAM,oBAAoB,GAAG,eAAe,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,KAAK,KAAK,CAAC,CAAC;QAEpF,IAAI,oBAAoB,KAAK,CAAC,CAAC,EAAE;YAC7B,0BAA0B;YAC1B,UAAU,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;YAEvD,OAAO;SACV;QAED,MAAM,CAAC,KAAK,CAAC,GAAG,eAAe,CAAC,oBAAoB,CAAC,CAAC;QAEtD,eAAe,CAAC,MAAM,CAAC,oBAAoB,EAAE,CAAC,CAAC,CAAC;IACpD,CAAC,CAAC,CAAC;IAEH,OAAO,MAAM;SACR,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAoC,CAAC;AACjF,CAAC;AAED;;;;;GAKG;AACH,MAAM,UAAU,mCAAmC,CAC/C,CAAyE,EACzE,SAAiB,EACjB,WAAoB,EACpB,WAAmB,EACnB,SAAiB;IAEjB;;;;OAIG;IACH,IAAI,CAAC,CAAC,EAAE;QACJ,OAAO,EAAE,CAAC;KACb;IAED,IAAI,EAAE,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,mBAAmB,IAAI,CAAC,EAAE;QAC5C,OAAO,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,iBAAiB,CAAC,EAAE,UAAU,CAAC,CAAC,CAAC;KAClE;IAED,OAAO,kBAAkB,CAAC,CAAC,EAAE,gBAAgB,CAAC,SAAS,EAAE,WAAW,CAAC,EAAE,WAAW,EAAE,SAAS,CAAC,CAAC;AACnG,CAAC;AAED,MAAM,UAAU,wBAAwB,CAAC,EAAE,OAAO,EAAE,UAAU,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,eAAe,CAAC,EAAE,YAAY,EAM7G;IACG,GAAG,CAAC,GAAG,CAAC,SAAS,EAAE,EAAE,SAAS,EAAE,CAAC,CAAC;IAElC,MAAM,GAAG,GAAG,GAAG,6BAA6B,CAAC,QAAQ,IAAI,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC;IAErE,MAAM,QAAQ,GAAG,IAAI,GAAG,EAAE,CAAC;IAE3B,GAAG,CAAC,gBAAgB,CAAC;QACjB,SAAS,EAAE;YACP,CAAC,GAAG,QAAQ,EAAE,CAAC,EAAE;gBACb,OAAO;gBACP,UAAU;aACb;YACD,CAAC,GAAG,QAAQ,qBAAqB,CAAC,EAAE;gBAChC,UAAU;gBACV,KAAK;aACR;YACD,CAAC,GAAG,QAAQ,YAAY,CAAC,EAAE;gBACvB,KAAK;aACR;YACD,CAAC,GAAG,QAAQ,kBAAkB,CAAC,EAAE;gBAC7B,KAAK;aACR;YACD,CAAC,GAAG,QAAQ,aAAa,CAAC,EAAE;gBACxB,MAAM;gBACN,cAAc,EAAE,YAAY;aAC/B;SACJ;KACJ,CAAC,CAAC,MAAM,EAAE,CAAC;IAEZ,OAAO,GAAG,CAAC;AACf,CAAC;AAED,MAAM,UAAU,6BAA6B,CAAC,EAAE,QAAQ,EAAE,UAAU,EAGnE;IACG,GAAG,CAAC,GAAG,CAAC,SAAS,EAAE,EAAE,SAAS,EAAE,CAAC,CAAC;IAElC,MAAM,GAAG,GAAG,GAAG,6BAA6B,CAAC,QAAQ,IAAI,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC;IAErE,MAAM,QAAQ,GAAG,IAAI,GAAG,EAAE,CAAC;IAE3B,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAE,CAAC,EAAE,aAAa,CAAC,CAAC;IAEjE,GAAG,CAAC,gBAAgB,CAAC;QACjB,SAAS,EAAE;YACP,CAAC,GAAG,QAAQ,0BAA0B,CAAC,EAAE;gBACrC,WAAW,EAAE,GAAG,QAAQ,aAAa;aACxC;YACD,CAAC,GAAG,QAAQ,6CAA6C,CAAC,EAAE;gBACxD,WAAW,EAAE,GAAG,QAAQ,aAAa;aACxC;YACD,CAAC,GAAG,QAAQ,oBAAoB,CAAC,EAAE;gBAC/B,KAAK,EAAE,GAAG,QAAQ,eAAe;gBACjC,MAAM,EAAE,GAAG,QAAQ,eAAe;aACrC;YACD,CAAC,GAAG,QAAQ,0BAA0B,CAAC,EAAE;gBACrC,GAAG,EAAE,GAAG,QAAQ,GAAG,cAAc,GAAG,CAAC,eAAe;gBACpD,IAAI,EAAE,GAAG,QAAQ,GAAG,cAAc,GAAG,CAAC,eAAe;gBACrD,KAAK,EAAE,GAAG,QAAQ,GAAG,cAAc,GAAG,CAAC,eAAe;gBACtD,MAAM,EAAE,GAAG,QAAQ,GAAG,cAAc,GAAG,CAAC,eAAe;aAC1D;YACD,CAAC,GAAG,QAAQ,iCAAiC,CAAC,EAAE;gBAC5C,KAAK,EAAE,GAAG,QAAQ,eAAe;gBACjC,MAAM,EAAE,GAAG,QAAQ,eAAe;aACrC;YACD,CAAC,GAAG,QAAQ,uCAAuC,CAAC,EAAE;gBAClD,GAAG,EAAE,GAAG,QAAQ,GAAG,cAAc,GAAG,CAAC,eAAe;gBACpD,IAAI,EAAE,GAAG,QAAQ,GAAG,cAAc,GAAG,CAAC,eAAe;gBACrD,KAAK,EAAE,GAAG,QAAQ,GAAG,cAAc,GAAG,CAAC,eAAe;gBACtD,MAAM,EAAE,GAAG,QAAQ,GAAG,cAAc,GAAG,CAAC,eAAe;aAC1D;YACD,CAAC,GAAG,QAAQ,yBAAyB,CAAC,EAAE;gBACpC,WAAW,EAAE,GAAG,QAAQ,aAAa;gBACrC,MAAM,EAAE,GAAG,UAAU,aAAa;gBAClC,aAAa,EAAE,GAAG,UAAU,aAAa;aAC5C;SACJ;KACJ,CAAC,CAAC,MAAM,EAAE,CAAC;IAEZ,OAAO,GAAG,CAAC;AACf,CAAC","sourcesContent":["import jss from 'jss';\nimport jssGlobal from 'jss-plugin-global';\nimport jssNested from 'jss-plugin-nested';\nimport { DataList } from '../controller';\nimport { getSplitorByOpts, transformStr2ArrBySplitor } from '../controller.service';\nimport { ParameterTagComboCheckboxNext } from './tag_combo_checkbox_next';\n\nexport const ICON_MAX_SIZE = 28;\nexport const BASE_ICON_SIZE = 14;\n\n/**\n * 将默认值转为数组\n * @param value 默认朱\n * @param splitor 分隔符\n */\nexport function transformValue2Arr(value: string | number | (number| string)[], splitor: string = ',', startSymbol = '', endSymbol = ''): string[] {\n    if (BI.isArray(value)) {\n        return value.map(v => `${v}`);\n    }\n\n    return transformStr2ArrBySplitor(value, splitor, startSymbol, endSymbol);\n}\n\n/**\n * 把字典的value转为string类型，以及去除已选值\n * @param data 数据字典的items\n * @param _selectedValues 已选值数组\n */\nexport function transformControlAttrs(\n    data: DataList = [],\n    _selectedValues: (string | number)[] = [],\n    attributes?: ((v: DataList[0]) => { [key: string]: any }) | { [key: string]: any },\n) {\n    const selectedValues = _selectedValues.map(value => `${value}`);\n\n    return Array.from(data)\n        .filter(controlAttr => !selectedValues.includes(`${controlAttr.value}`))\n        .map(controlAttr => {\n            return {\n                ...!attributes\n                    ? {}\n                    : BI.isFunction(attributes)\n                        ? attributes(controlAttr)\n                        : attributes,\n                text: `${controlAttr.text}`,\n                value: `${controlAttr.value}`,\n                title: `${controlAttr.text}`,\n            };\n        });\n}\n\nexport function transformValue2TagComboNextValue(\n    v: string | number | (string | number)[] | { date_milliseconds: number; },\n    _controlAttrData: {text: string;value: string;}[],\n    delimiter: string,\n    returnArray: boolean,\n    customData: boolean,\n    startSymbol: string,\n    endSymbol: string,\n): {text: string;value: string;}[] | undefined {\n    const values: (string | {text: string;value: string;})[] = preTransformValue2TagComboNextValue(v, delimiter, returnArray, startSymbol, endSymbol);\n\n    const controlAttrData = _controlAttrData.slice(0);\n\n    // 找到实际值相符的item\n    values.forEach((value, index) => {\n        const controlAttrDataIndex = controlAttrData.findIndex(item => item.value === value);\n\n        if (controlAttrDataIndex === -1) {\n            return;\n        }\n\n        values[index] = controlAttrData[controlAttrDataIndex];\n\n        controlAttrData.splice(controlAttrDataIndex, 1);\n    });\n\n    // 找到显示值相符的item\n    values.forEach((value, index) => {\n        if (!BI.isString(value)) {\n            return;\n        }\n\n        const controlAttrDataIndex = controlAttrData.findIndex(item => item.text === value);\n\n        if (controlAttrDataIndex === -1) {\n            // 此时还会有一些item没有匹配到，作为自定义项\n            customData && (values[index] = { text: value, value });\n\n            return;\n        }\n\n        values[index] = controlAttrData[controlAttrDataIndex];\n\n        controlAttrData.splice(controlAttrDataIndex, 1);\n    });\n\n    return values\n        .filter(value => !BI.isString(value)) as {text: string;value: string;}[];\n}\n\n/**\n * 预处理下value\n * @param v value\n * @param delimiter 分隔符\n * @param returnArray 值是否是array\n */\nexport function preTransformValue2TagComboNextValue(\n    v: string | number | (string | number)[] | { date_milliseconds: number; },\n    delimiter: string,\n    returnArray: boolean,\n    startSymbol: string,\n    endSymbol: string,\n): string[] {\n    /**\n     * 历史遗留，后台给过来的空值就是空字符串，不会传null\n     * 我看老的版本也有这个bug，如果字典里有实际值为空，一样不会显示\n     * 所以此处直接将空值置为null\n     */\n    if (!v) {\n        return [];\n    }\n\n    if (BI.isObject(v) && 'date_milliseconds' in v) {\n        return [BI.print(BI.getDate(v.date_milliseconds), '%Y-%X-%d')];\n    }\n\n    return transformValue2Arr(v, getSplitorByOpts(delimiter, returnArray), startSymbol, endSymbol);\n}\n\nexport function setTagComboCheckboxStyle({ opacity, background, color, border, ['border-radius']: borderRadius }: {\n    opacity?: number;\n    background?: string;\n    color?: string;\n    border?: string;\n    'border-radius'?: string;\n}) {\n    jss.use(jssGlobal(), jssNested());\n\n    const cls = `${ParameterTagComboCheckboxNext.BASE_CLS}-${BI.UUID()}`;\n\n    const selector = `.${cls}`;\n\n    jss.createStyleSheet({\n        '@global': {\n            [`${selector}`]: {\n                opacity,\n                background,\n            },\n            [`${selector} .bi-combo .bi-card`]: {\n                background,\n                color,\n            },\n            [`${selector} .bi-input`]: {\n                color,\n            },\n            [`${selector} .bi-icon-button`]: {\n                color,\n            },\n            [`${selector} .bi-border`]: {\n                border,\n                'boder-radius': borderRadius,\n            },\n        },\n    }).attach();\n\n    return cls;\n}\n\nexport function setTagComboCheckboxPopupStyle({ fontSize, itemHeight }: {\n    itemHeight: string;\n    fontSize: string;\n}) {\n    jss.use(jssGlobal(), jssNested());\n\n    const cls = `${ParameterTagComboCheckboxNext.BASE_CLS}-${BI.UUID()}`;\n\n    const selector = `.${cls}`;\n\n    const iconSize = Math.min(parseInt(fontSize, 10), ICON_MAX_SIZE);\n\n    jss.createStyleSheet({\n        '@global': {\n            [`${selector} .bi-list-pane .bi-label`]: {\n                'font-size': `${fontSize} !important`,\n            },\n            [`${selector} .bi-popup-view .bi-v-tape >.bi-v .bi-label`]: {\n                'font-size': `${fontSize} !important`,\n            },\n            [`${selector} .checkbox-content`]: {\n                width: `${iconSize}px !important`,\n                height: `${iconSize}px !important`,\n            },\n            [`${selector} .checkbox-content:after`]: {\n                top: `${iconSize / BASE_ICON_SIZE * 6}px !important`,\n                left: `${iconSize / BASE_ICON_SIZE * 2}px !important`,\n                width: `${iconSize / BASE_ICON_SIZE * 6}px !important`,\n                height: `${iconSize / BASE_ICON_SIZE * 9}px !important`,\n            },\n            [`${selector} .bi-popup-view .bi-half-button`]: {\n                width: `${iconSize}px !important`,\n                height: `${iconSize}px !important`,\n            },\n            [`${selector} .bi-popup-view .bi-half-button:after`]: {\n                top: `${iconSize / BASE_ICON_SIZE * 2}px !important`,\n                left: `${iconSize / BASE_ICON_SIZE * 2}px !important`,\n                width: `${iconSize / BASE_ICON_SIZE * 8}px !important`,\n                height: `${iconSize / BASE_ICON_SIZE * 8}px !important`,\n            },\n            [`${selector} .bi-list-pane .bi-tips`]: {\n                'font-size': `${fontSize} !important`,\n                height: `${itemHeight} !important`,\n                'line-height': `${itemHeight} !important`,\n            },\n        },\n    }).attach();\n\n    return cls;\n}\n"]}