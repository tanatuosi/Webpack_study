{"version":3,"file":"controller.service.js","sourceRoot":"","sources":["../../src/modules/controller.service.ts"],"names":[],"mappings":"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","sourcesContent":["import jss from 'jss';\nimport jssGlobal from 'jss-plugin-global';\nimport jssNested from 'jss-plugin-nested';\nimport { ParameterControllerControlAttr } from './controller';\nimport { fetchWidgetViewValue } from './controller.crud';\n\nexport const LimitCount = 500;\n\nexport const PopupMaxHeight = 500;\n\n/**\n * 设置字体大小样式\n * @param baseCls 基础样式class\n * @param fontSize 字体大小\n * @returns 返回新的样式class\n */\nexport function setFontSize(baseCls: string, fontSize: number): string {\n    const cls = `${baseCls}-${BI.UUID()}`;\n\n    const selector = `.${cls}`;\n\n    jss.use(jssGlobal(), jssNested());\n\n    jss.createStyleSheet({\n        '@global': {\n            [`${selector}`]: {\n                'font-size': `${fontSize}px`,\n            },\n        },\n    }).attach();\n\n    return cls;\n}\n\n/**\n * 根据adaptive获取对应width属性\n * @param adaptive 是否自适应\n * @param columnsInRow 非自适应时分为几列\n */\nexport function getWidthPropByAdaptive(adaptive: boolean, columnsInRow: number = 1): { width?: string } {\n    return adaptive ? {} : { width: `${(1 / columnsInRow * 100).toFixed(0)}%` };\n}\n\n/**\n * 根据分隔符和是否返回数组返回分隔符\n * @param delimiter 分隔符\n * @param returnArray 是否返回数组\n */\nexport function getSplitorByOpts(delimiter: string, returnArray: boolean): undefined | string {\n    return returnArray ? undefined : delimiter;\n}\n\n/**\n * 设置fontStyle\n * @param fontStyle fontStyle\n */\nexport function getFontStyle(fontStyle: string): { 'font-style': string; 'padding-right': string; } {\n    return {\n        'font-style': fontStyle,\n        'padding-right': '0.1em',\n    };\n}\n\n/**\n * 设置文本框样式\n * @param style\n */\nexport function setEditorStyle({ opacity, background, color, border, ['border-radius']: borderRadius }: {\n    opacity?: number;\n    background?: string;\n    color?: string;\n    border?: string;\n    'border-radius'?: string;\n}) {\n    jss.use(jssGlobal(), jssNested());\n\n    const cls = `report-contoller-editor-${BI.UUID()}`;\n\n    const selector = `.${cls}`;\n\n    jss.createStyleSheet({\n        '@global': {\n            [`${selector}`]: {\n                opacity,\n                background,\n            },\n            [`${selector} .bi-input`]: {\n                color,\n            },\n            [`${selector} .bi-textarea`]: {\n                color,\n            },\n            [`${selector} .bi-border`]: {\n                border,\n                'boder-radius': borderRadius,\n            },\n        },\n    }).attach();\n\n    return cls;\n}\n\nexport function transformControlAttrData(data: ParameterControllerControlAttr['data'] | null | undefined | { error: string } = []) {\n    return BI.isNull(data)\n        ? []\n        : BI.isArray(data)\n            ? data.map(({ text, value }) => {\n                return {\n                    text: `${text}`,\n                    value: `${BI.isNull(value) ? '' : value}`,\n                };\n            })\n            : (() => {\n                BI.Msg.toast(BI.i18nText(data.error));\n\n                return [];\n            })();\n}\n\n/**\n * 根据已有值创建新值，在value最前面加上不可见字符\\u200b\n * @param value 当前值\n * @param values 已有值\n */\nexport function transform2DistinctValueByValues(value: string, values: string[]) {\n    let $value = value;\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        if (values.includes($value)) {\n            $value = `\\u200b${$value}`;\n\n            continue;\n        }\n\n        break;\n    }\n\n    return $value;\n}\n\n/**\n * 将已有值转换为唯一值\n * @param items 已有值\n */\nexport function transform2DistinctValues<T extends { value: string }>(items: T[]): T[] {\n    const values: string[] = [];\n\n    return items.map(item => {\n        const value = transform2DistinctValueByValues(item.value, values);\n\n        values.push(value);\n\n        return {\n            ...item,\n            value,\n        };\n    });\n}\n\n/**\n * 设置下拉框下拉图标字体大小样式\n * @param baseCls 基础样式class\n * @param fontSize 字体大小\n * @returns 返回新的样式class\n */\nexport function setComboFontSize(baseCls: string, dep: {\n    fontSize: number;\n    width: number;\n    height: number;\n}): string {\n    const { fontSize } = dep;\n\n    const cls = `${baseCls}-${BI.UUID()}`;\n\n    jss.use(jssGlobal(), jssNested());\n\n    // 下拉按钮\n    const selector = `.${cls} .bi-trigger-icon-button.bi-icon-button`;\n\n    // 字体缩放比例\n    const scale = fontSize / 12;\n\n    // 下拉树展开收起按钮\n    const switcherSize = `${scale * 15}px !important`;\n\n    // 下拉按钮的宽度，跟随字体大小变化，字体12px时宽度24px\n    const triggerWidthStyle = `${scale * 24}px !important`;\n\n    jss.createStyleSheet({\n        '@global': {\n            // 下拉框展开按钮样式\n            [`${selector}`]: {\n                width: triggerWidthStyle,\n                'font-size': `${scale * 16}px`,\n            },\n            // 不允许编辑下拉树的输入框部分\n            [`.${cls}>.bi-trigger.bi-text-trigger >div:first-child`]: {\n                'font-size': `${fontSize}px`,\n            },\n            // 输入框字体 现在下拉框控件存在着两种不一样的dom结构\n            [`.${cls}>.bi-combo .bi-trigger .bi-searcher >div:first-child`]: {\n                'font-size': `${fontSize}px`,\n            },\n            [`.${cls}> .bi-trigger .bi-searcher >div:first-child`]: {\n                'font-size': `${fontSize}px`,\n            },\n            [`.${cls} .bi-multi-tree-check-selected-button .x-icon`]: {\n                'font-size': `${fontSize}px`,\n            },\n            [`.${cls} .bi-multi-tree-check-selected-button .bi-icon-button`]: {\n                width: switcherSize,\n                height: switcherSize,\n                'line-height': switcherSize,\n            },\n            [`.${cls} .bi-multi-tree-check-selected-button .bi-text`]: {\n                'font-size': `${fontSize}px`,\n                'line-height': switcherSize,\n            },\n            [`.${cls} .bi-switcher .bi-multi-select-check-selected-button .bi-text`]: {\n                'font-size': `${fontSize}px`,\n            },\n        },\n    }).attach();\n\n    return cls;\n}\n\n/**\n * 控件匹配实际值/显示值\n * @param widgetName 控件名称\n * @param customData 是否允许自定义值\n * @param op 其余参数\n */\nexport async function fetchParamViewValue(\n    widgetName: string,\n    customData: boolean,\n    requestor: typeof fetchWidgetViewValue,\n    op: {\n        dependence: {\n            [key: string]: any;\n        };\n        reload: boolean;\n        __text__: string | number | undefined;\n    },\n): Promise<{ value: string, text: string } | undefined> {\n    return requestor({\n        ...op,\n        widgetname: widgetName,\n    })\n        .then(re => {\n            if (!re) {\n                return undefined;\n            }\n\n            const text = op.__text__;\n        \n            if (BI.isString(re) || !('value' in re)) {\n                return customData\n                    ? text\n                        ? {\n                            text: `${text}`,\n                            value: `${text}`,\n                        }\n                        : undefined\n                    : undefined;\n            }\n        \n            const value = re.value;\n\n            if (BI.isEmptyString(value)) {\n                return undefined;\n            }\n        \n            return {\n                text: `${value.text}`,\n                value: `${value.val}`,\n            };\n        });\n}\n\n/*\n * 设置字体行高\n * @param baseCls 基础样式class\n * @param lineHeight 行高\n * @returns 返回新的样式class\n */\nexport function setLineHeight(baseCls: string, lineHeight: number): string {\n    const cls = `${baseCls}-${BI.UUID()}`;\n\n    const selector = `.${cls}`;\n\n    jss.use(jssGlobal(), jssNested());\n\n    jss.createStyleSheet({\n        '@global': {\n            [`${selector} input`]: {\n                'line-height': `${lineHeight}px`,\n            },\n        },\n    }).attach();\n\n    return cls;\n}\n\n/**\n * 将默认值转为数组\n * @param value 默认朱\n * @param splitor 分隔符\n */\nexport function transformStr2ArrBySplitor(value: string | number, splitor = ',', startSymbol = '', endSymbol = ''): string[] {\n    let v = `${value}`;\n\n    if (v.substring(0, 1) === startSymbol) {\n        v = v.substring(1);\n    }\n\n    if (v.substring(v.length - 1) === endSymbol) {\n        v = v.substring(0, v.length - 1);\n    }\n\n    return v.split(splitor);\n}\n"]}