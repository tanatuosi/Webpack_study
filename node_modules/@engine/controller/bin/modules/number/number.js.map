{"version":3,"file":"number.js","sourceRoot":"","sources":["../../../src/modules/number/number.ts"],"names":[],"mappings":"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","sourcesContent":["import { WIDTH, HEIGHT } from '../controller.constants';\nimport { setEditorStyle, setFontSize, setLineHeight } from '../controller.service';\nimport { checkValidation, transformValidation2ErrorMsg } from './number.service';\nimport { shortcut } from '@engine/core';\nimport { ParameterControllerBasicProps4Item, ParameterControllerPropsWithEditor, ParameterControllerBasicProps4Render } from '../controller';\nimport { AbstractParameterControllerWidget, ControllerValidation } from '../controller.abstract';\nimport { TextEditor } from '@fui/core';\n\n@shortcut()\nexport class ParameterNumber extends AbstractParameterControllerWidget {\n    public static xtype = 'report.main.parameter_container.controller.number';\n\n    private editor: TextEditor;\n\n    public props: ParamNumberProps = {\n        baseCls: 'report-main-parameter-container-controller-number',\n        $testId: 'report-main-parameter-container-controller-number',\n        width: WIDTH,\n        height: HEIGHT,\n        value: undefined,\n        allowDecimals: true,\n        allowNegative: true,\n        maxDecLength: 16,\n        maxIntLength: 32,\n        maxValue: undefined,\n        minValue: undefined,\n        regErrorMsg: '',\n        disabled: false,\n        invisible: false,\n        needSubmit: false,\n        fontSize: 12,\n        allowBlank: true,\n        errorMsg: BI.i18nText('Fine-Report_Preview_Can_Not_Null'),\n        watermark: '',\n        allowBg: true,\n    }\n\n    public render() {\n        const { width, height, value, fontSize, watermark, disabled, allowBg } = this.options;\n\n        const editorCls = setFontSize('report-main-parameter-container-controller-number', fontSize);\n        \n        const editorCls2 = setLineHeight('report-main-parameter-container-controller-number', height);\n\n        return {\n            type: BI.VerticalLayout.xtype,\n            cls: allowBg ? 'bi-card' : '',\n            items: [{\n                type: BI.TextEditor.xtype,\n                cls: `${editorCls} ${editorCls2} bi-border-radius`,\n                ref: (_ref: TextEditor) => {\n                    this.editor = _ref;\n                },\n                vgap: 0,\n                width,\n                height,\n                watermark,\n                allowBlank: true,\n                disabled,\n                // REPORT-19456 特殊交互，数值控件如果默认值非法不显示值\n                // https://kms.fineres.com/pages/viewpage.action?pageId=253971984 不再进行初始化时的校验\n                value,\n                listeners: [{\n                    eventName: BI.TextEditor.EVENT_FOCUS,\n                    action: () => {\n                        this.hideBubble();\n                        !this.silence && this.fireEvent('beforeedit');\n                    },\n                }, {\n                    eventName: BI.TextEditor.EVENT_KEY_DOWN,\n                    action: () => {\n                        this.hideBubble();\n\n                        const result = !this.silence && this.fireEvent('afteredit');\n\n                        result !== false && this.fireEvent('EVENT_CHANGE', this.editor.getValue());\n                    },\n                }, {\n                    eventName: BI.TextEditor.EVENT_BLUR,\n                    action: () => {\n                        !this.silence && this.fireEvent('stopedit');\n                    },\n                }],\n            }],\n        };\n    }\n\n    public async setControllerValue(v: any) {\n        const validation = this.getBasicValidation(v);\n\n        validation.result && this.editor.setValue(v);\n    }\n\n    public getValue() {\n        return this.editor.getValue();\n    }\n\n    private getBasicValidation(value: any = this.editor?.getValue()): ControllerValidation {\n        const { allowNegative, allowDecimals, allowBlank, maxDecLength, maxIntLength, maxValue, minValue, errorMsg, regErrorMsg } = this.options;\n\n        const validation = checkValidation(value, { allowNegative, allowDecimals, allowBlank, maxDecLength, maxIntLength, maxValue, minValue });\n\n        return validation === true ? {\n            result: true,\n        } : {\n            result: false,\n            errorMsg: transformValidation2ErrorMsg(validation, {\n                errorMsg,\n                regErrorMsg,\n                maxValue,\n                minValue,\n            }),\n        };\n    }\n\n    public preGetValidation(): ControllerValidation {\n        const { value } = this.options;\n\n        return this.getBasicValidation(value);\n    }\n\n    public postGetValidation(): ControllerValidation {\n        return this.getBasicValidation();\n    }\n\n    public postValidateAndToast() {\n        const validation = this.getValidation();\n\n        if (validation.result === true) {\n            return true;\n        }\n\n        this.showBubble(validation.errorMsg);\n\n        return false;\n    }\n\n    public emitManualStopEditEvent() {\n        this.fireEvent('stopedit');\n    }\n\n    public setInteractValue(v: any) {\n        this.setControllerValue(v);\n    }\n\n    public reset() {\n        this.editor.setValue();\n    }\n\n    public resize(width: number, height: number) {\n        const restoreValue = this.editor.getValue();\n\n        super.resize(width, height);\n\n        this.editor.setValue(restoreValue);\n    }\n    \n    public getAdapter() {\n        return this.editor;\n    }\n\n    public focus() {\n        this.editor.focus();\n    }\n\n    public blur(): void {\n        this.editor.blur();\n    }\n\n    public setStyle(styles: Parameters<AbstractParameterControllerWidget['setStyle']>[0]) {\n        this.editor.element.addClass(setEditorStyle(styles));\n    }\n\n    public setWaterMark(v: string) {\n        this.editor.setWaterMark(v);\n    }\n\n    public getText() {\n        return this.editor.getValue();\n    }\n}\n\n\nexport interface ParamNumberProps extends ParameterControllerNumberProps4Render4Item {\n    baseCls: string;\n    $testId: string;\n}\n\nexport interface ParameterControllerNumberProps4Render4Item extends Omit<ParameterControllerBasicProps4Item, 'value'>, ParameterControllerPropsWithEditor {\n\n    /**\n     * 数值\n     */\n    value?: number;\n\n    /**\n     * 允许小数\n     */\n    allowDecimals: boolean;\n\n    /**\n     * \t允许负数\n     */\n    allowNegative: boolean;\n\n    /**\n     * 小数最大长度，默认 16\n     */\n    maxDecLength: number;\n\n    /**\n     * 整数最大长度，默认 32\n     */\n    maxIntLength: number;\n\n    /**\n     * 最大值\n     */\n    maxValue?: number;\n\n    /**\n     * 最小值\n     */\n    minValue?: number;\n\n    /**\n     * 验证错误信息\n     */\n    regErrorMsg: string;\n}\n\nexport interface ParameterControllerNumberProps4Render extends ParameterControllerBasicProps4Render, ParameterControllerNumberProps4Render4Item {}\n"]}