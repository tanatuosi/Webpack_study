{"version":3,"file":"combo_next.js","sourceRoot":"","sources":["../../../src/modules/combo/combo_next.ts"],"names":[],"mappings":"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","sourcesContent":["import { WIDTH, HEIGHT } from '../controller.constants';\nimport { LimitCount, transformControlAttrData, setComboFontSize, fetchParamViewValue } from '../controller.service';\nimport { fetchParamControlAttr, fetchWidgetViewValue } from '../controller.crud';\nimport { shortcut } from '@engine/core';\nimport { ParameterControllerBasicProps4Item, ParameterControllerPropsWithEditor, ParameterControllerPropsWithCombo, ParameterControllerBasicProps4Render, ParameterControllerForm, ParameterControllerDelayer } from '../controller';\nimport { AbstractParameterControllerWidget, ControllerValidation } from '../controller.abstract';\nimport { ParameterSingleSelectCombo } from './singleselectcombo/singleselectcombo';\nimport { transformValue2ComboNextValue, preTransformValue2ComboNextValue, setComboStyle, setComboPopupStyle } from './combo.service';\nimport './combo.less';\n@shortcut()\nexport class ParameterComboNext extends AbstractParameterControllerWidget {\n    public static xtype = 'report.main.parameter_container.controller_next.combo';\n\n    public static BASE_CLS = 'report-main-parameter-container-controller-combo';\n\n    public props: ParamComboProps & ParameterControllerForm & ParameterControllerDelayer = {\n        baseCls: `${ParameterComboNext.BASE_CLS} bi-border-radius`,\n        $testId: 'report-main-parameter-container-controller-combo',\n        width: WIDTH,\n        height: HEIGHT,\n        watermark: '',\n        value: '',\n        fontSize: 12,\n        needSubmit: false,\n        disabled: false,\n        invisible: false,\n        allowBlank: true,\n        errorMsg: BI.i18nText('Fine-Report_Preview_Can_Not_Null'),\n        controlAttr: {\n            data: [],\n            value: '',\n        },\n        customData: false,\n        directEdit: true,\n        noRepeat: true,\n        autoMode: true,\n        mode: 'remote',\n        searchTime: 200,\n        widgetName: '',\n        getDependenceByWidget: () => [],\n        getWidgetDependenceValueByWidget: () => {\n            return {};\n        },\n        add2WaitingQueue: () => '',\n        removeFromWaitingQueue: () => {},\n        name4Empty: '',\n        sonHeight: 24,\n        maxCount: 0,\n        controlAttrFetcher: fetchParamControlAttr,\n        extraOptsGetter: () => {\n            return {};\n        },\n        viewValueFetcher: fetchWidgetViewValue,\n        allowBg: true,\n        needCheckCustomData: true,\n    }\n\n    private combo: ParameterSingleSelectCombo;\n\n    public get editComp() {\n        return this.combo;\n    }\n\n    /**\n     * 公开接口，修改下拉框控件的默认文字“不选”\n     * @param name 名称\n     */\n    public setName4Empty(name: string) {\n        this.options.name4Empty = name;\n        this.combo?.updateName4Empty();\n    }\n\n    // 12px配24px的行高\n    private ratio = 2;\n\n    public render() {\n        const { width, height, watermark, fontSize, widgetName, value, controlAttr, customData, directEdit, allowBlank, controlAttrFetcher, allowBg } = this.options;\n\n        return <Partial<ParameterSingleSelectCombo['props']>>{\n            type: ParameterSingleSelectCombo.xtype,\n            cls: `${setComboFontSize(ParameterComboNext.BASE_CLS, {\n                fontSize, width, height,\n            })} ${allowBg ? 'bi-card' : ''}`,\n            ref: (_ref: ParameterSingleSelectCombo) => {\n                this.combo = _ref;\n            },\n            customData,\n            allowEdit: directEdit,\n            allowNoSelect: allowBlank,\n            value: transformValue2ComboNextValue(value, transformControlAttrData(controlAttr.data)),\n            controlDataGetter: () => transformControlAttrData(this.options.controlAttr.data), // REPORT-40943 controlAttr会改变但此处引用不变，所以会出问题\n            name4EmptyGetter: () => this.options.name4Empty,\n            itemHeightGetter: () => this.options.sonHeight,\n            maxCountGetter: () => this.options.maxCount,\n            itemsCreator: (options: {\n                keyword: string,\n                selectedValues: string[],\n                times: number,\n                type: number,\n            }, callback: Function) => {\n                controlAttrFetcher(widgetName, {\n                    startIndex: LimitCount * (options.times - 1),\n                    limitIndex: LimitCount * options.times,\n                    ...options.keyword ? { filter: options.keyword } : {},\n                    ...this.getRequestOpts(),\n                })\n                    .then(items => {\n                        this.options.controlAttr.data = (this.options.controlAttr.data || []).concat(items);\n\n                        callback({\n                            items: transformControlAttrData(items),\n                            hasNext: items.length >= LimitCount,\n                        });\n                    });\n            },\n            width,\n            height,\n            // itemHeight: Math.max(this.ratio * fontSize, 24),\n            // 屏蔽弹出框的自动调整行高\n            watermark,\n            listeners: [{\n                eventName: ParameterSingleSelectCombo.EVENT_CONFIRM,\n                action: () => {\n                    const result = !this.silence && this.fireEvent('stopedit');\n\n                    result !== false && this.fireEvent('EVENT_CHANGE');\n                },\n            }, {\n                eventName: ParameterSingleSelectCombo.EVENT_BEFORE_EDIT,\n                action: () => {\n                    this.hideBubble();\n\n                    !this.silence && this.fireEvent('beforeedit');\n                },\n            }, {\n                eventName: ParameterSingleSelectCombo.EVENT_AFTER_EDIT,\n                action: () => {\n                    !this.silence && this.fireEvent('afteredit');\n                },\n            }, {\n                eventName: ParameterSingleSelectCombo.EVENT_CLICK_ITEM,\n                action: () => {\n                    this.hideBubble();\n\n                    !this.silence && this.fireEvent('click');\n                },\n            }],\n        };\n    }\n\n    public mounted() {\n        super.mounted();\n        // TODO 要优化一下，并不一定每次mounted都要设置popup，看能不能根据popup打开时机判断\n        const { fontSize } = this.options;\n\n        this.setPopupStyle({\n            fontSize: `${fontSize}px`,\n            itemHeight: `${fontSize * this.ratio}px`,\n        });\n    }\n\n    public preGetValidation(): ControllerValidation {\n        const { errorMsg, value, allowBlank } = this.options;\n\n        const validation = this.options.customData || this.combo.validateData();\n        if (!validation) {\n            return {\n                result: false,\n                errorMsg: BI.i18nText('Fine-Report_Preview_Not_In_List'),\n            };\n        }\n\n        if (allowBlank || !BI.isEmpty(value)) {\n            return { result: true };\n        }\n\n        return {\n            result: false,\n            errorMsg,\n        };\n    }\n\n    public postGetValidation(): ControllerValidation {\n        const { allowBlank, errorMsg, customData, needCheckCustomData } = this.options;\n\n        const value = `${this.getValue()}` || '';\n\n        const validation = customData || !needCheckCustomData || this.combo.validateData();\n        if (!validation) {\n            return {\n                result: false,\n                errorMsg: BI.i18nText('Fine-Report_Preview_Not_In_List'),\n            };\n        }\n\n        if (allowBlank || BI.isNotEmptyString(value)) {\n            return { result: true };\n        }\n\n        return {\n            result: false,\n            errorMsg,\n        };\n    }\n\n    public postValidateAndToast() {\n        const validation = this.getValidation();\n\n        if (validation.result) {\n            return true;\n        }\n\n        this.showBubble(validation.errorMsg);\n\n        return false;\n    }\n\n    public emitManualStopEditEvent() {\n        this.fireEvent('stopedit');\n    }\n\n    public getValue() {\n        const value = this.combo.getValue();\n\n        return BI.isNull(value)\n            ? ''\n            : value.value;\n    }\n\n    public async updateControllAttrByValue(v: any, controlData?: {\n        text: string;\n        value: string | number;\n    }[]): Promise<{\n            value: string;\n            text: string;\n        } | undefined> {\n        const { add2WaitingQueue, removeFromWaitingQueue, widgetName, customData, viewValueFetcher } = this.options;\n        \n        if (!controlData || BI.isEmptyArray(controlData)) {\n            const value = preTransformValue2ComboNextValue(v);\n\n            if (BI.isNull(value)) {\n                return value;\n            }\n\n            const id = add2WaitingQueue();\n\n            const re = await fetchParamViewValue(\n                widgetName,\n                customData,\n                viewValueFetcher,\n                {\n                    __text__: value,\n                    ...this.getRequestOpts(),\n                });\n\n            this.options.controlAttr = re\n                ? { data: (this.options.controlAttr.data || []).concat([re]), value }\n                : this.options.controlAttr;\n\n            removeFromWaitingQueue(id);\n\n            return re;\n        }\n\n        this.options.controlAttr = { data: (this.options.controlAttr.data || []).concat(controlData), value: v };\n\n        return transformValue2ComboNextValue(v, controlData || []);\n    }\n\n    public async setControllerValue(v: any, controlData?: {\n        text: string;\n        value: string | number;\n    }[]) {\n        this.combo.setValue(await this.updateControllAttrByValue(v, controlData));\n    }\n\n    public setValue(v: any, controlData?: {\n        text: string;\n        value: string;\n    }[]) {\n        this.setControllerValue(v, controlData)\n            .then(() => {\n                this.fireEvent('EVENT_SET_VALUE');\n\n                !this.silence && controlData && this.fireEvent('afteredit');\n            });\n    }\n\n    public reset() {\n        this.setControllerValue('', []);\n    }\n\n    public reloadControlAttr() {\n        this.reset();\n\n        this.combo.setRepopulate(true);\n    }\n\n    public setInteractValue(v: {\n        data: {\n            text: string;\n            value: string | number;\n        }[],\n        value: any\n    }) {\n        this.combo.setRepopulate(true);\n\n        this.setControllerValue(v.value, v.data);\n    }\n\n    public resize(width: number, height: number) {\n        const restoreValue = this.combo.getValue();\n\n        super.resize(width, height);\n\n        this.combo.setValue(restoreValue);\n    }\n\n    private getRequestOpts() {\n        const { getWidgetDependenceValueByWidget, getDependenceByWidget, extraOptsGetter } = this.options;\n\n        const dependences = getWidgetDependenceValueByWidget(this);\n\n        return {\n            dependence: dependences,\n            reload: BI.isNotEmptyArray(getDependenceByWidget(this)),\n            ...extraOptsGetter(),\n        };\n    }\n\n    public getText() {\n        return this.combo.getValue()?.text;\n    }\n\n    public getAdapter() {\n        return this.combo.getAdapter();\n    }\n\n    public setStyle(styles: Parameters<AbstractParameterControllerWidget['setStyle']>[0]) {\n        this.combo.element.addClass(setComboStyle(styles));\n    }\n\n    public setPopupStyle(styles: {\n        itemHeight: string;\n        fontSize: string;\n    }) {\n        this.options.sonHeight = parseInt(styles.itemHeight, 10);\n\n        this.combo.element.addClass(setComboPopupStyle(styles));\n    }\n\n    public setWaterMark(v: string) {\n        this.options.watermark = v;\n\n        this.combo.setWaterMark(v);\n    }\n\n    public focus() {\n        this.combo.focus();\n    }\n\n    public blur() {\n        this.combo.blur();\n    }\n}\n\n\nexport interface ParamComboProps extends Omit<ParameterControllerComboProps4Render4Item, 'value'> {\n    baseCls: string;\n    $testId: string;\n    value: string | number | (string | number)[] | {\n        date_milliseconds: number;\n    }\n    name4Empty: string;\n    sonHeight: number;\n    maxCount: number;\n    controlAttrFetcher: typeof fetchParamControlAttr,\n    extraOptsGetter: () => {[key: string]: any};\n    viewValueFetcher: typeof fetchWidgetViewValue;\n}\n\n/**\n * 下拉框\n */\nexport interface ParameterControllerComboProps4Render4Item extends ParameterControllerBasicProps4Item, ParameterControllerPropsWithEditor, ParameterControllerPropsWithCombo {\n    widgetName: ParameterControllerBasicProps4Render['widgetName'];\n\n    /**\n     * 是否校验自定义值\n     */\n    needCheckCustomData: boolean;\n}\n\nexport interface ParameterControllerComboProps4Render extends ParameterControllerBasicProps4Render, ParameterControllerComboProps4Render4Item {}\n"]}