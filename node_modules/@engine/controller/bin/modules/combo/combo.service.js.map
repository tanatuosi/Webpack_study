{"version":3,"file":"combo.service.js","sourceRoot":"","sources":["../../../src/modules/combo/combo.service.ts"],"names":[],"mappings":"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","sourcesContent":["import jss from 'jss';\nimport jssGlobal from 'jss-plugin-global';\nimport jssNested from 'jss-plugin-nested';\nimport { ParameterComboNext } from './combo_next';\n\n/**\n * 转换默认值为combo控件可用值\n * @param v 默认值\n */\nexport function assertComboValue(v: string | number | (string | number)[]): string | undefined {\n    return BI.isEmptyString(Array.isArray(v) ? `${BI.first(v)}` : v) ? undefined : `${v}`;\n}\n\n/**\n * 校验是否有额外的值传入\n * @param controlAttr 数据字典\n */\nexport function validateCustomData(controlAttr: {\n    data: {[key: string]: string | number | undefined}[],\n    value: string | number | (string | number)[]\n}): boolean {\n    if (controlAttr.value === '') {\n        return true;\n    }\n\n    const validation = BI.isNotNull(controlAttr.data)\n        && controlAttr.data.some(item => `${item.text}` === `${controlAttr.value}` || `${item.value}` === `${controlAttr.value}`);\n\n    if (!validation) {\n        BI.Msg.toast(BI.i18nText('Fine-Report_Preview_Not_In_List'), { level: 'error' });\n    }\n\n    return validation;\n}\n\n/**\n * 转换成单选框的输入值\n * @param v 值\n * @param _controlAttrData 数据字典\n */\nexport function transformValue2ComboNextValue(\n    v: string | number | (string | number)[] | {\n        date_milliseconds: number;\n    },\n    _controlAttrData: {text: string; value: string | number;}[],\n): {text: string;value: string;} | undefined {\n    const value = preTransformValue2ComboNextValue(v);\n\n    if (!value) {\n        return undefined;\n    }\n\n    const controlAttrData = _controlAttrData.slice(0);\n\n    // 找到实际值相符的item\n    // 截止到发稿前，5能匹配上“05”这种神操作只有单选下拉框里有\n    // eslint-disable-next-line eqeqeq\n    let controlAttrDataIndex = controlAttrData.findIndex(item => item.value == value);\n\n    // REPORT-49902 可能出现v是5，controllerData里的value是'5'，因此无法完全匹配的问题，这里找到后统一转成string\n    if (controlAttrDataIndex !== -1) {\n        return {\n            text: `${controlAttrData[controlAttrDataIndex].text}`,\n            value: `${controlAttrData[controlAttrDataIndex].value}`,\n        };\n    }\n\n    // 找到显示值相符的item\n    // 截止到发稿前，5能匹配上“05”这种神操作只有单选下拉框里有\n    // eslint-disable-next-line eqeqeq\n    controlAttrDataIndex = controlAttrData.findIndex(item => item.text == value);\n\n    if (controlAttrDataIndex !== -1) {\n        return {\n            text: `${controlAttrData[controlAttrDataIndex].text}`,\n            value: `${controlAttrData[controlAttrDataIndex].value}`,\n        };\n    }\n\n    // 此时还会有一些item没有匹配到，作为自定义项\n    return { text: `${value}`, value: `${value}` };\n}\n\n/**\n * value预处理\n * @param v 控件值\n */\nexport function preTransformValue2ComboNextValue(v: string | number | (string | number)[] | {\n    date_milliseconds: number;\n}): string | undefined | number {\n    /**\n     * 历史遗留，后台给过来的空值就是空字符串，不会传null\n     * 我看老的版本也有这个bug，如果字典里有实际值为空，一样不会显示\n     * 所以此处直接将空值置为null\n     */\n    if (!v) {\n        return undefined;\n    }\n\n    /**\n     * REPORT-24744\n     */\n    if (BI.isObject(v) && 'date_milliseconds' in v) {\n        return BI.print(new Date(v.date_milliseconds), '%Y-%X-%d');\n    }\n\n    // REPORT-67677 单选框默认值为数组的情况，显示全部值，与旧版保持一致\n    const value = BI.isArray(v) ? v.join(',') : v;\n\n    return value;\n}\n\nexport function setComboStyle({ opacity, background, color, border, ['border-radius']: borderRadius }: {\n    opacity?: number;\n    background?: string;\n    color?: string;\n    border?: string;\n    'border-radius'?: string;\n}) {\n    jss.use(jssGlobal(), jssNested());\n\n    const cls = `${ParameterComboNext.BASE_CLS}-${BI.UUID()}`;\n\n    const selector = `.${cls}`;\n\n    jss.createStyleSheet({\n        '@global': {\n            [`${selector}`]: {\n                opacity,\n                background,\n            },\n            [`${selector} .bi-combo .bi-card`]: {\n                background,\n                color,\n            },\n            [`${selector} .bi-text`]: {\n                color,\n            },\n            [`${selector} .bi-icon-button`]: {\n                color,\n            },\n            [`${selector} .bi-border`]: {\n                border,\n                'boder-radius': borderRadius,\n            },\n        },\n    }).attach();\n\n    return cls;\n}\n\nexport function setComboPopupStyle({ fontSize, itemHeight }: {\n    itemHeight: string;\n    fontSize: string;\n}) {\n    jss.use(jssGlobal(), jssNested());\n\n    const cls = `${ParameterComboNext.BASE_CLS}-${BI.UUID()}`;\n\n    const selector = `.${cls}`;\n\n    jss.createStyleSheet({\n        '@global': {\n            [`${selector} .bi-list-pane .bi-label`]: {\n                'font-size': `${fontSize} !important`,\n            },\n            [`${selector} .bi-v .bi-label`]: {\n                'font-size': `${fontSize} !important`,\n            },\n            [`${selector} .bi-list-pane .bi-tips`]: {\n                'font-size': `${fontSize} !important`,\n                height: `${itemHeight} !important`,\n                'line-height': `${itemHeight} !important`,\n            },\n        },\n    }).attach();\n\n    return cls;\n}\n"]}