{"version":3,"file":"singleselectsearchpopup.js","sourceRoot":"","sources":["../../../../src/modules/combo/singleselectcombo/singleselectsearchpopup.ts"],"names":[],"mappings":"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","sourcesContent":["import { shortcut } from '@engine/core';\nimport { ParameterSingleSelectPopup } from './singleselectpopup';\nimport { COMBO_POPUP_HEIGHT } from './singleselectcombo.constants';\n\n@shortcut()\nexport class ParameterSingleSelectSearchPopup extends ParameterSingleSelectPopup {\n    public static xtype = 'report-single-select-search-popup';\n\n    public props = {\n        itemsCreator: BI.emptyFn as Function,\n        keywordGetter: () => undefined as undefined | string,\n        valueGetter: () => undefined as ({text: string; value: string} | undefined),\n        unmatchedValueGetter: () => [] as {text: string; value: string}[],\n        minWidth: 135,\n        maxHeight: 400,\n        height: undefined,\n        value: undefined as ({text: string; value: string} | undefined),\n        customData: true,\n        allowNoSelect: false,\n        repopulateGetter: () => false,\n        name4EmptyGetter: () => '',\n        itemHeightGetter: () => 24,\n        maxCountGetter: () => 0,\n        popupAdjuster: () => {},\n        tipText: BI.i18nText('BI-No_Selected_Item'),\n    }\n\n    protected transformItems(items: {text: string; value: string, [key: string]: any}[]) {\n        const { valueGetter, unmatchedValueGetter, keywordGetter, customData } = this.options;\n\n        const keyword = keywordGetter() || '';\n\n        const unmatchedValues = <typeof items>unmatchedValueGetter().slice(0);\n\n        let selectedValue = valueGetter();\n\n        items.forEach(item => {\n            let isMatched = false;\n\n            if (BI.isNull(selectedValue)) {\n                isMatched = true;\n            } else {\n                isMatched = selectedValue.text === item.text && selectedValue.value === item.value;\n\n                item.selected = isMatched;\n    \n                if (isMatched) {\n                    selectedValue = undefined;\n                }\n            }\n\n            const unmatchedValueIndex = unmatchedValues.findIndex(value => value.text === item.text && value.value === item.value);\n\n            if (unmatchedValueIndex !== -1) {\n                unmatchedValues.splice(unmatchedValueIndex, 1);\n            }\n        });\n\n        unmatchedValues.forEach(item => {\n            let isMatched = false;\n\n            if (BI.isNull(selectedValue)) {\n                isMatched = true;\n            } else {\n                isMatched = selectedValue.text === item.text && selectedValue.value === item.value;\n\n                item.selected = isMatched;\n    \n                if (isMatched) {\n                    selectedValue = undefined;\n                }\n            }\n        });\n\n        // 剩下的值如果能匹配的肯定不是在数据字典中的，也就是text和item相同的项\n        const { match, find } = <{ match: typeof items, find: typeof items }>BI.Func.getSearchResult(unmatchedValues, keyword, 'value');\n\n        const allItems = find.concat(items, match);\n\n        if (BI.size(allItems) === 0 && customData) {\n            this.addTextBtn.setText(BI.i18nText('BI-Basic_Click_To_Add_Text', keywordGetter()));\n\n            this.addTextBtn.visible();\n        } else {\n            this.addTextBtn.invisible();\n        }\n\n        return match.concat(items, find);\n    }\n\n    protected resizeLayout(items: {text: string; value: string, [key: string]: any}[]) {\n        this.vtapeWrapper.attr('items')[0].height = BI.size(items) !== 0 ? 0 : COMBO_POPUP_HEIGHT;\n\n        this.vtapeWrapper.resize();\n    }\n}\n"]}