{"version":3,"file":"text.js","sourceRoot":"","sources":["../../../src/modules/text/text.ts"],"names":[],"mappings":"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","sourcesContent":["import { WIDTH, HEIGHT } from '../controller.constants';\nimport { validateByCustomRule } from './text.service';\nimport { setEditorStyle, setFontSize, setLineHeight } from '../controller.service';\nimport { shortcut } from '@engine/core';\nimport { ParameterControllerBasicProps4Item, ParameterControllerPropsWithEditor, ParameterControllerBasicProps4Render } from '../controller';\nimport { AbstractParameterControllerWidget, ControllerValidation } from '../controller.abstract';\nimport { TextEditor } from '@fui/core';\n\n@shortcut()\nexport class ParameterText extends AbstractParameterControllerWidget {\n    public static xtype = 'report.main.parameter_container.controller.text';\n\n    private editor: TextEditor;\n    public editComp: TextEditor['element'];\n\n    private value?: string;\n\n    public props: ParamTextProps = {\n        baseCls: 'report-main-parameter-container-controller-text',\n        $testId: 'report-main-parameter-container-controller-text',\n        width: WIDTH,\n        height: HEIGHT,\n        watermark: '',\n        allowBlank: true,\n        errorMsg: BI.i18nText('Fine-Report_Preview_Can_Not_Null'),\n        value: '',\n        regex: '',\n        regErrorMsg: BI.i18nText('Fine-Report_Preview_Input_Error'),\n        fontSize: 12,\n        disabled: false,\n        invisible: false,\n        needSubmit: false,\n        allowBg: true,\n    };\n\n    public render() {\n        const { width, height, value, watermark, fontSize, disabled, allowBg } = this.options;\n\n        const editorCls = setFontSize('report-main-parameter-container-controller-text', fontSize);\n        \n        const editorCls2 = setLineHeight('report-main-parameter-container-controller-text', height);\n\n        this.value = `${value}`;\n\n        return {\n            type: BI.VerticalLayout.xtype,\n            cls: allowBg ? 'bi-card' : '',\n            items: [{\n                type: BI.TextEditor.xtype,\n                cls: `${editorCls} ${editorCls2} bi-border-radius`,\n                ref: (_ref: TextEditor) => {\n                    this.editor = _ref;\n\n                    // 适配外部获取文本控件\n                    this.editComp = _ref.element;\n                },\n                vgap: 0,\n                width,\n                height,\n                disabled,\n                allowBlank: true,\n                value: this.value,\n                watermark,\n                listeners: [{\n                    eventName: BI.TextEditor.EVENT_FOCUS,\n                    action: () => {\n                        !this.silence && this.fireEvent('beforeedit');\n\n                        this.hideBubble();\n                    },\n                }, {\n                    eventName: BI.TextEditor.EVENT_KEY_DOWN,\n                    action: () => {\n                        const result = !this.silence && this.fireEvent('afteredit');\n                        result !== false && this.fireEvent('EVENT_CHANGE', this.editor.getValue());\n                    },\n                }, {\n                    eventName: BI.TextEditor.EVENT_BLUR,\n                    action: () => {\n                        !this.silence && this.fireEvent('stopedit');\n                    },\n                }],\n            }],\n        };\n    }\n\n    // 公开接口\n    public setWaterMark(v: string) {\n        this.editor.setWaterMark(v);\n    }\n\n    public async setControllerValue(v: any, fire?: boolean) {\n        this.editor.setValue(v);\n\n        !this.silence && fire && this.fireEvent('afteredit');\n    }\n\n    private getBasicValidation(value = this.editor.getValue()): ControllerValidation {\n        const { allowBlank, regex, errorMsg, regErrorMsg } = this.options;\n\n        if (BI.isEmptyString(value) && !allowBlank) {\n            return {\n                result: false,\n                errorMsg,\n            };\n        }\n        \n        return validateByCustomRule(value, regex) ? {\n            result: true,\n        } : {\n            result: false,\n            errorMsg: regErrorMsg,\n        };\n    }\n\n    public preGetValidation(): ControllerValidation {\n        return this.getBasicValidation(this.value);\n    }\n\n    public postGetValidation(): ControllerValidation {\n        return this.getBasicValidation();\n    }\n\n    public postValidateAndToast() {\n        const validation = this.getValidation();\n\n        if (validation.result) {\n            return true;\n        }\n\n        this.showBubble(validation.errorMsg);\n\n        return false;\n    }\n\n    public emitManualStopEditEvent() {\n        this.fireEvent('stopedit');\n    }\n\n    public getValue() {\n        return this.editor.getValue();\n    }\n\n    public setInteractValue(v: string) {\n        this.setControllerValue(v);\n    }\n\n    public reset() {\n        this.editor.setValue();\n    }\n\n    public resize(width: number, height: number) {\n        const restoreValue = this.editor.getValue();\n\n        super.resize(width, height);\n\n        this.editor.setValue(restoreValue);\n    }\n\n    public getAdapter() {\n        return this.editor;\n    }\n\n    public focus() {\n        this.editor.focus();\n    }\n\n    public blur(): void {\n        this.editor.blur();\n    }\n\n    public setStyle(styles: Parameters<AbstractParameterControllerWidget['setStyle']>[0]) {\n        this.editor.element.addClass(setEditorStyle(styles));\n    }\n\n    public getText() {\n        return this.editor.getValue();\n    }\n}\n\n\nexport interface ParamTextProps extends Omit<ParameterControllerTextProps4Render4Item, 'value'> {\n    baseCls: string;\n    value: string | number | (string | number)[] | boolean ;\n    $testId: string;\n}\n\n/**\n * 文本框\n */\nexport interface ParameterControllerTextProps4Render4Item extends ParameterControllerBasicProps4Item, ParameterControllerPropsWithEditor {\n    regex: string;\n    regErrorMsg: string;\n}\n\nexport interface ParameterControllerTextProps4Render extends ParameterControllerBasicProps4Render, ParameterControllerTextProps4Render4Item {}\n"]}