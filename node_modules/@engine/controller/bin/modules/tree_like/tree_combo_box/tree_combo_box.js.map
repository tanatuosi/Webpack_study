{"version":3,"file":"tree_combo_box.js","sourceRoot":"","sources":["../../../../src/modules/tree_like/tree_combo_box/tree_combo_box.ts"],"names":[],"mappings":";;;;;;;AAAA,OAAO,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,4BAA4B,CAAC;AAC3D,OAAO,EAAE,gBAAgB,EAAE,MAAM,0BAA0B,CAAC;AAC5D,OAAO,EAAE,0BAA0B,EAAE,wBAAwB,EAAE,yBAAyB,EAAE,MAAM,sBAAsB,CAAC;AACvH,OAAO,EAAE,QAAQ,EAAE,MAAM,cAAc,CAAC;AACxC,OAAO,EAAE,iBAAiB,EAA2C,MAAM,cAAc,CAAC;AAE1F,OAAO,EAAE,4BAA4B,EAAE,0BAA0B,EAAE,4BAA4B,EAAE,MAAM,uBAAuB,CAAC;AAE/H,OAAO,EAAE,oBAAoB,EAAE,MAAM,0BAA0B,CAAC;AAGhE,IAAa,qBAAqB,6BAAlC,MAAa,qBAAsB,SAAQ,iBAAiB;IAA5D;;QAWc,UAAK,GAAyB,EAAE,CAAC;QAEjC,iBAAY,GAA4B,EAAE,CAAC;QAOrD;;WAEG;QACK,4BAAuB,GAAG,IAAI,CAAC;QAEhC,UAAK,GAA4G;YACpH,OAAO,EAAE,GAAG,uBAAqB,CAAC,QAAQ,EAAE;YAC5C,OAAO,EAAE,2DAA2D;YACpE,KAAK,EAAE,KAAK;YACZ,MAAM,EAAE,MAAM;YACd,KAAK,EAAE,EAAE;YACT,SAAS,EAAE,GAAG;YACd,QAAQ,EAAE,KAAK;YACf,SAAS,EAAE,KAAK;YAChB,UAAU,EAAE,IAAI;YAChB,QAAQ,EAAE,EAAE;YACZ,KAAK,EAAE,KAAK;YACZ,aAAa,EAAE,KAAK;YACpB,cAAc,EAAE,KAAK;YACrB,cAAc,EAAE,KAAK;YACrB,UAAU,EAAE,EAAE;YACd,SAAS,EAAE,EAAE;YACb,UAAU,EAAE,IAAI;YAChB,UAAU,EAAE,KAAK;YACjB,QAAQ,EAAE,EAAE,CAAC,QAAQ,CAAC,kCAAkC,CAAC;YACzD,UAAU,EAAE,KAAK;YACjB,QAAQ,EAAE,KAAK;YACf,QAAQ,EAAE,KAAK;YACf,IAAI,EAAE,QAAQ;YACd,UAAU,EAAE,GAAG;YACf,iBAAiB,EAAE,IAAI;YACvB,WAAW,EAAE;gBACT,IAAI,EAAE,CAAC;wBACH,UAAU,EAAE,EAAE;wBACd,QAAQ,EAAE,KAAK;wBACf,WAAW,EAAE,KAAK;wBAClB,EAAE,EAAE,CAAC;wBACL,IAAI,EAAE,EAAE;wBACR,SAAS,EAAE,KAAK;wBAChB,QAAQ,EAAE,IAAI;wBACd,KAAK,EAAE,EAAE;wBACT,UAAU,EAAE,CAAC;qBAChB,CAAC;gBACF,KAAK,EAAE,EAAE;aACZ;YACD,YAAY,EAAE,KAAK;YACnB,qBAAqB,EAAE,GAAG,EAAE,CAAC,EAAE;YAC/B,gCAAgC,EAAE,GAAG,EAAE;gBACnC,OAAO,EAAE,CAAC;YACd,CAAC;YACD,gBAAgB,EAAE,GAAG,EAAE,CAAC,EAAE;YAC1B,sBAAsB,EAAE,GAAG,EAAE,GAAE,CAAC;YAChC,eAAe,EAAE,GAAG,EAAE;gBAClB,OAAO,EAAE,CAAC;YACd,CAAC;YACD,yBAAyB,EAAE,4BAA4B;YACvD,yBAAyB,EAAE,4BAA4B;YACvD,uBAAuB,EAAE,0BAA0B;YACnD,OAAO,EAAE,IAAI;YACb,mBAAmB,EAAE,IAAI;YACzB,WAAW,EAAE,IAAI;YACjB,WAAW,EAAE,EAAE;YACf,SAAS,EAAE,EAAE;SAChB,CAAC;IA2RN,CAAC;IAzWa,YAAY;QAClB,OAAO,KAAK,CAAC;IACjB,CAAC;IAiFM,MAAM;QACT,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,QAAQ,EAAE,aAAa,EAAE,cAAc,EAAE,cAAc,EAAE,SAAS,EAAE,WAAW,EAAE,KAAK,EAAE,UAAU,EAAE,UAAU,EAAE,iBAAiB,EAAE,sBAAsB,EAAE,gBAAgB,EAAE,OAAO,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC;QAE7N,IAAI,CAAC,4BAA4B,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QAEpD,IAAI,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;YACtB,IAAI,CAAC,2BAA2B,CAAC,KAAK,CAAC,CAAC;SAC3C;QAED,OAAO;YACH,IAAI,EAAE,EAAE,CAAC,cAAc,CAAC,KAAK;YAC7B,GAAG,EAAE,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE;YAC7B,KAAK,EAAE,+BACH,IAAI,EAAE,0BAA0B,CAAC,cAAc,EAAE,cAAc,EAAE,IAAI,CAAC,WAAW,EAAE,EAAE,UAAU,CAAC,IAE7F,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,KAC7C,WAAW,EAAE,IAAI,CAAC,OAAO,CAAC,SAAS,EACnC,SAAS,EACT,gBAAgB,EAAE,UAAU,EAC5B,GAAG,EAAE,GAAG,gBAAgB,CAAC,uBAAqB,CAAC,QAAQ,EAAE;wBACrD,QAAQ,EAAE,KAAK,EAAE,MAAM;qBAC1B,CAAC,EAAE,EACJ,iBAAiB;oBACjB,KAAK;oBACL,MAAM,EACN,SAAS,EAAE,UAAU,EACrB,gBAAgB,EAAE,UAAU,EAC5B,GAAG,EAAE,CAAC,IAAS,EAAE,EAAE;wBACf,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;oBACrB,CAAC,EACD,cAAc,EAAE,CAAC,CAAS,EAAE,EAAE;wBAC1B,IAAI,CAAC,KAAK,IAAI,CAAC,0BAA0B,EAAE;4BACvC,OAAO,EAAE,CAAC;yBACb;wBAED,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC;wBAEvD,oDAAoD;wBACpD,IAAI,IAAI,CAAC,IAAI,CAAC,uBAAuB,GAAG,KAAK,CAAC,CAAC;wBAE/C,OAAO,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,IAAI,KAAI,wBAAwB,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;oBACvE,CAAC,EACD,YAAY,EAAE,EAAE,EAChB,UAAU,EAAE,IAAI,EAChB,YAAY,EAAE,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,KAAK,EACpC,EAAO,EACP,QAAoH,EACtH,EAAE;wBACA,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;wBAE3C,MAAM,IAAI,GAAG,cAAc,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,yBAAyB,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,0BAA0B,CAAC,EAAE,CAAC,CAAC;wBAEnH,IAAI,CAAC,2BAA2B,CAAE,IAGhC,CAAC,KAAK,CAAC,CAAC;wBAEV,QAAQ,CAAC,IAAI,CAAC,CAAC;oBACnB,CAAC,CAAC,CAAC,CAAC,SAAS,EACb,KAAK,EAAE,IAAI,CAAC,gBAAgB,EAC5B,SAAS,EAAE,CAAC;4BACR,SAAS,EAAE,kBAAkB;4BAC7B,MAAM,EAAE,CAAC,KAA0B,EAAE,EAAE;gCACnC,IAAI,CAAC,UAAU,EAAE,CAAC;gCAElB;;;;mCAIG;gCACH,MAAM,EAAE,GAAG,gBAAgB,EAAE,CAAC;gCAC9B,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,KAAK,CAAC;qCAC9B,IAAI,CAAC,GAAG,EAAE;oCACP,sBAAsB,CAAC,EAAE,CAAC,CAAC;oCAE3B,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;oCACzC,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;gCACjD,CAAC,CAAC,CAAC;4BACX,CAAC;yBACJ,EAAE;4BACC,SAAS,EAAE,eAAe;4BAC1B,MAAM,EAAE,GAAG,EAAE;gCACT,MAAM,EAAE,GAAG,gBAAgB,EAAE,CAAC;gCAE9B,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC;qCACjC,IAAI,CAAC,GAAG,EAAE;oCACP,sBAAsB,CAAC,EAAE,CAAC,CAAC;oCAE3B,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;gCAChD,CAAC,CAAC,CAAC;4BACX,CAAC;yBACJ,EAAE;4BACC,SAAS,EAAE,cAAc;4BACzB,MAAM,EAAE,GAAG,EAAE;gCACT,MAAM,EAAE,GAAG,gBAAgB,EAAE,CAAC;gCAE9B,UAAU;gCACV,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC;qCACjC,IAAI,CAAC,GAAG,EAAE;oCACP,IAAI,CAAC,cAAc,EAAE;wCACjB,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;wCACzC,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;qCAChD;oCAED,sBAAsB,CAAC,EAAE,CAAC,CAAC;oCAE3B,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;gCAChD,CAAC,CAAC,CAAC;4BACX,CAAC;yBACJ,EAAE;4BACC,SAAS,EAAE,aAAa;4BACxB,MAAM,EAAE,GAAG,EAAE;gCACT,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;4BAClD,CAAC;yBACJ,EAAE;4BACC,SAAS,EAAE,wBAAwB;4BACnC,MAAM,EAAE,GAAG,EAAE;gCACT,IAAI,CAAC,UAAU,EAAE,CAAC;4BACtB,CAAC;yBACJ,EAAE;4BACC,SAAS,EAAE,iBAAiB;4BAC5B,MAAM,EAAE,GAAG,EAAE;gCACT,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;4BACjD,CAAC;yBACJ,CAAC,IACJ;SACL,CAAC;IACN,CAAC;IAEM,KAAK,CAAC,OAAO;QAChB,KAAK,CAAC,OAAO,EAAE,CAAC;QAEhB,MAAM,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC;QAE1D;;;;;;WAMG;QACH,IAAI,CAAC,IAAI,CAAC,uBAAuB,IAAI,IAAI,CAAC,WAAW,EAAE,EAAE;YACrD,gBAAgB;YAChB,MAAM,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACrD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACzC,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC;SACvC;QAED,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC;IAC9B,CAAC;IAEM,uBAAuB;QAC1B,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;IAC/B,CAAC;IAED;;;OAGG;IACK,kBAAkB,CAAC,CAA2D;QAClF,IAAI,CAAC,gBAAgB,GAAG,yBAAyB,CAC7C,CAAC,EACD,IAAI,CAAC,OAAO,CAAC,aAAa,EAC1B,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE;YACzB,YAAY,EAAE,IAAI,CAAC,YAAY;YAC/B,KAAK,EAAE,IAAI,CAAC,KAAK;SACpB,CAAC,CAAC;QAEP,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC;IACvC,CAAC;IAED;;;OAGG;IACK,8BAA8B,CAAC,gBAAqB;QACxD,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,IAAI,gBAAgB,IAAI,IAAI,CAAC,6BAA6B,CAAC,gBAAgB,CAAC,CAAC;IAC5G,CAAC;IAED;;;OAGG;IACK,2BAA2B,CAAC,CAA2D;QAC3F,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;QAE3B;;;WAGG;QACH,IAAI,CAAC,8BAA8B,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;IAC/D,CAAC;IAEM,KAAK,CAAC,gBAAgB,CAAC,CAAkE;QAC5F;;WAEG;QACH,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;QAEjC,MAAM,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC;QAEhC;;WAEG;QACH,IAAI,CAAC,8BAA8B,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAE3D,IAAI,CAAC,UAAU,EAAE,CAAC;IACtB,CAAC;IAEM,iBAAiB;QACpB,IAAI,CAAC,KAAK,EAAE,CAAC;QAEb,IAAI,CAAC,UAAU,EAAE,CAAC;IACtB,CAAC;IAEM,UAAU;QACb,IAAI,CAAC,YAAY,EAAE,CAAC;QAEpB,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC/B,CAAC;IAEM,KAAK,CAAC,kBAAkB,CAAC,CAAS,EAAE,OAAiD,EAAE;QAC1F,MAAM,KAAK,CAAC,kBAAkB,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;QAExC,IAAI,CAAC,UAAU,EAAE,CAAC;IACtB,CAAC;IAED;;OAEG;IACK,mBAAmB;QACvB,IAAI,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE;YACnD,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;SACxB;IACL,CAAC;IAEO,KAAK,CAAC,YAAY;QACtB,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,MAAM,IAAI,CAAC,mBAAmB,EAAE;aAClD,IAAI,CAAC,IAAI,CAAC,EAAE;YACT,CAAC,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;YAE3C,IAAI,CAAC,2BAA2B,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAE7C,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAE/B,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC5D,CAAC,CAAC,CAAC;IACX,CAAC;IAEM,UAAU;QACb,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;IACnC,CAAC;IAEM,QAAQ,CAAC,MAAoE;QAChF,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC;IAC7D,CAAC;IAEM,aAAa,KAAI,CAAC;IAElB,OAAO;;QACV,OAAO,MAAA,MAAA,IAAI,CAAC,UAAU,EAAE,0CAAE,MAAM,0CAAE,OAAO,EAAE,CAAC;IAChD,CAAC;IAEM,YAAY,CAAC,CAAS;QACzB,IAAI,CAAC,OAAO,CAAC,SAAS,GAAG,CAAC,CAAC;QAE3B,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;QAE1B,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC7C,CAAC;IAEM,KAAK;QACR,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;IACtB,CAAC;IAEM,IAAI;QACP,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;IACrB,CAAC;CACJ,CAAA;AA7WiB,2BAAK,GAAG,kEAAkE,CAAC;AAE3E,8BAAQ,GAAG,2DAA2D,CAAC;AAH5E,qBAAqB;IADjC,QAAQ,EAAE;GACE,qBAAqB,CA8WjC;SA9WY,qBAAqB","sourcesContent":["import { WIDTH, HEIGHT } from '../../controller.constants';\nimport { setComboFontSize } from '../../controller.service';\nimport { getParamTreeComboBoxLayout, getSingleTreeTextByValue, transformTreeDefaultValue } from '../tree_like.service';\nimport { shortcut } from '@engine/core';\nimport { ParameterTreeLike, ParamMultiTreeValue, ParamMultiTreeItem } from '../tree_like';\nimport { ParameterControllerBasicProps4Item, ParameterControllerPropsWithTree, ParameterControllerBasicProps4Render, ParameterControllerPropsWithEditor, ParameterControllerPropsWithCombo, ParameterControllerForm, ParameterControllerDelayer, ParameterControllerTreeControlAttrData } from '../../controller';\nimport { fetchNewParamTreeControlAttr, fetchNewParamTreeStructure, fetchOldParamTreeControlAttr } from '../../controller.crud';\nimport { AbstractParameterControllerWidget } from '../../controller.abstract';\nimport { setTreeComboBoxStyle } from './tree_combo_box.service';\n\n@shortcut()\nexport class ParameterTreeComboBox extends ParameterTreeLike {\n    public static xtype = 'report.main.parameter_container.controller.editor.tree_combo_box';\n\n    public static BASE_CLS = 'report-main-parameter-container-controller-tree-combo-box';\n\n    protected isTreeWidget() {\n        return false;\n    }\n\n    protected tree: any;\n\n    protected nodes: ParamMultiTreeItem[] = [];\n\n    protected textValueMap: {[key: string]: string} = {};\n\n    /**\n     * 转换后的初始值\n     */\n    private defaultTreeValue: any;\n    \n    /**\n     * 用来判断数据字典是否能够完全支撑的起默认值\n     */\n    private isTreeShowValueComplete = true;\n\n    public props: ParameterControllerTreeComboBoxProps4RenderProps & ParameterControllerForm & ParameterControllerDelayer = {\n        baseCls: `${ParameterTreeComboBox.BASE_CLS}`,\n        $testId: 'report-main-parameter-container-controller-tree-combo-box',\n        width: WIDTH,\n        height: HEIGHT,\n        value: '',\n        delimiter: ';',\n        disabled: false,\n        invisible: false,\n        needSubmit: true,\n        fontSize: 12,\n        async: false,\n        mutiSelection: false,\n        returnFullPath: false,\n        selectLeafOnly: false,\n        widgetName: '',\n        watermark: '',\n        allowBlank: true,\n        customData: false,\n        errorMsg: BI.i18nText('Fine-Report_Preview_Can_Not_Null'),\n        directEdit: false,\n        noRepeat: false,\n        autoMode: false,\n        mode: 'remote',\n        searchTime: 200,\n        isNeedAdjustWidth: true,\n        controlAttr: {\n            data: [{\n                ChildNodes: [],\n                isexpand: false,\n                hasChildren: false,\n                id: 1,\n                text: '',\n                showcheck: false,\n                complete: true,\n                value: '',\n                checkstate: 0,\n            }],\n            value: '',\n        },\n        isLayerBuild: false,\n        getDependenceByWidget: () => [],\n        getWidgetDependenceValueByWidget: () => {\n            return {};\n        },\n        add2WaitingQueue: () => '',\n        removeFromWaitingQueue: () => {},\n        extraOptsGetter: () => {\n            return {};\n        },\n        oldTreeControlAttrFetcher: fetchOldParamTreeControlAttr,\n        newTreeControlAttrFetcher: fetchNewParamTreeControlAttr,\n        newTreeStructureFetcher: fetchNewParamTreeStructure,\n        allowBg: true,\n        needCheckCustomData: true,\n        returnArray: true,\n        startSymbol: '',\n        endSymbol: '',\n    };\n\n    // 完整的多选树值\n    protected completeMultiTreeValue: ParamMultiTreeValue;\n\n    public render() {\n        const { width, height, fontSize, mutiSelection: multiSelection, selectLeafOnly, watermark, controlAttr, value, customData, directEdit, isNeedAdjustWidth, removeFromWaitingQueue, add2WaitingQueue, allowBg } = this.options;\n\n        this.updateCacheByControlAttrData(controlAttr.data);\n\n        if (BI.isNull(this.tree)) {\n            this.transformInteractValue2Node(value);\n        }\n\n        return {\n            type: BI.VerticalLayout.xtype,\n            cls: allowBg ? 'bi-card' : '',\n            items: [{\n                type: getParamTreeComboBoxLayout(multiSelection, selectLeafOnly, this.isAsyncTree(), customData),\n                // 当不传watermark时，engine因为不要默认无限制的样式，所以传text配置进去\n                ...this.options.watermark ? {} : { text: '' },\n                defaultText: this.options.watermark,\n                watermark,\n                allowSearchValue: directEdit,\n                cls: `${setComboFontSize(ParameterTreeComboBox.BASE_CLS, {\n                    fontSize, width, height,\n                })}`,\n                isNeedAdjustWidth,\n                width,\n                height,\n                allowEdit: directEdit,\n                allowInsertValue: customData,\n                ref: (_ref: any) => {\n                    this.tree = _ref;\n                },\n                valueFormatter: (v: string) => {\n                    if (v === this.singleTreeNotSelectedValue) {\n                        return '';\n                    }\n\n                    const node = this.nodes.find(node => node.value === v);\n\n                    // 如果存在显示值不存在的node，那么就说明nodes列表中数据不全，需要在mounted中尝试补全\n                    node || (this.isTreeShowValueComplete = false);\n    \n                    return node?.text || getSingleTreeTextByValue(v, this.nodes) || '';\n                },\n                warningTitle: '',\n                belowMouse: true,\n                itemsCreator: this.isAsyncTree() ? async (\n                    op: any,\n                    callback: (data: {items: ParamMultiTreeItem[], hasNext: boolean, resultType?: string} | ParamMultiTreeValue) => void,\n                ) => {\n                    !this.silence && this.fireEvent('nodeadd');\n    \n                    const data = multiSelection ? await this.multiAsyncTreeItemCreator(op) : await this.singleAsyncTreeItemCreator(op);\n    \n                    this.transformSyncSingleTreeItem((data as {\n                        items: ParamMultiTreeItem[];\n                        hasNext: boolean;\n                    }).items);\n    \n                    callback(data);\n                } : undefined,\n                value: this.defaultTreeValue,\n                listeners: [{\n                    eventName: 'EVENT_CLICK_ITEM',\n                    action: (value: ParamMultiTreeValue) => {\n                        this.hideBubble();\n                        \n                        /**\n                         * 修正 https://work.fineres.com/browse/REPORT-80452 引入\n                         * 为了应对触发afteredit事件后立马调用getValue获取控件值的场景\n                         * 在之前这里触发的afteredit事件取getValue是取不到正确结果的\n                         */\n                        const id = add2WaitingQueue();\n                        this.rebuildMultiTree(value, false)\n                            .then(() => {\n                                removeFromWaitingQueue(id);\n                                \n                                !this.silence && this.fireEvent('click');\n                                !this.silence && this.fireEvent('afteredit');\n                            });\n                    },\n                }, {\n                    eventName: 'EVENT_CONFIRM',\n                    action: () => {\n                        const id = add2WaitingQueue();\n\n                        this.rebuildMultiTree(undefined, true)\n                            .then(() => {\n                                removeFromWaitingQueue(id);\n\n                                !this.silence && this.fireEvent('stopedit');\n                            });\n                    },\n                }, {\n                    eventName: 'EVENT_CHANGE',\n                    action: () => {\n                        const id = add2WaitingQueue();\n    \n                        // 单选树处理方法\n                        this.rebuildMultiTree(undefined, true)\n                            .then(() => {\n                                if (!multiSelection) {\n                                    !this.silence && this.fireEvent('click');\n                                    !this.silence && this.fireEvent('afteredit');\n                                }\n            \n                                removeFromWaitingQueue(id);\n\n                                !this.silence && this.fireEvent('stopedit');\n                            });\n                    },\n                }, {\n                    eventName: 'EVENT_FOCUS',\n                    action: () => {\n                        !this.silence && this.fireEvent('beforeedit');\n                    },\n                }, {\n                    eventName: 'EVENT_BEFORE_POPUPVIEW',\n                    action: () => {\n                        this.hideBubble();\n                    },\n                }, {\n                    eventName: 'EVENT_SEARCHING',\n                    action: () => {\n                        !this.silence && this.fireEvent('afteredit');\n                    },\n                }],\n            }],\n        };\n    }\n\n    public async mounted() {\n        super.mounted();\n\n        await this.rebuildMultiTree(this.defaultTreeValue, false);\n\n        /**\n         * 修正 https://work.fineres.com/browse/REPORT-78566 引入\n         * 为了应对给异步树设置默认值时，nodes数据中还没有该默认值的问题\n         *   换一种方法实现，如果定义了返回值类型为Promise的beforeRender会把后续的render打入微任务队列中\n         *   在不需要点击查询就直接显示报表内容的场景取控件值会有问题\n         * TODO: 因为render的时候传了value，此处如果重新设置值会出现值闪一下才能变成正确的显示值\n         */\n        if (!this.isTreeShowValueComplete && this.isAsyncTree()) {\n            /** 给resize铺路 */\n            await this.updateCacheByValue(this.defaultTreeValue);\n            this.setTreeValue(this.defaultTreeValue);\n            this.isTreeShowValueComplete = true;\n        }\n\n        await this.loadSyncTree();\n    }\n\n    public emitManualStopEditEvent() {\n        this.fireEvent('stopedit');\n    }\n\n    /**\n     * 更新默认值\n     * @param v 值\n     */\n    private updateDefaultValue(v: (string | number)[] | string | undefined | null | number) {\n        this.defaultTreeValue = transformTreeDefaultValue(\n            v,\n            this.options.mutiSelection,\n            this.options.selectLeafOnly, {\n                textValueMap: this.textValueMap,\n                nodes: this.nodes,\n            });\n        \n        this.value = this.defaultTreeValue;\n    }\n\n    /**\n     * 对单选树,将默认值添加到节点中\n     * @param defaultTreeValue\n     */\n    private addDefaultValue2SingleTreeNode(defaultTreeValue: any) {\n        !this.options.mutiSelection && defaultTreeValue && this.transformSingleTreeValue2Node(defaultTreeValue);\n    }\n\n    /**\n     * 将传入组件的值(设置的默认值或者是联动设置的值)作为默认值并且更新，同时新增节点\n     * @param v\n     */\n    private transformInteractValue2Node(v: (string | number)[] | string | undefined | null | number) {\n        this.updateDefaultValue(v);\n\n        /**\n         * 这里是对应一个功能\n         * 如果是单选树，且该值不存在于树节点时，那么需要给被联动的树新增一个节点\n         */\n        this.addDefaultValue2SingleTreeNode(this.defaultTreeValue);\n    }\n\n    public async setInteractValue(v: ParameterControllerTreeComboBoxProps4RenderProps['controlAttr']) {\n        /**\n         * 在设置联动值之前，先更新一下defaultValue，确保树控件更新前状态都是新的\n         */\n        this.updateDefaultValue(v.value);\n\n        await super.setInteractValue(v);\n\n        /**\n         * 如果是单选树，异步情况下当控件值都已经加载完毕之后在决定是否追加node\n         */\n        this.addDefaultValue2SingleTreeNode(this.defaultTreeValue);\n\n        this.reloadTree();\n    }\n\n    public reloadControlAttr() {\n        this.reset();\n\n        this.reloadTree();\n    }\n\n    public reloadTree() {\n        this.loadSyncTree();\n\n        this.loadAsyncSingleTree();\n    }\n\n    public async setControllerValue(v: string, data: ParameterControllerTreeControlAttrData[] = []) {\n        await super.setControllerValue(v, data);\n\n        this.reloadTree();\n    }\n\n    /**\n     * REPORT-35261 单选异步树联动后需要刷新树\n     */\n    private loadAsyncSingleTree() {\n        if (this.isAsyncTree() && !this.options.mutiSelection) {\n            this.tree.populate();\n        }\n    }\n\n    private async loadSyncTree() {\n        !this.isAsyncTree() && await this.syncTreeItemCreator()\n            .then(data => {\n                !this.silence && this.fireEvent('nodeadd');\n\n                this.transformSyncSingleTreeItem(data.items);\n\n                this.tree.populate(data.items);\n\n                this.tree.setValue(this.value || this.defaultTreeValue);\n            });\n    }\n\n    public getAdapter() {\n        return this.tree.getSearcher();\n    }\n\n    public setStyle(styles: Parameters<AbstractParameterControllerWidget['setStyle']>[0]) {\n        this.tree.element.addClass(setTreeComboBoxStyle(styles));\n    }\n\n    public setPopupStyle() {}\n\n    public getText() {\n        return this.getAdapter()?.editor?.getText();\n    }\n\n    public setWaterMark(v: string) {\n        this.options.watermark = v;\n\n        this.tree.setWaterMark(v);\n\n        this.tree.setValue(this.tree.getValue());\n    }\n\n    public focus () {\n        this.tree.focus();\n    }\n\n    public blur () {\n        this.tree.blur();\n    }\n}\n\n\n/**\n * 下拉树结构\n */\nexport interface ParameterControllerTreeComboBoxProps4Render4Item extends ParameterControllerBasicProps4Item, ParameterControllerPropsWithEditor, Omit<ParameterControllerPropsWithCombo, 'controlAttr'>, ParameterControllerPropsWithTree {\n    $testId: string;\n\n    /**\n     * 是否校验自定义值\n     */\n    needCheckCustomData: boolean;\n}\n\nexport interface ParameterControllerTreeComboBoxProps4Render extends ParameterControllerBasicProps4Render, ParameterControllerTreeComboBoxProps4Render4Item {}\n\nexport interface ParameterControllerTreeComboBoxProps4RenderProps extends Omit<ParameterControllerTreeComboBoxProps4Render4Item, 'value'> {\n    baseCls: string;\n    value: (string | number)[] | string | undefined | null | number;\n    isNeedAdjustWidth: boolean;\n}\n"]}