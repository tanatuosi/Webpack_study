{"version":3,"file":"multifile.js","sourceRoot":"","sources":["../../../src/modules/multifile/multifile.ts"],"names":[],"mappings":"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","sourcesContent":["import { AbstractParameterControllerWidget, ControllerValidation } from '../controller.abstract';\nimport { shortcut } from '@engine/core';\nimport { ParameterControllerBasicProps4Render, ParameterControllerBasicProps4Item } from '../controller';\nimport './multifile.less';\nimport { setFontSize } from '../controller.service';\nimport { deleteFile, downloadFile } from '../controller.crud';\nimport { AbsoluteLayout, BubbleCombo, Button, ButtonGroup, Combo, Label, MultifileEditor } from '@fui/core';\nimport { completeUrl } from '@engine/crud';\nimport { ParameterMultifileProgressPane } from './progress_pane/multifile.progress_pane';\n\nconst DEFAULT_SIZE = 32, DEFAULT_LABEL_SIZE = 20, DEFAULT_FONT_SIZE = 12;\n\n@shortcut()\nexport class ParameterMultifile extends AbstractParameterControllerWidget {\n    public static xtype = 'report.main.parameter_container.controller.multifile';\n\n    private label: Label;\n\n    private multifileEditor: MultifileEditor;\n\n    private wrapper: AbsoluteLayout;\n\n    private button: Button;\n\n    private uploadFileGroup: ButtonGroup;\n\n    private uploadFiles: File[] = [];\n\n    private canUpload = true;\n\n    private bubbleCombo: BubbleCombo;\n\n    private progressCombo: Combo;\n\n    public props: ParamMultifileProps = {\n        baseCls: 'report-main-parameter-container-controller-multifile',\n        disabled: false,\n        invisible: false,\n        needSubmit: false,\n        fontSize: 12,\n        value: '0',\n        width: 80,\n        height: 50,\n        accept: '',\n        maxlength: Infinity,\n        maxSize: -1, // -1代表大小不限制\n        url: 'attachment/upload',\n        allowBg: true,\n    }\n\n    public render() {\n        const { accept, width, height, maxSize, value, maxlength, url } = this.options;\n        const fileAccept = accept ? accept.split('|')\n            .map(item => `.${item}`)\n            .join(',') : '';\n        const position = this.calculatePosotion(width, height);\n\n        return {\n            type: BI.AbsoluteLayout.xtype,\n            ref: (_ref: AbsoluteLayout) => {\n                this.wrapper = _ref;\n            },\n            items: [{\n                el: {\n                    type: BI.Label.xtype,\n                    cls: `count-label ${setFontSize('count-label', position.label.fontSize)}`,\n                    ref: (_ref: Label) => {\n                        this.label = _ref;\n                    },\n                    text: value,\n                    width: position.label.width,\n                    height: position.label.height,\n                },\n                left: position.label.left,\n                top: position.label.top,\n            }, {\n                el: {\n                    type: BI.BubbleCombo.xtype,\n                    ref: (ref: BubbleCombo) => {\n                        this.bubbleCombo = ref;\n                    },\n                    trigger: 'hover',\n                    offsetStyle: 'right',\n                    isNeedAdjustHeight: true,\n                    isDefaultInit: true,\n                    el: {\n                        type: BI.IconButton.xtype,\n                        ref: (_ref: Button) => {\n                            this.button = _ref;\n                        },\n                        cls: 'upload-trigger-background',\n                        width: position.button.width,\n                        height: position.button.height,\n                        title: () => this.getMultifileEditorValue()\n                            .map(({ filename }) => filename)\n                            .join('\\n'),\n                        handler: () => {\n                            if (!this.canUpload) {\n                                return;\n                            }\n                            this.multifileEditor.select();\n                        },\n                    },\n                    popup: {\n                        el: {\n                            type: BI.ButtonGroup.xtype,\n                            ref: (_ref: ButtonGroup) => {\n                                this.uploadFileGroup = _ref;\n                            },\n                            layouts: [{\n                                type: BI.VerticalLayout.xtype,\n                                minHeight: 0,\n                            }],\n                            items: [],\n                        },\n                        minWidth: 200,\n                        minHeight: 0,\n                        maxHeight: 200,\n                    },\n\n                },\n                left: position.button.left,\n                top: position.button.top,\n            }, {\n                el: {\n                    type: BI.Combo.xtype,\n                    ref: (ref: Combo) => {\n                        this.progressCombo = ref;\n                    },\n                    hideWhenBlur: false,\n                    trigger: '',\n                    destroyWhenHide: true,\n                    belowMouse: true,\n                    offsetStyle: 'left',\n                    isNeedAdjustHeight: true,\n                    el: {\n                        type: BI.Layout.xtype,\n                    },\n                    popup: {\n                        el: {\n                            type: ParameterMultifileProgressPane.xtype,\n                            queueGetter: () => this.multifileEditor.getQueue()\n                                .map(({ fileName }) => fileName),\n                            uploadedGetter: () => this.getMultifileEditorValue()\n                                .map(({ filename }) => filename),\n                        },\n                        minWidth: 350,\n                        minHeight: 200,\n                    },\n\n                },\n                left: position.button.left,\n                top: position.button.top,\n            }, {\n                el: {\n                    type: BI.MultifileEditor.xtype,\n                    ref: (_ref: MultifileEditor) => {\n                        this.multifileEditor = _ref;\n                    },\n                    url: completeUrl(url),\n                    accept: fileAccept,\n                    width,\n                    height,\n                    // REPORT-70632 options的 maxSize 单位固定为KB，fineUi的 maxSize 单位为B，需要转换一下\n                    maxSize: maxSize * 1024,\n                    multiple: maxlength !== 1,\n                    listeners: [{\n                        eventName: BI.MultifileEditor.EVENT_CHANGE,\n                        action: () => {\n                            this.multifileEditor.upload();\n                        },\n                    }, {\n                        eventName: BI.MultifileEditor.EVENT_UPLOADSTART,\n                        action: () => {\n                            this.progressCombo.showView();\n\n                            // BI-20417 windows下打开资源管理器可能title一直不消失\n                            BI.Tooltips.remove(this.multifileEditor.getName());\n                            this.canUpload = false;\n                        },\n                    }, {\n                        eventName: BI.MultifileEditor.EVENT_UPLOADED,\n                        action: async () => {\n                            this.resetState();\n\n                            const extraFile = this.uploadFiles.length - this.options.maxlength;\n\n                            if (this.options.maxlength !== Infinity && extraFile > 0) {\n                                for (let i = 0; i < extraFile; i++) {\n                                    await this.deleteFile(this.uploadFiles[i].attach_id);\n                                }\n                            }\n\n                            !this.silence && this.fireEvent('callback');\n                            this.fireEvent('EVENT_CHANGE');\n                        },\n                    }, {\n                        eventName: BI.MultifileEditor.EVENT_ERROR,\n                        action: (err: {\n                            errorType: number;\n                            file: {\n                                name:string\n                            }\n                        }) => {\n                            this.resetState();\n\n                            !this.silence && this.fireEvent('callback');\n                            this.fireEvent('EVENT_CHANGE');\n\n                            if (BI.isEmptyString(accept)) {\n                                return;\n                            }\n                            \n                            const { name } = err.file;\n\n                            if (err.errorType === 0) {\n                                const fileType = name.split('.').pop();\n                                BI.Msg.toast(BI.i18nText('Fine-Report_File_Type_Error', fileType, accept), { level: 'error' });\n                            }\n\n                            if (err.errorType === 1) {\n                                BI.Msg.toast(BI.i18nText('Fine-Report_File_TOO_LARGE', name, `${maxSize}KB`), { level: 'error' });\n                            }\n                        },\n                    }, {\n                        eventName: BI.MultifileEditor.EVENT_PROGRESS,\n                        action: (progress: {loaded: number, total: number}) => {\n                            this.progressCombo.isViewVisible() && this.progressCombo.setValue(progress.loaded / progress.total);\n                        },\n                    }],\n                },\n                top: 0,\n                left: 0,\n            }],\n        };\n    }\n\n    private resetState() {\n        this.label.setText(`${this.getMultifileEditorValue().length}`);\n\n        this.uploadFiles = [\n            ...this.uploadFiles,\n            ...this.getMultifileEditorValue(),\n        ];\n        \n        this.hideProgressComboView();\n        this.renderUploadFiles();\n        this.multifileEditor.reset();\n        this.canUpload = true;\n    }\n\n    public beforeMount() {\n        this.multifileEditor.element.on('dragover', (e: DragEvent) => {\n            e.preventDefault();\n        });\n        this.multifileEditor.element.on('drop', (e: Event & { originalEvent: DragEvent }) => {\n            e.preventDefault();\n\n            const files = e.originalEvent.dataTransfer?.files;\n\n            if (!files) return;\n\n            this.multifileEditor.sendFiles(files);\n        });\n    }\n\n    private hideProgressComboView() {\n        setTimeout(() => {\n            this.progressCombo.hideView();\n\n            this.bubbleCombo.showView();\n        }, 1000);\n    }\n\n    private renderUploadFiles() {\n        const files = this.uploadFiles;\n        this.label.setText(`${files.length}`);\n        this.uploadFileGroup?.populate(files.map(file => {\n            return {\n                type: BI.LeftRightVerticalAdaptLayout.xtype,\n                cls: 'bi-list-item-active cursor-pointer',\n                height: 25,\n                items: {\n                    left: [{\n                        type: BI.TextButton.xtype,\n                        width: 150,\n                        hgap: 3,\n                        textAlign: 'left',\n                        value: file.filename,\n                        title: file.filename,\n                        handler: () => {\n                            this.downloadFile(file.attach_id);\n                        },\n                    }],\n                    right: [{\n                        type: BI.IconButton.xtype,\n                        width: 25,\n                        cls: 'delete-font',\n                        handler: async () => {\n                            await this.deleteFile(file.attach_id);\n\n                            this.fireEvent('EVENT_CHANGE');\n                        },\n                    }],\n                },\n            };\n        }));\n    }\n\n    private async deleteFile(fileId: string) {\n        await deleteFile(fileId);\n        this.uploadFiles = this.uploadFiles.filter(item => item.attach_id !== fileId);\n        this.renderUploadFiles();\n    }\n\n    private downloadFile(fileId: string) {\n        downloadFile(fileId);\n    }\n\n    public getUploadFiles() {\n        return this.uploadFiles;\n    }\n\n    public preGetValidation(): ControllerValidation {\n        return {\n            result: true,\n        };\n    }\n\n    public postGetValidation(): ControllerValidation {\n        return { result: true };\n    }\n\n    public postValidateAndToast() {\n        return true;\n    }\n\n    public reset() {}\n\n    public setInteractValue() {}\n\n    public async setControllerValue() {}\n\n    public getValue() {\n        return this.uploadFiles;\n    }\n\n    private getMultifileEditorValue() {\n        return this.multifileEditor.getValue()\n            .filter(({ attach_id }) => attach_id);\n    }\n\n    private calculatePosotion(width: number, height: number) {\n        const $width = Math.min(width, DEFAULT_SIZE);\n\n        const $height = Math.min(height, DEFAULT_SIZE);\n\n        const labelSize = DEFAULT_LABEL_SIZE / DEFAULT_SIZE * $width;\n\n        return {\n            label: {\n                width: labelSize,\n                height: labelSize,\n                fontSize: DEFAULT_FONT_SIZE / DEFAULT_SIZE * $width,\n                left:(width + $width) / 2,\n                top: (height - $height) / 2,\n            },\n            button: {\n                width: $width,\n                height: $height,\n                left: (width - $width) / 2,\n                top: (height - $height) / 2,\n            },\n        };\n    }\n\n    public resize(width: number, height: number) {\n        this.options.width = width;\n        this.options.height = height;\n\n        this.element.css('width', width);\n\n        this.element.css('height', height);\n\n        const position = this.calculatePosotion(width, height);\n\n        const items = this.wrapper.attr('items');\n\n        items[0].left = position.label.left;\n        items[0].top = position.label.top;\n        items[1].left = position.button.left;\n        items[1].top = position.button.top;\n\n        this.wrapper.resize();\n\n        this.label.element.css('width', position.label.width);\n        this.label.element.css('height', position.label.height);\n        this.label.element.css('font-size', position.label.fontSize);\n\n        this.button.element.css('width', position.button.width);\n        this.button.element.css('height', position.button.height);\n\n        this.multifileEditor.element.css('width', width);\n        this.multifileEditor.element.css('height', height);\n    }\n\n    public getAdapter() {\n        return this.multifileEditor;\n    }\n\n    public setStyle(_styles: Parameters<AbstractParameterControllerWidget['setStyle']>[0]) {}\n}\n\nexport interface ParamMultifileProps extends ParameterControllerMultifileProps4Render4Item {\n    baseCls: string;\n}\n\nexport interface ParameterControllerMultifileProps4Render4Item extends ParameterControllerBasicProps4Item {\n\n    /**\n     * 接受的文件类型\n     */\n    accept: string;\n\n    /**\n     * 文件最大大小\n     */\n    maxSize: number;\n\n    /**\n     * 最大上传文件数\n     */\n    maxlength: number;\n\n    /**\n     * 已上传个数\n     */\n    value: string;\n\n    /**\n     * 上传地址\n     */\n    url: string;\n}\n\nexport interface ParameterControllerMultifileProps4Render extends ParameterControllerBasicProps4Render, ParameterControllerMultifileProps4Render4Item {}\n\nexport interface File {\n    attach_id: string;\n    attach_type: string;\n    filename: string;\n}\n"]}