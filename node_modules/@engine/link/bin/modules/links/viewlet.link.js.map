{"version":3,"file":"viewlet.link.js","sourceRoot":"","sources":["../../../src/modules/links/viewlet.link.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,uBAAuB,CAAC;AAChD,OAAO,EAAE,YAAY,EAAqE,MAAM,iBAAiB,CAAC;AAClH,OAAO,EAAE,cAAc,EAAE,gBAAgB,EAAE,MAAM,cAAc,CAAC;AAEhE,MAAM,OAAO,WAAY,SAAQ,YAAY;IAUzC,YAAmB,KAAuB;QACtC,KAAK,CAAC,KAAK,CAAC,CAAC;QACb,MAAM,EAAE,WAAW,EAAE,KAAK,EAAE,MAAM,EAAE,SAAS,EAAE,UAAU,EAAE,IAAI,EAAE,sBAAsB,EAAE,MAAM,EAAE,GAAG,KAAK,CAAC;QAC1G,IAAI,CAAC,MAAM,GAAG,WAAW,CAAC;QAC1B,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,GAAG,GAAG,SAAS,CAAC;QACrB,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;QAC7B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,sBAAsB,GAAG,sBAAsB,CAAC;QACrD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACzB,CAAC;IAES,OAAO;QACb,gDAAgD;QAChD,MAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,kBAAkB,CAAC,cAAc,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QAC7F,OAAO,CAAC;YACJ,MAAM,EAAE,IAAI,CAAC,MAAM;YACnB,GAAG,EAAE,IAAI,CAAC,GAAG;YACb,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,MAAM,EAAE,IAAI,CAAC,MAAM;YACnB,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,MAAM,EAAE,IAAI,CAAC,MAAM;YACnB,SAAS;YACT,KAAK,EAAE,IAAI,CAAC,IAAI;SACnB,CAAC,CAAC;IACP,CAAC;IAES,YAAY;QAClB,MAAM,SAAS,GAAG;YACd,MAAM,EAAE,IAAI,CAAC,sBAAsB;SAGtC,CAAC;QACF,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YAC3B,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,OAAO,SAAS,CAAC;IACrB,CAAC;IAED,IAAc,GAAG;QACb,IAAI,IAAI,CAAC,MAAM,EAAE;YACb,OAAO,GAAG,IAAI,CAAC,IAAI,WAAW,IAAI,CAAC,sBAAsB,EAAE,CAAC;SAC/D;QAED,OAAO,GAAG,IAAI,CAAC,IAAI,IAAI,gBAAgB,CAAC;YACpC,cAAc,EAAE,IAAI,CAAC,YAAY,EAAE;YACnC,CAAC,EAAE,EAAE,CAAC,OAAO,EAAE,CAAC,OAAO,EAAE;SAC5B,CAAC,EAAE,CAAC;IACT,CAAC;IAED,IAAc,GAAG,CAAC,GAAW;QACzB,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;IACpB,CAAC;CACJ","sourcesContent":["import { openUrl } from '../hyper_link.service';\nimport { AbstractLink, HTMLLinkTarget, HyperLinkAttr, HyperLinkParameter, HyperLinkProps } from './abstract.link';\nimport { stringfyParams, paramsSerializer } from '@engine/crud';\n\nexport class ViewletLink extends AbstractLink {\n    protected _url: string;\n    protected target: HTMLLinkTarget;\n    protected width?: number;\n    protected height?: number;\n    protected parameters: HyperLinkParameter[];\n    protected attr?: HyperLinkAttr;\n    protected showParameterInterface: boolean; // 是否展示参数界面\n    protected byPost: boolean;\n\n    public constructor(props: ViewletLinkProps) {\n        super(props);\n        const { targetFrame, width, height, reportUrl, parameters, attr, showParameterInterface, byPost } = props;\n        this.target = targetFrame;\n        this.width = width;\n        this.height = height;\n        this.url = reportUrl;\n        this.parameters = parameters;\n        this.attr = attr;\n        this.showParameterInterface = showParameterInterface;\n        this.byPost = byPost;\n    }\n\n    protected _excute() {\n        // REPORT-39971 & REPORT-40406 此处传参有且仅一次encode即可\n        const parameter = this.byPost ? decodeURIComponent(stringfyParams(this.getParameter())) : '';\n        openUrl({\n            target: this.target,\n            url: this.url,\n            width: this.width,\n            height: this.height,\n            attr: this.attr,\n            byPost: this.byPost,\n            parameter,\n            title: this.name,\n        });\n    }\n\n    protected getParameter() {\n        const parameter = {\n            __pi__: this.showParameterInterface,\n        } as {\n            [key: string]: any;\n        };\n        this.parameters.forEach(item => {\n            parameter[item.name] = item.value;\n        });\n        \n        return parameter;\n    }\n\n    protected get url() {\n        if (this.byPost) {\n            return `${this._url}&__pi__=${this.showParameterInterface}`;\n        }\n\n        return `${this._url}&${paramsSerializer({\n            __parameters__: this.getParameter(),\n            _: BI.getDate().getTime(),\n        })}`;\n    }\n\n    protected set url(url: string) {\n        this._url = url;\n    }\n}\n\nexport interface ViewletLinkProps extends HyperLinkProps {\n    byPost: boolean;\n    targetFrame: HTMLLinkTarget;\n    reportUrl: string;\n    parameters: HyperLinkParameter[];\n    showParameterInterface: boolean;\n    extendParameters: boolean;\n    recalculate: boolean;\n}\n\n"]}