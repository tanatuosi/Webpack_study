/*! time: 2022/11/29 14:07:13 */
!function(n){var r={};function i(e){var t;return(r[e]||(t=r[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,i),t.l=!0,t)).exports}i.m=n,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=545)}([function(e,t,n){"use strict";var r=Array.isArray;e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.store=t.shortcut=t.model=t.Model=void 0;var r=BI.Decorators,i=r.shortcut,o=r.Model,a=r.model,r=r.store;t.store=r,t.model=a,t.Model=o,t.shortcut=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSequenceProd=t.isBranchingProd=t.isOptionalProd=t.getProductionDslName=t.GAstVisitor=t.serializeProduction=t.serializeGrammar=t.Alternative=t.Alternation=t.RepetitionWithSeparator=t.RepetitionMandatoryWithSeparator=t.RepetitionMandatory=t.Repetition=t.Option=t.NonTerminal=t.Terminal=t.Rule=void 0;var r=n(93),i=(Object.defineProperty(t,"Rule",{enumerable:!0,get:function(){return r.Rule}}),Object.defineProperty(t,"Terminal",{enumerable:!0,get:function(){return r.Terminal}}),Object.defineProperty(t,"NonTerminal",{enumerable:!0,get:function(){return r.NonTerminal}}),Object.defineProperty(t,"Option",{enumerable:!0,get:function(){return r.Option}}),Object.defineProperty(t,"Repetition",{enumerable:!0,get:function(){return r.Repetition}}),Object.defineProperty(t,"RepetitionMandatory",{enumerable:!0,get:function(){return r.RepetitionMandatory}}),Object.defineProperty(t,"RepetitionMandatoryWithSeparator",{enumerable:!0,get:function(){return r.RepetitionMandatoryWithSeparator}}),Object.defineProperty(t,"RepetitionWithSeparator",{enumerable:!0,get:function(){return r.RepetitionWithSeparator}}),Object.defineProperty(t,"Alternation",{enumerable:!0,get:function(){return r.Alternation}}),Object.defineProperty(t,"Alternative",{enumerable:!0,get:function(){return r.Alternative}}),Object.defineProperty(t,"serializeGrammar",{enumerable:!0,get:function(){return r.serializeGrammar}}),Object.defineProperty(t,"serializeProduction",{enumerable:!0,get:function(){return r.serializeProduction}}),n(490)),o=(Object.defineProperty(t,"GAstVisitor",{enumerable:!0,get:function(){return i.GAstVisitor}}),n(491));Object.defineProperty(t,"getProductionDslName",{enumerable:!0,get:function(){return o.getProductionDslName}}),Object.defineProperty(t,"isOptionalProd",{enumerable:!0,get:function(){return o.isOptionalProd}}),Object.defineProperty(t,"isBranchingProd",{enumerable:!0,get:function(){return o.isBranchingProd}}),Object.defineProperty(t,"isSequenceProd",{enumerable:!0,get:function(){return o.isSequenceProd}})},function(e,t,n){"use strict";var r=n(226),i=n(21),o=n(448),a=n(0);e.exports=function(e,t){return(a(e)?r:i)(e,o(t))}},function(e,t,n){"use strict";var r=n(32),i=n(13),o=n(443),a=n(0);e.exports=function(e,t){return(a(e)?r:o)(e,i(t,3))}},function(e,t,n){"use strict";var r=n(220),i=n(73),o=n(8);e.exports=function(e){return(o(e)?r:i)(e)}},function(e,r,t){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||n({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var i,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(r,"__esModule",{value:!0}),r.EmbeddedActionsParser=r.CstParser=r.Parser=r.EMPTY_ALT=r.ParserDefinitionErrorType=r.DEFAULT_RULE_CONFIG=r.DEFAULT_PARSER_CONFIG=r.END_OF_FILE=void 0,a(t(9))),l=a(t(4)),c=a(t(3)),u=a(t(15)),h=a(t(7)),d=a(t(17)),p=t(37),f=t(475),a=t(26),m=t(65),g=t(509),b=t(245),y=t(515),v=t(516),_=t(520),I=t(521),x=t(522),E=t(523),S=t(524),T=t(525),C=t(526),t=t(527);r.END_OF_FILE=(0,a.createTokenInstance)(a.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(r.END_OF_FILE),r.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:m.defaultParserErrorProvider,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),r.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){return undefined},resyncEnabled:!0}),(a=r.ParserDefinitionErrorType||(r.ParserDefinitionErrorType={}))[a.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",a[a.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",a[a.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",a[a.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",a[a.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",a[a.LEFT_RECURSION=5]="LEFT_RECURSION",a[a.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",a[a.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",a[a.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",a[a.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",a[a.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",a[a.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",a[a.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",r.EMPTY_ALT=function(e){return void 0===e&&(e=undefined),function(){return e}};w.performSelfAnalysis=function(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.\t\nUse the **instance** method with the same name instead.")},w.prototype.performSelfAnalysis=function(){var r=this;this.TRACE_INIT("performSelfAnalysis",function(){r.selfAnalysisDone=!0;var e,t=r.className,n=(r.TRACE_INIT("toFastProps",function(){(0,p.toFastProperties)(r)}),r.TRACE_INIT("Grammar Recording",function(){try{r.enableRecording(),(0,c["default"])(r.definedRulesNames,function(e){var t,n=r[e].originalGrammarAction;r.TRACE_INIT("".concat(e," Rule"),function(){t=r.topLevelRuleRecord(e,n)}),r.gastProductionsCache[e]=t})}finally{r.disableRecording()}}),[]);if(r.TRACE_INIT("Grammar Resolving",function(){n=(0,g.resolveGrammar)({rules:(0,u["default"])(r.gastProductionsCache)}),r.definitionErrors=r.definitionErrors.concat(n)}),r.TRACE_INIT("Grammar Validations",function(){var e;(0,s["default"])(n)&&!1===r.skipValidations&&(e=(0,g.validateGrammar)({rules:(0,u["default"])(r.gastProductionsCache),maxLookahead:r.maxLookahead,tokenTypes:(0,u["default"])(r.tokensMap),errMsgProvider:m.defaultGrammarValidatorErrorProvider,grammarName:t}),r.definitionErrors=r.definitionErrors.concat(e))}),(0,s["default"])(r.definitionErrors)&&(r.recoveryEnabled&&r.TRACE_INIT("computeAllProdsFollows",function(){var e=(0,f.computeAllProdsFollows)((0,u["default"])(r.gastProductionsCache));r.resyncFollows=e}),r.TRACE_INIT("ComputeLookaheadFunctions",function(){r.preComputeLookaheadFunctions((0,u["default"])(r.gastProductionsCache))})),!w.DEFER_DEFINITION_ERRORS_HANDLING&&!(0,s["default"])(r.definitionErrors))throw e=(0,l["default"])(r.definitionErrors,function(e){return e.message}),new Error("Parser Definition Errors detected:\n ".concat(e.join("\n-------------------------------\n")))})},w.DEFER_DEFINITION_ERRORS_HANDLING=!1;a=w;function w(e,t){this.definitionErrors=[],this.selfAnalysisDone=!1;var n=this;if(n.initErrorHandler(t),n.initLexerAdapter(),n.initLooksAhead(t),n.initRecognizerEngine(e,t),n.initRecoverable(t),n.initTreeBuilder(t),n.initContentAssist(),n.initGastRecorder(t),n.initPerformanceTracer(t),(0,h["default"])(t,"ignoredIssues"))throw new Error("The <ignoredIssues> IParserConfig property has been deprecated.\n\tPlease use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.\n\tSee: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES\n\tFor further details.");this.skipValidations=((0,h["default"])(t,"skipValidations")?t:r.DEFAULT_PARSER_CONFIG).skipValidations}r.Parser=a,(0,t.applyMixins)(a,[b.Recoverable,y.LooksAhead,v.TreeBuilder,_.LexerAdapter,x.RecognizerEngine,I.RecognizerApi,E.ErrorHandler,S.ContentAssist,T.GastRecorder,C.PerformanceTracer]);o(R,B=a);var B,t=R;function R(e,t){void 0===t&&(t=r.DEFAULT_PARSER_CONFIG);t=(0,d["default"])(t);return t.outputCst=!0,B.call(this,e,t)||this}r.CstParser=t;o(A,N=a);var N,b=A;function A(e,t){void 0===t&&(t=r.DEFAULT_PARSER_CONFIG);t=(0,d["default"])(t);return t.outputCst=!1,N.call(this,e,t)||this}r.EmbeddedActionsParser=b},function(e,t,n){"use strict";var r=n(450),i=n(224);e.exports=function(e,t){return null!=e&&i(e,t,r)}},function(e,t,n){"use strict";var r=n(30),i=n(75);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},function(e,t,n){"use strict";var r=n(73),i=n(24),o=n(48),a=n(0),s=n(8),l=n(49),c=n(29),u=n(76),h=Object.prototype.hasOwnProperty;e.exports=function(e){if(null!=e){if(s(e)&&(a(e)||"string"==typeof e||"function"==typeof e.splice||l(e)||u(e)||o(e)))return!e.length;var t,n=i(e);if("[object Map]"==n||"[object Set]"==n)return!e.size;if(c(e))return!r(e).length;for(t in e)if(h.call(e,t))return!1}return!0}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=n(210),i="object"==("undefined"==typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,n=n||i||Function("return this")();e.exports=n},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){var t=r(e);return null!=e&&("object"==t||"function"==t)}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){return null!=e&&"object"==r(e)}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(402),o=n(434),a=n(35),s=n(0),l=n(441);e.exports=function(e){return"function"==typeof e?e:null==e?a:"object"==r(e)?s(e)?o(e[0],e[1]):i(e):l(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInput=function(e){e=r[e];if(BI.isNull(e))throw new TypeError;return e.xtype},t.input=function(t){return function(e){r[t]=e}};var r={}},function(e,t,n){"use strict";var r=n(449),i=n(5);e.exports=function(e){return null==e?[]:r(e,i(e))}},function(e,t,n){"use strict";var r=n(97);e.exports=function(e){return(null==e?0:e.length)?r(e,1):[]}},function(e,t,n){"use strict";var r=n(451);e.exports=function(e){return r(e,4)}},function(e,t,n){"use strict";var i=n(96),o=n(8),a=n(39),s=n(38),l=n(15),c=Math.max;e.exports=function(e,t,n,r){return e=o(e)?e:l(e),n=n&&!r?s(n):0,r=e.length,n<0&&(n=c(r+n,0)),a(e)?n<=r&&-1<e.indexOf(t,n):!!r&&-1<i(e,t,n)}},function(e,t,n){"use strict";var r=n(391),i=n(396);e.exports=function(e,t){return e=i(e,t),r(e)?e:undefined}},function(e,t,n){"use strict";var r=n(25),i=n(392),o=n(393),a=r?r.toStringTag:undefined;e.exports=function(e){return null==e?e===undefined?"[object Undefined]":"[object Null]":(a&&a in Object(e)?i:o)(e)}},function(e,t,n){"use strict";var r=n(444),n=n(447)(r);e.exports=n},function(e,t,n){"use strict";e.exports=function(e){return e===undefined}},function(e,t,n){"use strict";var o=n(506),a=n(21),s=n(13),l=n(507),c=n(0);e.exports=function(e,t,n){var r=c(e)?o:l,i=arguments.length<3;return r(e,s(t,4),n,i,a)}},function(e,t,n){"use strict";var r=n(390),i=n(74),o=n(397),a=n(212),s=n(398),l=n(20),c=n(211),u="[object Map]",h="[object Promise]",d="[object Set]",p="[object WeakMap]",f="[object DataView]",m=c(r),g=c(i),b=c(o),y=c(a),v=c(s),_=l;(r&&_(new r(new ArrayBuffer(1)))!=f||i&&_(new i)!=u||o&&_(o.resolve())!=h||a&&_(new a)!=d||s&&_(new s)!=p)&&(_=function _(e){var t=l(e),e="[object Object]"==t?e.constructor:undefined,e=e?c(e):"";if(e)switch(e){case m:return f;case g:return u;case b:return h;case y:return d;case v:return p}return t}),e.exports=_},function(e,t,n){"use strict";n=n(10).Symbol;e.exports=n},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.tokenMatcher=t.createTokenInstance=t.EOF=t.createToken=t.hasTokenLabel=t.tokenName=t.tokenLabel=void 0,r(n(39))),o=r(n(7)),a=r(n(22)),r=n(63),s=n(27);function l(e){return(0,i["default"])(e.LABEL)&&""!==e.LABEL}t.tokenLabel=function(e){return l(e)?e.LABEL:e.name},t.tokenName=function(e){return e.name},t.hasTokenLabel=l;var c="parent",u="categories",h="label",d="group",p="push_mode",f="pop_mode",m="longer_alt",g="line_breaks",b="start_chars_hint";function y(e){var t=e.pattern,n={};if(n.name=e.name,(0,a["default"])(t)||(n.PATTERN=t),(0,o["default"])(e,c))throw"The parent property is no longer supported.\nSee: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.";return(0,o["default"])(e,u)&&(n.CATEGORIES=e[u]),(0,s.augmentTokenTypes)([n]),(0,o["default"])(e,h)&&(n.LABEL=e[h]),(0,o["default"])(e,d)&&(n.GROUP=e[d]),(0,o["default"])(e,f)&&(n.POP_MODE=e[f]),(0,o["default"])(e,p)&&(n.PUSH_MODE=e[p]),(0,o["default"])(e,m)&&(n.LONGER_ALT=e[m]),(0,o["default"])(e,g)&&(n.LINE_BREAKS=e[g]),(0,o["default"])(e,b)&&(n.START_CHARS_HINT=e[b]),n}t.createToken=y,t.EOF=y({name:"EOF",pattern:r.Lexer.NA}),(0,s.augmentTokenTypes)([t.EOF]),t.createTokenInstance=function(e,t,n,r,i,o,a,s){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:o,startColumn:a,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}},t.tokenMatcher=function(e,t){return(0,s.tokenStructuredMatcher)(e,t)}},function(e,r,t){"use strict";var n=function(e){return e&&e.__esModule?e:{"default":e}},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.isTokenType=r.hasExtendingTokensTypesMapProperty=r.hasExtendingTokensTypesProperty=r.hasCategoriesProperty=r.hasShortKeyProperty=r.singleAssignCategoriesToksMap=r.assignCategoriesMapProp=r.assignCategoriesTokensProp=r.assignTokenDefaultProps=r.expandCategories=r.augmentTokenTypes=r.tokenIdxToClass=r.tokenShortNameIdx=r.tokenStructuredMatcherNoCategories=r.tokenStructuredMatcher=void 0,n(t(9))),a=n(t(64)),i=n(t(0)),s=n(t(16)),l=n(t(102)),c=n(t(4)),u=n(t(3)),h=n(t(7)),d=n(t(18)),p=n(t(17));function f(e){for(var t=(0,p["default"])(e),n=e,r=!0;r;){var n=(0,a["default"])((0,s["default"])((0,c["default"])(n,function(e){return e.CATEGORIES}))),i=(0,l["default"])(n,t),t=t.concat(i);(0,o["default"])(i)?r=!1:n=i}return t}function m(e){(0,u["default"])(e,function(e){v(e)||((r.tokenIdxToClass[r.tokenShortNameIdx]=e).tokenTypeIdx=r.tokenShortNameIdx++),_(e)&&!(0,i["default"])(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),_(e)||(e.CATEGORIES=[]),I(e)||(e.categoryMatches=[]),x(e)||(e.categoryMatchesMap={})})}function g(e){(0,u["default"])(e,function(n){n.categoryMatches=[],(0,u["default"])(n.categoryMatchesMap,function(e,t){n.categoryMatches.push(r.tokenIdxToClass[t].tokenTypeIdx)})})}function b(e){(0,u["default"])(e,function(e){y([],e)})}function y(n,r){(0,u["default"])(n,function(e){r.categoryMatchesMap[e.tokenTypeIdx]=!0}),(0,u["default"])(r.CATEGORIES,function(e){var t=n.concat(r);(0,d["default"])(t,e)||y(t,e)})}function v(e){return(0,h["default"])(e,"tokenTypeIdx")}function _(e){return(0,h["default"])(e,"CATEGORIES")}function I(e){return(0,h["default"])(e,"categoryMatches")}function x(e){return(0,h["default"])(e,"categoryMatchesMap")}r.tokenStructuredMatcher=function(e,t){return(e=e.tokenTypeIdx)===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[e]},r.tokenStructuredMatcherNoCategories=function(e,t){return e.tokenTypeIdx===t.tokenTypeIdx},r.tokenShortNameIdx=1,r.tokenIdxToClass={},r.augmentTokenTypes=function(e){m(e=f(e)),b(e),g(e),(0,u["default"])(e,function(e){e.isParent=0<e.categoryMatches.length})},r.expandCategories=f,r.assignTokenDefaultProps=m,r.assignCategoriesTokensProp=g,r.assignCategoriesMapProp=b,r.singleAssignCategoriesToksMap=y,r.hasShortKeyProperty=v,r.hasCategoriesProperty=_,r.hasExtendingTokensTypesProperty=I,r.hasExtendingTokensTypesMapProperty=x,r.isTokenType=function(e){return(0,h["default"])(e,"tokenTypeIdx")}},function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.FormulaInserter=void 0;var r=n(1),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{"default":e};t=s(t);if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e){var o;"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((o=i?Object.getOwnPropertyDescriptor(e,n):null)&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n])}r["default"]=e,t&&t.set(e,r);return r}(n(302)),f=n(45);function s(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(s=function s(e){return e?n:t})(e))}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function c(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}var m=/(\$[{][^}]*[}])/,n=(0,r.shortcut)()((n=function(i){var e;function t(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return c(o(e=i.call.apply(i,[this].concat(n))||this),"formulaEditor",void 0),c(o(e),"props",{value:{formula:""}}),e}e=i,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.getToolbarLayout=function(){return{type:BI.Layout.xtype}},n.render=function(){var t=this;return{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.FormulaEditor.xtype,cls:"bi-border",ref:function(e){t.formulaEditor=e},watermark:BI.i18nText("BI-Basic_Formula_Watermark"),listeners:[{eventName:BI.FormulaEditor.EVENT_CHANGE,action:function(){t.validate()}},{eventName:"EVENT_SHOW_HINT",action:function(e){t.fireEvent("EVENT_SHOW_HINT",BI.first(e))}},{eventName:"EVENT_SELECT_HINT",action:function(e){t.fireEvent("EVENT_SELECT_HINT",e)}}]},height:155},this.getToolbarLayout()]}},n.mounted=function(){this.setValue(this.options.value.formula)},n.insertFunction=function(e){this.formulaEditor.insertFunction(e)},n.insertField=function(e){this.formulaEditor.insertField(e,!0)},n.getValue=function(){return{formula:this.formulaEditor.getValue()}},n.validate=function(){""===this.formulaEditor.getValue()?this.formulaEditor.hideTip():this.fireEvent("EVENT_VALIDATE")},n.setValidation=function(e){e.validation?this.formulaEditor.hideTip():this.formulaEditor.showTip(BI.i18nText("BI-Basic_Formula_Invalid"))},n.setValue=function(e){this.formulaEditor.refresh(),this.formulaEditor.setValue(""),this.insertFormula(e),this.validate()},n.analyzeContent=function(e){return e.match(/\$[{][^}]*[}]|\w+|\$\{[^$()+\-*/)$,]*\w\}|\$\{[^$()+\-*/]*\w\}|\$\{[^$()+\-*/]*[\u4e00-\u9fa5]\}|\w|(.)|\n/g)},n.paramFormatter=function(e){return(0,f.getVarDisplayNameByValue)(e)},n.insertFormula=function(){var a=this,e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:"",t=1<arguments.length?arguments[1]:undefined,e=this.analyzeContent(e)||[],s=[],l=[],c=0,u=0,h="",d=(BI.isNotNull(t)&&(c=t.line,u=t.ch),this.formulaEditor.getParamWrap());e.forEach(function(e){var t,n,r,i,o;m.test(e)?(t=e.substring(2,e.length-1),n=a.paramFormatter(t),r=d+n.replaceAll("^<!.*!>$",function(e){return e.substring(2,e.length-2)})+d,i=p.Pos(c,u),h+=r,u+=r.length,o=p.Pos(c,u),s.push({from:i,to:o,value:t,invalid:/^<!.*!>$/.test(n),text:r})):(BI.isNotNull((0,f.isBelong2FormulaFunction)(e))&&(i=p.Pos(c,u),o=p.Pos(c,u+e.length),l.push({from:i,to:o,value:e})),"\n"===e&&(c++,u=0),h+=e,"\n"!==e&&(u+=e.length))}),this.formulaEditor.insertString(h),BI.each(s,function(e,t){a.formulaEditor.markField(t)}),BI.each(l,function(e,t){a.formulaEditor.markFunction(t)})},t}(BI.Widget),c(n,"xtype","bi.formula_operating_panel.inserter"),r=n))||r;t.FormulaInserter=n},function(e,t,n){"use strict";var r=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||r)}},function(e,t,n){"use strict";var r=n(20),i=n(11);e.exports=function(e){return!!i(e)&&("[object Function]"==(e=r(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)}},function(e,t,n){"use strict";e.exports=function(t){return function(e){return t(e)}}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}},function(e,t,n){"use strict";e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){"use strict";var r=n(57);e.exports=function(e){var t;return"string"==typeof e||r(e)?e:"0"==(t=e+"")&&1/e==-1/0?"-0":t}},function(e,t,n){"use strict";e.exports=function(e){return e}},function(e,t,n){"use strict";var c=n(58),u=n(88);e.exports=function(e,t,n,r){for(var i=!n,o=(n=n||{},-1),a=t.length;++o<a;){var s=t[o],l=r?r(n[s],e[s],s,n,e):undefined;l===undefined&&(l=e[s]),(i?u:c)(n,s,l)}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toFastProperties=t.timer=t.PRINT_ERROR=t.PRINT_WARNING=void 0;var r=n(472),i=(Object.defineProperty(t,"PRINT_WARNING",{enumerable:!0,get:function(){return r.PRINT_WARNING}}),Object.defineProperty(t,"PRINT_ERROR",{enumerable:!0,get:function(){return r.PRINT_ERROR}}),n(473)),o=(Object.defineProperty(t,"timer",{enumerable:!0,get:function(){return i.timer}}),n(474));Object.defineProperty(t,"toFastProperties",{enumerable:!0,get:function(){return o.toFastProperties}})},function(e,t,n){"use strict";var r=n(476);e.exports=function(e){var t=(e=r(e))%1;return e==e?t?e-t:e:0}},function(e,t,n){"use strict";var r=n(20),i=n(0),o=n(12);e.exports=function(e){return"string"==typeof e||!i(e)&&o(e)&&"[object String]"==r(e)}},function(e,t,n){"use strict";e.exports=n(500)},function(e,t,n){"use strict";function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||r({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var i,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.EarlyExitException=t.NotAllInputParsedException=t.NoViableAltException=t.MismatchedTokenException=t.isRecognitionException=void 0,a(n(18))),l="MismatchedTokenException",c="NoViableAltException",u="EarlyExitException",h="NotAllInputParsedException",d=[l,c,u,h];Object.freeze(d),t.isRecognitionException=function(e){return(0,s["default"])(d,e.name)};p=Error,o(f,p);var p,n=f;function f(e,t){var n=this.constructor,e=p.call(this,e)||this;return e.token=t,e.resyncedTokens=[],Object.setPrototypeOf(e,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,e.constructor),e}o(g,m=n);var m,a=g;function g(e,t,n){e=m.call(this,e,t)||this;return e.previousToken=n,e.name=l,e}t.MismatchedTokenException=a;o(y,b=n);var b,a=y;function y(e,t,n){e=b.call(this,e,t)||this;return e.previousToken=n,e.name=c,e}t.NoViableAltException=a;o(_,v=n);var v,a=_;function _(e,t){e=v.call(this,e,t)||this;return e.name=h,e}t.NotAllInputParsedException=a;o(x,I=n);var I,a=x;function x(e,t,n){e=I.call(this,e,t)||this;return e.previousToken=n,e.name=u,e}t.EarlyExitException=a},function(e,t,n){"use strict";function r(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CONFIG=void 0;var a={type:"bi.pure_text",lineHeight:30,textAlign:"left",whiteSpace:"normal",expandIcon:"expander-down-font",collapseIcon:"expander-right-font",sortableIcon:"text-align-center-font"},t=(t.DEFAULT_CONFIG=a,BI.inherit(BI.Widget,{props:{baseCls:"bi-sticky-table-row",tagName:"tr",id:"",dimension:a,layer:0,columnSize:[],minColumnSize:[],maxColumnSize:[],freezeCols:[],items:[],draggable:!0,checkable:!0,checked:!1,half:!1,prevComponent:null},render:function(){var t=this;return{type:"bi.adaptive",cls:this.options.draggable?"enabled":"",ref:function(e){t.layout=e},items:this.getItems()}},getItems:function(){var t=this,n=this,r=this.options,e=i(i({},a),r.dimension);return this.text=BI.createWidget(e),[{type:"bi.adaptive",tagName:"td",cls:"".concat(r.freezeCols.includes(0)?"sticky-table-fix-first-col":""," first-col"),items:[{type:"bi.vertical_adapt",css:{minWidth:r.minColumnSize[0],maxWidth:r.maxColumnSize[0]},items:[r.prevComponent,r.draggable?{type:"bi.icon_label",extraCls:"bi-sticky-table-draggable-handler",cls:e.sortableIcon,width:30,height:30}:null,r.isParent?{_lgap:30*r.layer,type:"bi.icon_change_button",ref:function(e){t.arrow=e},handler:function(){t.fireEvent(BI.Controller.EVENT_CHANGE,r.open?BI.Events.COLLAPSE:BI.Events.EXPAND)},iconCls:this._getExpandIcon(),width:30,height:30}:null,r.checkable?{_lgap:r.isParent?0:30*(r.layer+.5),type:"bi.multi_select_bar",ref:function(e){t.checkbox=e},selected:r.checked,halfSelected:r.half,width:30,iconWrapperWidth:30,height:30,text:"",listeners:o({},BI.MultiSelectBar.EVENT_CHANGE,function(e){n.fireEvent(BI.Controller.EVENT_CHANGE,BI.Events.CHANGE,e)})}:null,{_lgap:r.checkable||r.isParent?0:30*r.layer,width:"fill",el:this.text}]}]}].concat(BI.map(r.items,function(e,t){var n=r.freezeCols.includes(e+1)&&e<r.items.length-1;return{type:"bi.adaptive",extraCls:r.freezeCols.includes(e+1)&&e===r.items.length-1?"sticky-table-fix-last-col":n?"sticky-table-fix-first-col":"",cls:"sticky-table-fix-index-".concat(e+1,"-col"),css:{minWidth:r.minColumnSize[e+1],maxWidth:r.maxColumnSize[e+1]},tagName:"td",items:[i(i({},a),t)]}}))},_getExpandIcon:function(){var e=this.options,t=BI.extend({},a,e.dimension);return e.open?t.expandIcon:t.collapseIcon},doRedMark:function(){this.text.doRedMark.apply(this.text,arguments)},unRedMark:function(){this.text.unRedMark.apply(this.text,arguments)},shouldUpdate:function(n){var r=this.options;return BI.some(["open","layer","pId","id","dimension","items","draggable","prevComponent","columnSize","checked","half","cls"],function(e,t){return n[t]!==r[t]})},update:function(e){var t=this.options;e.prevComponent!==t.prevComponent&&(t.prevComponent=e.prevComponent),e.cls!==t.cls&&(this.element.removeClass(t.cls).addClass(e.cls),t.cls=e.cls),BI.isNotNull(e.draggable)&&e.draggable!==t.draggable&&this.element[e.draggable?"addClass":"removeClass"]("enabled"),e.dimension!==t.dimension&&(this.text.setText(e.dimension.text||e.dimension.value),t.dimension=e.dimension),e.open!==t.open&&(t.open=e.open,this.arrow&&this.arrow.setIcon(this._getExpandIcon())),(e.items!==t.items||BI.isNotNull(e.draggable)&&e.draggable!==t.draggable)&&(t.items=e.items,t.draggable=e.draggable,this.layout.populate(this.getItems())),e.checked===t.checked&&e.half===t.half||(t.checked=e.checked,t.half=e.half,this.checkbox&&this.checkbox.setSelected(t.checked),this.checkbox&&this.checkbox.setHalfSelected(t.half))}}));BI.shortcut("bi.sticky_table_row",t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.token=t.allTokens=void 0;var n=n(47),r=(0,n.createToken)({name:"Unary",pattern:n.Lexer.NA}),i=(0,n.createToken)({name:"Addition",pattern:n.Lexer.NA}),o=(0,n.createToken)({name:"Multiplication",pattern:n.Lexer.NA}),a=(0,n.createToken)({name:"Equal",pattern:n.Lexer.NA}),s=(0,n.createToken)({name:"Compare",pattern:n.Lexer.NA}),i={WhiteSpace:(0,n.createToken)({name:"WhiteSpace",pattern:/\s+/,group:n.Lexer.SKIPPED}),String:(0,n.createToken)({name:"String",pattern:/("(\\\\|\\"|[^"])*"|'(\\\\|\\'|[^'])*')/}),Number:(0,n.createToken)({name:"Number",pattern:/[0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?/i}),Date:(0,n.createToken)({name:"Date",pattern:/("bi-date-place-holder"|'bi-date-place-holder')/}),Boolean:(0,n.createToken)({name:"Boolean",pattern:/(true|false)/i}),Empty:(0,n.createToken)({name:"Empty",pattern:/(null|undefined)/i}),NaN:(0,n.createToken)({name:"NaN",pattern:/NaN/}),Comma:(0,n.createToken)({name:"Comma",pattern:/,/}),Func:(0,n.createToken)({name:"Func",pattern:/[A-Za-z0-9_.]+/}),LParen:(0,n.createToken)({name:"LParen",pattern:/\(/}),RParen:(0,n.createToken)({name:"RParen",pattern:/\)/}),LSquare:(0,n.createToken)({name:"LSquare",pattern:/\[/}),RSquare:(0,n.createToken)({name:"RSquare",pattern:/]/}),Plus:(0,n.createToken)({name:"Plus",pattern:/\+(?!\+)/,categories:[r,i]}),Minus:(0,n.createToken)({name:"Minus",pattern:/-(?!-)/,categories:[r,i]}),Unary:r,Addition:i,Multi:(0,n.createToken)({name:"Multi",pattern:/\*/,categories:[o]}),Div:(0,n.createToken)({name:"Div",pattern:/\//,categories:[o]}),Multiplication:o,LessOrEqual:(0,n.createToken)({name:"LessOrEqual",pattern:/<=/,categories:[s]}),GreaterOrEqual:(0,n.createToken)({name:"GreaterOrEqual",pattern:/>=/,categories:[s]}),Less:(0,n.createToken)({name:"Less",pattern:/</,categories:[s]}),Greater:(0,n.createToken)({name:"Greater",pattern:/>/,categories:[s]}),Compare:s,NotEqualStrict:(0,n.createToken)({name:"NotEqualStrict",pattern:/!==/,categories:[a]}),EqualLoose:(0,n.createToken)({name:"EqualLoose",pattern:/==/,categories:[a]}),NotEqualLoose:(0,n.createToken)({name:"NotEqualLoose",pattern:/!=/,categories:[a]}),Equal:a,EqualStrict:(0,n.createToken)({name:"EqualStrict",pattern:/=/,categories:[a]}),LogicNot:(0,n.createToken)({name:"LogicNot",pattern:/!/,categories:[r]}),LogicAnd:(0,n.createToken)({name:"LogicAnd",pattern:/&&/}),LogicOr:(0,n.createToken)({name:"LogicOr",pattern:/\|\|/}),BitAnd:(0,n.createToken)({name:"BitAnd",pattern:/&/})},o=[(t.token=i).WhiteSpace,i.Date,i.String,i.Number,i.NaN,i.Boolean,i.Empty,i.Func,i.LParen,i.RParen,i.LSquare,i.RSquare,i.Plus,i.Minus,i.Addition,i.Unary,i.Multi,i.Div,i.Multiplication,i.LessOrEqual,i.GreaterOrEqual,i.Less,i.Greater,i.Compare,i.NotEqualStrict,i.EqualLoose,i.NotEqualLoose,i.Equal,i.EqualStrict,i.LogicNot,i.LogicAnd,i.LogicOr,i.BitAnd,i.Comma];t.allTokens=o},function(e,t,n){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionDescriptionByFunctionName=function(t){var e=d.find(function(e){return e.name===t});return BI.isNotNull(e)?e.def:""},t.getFunctionTypeByFunctionName=function(t){var e=d.find(function(e){return e.name===t});if(BI.isNotNull(e))return e.type;return null},t.getSearchedFunctionNames=function(e){if(""===e)return[];var e=BI.Func.getSearchResult(p(),e,"val"),t=e.match,e=e.find;return t.sort(function(e,t){return e.value>t.value?1:-1}),e.sort(function(e,t){return e.value>t.value?1:-1}),[].concat(c(t),c(e))},t.getVarDescriptionByVarName=function(t){var e=h.find(function(e){return e.value===t});return BI.isNotNull(e)?e.def:""},t.getVarDisplayNameByValue=function(t){var e=h.find(function(e){return e.value===t});return e?e.text:"undefined"},t.isBelong2FormulaFunction=function(t){return p().find(function(e){return e.text.toLowerCase()===t.toLowerCase()})},t.isFormulaConfigCached=function(){return u},t.setFormulaConfigCache=function(e){u=!0,h=e.vars,BI.FormulaJSONs=e.JSONs,BI.FormulaCollections=e.JSONs.reduce(function(e,t){return e.push(t.name.toLowerCase(),t.name.toUpperCase()),e},[]),d=e.JSONs},t.transformFormulaJSONs2FunctionNames=p,t.transformFormulaJSONs2FunctionTypes=function(){return Object.keys(d.reduce(function(e,t){return t.type in e||(e[t.type]=[]),e},{})).map(function(e){return{text:e,title:e,value:e,cls:"bi-list-item-select",textAlign:"left",height:20,hgap:5}})},t.transformFormulaVarItems=function(){var i,o;return u?(i={},h.forEach(function(e){e.type in i?i[e.type].push(e):i[e.type]=[e]}),o=a.FORMULA_VAR_NODES.map(function(e){var t=BI.size(i[e.value]);return l(l({},e),{},{open:!0,height:25,text:BI.i18nText(e.i18nText)+(0<t?" - [".concat(t,"]"):"")})}),Object.keys(i).forEach(function(t){var n,r,e=a.FORMULA_VAR_NODES.find(function(e){return e.value===t});e&&(n=e.id,e=i[t],r=BI.size(e),o.push.apply(o,c(e.map(function(e,t){return{pId:n,id:BI.UUID(),text:e.text,value:e.value,lgap:16,layoutType:(t===r-1?BI.LastTreeLeafItem:BI.MidTreeLeafItem).xtype,type:s.FormulaVarItem.xtype,height:25}}))))}),o):[]};var r=n(303),a=n(46),s=n(304);function o(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function l(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach(function(e){var t,n;t=r,n=i[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}function c(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?i(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var u=!1,h=[],d=[];function p(n){return Object.keys(d.reduce(function(e,t){return t.name in e||n&&t.type!==n||(e[t.name]=[]),e},{})).map(function(e){return{type:r.FormulaFunctionItem.xtype,text:e,title:e,value:e,height:20}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FORMULA_VAR_TYPES=t.FORMULA_VAR_NODES=t.DEFAULT_FUNCTION_TYPE=t.DEFAULT_FUNCTION_NAME=void 0;t.DEFAULT_FUNCTION_NAME="ABS";t.DEFAULT_FUNCTION_TYPE="MATH";var r={DATA_ITEMS:"DATA_ITEMS",VARS:"VARS",DATA_SET_VARS:"DATA_SET_VARS",REPORT_VARS:"REPORT_VARS",GLOBAL_VARS:"GLOBAL_VARS"},r=[{id:"1",pId:"-1",i18nText:"BI-Basic_Formula_Data_Items",value:(t.FORMULA_VAR_TYPES=r).DATA_ITEMS,type:BI.IconArrowNode.xtype,iconCls:"search-font"},{id:"2",pId:"-1",i18nText:"BI-Basic_Formula_Vars",value:r.VARS,type:BI.IconArrowNode.xtype,iconCls:"search-font"},{id:"3",pId:"-1",i18nText:"BI-Basic_Formula_Data_Set_Vars",value:r.DATA_SET_VARS,type:BI.IconArrowNode.xtype,iconCls:"search-font"},{id:"4",pId:"-1",i18nText:"BI-Basic_Formula_Report_Vars",value:r.REPORT_VARS,type:BI.IconArrowNode.xtype,iconCls:"search-font"},{id:"5",pId:"-1",i18nText:"BI-Basic_Formula_Global_Vars",value:r.GLOBAL_VARS,type:BI.IconArrowNode.xtype,iconCls:"search-font"}];t.FORMULA_VAR_NODES=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=t.createSyntaxDiagramsCode=t.clearCache=t.generateCstDts=t.GAstVisitor=t.serializeProduction=t.serializeGrammar=t.Terminal=t.Rule=t.RepetitionWithSeparator=t.RepetitionMandatoryWithSeparator=t.RepetitionMandatory=t.Repetition=t.Option=t.NonTerminal=t.Alternative=t.Alternation=t.defaultLexerErrorProvider=t.NoViableAltException=t.NotAllInputParsedException=t.MismatchedTokenException=t.isRecognitionException=t.EarlyExitException=t.defaultParserErrorProvider=t.tokenName=t.tokenMatcher=t.tokenLabel=t.EOF=t.createTokenInstance=t.createToken=t.LexerDefinitionErrorType=t.Lexer=t.EMPTY_ALT=t.ParserDefinitionErrorType=t.EmbeddedActionsParser=t.CstParser=t.VERSION=void 0;var r=n(208),i=(Object.defineProperty(t,"VERSION",{enumerable:!0,get:function(){return r.VERSION}}),n(6)),o=(Object.defineProperty(t,"CstParser",{enumerable:!0,get:function(){return i.CstParser}}),Object.defineProperty(t,"EmbeddedActionsParser",{enumerable:!0,get:function(){return i.EmbeddedActionsParser}}),Object.defineProperty(t,"ParserDefinitionErrorType",{enumerable:!0,get:function(){return i.ParserDefinitionErrorType}}),Object.defineProperty(t,"EMPTY_ALT",{enumerable:!0,get:function(){return i.EMPTY_ALT}}),n(63)),a=(Object.defineProperty(t,"Lexer",{enumerable:!0,get:function(){return o.Lexer}}),Object.defineProperty(t,"LexerDefinitionErrorType",{enumerable:!0,get:function(){return o.LexerDefinitionErrorType}}),n(26)),s=(Object.defineProperty(t,"createToken",{enumerable:!0,get:function(){return a.createToken}}),Object.defineProperty(t,"createTokenInstance",{enumerable:!0,get:function(){return a.createTokenInstance}}),Object.defineProperty(t,"EOF",{enumerable:!0,get:function(){return a.EOF}}),Object.defineProperty(t,"tokenLabel",{enumerable:!0,get:function(){return a.tokenLabel}}),Object.defineProperty(t,"tokenMatcher",{enumerable:!0,get:function(){return a.tokenMatcher}}),Object.defineProperty(t,"tokenName",{enumerable:!0,get:function(){return a.tokenName}}),n(65)),l=(Object.defineProperty(t,"defaultParserErrorProvider",{enumerable:!0,get:function(){return s.defaultParserErrorProvider}}),n(41)),c=(Object.defineProperty(t,"EarlyExitException",{enumerable:!0,get:function(){return l.EarlyExitException}}),Object.defineProperty(t,"isRecognitionException",{enumerable:!0,get:function(){return l.isRecognitionException}}),Object.defineProperty(t,"MismatchedTokenException",{enumerable:!0,get:function(){return l.MismatchedTokenException}}),Object.defineProperty(t,"NotAllInputParsedException",{enumerable:!0,get:function(){return l.NotAllInputParsedException}}),Object.defineProperty(t,"NoViableAltException",{enumerable:!0,get:function(){return l.NoViableAltException}}),n(242)),u=(Object.defineProperty(t,"defaultLexerErrorProvider",{enumerable:!0,get:function(){return c.defaultLexerErrorProvider}}),n(2)),h=(Object.defineProperty(t,"Alternation",{enumerable:!0,get:function(){return u.Alternation}}),Object.defineProperty(t,"Alternative",{enumerable:!0,get:function(){return u.Alternative}}),Object.defineProperty(t,"NonTerminal",{enumerable:!0,get:function(){return u.NonTerminal}}),Object.defineProperty(t,"Option",{enumerable:!0,get:function(){return u.Option}}),Object.defineProperty(t,"Repetition",{enumerable:!0,get:function(){return u.Repetition}}),Object.defineProperty(t,"RepetitionMandatory",{enumerable:!0,get:function(){return u.RepetitionMandatory}}),Object.defineProperty(t,"RepetitionMandatoryWithSeparator",{enumerable:!0,get:function(){return u.RepetitionMandatoryWithSeparator}}),Object.defineProperty(t,"RepetitionWithSeparator",{enumerable:!0,get:function(){return u.RepetitionWithSeparator}}),Object.defineProperty(t,"Rule",{enumerable:!0,get:function(){return u.Rule}}),Object.defineProperty(t,"Terminal",{enumerable:!0,get:function(){return u.Terminal}}),n(2)),d=(Object.defineProperty(t,"serializeGrammar",{enumerable:!0,get:function(){return h.serializeGrammar}}),Object.defineProperty(t,"serializeProduction",{enumerable:!0,get:function(){return h.serializeProduction}}),Object.defineProperty(t,"GAstVisitor",{enumerable:!0,get:function(){return h.GAstVisitor}}),n(528));Object.defineProperty(t,"generateCstDts",{enumerable:!0,get:function(){return d.generateCstDts}}),t.clearCache=function(){console.warn("The clearCache function was 'soft' removed from the Chevrotain API.\n\t It performs no action other than printing this message.\n\t Please avoid using it as it will be completely removed in the future")};var p=n(537);Object.defineProperty(t,"createSyntaxDiagramsCode",{enumerable:!0,get:function(){return p.createSyntaxDiagramsCode}}),t.Parser=function(){throw new Error("The Parser class has been deprecated, use CstParser or EmbeddedActionsParser instead.\t\nSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_7-0-0")}},function(e,t,n){"use strict";var r=n(399),i=n(12),n=Object.prototype,o=n.hasOwnProperty,a=n.propertyIsEnumerable,n=r(function(){return arguments}())?r:function(e){return i(e)&&o.call(e,"callee")&&!a.call(e,"callee")};e.exports=n},function(e,a,s){"use strict";!function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=s(10),r=s(400),i="object"==t(a)&&a&&!a.nodeType&&a,o=i&&"object"==t(e)&&e&&!e.nodeType&&e,o=o&&o.exports===i?n.Buffer:undefined,i=o?o.isBuffer:undefined;e.exports=i||r}.call(this,s(44)(e))},function(e,a,s){"use strict";!function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=s(210),r="object"==t(a)&&a&&!a.nodeType&&a,i=r&&"object"==t(e)&&e&&!e.nodeType&&e,o=i&&i.exports===r&&n.process,r=function(){try{var e=i&&i.require&&i.require("util").types;return e?e:o&&o.binding&&o.binding("util")}catch(t){}}();e.exports=r}.call(this,s(44)(e))},function(e,t,n){"use strict";var r=n(404),i=n(405),o=n(406),a=n(407),n=n(408);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype["delete"]=i,s.prototype.get=o,s.prototype.has=a,s.prototype.set=n,e.exports=s},function(e,t,n){"use strict";var r=n(33);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},function(e,t,n){"use strict";n=n(19)(Object,"create");e.exports=n},function(e,t,n){"use strict";var r=n(422);e.exports=function(e,t){return e=e.__data__,r(t)?e["string"==typeof t?"string":"hash"]:e.map}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var n=r(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&i.test(e))&&-1<e&&e%1==0&&e<t}},function(e,t,n){"use strict";var r=n(0),i=n(87),o=n(435),a=n(223);e.exports=function(e,t){return r(e)?e:i(e,t)?[e]:o(a(e))}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(20),o=n(12);e.exports=function(e){return"symbol"==r(e)||o(e)&&"[object Symbol]"==i(e)}},function(e,t,n){"use strict";var i=n(88),o=n(33),a=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var r=e[t];a.call(e,t)&&o(r,n)&&(n!==undefined||t in e)||i(e,t,n)}},function(e,t,n){"use strict";var r=n(220),i=n(454),o=n(8);e.exports=function(e){return o(e)?r(e,!0):i(e)}},function(e,t,n){"use strict";var r=n(58),i=n(36),o=n(483),a=n(8),s=n(29),l=n(5),c=Object.prototype.hasOwnProperty,n=o(function(e,t){if(s(t)||a(t))i(t,l(t),e);else for(var n in t)c.call(t,n)&&r(e,n,t[n])});e.exports=n},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n(33),a=n(8),s=n(55),l=n(11);e.exports=function(e,t,n){var r;return!!l(n)&&(!!("number"==(r=i(t))?a(n)&&s(t,n.length):"string"==r&&t in n)&&o(n[t],e))}},function(e,t,n){"use strict";var i=n(493),o=n(494),a=n(13),s=n(0),l=n(61);e.exports=function(e,t,n){var r=s(e)?i:o;return n&&l(e,t,n)&&(t=undefined),r(e,a(t,3))}},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},te=(Object.defineProperty(t,"__esModule",{value:!0}),t.Lexer=t.LexerDefinitionErrorType=void 0,n(238)),s=r(n(99)),l=r(n(9)),c=r(n(0)),ne=r(n(106)),u=r(n(101)),h=r(n(4)),d=r(n(3)),p=r(n(5)),f=r(n(22)),m=r(n(35)),g=r(n(60)),b=r(n(23)),y=r(n(17)),v=n(37),_=n(27),r=n(242),I=n(105),x=((n=t.LexerDefinitionErrorType||(t.LexerDefinitionErrorType={}))[n.MISSING_PATTERN=0]="MISSING_PATTERN",n[n.INVALID_PATTERN=1]="INVALID_PATTERN",n[n.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",n[n.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",n[n.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",n[n.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",n[n.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",n[n.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",n[n.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",n[n.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",n[n.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",n[n.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",n[n.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",n[n.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",n[n.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",n[n.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",n[n.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",{deferDefinitionErrorsHandling:!(n[n.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"),positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:r.defaultLexerErrorProvider,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0});function i(i,o){void 0===o&&(o=x);var a=this;if(this.lexerDefinition=i,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=function(e,t){var n,r,i,o;return!0===a.traceInitPerf?(a.traceInitIndent++,n=new Array(a.traceInitIndent+1).join("\t"),a.traceInitIndent<a.traceInitMaxIdent&&console.log("".concat(n,"--\x3e <").concat(e,">")),r=(i=(0,v.timer)(t)).time,i=i.value,o=10<r?console.warn:console.log,a.traceInitIndent<a.traceInitMaxIdent&&o("".concat(n,"<-- <").concat(e,"> time: ").concat(r,"ms")),a.traceInitIndent--,i):t()},"boolean"==typeof o)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");this.config=(0,g["default"])({},x,o);var e=this.config.traceInitPerf;!0===e?(this.traceInitMaxIdent=Infinity,this.traceInitPerf=!0):"number"==typeof e&&(this.traceInitMaxIdent=e,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",function(){var n,e,t=!0,r=(a.TRACE_INIT("Lexer Config handling",function(){if(a.config.lineTerminatorsPattern===x.lineTerminatorsPattern)a.config.lineTerminatorsPattern=te.LineTerminatorOptimizedTester;else if(a.config.lineTerminatorCharacters===x.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(o.safeMode&&o.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');a.trackStartLines=/full|onlyStart/i.test(a.config.positionTracking),a.trackEndLines=/full/i.test(a.config.positionTracking),n=(0,c["default"])(i)?{modes:{defaultMode:(0,y["default"])(i)},defaultMode:te.DEFAULT_MODE}:(t=!1,y["default"])(i)}),!1===a.config.skipValidations&&(a.TRACE_INIT("performRuntimeChecks",function(){a.lexerDefinitionErrors=a.lexerDefinitionErrors.concat((0,te.performRuntimeChecks)(n,a.trackStartLines,a.config.lineTerminatorCharacters))}),a.TRACE_INIT("performWarningRuntimeChecks",function(){a.lexerDefinitionWarning=a.lexerDefinitionWarning.concat((0,te.performWarningRuntimeChecks)(n,a.trackStartLines,a.config.lineTerminatorCharacters))})),n.modes=n.modes||{},(0,d["default"])(n.modes,function(e,t){n.modes[t]=(0,u["default"])(e,function(e){return(0,f["default"])(e)})}),(0,p["default"])(n.modes));if((0,d["default"])(n.modes,function(t,n){a.TRACE_INIT("Mode: <".concat(n,"> processing"),function(){var e;a.modes.push(n),!1===a.config.skipValidations&&a.TRACE_INIT("validatePatterns",function(){a.lexerDefinitionErrors=a.lexerDefinitionErrors.concat((0,te.validatePatterns)(t,r))}),(0,l["default"])(a.lexerDefinitionErrors)&&((0,_.augmentTokenTypes)(t),a.TRACE_INIT("analyzeTokenTypes",function(){e=(0,te.analyzeTokenTypes)(t,{lineTerminatorCharacters:a.config.lineTerminatorCharacters,positionTracking:o.positionTracking,ensureOptimizations:o.ensureOptimizations,safeMode:o.safeMode,tracer:a.TRACE_INIT})}),a.patternIdxToConfig[n]=e.patternIdxToConfig,a.charCodeToPatternIdxToConfig[n]=e.charCodeToPatternIdxToConfig,a.emptyGroups=(0,g["default"])({},a.emptyGroups,e.emptyGroups),a.hasCustom=e.hasCustom||a.hasCustom,a.canModeBeOptimized[n]=e.canBeOptimized)})}),a.defaultMode=n.defaultMode,!(0,l["default"])(a.lexerDefinitionErrors)&&!a.config.deferDefinitionErrorsHandling)throw e=(0,h["default"])(a.lexerDefinitionErrors,function(e){return e.message}).join("-----------------------\n"),new Error("Errors detected in definition of Lexer:\n"+e);(0,d["default"])(a.lexerDefinitionWarning,function(e){(0,v.PRINT_WARNING)(e.message)}),a.TRACE_INIT("Choosing sub-methods implementations",function(){if(te.SUPPORT_STICKY?(a.chopInput=m["default"],a.match=a.matchWithTest):(a.updateLastIndex=s["default"],a.match=a.matchWithExec),t&&(a.handleModes=s["default"]),!1===a.trackStartLines&&(a.computeNewColumn=m["default"]),!1===a.trackEndLines&&(a.updateTokenEndLineColumnLocation=s["default"]),/full/i.test(a.config.positionTracking))a.createTokenInstance=a.createFullToken;else if(/onlyStart/i.test(a.config.positionTracking))a.createTokenInstance=a.createStartOnlyToken;else{if(!/onlyOffset/i.test(a.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'.concat(a.config.positionTracking,'"'));a.createTokenInstance=a.createOffsetOnlyToken}a.hasCustom?(a.addToken=a.addTokenUsingPush,a.handlePayload=a.handlePayloadWithCustom):(a.addToken=a.addTokenUsingMemberAccess,a.handlePayload=a.handlePayloadNoCustom)}),a.TRACE_INIT("Failed Optimization Warnings",function(){var e=(0,b["default"])(a.canModeBeOptimized,function(e,t,n){return!1===t&&e.push(n),e},[]);if(o.ensureOptimizations&&!(0,l["default"])(e))throw Error("Lexer Modes: < ".concat(e.join(", ")," > cannot be optimized.\n")+'\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')}),a.TRACE_INIT("clearRegExpParserCache",function(){(0,I.clearRegExpParserCache)()}),a.TRACE_INIT("toFastProperties",function(){(0,v.toFastProperties)(a)})})}Object.freeze(x),i.prototype.tokenize=function(e,t){if(void 0===t&&(t=this.defaultMode),(0,l["default"])(this.lexerDefinitionErrors))return this.tokenizeInternal(e,t);throw e=(0,h["default"])(this.lexerDefinitionErrors,function(e){return e.message}).join("-----------------------\n"),new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+e)},i.prototype.tokenizeInternal=function(e,z){var t,n,r,i,M,F,o,a,s=this,l=e,D=l.length,c=0,u=0,H=this.hasCustom?0:Math.floor(e.length/10),h=new Array(H),d=[],p=this.trackStartLines?1:undefined,f=this.trackStartLines?1:undefined,m=(0,te.cloneEmptyGroups)(this.emptyGroups),V=this.trackStartLines,g=this.config.lineTerminatorsPattern,b=0,y=[],v=[],_=[],j=[];function W(){return y}function G(e){e=(0,te.charCodeToOptimizedIndex)(e),e=v[e];return e===undefined?j:e}Object.freeze(j);var U=function U(e){var t;1===_.length&&e.tokenType.PUSH_MODE===undefined?(t=s.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e),d.push({offset:e.startOffset,line:e.startLine,column:e.startColumn,length:e.image.length,message:t})):(_.pop(),e=(0,ne["default"])(_),y=s.patternIdxToConfig[e],v=s.charCodeToPatternIdxToConfig[e],b=y.length,t=s.canModeBeOptimized[e]&&!1===s.config.safeMode,a=v&&t?G:W)};function $(e){_.push(e),v=this.charCodeToPatternIdxToConfig[e],y=this.patternIdxToConfig[e],b=y.length,b=y.length;e=this.canModeBeOptimized[e]&&!1===this.config.safeMode;a=v&&e?G:W}$.call(this,z);for(var Y=this.config.recoveryEnabled;c<D;){for(var I=null,X=l.charCodeAt(c),q=a(X),K=q.length,x=0;x<K;x++){var E,S=(E=q[x]).pattern,T=null;if(!1!==(k=E["short"])?X===k&&(I=S):!0===E.isCustom?null!==(o=S.exec(l,c,h,m))?(I=o[0],o.payload!==undefined&&(T=o.payload)):I=null:(this.updateLastIndex(S,c),I=this.match(S,e,c)),null!==I){if((r=E.longerAlt)!==undefined)for(var Z=r.length,C=0;C<Z;C++){var w=y[r[C]],B=w.pattern,Q=null;if(!0===w.isCustom?null!==(o=B.exec(l,c,h,m))?(n=o[0],o.payload!==undefined&&(Q=o.payload)):n=null:(this.updateLastIndex(B,c),n=this.match(B,e,c)),n&&n.length>I.length){I=n,T=Q,E=w;break}}break}}if(null!==I){if(O=I.length,(A=E.group)!==undefined&&(i=E.tokenTypeIdx,i=this.createTokenInstance(I,c,i,E.tokenType,p,f,O),this.handlePayload(i,T),!1===A?u=this.addToken(h,u,i):m[A].push(i)),e=this.chopInput(e,O),c+=O,f=this.computeNewColumn(f,O),!0===V&&!0===E.canLineTerminator){var J,R=0,N=void 0;for(g.lastIndex=0;!0===(J=g.test(I))&&(N=g.lastIndex-1,R++),!0===J;);0!==R&&(p+=R,this.updateTokenEndLineColumnLocation(i,A,N,R,p,f=O-N,O))}this.handleModes(E,U,$,i)}else{for(var A=c,O=p,ee=f,L=!1===Y;!1===L&&c<D;)for(e=this.chopInput(e,1),c++,t=0;t<b;t++){var k,P=y[t],S=P.pattern;if(!1!==(k=P["short"])?l.charCodeAt(c)===k&&(L=!0):L=!0===P.isCustom?null!==S.exec(l,c,h,m):(this.updateLastIndex(S,c),null!==S.exec(e)),!0===L)break}if(F=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(l,A,M=c-A,O,ee),d.push({offset:A,line:O,column:ee,length:M,message:F}),!1===Y)break}}return this.hasCustom||(h.length=u),{tokens:h,groups:m,errors:d}},i.prototype.handleModes=function(e,t,n,r){var i;!0===e.pop?(i=e.push,t(r),i!==undefined&&n.call(this,i)):e.push!==undefined&&n.call(this,e.push)},i.prototype.chopInput=function(e,t){return e.substring(t)},i.prototype.updateLastIndex=function(e,t){e.lastIndex=t},i.prototype.updateTokenEndLineColumnLocation=function(e,t,n,r,i,o,a){t!==undefined&&(n=(t=n===a-1)?-1:0,1===r&&!0==t||(e.endLine=i+n,e.endColumn=o-1-n))},i.prototype.computeNewColumn=function(e,t){return e+t},i.prototype.createOffsetOnlyToken=function(e,t,n,r){return{image:e,startOffset:t,tokenTypeIdx:n,tokenType:r}},i.prototype.createStartOnlyToken=function(e,t,n,r,i,o){return{image:e,startOffset:t,startLine:i,startColumn:o,tokenTypeIdx:n,tokenType:r}},i.prototype.createFullToken=function(e,t,n,r,i,o,a){return{image:e,startOffset:t,endOffset:t+a-1,startLine:i,endLine:i,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:r}},i.prototype.addTokenUsingPush=function(e,t,n){return e.push(n),t},i.prototype.addTokenUsingMemberAccess=function(e,t,n){return e[t]=n,++t},i.prototype.handlePayloadNoCustom=function(e,t){},i.prototype.handlePayloadWithCustom=function(e,t){null!==t&&(e.payload=t)},i.prototype.matchWithTest=function(e,t,n){return!0===e.test(t)?t.substring(n,e.lastIndex):null},i.prototype.matchWithExec=function(e,t){t=e.exec(t);return null!==t?t[0]:null},i.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",i.NA=/NOT_APPLICABLE/,t.Lexer=i},function(e,t,n){"use strict";e.exports=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i}},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.defaultGrammarValidatorErrorProvider=t.defaultGrammarResolverErrorProvider=t.defaultParserErrorProvider=void 0,n(26)),a=r(n(40)),o=r(n(4)),s=r(n(23)),l=n(2),c=n(2);t.defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var t=e.expected,n=e.actual,e=(e.previous,e.ruleName,(0,i.hasTokenLabel)(t)?"--\x3e ".concat((0,i.tokenLabel)(t)," <--"):"token of type --\x3e ".concat(t.name," <--"));return"Expecting ".concat(e," but found --\x3e '").concat(n.image,"' <--")},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;e.ruleName;return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage:function(e){var t=e.expectedPathsPerAlt,n=e.actual,r=(e.previous,e.customUserDescription),e=(e.ruleName,"Expecting: "),n="\nbut found: '"+(0,a["default"])(n).image+"'";return r?e+r+n:(r=(0,s["default"])(t,function(e,t){return e.concat(t)},[]),t=(0,o["default"])(r,function(e){return"[".concat((0,o["default"])(e,function(e){return(0,i.tokenLabel)(e)}).join(", "),"]")}),r=(0,o["default"])(t,function(e,t){return"  ".concat(t+1,". ").concat(e)}),e+"one of these possible Token sequences:\n".concat(r.join("\n"))+n)},buildEarlyExitMessage:function(e){var t=e.expectedIterationPaths,n=e.actual,r=e.customUserDescription,e=(e.ruleName,"Expecting: "),n="\nbut found: '"+(0,a["default"])(n).image+"'";return r?e+r+n:(r=(0,o["default"])(t,function(e){return"[".concat((0,o["default"])(e,function(e){return(0,i.tokenLabel)(e)}).join(","),"]")}),e+("expecting at least one iteration which starts with one of these possible Token sequences::\n  "+"<".concat(r.join(" ,"),">"))+n)}},Object.freeze(t.defaultParserErrorProvider),t.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"}},t.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,t){var e=e.name,n=(0,a["default"])(t),r=n.idx,i=(0,c.getProductionDslName)(n),n=(n=n)instanceof l.Terminal?n.terminalType.name:n instanceof l.NonTerminal?n.nonTerminalName:"",o=0<r,i="->".concat(i).concat(o?r:"","<- ").concat(n?"with argument: ->".concat(n,"<-"):"","\n                  appears more than once (").concat(t.length," times) in the top level rule: ->").concat(e,"<-.                  \n                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ");return i=(i=i.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildNamespaceConflictError:function(e){return"Namespace conflict found in grammar.\n"+"The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <".concat(e.name,">.\n")+"To resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(e){var t=(0,o["default"])(e.prefixPath,function(e){return(0,i.tokenLabel)(e)}).join(", "),n=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <".concat(e.ambiguityIndices.join(" ,"),"> due to common lookahead prefix\n")+"in <OR".concat(n,"> inside <").concat(e.topLevelRule.name,"> Rule,\n")+"<".concat(t,"> may appears as a prefix path in all these alternatives.\n")+"See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(e){var t=(0,o["default"])(e.prefixPath,function(e){return(0,i.tokenLabel)(e)}).join(", "),n=0===e.alternation.idx?"":e.alternation.idx,n="Ambiguous Alternatives Detected: <".concat(e.ambiguityIndices.join(" ,"),"> in <OR").concat(n,">")+" inside <".concat(e.topLevelRule.name,"> Rule,\n")+"<".concat(t,"> may appears as a prefix path in all these alternatives.\n");return n+="See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES\nFor Further details."},buildEmptyRepetitionError:function(e){var t=(0,c.getProductionDslName)(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <".concat(t,"> within Rule <").concat(e.topLevelRule.name,"> can never consume any tokens.\n")+"This could lead to an infinite loop."},buildTokenNameError:function(e){return"deprecated"},buildEmptyAlternationError:function(e){return"Ambiguous empty alternative: <".concat(e.emptyChoiceIdx+1,">")+" in <OR".concat(e.alternation.idx,"> inside <").concat(e.topLevelRule.name,"> Rule.\n")+"Only the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(e){return"An Alternation cannot have more than 256 alternatives:\n"+"<OR".concat(e.alternation.idx,"> inside <").concat(e.topLevelRule.name,"> Rule.\n has ").concat(e.alternation.definition.length+1," alternatives.")},buildLeftRecursionError:function(e){var t=e.topLevelRule.name,e=(0,o["default"])(e.leftRecursionPath,function(e){return e.name}),e="".concat(t," --\x3e ").concat(e.concat([t]).join(" --\x3e "));return"Left Recursion found in grammar.\n"+"rule: <".concat(t,"> can be invoked from itself (directly or indirectly)\n")+"without consuming any Tokens. The grammar path that causes this is: \n ".concat(e,"\n")+" To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_factoring."},buildInvalidRuleNameError:function(e){return"deprecated"},buildDuplicateRuleNameError:function(e){var t=e.topLevelRule instanceof l.Rule?e.topLevelRule.name:e.topLevelRule;return"Duplicate definition, rule: ->".concat(t,"<- is already defined in the grammar: ->").concat(e.grammarName,"<-")}}},function(e,t,n){"use strict";function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||r({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var i,o,a,s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},l=function(e){return e&&e.__esModule?e:{"default":e}},g=(Object.defineProperty(t,"__esModule",{value:!0}),t.areTokenCategoriesNotUsed=t.isStrictPrefixOfPath=t.containsPath=t.getLookaheadPathsForOptionalProd=t.getLookaheadPathsForOr=t.lookAheadSequenceFromAlternatives=t.buildSingleAlternativeLookaheadFunction=t.buildAlternativesLookAheadFunc=t.buildLookaheadFuncForOptionalProd=t.buildLookaheadFuncForOr=t.getProdType=t.PROD_TYPE=void 0,l(n(9))),c=l(n(16)),u=l(n(62)),b=l(n(4)),y=l(n(3)),f=l(n(7)),m=l(n(23)),v=n(67),l=n(90),h=n(27),d=n(2),n=n(2);(a=o=t.PROD_TYPE||(t.PROD_TYPE={}))[a.OPTION=0]="OPTION",a[a.REPETITION=1]="REPETITION",a[a.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",a[a.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",a[a.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",a[a.ALTERNATION=5]="ALTERNATION",t.getProdType=function(e){if(e instanceof d.Option)return o.OPTION;if(e instanceof d.Repetition)return o.REPETITION;if(e instanceof d.RepetitionMandatory)return o.REPETITION_MANDATORY;if(e instanceof d.RepetitionMandatoryWithSeparator)return o.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof d.RepetitionWithSeparator)return o.REPETITION_WITH_SEPARATOR;if(e instanceof d.Alternation)return o.ALTERNATION;throw Error("non exhaustive match")},t.buildLookaheadFuncForOr=function(e,t,n,r,i,o){return e=B(e,t,n),o(e,r,A(e)?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher,i)},t.buildLookaheadFuncForOptionalProd=function(e,t,n,r,i,o){return e=R(e,t,i,n),t=A(e)?h.tokenStructuredMatcherNoCategories:h.tokenStructuredMatcher,o(e[0],t,r)},t.buildAlternativesLookAheadFunc=function(h,e,d,t){var n,p=h.length,r=(0,u["default"])(h,function(e){return(0,u["default"])(e,function(e){return 1===e.length})});return e?function(e){for(var t=(0,b["default"])(e,function(e){return e.GATE}),n=0;n<p;n++){var r=h[n],i=r.length,o=t[n];if(o===undefined||!1!==o.call(this))e:for(var a=0;a<i;a++){for(var s=r[a],l=s.length,c=0;c<l;c++){var u=this.LA(c+1);if(!1===d(u,s[c]))continue e}return n}}return undefined}:r&&!t?(e=(0,b["default"])(h,function(e){return(0,c["default"])(e)}),n=(0,m["default"])(e,function(t,e,n){return(0,y["default"])(e,function(e){(0,f["default"])(t,e.tokenTypeIdx)||(t[e.tokenTypeIdx]=n),(0,y["default"])(e.categoryMatches,function(e){(0,f["default"])(t,e)||(t[e]=n)})}),t},{}),function(){var e=this.LA(1);return n[e.tokenTypeIdx]}):function(){for(var e=0;e<p;e++){var t=h[e],n=t.length;e:for(var r=0;r<n;r++){for(var i=t[r],o=i.length,a=0;a<o;a++){var s=this.LA(a+1);if(!1===d(s,i[a]))continue e}return e}}return undefined}},t.buildSingleAlternativeLookaheadFunction=function(o,a,e){var t,n,r=(0,u["default"])(o,function(e){return 1===e.length}),s=o.length;return r&&!e?1===(r=(0,c["default"])(o)).length&&(0,g["default"])(r[0].categoryMatches)?(t=r[0].tokenTypeIdx,function(){return this.LA(1).tokenTypeIdx===t}):(n=(0,m["default"])(r,function(t,e,n){return t[e.tokenTypeIdx]=!0,(0,y["default"])(e.categoryMatches,function(e){t[e]=!0}),t},[]),function(){var e=this.LA(1);return!0===n[e.tokenTypeIdx]}):function(){e:for(var e=0;e<s;e++){for(var t=o[e],n=t.length,r=0;r<n;r++){var i=this.LA(r+1);if(!1===a(i,t[r]))continue e}return!0}return!1}};p=l.RestWalker,s(I,p),I.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},I.prototype.checkIsTarget=function(e,t,n,r){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=n.concat(r),!0)},I.prototype.walkOption=function(e,t,n){this.checkIsTarget(e,o.OPTION,t,n)||p.prototype.walkOption.call(this,e,t,n)},I.prototype.walkAtLeastOne=function(e,t,n){this.checkIsTarget(e,o.REPETITION_MANDATORY,t,n)||p.prototype.walkOption.call(this,e,t,n)},I.prototype.walkAtLeastOneSep=function(e,t,n){this.checkIsTarget(e,o.REPETITION_MANDATORY_WITH_SEPARATOR,t,n)||p.prototype.walkOption.call(this,e,t,n)},I.prototype.walkMany=function(e,t,n){this.checkIsTarget(e,o.REPETITION,t,n)||p.prototype.walkOption.call(this,e,t,n)},I.prototype.walkManySep=function(e,t,n){this.checkIsTarget(e,o.REPETITION_WITH_SEPARATOR,t,n)||p.prototype.walkOption.call(this,e,t,n)};var p,_=I;function I(e,t,n){var r=p.call(this)||this;return r.topProd=e,r.targetOccurrence=t,r.targetProdType=n,r}x=n.GAstVisitor,s(S,x),S.prototype.checkIsTarget=function(e,t){e.idx!==this.targetOccurrence||this.targetProdType!==t||this.targetRef!==undefined&&e!==this.targetRef||(this.result=e.definition)},S.prototype.visitOption=function(e){this.checkIsTarget(e,o.OPTION)},S.prototype.visitRepetition=function(e){this.checkIsTarget(e,o.REPETITION)},S.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,o.REPETITION_MANDATORY)},S.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,o.REPETITION_MANDATORY_WITH_SEPARATOR)},S.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,o.REPETITION_WITH_SEPARATOR)},S.prototype.visitAlternation=function(e){this.checkIsTarget(e,o.ALTERNATION)};var x,E=S;function S(e,t,n){var r=x.call(this)||this;return r.targetOccurrence=e,r.targetProdType=t,r.targetRef=n,r.result=[],r}function T(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=[];return t}function C(e){for(var t=[""],n=0;n<e.length;n++){for(var r=e[n],i=[],o=0;o<t.length;o++){var a=t[o];i.push(a+"_"+r.tokenTypeIdx);for(var s=0;s<r.categoryMatches.length;s++){var l="_"+r.categoryMatches[s];i.push(a+l)}}t=i}return t}function w(e,c){for(var e=(0,b["default"])(e,function(e){return(0,v.possiblePathsFrom)([e],1)}),u=T(e.length),h=(0,b["default"])(e,function(e){var t={};return(0,y["default"])(e,function(e){e=C(e.partialPath);(0,y["default"])(e,function(e){t[e]=!0})}),t}),d=e,p=1;p<=c;p++)for(var f=d,d=T(f.length),m=function m(t){for(var e=f[t],n=0;n<e.length;n++){var r=e[n].partialPath,i=e[n].suffixDef,o=C(r);if(function(e,t,n){for(var r=0;r<e.length;r++)if(r!==n)for(var i=e[r],o=0;o<t.length;o++)if(!0===i[t[o]])return!1;return!0}(h,o,t)||(0,g["default"])(i)||r.length===c){var a=u[t];if(!1===N(a,r)){a.push(r);for(var s=0;s<o.length;s++){var l=o[s];h[t][l]=!0}}}else{a=(0,v.possiblePathsFrom)(i,p+1,r);d[t]=d[t].concat(a),(0,y["default"])(a,function(e){e=C(e.partialPath);(0,y["default"])(e,function(e){h[t][e]=!0})})}}},t=0;t<f.length;t++)m(t);return u}function B(e,t,n,r){e=new E(e,o.ALTERNATION,r);return t.accept(e),w(e.result,n)}function R(e,t,n,r){var i=new E(e,n),i=(t.accept(i),i.result),t=new _(t,e,n).startWalking();return w([new d.Alternative({definition:i}),new d.Alternative({definition:t})],r)}function N(e,t){e:for(var n=0;n<e.length;n++){var r=e[n];if(r.length===t.length){for(var i=0;i<r.length;i++){var o=t[i],a=r[i];if(!1==(o===a||a.categoryMatchesMap[o.tokenTypeIdx]!==undefined))continue e}return!0}}return!1}function A(e){return(0,u["default"])(e,function(e){return(0,u["default"])(e,function(e){return(0,u["default"])(e,function(e){return(0,g["default"])(e.categoryMatches)})})})}t.lookAheadSequenceFromAlternatives=w,t.getLookaheadPathsForOr=B,t.getLookaheadPathsForOptionalProd=R,t.containsPath=N,t.isStrictPrefixOfPath=function(e,n){return e.length<n.length&&(0,u["default"])(e,function(e,t){t=n[t];return e===t||t.categoryMatchesMap[e.tokenTypeIdx]})},t.areTokenCategoriesNotUsed=A},function(e,t,n){"use strict";function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||r({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var i,o,a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=function(e){return e&&e.__esModule?e:{"default":e}},l=(Object.defineProperty(t,"__esModule",{value:!0}),t.nextPossibleTokensAfter=t.possiblePathsFrom=t.NextTerminalAfterAtLeastOneSepWalker=t.NextTerminalAfterAtLeastOneWalker=t.NextTerminalAfterManySepWalker=t.NextTerminalAfterManyWalker=t.AbstractNextTerminalAfterProductionWalker=t.NextAfterTokenWalker=t.AbstractNextPossibleTokensWalker=void 0,n(90)),c=s(n(40)),w=s(n(9)),B=s(n(107)),R=s(n(91)),N=s(n(106)),u=s(n(3)),A=s(n(17)),h=n(234),O=n(2),s=(o=l.RestWalker,a(d,o),d.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=(0,A["default"])(this.path.ruleStack).reverse(),this.occurrenceStack=(0,A["default"])(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},d.prototype.walk=function(e,t){void 0===t&&(t=[]),this.found||o.prototype.walk.call(this,e,t)},d.prototype.walkProdRef=function(e,t,n){e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence&&(n=t.concat(n),this.updateExpectedNext(),this.walk(e.referencedRule,n))},d.prototype.updateExpectedNext=function(){(0,w["default"])(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},d);function d(e,t){var n=o.call(this)||this;return n.topProd=e,n.path=t,n.possibleTokTypes=[],n.nextProductionName="",n.nextProductionOccurrence=0,n.found=!1,n.isAtEndOfPath=!1,n}t.AbstractNextPossibleTokensWalker=s;a(f,p=s),f.prototype.walkTerminal=function(e,t,n){this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found&&(e=t.concat(n),n=new O.Alternative({definition:e}),this.possibleTokTypes=(0,h.first)(n),this.found=!0)};var p,n=f;function f(e,t){e=p.call(this,e,t)||this;return e.path=t,e.nextTerminalName="",e.nextTerminalOccurrence=0,e.nextTerminalName=e.path.lastTok.name,e.nextTerminalOccurrence=e.path.lastTokOccurrence,e}t.NextAfterTokenWalker=n;m=l.RestWalker,a(g,m),g.prototype.startWalking=function(){return this.walk(this.topRule),this.result};var m,s=g;function g(e,t){var n=m.call(this)||this;return n.topRule=e,n.occurrence=t,n.result={token:undefined,occurrence:undefined,isEndOfRule:undefined},n}t.AbstractNextTerminalAfterProductionWalker=s;a(y,b=s),y.prototype.walkMany=function(e,t,n){var r;e.idx===this.occurrence?(r=(0,c["default"])(t.concat(n)),this.result.isEndOfRule=r===undefined,r instanceof O.Terminal&&(this.result.token=r.terminalType,this.result.occurrence=r.idx)):b.prototype.walkMany.call(this,e,t,n)};var b,n=y;function y(){return null!==b&&b.apply(this,arguments)||this}t.NextTerminalAfterManyWalker=n;a(_,v=s),_.prototype.walkManySep=function(e,t,n){var r;e.idx===this.occurrence?(r=(0,c["default"])(t.concat(n)),this.result.isEndOfRule=r===undefined,r instanceof O.Terminal&&(this.result.token=r.terminalType,this.result.occurrence=r.idx)):v.prototype.walkManySep.call(this,e,t,n)};var v,l=_;function _(){return null!==v&&v.apply(this,arguments)||this}t.NextTerminalAfterManySepWalker=l;a(x,I=s),x.prototype.walkAtLeastOne=function(e,t,n){var r;e.idx===this.occurrence?(r=(0,c["default"])(t.concat(n)),this.result.isEndOfRule=r===undefined,r instanceof O.Terminal&&(this.result.token=r.terminalType,this.result.occurrence=r.idx)):I.prototype.walkAtLeastOne.call(this,e,t,n)};var I,n=x;function x(){return null!==I&&I.apply(this,arguments)||this}t.NextTerminalAfterAtLeastOneWalker=n;a(S,E=s),S.prototype.walkAtLeastOneSep=function(e,t,n){var r;e.idx===this.occurrence?(r=(0,c["default"])(t.concat(n)),this.result.isEndOfRule=r===undefined,r instanceof O.Terminal&&(this.result.token=r.terminalType,this.result.occurrence=r.idx)):E.prototype.walkAtLeastOneSep.call(this,e,t,n)};var E,l=S;function S(){return null!==E&&E.apply(this,arguments)||this}t.NextTerminalAfterAtLeastOneSepWalker=l,t.possiblePathsFrom=function T(t,n,r){void 0===r&&(r=[]),r=(0,A["default"])(r);var i=[],o=0;function a(e){return e=T(e.concat((0,R["default"])(t,o+1)),n,r),i.concat(e)}for(;r.length<n&&o<t.length;){var e=t[o];if(e instanceof O.Alternative)return a(e.definition);if(e instanceof O.NonTerminal)return a(e.definition);if(e instanceof O.Option)i=a(e.definition);else{if(e instanceof O.RepetitionMandatory)return a(s=e.definition.concat([new O.Repetition({definition:e.definition})]));if(e instanceof O.RepetitionMandatoryWithSeparator)return a(s=[new O.Alternative({definition:e.definition}),new O.Repetition({definition:[new O.Terminal({terminalType:e.separator})].concat(e.definition)})]);if(e instanceof O.RepetitionWithSeparator)i=a(s=e.definition.concat([new O.Repetition({definition:[new O.Terminal({terminalType:e.separator})].concat(e.definition)})]));else if(e instanceof O.Repetition){var s=e.definition.concat([new O.Repetition({definition:e.definition})]);i=a(s)}else{if(e instanceof O.Alternation)return(0,u["default"])(e.definition,function(e){!1===(0,w["default"])(e.definition)&&(i=a(e.definition))}),i;if(!(e instanceof O.Terminal))throw Error("non exhaustive match");r.push(e.terminalType)}}o++}return i.push({partialPath:r,suffixDef:(0,R["default"])(t,o)}),i},t.nextPossibleTokensAfter=function(e,t,n,r){var i="EXIT_NONE_TERMINAL",o=[i],a="EXIT_ALTERNATIVE",s=!1,l=t.length,c=l-r-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!(0,w["default"])(h);){var d=h.pop();if(d===a)s&&(0,N["default"])(h).idx<=c&&h.pop();else{var p=d.def,f=d.idx,m=d.ruleStack,g=d.occurrenceStack;if(!(0,w["default"])(p)){var b=p[0];if(b===i){var y={idx:f,def:(0,R["default"])(p),ruleStack:(0,B["default"])(m),occurrenceStack:(0,B["default"])(g)};h.push(y)}else if(b instanceof O.Terminal)if(f<l-1){d=f+1;n(t[d],b.terminalType)&&(y={idx:d,def:(0,R["default"])(p),ruleStack:m,occurrenceStack:g},h.push(y))}else{if(f!==l-1)throw Error("non exhaustive match");u.push({nextTokenType:b.terminalType,nextTokenOccurrence:b.idx,ruleStack:m,occurrenceStack:g}),s=!0}else if(b instanceof O.NonTerminal){var d=(0,A["default"])(m),v=(d.push(b.nonTerminalName),(0,A["default"])(g)),y=(v.push(b.idx),{idx:f,def:b.definition.concat(o,(0,R["default"])(p)),ruleStack:d,occurrenceStack:v});h.push(y)}else if(b instanceof O.Option){var _={idx:f,def:(0,R["default"])(p),ruleStack:m,occurrenceStack:g},I=(h.push(_),h.push(a),{idx:f,def:b.definition.concat((0,R["default"])(p)),ruleStack:m,occurrenceStack:g});h.push(I)}else if(b instanceof O.RepetitionMandatory){var x=new O.Repetition({definition:b.definition,idx:b.idx}),y={idx:f,def:b.definition.concat([x],(0,R["default"])(p)),ruleStack:m,occurrenceStack:g};h.push(y)}else if(b instanceof O.RepetitionMandatoryWithSeparator){var E=new O.Terminal({terminalType:b.separator}),x=new O.Repetition({definition:[E].concat(b.definition),idx:b.idx}),y={idx:f,def:b.definition.concat([x],(0,R["default"])(p)),ruleStack:m,occurrenceStack:g};h.push(y)}else if(b instanceof O.RepetitionWithSeparator){var _={idx:f,def:(0,R["default"])(p),ruleStack:m,occurrenceStack:g},E=(h.push(_),h.push(a),new O.Terminal({terminalType:b.separator})),S=new O.Repetition({definition:[E].concat(b.definition),idx:b.idx}),I={idx:f,def:b.definition.concat([S],(0,R["default"])(p)),ruleStack:m,occurrenceStack:g};h.push(I)}else if(b instanceof O.Repetition){_={idx:f,def:(0,R["default"])(p),ruleStack:m,occurrenceStack:g},S=(h.push(_),h.push(a),new O.Repetition({definition:b.definition,idx:b.idx})),I={idx:f,def:b.definition.concat([S],(0,R["default"])(p)),ruleStack:m,occurrenceStack:g};h.push(I)}else if(b instanceof O.Alternation)for(var T=b.definition.length-1;0<=T;T--){var C={idx:f,def:b.definition[T].definition.concat((0,R["default"])(p)),ruleStack:m,occurrenceStack:g};h.push(C),h.push(a)}else if(b instanceof O.Alternative)h.push({idx:f,def:b.definition.concat((0,R["default"])(p)),ruleStack:m,occurrenceStack:g});else{if(!(b instanceof O.Rule))throw Error("non exhaustive match");h.push(function(e,t,n,r){n=(0,A["default"])(n),n.push(e.name),r=(0,A["default"])(r);return r.push(1),{idx:t,def:e.definition,ruleStack:n,occurrenceStack:r}}(b,f,m,g))}}}}return u}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=function(){return this}();try{i=i||new Function("return this")()}catch(o){"object"===("undefined"==typeof window?"undefined":r(window))&&(i=window)}e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=t.FormulaParser=void 0;var r=n(47),i=n(43);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}var s=function(t){var e,n;function r(){var e=t.call(this,i.allTokens)||this;return a(o(e),"expr",e.RULE("expr",function(){e.SUBRULE(e.commaExpression)})),a(o(e),"commaExpression",e.RULE("commaExpression",function(){e.SUBRULE(e.binaryExpression),e.MANY(function(){e.CONSUME(i.token.Comma),e.SUBRULE2(e.binaryExpression)})})),a(o(e),"binaryExpression",e.RULE("binaryExpression",function(){e.SUBRULE(e.unaryExpression),e.MANY(function(){e.OR(e.c1||(e.c1=[{ALT:function(){e.CONSUME(i.token.LogicOr)}},{ALT:function(){e.CONSUME(i.token.LogicAnd)}},{ALT:function(){e.CONSUME(i.token.BitAnd)}},{ALT:function(){e.CONSUME(i.token.Equal)}},{ALT:function(){e.CONSUME(i.token.Compare)}},{ALT:function(){e.CONSUME(i.token.Addition)}},{ALT:function(){e.CONSUME(i.token.Multiplication)}}])),e.SUBRULE2(e.unaryExpression)})})),a(o(e),"unaryExpression",e.RULE("unaryExpression",function(){e.MANY(function(){e.CONSUME(i.token.Unary)}),e.SUBRULE(e.atomicExpression)})),a(o(e),"atomicExpression",e.RULE("atomicExpression",function(){e.OR(e.c2||(e.c2=[{ALT:function(){e.SUBRULE(e.array)}},{ALT:function(){e.SUBRULE(e.func)}},{ALT:function(){e.SUBRULE(e.group)}},{ALT:function(){e.SUBRULE(e.base)}}])),e.MANY(function(){e.CONSUME(i.token.LSquare),e.SUBRULE(e.expr),e.CONSUME(i.token.RSquare)})})),a(o(e),"array",e.RULE("array",function(){e.CONSUME(i.token.LSquare),e.MANY_SEP({SEP:i.token.Comma,DEF:function(){e.SUBRULE(e.binaryExpression)}}),e.CONSUME(i.token.RSquare)})),a(o(e),"func",e.RULE("func",function(){e.CONSUME(i.token.Func),e.CONSUME(i.token.LParen),e.OPTION(function(){e.MANY_SEP({SEP:i.token.Comma,DEF:function(){e.SUBRULE(e.binaryExpression)}})}),e.CONSUME(i.token.RParen)})),a(o(e),"group",e.RULE("group",function(){e.CONSUME(i.token.LParen),e.AT_LEAST_ONE_SEP({SEP:i.token.Comma,DEF:function(){e.SUBRULE(e.expr)}}),e.CONSUME(i.token.RParen)})),a(o(e),"base",e.RULE("base",function(){e.OR(e.c3||(e.c3=[{ALT:function(){e.CONSUME(i.token.String)}},{ALT:function(){e.CONSUME(i.token.Number)}},{ALT:function(){e.CONSUME(i.token.Date)}},{ALT:function(){e.CONSUME(i.token.Boolean)}},{ALT:function(){e.CONSUME(i.token.Empty)}},{ALT:function(){e.CONSUME(i.token.NaN)}}]))})),e.performSelfAnalysis(),e}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,l(e,n),r}(r.CstParser),c=(t.FormulaParser=s,function c(){return new s});t["default"]=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStringType=t.isNumberType=t.isDateType=t.isBooleanType=t.isArrayType=t.isAnyType=t["default"]=void 0;var s=n(47),l=n(43),a=o(n(3)),r=o(n(0)),i=o(n(5)),c=o(n(240)),u=o(n(85)),h=o(n(69));function o(e){return e&&e.__esModule?e:{"default":e}}function d(e,t){return(d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function d(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}var p=function p(){for(var t=[],e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(0,a["default"])(n,function(e){e&&(t=t.concat(e))}),t},f=function f(e){return[].concat(e).sort(function(e,t){return e.startOffset-t.startOffset})},m=function m(e,t,n){switch(e){case"+":return v(t)||v(n)||E(t)&&!y(t)||E(n)&&!y(n)?"string":"number";case"-":if((y(t)||x(t))&&(y(n)||x(n))||E(t)||E(n))return"number";throw new Error(JSON.stringify({type:"visit",token:e,errorType:"operation",errorText:BI.i18nText("BI-Conf_Formula_Valid")}));case"*":case"/":if(y(t)&&y(n)||E(t)||E(n))return"number";throw new Error(JSON.stringify({type:"visit",token:e,errorType:"operation",errorText:BI.i18nText("BI-Conf_Formula_Valid")}))}},g=function g(e,t,n){var r=e.slice(),t=t.slice(),e=e.map(function(e){return e.image}).indexOf(n.image);if(-1<e){var i=t.slice().splice(e,2),o=i[0],i=i[1],a="null";if((0,s.tokenMatcher)(n,l.token.Addition)||(0,s.tokenMatcher)(n,l.token.Multiplication))a=m(n.image,o,i);else if((0,s.tokenMatcher)(n,l.token.Compare)){if(null!==o&&null!==i&&S(o)!==S(i))throw new Error(JSON.stringify({type:"visit",token:n.image,errorType:"compare",errorText:BI.i18nText("BI-Basic_Formula_Invalid")}));a="boolean"}else if((0,s.tokenMatcher)(n,l.token.Equal))a="boolean";else if((0,s.tokenMatcher)(n,l.token.BitAnd))a="string";else if((0,s.tokenMatcher)(n,l.token.LogicAnd)||(0,s.tokenMatcher)(n,l.token.LogicOr)){if(!(y(o)&&y(i)||_(o)&&_(i)))throw new Error(JSON.stringify({type:"visit",token:n.image,errorType:"logic",errorText:BI.i18nText("BI-Basic_Formula_Invalid")}));a=o||i}r.splice(e,1),t.splice(e,2,a)}return{resultTokens:r,resultOperands:t}},b=function b(){var r,e=(0,h["default"])().getBaseCstVisitorConstructor(),t=function t(e){r=e},o=function o(t,e){var n;if(r)return n=(0,i["default"])(r),-1<(0,c["default"])(n,function(e){return e===t})?(0,u["default"])(r,t).apply(void 0,e):null;throw new Error("Interpreter is not set formula")};return{interpreter:new(function(t){var e;function n(){var e=t.call(this)||this;return e.validateVisitor(),e}e=t,(r=n).prototype=Object.create(e.prototype),r.prototype.constructor=r,d(r,e);var r=n.prototype;return r.expr=function(e){return this.visit(e.commaExpression)},r.commaExpression=function(e){e=e.binaryExpression.slice(-1)[0];return this.visit(e)},r.binaryExpression=function(e){var t=this,n=p(e.Multiplication,e.Addition,e.Compare,e.Equal,e.BitAnd,e.LogicAnd,e.LogicOr),r=f(n),i=[];return(0,a["default"])(e.unaryExpression,function(e){i.push(t.visit(e))}),(0,a["default"])(n,function(e){e=g(r,i,e);r=e.resultTokens,i=e.resultOperands}),i[0]},r.unaryExpression=function(e){var t=this.visit(e.atomicExpression);return e.Unary&&(e=e.Unary.slice().reverse(),(0,a["default"])(e,function(e){t=(0,s.tokenMatcher)(e,l.token.Minus)||(0,s.tokenMatcher)(e,l.token.Plus)?"number":"boolean"})),t},r.atomicExpression=function(e){var t,n=this;return e.base?t=this.visit(e.base):e.group?t=this.visit(e.group):e.array?t=this.visit(e.array):e.func&&(t=this.visit(e.func)),e.expr&&(0,a["default"])(e.expr,function(e){e=n.visit(e);t=t[e]}),t},r.array=function(e){var t=this,n=[];return(0,a["default"])(e.binaryExpression,function(e){n.push(t.visit(e))}),n},r.func=function i(e){var t=this,i=e.Func[0].image,n=[];return(0,a["default"])(e.binaryExpression,function(e){n.push(t.visit(e))}),o(i,n)},r.group=function(e){return this.visit(e.expr)},r.base=function(e){var t;return e.String?null!==(t=e.String[0].image)?"string:".concat(t):"string":e.Number?null!==(t=e.Number[0].image)?"number:".concat(t):"number":e.Date?null!==(t=e.Date[0].image)?"date:".concat(t):"date":e.Boolean?null!==(t=e.Boolean[0].image)?"boolean:".concat(t):"boolean":e.Empty?"null":e.NaN?"number":void 0},n}(e)),setFormula:t}},y=function y(e){return null===e||BI.startWith(e,"number")||BI.startWith(e,"boolean")},v=(t.isNumberType=y,function v(e){return null===e||BI.startWith(e,"string")}),_=(t.isStringType=v,function _(e){return null===e||BI.startWith(e,"boolean")}),I=(t.isBooleanType=_,function I(e){return(0,r["default"])(e)||null===e}),x=(t.isArrayType=I,function x(e){return null===e||BI.startWith(e,"date")}),E=(t.isDateType=x,function E(e){return"any"===e||null===e}),S=(t.isAnyType=E,function S(e){return v(e)?"string":y(e)?"number":x(e)?"date":_(e)?"boolean":I(e)?"array":E(e)?"any":undefined});t["default"]=b},function(e,t,n){"use strict";var o=n(42);function a(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function s(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach(function(e){var t,n;t=r,n=i[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}n=BI.inherit(BI.Widget,{props:{baseCls:"bi-sticky-table-header",columnSize:[],minColumnSize:[],maxColumnSize:[],freezeCols:[],header:[],headerRowSize:"auto"},render:function(){var t=this,e=this.options;return{type:"bi.sticky_table_layout",sortable:!(this.tds=[]),ref:function(e){t.layout=e},columnSize:e.columnSize,freezeCols:e.freezeCols,items:this._formatItems(e.header)}},_formatItems:function(e){var r=this,i=this.options;return e.map(function(n){return{type:"bi.adaptive",tagName:"tr",height:i.headerRowSize,items:n.map(function(e,t){return{type:"bi.default",tagName:"td",ref:function(e){r.tds[t]=e},extraCls:i.freezeCols.includes(t)?t===n.length-1?"sticky-table-fix-last-col":"sticky-table-fix-first-col":"",cls:"sticky-table-fix-index-".concat(t,"-col first-row ").concat(0===t?"first-col":""),css:{minWidth:i.minColumnSize[t],maxWidth:i.maxColumnSize[t]},items:[s(s({},o.DEFAULT_CONFIG),e)]}})}})},_populate:function(e){this.layout.populate(this._formatItems(e))},setColumnSize:function(e){this.layout.setColumnSize(e)},populate:function(e){this._populate(e)},getRealColumnSize:function(){return this.tds.map(function(e){return e.element.width()})}});BI.shortcut("bi.sticky_table_header",n)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickyTableLayout=void 0;var r=n(300);function o(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function i(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach(function(e){var t,n;t=r,n=i[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}var l=BI.inherit(BI.Widget,{props:{baseCls:"bi-sticky-table-layout",sortable:!0,checkable:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],freezeCols:[],mirror:{}},render:function(){var t=this,e=this.options;return{type:"bi.default",items:[{type:"bi.default",tagName:"table",ref:function(e){t.table=e},width:BI.sum(e.columnSize),cls:"border-sizing",css:{border:0,borderSpacing:0,borderCollapse:"collapse",tableLayout:"fixed",minWidth:"100%"},items:[{type:"bi.default",ref:function(e){t.colgroup=e},tagName:"colgroup",items:this._formatCol(e.columnSize)},{type:"bi.default",tagName:"tbody",ref:function(e){t.layout=e},items:this._formatItems(e.items)}]}]}},mounted:function(){var e,o,a,s,n=this;this.options.sortable&&(e=new r.Draggable(this.table.element[0],{draggable:"tr.enabled",handle:".bi-sticky-table-draggable-handler",classes:{"draggable:over":["bi-sticky-table-draggable-drag-over"],mirror:["bi-sticky-table-draggable-mirror"]},mirror:this.options.mirror}),a=!1,s=BI.debounce(function(){a=!1},300),e.on("drag:start",function(e){var t=e.data.source;t.style.transform="",t.style.transitionDuration="",n.fireEvent(l.EVENT_START_DRAG,e.data.source.getAttribute("dataid"))}),e.on("drag:stop",function(e){var t=e.data.source.getAttribute("dataid");e.data.source.parentElement.childNodes.forEach(function(e){e.style.visibility="",e.style.transform="",e.style.transitionDuration=""}),e.data.sourceContainer.contains(e.data.originalSource)||(e.data.originalSource.remove(),e.data.source.remove()),o&&n.fireEvent(l.EVENT_STOP_DRAG,[t,o.getAttribute("dataid")]),o=null}),e.on("drag:over",function(e){var r=e.data.over,i=e.data.source;if(i.style.visibility="hidden",r!==i&&r!==e.data.originalSource&&(r!==o||!a)){if(a=!0,s(),r.style.transform)return r.style.transform="",e=n(),o===r?void(o=(o=e[0]===r?r.nextSibling:r.previousSibling)||r):void(o=r);o=r;var e=n(),t="translateY(-100%)";e[0]===r&&(t="translateY(100%)"),e.forEach(function(e){e!==i&&(e.style.transform=t,e.style.transitionDuration="300ms")})}function n(){var e=r.parentElement.childNodes,t=!1,n=[];return e.forEach(function(e){!0!==t||e!==i&&e!==r?(t=e!==i&&e!==r?t:!0)?n.push(e):e.style.transform="":(t=!1,n.push(e))}),n}}),e.on("mirror:created",function(e){n.options}))},_formatCol:function(e){return e.map(function(e){return{type:"bi.default",tagName:"col",width:e}})},_formatItems:function(e){var n=this.options;return e.map(function(e,t){return i(i({isNeedFreeze:n.isNeedFreeze,draggable:n.sortable,checkable:n.checkable,freezeCols:n.freezeCols,columnSize:n.columnSize,minColumnSize:n.minColumnSize,maxColumnSize:n.maxColumnSize,attributes:{dataid:e.id}},e),{},{cls:"".concat(e.cls||""," ").concat(t%2?"even":"odd")})})},_populate:function(e){this.layout.populate(this._formatItems(e))},setColumnSize:function(e){var t=this.options;t.columnSize=e,this.colgroup.populate(this._formatCol(t.columnSize)),this.table.setWidth(BI.sum(t.columnSize))},addItems:function(e){this.layout.addItems(this._formatItems(e))},populate:function(e){this._populate(e)}});(t.StickyTableLayout=l).EVENT_START_DRAG="EVENT_START_DRAG",l.EVENT_STOP_DRAG="EVENT_STOP_DRAG",BI.shortcut("bi.sticky_table_layout",l)},function(e,t,n){"use strict";var r=n(29),i=n(389),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t,n=[];for(t in Object(e))o.call(e,t)&&"constructor"!=t&&n.push(t);return n}},function(e,t,n){"use strict";n=n(19)(n(10),"Map");e.exports=n},function(e,t,n){"use strict";e.exports=function(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=9007199254740991}},function(e,t,n){"use strict";var r=n(401),i=n(31),n=n(50),n=n&&n.isTypedArray,n=n?i(n):r;e.exports=n},function(e,t,n){"use strict";var r=n(51),i=n(409),o=n(410),a=n(411),s=n(412),n=n(413);function l(e){e=this.__data__=new r(e);this.size=e.size}l.prototype.clear=i,l.prototype["delete"]=o,l.prototype.get=a,l.prototype.has=s,l.prototype.set=n,e.exports=l},function(e,t,n){"use strict";var r=n(414),i=n(421),o=n(423),a=n(424),n=n(425);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype["delete"]=i,s.prototype.get=o,s.prototype.has=a,s.prototype.set=n,e.exports=s},function(e,t,n){"use strict";var r=n(78),i=n(427),n=n(428);function o(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}o.prototype.add=o.prototype.push=i,o.prototype.has=n,e.exports=o},function(e,t,n){"use strict";e.exports=function(e,t){return e.has(t)}},function(e,t,n){"use strict";e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}},function(e,t,n){"use strict";var r=n(84),n=n(219),i=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols;e.exports=o?function(t){return null==t?[]:(t=Object(t),r(o(t),function(e){return i.call(t,e)}))}:n},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}},function(e,t,n){"use strict";var r=n(86);e.exports=function(e,t,n){return(e=null==e?undefined:r(e,t))===undefined?n:e}},function(e,t,n){"use strict";var i=n(56),o=n(34);e.exports=function(e,t){for(var n=0,r=(t=i(t,e)).length;null!=e&&n<r;)e=e[o(t[n++])];return n&&n==r?e:undefined}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(0),o=n(57),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){var n;return!i(e)&&(!("number"!=(n=r(e))&&"symbol"!=n&&"boolean"!=n&&null!=e&&!o(e))||(s.test(e)||!a.test(e)||null!=t&&e in Object(t)))}},function(e,t,n){"use strict";var r=n(227);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},function(e,t,n){"use strict";var r=n(216);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.RestWalker=void 0,r(n(91))),a=r(n(3)),s=n(2);function i(){}function l(e,t,n){return[new s.Option({definition:[new s.Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}i.prototype.walk=function(n,r){var i=this;void 0===r&&(r=[]),(0,a["default"])(n.definition,function(e,t){t=(0,o["default"])(n.definition,t+1);if(e instanceof s.NonTerminal)i.walkProdRef(e,t,r);else if(e instanceof s.Terminal)i.walkTerminal(e,t,r);else if(e instanceof s.Alternative)i.walkFlat(e,t,r);else if(e instanceof s.Option)i.walkOption(e,t,r);else if(e instanceof s.RepetitionMandatory)i.walkAtLeastOne(e,t,r);else if(e instanceof s.RepetitionMandatoryWithSeparator)i.walkAtLeastOneSep(e,t,r);else if(e instanceof s.RepetitionWithSeparator)i.walkManySep(e,t,r);else if(e instanceof s.Repetition)i.walkMany(e,t,r);else{if(!(e instanceof s.Alternation))throw Error("non exhaustive match");i.walkOr(e,t,r)}})},i.prototype.walkTerminal=function(e,t,n){},i.prototype.walkProdRef=function(e,t,n){},i.prototype.walkFlat=function(e,t,n){n=t.concat(n);this.walk(e,n)},i.prototype.walkOption=function(e,t,n){n=t.concat(n);this.walk(e,n)},i.prototype.walkAtLeastOne=function(e,t,n){t=[new s.Option({definition:e.definition})].concat(t,n);this.walk(e,t)},i.prototype.walkAtLeastOneSep=function(e,t,n){t=l(e,t,n);this.walk(e,t)},i.prototype.walkMany=function(e,t,n){t=[new s.Option({definition:e.definition})].concat(t,n);this.walk(e,t)},i.prototype.walkManySep=function(e,t,n){t=l(e,t,n);this.walk(e,t)},i.prototype.walkOr=function(e,t,n){var r=this,i=t.concat(n);(0,a["default"])(e.definition,function(e){e=new s.Alternative({definition:[e]});r.walk(e,i)})},t.RestWalker=i},function(e,t,n){"use strict";var i=n(92),o=n(38);e.exports=function(e,t,n){var r=null==e?0:e.length;return r?(t=n||t===undefined?1:o(t),i(e,t<0?0:t,r)):[]}},function(e,t,n){"use strict";e.exports=function(e,t,n){for(var r=-1,i=e.length,o=((n=i<n?i:n)<0&&(n+=i),i=n<(t=t<0?i<-t?0:i+t:t)?0:n-t>>>0,t>>>=0,Array(i));++r<i;)o[r]=e[r+t];return o}},function(z,e,t){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||n({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var r,i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=function(e){return e&&e.__esModule?e:{"default":e}},a=(Object.defineProperty(e,"__esModule",{value:!0}),e.serializeProduction=e.serializeGrammar=e.Terminal=e.Alternation=e.RepetitionWithSeparator=e.Repetition=e.RepetitionMandatoryWithSeparator=e.RepetitionMandatory=e.Option=e.Alternative=e.Rule=e.NonTerminal=e.AbstractProduction=void 0,o(t(4))),M=o(t(3)),s=o(t(39)),F=o(t(231)),l=o(t(232)),c=o(t(60));function D(e){return t=e,(0,s["default"])(t.LABEL)&&""!==t.LABEL?e.LABEL:e.name;var t}Object.defineProperty(u.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e},enumerable:!1,configurable:!0}),u.prototype.accept=function(t){t.visit(this),(0,M["default"])(this.definition,function(e){e.accept(t)})};t=u;function u(e){this._definition=e}e.AbstractProduction=t;i(p,h=t),Object.defineProperty(p.prototype,"definition",{get:function(){return this.referencedRule!==undefined?this.referencedRule.definition:[]},set:function(e){},enumerable:!1,configurable:!0}),p.prototype.accept=function(e){e.visit(this)};var h,d=p;function p(e){var t=h.call(this,[])||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.NonTerminal=d;i(g,f=t);var f,m=g;function g(e){var t=f.call(this,e.definition)||this;return(t.orgText="",c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.Rule=m;i(v,b=t);var b,y=v;function v(e){var t=b.call(this,e.definition)||this;return(t.ignoreAmbiguities=!1,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.Alternative=y;i(x,_=t);var _,I=x;function x(e){var t=_.call(this,e.definition)||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.Option=I;i(T,E=t);var E,S=T;function T(e){var t=E.call(this,e.definition)||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.RepetitionMandatory=S;i(B,C=t);var C,w=B;function B(e){var t=C.call(this,e.definition)||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.RepetitionMandatoryWithSeparator=w;i(A,R=t);var R,N=A;function A(e){var t=R.call(this,e.definition)||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.Repetition=N;i(V,O=t);var O,H=V;function V(e){var t=O.call(this,e.definition)||this;return t.idx=1,(0,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.RepetitionWithSeparator=H;i(L,j=t),Object.defineProperty(L.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e},enumerable:!1,configurable:!0});var j,W=L;function L(e){var t=j.call(this,e.definition)||this;return t.idx=1,t.ignoreAmbiguities=!1,(t.hasPredicates=!1,c["default"])(t,(0,l["default"])(e,function(e){return e!==undefined})),t}e.Alternation=W;G.prototype.accept=function(e){e.visit(this)};var k=G;function G(e){this.idx=1,(0,c["default"])(this,(0,l["default"])(e,function(e){return e!==undefined}))}function P(e){function t(e){return(0,a["default"])(e,P)}var n,r;if(e instanceof d)return n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx},(0,s["default"])(e.label)&&(n.label=e.label),n;if(e instanceof y)return{type:"Alternative",definition:t(e.definition)};if(e instanceof I)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof S)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof w)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:P(new k({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof H)return{type:"RepetitionWithSeparator",idx:e.idx,separator:P(new k({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof N)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof W)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof k)return n={type:"Terminal",name:e.terminalType.name,label:D(e.terminalType),idx:e.idx},(0,s["default"])(e.label)&&(n.terminalLabel=e.label),r=e.terminalType.PATTERN,e.terminalType.PATTERN&&(n.pattern=(0,F["default"])(r)?r.source:r),n;if(e instanceof m)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}e.Terminal=k,e.serializeGrammar=function(e){return(0,a["default"])(e,P)},e.serializeProduction=P},function(e,t,n){"use strict";var r=n(35),i=n(484),o=n(486);e.exports=function(e,t){return o(i(e,t,r),e+"")}},function(e,t,n){"use strict";var i=n(215),o=n(13),a=n(492),s=n(0),l=n(61);e.exports=function(e,t,n){var r=s(e)?i:a;return n&&l(e,t,n)&&(t=undefined),r(e,o(t,3))}},function(e,t,n){"use strict";var r=n(233),i=n(495),o=n(496);e.exports=function(e,t,n){return t==t?o(e,t,n):r(e,i,n)}},function(e,t,n){"use strict";var l=n(82),c=n(497);e.exports=function u(e,t,n,r,i){var o=-1,a=e.length;for(n=n||c,i=i||[];++o<a;){var s=e[o];0<t&&n(s)?1<t?u(s,t-1,n,r,i):l(i,s):r||(i[i.length]=s)}return i}},function(e,t,n){"use strict";var r=n(498);e.exports=function(e){return e&&e.length?r(e):[]}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var r;(t="function"==typeof(r=function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx;this.input=e.input;this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0;this.input=e;this.groupIdx=0;this.consumeChar("/");var t=this.disjunction();this.consumeChar("/");var n={type:"Flags",loc:{begin:this.idx,end:e.length},global:false,ignoreCase:false,multiLine:false,unicode:false,sticky:false};while(this.isRegExpFlag())switch(this.popChar()){case"g":i(n,"global");break;case"i":i(n,"ignoreCase");break;case"m":i(n,"multiLine");break;case"u":i(n,"unicode");break;case"y":i(n,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:t,loc:this.loc(0)}},e.prototype.disjunction=function(){var e=[];var t=this.idx;e.push(this.alternative());while(this.peekChar()==="|"){this.consumeChar("|");e.push(this.alternative())}return{type:"Disjunction",value:e,loc:this.loc(t)}},e.prototype.alternative=function(){var e=[];var t=this.idx;while(this.isTerm())e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(t)}},e.prototype.term=function(){if(this.isAssertion())return this.assertion();else return this.atom()},e.prototype.assertion=function(){var e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");var t;switch(this.popChar()){case"=":t="Lookahead";break;case"!":t="NegativeLookahead";break}l(t);var n=this.disjunction();this.consumeChar(")");return{type:t,value:n,loc:this.loc(e)}}c()},e.prototype.quantifier=function(e){var t;var n=this.idx;switch(this.popChar()){case"*":t={atLeast:0,atMost:Infinity};break;case"+":t={atLeast:1,atMost:Infinity};break;case"?":t={atLeast:0,atMost:1};break;case"{":var r=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:r,atMost:r};break;case",":var i;if(this.isDigit()){i=this.integerIncludingZero();t={atLeast:r,atMost:i}}else t={atLeast:r,atMost:Infinity};this.consumeChar("}");break}if(e===true&&t===undefined)return undefined;l(t);break}if(e===true&&t===undefined)return undefined;l(t);if(this.peekChar(0)==="?"){this.consumeChar("?");t.greedy=false}else t.greedy=true;t.type="Quantifier";t.loc=this.loc(n);return t},e.prototype.atom=function(){var e;var t=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===undefined&&this.isPatternCharacter())e=this.patternCharacter();l(e);e.loc=this.loc(t);if(this.isQuantifier())e.quantifier=this.quantifier();return e},e.prototype.dotAll=function(){this.consumeChar(".");return{type:"Set",complement:true,value:[a("\n"),a("\r"),a("\u2028"),a("\u2029")]}},e.prototype.atomEscape=function(){this.consumeChar("\\");switch(this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){var e=this.positiveInteger();return{type:"GroupBackReference",value:e}},e.prototype.characterClassEscape=function(){var e;var t=false;switch(this.popChar()){case"d":e=u;break;case"D":e=u;t=true;break;case"s":e=d;break;case"S":e=d;t=true;break;case"w":e=h;break;case"W":e=h;t=true;break}l(e);return{type:"Set",value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case"f":e=a("\f");break;case"n":e=a("\n");break;case"r":e=a("\r");break;case"t":e=a("\t");break;case"v":e=a("\x0B");break}l(e);return{type:"Character",value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var e=this.popChar();if(/[a-zA-Z]/.test(e)===false)throw Error("Invalid ");var t=e.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:t}},e.prototype.nulCharacterAtom=function(){this.consumeChar("0");return{type:"Character",value:a("\0")}},e.prototype.hexEscapeSequenceAtom=function(){this.consumeChar("x");return this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){this.consumeChar("u");return this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var e=this.popChar();return{type:"Character",value:a(e)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var e=this.popChar();return{type:"Character",value:a(e)}}},e.prototype.characterClass=function(){var e=[];var t=false;this.consumeChar("[");if(this.peekChar(0)==="^"){this.consumeChar("^");t=true}while(this.isClassAtom()){var n=this.classAtom();var r=n.type==="Character";if(r&&this.isRangeDash()){this.consumeChar("-");var i=this.classAtom();var o=i.type==="Character";if(o){if(i.value<n.value)throw Error("Range out of order in character class");e.push({from:n.value,to:i.value})}else{s(n.value,e);e.push(a("-"));s(i.value,e)}}else s(n.value,e)}this.consumeChar("]");return{type:"Set",complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){this.consumeChar("\\");switch(this.peekChar()){case"b":this.consumeChar("b");return{type:"Character",value:a("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=true;this.consumeChar("(");switch(this.peekChar(0)){case"?":this.consumeChar("?");this.consumeChar(":");e=false;break;default:this.groupIdx++;break}var t=this.disjunction();this.consumeChar(")");var n={type:"Group",capturing:e,value:t};if(e)n.idx=this.groupIdx;return n},e.prototype.positiveInteger=function(){var e=this.popChar();if(n.test(e)===false)throw Error("Expecting a positive integer");while(t.test(this.peekChar(0)))e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(t.test(e)===false)throw Error("Expecting an integer");while(t.test(this.peekChar(0)))e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:a(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return true;default:return false}},e.prototype.isRangeDash=function(){return this.peekChar()==="-"&&this.isClassAtom(1)},e.prototype.isDigit=function(){return t.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){if(e===undefined)e=0;switch(this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return false;default:return true}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return true;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return true;default:return false}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return true;case"\\":switch(this.peekChar(1)){case"b":case"B":return true;default:return false}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return false}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return this.quantifier(true)!==undefined}catch(t){return false}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return false;default:return true}},e.prototype.parseHexDigits=function(e){var t="";for(var n=0;n<e;n++){var r=this.popChar();if(o.test(r)===false)throw Error("Expecting a HexDecimal digits");t+=r}var i=parseInt(t,16);return{type:"Character",value:i}},e.prototype.peekChar=function(e){if(e===undefined)e=0;return this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);this.consumeChar();return e},e.prototype.consumeChar=function(e){if(e!==undefined&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++},e.prototype.loc=function(e){return{begin:e,end:this.idx}};var o=/[0-9a-fA-F]/,t=/[0-9]/,n=/[1-9]/,r;function a(e){return e.charCodeAt(0)}function s(e,t){if(e.length!==undefined)e.forEach(function(e){t.push(e)});else t.push(e)}function i(e,t){if(e[t]===true)throw"duplicate flag "+t;e[t]=true}function l(e){if(e===undefined)throw Error("Internal Error - Should never get here!")}function c(){throw Error("Internal Error - Should never get here!")}for(var u=[],r=a("0");r<=a("9");r++)u.push(r);var h=[a("_")].concat(u);for(r=a("a");r<=a("z");r++)h.push(r);for(r=a("A");r<=a("Z");r++)h.push(r);var d=[a(" "),a("\f"),a("\n"),a("\r"),a("\t"),a("\x0B"),a("\t"),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a(" "),a("\u2028"),a("\u2029"),a(" "),a(" "),a("　"),a("\ufeff")];function p(){}return p.prototype.visitChildren=function(e){for(var t in e){var n=e[t];if(e.hasOwnProperty(t))if(n.type!==undefined)this.visit(n);else if(Array.isArray(n))n.forEach(function(e){this.visit(e)},this)}},p.prototype.visit=function(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)},p.prototype.visitPattern=function(e){},p.prototype.visitFlags=function(e){},p.prototype.visitDisjunction=function(e){},p.prototype.visitAlternative=function(e){},p.prototype.visitStartAnchor=function(e){},p.prototype.visitEndAnchor=function(e){},p.prototype.visitWordBoundary=function(e){},p.prototype.visitNonWordBoundary=function(e){},p.prototype.visitLookahead=function(e){},p.prototype.visitNegativeLookahead=function(e){},p.prototype.visitCharacter=function(e){},p.prototype.visitSet=function(e){},p.prototype.visitGroup=function(e){},p.prototype.visitGroupBackReference=function(e){},p.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:p,VERSION:"0.5.0"}})?r.apply(t,[]):r)!==undefined&&(e.exports=t)},function(e,t,n){"use strict";var r=n(84),i=n(239),o=n(13),a=n(0),s=n(501);e.exports=function(e,t){return(a(e)?r:i)(e,s(o(t,3)))}},function(e,t,n){"use strict";var r=n(502),i=n(97),o=n(94),a=n(503),n=o(function(e,t){return a(e)?r(e,i(t,1,a,!0)):[]});e.exports=n},function(e,t,n){"use strict";n=n(505)(n(240));e.exports=n},function(e,t,n){"use strict";var r=n(84),i=n(239),o=n(13),a=n(0);e.exports=function(e,t){return(a(e)?r:i)(e,o(t,3))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearRegExpParserCache=t.getRegExpAst=void 0;var n=n(100),r={},i=new n.RegExpParser;t.getRegExpAst=function(e){var t,e=e.toString();return r.hasOwnProperty(e)?r[e]:(t=i.pattern(e),r[e]=t)},t.clearRegExpParserCache=function(){r={}}},function(e,t,n){"use strict";e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:undefined}},function(e,t,n){"use strict";var i=n(92),o=n(38);e.exports=function(e,t,n){var r=null==e?0:e.length;return r?(t=n||t===undefined?1:o(t),i(e,0,(t=r-t)<0?0:t)):[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyForAutomaticLookahead=t.AT_LEAST_ONE_SEP_IDX=t.MANY_SEP_IDX=t.AT_LEAST_ONE_IDX=t.MANY_IDX=t.OPTION_IDX=t.OR_IDX=t.BITS_FOR_ALT_IDX=t.BITS_FOR_RULE_IDX=t.BITS_FOR_OCCURRENCE_IDX=t.BITS_FOR_METHOD_TYPE=void 0,t.BITS_FOR_METHOD_TYPE=4,t.BITS_FOR_OCCURRENCE_IDX=8,t.BITS_FOR_RULE_IDX=12,t.BITS_FOR_ALT_IDX=8,t.OR_IDX=1<<t.BITS_FOR_OCCURRENCE_IDX,t.OPTION_IDX=2<<t.BITS_FOR_OCCURRENCE_IDX,t.MANY_IDX=3<<t.BITS_FOR_OCCURRENCE_IDX,t.AT_LEAST_ONE_IDX=4<<t.BITS_FOR_OCCURRENCE_IDX,t.MANY_SEP_IDX=5<<t.BITS_FOR_OCCURRENCE_IDX,t.AT_LEAST_ONE_SEP_IDX=6<<t.BITS_FOR_OCCURRENCE_IDX,t.getKeyForAutomaticLookahead=function(e,t,n){return n|t|e};t.BITS_FOR_ALT_IDX},function(e,t,n){"use strict";var r=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return r.test(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.headerItemsData=t.defaultHeaderItems=void 0;t.defaultHeaderItems=["add","delete","moveUp","moveDown","refresh"];t.headerItemsData=[{type:"add",cls:"text-add-tip-font",title:"BI-Basic_Parameter_Insert",event:"EVENT_INSERT"},{type:"delete",cls:"close-font bi-error",title:"BI-Basic_Parameter_Delete",event:"EVENT_DELETE"},{type:"moveUp",cls:"add-up-font",title:"BI-Basic_Parameter_Move_Up",event:"EVENT_MOVE_UP"},{type:"moveDown",cls:"minus-down-font",title:"BI-Basic_Parameter_Move_Down",event:"EVENT_MOVE_DOWN"},{type:"refresh",cls:"parameter-refresh-font",title:"BI-Basic_Parameter_Refresh",event:"EVENT_REFRESH"}]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var r=n(43),i=n(47),o=c(n(69)),a=c(n(70)),s=c(n(112)),l=c(n(85));function c(e){return e&&e.__esModule?e:{"default":e}}n=function(){var e=t.prototype;function t(e){this.checker=e,this.lexer=new i.Lexer(r.allTokens,{ensureOptimizations:!0}),this.parser=(0,o["default"])();var e=(0,a["default"])(),t=e.interpreter,e=e.setFormula;this.interpreter=t,this.setFormula=e}return e.setFormula=function(){},e.parse=function(e){this.setFormula(new s["default"](this.checker));e=this.lexer.tokenize(e);if(0<e.errors.length)throw t=e.errors[0],new Error(JSON.stringify({type:"lexer",name:t.message,token:(0,l["default"])(t.message.match(/->(.)<-/),[1],""),errorText:BI.i18nText("BI-Expression_syntax_error")}));this.parser.input=e.tokens;var t=this.parser.expr();if(0<this.parser.errors.length)throw e=this.parser.errors[0],new Error(JSON.stringify({type:"parser",name:e.name,token:(0,l["default"])(e.message.match(/->\s(\w+)\s<-/),[1],(0,l["default"])(e,"previousToken.image")||(0,l["default"])(e,"token.image")),errorText:BI.i18nText("BI-Expression_syntax_error")}));return this.interpreter.visit(t)},t}();t["default"]=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var o=r(n(538)),a=r(n(3)),s=r(n(22)),l=n(70);function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}var c=function c(e){i(this,"LOG",function(){return u({name:"LOG",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)},minCount:1,optionalCount:1,paramType:[["number"],["number","number"]],errorText:BI.i18nText("BI-Front-Expression_param_number_number_default","LOG")}),"number"}),i(this,"log",this.LOG),i(this,"MAX",function(){return u({name:"MAX",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isArrayType)(e)},minCount:1,paramType:["number",["array"]],errorText:BI.i18nText("BI-Front-Expression_param_all_number","MAX")}),"number"}),i(this,"max",this.MAX),i(this,"MIN",function(){return u({name:"MIN",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isArrayType)(e)},minCount:1,paramType:["number",["array"]],errorText:BI.i18nText("BI-Front-Expression_param_all_number","MIN")}),"number"}),i(this,"min",this.MIN),i(this,"RAND",function(){return u({name:"RAND",params:arguments,paramCount:0,errorText:BI.i18nText("BI-Front-Expression_param_none","RAND")}),"number"}),i(this,"rand",this.RAND),i(this,"TRUNC",function(){return u({name:"TRUNC",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)},minCount:1,optionalCount:1,paramType:[["number"],["number","number"]],errorText:BI.i18nText("BI-Front-Expression_param_number_number_default","TRUNC")}),"number"}),i(this,"trunc",this.TRUNC),i(this,"DATE",function(){return u({name:"DATE",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isStringType)(e)},paramCount:3,paramType:[["number","string"],["number","string"],["number","string"]],errorText:BI.i18nText("BI-Front-Expression_param_multi_number_or_text","DATE")}),"date"}),i(this,"date",this.DATE),i(this,"DATEDELTA",function(){return u({name:"DATEDELTA",params:arguments,checkFunction:function(e,t){return 0===t?(0,l.isStringType)(e)||(0,l.isDateType)(e):(0,l.isNumberType)(e)},paramCount:2,paramType:[["string","date"],["number"]],errorText:BI.i18nText("BI-Front-Expression_param_date_or_text_number","DATEDELTA")}),"date"}),i(this,"datedelta",this.DATEDELTA),i(this,"DATEDIF",function(){return u({name:"DATEDIF",params:arguments,checkFunction:function(e,t){return 2===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:3,paramType:[["string","date"],["string","date"],["number"]],errorText:BI.i18nText("BI-Front-Expression_param_two_date_text_and_text","DATEDIF")}),"number"}),i(this,"datedif",this.DATEDIF),i(this,"DATESUBDATE",function(){return u({name:"DATESUBDATE",params:arguments,checkFunction:function(e,t){return 2===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:3,paramType:[["string","date"],["string","date"],["number"]],errorText:BI.i18nText("BI-Front-Expression_param_two_date_text_and_text","DATESUBDATE")}),"number"}),i(this,"datesubdate",this.DATESUBDATE),i(this,"DATETONUMBER",function(){return u({name:"DATETONUMBER",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:1,paramType:[["string","date"]],errorText:BI.i18nText("BI-Front-Expression_param_one_date_or_text","DATETONUMBER")}),"number"}),i(this,"datetonumber",this.DATETONUMBER),i(this,"DAY",function(){return u({name:"DAY",params:arguments,checkFunction:function(e,t){return 0===t?(0,l.isStringType)(e)||(0,l.isDateType)(e):(0,l.isStringType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","DAY")}),"number"}),i(this,"day",this.DAY),i(this,"DAYS360",function(){return u({name:"DAYS360",params:arguments,checkFunction:function(e,t){return 2===t?(0,l.isStringType)(e)||(0,l.isNumberType)(e)||(0,l.isBooleanType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:2,paramType:[["string","date"],["string","date"],["string","number"]],errorText:BI.i18nText("BI-Front-Expression_param_two_dateText_textNumber_default","DAYS360")}),"number"}),i(this,"days360",this.DAYS360),i(this,"DAYSOFMONTH",function(){return u({name:"DAYSOFMONTH",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:1,paramType:[["string","date"]],errorText:BI.i18nText("BI-Front-Expression_param_one_date_or_text","DAYSOFMONTH")}),"number"}),i(this,"daysofmonth",this.DAYSOFMONTH),i(this,"DAYSOFQUARTER",function(){return u({name:"DAYSOFQUARTER",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:1,paramType:[["string","date"]],errorText:BI.i18nText("BI-Front-Expression_param_one_date_or_text","DAYSOFQUARTER")}),"number"}),i(this,"daysofquarter",this.DAYSOFQUARTER),i(this,"DAYVALUE",function(){return u({name:"DAYVALUE",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:1,paramType:[["string","date"]],errorText:BI.i18nText("BI-Front-Expression_param_one_date_or_text","DAYVALUE")}),"number"}),i(this,"dayvalue",this.DAYVALUE),i(this,"HOUR",function(){return u({name:"HOUR",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","number"]],[["string","number"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","HOUR")}),"number"}),i(this,"hour",this.HOUR),i(this,"LUNAR",function(){return u({name:"LUNAR",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isStringType)(e)},paramCount:3,paramType:[["string","number"],["string","number"],["string","number"]],errorText:BI.i18nText("BI-Front-Expression_param_multi_number_or_text","LUNAR")}),"string"}),i(this,"lunar",this.LUNAR),i(this,"MINUTE",function(){return u({name:"MINUTE",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","MINUTE")}),"number"}),i(this,"minute",this.MINUTE),i(this,"MONTH",function(){return u({name:"MONTH",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","MONTH")}),"number"}),i(this,"month",this.MONTH),i(this,"MONTHDELTA",function(){return u({name:"MONTHDELTA",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isNumberType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:2,paramType:[["string","date"],["number"]],errorText:BI.i18nText("BI-Front-Expression_param_date_or_text_number","MONTHDELTA")}),"date"}),i(this,"monthdelta",this.MONTHDELTA),i(this,"NOW",function(){return u({name:"NOW",params:arguments,paramCount:0,errorText:BI.i18nText("BI-Front-Expression_param_none","NOW")}),"date"}),i(this,"now",this.NOW),i(this,"QUARTER",function(){return u({name:"QUARTER",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","QUARTER")}),"number"}),i(this,"quarter",this.QUARTER),i(this,"SECOND",function(){return u({name:"SECOND",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,optionalCount:2,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","SECOND")}),"number"}),i(this,"second",this.SECOND),i(this,"TIME",function(){return u({name:"TIME",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isStringType)(e)},paramCount:3,paramType:[["string","number"],["string","number"],["string","number"]],errorText:BI.i18nText("BI-Front-Expression_param_multi_number_or_text","TIME")}),"date"}),i(this,"time",this.TIME),i(this,"TODATE",function(){return u({name:"TODATE",params:arguments,checkFunction:function(e,t,n){return 1===n.length&&0===t||(0,l.isStringType)(e)},minCount:1,optionalCount:2,paramType:[["any"],["string","string"],["string","string","string"]],errorText:BI.i18nText("BI-Front-Expression_param_to_date","TODATE")}),"date"}),i(this,"todate",this.TODATE),i(this,"TODAY",function(){return u({name:"TODAY",params:arguments,paramCount:0,errorText:BI.i18nText("BI-Front-Expression_param_none","TODAY")}),"date"}),i(this,"today",this.TODAY),i(this,"WEEK",function(){return u({name:"WEEK",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","WEEK")}),"number"}),i(this,"week",this.WEEK),i(this,"WEEKDATE",function(){return u({name:"WEEKDATE",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)||(0,l.isStringType)(e)},paramCount:4,paramType:[["string","number"],["string","number"],["string","number"],["string","number"]],errorText:BI.i18nText("BI-Front-Expression_param_four_number_or_text","WEEKDATE")}),"date"}),i(this,"weekdate",this.WEEKDATE),i(this,"WEEKDAY",function(){return u({name:"WEEKDAY",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)||(0,l.isDateType)(e)},paramCount:1,paramType:[["string","date"]],errorText:BI.i18nText("BI-Front-Expression_param_one_date_or_text","WEEKDAY")}),"number"}),i(this,"weekday",this.WEEKDAY),i(this,"YEAR",function(){return u({name:"YEAR",params:arguments,checkFunction:function(e,t){return 1===t?(0,l.isStringType)(e):(0,l.isStringType)(e)||(0,l.isDateType)(e)},minCount:0,paramType:[[],[["string","date"]],[["string","date"],["string"]]],errorText:BI.i18nText("BI-Front-Expression_param_date_precision","YEAR")}),"number"}),i(this,"year",this.YEAR),i(this,"YEARDELTA",function(){return u({name:"YEARDELTA",params:arguments,checkFunction:function(e,t){return 0===t?(0,l.isStringType)(e)||(0,l.isDateType)(e):(0,l.isNumberType)(e)},paramCount:2,paramType:[["string","date"],["number"]],errorText:BI.i18nText("BI-Front-Expression_param_date_or_text_number","YEARDELTA")}),"date"}),i(this,"yeardelta",this.YEARDELTA),i(this,"CHAR",function(){return u({name:"CHAR",params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)},paramCount:1,paramType:["number"],errorText:BI.i18nText("BI-Front-Expression_param_number","CHAR")}),"string"}),i(this,"char",this.CHAR),i(this,"CODE",function(){return u({name:"CODE",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)},paramCount:1,paramType:["string"],errorText:BI.i18nText("BI-Front-Expression_param_text","CODE")}),"number"}),i(this,"code",this.CODE),i(this,"CONCATENATE",function(){return u({name:"CONCATENATE",params:arguments,checkFunction:function(){return!0},minCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_param_multi_any_type","CONCATENATE")}),"string"}),i(this,"concatenate",this.CONCATENATE),i(this,"ENDWITH",function(){return u({name:"ENDWITH",params:arguments,checkFunction:function(){return!0},paramCount:2,paramType:["any","any"],errorText:BI.i18nText("BI-Front-Expression_param_two_any","ENDWITH")}),"number"}),i(this,"endwith",this.ENDWITH),i(this,"EXACT",function(){return u({name:"EXACT",params:arguments,checkFunction:function(){return!0},paramCount:2,paramType:["any","any"],errorText:BI.i18nText("BI-Front-Expression_param_two_any","EXACT")}),"number"}),i(this,"exact",this.EXACT),i(this,"FIND",function(){return u({name:"FIND",params:arguments,checkFunction:function(e,t,n){return 2!==t||(0,l.isNumberType)(e)},minCount:2,optionalCount:1,paramType:[["any","any"],["any","any","number"]],errorText:BI.i18nText("BI-Front-Expression_param_two_any_number_default","FIND")}),"number"}),i(this,"find",this.FIND),i(this,"FORMAT",function(){return u({name:"FORMAT",params:arguments,checkFunction:function(e,t){return 1!==t||(0,l.isStringType)(e)},paramCount:2,paramType:["any","string"],errorText:BI.i18nText("BI-Front-Expression_param_any_text","FORMAT")}),"string"}),i(this,"format",this.FORMAT),i(this,"INDEXOF",function(){return u({name:"INDEXOF",params:arguments,checkFunction:function(e,t){return 1!==t||(0,l.isNumberType)(e)},paramCount:2,paramType:["any","number"],errorText:BI.i18nText("BI-Front-Expression_param_any_number","INDEXOF")}),"string"}),i(this,"indexof",this.INDEXOF),i(this,"LEFT",function(){return u({name:"LEFT",params:arguments,checkFunction:function(e,t){return 1!==t||(0,l.isNumberType)(e)},minCount:1,optionalCount:1,paramType:[["any"],["any","number"]],errorText:BI.i18nText("BI-Front-Expression_param_any_number_default","LEFT")}),"string"}),i(this,"left",this.LEFT),i(this,"LEN",function(){return u({name:"LEN",params:arguments,checkFunction:function(e){return!0},paramCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_param_one_any_type","LEN")}),"number"}),i(this,"len",this.LEN),i(this,"LOWER",function(){return u({name:"LOWER",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)},paramCount:1,paramType:["string"],errorText:BI.i18nText("BI-Front-Expression_param_text","LOWER")}),"string"}),i(this,"lower",this.LOWER),i(this,"MID",function(){return u({name:"MID",params:arguments,checkFunction:function(e,t){return 0===t||(0,l.isNumberType)(e)},paramCount:3,paramType:["any","number","number"],errorText:BI.i18nText("BI-Front-Expression_param_any_number_number","MID")}),"string"}),i(this,"mid",this.MID),i(this,"NUMTO",function(){return u({name:"NUMTO",params:arguments,checkFunction:function(e,t){return 0!==t&&(0,l.isBooleanType)(e)||(0,l.isNumberType)(e)},minCount:1,optionalCount:1,paramType:[["number"],["number","boolean"]],errorText:BI.i18nText("BI-Front-Expression_param_number_bool_default","NUMTO")}),"string"}),i(this,"numto",this.NUMTO),i(this,"PROPER",function(){return u({name:"PROPER",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)},paramCount:1,paramType:["string"],errorText:BI.i18nText("BI-Front-Expression_param_text","PROPER")}),"string"}),i(this,"proper",this.PROPER),i(this,"REGEXP",function(){return u({name:"REGEXP",params:arguments,checkFunction:function(e,t){return(2===t?(0,l.isNumberType):(0,l.isStringType))(e)},minCount:2,optionalCount:1,paramType:[["string","string"],["string","string","number"]],errorText:BI.i18nText("BI-Front-Expression_param_text_text_number_default","REGEXP")}),"string"}),i(this,"regexp",this.REGEXP),i(this,"REPEAT",function(){return u({name:"REPEAT",params:arguments,checkFunction:function(e,t){return 1!==t||(0,l.isNumberType)(e)},paramCount:2,paramType:["any","number"],errorText:BI.i18nText("BI-Front-Expression_param_any_number","REPEAT")}),"string"}),i(this,"repeat",this.REPEAT),i(this,"REPLACE",function(){return u({name:"REPLACE",params:arguments,checkFunction:function(e,t,n){return 3===n.length||(1!==t&&2!==t||(0,l.isNumberType)(e))},minCount:3,optionalCount:1,paramType:[["any","any","any"],["any","number","number","any"]],errorText:BI.i18nText("BI-Front-Expression_param_three_text_or_text_two_number_text","REPLACE")}),"string"}),i(this,"replace",this.REPLACE),i(this,"RIGHT",function(){return u({name:"RIGHT",params:arguments,checkFunction:function(e,t){return 1!==t||(0,l.isNumberType)(e)},minCount:1,optionalCount:1,paramType:[["any"],["any","number"]],errorText:BI.i18nText("BI-Front-Expression_param_any_number_default","RIGHT")}),"string"}),i(this,"right",this.RIGHT),i(this,"SPLIT",function(){return u({name:"SPLIT",params:arguments,checkFunction:function(){return!0},paramCount:2,paramType:["any","any"],errorText:BI.i18nText("BI-Front-Expression_param_two_any","SPLIT")}),"array"}),i(this,"split",this.SPLIT),i(this,"STARTWITH",function(){return u({name:"STARTWITH",params:arguments,checkFunction:function(e,t){return!0},paramCount:2,paramType:["any","any"],errorText:BI.i18nText("BI-Front-Expression_param_two_any","STARTWITH")}),"number"}),i(this,"startwith",this.STARTWITH),i(this,"SUBSTITUTE",function(){return u({name:"SUBSTITUTE",params:arguments,checkFunction:function(e,t){return 3!==t||(0,l.isNumberType)(e)},minCount:3,optionalCount:1,paramType:[["any","any","any"],["any","any","any","number"]],errorText:BI.i18nText("BI-Front-Expression_param_three_any_number_default","SUBSTITUTE")}),"string"}),i(this,"substitute",this.SUBSTITUTE),i(this,"TODOUBLE",function(){return u({name:"TODOUBLE",params:arguments,checkFunction:function(){return!0},paramCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_param_one_any_type","TODOUBLE")}),"number"}),i(this,"todouble",this.TODOUBLE),i(this,"TOINTEGER",function(){return u({name:"TOINTEGER",params:arguments,checkFunction:function(){return!0},paramCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_param_one_any_type","TOINTEGER")}),"number"}),i(this,"tointeger",this.TOINTEGER),i(this,"TRIM",function(){return u({name:"TRIM",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)},paramCount:1,paramType:["string"],errorText:BI.i18nText("BI-Front-Expression_param_text","TRIM")}),"string"}),i(this,"trim",this.TRIM),i(this,"UPPER",function(){return u({name:"UPPER",params:arguments,checkFunction:function(e){return(0,l.isStringType)(e)},paramCount:1,paramType:["string"],errorText:BI.i18nText("BI-Front-Expression_param_text","UPPER")}),"string"}),i(this,"upper",this.UPPER),i(this,"AND",function(){return u({name:"AND",params:arguments,checkFunction:function(e){return(0,l.isBooleanType)(e)||(0,l.isNumberType)(e)},minCount:0,paramType:["any"]}),"number"}),i(this,"and",this.AND),i(this,"OR",function(){return u({name:"OR",params:arguments,checkFunction:function(e){return(0,l.isBooleanType)(e)||(0,l.isNumberType)(e)},minCount:0,paramType:["any"]}),"number"}),i(this,"or",this.OR),i(this,"IF",function(){return u({name:"IF",params:arguments,checkFunction:function(e,t){return 0!==t||((0,l.isBooleanType)(e)||(0,l.isNumberType)(e))},paramCount:3,paramType:[["boolean","number"],"any","any"],errorText:BI.i18nText("BI-Front-Expression_logic_if_three_param","IF")}),"any"}),i(this,"if",this.IF),i(this,"SWITCH",function(){return u({name:"SWITCH",params:arguments,checkFunction:function(e,t){return 0!==t||((0,l.isBooleanType)(e)||(0,l.isNumberType)(e))},minCount:3,paramType:[["boolean","number"],"any","any"],errorText:BI.i18nText("BI-Front-Expression_logic_switch_le_three_param","SWITCH")}),"any"}),i(this,"switch",this.SWITCH),i(this,"ISNULL",function(){return u({name:"ISNULL",params:arguments,checkFunction:function(){return!0},minCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_param_multi_any_type","ISNULL")}),"number"}),i(this,"isnull",this.ISNULL),i(this,"NVL",function(){var e=!1,t=[].slice.call(arguments),n=[];return t.forEach(function(e){null===e||e===undefined||n.includes(e)||n.push(e)}),1<n.length&&(e=!0),u({name:"NVL",params:arguments,checkFunction:function(){return!e},minCount:1,paramType:["any"],errorText:BI.i18nText("BI-Front-Expression_nvl_param_same","ISNULL")}),"any"}),i(this,"nvl",this.NVL);var n=this,t=(["ABS","ACOS","ASIN","ATAN","ATAN2","CEILING","COS","DEGREES","EXP","FACT","FLOOR","INT","LN","LOG10","PI","RADIANS","SIGN","SIN","SORT","TAN"].forEach(function(e){n[e]=n[e.toLowerCase()]=function(){return u({name:e,params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)},paramCount:1,paramType:["number"],errorText:BI.i18nText("BI-Front-Expression_param_number",e)}),"number"}}),["MOD","POWER","PROMOTION","RANBETWEEN","ROUND","SIGN","SIN","SORT","TAN"].forEach(function(e){n[e]=n[e.toLowerCase()]=function(){return u({name:e,params:arguments,checkFunction:function(e){return(0,l.isNumberType)(e)},paramCount:2,paramType:["number","number"],errorText:BI.i18nText("BI-Front-Expression_param_two_number",e)}),"number"}}),BI.Providers.getProvider("bi.formula_editor.checker"));BI.each(t,function(e,t){n[e]=n[e.toLowerCase()]=t}),BI.each(e,function(e,t){n[e]=n[e.toLowerCase()]=t})},u=(t["default"]=c,function u(n){if(!(0,s["default"])(n.paramCount)&&(0,o["default"])(n.params)!==n.paramCount||!(0,s["default"])(n.minCount)&&(0,o["default"])(n.params)<n.minCount||!(0,s["default"])(n.minCount)&&!(0,s["default"])(n.optionalCount)&&(0,o["default"])(n.params)>n.minCount+n.optionalCount)throw new Error(JSON.stringify({type:"function",name:n.name,paramCount:n.paramCount,minCount:n.minCount,optionalCount:n.optionalCount,errorType:"paramCount",errorText:n.errorText}));var r=n.minCount+(n.optionalCount||0),i=!!n.isSupportDynamic;(0,a["default"])(n.params,function(e,t){if(r<t+1&&i)return!1;if(!n.checkFunction(e,t,n.params)&&!(0,l.isAnyType)(e))throw new Error(JSON.stringify({type:"function",name:n.name,paramIndex:t+1,paramType:n.paramType,errorType:"paramType",errorText:n.errorText}))})})},function(e,t,n){"use strict";!function(e){e="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:void 0;null==e.BI&&(e.BI={prepares:[]}),null==e.BI.prepares&&(e.BI.prepares=[])}.call(this,n(68))},function(e,t,n){"use strict";Date.SECOND=1e3,Date.MINUTE=60*Date.SECOND,Date.HOUR=60*Date.MINUTE,Date.DAY=24*Date.HOUR,Date.WEEK=7*Date.DAY,Object.defineProperty(Date.prototype,"getTimezone",{value:function(){return BI.getTimezone(this)}}),Object.defineProperty(Date.prototype,"getMonthDays",{value:function(e){return BI.getMonthDays(this,e)}}),Object.defineProperty(Date.prototype,"getLastDateOfMonth",{value:function(){return BI.getLastDateOfMonth(this)}}),Object.defineProperty(Date.prototype,"getDayOfYear",{value:function(){return BI.getDayOfYear(this)}}),Object.defineProperty(Date.prototype,"getWeekNumber",{value:function(){return BI.getWeekNumber(this)}}),Object.defineProperty(Date.prototype,"getQuarter",{value:function(){return BI.getQuarter(this)}}),Object.defineProperty(Date.prototype,"getOffsetDate",{value:function(e){return BI.getOffsetDate(this,e)}}),Object.defineProperty(Date.prototype,"getOffsetQuarter",{value:function(e){return BI.getOffsetQuarter(this,e)}}),Object.defineProperty(Date.prototype,"getQuarterStartMonth",{value:function(){return BI.getQuarter(this)}}),Object.defineProperty(Date.prototype,"getQuarterStartDate",{value:function(){return BI.getQuarterStartDate(this)}}),Object.defineProperty(Date.prototype,"getQuarterEndDate",{value:function(){return BI.getQuarterEndDate(this)}}),Object.defineProperty(Date.prototype,"getOffsetMonth",{value:function(e){return BI.getOffsetMonth(this,e)}}),Object.defineProperty(Date.prototype,"getWeekStartDate",{value:function(){return BI.getWeekStartDate(this)}}),Object.defineProperty(Date.prototype,"getWeekEndDate",{value:function(){return BI.getWeekEndDate(this)}}),Object.defineProperty(Date.prototype,"print",{value:function(e){return BI.print(this,e)}})},function(e,t,n){"use strict";Function.prototype.before=function(e){return BI.beforeFunc(this,e)},Function.prototype.after=function(e){return BI.afterFunc(this,e)}},function(e,t,n){"use strict";Number.prototype.add=function(e){return BI.add(this,e)},Number.prototype.sub=function(e){return BI.sub(this,e)},Number.prototype.mul=function(e){return BI.mul(this,e)},Number.prototype.div=function(e){return BI.div(this,e)}},function(e,t,n){"use strict";_.extend(String.prototype,{startWith:function(e){return BI.startWith(this,e)},endWith:function(e){return BI.endWith(this,e)},getQuery:function(e){return BI.getQuery(this,e)},appendQuery:function(e){return BI.appendQuery(this,e)},replaceAll:function(e,t){return BI.replaceAll(this,e,t)},perfectStart:function(e){return BI.perfectStart(this,e)},allIndexOf:function(e){return BI.allIndexOf(this,e)}})},function(e,t,n){"use strict";BI.extend(BI,{openWindow:function(e,t,n){var r=null;try{r=window.top.open.apply(window.top,arguments)}catch(i){r=window.open.apply(window,arguments)}return r}})},function(e,t,n){"use strict";var r;(r=function r(e){this.hexcase=e?1:0,this.b64pad="",this.chrsz=8}).prototype.hex_md5=function(e){return this.binl2hex(this.core_md5(this.str2binl(e),e.length*this.chrsz))},r.prototype.hex_md5_salt=function(e){for(var t=this.hex_md5(e),n=[],r=[],i=0;i<t.length;i++)(i%2==0?n:r).push(t.charAt(i));return":"+n.join("")+r.join("")},r.prototype.b64_md5=function(e){return this.binl2b64(this.core_md5(this.str2binl(e),e.length*this.chrsz))},r.prototype.hex_hmac_md5=function(e,t){return this.binl2hex(this.core_hmac_md5(e,t))},r.prototype.b64_hmac_md5=function(e,t){return this.binl2b64(this.core_hmac_md5(e,t))},r.prototype.calcMD5=function(e){return this.binl2hex(this.core_md5(this.str2binl(e),e.length*this.chrsz))},r.prototype.core_md5=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,o=271733878,a=0;a<e.length;a+=16){var s=n,l=r,c=i,u=o,n=this.md5_ff(n,r,i,o,e[a+0],7,-680876936),o=this.md5_ff(o,n,r,i,e[a+1],12,-389564586),i=this.md5_ff(i,o,n,r,e[a+2],17,606105819),r=this.md5_ff(r,i,o,n,e[a+3],22,-1044525330);n=this.md5_ff(n,r,i,o,e[a+4],7,-176418897),o=this.md5_ff(o,n,r,i,e[a+5],12,1200080426),i=this.md5_ff(i,o,n,r,e[a+6],17,-1473231341),r=this.md5_ff(r,i,o,n,e[a+7],22,-45705983),n=this.md5_ff(n,r,i,o,e[a+8],7,1770035416),o=this.md5_ff(o,n,r,i,e[a+9],12,-1958414417),i=this.md5_ff(i,o,n,r,e[a+10],17,-42063),r=this.md5_ff(r,i,o,n,e[a+11],22,-1990404162),n=this.md5_ff(n,r,i,o,e[a+12],7,1804603682),o=this.md5_ff(o,n,r,i,e[a+13],12,-40341101),i=this.md5_ff(i,o,n,r,e[a+14],17,-1502002290),r=this.md5_ff(r,i,o,n,e[a+15],22,1236535329),n=this.md5_gg(n,r,i,o,e[a+1],5,-165796510),o=this.md5_gg(o,n,r,i,e[a+6],9,-1069501632),i=this.md5_gg(i,o,n,r,e[a+11],14,643717713),r=this.md5_gg(r,i,o,n,e[a+0],20,-373897302),n=this.md5_gg(n,r,i,o,e[a+5],5,-701558691),o=this.md5_gg(o,n,r,i,e[a+10],9,38016083),i=this.md5_gg(i,o,n,r,e[a+15],14,-660478335),r=this.md5_gg(r,i,o,n,e[a+4],20,-405537848),n=this.md5_gg(n,r,i,o,e[a+9],5,568446438),o=this.md5_gg(o,n,r,i,e[a+14],9,-1019803690),i=this.md5_gg(i,o,n,r,e[a+3],14,-187363961),r=this.md5_gg(r,i,o,n,e[a+8],20,1163531501),n=this.md5_gg(n,r,i,o,e[a+13],5,-1444681467),o=this.md5_gg(o,n,r,i,e[a+2],9,-51403784),i=this.md5_gg(i,o,n,r,e[a+7],14,1735328473),r=this.md5_gg(r,i,o,n,e[a+12],20,-1926607734),n=this.md5_hh(n,r,i,o,e[a+5],4,-378558),o=this.md5_hh(o,n,r,i,e[a+8],11,-2022574463),i=this.md5_hh(i,o,n,r,e[a+11],16,1839030562),r=this.md5_hh(r,i,o,n,e[a+14],23,-35309556),n=this.md5_hh(n,r,i,o,e[a+1],4,-1530992060),o=this.md5_hh(o,n,r,i,e[a+4],11,1272893353),i=this.md5_hh(i,o,n,r,e[a+7],16,-155497632),r=this.md5_hh(r,i,o,n,e[a+10],23,-1094730640),n=this.md5_hh(n,r,i,o,e[a+13],4,681279174),o=this.md5_hh(o,n,r,i,e[a+0],11,-358537222),i=this.md5_hh(i,o,n,r,e[a+3],16,-722521979),r=this.md5_hh(r,i,o,n,e[a+6],23,76029189),n=this.md5_hh(n,r,i,o,e[a+9],4,-640364487),o=this.md5_hh(o,n,r,i,e[a+12],11,-421815835),i=this.md5_hh(i,o,n,r,e[a+15],16,530742520),r=this.md5_hh(r,i,o,n,e[a+2],23,-995338651),n=this.md5_ii(n,r,i,o,e[a+0],6,-198630844),o=this.md5_ii(o,n,r,i,e[a+7],10,1126891415),i=this.md5_ii(i,o,n,r,e[a+14],15,-1416354905),r=this.md5_ii(r,i,o,n,e[a+5],21,-57434055),n=this.md5_ii(n,r,i,o,e[a+12],6,1700485571),o=this.md5_ii(o,n,r,i,e[a+3],10,-1894986606),i=this.md5_ii(i,o,n,r,e[a+10],15,-1051523),r=this.md5_ii(r,i,o,n,e[a+1],21,-2054922799),n=this.md5_ii(n,r,i,o,e[a+8],6,1873313359),o=this.md5_ii(o,n,r,i,e[a+15],10,-30611744),i=this.md5_ii(i,o,n,r,e[a+6],15,-1560198380),r=this.md5_ii(r,i,o,n,e[a+13],21,1309151649),n=this.md5_ii(n,r,i,o,e[a+4],6,-145523070),o=this.md5_ii(o,n,r,i,e[a+11],10,-1120210379),i=this.md5_ii(i,o,n,r,e[a+2],15,718787259),r=this.md5_ii(r,i,o,n,e[a+9],21,-343485551),n=this.safe_add(n,s),r=this.safe_add(r,l),i=this.safe_add(i,c),o=this.safe_add(o,u)}return Array(n,r,i,o)},r.prototype.md5_cmn=function(e,t,n,r,i,o){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(r,o)),i),n)},r.prototype.md5_ff=function(e,t,n,r,i,o,a){return this.md5_cmn(t&n|~t&r,e,t,i,o,a)},r.prototype.md5_gg=function(e,t,n,r,i,o,a){return this.md5_cmn(t&r|n&~r,e,t,i,o,a)},r.prototype.md5_hh=function(e,t,n,r,i,o,a){return this.md5_cmn(t^n^r,e,t,i,o,a)},r.prototype.md5_ii=function(e,t,n,r,i,o,a){return this.md5_cmn(n^(t|~r),e,t,i,o,a)},r.prototype.core_hmac_md5=function(e,t){for(var n=this.str2binl(e),r=(16<n.length&&(n=this.core_md5(n,e.length*this.chrsz)),Array(16)),i=Array(16),o=0;o<16;o++)r[o]=909522486^n[o],i[o]=1549556828^n[o];e=this.core_md5(r.concat(this.str2binl(t)),512+t.length*this.chrsz);return this.core_md5(i.concat(e),640)},r.prototype.safe_add=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},r.prototype.bit_rol=function(e,t){return e<<t|e>>>32-t},r.prototype.str2binl=function(e){for(var t=Array(),n=(1<<this.chrsz)-1,r=0;r<e.length*this.chrsz;r+=this.chrsz)t[r>>5]|=(e.charCodeAt(r/this.chrsz)&n)<<r%32;return t},r.prototype.binl2hex=function(e){for(var t=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n},r.prototype.binl2b64=function(e){for(var t="",n=0;n<4*e.length;n+=3)for(var r=(e[n>>2]>>n%4*8&255)<<16|(e[n+1>>2]>>(n+1)%4*8&255)<<8|e[n+2>>2]>>(n+2)%4*8&255,i=0;i<4;i++)8*n+6*i>32*e.length?t+=this.b64pad:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>6*(3-i)&63);return t},BI.MD5=new r},function(e,t,n){"use strict";function r(e,t){return e<<t|e>>>32-t}function C(e){return(255&c[e>>>24&255])<<24|(255&c[e>>>16&255])<<16|(255&c[e>>>8&255])<<8|255&c[255&e]}function w(e){return e^r(e,2)^r(e,10)^r(e,18)^r(e,24)}function B(e){return e^r(e,13)^r(e,23)}function o(e,t,n){for(var r,i,o=[],a=0,s=new Array(N),l=t,c=s,t=n,u=new Array(4),h=new Array(4),d=0;d<4;d++)h[0]=255&l[0+4*d],h[1]=255&l[1+4*d],h[2]=255&l[2+4*d],h[3]=255&l[3+4*d],u[d]=h[0]<<24|h[1]<<16|h[2]<<8|h[3];for(u[0]^=2746333894,u[1]^=1453994832,u[2]^=1736282519,u[3]^=2993693404,r=0;r<32;r+=4)i=C(i=u[1]^u[2]^u[3]^O[r+0]),c[r+0]=u[0]^=B(i),i=C(i=u[2]^u[3]^u[0]^O[r+1]),c[r+1]=u[1]^=B(i),i=C(i=u[3]^u[0]^u[1]^O[r+2]),c[r+2]=u[2]^=B(i),i=C(i=u[0]^u[1]^u[2]^O[r+3]),c[r+3]=u[3]^=B(i);if(t===R)for(r=0;r<16;r++)i=c[r],c[r]=c[31-r],c[31-r]=i;new Array(16);for(var p,f=new Array(16),m=e.length;A<=m;){p=e.slice(a,a+16),S=E=x=I=b=g=_=v=y=void 0;for(var g,b,y=p,v=f,_=s,I=new Array(4),x=new Array(4),E=0;E<4;E++)x[0]=255&y[0+4*E],x[1]=255&y[1+4*E],x[2]=255&y[2+4*E],x[3]=255&y[3+4*E],I[E]=x[0]<<24|x[1]<<16|x[2]<<8|x[3];for(g=0;g<32;g+=4)b=C(I[1]^I[2]^I[3]^_[g+0]),I[0]=I[0]^w(b),b=C(I[2]^I[3]^I[0]^_[g+1]),I[1]=I[1]^w(b),b=C(I[3]^I[0]^I[1]^_[g+2]),I[2]=I[2]^w(b),b=C(I[0]^I[1]^I[2]^_[g+3]),I[3]=I[3]^w(b);for(var S=0;S<16;S+=4)v[S]=I[3-S/4]>>>24&255,v[S+1]=I[3-S/4]>>>16&255,v[S+2]=I[3-S/4]>>>8&255,v[S+3]=255&I[3-S/4];for(var T=0;T<A;T++)o[a+T]=f[T];m-=A,a+=A}return o}function a(e,t){if(t===R)return e.slice(0,e.lastIndexOf(128));var n=16-e.length%16;0<n&&e.push(128);for(var r=0;r<n-1;r++)e.push(0);return e}function i(e){for(var t="",n=e.length,r=0;r<n;r++)t+=String.fromCharCode(e[r]);for(var i,o,a,s=t,l="",c=0,u=(s=String(s)).length%3;c<s.length;){if(255<(i=s.charCodeAt(c++))||255<(o=s.charCodeAt(c++))||255<(a=s.charCodeAt(c++)))throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");l+=h.charAt((i=i<<16|o<<8|a)>>18&63)+h.charAt(i>>12&63)+h.charAt(i>>6&63)+h.charAt(63&i)}return u?l.slice(0,u-3)+"===".substring(u):l}function s(e){for(var t=function(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(e))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");e+="==".slice(2-(3&e.length));for(var t,n,r,i="",o=0;o<e.length;)t=h.indexOf(e.charAt(o++))<<18|h.indexOf(e.charAt(o++))<<12|(n=h.indexOf(e.charAt(o++)))<<6|(r=h.indexOf(e.charAt(o++))),i+=64===n?String.fromCharCode(t>>16&255):64===r?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,255&t);return i}(e),n=[],r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}function l(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t}var R,N,A,c,O,h,u;c=[214,144,233,254,204,225,61,183,22,182,20,194,40,251,44,5,43,103,154,118,42,190,4,195,170,68,19,38,73,134,6,153,156,66,80,244,145,239,152,122,51,84,11,67,237,207,172,98,228,179,28,169,201,8,232,149,128,223,148,250,117,143,63,166,71,7,167,252,243,115,23,186,131,89,60,25,230,133,79,168,104,107,129,178,113,100,218,139,248,235,15,75,112,86,157,53,30,36,14,94,99,88,209,162,37,34,124,59,1,33,120,135,212,R=0,70,87,159,211,39,82,76,54,2,231,160,196,200,158,234,191,138,210,64,199,56,181,163,247,242,206,249,97,21,161,224,174,93,164,155,52,26,85,173,147,50,48,245,140,177,227,29,246,226,46,130,102,202,96,192,41,35,171,13,83,78,111,213,219,55,69,222,253,142,47,3,255,106,114,109,108,91,81,141,27,175,146,187,221,188,127,17,217,92,65,31,A=16,90,216,10,193,49,136,165,205,123,189,45,116,208,18,184,229,180,176,137,105,151,74,12,150,119,126,101,185,241,9,197,110,198,132,24,240,125,236,58,220,77,N=32,121,238,95,62,215,203,57,72],O=[462357,472066609,943670861,1415275113,1886879365,2358483617,2830087869,3301692121,3773296373,4228057617,404694573,876298825,1347903077,1819507329,2291111581,2762715833,3234320085,3705924337,4177462797,337322537,808926789,1280531041,1752135293,2223739545,2695343797,3166948049,3638552301,4110090761,269950501,741554753,1213159005,1684763257],h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=function u(){this.ecbEncrypt=function(e,t){if(32!==t.length||/[^0-9a-fA-F]/.test(t))throw new Error("key error");return i(o(a(function(e){for(var t=unescape(encodeURIComponent(e)),n=[],r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(e)),l(t),1))},this.ecbDecrypt=function(e,t){if(32!==t.length||/[^0-9a-fA-F]/.test(t))throw new Error("key error");for(var n=a(o(s(e),l(t),0),0),r=[],i=0;i<n.length;i++)r.push(String.fromCharCode(n[i]));return decodeURIComponent(escape(r.join("")))}},BI.SM4=new u},function(e,t,n){"use strict";function r(i,e,o){var a={approved:!0,errors:[],rules:{}};return BI.each(e,function(e,t){if(o&&!a.approved)return!1;var n,r;BI.has(s,e)?!1!==t&&(n=function(n,e){var r={},t=e.options,i=e.expects,o=BI.size(i);BI.isNotEmptyArray(i)&&BI.each(i,function(e,t){BI.has(n,t)?r[t]=n[t]:o<=1&&(BI.isKey(n)||BI.isRegExp(n))?r[t]=n:o<=1&&BI.isFunction(n)?r[t]=n():_global.console&&console.error("expects the "+i+" parameter")});BI.isNotEmptyArray(t)&&BI.each(t,function(e,t){BI.has(n,t)&&(r[t]=n[t])});return r}(t,s[e]),r=s[e].validate(i,n),t=(BI.has(t,"message")?t:s[e]).message,t=BI.isFunction(t)?t(i,n):t,a.rules[e]={approved:r,errors:r?"":t},r||(a.errors.push(t),a.approved=!1)):_global.console&&console.error(e+" is not support")}),a}var s,i;s={required:{message:"required",validate:function(e){return BI.isNotEmptyString(e)||BI.isNotEmptyArray(e)||BI.isNotEmptyObject(e)}},range:{validate:function(e,t){return BI.isNumeric(e)?e>=t.min&&e<=t.max:!!BI.isString(e)&&(BI.size(e)>=t.min&&BI.size(e)<=t.max)},message:"not in range",expects:["min","max"]},min:{message:"not min",validate:function(e,t){return BI.size(e)>=t.value},expects:["value"]},max:{message:function(e,t){return e+" max than "+t.value},validate:function(e,t){return BI.size(e)<=t.value},expects:["value"]},equal:{message:"not equal",validate:function(e,t){return BI.isEqual(e,t.value)},expects:["value"]},regex:{message:"not match",validate:function(e,t){if(BI.isRegExp(t.value))return t.value.test(e);_global.console&&console.error(t.value+" is not a valid regular expression")},expects:["value"]}},i=function i(){this.init=function(e){s=BI.extend(s,e)},this.validate=function(e,t,n){if(BI.isObject(t))return r(e,t,n)},this.addRule=function(e,t){BI.has(s,e)?_global.console&&console.error("rule:["+e+"] has been registed"):s[e]=t}},BI.validator=new i},function(e,t,n){"use strict";BI.SearchIconTextValueCombo=BI.inherit(BI.Widget,{props:{baseCls:"bi-material-search-icon-text-value-combo",height:24,text:"",items:[],iconCls:"",tipType:"",warningTitle:"",attributes:{tabIndex:0}},render:function(){var t=this,e=this.options;return{type:"bi.absolute",items:[{el:{type:"bi.combo",container:e.container,adjustLength:2,toggle:!1,ref:function(){t.combo=this},el:{type:"bi.material.search_icon_text_value_trigger",simple:e.simple,cls:"search-text-value-trigger",ref:function(){t.trigger=this},items:e.items,height:e.height-(e.simple?1:2),text:e.text,value:e.value,tipType:e.tipType,iconCls:e.iconCls,warningTitle:e.warningTitle,title:e.title,listeners:[{eventName:BI.SearchTextValueTrigger.EVENT_CHANGE,action:function(){t.setValue(this.getValue()),t.combo.hideView(),t.fireEvent("EVENT_CHANGE")}}]},popup:{el:{type:"bi.icon_text_value_combo_popup",chooseType:BI.ButtonGroup.CHOOSE_TYPE_SINGLE,value:e.value,items:e.items,ref:function(){t.popup=this,t.trigger.getSearcher().setAdapter(t.popup)},listeners:[{eventName:BI.TextValueComboPopup.EVENT_CHANGE,action:function(){t.setValue(this.getValue()),t.combo.hideView(),t.fireEvent("EVENT_CHANGE")}}]},maxHeight:252},listeners:[{eventName:BI.Combo.EVENT_AFTER_HIDEVIEW,action:function(){t.trigger.stopEditing()}},{eventName:BI.Combo.EVENT_BEFORE_POPUPVIEW,action:function(){t.fireEvent("EVENT_BEFORE_POPUPVIEW")}}],hideChecker:function(e){return 0===t.triggerBtn.element.find(e.target).length}},left:0,right:0,bottom:0,top:0},{el:{type:"bi.trigger_icon_button",cls:"trigger-icon-button",ref:function(){t.triggerBtn=this},width:e.height,height:e.height,handler:function(){t.combo.isViewVisible()?t.combo.hideView():t.combo.showView()}},right:0,bottom:0,top:0}]}},mounted:function(){var e=this.options;BI.isKey(e.value)&&this._checkError(e.value)},_checkError:function(n){var e;BI.isNotNull(n)&&(n=BI.isArray(n)?n:[n],e=BI.find(this.options.items,function(e,t){return BI.contains(n,t.value)}),BI.isNull(e)?(this.element.removeClass("combo-error").addClass("combo-error"),this.trigger.attr("tipType","warning")):(this.element.removeClass("combo-error"),this.trigger.attr("tipType","success")))},populate:function(e){this.options.items=e,this.combo.populate(e)},setValue:function(e){this.combo.setValue(e),this._checkError(e)},getValue:function(){var e=this.popup.getValue();return BI.isNull(e)?[]:BI.isArray(e)?e:[e]}}),BI.shortcut("bi.material.search_icon_text_value_combo",BI.SearchIconTextValueCombo)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Trigger,{props:function(e){return{extraCls:"bi-material-search-icon-text-trigger "+(e.simple?"bi-border-bottom":"bi-border"),height:24}},render:function(){var t=this,r=this.options,e=this._digistIcon(r.value,r.items);return{type:"bi.htape",items:[{el:{type:"bi.icon_change_button",cls:"icon-combo-trigger-icon",iconCls:e,ref:function(e){t.icon=e},disableSelected:!0},vgap:3,width:BI.isKey(e)?r.iconWrapperWidth||r.height:0},{el:{type:"bi.searcher",ref:function(){t.searcher=this},isAutoSearch:!1,el:{type:"bi.state_editor",ref:function(){t.editor=this},defaultText:this._getText(),text:r.text,value:r.value,height:r.height,tipText:""},popup:{type:"bi.icon_text_value_combo_popup",cls:"bi-card",chooseType:BI.ButtonGroup.CHOOSE_TYPE_SINGLE},onSearch:function(e,t){var e=e.keyword,e=BI.Func.getSearchResult(r.items,e),n=e.match,e=e.find;t(BI.concat(e,n))},listeners:[{eventName:BI.Searcher.EVENT_CHANGE,action:function(){t.fireEvent("EVENT_CHANGE")}}]}},{el:{type:"bi.layout",width:24},width:24}],ref:function(e){t.wrapper=e}}},_setState:function(e){this.editor.setState(e)},_getText:function(){var e=this.options;return BI.isKey(e.value)&&e.text===this._digest(e.value,e.items)?"":e.text},_digest:function(n,e){var t=this.options,r=(n=BI.isArray(n)?n:[n],[]),e=BI.Tree.transformToArrayFormat(e);return BI.each(e,function(e,t){BI.deepContains(n,t.value)&&!BI.contains(r,t.text||t.value)&&r.push(t.text||t.value)}),0<r.length?r.join(","):t.text},_digistIcon:function(n,e){var r,t=this.options,e=(n=BI.isArray(n)?n:[n],BI.Tree.transformToArrayFormat(e));return BI.any(e,function(e,t){if(BI.deepContains(n,t.value))return r={text:t.text||t.value,iconCls:t.iconCls},!0}),(BI.isNotNull(r)?r:t).iconCls},stopEditing:function(){this.searcher.stopSearch()},getSearcher:function(){return this.searcher},populate:function(e){this.options.items=e},setValue:function(e){var t=this._digistIcon(e,this.options.items);this.setIcon(t),this._setState(this._digest(e,this.options.items))},setIcon:function(e){var t=this.options,n=(this.icon.setIcon(e),this.wrapper.attr("items")[0]);BI.isKey(e)?n.width!==(t.iconWrapperWidth||t.height)&&(n.width=t.iconWrapperWidth||t.height,this.wrapper.resize()):0!==n.width&&(n.width=0,this.wrapper.resize())},getValue:function(){return this.searcher.getValue()}}),BI.shortcut("bi.material.search_icon_text_value_trigger",r)},function(e,t,n){"use strict";BI.FullScreenController=BI.inherit(BI.Controller,{props:{},_init:function(){BI.FullScreenController.superclass._init.apply(this,arguments),this.exitHandlers=[]},requestFullScreen:function(e,t,n){BI.isNull(this.support)&&(this.support=this._checkSupportScreenHandler()),this.support?(BI.isWidget(e)&&(e=e.element[0]),this._launchFullScreen(e,n),t.call(this,!0)):(BI.Msg.toast(BI.i18nText("fullscreen api not support"),{level:"error"}),t(!1))},getFullScreenElement:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||null},isFullScreen:function(e){return!!((e=e||document).fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement)},exitFullScreen:function(){return this._existFullscreenHandler(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),BI.each(this.exitHandlers,function(e,t){BI.isFunction(t)&&t()}),this},_launchFullScreen:function(e,t){var n=this;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullScreen(),BI.$(e).addClass("bi-fullscreen-element"),this.fullscreenElement=e,BI.$(document).bind("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){n.isFullScreen()||(BI.isFunction(t)&&t(),n.exitHandlers=[],n._existFullscreenHandler(),BI.$(document).unbind("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange"))})},_checkSupportScreenHandler:function(){document.body&&(e=document.body.requestFullscreen||document.body.webkitRequestFullscreen||document.body.mozRequestFullScreen||document.body.msRequestFullscreen);var e,t=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled;return!(!e||!t)},_existFullscreenHandler:function(){var e=this.getFullScreenElement()||this.fullscreenElement;e&&BI.$(e).removeClass("bi-fullscreen-element"),this.fullscreenElement=null}}),BI.FullScreen=new BI.FullScreenController},function(e,t,n){"use strict";BI.AbstractFilterItem=BI.inherit(BI.Widget,{props:{baseCls:"bi-filter-item bi-border-right bi-border-bottom"},isSelectedCondition:function(){return this.emptyItem&&this.emptyItem.isVisible()},setSelectedCondition:function(e){e&&!this.emptyItem&&(this.emptyItem=BI.createWidget({type:"bi.absolute",height:40,cls:"filter-item-empty-item bi-border-top",items:[{el:{type:"bi.center_adapt",cls:"empty-filter-item-leaf"}}],hgap:10,vgap:5}),BI.createWidget({type:"bi.vertical",element:this,items:[this.emptyItem],scrolly:!1})),this.emptyItem&&this.emptyItem.setVisible(e)}}),BI.extend(BI.AbstractFilterItem,{FILTER_OPERATION_FORMULA:1,FILTER_OPERATION_CONDITION:2,FILTER_OPERATION_CONDITION_AND:3,FILTER_OPERATION_CONDITION_OR:4,FILTER_OPERATION_FORMULA_AND:5,FILTER_OPERATION_FORMULA_OR:6,FILTER_OPERATION_SHAKE:7})},function(e,t,n){"use strict";BI.AndOrFilterExpander=BI.inherit(BI.Widget,{props:{baseCls:"bi-filter-expander",el:{},popup:{}},render:function(){var t=this,e=this.options;return{type:"bi.filter_expander",switchable:e.switchable,el:e.el,popup:e.popup,id:e.id,value:e.value,listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(){t.fireEvent(BI.Controller.EVENT_CHANGE,arguments)}}],ref:function(e){t.expander=e}}},populate:function(){this.expander.populate.apply(this.expander,arguments)},getValue:function(){var e=this.expander.getValue();return{filterType:e.type,filterValue:e.value,id:e.id}}}),BI.shortcut("bi.and.or.filter.expander",BI.AndOrFilterExpander)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.AbstractFilterItem,{_constant:{EXPANDER_WIDTH:30},props:{baseCls:"bi-filter-expander-item bi-filter-expander bi-border-left bi-border-bottom",el:{},popup:{},switchable:!0},render:function(){var t=this,e=this.options,n=e.el.value;return{type:"bi.horizontal_adapt",cls:"filter-item-empty-item",horizontalAlign:BI.HorizontalAlign.Stretch,columnSize:[this._constant.EXPANDER_WIDTH,"fill"],verticalAlign:BI.VerticalAlign.Middle,items:[{type:"bi.absolute",cls:"filter-item-expander-wrapper",items:[{el:{type:"bi.text_button",$testId:"bi-materials-filter-and-or-expander",cls:"condition-and-or",text:this._getText(n),value:n,id:e.id,width:this._constant.EXPANDER_WIDTH,height:"100%",ref:function(e){t.expander=e},listeners:[{eventName:BI.TextButton.EVENT_CHANGE,action:function(){t.fireEvent(BI.Controller.EVENT_CHANGE,BI.Events.CLICK,"",t)}}]},left:0,top:0,right:0,bottom:0},{el:{type:"bi.icon_button",invisible:!e.switchable,stopPropagation:!0,cls:"change-and-or-font",title:BI.i18nText("BI-Basic_Switch"),handler:function(){t.switchText(),t.fireEvent(BI.Controller.EVENT_CHANGE,BI.Events.CLICK,!0,t)}},top:10,width:16,height:16,left:7}],width:this._constant.EXPANDER_WIDTH,height:"100%"},BI.extend(e.popup,{ref:function(e){t.conditionsView=e},listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(){t.fireEvent(BI.Controller.EVENT_CHANGE,arguments)}}]})]}},_getText:function(e){return e===BI.Filter.FILTER_TYPE.AND?BI.i18nText("BI-Basic_And"):BI.i18nText("BI-Basic_Or")},switchText:function(){var e=this.expander.getValue()===BI.Filter.FILTER_TYPE.AND?BI.Filter.FILTER_TYPE.OR:BI.Filter.FILTER_TYPE.AND;this.expander.setValue(e),this.expander.setText(this._getText(e))},getValue:function(){return{type:this.expander.getValue(),value:this.conditionsView.getValue(),id:this.options.id}},populate:function(){this.conditionsView.populate.apply(this.conditionsView,arguments)}}),BI.shortcut("bi.filter_expander",r)},function(e,t,n){"use strict";BI.Filter=BI.inherit(BI.Widget,{constants:{FIELD_TYPE_NUMBER:1,FIELD_TYPE_STRING:0,FIELD_TYPE_DATE:2},props:{baseCls:"bi-filter",expander:{},items:[],el:{},itemCreator:BI.empty},_store:function(){return BI.Models.getModel("bi.model.material.filter")},watch:{shakeTree:function(){this.shakeTree()}},render:function(){var r=this,e=this.options;return BI.extend({type:"bi.filter_operation",addWarningTitle:e.addWarningTitle,expander:e.expander,listeners:[{eventName:"EVENT_OPERATION",action:function(e){switch(e){case BI.AbstractFilterItem.FILTER_OPERATION_CONDITION:r.store.addCondition(),r._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_CONDITION);break;case BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND:r.store.addAndCondition(),r._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_CONDITION);break;case BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_OR:r.store.addOrCondition(),r._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_CONDITION,1);break;case BI.AbstractFilterItem.FILTER_OPERATION_FORMULA:r.store.addFormula(),r._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_FORMULA);break;case BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND:r.store.addAndFormula(),r._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_FORMULA);break;case BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_OR:r.store.addOrFormula(),r._addAndOrCondition(BI.Filter.FILTER_TYPE.EMPTY_FORMULA,1);break;case BI.AbstractFilterItem.FILTER_OPERATION_SHAKE:r.store.shakeTree()}}},{eventName:"BI.FilterOperation.EVENT_DESTROY_ITEM",action:function(e){r._removeCondition(e)}},{eventName:"EVENT_CLICK_EXPANDER",action:function(e,t,n){r._switchConditionLink(n),r._checkBeautifyLevelNecessary(),r.fireEvent("EVENT_CHANGE")}}],ref:function(e){r.filter=e}},e.el)},mounted:function(){this.tree=new BI.Tree,this.tree.initTree(this.options.items),this._populate(this.tree.toJSONWithNode())},_checkBeautifyLevelNecessary:function(){this.filter.setBeautifyButtonVisible(this._checkLevelStructure(this.tree.getRoot()))},_checkLevelStructure:function(n,e){var r=this,t=n.getChildren();if(BI.isNotNull(e)){var e=e.get("data"),i=n.get("data");if(BI.isNotNull(e)&&e.value===i.value)return!0}return BI.any(t,function(e,t){return r._checkLevelStructure(t,n)})},_switchConditionLink:function(e){var e=this.tree.search(e.attr("id"));BI.isNotNull(e)&&((e=e.get("data")).value=e.value===BI.Filter.FILTER_TYPE.AND?BI.Filter.FILTER_TYPE.OR:BI.Filter.FILTER_TYPE.AND)},_createEmptyNode:function(e){var t=new BI.Node(BI.UUID());return t.set("data",{value:e}),t},_insertAndOrCondition:function(e,t,n){var r,i,o,a,s=["AND","OR"],e=(n=n||0,this.tree.search(e));BI.isNotNull(e)&&(a=e.get("data"),i=(r=e.getParent()).getChildIndex(e.id),o=r.get("data")||{},t=this._createEmptyNode(t),a.value===BI.Filter.FILTER_TYPE[s[n]]?this.tree.addNode(e,t):(a.value!==BI.Filter.FILTER_TYPE[s[1-n]]||o.value!==BI.Filter.FILTER_TYPE[s[n]])&&(a.value===BI.Filter.FILTER_TYPE[s[1-n]]&&o.value!==BI.Filter.FILTER_TYPE[s[n]]||o.value===BI.Filter.FILTER_TYPE[s[1-n]]||o.value!==BI.Filter.FILTER_TYPE.AND&&o.value!==BI.Filter.FILTER_TYPE.OR)?((a=new BI.Node(BI.UUID())).set("data",{value:BI.Filter.FILTER_TYPE[s[n]],children:[e.get("data"),t.get("data")]}),r.removeChildByIndex(i),r.addChild(a,i),a.addChild(e),a.addChild(t)):r.addChild(t,i+1))},_removeCondition:function(e){var t,n=this.tree.search(e);BI.isNotNull(n)&&((n=n.getParent()).removeChild(e),n.getChildrenLength()<=1&&(e=n.getParent(),BI.isNotNull(e)&&(t=e.getChildIndex(n.id),e.removeChildByIndex(t),1===n.getChildrenLength()&&e.addChild(n.getFirstChild(),t))),this._populate(this.tree.toJSONWithNode()),this.fireEvent("EVENT_CHANGE"))},_addAndOrCondition:function(e,t){var n,r,i=["AND","OR"],o=(t=t||0,this.filter.getCurrentSelectItem());BI.isNotNull(o)?(o=o.attr("id"),this._insertAndOrCondition(o,e,t)):(o=this._createEmptyNode(e),n=(e=this.tree.getRoot()).getLastChild(),BI.isNotNull(n)?n.get("data").value===BI.Filter.FILTER_TYPE[i[t]]?this.tree.addNode(n,o):((r=new BI.Node(BI.UUID())).set("data",{value:BI.Filter.FILTER_TYPE[i[t]],children:[n.get("data"),o.get("data")]}),e.removeChild(n.id),this.tree.addNode(r),this.tree.addNode(r,n),this.tree.addNode(r,o)):this.tree.addNode(o)),this._populate(this.tree.toJSONWithNode()),this.fireEvent("EVENT_CHANGE")},_shakeTree:function(e,n){for(var t,r,i,o=this,a=0,s=e.getChildren(),l=0;l<s.length;l++){var c=o._shakeTree(s[l],e);0<c&&(l+=c-1)}return BI.isNotNull(n)&&(t=n.get("data"),r=e.get("data"),BI.isNotNull(t)&&t.value===r.value&&(i=n.getChildIndex(e.id),n.removeChild(e.id),BI.each(e.getChildren(),function(e,t){a++,o.tree.addNode(n,t,i+e)}))),a},shakeTree:function(){var e=this.tree.getRoot();this._shakeTree(e),this._populate(this.tree.toJSONWithNode()),this.fireEvent("EVENT_CHANGE")},_populate:function(e){this.filter.defaultState();var n=this.options;n.items=e,BI.Tree.traversal(e,function(e,t){n.itemCreator(t)}),this.filter.populate.apply(this.filter,[e]),this._checkBeautifyLevelNecessary()},populate:function(e){this.tree.initTree(e),this._populate(this.tree.toJSONWithNode())},getValue:function(){return this.filter.getValue()}}),BI.shortcut("bi.filter",BI.Filter),BI.Filter.FILTER_TYPE={},BI.Filter.FILTER_TYPE.FORMULA=33,BI.Filter.FILTER_TYPE.AND=34,BI.Filter.FILTER_TYPE.OR=35,BI.Filter.FILTER_TYPE.EMPTY_FORMULA=36,BI.Filter.FILTER_TYPE.EMPTY_CONDITION=37},function(e,t,n){"use strict";var r;r=BI.inherit(BI.ButtonTree,{props:{baseCls:"bi-button-map"},_createBtns:function(e){var t=this.options,t=BI.createWidgets(BI.createItems(e,{type:"bi.text_button",once:0===t.chooseType})),e=BI.map(e,function(e,t){if((t=BI.stripEL(t)).id||t.value)return t.id||t.value;throw new Error("item must have 'id' or 'value' as its property")});return BI.zipObject(e,t)},setValue:function(n){n=BI.isArray(n)?n:[n],BI.each(this.buttons,function(e,t){BI.isFunction(t.setSelected)?BI.contains(n,e)?t.setSelected&&t.setSelected(!0):t.setSelected&&t.setSelected(!1):t.setValue(n)})},setNotSelectedValue:function(n){n=BI.isArray(n)?n:[n],BI.each(this.buttons,function(e,t){BI.isFunction(t.setSelected)?BI.contains(n,e)?t.setSelected&&t.setSelected(!1):t.setSelected&&t.setSelected(!0):t.setNotSelectedValue(n)})},populate:function(e){var r=this,i=[].slice.call(arguments),o=new BI.LinkHashMap,a=function a(e){return e.id||e.value},s=(this.buttons||(this.buttons={}),[]),l=(BI.each(e,function(e,t){var n;t=BI.stripEL(t),r.buttons[a(t)]?(n=r.buttons[a(t)],i[0]=t.items,i[2]=t,n.populate&&n.populate.apply(n,i)):s.push(t)}),i[0]=s,this._btnsCreator.apply(this,i)),c=[],e=(BI.each(e,function(e,t){t=BI.stripEL(t);var n=r.buttons[a(t)]||l[a(t)];o.add(a(t),n),c.push(n)}),this.buttons=o.map,BI.DOM.hang(this.buttons),this.element.empty(),this._packageItems(e,this._packageBtns(c)));BI.createWidget(BI.extend({element:this},this._packageLayout(e)))},getIndexByValue:function(){throw new Error("Can not use getIndexByValue")}}),BI.shortcut("bi.filter_list",r)},function(e,t,n){"use strict";var r;r=BI.inherit(Fix.Model,{state:function(){return{setSelectedCondition:!1,shakeTree:!1}},childContext:["setSelectedCondition"],computed:{},actions:{addCondition:function(){},addAndCondition:function(){},addOrCondition:function(){},addFormula:function(){},addAndFormula:function(){},addOrFormula:function(){},shakeTree:function(){this.model.shakeTree=!this.model.shakeTree}}}),BI.model("bi.model.material.filter",r)},function(e,t,n){"use strict";BI.FilterOperation=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.FilterOperation.superclass._defaultConfig.apply(this,arguments),{constants:{FORMULA_COMBO:[{text:BI.i18nText("BI-Conf_Formula_And"),$testId:"bi-materials-formula-add",value:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND},{text:BI.i18nText("BI-Conf_Formula_Or"),$testId:"bi-materials-formula-or",value:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_OR}],CONDITION_COMBO:[{text:BI.i18nText("BI-Conf_Condition_And"),$testId:"bi-materials-condition-add",value:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND},{text:BI.i18nText("BI-Conf_Condition_Or"),$testId:"bi-materials-condition-or",value:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_OR}]}})},props:{baseCls:"bi-filter-operation",expander:{},items:[],logic:{dynamic:!1},selections:[BI.AbstractFilterItem.FILTER_OPERATION_CONDITION,BI.AbstractFilterItem.FILTER_OPERATION_FORMULA],itemsCreator:BI.emptyFn},_store:function(){return BI.Models.getModel("bi.model.material.filter_operation")},render:function(){var r=this,e=this.options;return this.currentSelected=null,BI.extend({items:[{el:{type:"bi.left_right_vertical_adapt",items:{left:r._buildOperationButton(),right:[{type:"bi.icon_button",cls:"combine-level-font",title:BI.i18nText("BI-Basic_Beautify_Level"),ref:function(e){r.beautifyButton=e},listeners:[{eventName:BI.IconButton.EVENT_CHANGE,action:function(){r.fireEvent("EVENT_OPERATION",BI.AbstractFilterItem.FILTER_OPERATION_SHAKE)}}]}]},height:24,lrgap:20,rrgap:10},height:24},{el:BI.extend({tgap:10,items:[{el:{type:"bi.left",items:[{type:"bi.filter_pane",expander:e.expander,items:e.items,itemsCreator:e.itemsCreator,listeners:[{eventName:"EVENT_CHANGE",action:function(e,t,n){e===BI.Events.CLICK&&!0!==t&&(BI.isNotNull(r.currentSelected)&&r.currentSelected===n?(r.store.setSelectedCondition(!n.isSelectedCondition()),n.setSelectedCondition(!n.isSelectedCondition())):(BI.isNotNull(r.currentSelected)&&(r.store.setSelectedCondition(!1),r.currentSelected.setSelectedCondition(!1)),r.currentSelected=n,r.store.setSelectedCondition(!0),n.setSelectedCondition(!0))),e===BI.Events.CLICK&&!0===t&&r.fireEvent("EVENT_CLICK_EXPANDER",arguments),e===BI.Events.DESTROY&&(r.currentSelected===n&&(r.currentSelected=null),r.fireEvent("BI.FilterOperation.EVENT_DESTROY_ITEM",t,n))}}],ref:function(e){r.filter=e}}]},top:0,right:2,bottom:0,left:0,rgap:2}]},e.logic.dynamic?{type:"bi.vertical",scrolly:!1}:{type:"bi.absolute",scrollable:!0})}]},e.logic.dynamic?{type:"bi.vertical",scrolly:!1}:{type:"bi.vtape"})},_buildOperationButton:function(){var t=this,n=[],r=this.options;return BI.each(this.options.selections,function(e,t){t===BI.AbstractFilterItem.FILTER_OPERATION_FORMULA?n.push({type:"bi.filter_operation_switch",warningTitle:r.addWarningTitle,addType:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND,listeners:[{eventName:"EVENT_CHANGE",action:function(e){i(e)}}]}):(BI.AbstractFilterItem.FILTER_OPERATION_CONDITION,n.push({type:"bi.filter_operation_switch",warningTitle:r.addWarningTitle,addType:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND,listeners:[{eventName:"EVENT_CHANGE",action:function(e){i(e)}}]}))}),n;function i(e){t.fireEvent("EVENT_OPERATION",e),t.defaultState()}},defaultState:function(){BI.isNotNull(this.currentSelected)&&(this.store.setSelectedCondition(!1),this.currentSelected.setSelectedCondition(!1))},getCurrentSelectItem:function(){if(BI.isNotNull(this.currentSelected)&&this.currentSelected.isSelectedCondition())return this.currentSelected},setBeautifyButtonVisible:function(e){this.beautifyButton.setVisible(!!e)},populate:function(){this.filter.populate.apply(this.filter,arguments)},getValue:function(){return this.filter.getValue()}}),BI.shortcut("bi.filter_operation",BI.FilterOperation)},function(e,t,n){"use strict";var r;r=BI.inherit(Fix.Model,{context:["setSelectedCondition"],computed:{},actions:{setSelectedCondition:function(e){this.model.setSelectedCondition=e}}}),BI.model("bi.model.material.filter_operation",r)},function(e,t,n){"use strict";BI.FilterOperationSwitch=BI.inherit(BI.Single,{props:{baseCls:"bi-filter-operation-switch",width:112,height:24,addType:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND},render:function(){var t=this;return{type:"bi.htape",items:[{el:{type:"bi.text_button",cls:"filter-add-item left-item-radius",$testId:"bi-filter-operation-switch-add-button",text:this._getShowText(this._getDefaultValue()),ref:function(e){t.addButton=e},value:this._getDefaultValue(),listeners:[{eventName:"EVENT_CHANGE",action:function(){t.fireEvent("EVENT_CHANGE",this.getValue())}}]},rgap:1},{el:{type:"bi.down_list_combo",el:{cls:"filter-add-item",title:BI.i18nText("BI-Basic_Switch")},iconCls:"filter-down-font icon-size-12",$testId:"bi-filter-operation-switch-combo",cls:"filter-add-item right-item-radius",items:this._getItemsByType(),value:[{value:this._getDefaultValue()}],listeners:[{eventName:"EVENT_CHANGE",action:function(){var e=this.getValue()[0].value;t.addButton.setValue(e),t.addButton.setText(t._getShowText(e)),t.fireEvent("EVENT_CHANGE",e)}}]},width:16}]}},_getShowText:function(e){switch(e){case BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_OR:return BI.i18nText("BI-Basic_Add_Or_Condition");case BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND:return BI.i18nText("BI-Basic_Add_And_Formula");case BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_OR:return BI.i18nText("BI-Basic_Add_Or_Formula");default:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND;return BI.i18nText("BI-Basic_Add_And_Condition")}},_getDefaultValue:function(){return this.options.addType===BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND?BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND},_getItemsByType:function(){return this.options.addType===BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND?[[{text:BI.i18nText("BI-Basic_And_Condition"),cls:"dot-e-font",value:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_AND,$testId:"bi-filter-operation-switch-combo-item-condition-and"},{text:BI.i18nText("BI-Basic_Or_Condition"),cls:"dot-e-font",value:BI.AbstractFilterItem.FILTER_OPERATION_CONDITION_OR,$testId:"bi-filter-operation-switch-combo-item-condition-or"}]]:[[{text:BI.i18nText("BI-Basic_And_Formula"),cls:"dot-e-font",value:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_AND,$testId:"bi-filter-operation-switch-combo-item-formula-and"},{text:BI.i18nText("BI-Basic_Or_Formula"),cls:"dot-e-font",value:BI.AbstractFilterItem.FILTER_OPERATION_FORMULA_OR,$testId:"bi-filter-operation-switch-combo-item-formula-or"}]]}}),BI.shortcut("bi.filter_operation_switch",BI.FilterOperationSwitch)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-filter-pane",expander:{},items:[],itemsCreator:BI.emptyFn},render:function(){var t=this,e=this.options;return{type:"bi.custom_tree",cls:BI.isNotEmptyArray(e.items)?"bi-border-right bi-border-top":"",expander:BI.extend({type:"bi.filter_expander",el:{},popup:{type:"bi.custom_tree"}},e.expander),el:{type:"bi.filter_list",cls:"filter-list-pane",chooseType:BI.ButtonGroup.CHOOSE_TYPE_DEFAULT,layouts:[{type:"bi.vertical",scrolly:!1}]},items:e.items,listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(){t.fireEvent("EVENT_CHANGE",arguments)}}],ref:function(e){t.tree=e}}},populate:function(e){BI.isNotEmptyArray(e)?this.element.addClass("bi-border-right bi-border-top"):this.element.removeClass("bi-border-right bi-border-top"),this.tree.populate.apply(this.tree,arguments)},getValue:function(){return this.tree.getValue()}}),BI.shortcut("bi.filter_pane",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-form",items:[],rules:{},stop:!1,layouts:[{type:"bi.vertical"}]},_init:function(){r.superclass._init.apply(this,arguments),this.populate(this.options.items)},_createItems:function(e){var n=this.options.rules;return BI.createWidgets(BI.map(e,function(e,t){return BI.extend({type:"bi.form.item"},t,{rules:BI.extend({},n,t.rules)})}))},_itemsCreator:function(e){var n=this,e=this._createItems(e);return BI.each(e,function(e,t){t.on(BI.Events.DESTROY,function(){BI.remove(n.formItems,t)})}),e},_packageItemLayout:function(e){for(var n=this.options,r=n.layouts.length-1;0<r;r--)e=BI.map(e,function(e,t){return BI.extend({},n.layouts[r],{items:[BI.extend({},n.layouts[r].el,{el:t})]})});return e},_packageSimpleItems:function(n){var e=this.options;return BI.map(e.items,function(e,t){return BI.stripEL(t)===t?n[e]:BI.extend({},t,{el:n[e]})})},_packageItems:function(e,t){return BI.createItems(BI.makeArrayByArray(e,{}),BI.clone(t))},_packageLayout:function(e){for(var t=this.options,t=BI.deepClone(t.layouts[0]),n=BI.formatEL(t).el;n&&n.items&&!BI.isEmpty(n.items);)n=BI.formatEL(n.items[0]).el;return n.items=e,t},_isSimpleLayout:function(){var e=this.options;return 1===e.layouts.length&&!BI.isArray(e.items[0])},submit:function(e){var n,r=this.options.stop,i=!0;return BI.each(this.formItems,function(e,t){if(!i&&r)return!0;t.isEnabled()&&BI.isFunction(t.getValidations)&&((n=t.getValidations())&&!n.approved?(t.showError&&t.showError(n.errors[0]),i=!1):t.hideError&&t.hideError())}),i&&BI.isFunction(e)&&e(this.getValue()),i},validate:function(){var n=!0,r=this.options.stop;return BI.each(this.formItems,function(e,t){if(!n&&r)return!0;t.isEnabled()&&BI.isFunction(t.validate)&&!t.validate()&&(n=!1)}),n},getValidations:function(){var n=[];return BI.each(this.formItems,function(e,t){t.isEnabled()&&BI.isFunction(t.getValidations)&&n.push(t.getValidations())}),n},setValue:function(e,t){t=this.getNodeByName(t);t&&t.setValue(e)},getValue:function(){var n=[];return BI.each(this.formItems,function(e,t){t.isEnabled()&&n.push(t.getValue())}),n},getFormValue:function(){var n={};return BI.each(this.formItems,function(e,t){t.options.name&&(n[t.options.name]=t.getValue())}),n},populate:function(e){e=e||[],this.empty(),this.options.items=e,this.formItems=this._itemsCreator.apply(this,arguments),e=this._isSimpleLayout()?this._packageSimpleItems(this.formItems):this._packageItems(e,this._packageItemLayout(this.formItems)),this.layouts=BI.createWidget(BI.extend({element:this},this._packageLayout(e)))},setEnabledItems:function(n){n=BI.isArray(n)?n:[n],BI.each(this.formItems,function(e,t){BI.contains(n,t.options.name)?t.setEnable(!0):t.setEnable(!1)})},getAllItems:function(){return this.formItems},getIndexByName:function(n){var r=-1;return BI.some(this.formItems,function(e,t){if(t.isEnabled()&&t.options.name===n)return r=e,!0}),r},getNodeByName:function(n){var r;return BI.some(this.formItems,function(e,t){if(t.isEnabled()&&t.options.name===n)return r=t,!0}),r},empty:function(){r.superclass.empty.apply(this,arguments),this.options.items=[]},destroy:function(){r.superclass.destroy.apply(this,arguments),this.options.items=[]}}),BI.shortcut("bi.form",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-form-error-item",errorText:"",stop:!0,rules:{}},render:function(){var e=this.options;return this._formItem=BI.createWidget(e.el),e.label?{type:"bi.vertical_adapt",items:[{el:BI.isKey(e.label)?{type:"bi.label",textAlign:"left",textHeight:24,text:e.label,title:e.label,rgap:10}:e.label},{el:this._formItem}]}:{type:"bi.vertical_adapt",items:[{el:this._formItem}]}},getValue:function(){return this._formItem.getValue()},validate:function(){var e=this.options,e=BI.validator.validate(this.getValue(),e.rules,e.stop);return BI.isNull(e)||e.approved},getValidations:function(){var e=this.options;return BI.validator.validate(this.getValue(),e.rules,e.stop)},showError:function(e){e&&BI.Bubbles.show(this.getName(),e,this._formItem)},hideError:function(){BI.Bubbles.hide(this.getName())}}),BI.shortcut("bi.form.error.item",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-form-item",stop:!0,rules:{}},render:function(){var e=this.options;if(e.label)return this.item=BI.createWidget({rules:e.rules,stop:e.stop},e.el),{type:"bi.vertical_adapt",items:[{el:BI.isKey(e.label)?{type:"bi.label",textAlign:"left",textHeight:24,text:e.label,title:e.label,rgap:10}:e.label},{el:this.item}]};this.item=BI.createWidget({rules:e.rules,stop:e.stop,element:this},e.el)},getValue:function(){return this.item.getValue()},validate:function(){return BI.isFunction(this.item.validate)?this.item.validate():this._validate()},getValidations:function(){var e=this.options;return BI.isFunction(this.item.getValidations)?this.item.getValidations():BI.validator.validate(this.getValue(),e.rules,e.stop)},showError:function(e){BI.isFunction(this.item.showError)&&this.item.showError(e)},hideError:function(){BI.isFunction(this.item.hideError)&&this.item.hideError()},_validate:function(){var e=this.options,e=BI.validator.validate(this.getValue(),e.rules,e.stop);return BI.isNull(e)||e.approved}}),BI.shortcut("bi.form.item",r)},function(e,t,n){"use strict";BI.Func=BI.Func||{},BI.extend(BI.Func,{paintWaterMark:function(e,t){for(var t=BI.extend({text:"watermark",fontSize:16,fontFamily:"Microsoft YaHei, PingFangSC-Light, SimHei, SimSun, FangSong, KaiTi, Arial, Tahoma, Verdana, Times New Roman",color:"#999999",opacity:.15,angle:20,fontWeight:"bold",horizontalGap:200,verticalGap:100},t),n=t.angle*Math.PI/180,r=BI.Func.createEmptyCanvas(),i=e.height,o=e.width,a=(t.text+"").split("\n"),s=o*Math.cos(n)+i*Math.sin(n),o=o*Math.sin(n)+i/Math.cos(n),l=(r.width=s,r.height=o,r.getContext("2d")),c=(l.rotate(-n),l.font=t.fontWeight+" "+t.fontSize+"px "+t.fontFamily,l.fillStyle=t.color,l.globalAlpha=t.opacity,l.textAlign="center",0),u=0;u<a.length;u++)c=Math.max(c,l.measureText(a[u]).width);for(var h=c+t.horizontalGap,d=BI.DOM.getTextSizeHeight(t.text,t.fontSize),p=d*a.length+t.verticalGap,f=BI.parseInt(s/h),m=BI.parseInt(o/p),g=e.height*Math.tan(n),b=0;b<m+1;b++)for(var y=0;y<f+3;y++)for(var v=y*h-g+(b%2==0?-h/2:0),_=0;_<a.length;_++)l.fillText(a[_],v,b*p+d*_);i=e.getContext("2d");i.fillStyle=i.createPattern(r,"no-repeat"),i.fillRect(0,0,r.width,r.height)},createEmptyCanvas:function(){var e=document.createElement("canvas");return e=document.createElement("canvas").getContext?e:window.G_vmlCanvasManager.initElement(e)}})},function(e,t,n){"use strict";BI.WarningLabel=BI.inherit(BI.Single,{props:{baseCls:"bi-warning-label",textAlign:"center",whiteSpace:"nowrap",forceCenter:!1,textWidth:null,textHeight:null,hgap:0,vgap:0,lgap:0,rgap:0,tgap:0,bgap:0,text:""},render:function(){var e=this,t=this.options;return{type:"bi.label",ref:function(){e.label=this},textAlign:t.textAlign,whiteSpace:t.whiteSpace,forceCenter:t.forceCenter,textWidth:t.textWidth,textHeight:t.textHeight,hgap:t.hgap,vgap:t.vgap,lgap:t.lgap,rgap:t.rgap,tgap:t.tgap,bgap:t.bgap}},mounted:function(){var e=this.options;BI.isKey(e.text)&&this.setText(e.text)},_digest:function(e){return(e=BI.htmlEncode(e||"")).replaceAll("\\$\\{(.*?)\\}",function(e,t){return"<span class='warning-label'>"+t+"</span>"})},setText:function(e){this.options.text=e,this.label.text.text.element.html(this._digest(e))},getText:function(){return this.options.text},setValue:function(e){this.label.setValue(e)}}),BI.shortcut("bi.warning_label",BI.WarningLabel)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.BasicButton,{props:{baseCls:"bi-line-segment-button bi-list-item-effect",once:!0,readonly:!0,hgap:10,height:25,lineHeight:3},render:function(){var t=this,e=this.options;this.text=BI.createWidget({type:"bi.label",element:this,text:e.text,height:e.height,value:e.value,hgap:e.hgap}),BI.createWidget({type:"bi.absolute",element:this,items:[{el:{type:"bi.layout",cls:"line-segment-button-line",height:e.lineHeight,ref:function(e){t.line=e}},left:0,right:0,bottom:0}]})},setSelected:function(e){r.superclass.setSelected.apply(this,arguments),e?this.line.element.addClass("bi-high-light-background"):this.line.element.removeClass("bi-high-light-background")},setText:function(e){r.superclass.setText.apply(this,arguments),this.text.setText(e)}}),BI.shortcut("bi.line_segment_button",r)},function(e,t,n){"use strict";BI.VirtaulTreeListItem=BI.inherit(BI.Widget,{props:{layer:0,id:"",pId:"",height:24},render:function(){var t=this,e=this.options;return{type:"bi.htape",items:[{el:{type:"bi.layout"},width:15*e.layer},{type:"bi.text_item",logic:{dynamic:!0},id:e.id,pId:e.pId,height:e.height,hgap:e.hgap,text:e.text,value:e.value,py:e.py,keyword:e.keyword,listeners:[{eventName:"__EVENT_CHANGE__",action:function(){t.fireEvent("__EVENT_CHANGE__")}}],ref:function(e){t.item=e}}]}},doHighLight:function(){this.item.doHighLight.apply(this.item,arguments)},unHighLight:function(){this.item.unHighLight.apply(this.item,arguments)},getId:function(){return this.options.id},getPId:function(){return this.options.pId},doClick:function(){BI.VirtaulTreeListItem.superclass.doClick.apply(this,arguments),this.item.setSelected(this.isSelected())},setSelected:function(e){BI.VirtaulTreeListItem.superclass.setSelected.apply(this,arguments),this.item.setSelected(e)}}),BI.shortcut("bi.virtual_tree_list_item",BI.VirtaulTreeListItem)},function(e,t,n){"use strict";BI.GridList=BI.inherit(BI.Widget,{props:{baseCls:"bi-grid-list",items:[],itemHeight:30,showLoader:!1,itemsCreator:BI.emptyFn,onLoaded:BI.emptyFn,hasNext:BI.emptyFn,count:!1,overscanRowCount:0,overflowX:!0,overflowY:!0},mounted:function(){var n=this;this._resizeHandler=BI.debounce(function(){var e=n._getListWidth(),t=n._getListHeight();n.list.getWidth()===e&&n.list.getHeight()===t||n._populate()},30),this.removeListener=BI.ResizeDetector.addResizeListener(this.wrapper,function(){n._resizeHandler()}),BI.isNotEmptyArray(this.options.items)&&this._populate()},render:function(){var t=this,e=this.options;return this.times=1,this.count=0,this.loaderStatus="loaded",{type:"bi.absolute",items:[{el:{type:"bi.grid_view",overflowX:e.overflowX,overflowY:e.overflowY,estimatedRowSize:e.itemHeight,estimatedColumnSize:this._getListWidth(),overscanRowCount:e.overscanRowCount,itemFormatter:e.itemFormatter,rowHeightGetter:function(){return e.itemHeight},columnWidthGetter:function(){return t.listWidth-BI.DOM.getScrollWidth()},ref:function(e){t.list=e},listeners:[{eventName:BI.GridView.EVENT_SCROLL,action:function(e){t.fireEvent("EVENT_SCROLL",e.scrollTop)}}]},top:0,right:0,bottom:0,left:0}],ref:function(e){t.wrapper=e}}},_getListWidth:function(){return this.element.width()},_getListHeight:function(){return this.element.height()},_populate:function(){var e=this.options,t=this,n=(this.listWidth=this._getListWidth(),this.list.setEstimatedColumnSize(this.listWidth-BI.DOM.getScrollWidth()),this.list.setWidth(this.listWidth),this.list.setHeight(this._getListHeight()),BI.map(this.options.items,function(e,t){return[t]}));e.showLoader&&(this._hasNext()||"end"===this.loaderStatus)&&n.push([{type:"bi.loading_bar",ref:function(){"end"===t.loaderStatus?this.setEnd():this.setLoaded()},listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(e){e===BI.Events.CLICK&&(this.setLoading(),t._nextLoad())}}]}]),this.list.populate(n)},_nextLoad:function(){var e=this;this.options.itemsCreator.apply(this,[{times:++this.times},function(){e._addItems.apply(e,arguments)}])},_addItems:function(e){var t=this.options;this.count+=e.length,t.items=BI.concat(t.items,e),this._hasNext()?this.setLoaded():this.setEnd(),this._populate()},_hasNext:function(){var e=this.options;return BI.isNumber(e.count)?this.count<e.count:!!e.hasNext.apply(this,[{times:this.times,count:this.count}])},populate:function(e){var t=this.options,n=this;0===arguments.length&&BI.isFunction(t.itemsCreator)?t.itemsCreator.apply(this,[{times:1},function(){if(0===arguments.length)throw new Error("参数不能为空");n.populate.apply(n,arguments),t.onLoaded()}]):(e&&e!==t.items&&(t.items=e),this.times=1,this.count=e.length,this.loaderStatus="loaded",this._populate())},setScrollTop:function(e){this.list.setScrollTop(e)},setLoaded:function(){this.loaderStatus="loaded"},setEnd:function(){this.loaderStatus="end"},setLoading:function(){this.loaderStatus="loading"},destroyed:function(){this.removeListener&&this.removeListener()}}),BI.GridList.EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.grid_list",BI.GridList)},function(e,t,n){"use strict";function o(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function a(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach(function(e){var t,n;t=r,n=i[e=e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}BI.VirtualTreeList=BI.inherit(BI.Widget,{props:{baseCls:"bi-virtual-tree-list",itemsCreator:BI.emptyFn,items:[],el:{type:"bi.virtual_group_list",rowHeight:32}},render:function(){var t=this,e=this.options;return BI.extend({items:this._getNodes(),ref:function(e){t.treeList=e},overscanHeight:200,blockSize:20},e.el)},_initTree:function(e){BI.isNull(this.tree)&&(this.tree=new BI.Tree);e=BI.Tree.transformToTreeFormat(e);this.tree.initTree(e)},_fillTree:function(e,t){var r=this,n=this.tree.getRoot(),i=this.tree.search(n,e)||n;BI.each(t,function(e,t){var n=new BI.Node(t);n.set("data",a({checked:i.data.checked},t)),r.tree.addNode(i,n)}),this._populate()},_cutTree:function(e){var t=this.tree.getRoot(),t=this.tree.search(t,e);BI.isNotNull(t)&&(t.data.open=!1),this._populate()},_getNodes:function(){var t=[];return this.tree||this._initTree(this.options.items),this.tree.recursion(function(e){if(t.push(BI.extend({id:e.id,pId:e.pId,key:e.key||e.id},e.data)),!0!==e.data.open)return!0}),this._wrapperEvent(t)},_triggerNode:function(e){var t=this,n=this.tree.search(this.tree.getRoot(),e)||this.tree.getRoot();!0===n.data.open?this._cutTree(e):0===n.getChildrenLength()&&n.isParent?this.options.itemsCreator({node:n},function(e){n.data.open=!0,t._fillTree(n.id,e)}):(n.data.open=!0,this._populate())},_triggerNodeChecked:function(e,t){e=this.tree.search(this.tree.getRoot(),e);if(e){e.data.checked=t,e.data.half=!1;for(var n=e.getChildren().slice();n.length;){var r=n.shift();t===r.data.checked&&!r.data.half||(r.data.checked=t,r.data.half=!1,n=n.concat(r.getChildren()))}if(t)for(var i=e.getParent();i!==this.tree.getRoot();)BI.some(i.getChildren(),function(e,t){if(!t.data.checked||t.data.half)return!0})?(i.data.checked=!1,i.data.half=!0):(i.data.checked=!0,i.data.half=!1),i=i.getParent();else for(var o=e.getParent();o!==this.tree.getRoot();)BI.some(o.getChildren(),function(e,t){if(t.data.checked||t.data.half)return!0})?(o.data.checked=!1,o.data.half=!0):(o.data.checked=!1,o.data.half=!1),o=o.getParent()}this._populate()},_populate:function(){this.treeList.populate(this._getNodes())},_wrapperEvent:function(e){var r=this;return BI.map(e,function(e,n){return n.listeners=n.listeners||[],BI.find(n.listeners,function(e,t){return"__EVENT_CHANGE__"===t.eventName})||n.listeners.push({eventName:"__EVENT_CHANGE__",action:function(e,t){e!==BI.Events.COLLAPSE&&e!==BI.Events.EXPAND||(r._triggerNode(n.id),r.fireEvent(BI.VirtualTreeList.EVENT_NODE_CHANGE,r.tree.search(r.tree.getRoot(),n.id)||r.tree.getRoot())),e===BI.Events.CHANGE&&(r._triggerNodeChecked(n.id,t),r.fireEvent("EVENT_CHANGE",r.getTree()))}}),n})},move:function(e,t){if(null!=e&&null!=t&&e!==t){var n=this.tree.search(this.tree.getRoot(),e),r=this.tree.search(this.tree.getRoot(),t);if(n.getParent()!==r.getParent())return!1;r=n.getParent(),e=r.getChildIndex(e),t=r.getChildIndex(t);e<t?(r.addChild(n,t+1),r.removeChildByIndex(e)):(r.addChild(n,t),r.removeChildByIndex(e+1)),this._populate()}},getTree:function(){return this.tree},setOpened:function(e,t){var n=this;t?(function r(e){var e=n.tree.search(n.tree.getRoot(),e),t=e&&e.data.open;e&&!1===t&&(e.data.open=!0,r(e.pId))}(e),this._populate()):this._cutTree(e)},scrollToViewPosition:function(t){var n,e,r;BI.isKey(this.options.el.rowHeight)&&(n=0,this.tree.recursion(function(e){if(e.id===t)return!1;!1!==BI.get(e,["parent","data","open"])&&n++}),e=this.element.scrollTop(),((r=(n+1)*this.options.el.rowHeight)<e||r>e+this.element.height())&&(r=BI.max([0,(n+1)*this.options.el.rowHeight-this.element.height()]),this.element.scrollTop(r)))},getValue:function(){var t=[];return this.tree.recursion(function(e){e=e.data;e.checked&&t.push(BI.isNull(e.value)?e.id:e.value)}),t},populate:function(e){this.options.items=e,this._initTree(this.options.items),this._populate()}}),BI.VirtualTreeList.EVENT_CHANGE="EVENT_CHANGE",BI.VirtualTreeList.EVENT_NODE_CHANGE="EVENT_NODE_CHANGE",BI.shortcut("bi.virtual_tree_list",BI.VirtualTreeList)},function(e,t,n){"use strict";BI.VirtualTreeListNode=BI.inherit(BI.NodeButton,{props:{baseCls:"bi-virtual-tree-list-node",id:"",height:24,layer:0,expandIcon:"expander-down-font",narrowIcon:"expander-right-font"},render:function(){var t=this,e=this.options;return{type:"bi.htape",items:[{el:{type:"bi.layout"},width:15*e.layer},{el:{type:"bi.arrow_group_node_checkbox",cls:e.open?e.expandIcon:e.narrowIcon,ref:function(e){t.arrow=e}},width:16},{type:"bi.label",textAlign:"left",whiteSpace:"nowrap",textHeight:e.height,height:e.height,text:e.text,value:e.value,py:e.py,keyword:e.keyword,ref:function(e){t.text=e}}]}},doRedMark:function(){this.text.doRedMark.apply(this.text,arguments)},unRedMark:function(){this.text.unRedMark.apply(this.text,arguments)},doClick:function(){this.isSelected()?this.triggerExpand():this.triggerCollapse()},setOpened:function(e){BI.VirtualTreeListNode.superclass.setOpened.apply(this,arguments),this.arrow.setSelected(e)},shouldUpdate:function(n){var r=this.options;return BI.some(["open","layer","pId","value","keyword"],function(e,t){return n[t]!==r[t]})},update:function(e){var t=this.options;e.value!==t.value&&(t.value=e.value,this.text.setText(e.value)),e.open!==t.open&&(t.open=e.open,this.arrow.setSelected(e.open)),e.keyword?e.keyword!==t.keyword&&(t.keyword=e.keyword,this.text.doRedMark(e.keyword)):(t.keyword="",this.text.unRedMark(e.value))}}),BI.shortcut("bi.virtual_tree_list_node",BI.VirtualTreeListNode)},function(e,t,n){"use strict";BI.LoadingPane=BI.Pane},function(e,t,n){"use strict";BI.ResizeContainerHtape=BI.inherit(BI.Widget,{props:{baseCls:"bi-resize-container-htape",minSize:260,maxSize:390,initLeftSize:null,left:{type:"bi.default"},right:{type:"bi.default"}},render:function(){var t=this,e=this.options;return{type:"bi.htape",items:[{type:"bi.resizable_container",minSize:e.minSize,maxSize:e.maxSize,content:e.left,resize:BI.bind(this._resizeContainer,this),width:e.initLeftSize||e.minSize},{el:e.right}],ref:function(e){t.contianer=e}}},_resizeContainer:function(e){this.contianer.attr("items")[0].width=e,this.contianer.resize(),this.fireEvent("EVENT_RESIZE",e)}}),BI.ResizeContainerHtape.EVENT_RESIZE="EVENT_RESIZE",BI.shortcut("bi.resize_container.htape",BI.ResizeContainerHtape)},function(e,t,n){"use strict";BI.ResizableContainer=BI.inherit(BI.Widget,{props:{baseCls:"bi-resizable-container",content:{},direction:"e",minSize:15,maxSize:Number.MAX_VALUE,resizable:!0,start:BI.emptyFn,resize:BI.emptyFn,stop:BI.emptyFn,startDragging:BI.emptyFn,broadCastResize:!0},render:function(){var n=this,r=this.options,i=!1,o=0,a=0;function s(e){return BI.clamp(e,r.minSize,r.maxSize||Number.MAX_VALUE)}this.defaultSize=r.height||null,this.handler=BI.createWidget(BI.extend(this._createHandle(),{invisible:!r.resizable})),this.handler.element.on("click",function(e){e.stopPropagation()}),this._stared=!1;var l=new BI.MouseMoveTracker(function(e,t){l.isDragging()&&(n._stared||(n._stared=!0,r.startDragging()),BI.$(document.body).css("cursor",n._isHorizontalResize()?"ew-resize":"ns-resize"),i=!0,"w"===BI.get(r.direction,0)&&(e=-e),a+=e,"n"===BI.get(r.direction,0)&&(t=-t),a+=t,o=s((n.defaultSize||n._getDefaultSize())+a),n.handler.element.addClass("dragging"),r.resize(o),r.broadCastResize&&BI.$(window).trigger("resize"))},function(){!0===i&&(o=s(o),r.stop(o),n.defaultSize=o,a=o=0,i=!1,n._stared=!1,BI.$(document.body).css("cursor","auto")),n.handler.element.removeClass("dragging"),n.handler.element.removeClass("suitable"),l.releaseMouseMoves()},document);return this.handler.element.on("mousedown",function(e){l.captureMouseMoves(e)}),{type:"bi.absolute",items:[{el:r.content,left:0,right:0,top:0,bottom:0},BI.extend({el:this.handler},this._getHandlePosition())]}},_isHorizontalResize:function(){return"w"===BI.get(this.options.direction,0)||"e"===BI.get(this.options.direction,0)},_createHandle:function(){return this._isHorizontalResize()?{type:"bi.icon_label",cls:"horizontal-drag-font resize-handle-ew",width:5}:{type:"bi.icon_label",cls:"vertical-drag-font resize-handle-ns",height:5}},_getHandlePosition:function(){switch(this.options.direction){case"e":return{right:-2,top:0,bottom:0};case"ew":return{right:8,top:0,bottom:0};case"w":return{left:-2,top:0,bottom:0};case"we":return{left:8,top:0,bottom:0};case"s":return{left:0,right:0,bottom:-3};case"sn":return{left:0,right:0,bottom:2};case"n":return{top:-3,left:0,right:0};case"ns":return{top:2,left:0,right:0}}},_getDefaultSize:function(){var e=this.options;return this._isHorizontalResize()?e.width||e.minSize:e.height||e.minSize},setMinSize:function(e){this.options.minSize=e},setMaxSize:function(e){this.options.maxSize=e},setResizable:function(e){this.options.resizable=e,this.handler.setVisible(e),BI.$(window).trigger("resize")},reset:function(){this.defaultSize=null}}),BI.shortcut("bi.resizable_container",BI.ResizableContainer)},function(e,t,n){"use strict";BI.ResizeContainerVtape=BI.inherit(BI.Widget,{props:{baseCls:"bi-resize-container-vtape",minSize:100,maxSize:200,initTopSize:null,top:{type:"bi.default"},bottom:{type:"bi.default"}},render:function(){var t=this,e=this.options;return{type:"bi.vtape",items:[{type:"bi.resizable_container",direction:"s",minSize:e.minSize,maxSize:e.maxSize,content:e.top,resize:BI.bind(this._resizeContainer,this),height:e.initTopSize||e.minSize},{el:e.bottom}],ref:function(e){t.contianer=e}}},_resizeContainer:function(e){this.contianer.attr("items")[0].height=e,this.contianer.resize(),this.fireEvent("EVENT_RESIZE",e)}}),BI.ResizeContainerVtape.EVENT_RESIZE="EVENT_RESIZE",BI.shortcut("bi.resize_container.vtape",BI.ResizeContainerVtape)},function(e,t,n){"use strict";BI.ScrollbarContainer=BI.inherit(BI.Widget,{props:{baseCls:"bi-scrollbar-container",el:{}},render:function(){var n=this;return[this.options.el,{type:"bi.absolute",items:[{el:{type:"bi.grid_table_scrollbar",ref:function(e){n.verticalScrollbar=e},listeners:[{eventName:BI.GridTableScrollbar.EVENT_SCROLL,action:function(e){try{n.element.scrollTop(e)}catch(t){}}}]},top:0,bottom:0,right:0},{el:{type:"bi.grid_table_scrollbar",orientation:"horizontal",ref:function(e){n.horizontalScrollbar=e},listeners:[{eventName:BI.GridTableScrollbar.EVENT_SCROLL,action:function(e){try{n.element.scrollLeft(e)}catch(t){}}}]},left:0,bottom:0,right:0}]}]},_handleResize:function(){var e=this.element.scrollTop(),t=this.element[0].scrollHeight,n=this.element.height(),t=(this.verticalScrollbar.setContentSize(t),this.verticalScrollbar.setSize(n),this.verticalScrollbar.setPosition(e),this.verticalScrollbar.populate(),this.element.scrollLeft()),n=this.element[0].scrollWidth,e=this.element.width();this.horizontalScrollbar.setContentSize(n),this.horizontalScrollbar.setSize(e),this.horizontalScrollbar.setPosition(t),this.horizontalScrollbar.populate()},mounted:function(){var t=this;this.element.scroll(function(){var e=t.element.scrollTop(),e=(t.verticalScrollbar.setVisible(!0),t.verticalScrollbar.setPosition(e),t.verticalScrollbar.populate(),t.element.scrollLeft());t.horizontalScrollbar.setVisible(!0),t.horizontalScrollbar.setPosition(e),t.horizontalScrollbar.populate()}),this.resizeObserver=BI.ResizeDetector.addResizeListener(this,this._handleResize.bind(this)),window.MutationObserver&&(this.mutationObserver=new window.MutationObserver(this._handleResize.bind(this)),this.mutationObserver.observe(this.element[0],{attributes:!0,childList:!0,subtree:!0})),this.verticalPopper=BI.Popper.createPopper(this.element[0],this.verticalScrollbar.element[0],{placement:"right-start",strategy:"fixed",modifiers:[{name:"offset",options:{offset:[0,0]}},{name:"flip",enabled:!1}]}),this.horizontalPopper=BI.Popper.createPopper(this.element[0],this.horizontalScrollbar.element[0],{placement:"bottom-start",strategy:"fixed",modifiers:[{name:"offset",options:{offset:[0,0]}},{name:"flip",enabled:!1}]}),this._handleResize()},destroyed:function(){this.resizeObserver(),this.mutationObserver&&this.mutationObserver.disconnect(),this.verticalPopper.destroy(),this.horizontalPopper.destroy()}}),BI.shortcut("bi.scrollbar_container",BI.ScrollbarContainer),BI.config("bi.scrollbar_container",function(e){return BI.isIE()?BI.extend({},e,{type:"bi.el"}):e})},function(e,t,n){"use strict";var r;(r=BI.inherit(BI.BasicButton,{props:{extraCls:"bi-select-color-item bi-border",value:[],colors:[],once:!0,height:50,width:130},mounted:function(){var n=this.options;BI.each(this.layouts,function(e,t){t.element.css("background-color",n.value[e])})},render:function(){var t=this,e=this.options;return this.layouts=[],{type:"bi.absolute",items:[{el:{type:"bi.button_group",items:BI.map(e.colors,function(){return{type:"bi.layout",ref:function(e){t.layouts.push(e)}}}),layouts:[{type:"bi.center",hgap:.5,vgap:2}]},left:1,right:2,top:0,bottom:0}]}}})).EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.select_color_item",r)},function(e,t,n){"use strict";var o;(o=BI.inherit(BI.Widget,{props:{baseCls:"bi-select-color-popup",height:160,items:[]},render:function(){var n=this,r=this.options,i=[];return BI.each(r.colors,function(e,t){i.push({type:"bi.select_color_item_wrapper",selected:BI.isEqual(r.value,t.colors),header:t.value,colors:t.colors.slice(0,5),value:t.colors})}),{type:"bi.absolute",items:[{el:{type:"bi.button_group",items:i,layouts:[{type:"bi.vertical",hgap:5}],listeners:[{eventName:BI.ButtonGroup.EVENT_CHANGE,action:function(e,t){n.popup.setValue(e),t.setSelected&&t.setSelected(!0),n.fireEvent(o.EVENT_CHANGE,e)}}],ref:function(e){n.popup=e}},top:5,right:0,bottom:5,left:0}]}},getValue:function(){return this.popup.getValue()}})).EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.select_color_popup",o)},function(e,t,n){"use strict";BI.SelectColorCombo=BI.inherit(BI.Widget,{props:{baseCls:"bi-select-color-combo",width:130,items:[],colors:[],value:[]},_store:function(){return BI.Models.getModel("bi.model.select.color.combo",{value:this.options.value})},watch:{selectedColor:function(e){e=BI.isArray(e)?e:[e],this.combo.setValue(e)}},render:function(){var n=this,t=this.options;return{type:"bi.combo",value:this.model.selectedColor,adjustLength:5,el:{type:"bi.select_color_trigger",title:function(){var e=BI.find(t.colors,function(e,t){if(BI.isEqual(t.colors,n.model.selectedColor))return!0});return e&&e.text},value:this.model.selectedColor},popup:{el:{type:"bi.select_color_popup",value:this.model.selectedColor,colors:t.colors,listeners:[{eventName:"EVENT_CHANGE",action:function(e){n.store.setSelectedColor(e),n.combo.hideView(),n.fireEvent(BI.SelectColorCombo.EVENT_CHANGE)}}],ref:function(e){n.popup=e}},stopPropagation:!1,minWidth:152},ref:function(e){n.combo=e},listeners:[{eventName:BI.Combo.EVENT_AFTER_INIT,action:function(){n.popup.setValue(n.model.selectedColor)}}]}}}),BI.SelectColorCombo.EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.select_color_combo",BI.SelectColorCombo)},function(e,t,n){"use strict";var r;r=BI.inherit(Fix.Model,{state:function(){return{selectedColor:this.options.value}},actions:{setSelectedColor:function(e){this.model.selectedColor=e}}}),BI.model("bi.model.select.color.combo",r)},function(e,t,n){"use strict";var r;(r=BI.inherit(BI.Trigger,{props:{extraCls:" bi-select-color-trigger bi-border",height:28,value:[]},mounted:function(){var n=this.options;BI.each(this.layouts,function(e,t){t.element.css("background-color",n.value[e])})},render:function(){var t=this,e=this.options;return this.layouts=[],{type:"bi.absolute",items:[{el:{type:"bi.button_group",items:BI.map(e.value.slice(0,5),function(){return{type:"bi.layout",ref:function(e){t.layouts.push(e)}}}),layouts:[{type:"bi.center",hgap:.5,vgap:2}],ref:function(e){t.colorContainer=e}},left:1,right:2,top:0,bottom:0},{el:{type:"bi.icon_button",disableSelected:!0,cls:"icon-combo-down-icon trigger-triangle-font",width:15,height:10,ref:function(e){t.down=e}},right:4,bottom:5}]}},populate:function(e){this.options.items=e},setValue:function(n){this.value=n,BI.each(this.layouts,function(e,t){t.element.css("background-color",n[e])})},getValue:function(){return this.value}})).EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.select_color_trigger",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.BasicButton,{props:{extraCls:"bi-select-color-item-wrapper",header:"",value:[],colors:[],height:50,width:130},render:function(){var t=this,e=this.options;return{type:"bi.vtape",hgap:2,items:[{type:"bi.label",textAlign:"left",text:e.header,lgap:3},{el:{type:"bi.select_color_item",value:e.value,colors:e.colors,ref:function(e){t.item=e},listeners:[{eventName:"EVENT_CHANGE",action:function(){t.fireEvent(BI.Controller.EVENT_CHANGE,this.getValue())}}]},height:28}]}},setSelected:function(e){this.item.setSelected(e)},isSelected:function(){return this.item.isSelected()}}),BI.shortcut("bi.select_color_item_wrapper",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-steps-item",text:"",stepWidth:88,stepHeight:50,showLine:!0},render:function(){var t=this,e=this.options;return this.constant=BI.Constants.getConstant("bi.constants.steps.status"),this.status=this.constant.NEXT,{type:"bi.htape",height:e.stepHeight,items:[{el:{type:"bi.vertical_adapt",items:[{type:"bi.layout",cls:"step-line",height:2,width:"100%",invisible:!e.showLine}]},rgap:8},{el:{type:"bi.right_vertical_adapt",items:[{type:"bi.icon_change_button",iconCls:"step-next",iconWidth:14,iconHeight:14,ref:function(e){t.icon=e},rgap:8},{type:"bi.label",cls:"step-text",textAlign:"left",whiteSpace:"nowrap",rgap:5,text:e.text}]},width:e.stepWidth}]}},setStatus:function(e){if(e!==this.status)switch(this.status=e){case this.constant.CURR:this.icon.setIcon("step-now"),this.element.addClass("active");break;case this.constant.PREV:this.icon.setIcon("step-prev"),this.element.addClass("active");break;default:this.constant.NEXT;this.icon.setIcon("step-next"),this.element.removeClass("active")}}}),BI.shortcut("bi.steps.item",r)},function(e,t,n){"use strict";BI.constant("bi.constants.steps.status",{PREV:0,CURR:1,NEXT:2})},function(e,t,n){"use strict";BI.Steps=BI.inherit(BI.Widget,{props:{baseCls:"bi-steps",stepItems:[],stepHeight:50,stepWidth:88},render:function(){var n=this,e=this.options,t=(this.steps=[],this.currStep=0,this.constant=BI.Constants.getConstant("bi.constants.steps.status"),this.steps.push(BI.createWidget(this._createStep(e.stepItems[0],!1))),BI.createWidget({type:"bi.grid",rows:1,width:"100%",columns:e.stepItems.length-1,items:BI.map(e.stepItems.slice(1),function(e,t){return{row:0,column:e,el:BI.extend(n._createStep(t,!0),{ref:function(e){n.steps.push(e)}})}})}));return{type:"bi.htape",items:[{el:this.steps[0],width:e.stepWidth},{el:t}],height:e.stepHeight}},_createStep:function(e,t){var n=this.options;return BI.extend(e,{type:"bi.steps.item",stepHeight:n.stepHeight,stepWidth:n.stepWidth,showLine:t})},mounted:function(){this.steps[0]&&this.steps[0].setStatus(this.constant.CURR)},setValue:function(t){var n=this;this.currStep=t,BI.each(this.options.stepItems,function(e){e<t?n.steps[e].setStatus(n.constant.PREV):e===t?n.steps[e].setStatus(n.constant.CURR):n.steps[e].setStatus(n.constant.NEXT)})},getValue:function(){return this.currStep}}),BI.shortcut("bi.steps",BI.Steps)},function(e,t,n){"use strict";BI.constant("bi.constant.char.widths",{32:.274,33:.284,34:.393,35:.592,36:.54,37:.819,38:.801,39:.23,40:.303,41:.303,42:.418,43:.684,44:.218,45:.4,46:.218,47:.391,48:.54,49:.54,50:.54,51:.54,52:.54,53:.54,54:.54,55:.54,56:.54,57:.54,58:.218,59:.218,60:.684,61:.684,62:.684,63:.449,64:.955,65:.646,66:.574,67:.62,68:.703,69:.507,70:.488,71:.687,72:.71,73:.267,74:.358,75:.58,76:.471,77:.899,78:.749,79:.754,80:.561,81:.754,82:.599,83:.532,84:.524,85:.688,86:.622,87:.934,88:.591,89:.553,90:.571,91:.303,92:.379,93:.303,94:.684,95:.416,96:.269,97:.509,98:.588,99:.463,100:.59,101:.524,102:.313,103:.59,104:.567,105:.243,106:.243,107:.498,108:.243,109:.862,110:.567,111:.587,112:.588,113:.59,114:.348,115:.425,116:.34,117:.567,118:.479,119:.723,120:.459,121:.484,122:.453,123:.303,124:.24,125:.303,126:.684})},function(e,t,n){"use strict";var r;(r=BI.inherit(BI.Widget,{props:function(){return{baseCls:"bi-dynamic-collection-view",overscanHeight:100,blockSize:10,scrollTop:0,scrollLeft:0,columnSize:[],isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,stopScrollEvent:!1,items:[],el:{},trRenderer:null}},created:function(){var e=this;this.renderedIndex=-1,this.cache={},this.trCache={},this._debounceRelease=BI.debounce(function(){e._scrollLock=!1},1e3/60)},render:function(){var e=this,t=this.options;return BI.extend(t.el,{type:"bi.vertical",scrolly:!1,scrollable:!0,items:[{type:"bi.default",tagName:t.trRenderer?"div":"table",css:{marginLeft:t.isNeedFreeze?-1*BI.sum(t.columnSize.slice(0,t.freezeCols.length)):0},ref:function(){e.table=this},items:(t.trRenderer?[]:[{type:"bi.default",tagName:"colgroup",ref:function(){e.colGroup=this}}]).concat([{type:"bi.layout",ref:function(){e.topBlank=this}},{type:"bi.default",tagName:t.trRenderer?"div":"tbody",ref:function(){e.container=this}},{type:"bi.layout",ref:function(){e.bottomBlank=this}}])}]})},mounted:function(){var t=this,n=this.options;0<n.items.length&&this._populate(),this.element.scroll(function(e){!0!==t._scrollLock&&(n.scrollLeft=t.element.scrollLeft(),n.scrollTop=t.element.scrollTop(),n.stopScrollEvent||t._calculateBlocksToRender(),t.fireEvent(r.EVENT_SCROLL,{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}))}),BI.ResizeDetector.addResizeListener(this,function(){try{t._calculateBlocksToRender()}catch(e){}})},_renderMoreIf:function(){for(var e,t=this,n=this.options,r=this.element.height(),i=n.scrollTop+r+n.overscanHeight,o=this.cache[this.renderedIndex]&&this.cache[this.renderedIndex].index+this.cache[this.renderedIndex].size||0,a=this.renderedIndex+1,s=function s(){return t.container.element.height()+t.topBlank.element.height()+t.bottomBlank.element.height()};(e=s())<i&&o<n.items.length;){for(var l=[],c=o;c<o+n.blockSize&&c<n.items.length;c++)l.push(c);for(var u=o+n.blockSize;0<l.length;){for(var h=l[0],d=0;d<n.columnSize.length;d++)for(var p=t.itemsMap[h][d].__mergeRows,f=h+(0|(p?p.length:1)),c=h;c<f;c++)l.indexOf(c)<0&&(l.push(c),u=f);l.shift()}var m=n.items.slice(o,u),m=(this._addItems(m,o),s()-e);this.cache[a]={index:o,height:m,size:u-o},this.tree.set(a,m),this.renderedIndex=a,a++,o+=u-o}},_addItem:function(e,r){var i=this,t=this.options;return t.trRenderer?BI.createWidget(t.trRenderer(e,r,this.itemsMap[r]),{root:!0}):BI.createWidget({type:"bi.adaptive",root:!0,tagName:"tr",height:t.rowSizeGetter?t.rowSizeGetter(r):null,items:BI.map(e,function(e,t){var n;if(BI.isNotEmptyObject(i.itemsMap[r][e]))return n=i.itemsMap[r][e].__mergeRows.length,e=i.itemsMap[r][e].__mergeCols.length,{type:"bi.default",tagName:"td",attributes:{rowspan:1<n?n:undefined,colspan:1<e?e:undefined},cls:"bi-collection-table-cell",items:[BI.extend({type:"bi.label"},t)]}})})},_serialize:function(e,r,o,a){o=o||[],a=a||[];for(var s=this.options,l={},c={},u={},h={},t=[],n=0;n<r.length;n++)t[n]=0===n?r[n]:t[n-1]+r[n];var d=function d(e,t){c[t].__mergeRows.push(e)},p=function p(e,t){u[e]._width+=r[t],u[e].__mergeCols.push(t)},f=function f(e,t){var n=r[t];h[e][t]._row=e,h[e][t]._col=t,h[e][t]._width=n,c[t]=h[e][t],c[t].__mergeRows=[e],u[e]=h[e][t],u[e].__mergeCols=[t]};return BI.each(e,function(e,t){for(var n,r,i=0;i<t.length;i++)l[e]||(l[e]={}),h[e]||(h[e]={}),l[e][i]=t[i],h[e][i]={},!0===o||-1<o.indexOf(i)||!0===a||-1<a.indexOf(e)?0===e&&0===i?f(0,0):0===i&&0<e?!0===(n=s.mergeRule(l[e][i],l[e-1][i]))?(d(e,i),u[e]=c[i]):f(e,i):0===e&&0<i?!0===(r=s.mergeRule(l[e][i],l[e][i-1]))?(p(e,i),c[i]=u[e]):f(e,i):(n=s.mergeRule(l[e][i],l[e-1][i]),(r=s.mergeRule(l[e][i],l[e][i-1]))&&n||(r&&p(e,i),n&&d(e,i),r||n||f(e,i))):f(e,i)}),h},_addItems:function(e,n){var r=this,i=BI.Widget._renderEngine.createFragment();BI.each(e,function(e,t){t=r._addItem(t,n+e);r.trCache[n+e]=t,i.appendChild(t.element[0])}),this.container.element.append(i)},_calculateBlocksToRender:function(){if(this.tree&&0!==this.options.items.length){for(var e=this.options,t=(this._renderMoreIf(),this.element.height()),n=e.scrollTop-e.overscanHeight,t=e.scrollTop+t+e.overscanHeight,r=this.tree.greatestLowerBound(n),i=this.tree.leastUpperBound(t),o=[],a=0;a<r;a++)if(this.cache[a]){var s=this.cache[a].index;if(!this.cache[a].destroyed){for(var l=s;l<s+this.cache[a].size&&l<e.items.length;l++)o.push(this.trCache[l]),delete this.trCache[l];this.cache[a].destroyed=!0}}for(a=i+1;a<=this.renderedIndex;a++)if(this.cache[a]){s=this.cache[a].index;if(!this.cache[a].destroyed){for(l=s;l<s+this.cache[a].size&&l<e.items.length;l++)o.push(this.trCache[l]),delete this.trCache[l];this.cache[a].destroyed=!0}}for(var n=BI.Widget._renderEngine.createFragment(),c=BI.Widget._renderEngine.createFragment(),u=n,a=r<0?0:r;a<=i&&a<=this.renderedIndex;a++){s=this.cache[a].index;if(this.cache[a].destroyed||(u=c),!0===this.cache[a].destroyed){for(l=s;l<s+this.cache[a].size&&l<e.items.length;l++){var h=this._addItem(e.items[l],l);this.trCache[l]=h,u.appendChild(h.element[0])}this.cache[a].destroyed=!1}}this.container.element.prepend(n),this.container.element.append(c),this.topBlank.setHeight(this.tree.sumTo(Math.max(-1,r-1))),this.bottomBlank.setHeight(this.tree.sumTo(this.renderedIndex)-this.tree.sumTo(Math.min(i,this.renderedIndex))),BI.each(o,function(e,t){t&&t._destroy()});for(a=r<0?0:r;a<=i&&a<=this.renderedIndex;a++){for(var d,p=0,l=s=this.cache[a].index;l<s+this.cache[a].size&&l<e.items.length;l++)e.rowSizeGetter?(d=e.rowSizeGetter(l),this.trCache[l].element.height(d),p+=d):p+=this.trCache[l].element.height();this.cache[a].height!==p&&(this.cache[a].height=p,this.tree.set(a,p))}}},_populate:function(e){var n=this,t=this.options;e&&this.options.items!==e&&(this.options.items=e,this.itemsMap=this._serialize(t.items,t.columnSize,t.mergeCols)),this.tree||(this.tree=BI.PrefixIntervalTree.empty(Math.ceil(t.items.length/t.blockSize))),this.table.setWidth(BI.sum(t.columnSize)),this.table.element.css({marginLeft:t.isNeedFreeze?-1*BI.sum(t.columnSize.slice(0,t.freezeCols.length)):0}),this.colGroup&&BI.each(t.columnSize,function(e,t){0===n.colGroup.element.children().eq(e).length?n.colGroup.addItem({type:"bi.layout",tagName:"col",width:t}):n.colGroup.element.children().eq(e).css("width",t)}),this._calculateBlocksToRender()},_clearChildren:function(){this.colGroup.empty(),this.container.empty()},setColumnSize:function(e){this.options.columnSize=e},setRegionColumnSize:function(e){this.options.regionColumnSize=e},getMaxScrollTop:function(){return this.container.element.height()+this.topBlank.element.height()+this.bottomBlank.element.height()-this.element.height()},getScrollTop:function(){return this.options.scrollTop},getScrollLeft:function(){return this.options.scrollLeft},setScrollLeft:function(e){this.options.scrollLeft!==e&&(this._scrollLock=!0,this.options.scrollLeft=e,this._debounceRelease(),this.element.scrollLeft(this.options.scrollLeft))},setScrollTop:function(e){this.options.scrollTop!==e&&(this._scrollLock=!0,this.options.scrollTop=e,this._debounceRelease(),this._calculateBlocksToRender(),this.element.scrollTop(this.options.scrollTop),this.fireEvent("EVENT_SYNC",e))},restore:function(){this.renderedIndex=-1,this._clearChildren(),this.cache={},this.tree=null,this.trCache={},this.options.scrollTop=0,this.topBlank.setHeight(0),this.bottomBlank.setHeight(0)},populate:function(e){this.options;e&&this.options.items!==e&&this.restore(),this._populate(e)},destroyed:function(){this.restore()}})).EVENT_SCROLL="EVENT_SCROLL",BI.shortcut("bi.dynamic_collection_view",r)},function(e,t,n){"use strict";BI.NativeTableScrollbar=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.NativeTableScrollbar.superclass._defaultConfig.apply(this,arguments),{attributes:{tabIndex:0},contentSize:0,defaultPosition:0,position:0,size:0})},render:function(){var t=this,e=(this.options,this.element.width(36),BI.throttle(function(){t.fireEvent(BI.NativeTableScrollbar.EVENT_SCROLL,t.element.scrollTop())},150,{leading:!1}));return this.element.scroll(function(){e()}),{type:"bi.default",scrolly:!0,items:[{type:"bi.layout",width:1,ref:function(e){t.inner=e}}]}},mounted:function(){this._populate()},_populate:function(){var e=this.options;if(e.size<1||e.contentSize<=e.size)this.setVisible(!1);else{this.setVisible(!0);try{this.element.scrollTop(e.position)}catch(t){}this.inner.element.height(e.contentSize)}},setContentSize:function(e){this.options.contentSize=e},setPosition:function(e){this.options.position=e},setSize:function(e){this.setHeight(e),this.options.size=e},populate:function(){this._populate()}}),BI.NativeTableScrollbar.EVENT_SCROLL="EVENT_SCROLL",BI.shortcut("bi.native_table_scrollbar",BI.NativeTableScrollbar),BI.NativeTableHorizontalScrollbar=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.NativeTableHorizontalScrollbar.superclass._defaultConfig.apply(this,arguments),{attributes:{tabIndex:0},contentSize:0,position:0,size:0})},render:function(){var t=this,e=(this.options,this.element.height(36),BI.throttle(function(){t.fireEvent(BI.NativeTableScrollbar.EVENT_SCROLL,t.element.scrollLeft())},150,{leading:!1}));return this.element.scroll(function(){e()}),{type:"bi.default",scrollx:!0,items:[{type:"bi.layout",height:1,ref:function(e){t.inner=e}}]}},setContentSize:function(e){this.options.contentSize=e},setPosition:function(e){this.options.position=e},setSize:function(e){this.setWidth(e),this.options.size=e},_populate:function(){var e=this.options;if(e.size<1||e.contentSize<=e.size)this.setVisible(!1);else{this.setVisible(!0);try{this.element.scrollLeft(e.position)}catch(t){}this.inner.element.width(e.contentSize)}},populate:function(){this._populate()}}),BI.NativeTableHorizontalScrollbar.EVENT_SCROLL="EVENT_SCROLL",BI.shortcut("bi.native_table_horizontal_scrollbar",BI.NativeTableHorizontalScrollbar)},function(e,t,n){"use strict";var r,s;r=20,s=300,BI.SortableTable=BI.inherit(BI.Widget,{props:{baseCls:"bi-sortable-table",el:{type:"bi.grid_table"},sortable:!0},render:function(){var t=this,n=this.options;return this.header={},this.cell={},this.quickSelectHelper=new BI.SortableTable.QuickSelectHelper,this.styleHelper=new BI.SortableTable.StyleHelper(this.header,this.cell,BI.bind(this._getCell,this),this.quickSelectHelper),[BI.extend({type:"bi.grid_table",width:n.width,height:n.height,headerRowSize:n.headerRowSize,rowSize:n.rowSize,columnSize:n.columnSize,header:this._formatHeader(n.header),items:this._formatCell(n.items),listeners:[{eventName:BI.Table.EVENT_TABLE_SCROLL,action:function(){t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}},{eventName:BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,action:function(){t.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}},{eventName:BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,action:function(){t.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)}}]},n.el,{ref:function(e){t.table=e,n.el.ref&&n.el.ref.call(this,e)},mounted:function(){t.autoScrollHelper=new BI.SortableTable.AutoScrollHelper(t.table,BI.bind(t._onAutoScroll,t))}})]},_getColumnsLeftPosition:function(){var t=[],n=this.table.getColumnSize();return BI.each(n,function(e){t.push(0===e?0:t[e-1]+n[e-1])}),t},_exchangeItemsAndHeaderPosition:function(n,r){var e,t,i,o,a=this.options;return(1!==n.length||n[0]!==r)&&(e=BI.unzip(a.header),t=BI.unzip(a.items),i=this.getColumnSize(),o=BI.map(n,function(e,t){return t<r?t:t+n.length}),a.header=BI.unzip(this._dealExchangeConfig(e,n,r,o)),a.items=BI.unzip(this._dealExchangeConfig(t,n,r,o)),a.columnSize=this._dealExchangeConfig(i,n,r,o),!0)},_dealExchangeConfig:function(e,t,n,r){var i=BI.filter(e,function(e){return BI.contains(t,e)});return i.unshift(n,0),[].splice.apply(e,i),BI.removeAt(e,r),e},_getCell:function(e){if(this.options.customCell)return e.element;for(var t=e.element.parent();t&&!t.hasClass("bi-grid-table-cell");)t=t.parent();return t},_formatHeader:function(){var o=this,e=this.options;return BI.map(e.header,function(i,e){return BI.map(e,function(r,e){return BI.extend({},e,{ref:function(t){o.header[r]=o.header[r]||{},o.header[r][i]=t,e.ref&&e.ref.call(this,t);var n=!1;t.element.on("mousedown",function(e){o.disableSelectText(!0),BI.contains(o.quickSelectHelper.getSelectedColumns(),r)?n=!0:(o._clickSelectColumn(r,e),o.fireEvent("EVENT_TABLE_SELECT_COLUMN",r)),o._prepareDrag(e,t,r)}),t.element.on("click",function(e){n&&(n=!1,o._clickSelectColumn(r,e),o.fireEvent("EVENT_TABLE_SELECT_COLUMN",r))})},mounted:function(){o.startDrag||(BI.contains(o.quickSelectHelper.getSelectedColumns(),r)&&(o.styleHelper.selectCell(!0,o.header[r][i],{column:r,row:i,header:!0}),o._initDrag(r,o.header[r][i],!0)),BI.contains(o.quickSelectHelper.getSelectedColumns(),r+1)&&o._getCell(o.header[r][i]).addClass("column-select-helper")),o.columnIndex===r&&o.styleHelper.setInVisibility(o.header[r][i])},destroyed:function(){o.header[r]&&delete o.header[r][i],0===BI.size(o.header[r])&&delete o.header[r]}})})})},_clickSelectColumn:function(e,t){var i=this;this.quickSelectHelper.selectColumns(e,t),BI.each(this.header,function(r,e){BI.each(e,function(e,t){var n=BI.contains(i.quickSelectHelper.getSelectedColumns(),BI.parseInt(r))?i.styleHelper.selectColumn(!0,r):i.styleHelper.selectColumn(!1,r);i._initDrag(r,t,n)})})},_formatCell:function(){var i=this,o=this.options;return BI.map(o.items,function(r,e){return BI.map(e,function(t,n){return BI.extend({},n,{ref:function(e){i.cell[t]=i.cell[t]||{},i.cell[t][r]=e,n.ref&&n.ref.call(this,e)},mounted:function(){i.startDrag||(BI.contains(i.quickSelectHelper.getSelectedColumns(),t)&&i.styleHelper.selectCell(!0,i.cell[t][r],{column:t,row:r,lastRowCell:r===o.items.length-1}),BI.contains(i.quickSelectHelper.getSelectedColumns(),t+1)&&i._getCell(i.cell[t][r]).addClass("column-select-helper")),i.columnIndex===t&&i.styleHelper.setInVisibility(i.cell[t][r])},destroyed:function(){i.cell[t]&&delete i.cell[t][r],0===BI.size(i.cell[t])&&delete i.cell[t]}},{lastRowCell:r===o.items.length-1})})})},_drop:function(e){var t,n,r,i=this.options,o=this.columnIndex>this.newColumnIndex?this.newColumnIndex:this.newColumnIndex+1;!0===this._exchangeItemsAndHeaderPosition(e,o)&&(this.setColumnSize(i.columnSize),t=this.getSelectedColumns(),this.populate(i.items,i.header),n=BI.findIndex(t,function(e,t){return o<=t}),r=o-(t[0]<o?n<0?t.length:n:0),this.selectColumns(BI.map(t,function(e){return BI.clamp(r+e,0,i.columnSize.length)})),this.fireEvent("EVENT_TABLE_SORT",e,o))},_shouldStartDrag:function(e,t){return Math.abs(e-t)>r},disableSelectText:function(n){BI.each(this.header,function(e,t){BI.each(t,function(e,t){t.element[n?"addClass":"removeClass"]("bi-user-select-disable")})})},_prepareDrag:function(e,t,n){this.tracker.captureMouseMoves(BI.extend({},e,{preventDefault:BI.emptyFn})),this.start=!1,this.startDrag=!1,this.startX=this.oStartX=e.pageX,this.startY=e.pageY,this.boundingClientRect=t.element[0].getBoundingClientRect(),this.columnIndex=this.newColumnIndex=n,this.positions=this._getColumnsLeftPosition(),this.offsetX=this.positions[n],this.height=t.element[0].offsetHeight,this.width=t.element[0].offsetWidth,this.widths=this.table.getColumnSize(),this.tableWidth=this.table.getWidth(),this.tableHeight=this.table.getHeight();e=this.element[0].getBoundingClientRect();this.minTranslateX=e.left-this.boundingClientRect.left-this.width/2,this.maxTranslateX=e.left+e.width-this.boundingClientRect.left-this.width/2,this.initialScrollX=this.table.getActualRightHorizontalScroll()},_initDrag:function(e,t,n){var r;this.options.sortable&&(r=this,BI.isNull(this.tracker)&&(this.tracker=new BI.MouseMoveTracker(function(e,t){r.startX+=e,r.startY+=t,r.tracker.isDragging()&&(r.startDrag||r._shouldStartDrag(r.startX,r.oStartX))&&(r.startDrag=!0,r._updateHelperPosition(),r._animateColumns(),r._autoScroll())},function(){r.dragHelper&&r.dragHelper.setVisible(!1),r.tracker.releaseMouseMoves(),r.startDrag&&r._drop(BI.sortBy(r.quickSelectHelper.getSelectedColumns())),r._stopDrag()},window)),n?t.element.off("mouseup").on("mouseup",function(e){Math.abs(r.startX-e.pageX)<5&&Math.abs(r.startY-e.pageY)<5&&r._stopDrag()}):t.element.off("mouseup"))},_updateHelperPosition:function(){BI.isNull(this.dragHelper)?(this.dragHelper=BI.createWidget({type:"bi.layout",cls:"sortable_table_drag_helper cursor-drag-hand",zIndex:BI.zIndex_layer}),BI.createWidget({type:"bi.absolute",element:"body",items:[{el:this.dragHelper,left:this.boundingClientRect.left,top:this.boundingClientRect.top}]}),this.translateX=this.startX-this.oStartX,this.styleHelper.setColumnInVisibility(this.columnIndex),this.styleHelper.setColumnDisabled(this._getOtherSelectedColumns(this.columnIndex))):(this.translateX=this.startX-this.oStartX,this.styleHelper.setTranslateX(this.dragHelper.element,this.translateX),this.dragHelper.setWidth(this.widths[this.columnIndex]),this.dragHelper.setHeight(this.tableHeight),this.dragHelper.setVisible(!0))},_animateColumns:function(){var o=this,a=this.offsetX+this.translateX+this.table.getActualRightHorizontalScroll()-this.initialScrollX;this.newColumnIndex=null,BI.some(this.header,function(r,e){if(r===o.columnIndex)return!1;var i={x:0,y:0};BI.some(e,function(e,t){var n=t.element[0].offsetWidth,t=t.element[0].offsetHeight,t=(o.height>t||o.height,o.width>n?n/2:o.width/2);o.styleHelper.setTransitionDuration(r,s),r>o.columnIndex&&a+t>=o.positions[r]?(i.x=-o.width,o.newColumnIndex=parseInt(r)):r<o.columnIndex&&a<=o.positions[r]+t&&(i.x=o.width,null===o.newColumnIndex&&(o.newColumnIndex=parseInt(r))),o.styleHelper.setColumnTranslateX(r,i.x)})}),null===this.newColumnIndex&&(this.newColumnIndex=this.columnIndex)},_autoScroll:function(){this.autoScrollHelper.update({translateX:this.translateX,minTranslateX:this.minTranslateX,maxTranslateX:this.maxTranslateX,width:this.width})},_onAutoScroll:function(e){this.translateX+=e,this._animateColumns()},_getOtherSelectedColumns:function(e){var t=BI.clone(this.quickSelectHelper.getSelectedColumns()),e=t.indexOf(e);return t.splice(e,1),t},_stopDrag:function(){var t=this;this.startDrag=!1,this.styleHelper.setColumnInVisibility(this.columnIndex,!1),this.styleHelper.setColumnDisabled(this._getOtherSelectedColumns(this.columnIndex),!1),this.autoScrollHelper.clear(),this.columnIndex=-1,this.tracker&&this.tracker.releaseMouseMoves(),BI.each(this.header,function(e){t.styleHelper.setColumnTranslateX(e),t.styleHelper.setTransitionDuration(e,null)}),this.dragHelper&&this.dragHelper.destroy(),this.dragHelper=null,this.disableSelectText(!1)},selectColumns:function(e){var n=this;e=BI.isArray(e)?e:[e],this.quickSelectHelper.clearColumns(),BI.each(this.header,function(e){n.styleHelper.selectColumn(!1,e)}),BI.each(e,function(e,t){n._clickSelectColumn(t,{ctrlKey:!0})})},getSelectedColumns:function(){return this.quickSelectHelper.getSelectedColumns()},setWidth:function(e){BI.SortableTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.SortableTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},setColumnSize:function(e){this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){return this.table.getFirstColumnRowSize()},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},setSortable:function(e){this.options.sortable=e},attr:function(){return BI.SortableTable.superclass.attr.apply(this,arguments),this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e,t){var n=this.options;this.header={},this.cell={},this.styleHelper.update(this.header,this.cell),this.quickSelectHelper.clearColumns(),this._stopDrag(),n.header=t||n.header,n.items=e||n.items,this.table.populate(this._formatCell(n.items),this._formatHeader(n.header))}}),BI.shortcut("bi.sortable_table",BI.SortableTable)},function(e,t,n){"use strict";function r(){this.selectedColumns=[],this.lastSelectedColumn=null}var a,s,l;a=0,s=1,l=2,r.prototype.selectColumns=function(n,e){var r=this;switch(this.getMouseHotKey(e)){case a:this.selectedColumns=[n],this.lastSelectedColumn=n;break;case s:BI.some(this.selectedColumns,function(e,t){if(t===n)return r.selectedColumns.splice(e,1),!0})||this.selectedColumns.push(n);break;case l:var t=r.lastSelectedColumn,i=n,o=BI.min([t,i]),t=BI.max([t,i])+1;this.selectedColumns=BI.uniq(BI.concat(this.selectedColumns,BI.range(o,t)))}},r.prototype.getMouseHotKey=function(e){return e.ctrlKey||e.metaKey?s:e.shiftKey?l:a},r.prototype.getSelectedColumns=function(){return this.selectedColumns},r.prototype.MOUSE_EVENT_KEY={CLICK:0,CONTROL_CLICK:1,SHIFT_CLICK:2},r.prototype.clearColumns=function(){this.selectedColumns=[],this.lastSelectedColumn=null},BI.SortableTable.QuickSelectHelper=r},function(e,t,n){"use strict";function r(e,t){this.container=e,this.onScrollCallback=t}r.prototype.update=function(e){var t=this,n=0,r=!1,i=e.translateX,o=e.minTranslateX,a=e.maxTranslateX,e=e.width;i<=o+e/2?(n=-10*Math.abs((i-e/2-o)/e),r=!0):a-e/2<=i&&(n=10*Math.abs((a-e/2-i)/e),r=!0),this.clear(),r&&(this.interval=setInterval(function(){var e=t.container.getActualRightHorizontalScroll();t.container.setRightHorizontalScroll(e+n),t.onScrollCallback(n),t.container.getActualRightHorizontalScroll()===e&&t.clear()},5))},r.prototype.clear=function(){null!==this.interval&&(clearInterval(this.interval),this.interval=null)},BI.SortableTable.AutoScrollHelper=r},function(e,t,n){"use strict";function r(e,t,n,r){this.cellWrapperGetter=n,this.headers=e,this.cells=t,this.quickSelectHelper=r}r.prototype.setTranslateX=function(e,t){e[0].style.transform=BI.isNull(t)?"":"translateX(".concat(t,"px)")},r.prototype.setInVisibility=function(e){var t=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],e=this.cellWrapperGetter(e);e[0].style.opacity=t?0:"",e[0].style.visibility=t?"hidden":""},r.prototype.setDraggingStyle=function(e){var t=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],n=2<arguments.length?arguments[2]:undefined;this.cellWrapperGetter(e)[t?"addClass":"removeClass"](n||"dragging-state")},r.prototype.setColumnDisabled=function(e){var r=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],i=this;BI.each(e,function(e,n){BI.each(i.cells[n],function(e,t){i.setDraggingStyle(t,r),0<n&&i.cells[n-1]&&i.setDraggingStyle(i.cells[n-1][e],r,"dragging-pre-column-state")}),BI.each(i.headers[n],function(e,t){i.setDraggingStyle(t,r,"dragging-state dragging-header"),0<n&&i.headers[n-1]&&i.setDraggingStyle(i.headers[n-1][e],r,"dragging-pre-column-state")}),i.selectColumn(!r&&BI.contains(i.quickSelectHelper.getSelectedColumns(),n),n)})},r.prototype.setColumnInVisibility=function(e){var n=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],r=this;BI.each(this.cells[e],function(e,t){r.setInVisibility(t,n)}),BI.each(this.headers[e],function(e,t){r.setInVisibility(t,n)}),this.selectColumn(!n&&BI.contains(this.quickSelectHelper.getSelectedColumns(),e),e)},r.prototype.setTransitionDuration=function(e,n){var r=this;BI.each(this.cells[e],function(e,t){r.cellWrapperGetter(t)[0].style.transitionDuration=BI.isNull(n)?"":"".concat(n,"ms")}),BI.each(this.headers[e],function(e,t){r.cellWrapperGetter(t)[0].style.transitionDuration=BI.isNull(n)?"":"".concat(n,"ms")})},r.prototype.setColumnTranslateX=function(e,n){var r=this;BI.each(this.cells[e],function(e,t){r.setTranslateX(r.cellWrapperGetter(t),n)}),BI.each(this.headers[e],function(e,t){r.setTranslateX(r.cellWrapperGetter(t),n)})},r.prototype.selectColumn=function(n,r){var i=this;return BI.each(this.headers[r],function(e,t){i.selectCell(n,t,{column:r,row:e,header:!0,cursor:"cursor-hand"})}),BI.each(this.cells[r],function(e,t){i.selectCell(n,t,{column:r,row:e,header:!1,lastRowCell:t.attr("lastRowCell")})}),n},r.prototype.selectCell=function(e,t,n){var r=n.column,i=n.row,o=n.header||!1,a=n.cursor||"",n=n.lastRowCell||!1;this.cellWrapperGetter(t)[e?"addClass":"removeClass"](a+" column-select"+(n?" last-row-cell":"")+(o?BI.isEmpty(this.cells)?" empty-cell header":" header":"")),0<r&&((t=o?this.headers:this.cells)[r-1]&&this.cellWrapperGetter(t[r-1][i])[e?"addClass":"removeClass"]("column-select-helper"))},r.prototype.update=function(e,t){this.headers=e,this.cells=t},BI.SortableTable.StyleHelper=r},function(e,t,n){"use strict";BI.TableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.TableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-table-cell",textAlign:"left",text:""})},_init:function(){BI.TableCell.superclass._init.apply(this,arguments);var e=this.options;BI.createWidget({type:"bi.label",element:this,whiteSpace:e.whiteSpace||"nowrap",textAlign:this.options.textAlign,height:this.options.height,text:this.options.text,value:this.options.value,lgap:e.lgap,rgap:e.rgap,hgap:e.hgap||5})}}),BI.shortcut("bi.table_cell",BI.TableCell)},function(e,t,n){"use strict";BI.CollectionTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.CollectionTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-collection-table-cell bi-border-right bi-border-bottom",width:0,height:0,_left:0,_top:0,firstRowTopLine:!0,firstColumnLeftLine:!0,cell:{}})},_init:function(){BI.CollectionTableCell.superclass._init.apply(this,arguments);var e=this.options;this.cell=BI.createWidget(BI.extend({type:"bi.label"},e.cell,{cls:(e.cell.cls||"")+" collection-table-cell-wrapper",width:e.width-(e.firstColumnLeftLine&&0===e._left?1:0)-1,height:e.height-(e.firstRowTopLine&&0===e._top?1:0)-1})),BI.createWidget({type:"bi.absolute",cls:(e.firstRowTopLine?"bi-collection-table-cell-top-line":"")+(e.firstColumnLeftLine?" bi-collection-table-cell-left-line":""),element:this,items:[{el:this.cell,left:0,right:0,top:0,bottom:0}]})},setWidth:function(e){BI.CollectionTableCell.superclass.setWidth.apply(this,arguments);var t=this.options;this.cell.setWidth(t.width-(t.firstColumnLeftLine&&0===t._left?1:0)-1)},setHeight:function(e){BI.CollectionTableCell.superclass.setHeight.apply(this,arguments);var t=this.options;this.cell.setHeight(t.height-(t.firstRowTopLine&&0===t._top?1:0)-1)}}),BI.shortcut("bi.collection_table_cell",BI.CollectionTableCell)},function(e,t,n){"use strict";BI.CollectionTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.CollectionTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-collection-table",headerRowSize:25,rowSize:25,columnSize:[],isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,header:[],items:[],regionColumnSize:[],customCell:!1})},render:function(){var t=this,e=this.options;this._width=0,this._height=0,this.topLeftCollection=BI.createWidget({type:"bi.collection_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),cellSizeAndPositionGetter:function(e){return t.topLeftItems[e]}}),this.topLeftCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomLeftCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topRightCollection=BI.createWidget({type:"bi.collection_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),cellSizeAndPositionGetter:function(e){return t.topRightItems[e]}}),this.topRightCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomRightCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomLeftCollection=BI.createWidget({type:"bi.collection_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),cellSizeAndPositionGetter:function(e){return t.bottomLeftItems[e]}}),this.bottomLeftCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomRightCollection.setScrollTop(e.scrollTop),t.topLeftCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomRightCollection=BI.createWidget({type:"bi.collection_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),cellSizeAndPositionGetter:function(e){return t.bottomRightItems[e]}}),this.bottomRightCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomLeftCollection.setScrollTop(e.scrollTop),t.topRightCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topLeftCollection]}),this.topRight=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topRightCollection]}),this.bottomLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.bottomLeftCollection]}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.bottomRightCollection]}),this.shadow=BI.createWidget({type:"bi.layout",cls:"collection-table-shadow"}),this.contextLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.topLeft,top:0,left:0},{el:this.topRight,top:0},{el:this.bottomLeft,left:0},{el:this.bottomRight},{el:this.shadow,top:0,bottom:0}]}),this.topScrollbar=BI.createWidget({type:"bi.grid_table_scrollbar",width:BI.GridTableScrollbar.SIZE}),this.topScrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(e){t.bottomLeftCollection.setScrollTop(e),t.bottomRightCollection.setScrollTop(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.leftScrollbar=BI.createWidget({type:"bi.grid_table_horizontal_scrollbar",height:BI.GridTableScrollbar.SIZE}),this.leftScrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(e){t.topLeftCollection.setScrollLeft(e),t.bottomLeftCollection.setScrollLeft(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.rightScrollbar=BI.createWidget({type:"bi.grid_table_horizontal_scrollbar",height:BI.GridTableScrollbar.SIZE}),this.rightScrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(e){t.topRightCollection.setScrollLeft(e),t.bottomRightCollection.setScrollLeft(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.scrollBarLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.topScrollbar,right:0,top:0},{el:this.leftScrollbar,left:0},{el:this.rightScrollbar}]}),BI.isChrome()&&BI.isWindows()&&!BI.isEdge()||BI.createWidget({type:"bi.absolute",element:this,items:[{el:{type:"bi.default",cls:"bi-table-fix-scroll"},top:0,right:0,bottom:0,left:0}]}),this._width=e.width-BI.GridTableScrollbar.SIZE,this._height=e.height-BI.GridTableScrollbar.SIZE,(0<e.header.length||0<e.items.length)&&(this._digest(),this._populate())},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedFreeze?BI.clamp(e.freezeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?0:e.header.length*e.headerRowSize},_getActualItems:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?e.header.concat(e.items):e.items},_getContentHeight:function(){var e=this.options;return this._getFreezeHeaderHeight()<=0?e.header.length*e.headerRowSize+e.items.length*e.rowSize:this._getActualItems().length*this.options.rowSize},_populateScrollbar:function(){var n=this.options,e=this.getRegionSize(),r=0,i=0,t=(BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?r+=t:i+=t,e,0}),this.topScrollbar.setContentSize(this._getContentHeight()),this._getFreezeHeaderHeight()),o=this._height-t,o=(this.topScrollbar.setSize(o),this.bottomRightCollection.getScrollTop()),o=(this.topScrollbar.setPosition(o),this.topScrollbar.populate(),this.leftScrollbar.setContentSize(r),this.leftScrollbar.setSize(e),this.bottomLeftCollection.getScrollLeft()),a=(this.leftScrollbar.setPosition(o),this.leftScrollbar.populate(),this.rightScrollbar.setContentSize(i),this.rightScrollbar.setSize(this._width-e),this.bottomRightCollection.getScrollLeft()),s=(this.rightScrollbar.setPosition(a),this.rightScrollbar.populate(),this.scrollBarLayout.attr("items")),s=(s[0].top=this._getFreezeHeaderHeight(),s[1].top=this._height,s[2].top=this._height,s[2].left=e,this.scrollBarLayout.attr("items",s),this.scrollBarLayout.resize(),!1);0<r&&0<i&&(s=e<r&&o<r-e||0<a)&&(o=this.getFirstColumnRowSize(),e=BI.sum(o),this.shadow.setHeight(Math.min(this._height,t+e))),this.shadow.setVisible(s)},_populateTable:function(){var t,a=this.options,e=this.getRegionSize(),n=(BI.each(a.columnSize,function(e,t){!0===a.isNeedFreeze&&a.freezeCols.includes(e)?0:0,e,0}),e),r=this._getFreezeHeaderHeight(),i=this._width-e,o=this._getFreezeHeaderHeight(),s=e,l=this._height-r,c=this._width-e,u=this._height-o,h=BI.isFireFox()?0:BI.DOM.getScrollWidth(),d=n+h,p=r+h,f=i+h,m=o+h,g=s+h,b=l+h,y=c+h,h=u+h,v=function v(e){e.element.css({overflow:"scroll",overflowX:"scroll",overflowY:"scroll"})},n=(this.topLeft.setWidth(n),this.topLeft.setHeight(r),this.topRight.setWidth(i),this.topRight.setHeight(o),this.bottomLeft.setWidth(s),this.bottomLeft.setHeight(l),this.bottomRight.setWidth(c),this.bottomRight.setHeight(u),this.topLeftCollection.setWidth(d),this.topLeftCollection.setHeight(p),this.topRightCollection.setWidth(f),this.topRightCollection.setHeight(m),this.bottomLeftCollection.setWidth(g),this.bottomLeftCollection.setHeight(b),this.bottomRightCollection.setWidth(y),this.bottomRightCollection.setHeight(h),v(this.topLeftCollection),v(this.topRightCollection),v(this.bottomLeftCollection),v(this.bottomRightCollection),this.contextLayout.attr("items")),r=(n[1].left=e,n[2].top=this._getFreezeHeaderHeight(),n[3].left=e,n[3].top=this._getFreezeHeaderHeight(),n[4].left=e,this.contextLayout.attr("items",n),this.contextLayout.resize(),[]),i=[],o=[],s=[];(t=function t(e,n,r,i,o){BI.each(e,function(e,t){a.customCell?(n[t.row][t.col]._rowIndex=t.row,n[t.row][t.col]._columnIndex=t.col,n[t.row][t.col].firstRowTopLine=i,n[t.row][t.col].firstColumnLeftLine=o,r.push(n[t.row][t.col])):(t={type:"bi.collection_table_cell",cell:n[t.row][t.col],_rowIndex:t.row,_columnIndex:t.col,firstRowTopLine:i,firstColumnLeftLine:o},r.push(t))})})(this.topLeftItems,a.header,r,!0,!0),t(this.topRightItems,a.header,i,!0,this.topLeftItems.length<=0),t(this.bottomLeftItems,this._getActualItems(),o,this.topRightItems.length<=0,!0),t(this.bottomRightItems,this._getActualItems(),s,this.topRightItems.length<=0,this.topLeftItems.length<=0),this.topLeftCollection._populate(r),this.topRightCollection._populate(i),this.bottomLeftCollection._populate(o),this.bottomRightCollection._populate(s)},_syncScroll:function(){this.setLeftHorizontalScroll(this.getLeftHorizontalScroll()),this.setRightHorizontalScroll(this.getRightHorizontalScroll()),this.setVerticalScroll(this.getVerticalScroll())},_digest:function(){var t=this.options,e=this._getFreezeColLength();this._getFreezeHeaderHeight()<=0?(this.topLeftItems=[],this.topRightItems=[],this.bottomLeftItems=BI.CollectionTable.serialize(this._getActualItems(),0,e,function(e){return e<=t.header.length-1?t.headerRowSize:t.rowSize},t.columnSize,t.mergeCols,BI.range(t.header.length),t.mergeRule,function(e){return e<=t.header.length?e*t.headerRowSize:t.header.length*t.headerRowSize+(e-t.header.length)*t.rowSize}),this.bottomRightItems=BI.CollectionTable.serialize(this._getActualItems(),e,t.columnSize.length,function(e){return e<=t.header.length-1?t.headerRowSize:t.rowSize},t.columnSize,t.mergeCols,BI.range(t.header.length),t.mergeRule,function(e){return e<=t.header.length?e*t.headerRowSize:t.header.length*t.headerRowSize+(e-t.header.length)*t.rowSize})):(this.topLeftItems=BI.CollectionTable.serialize(t.header,0,e,t.headerRowSize,t.columnSize,t.mergeCols,[],t.mergeRule),this.topRightItems=BI.CollectionTable.serialize(t.header,e,t.columnSize.length,t.headerRowSize,t.columnSize,!0,[],t.mergeRule),this.bottomLeftItems=BI.CollectionTable.serialize(t.items,0,e,t.rowSize,t.columnSize,t.mergeCols,[],t.mergeRule),this.bottomRightItems=BI.CollectionTable.serialize(t.items,e,t.columnSize.length,t.rowSize,t.columnSize,t.mergeCols,[],t.mergeRule))},_populate:function(){this._width<=0||this._height<=0||(!0===this._isNeedDigest&&this._digest(),this._isNeedDigest=!1,this._populateTable(),this._populateScrollbar(),this._syncScroll())},attr:function(e,t){var n=BI.CollectionTable.superclass.attr.apply(this,arguments);if(BI.isNotNull(t))switch(e){case"scrollLeft":this.topRightCollection.attr(e,t),this.bottomRightCollection.attr(e,t);break;case"scrollTop":this.bottomLeftCollection.attr(e,t),this.bottomRightCollection.attr(e,t)}return n},getRegionSize:function(){var n=this.options,r=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(r||BI.each(n.freezeCols,function(e,t){r+=n.columnSize[t]}),r)},setVerticalScroll:function(e){this.bottomLeftCollection.setScrollTop(e),this.bottomRightCollection.setScrollTop(e)},setLeftHorizontalScroll:function(e){this.topLeftCollection.setScrollLeft(e),this.bottomLeftCollection.setScrollLeft(e)},setRightHorizontalScroll:function(e){this.topRightCollection.setScrollLeft(e),this.bottomRightCollection.setScrollLeft(e)},getVerticalScroll:function(){return this.bottomRightCollection.getScrollTop()},getLeftHorizontalScroll:function(){return this.bottomLeftCollection.getScrollLeft()},getRightHorizontalScroll:function(){return this.bottomRightCollection.getScrollLeft()},setWidth:function(e){BI.CollectionTable.superclass.setWidth.apply(this,arguments),this._width=this.options.width-BI.GridTableScrollbar.SIZE},setHeight:function(e){BI.CollectionTable.superclass.setHeight.apply(this,arguments),this._height=this.options.height-BI.GridTableScrollbar.SIZE},setColumnSize:function(e){this._isNeedDigest=!0,this.options.columnSize=e},setRegionColumnSize:function(e){this._isNeedDigest=!0,this.options.regionColumnSize=e},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},getFirstColumnHeaderRowSize:function(){var e=this._getFreezeColLength(),t=this.topLeftItems,n=(e<=0&&(t=this.topRightItems),this._getFreezeHeaderHeight()<=0&&(t=this.bottomLeftItems,t=((t=e<=0?this.bottomRightItems:t)||[]).slice(0,this.options.header.length)),[]);return BI.each(t,function(e,t){0===t.col&&n.push(t.height)}),n},getFirstColumnRowSize:function(){var e=this._getFreezeColLength(),t=this.bottomLeftItems,n=(e<=0&&(t=this.bottomRightItems),this._getFreezeHeaderHeight()<=0&&(t=(t||[]).slice(this.options.header.length)),[]);return BI.each(t,function(e,t){0===t.col&&n.push(t.height)}),n},getLastColumnRowSize:function(){var e=this.bottomRightItems,n=(this._getFreezeHeaderHeight()<=0&&(e=(e||[]).slice(this.options.header.length)),BI.max(BI.map(e,"x"))),r=[];return BI.each(e,function(e,t){t.x===n&&r.push(t.height)}),r},populate:function(e,t){e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate()},_restore:function(){this.topLeftCollection.restore(),this.topRightCollection.restore(),this.bottomLeftCollection.restore(),this.bottomRightCollection.restore()},restore:function(){this._restore()}}),BI.extend(BI.CollectionTable,{map:function I(e,o,a,i,s,l,c,u,h){l=l||[],c=c||[];for(var d=BI.isFunction(i)?i:function(){return i},p=[],f={},m={},g={},I={},b=[],t=o;t<a;t++)b[t]=t===o?s[t]:b[t-1]+s[t];var y=function y(e,t){m[t]._height+=d(e),m[t].__mergeRows.push(e)},v=function v(e,t){g[e]._width+=s[t],g[e].__mergeCols.push(t)},_=function _(e,t){var n=s[t],r=d(e);I[e][t]._row=e,I[e][t]._col=t,I[e][t]._width=n,I[e][t]._height=r,m[t]=I[e][t],m[t].__mergeRows=[e],g[e]=I[e][t],g[e].__mergeCols=[t],p.push({x:b[t]-s[t],y:h?h(e):+e*i,item:I[e][t]})};return BI.each(e,function(e,t){for(var n,r,i=o;i<a;i++)f[e]||(f[e]={}),I[e]||(I[e]={}),f[e][i]=t[i],I[e][i]={},!0===l||-1<l.indexOf(i)||!0===c||-1<c.indexOf(e)?0===e&&i===o?_(0,o):i===o&&0<e?!0===(n=u(f[e][i],f[e-1][i]))?(y(e,i),g[e]=m[i]):_(e,i):0===e&&o<i?!0===(r=u(f[e][i],f[e][i-1]))?(v(e,i),m[i]=g[e]):_(e,i):(n=u(f[e][i],f[e-1][i]),(r=u(f[e][i],f[e][i-1]))&&n||(r&&v(e,i),n&&y(e,i),r||n||_(e,i))):_(e,i)}),{map:I,cells:p}},serialize:function(e,t,n,r,i,o,a,s,l){e=BI.CollectionTable.map(e,t,n,r,i,o,a,s,l);return BI.map(e.cells,function(e,t){return{x:t.x,y:t.y,row:t.item._row,col:t.item._col,width:t.item._width,height:t.item._height}})}}),BI.shortcut("bi.collection_table",BI.CollectionTable)},function(e,t,n){"use strict";BI.QuickCollectionTable=BI.inherit(BI.CollectionTable,{_defaultConfig:function(){return BI.extend(BI.QuickCollectionTable.superclass._defaultConfig.apply(this,arguments),{extraCls:"bi-quick-collection-table"})},render:function(){BI.QuickCollectionTable.superclass.render.apply(this,arguments);this.options;this.topLeftCollection.setOverflowX(!1),this.topLeftCollection.setOverflowY(!1),this.topRightCollection.setOverflowX(!1),this.topRightCollection.setOverflowY(!1),this.bottomLeftCollection.setOverflowX(!1),this.bottomLeftCollection.setOverflowY(!1),this.bottomRightCollection.setOverflowX(!1),this.bottomRightCollection.setOverflowY(!1)},mounted:function(){var t=this;this._topLeftWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelLeft,this),BI.bind(this._shouldHandleLeftX,this),BI.bind(this._shouldHandleY,this)),this._topRightWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelRight,this),BI.bind(this._shouldHandleRightX,this),BI.bind(this._shouldHandleY,this)),this._bottomLeftWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelLeft,this),BI.bind(this._shouldHandleLeftX,this),BI.bind(this._shouldHandleY,this)),this._bottomRightWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelRight,this),BI.bind(this._shouldHandleRightX,this),BI.bind(this._shouldHandleY,this)),this.topLeftCollection.element.mousewheel(function(e){t._topLeftWheelHandler.onWheel(e.originalEvent)}),this.topRightCollection.element.mousewheel(function(e){t._topRightWheelHandler.onWheel(e.originalEvent)}),this.bottomLeftCollection.element.mousewheel(function(e){t._bottomLeftWheelHandler.onWheel(e.originalEvent)}),this.bottomRightCollection.element.mousewheel(function(e){t._bottomRightWheelHandler.onWheel(e.originalEvent)})},_shouldHandleLeftX:function(e){return 0<e?this.bottomLeftCollection.getScrollLeft()<this.bottomLeftCollection.getMaxScrollLeft():0<this.bottomLeftCollection.getScrollLeft()},_shouldHandleRightX:function(e){return 0<e?this.bottomRightCollection.getScrollLeft()<this.bottomRightCollection.getMaxScrollLeft():0<this.bottomRightCollection.getScrollLeft()},_shouldHandleY:function(e){return 0<e?this.bottomRightCollection.getScrollTop()<this.bottomRightCollection.getMaxScrollTop():0<this.bottomRightCollection.getScrollTop()},_onWheelLeft:function(e,t){var n=this.bottomLeftCollection.getScrollTop(),r=this.bottomLeftCollection.getScrollLeft();Math.abs(t)>Math.abs(e)?e=0:t=0,r+=e,this.bottomLeftCollection.setScrollTop(n+=t),this.bottomRightCollection.setScrollTop(n),this.topLeftCollection.setScrollLeft(r),this.bottomLeftCollection.setScrollLeft(r),this._populateScrollbar(),this.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)},_onWheelRight:function(e,t){var n=this.bottomRightCollection.getScrollTop(),r=this.bottomRightCollection.getScrollLeft();Math.abs(t)>Math.abs(e)?e=0:t=0,r+=e,this.bottomLeftCollection.setScrollTop(n+=t),this.bottomRightCollection.setScrollTop(n),this.topRightCollection.setScrollLeft(r),this.bottomRightCollection.setScrollLeft(r),this._populateScrollbar(),this.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)},_populateTable:function(){var t,a=this.options,e=this.getRegionSize(),n=(BI.each(a.columnSize,function(e,t){!0===a.isNeedFreeze&&a.freezeCols.includes(e)?0:0,e,0}),e),r=this._getFreezeHeaderHeight(),i=this._width-e,o=this._getFreezeHeaderHeight(),s=e,l=this._height-r,c=this._width-e,u=this._height-o,n=(this.topLeft.setWidth(n),this.topLeft.setHeight(r),this.topRight.setWidth(i),this.topRight.setHeight(o),this.bottomLeft.setWidth(s),this.bottomLeft.setHeight(l),this.bottomRight.setWidth(c),this.bottomRight.setHeight(u),this.topLeftCollection.setWidth(n),this.topLeftCollection.setHeight(r),this.topRightCollection.setWidth(i),this.topRightCollection.setHeight(o),this.bottomLeftCollection.setWidth(s),this.bottomLeftCollection.setHeight(l),this.bottomRightCollection.setWidth(c),this.bottomRightCollection.setHeight(u),this.contextLayout.attr("items")),r=(n[1].left=e,n[2].top=this._getFreezeHeaderHeight(),n[3].left=e,n[3].top=this._getFreezeHeaderHeight(),n[4].left=e,this.contextLayout.attr("items",n),this.contextLayout.resize(),[]),i=[],o=[],s=[];(t=function t(e,n,r,i,o){BI.each(e,function(e,t){!i&&a.customCell?(n[t.row][t.col]._rowIndex=t.row,n[t.row][t.col]._columnIndex=t.col,n[t.row][t.col].firstRowTopLine=i,n[t.row][t.col].firstColumnLeftLine=o,r.push(n[t.row][t.col])):(t={type:"bi.collection_table_cell",cell:n[t.row][t.col],_rowIndex:t.row,_columnIndex:t.col,firstRowTopLine:i,firstColumnLeftLine:o},r.push(t))})})(this.topLeftItems,a.header,r,!0,!0),t(this.topRightItems,a.header,i,!0,this.topLeftItems.length<=0),t(this.bottomLeftItems,this._getActualItems(),o,this.topRightItems.length<=0,!0),t(this.bottomRightItems,this._getActualItems(),s,this.topRightItems.length<=0,this.topLeftItems.length<=0),this.topLeftCollection._populate(r),this.topRightCollection._populate(i),this.bottomLeftCollection._populate(o),this.bottomRightCollection._populate(s)}}),BI.shortcut("bi.quick_collection_table",BI.QuickCollectionTable)},function(e,t,n){"use strict";var h,m;h=function h(e,t,n,r){for(var i=0,o=1,a=0,s=BI.Constants.getConstant("bi.constant.char.widths"),l=0,c=e.length;l<c;l++){var u=e.charCodeAt(l);if(13===u||10===u)i=0,o++;else if(n<(i+=a=32<=u&&u<=126?s[u]*t:t)&&(i=a,o++),o===r)break}return o},m=function m(e,t,n,r,i,o,a){var s=Math.ceil((a-i)/r),e=h(e||"",t,n,s);return Math.min(Math.max(e*r+i,o),a)},BI.AutoHeightCollectionTable=BI.inherit(BI.CollectionTable,{_defaultConfig:function(){return BI.extend(BI.AutoHeightCollectionTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-collection-table bi-collection-auto-height-table",isAutoHeight:!0,isHeaderAutoHeight:!0,fontSize:12,fontLineHeight:14,columnGaps:[],rowGap:1,headerFontSize:12,headerFontLineHeight:14,headerColumnGaps:[],headerRowGap:1,rowSize:0,headerRowSize:0,maxRowSize:400})},_getFreezeHeaderHeight:function(){var e=this.options;return e.isHeaderAutoHeight?!this.headerIntervalTree||(e=this.headerIntervalTree.sumUntil(e.header.length))>=this._height?0:e:BI.AutoHeightCollectionTable.superclass._getFreezeHeaderHeight.call(this)},_getActualItems:function(){var e=this.options;if(!e.isHeaderAutoHeight)return BI.AutoHeightCollectionTable.superclass._getActualItems.call(this);if(this.headerIntervalTree&&this.headerIntervalTree.sumUntil(e.header.length)>=this._height)return e.header.concat(e.items);return e.items},_getContentHeight:function(){var e,t=this.options;return t.isAutoHeight||t.isHeaderAutoHeight?t.isHeaderAutoHeight?t.isAutoHeight?this.headerIntervalTree?(e=this.headerIntervalTree.sumUntil(t.header.length))>=this._height?e+this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:0:(e=this.headerIntervalTree?this.headerIntervalTree.sumUntil(t.header.length):0)>=this._height?e+t.items.length*t.rowSize:t.items.length*t.rowSize:(e=this._getFreezeHeaderHeight())<=0?t.header.length*t.headerRowSize+(this.intervalTree?this.intervalTree.sumUntil(t.items.length):0):this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:BI.AutoHeightCollectionTable.superclass._getContentHeight.call(this)},_getOneRowHeight:function(e){for(var t=this.options,n=this.options.items[e],r=0,i=this.heightCache,o=this._getFreezeColLength(),a=0,s=n.length;a<s;a++){var l=n[a];if(i[e]&&i[e][a])var c=i[e][a];else{var u=this.mergeRules.map[e]&&this.mergeRules.map[e][a],h=u&&u.__mergeRows||[],d=u&&u.__mergeCols||[],p=t.columnSize[a]-(t.columnGaps[a]||0)-((BI.isFunction(l.columnGap)?l.columnGap():l.columnGap)||0)-(0===a||a===o?2:1)-30*(l.layer||0);if(1<d.length){for(var f=1;f<d.length;f++)p+=t.columnSize[a+f];a+=d.length-1}c=m(l.text,t.fontSize,p,t.fontLineHeight,t.rowGap,t.rowSize,t.maxRowSize);if(c/=h.length||1,0<h.length)for(f=e;f<e+h.length;f++)i[f]||(i[f]={}),i[f][a]=c}if(c>=t.maxRowSize)return t.maxRowSize;r=Math.max(r,c)}return r},_getOneHeaderRowHeight:function(e){for(var t=this.options,n=this.options.header[e],r=0,i=this.headerHeightCache,o=this._getFreezeColLength(),a=0,s=n.length;a<s;a++){var l=n[a];if(i[e]&&i[e][a])var c=i[e][a];else{var u=this.headerMergeRules.map[e]&&this.headerMergeRules.map[e][a],h=u&&u.__mergeRows||[],d=u&&u.__mergeCols||[],p=t.columnSize[a]-(t.columnGaps[a]||0)-((l.cell?BI.isFunction(l.cell.columnGap)?l.cell.columnGap():l.cell.columnGap:l.columnGap)||0)-(0===a||a===o?2:1);if(1<d.length){for(var f=1;f<d.length;f++)p+=t.columnSize[a+f];a+=d.length-1}c=m((l.cell||l).text,t.headerFontSize,p,t.headerFontLineHeight,t.headerRowGap,t.headerRowSize,t.maxRowSize);if(c/=h.length||1,0<h.length)for(f=e;f<e+h.length;f++)i[f]||(i[f]={}),i[f][a]=c}if(c>=t.maxRowSize)return t.maxRowSize;r=Math.max(r,c)}return r},_getActualRowHeights:function(){var n=this,e=this.options,t=this.options.items;return this.intervalTree=BI.PrefixIntervalTree.empty(e.items.length),this.heightCache={},this.mergeRules=BI.CollectionTable.map(e.items,0,this._getFreezeColLength(),e.rowSize,e.columnSize,e.mergeCols,[],e.mergeRule),BI.each(t,function(e,t){n.intervalTree.set(e,n._getOneRowHeight(e))}),this.intervalTree},_getActualHeaderRowHeights:function(){var n=this,e=this.options,t=this.options.header;return this.headerIntervalTree=BI.PrefixIntervalTree.empty(e.header.length),this.headerHeightCache={},this.headerMergeRules=BI.CollectionTable.map(e.header,this._getFreezeColLength(),e.columnSize.length,e.headerRowSize,e.columnSize,!0,[],e.mergeRule),BI.each(t,function(e,t){n.headerIntervalTree.set(e,n._getOneHeaderRowHeight(e))}),this.headerIntervalTree},_digest:function(){var t,n=this,r=this.options;if(!r.isAutoHeight&&!r.isHeaderAutoHeight)return BI.AutoHeightCollectionTable.superclass._digest.call(this);t=r.isHeaderAutoHeight?(this._getActualHeaderRowHeights(),this.headerIntervalTree.sumUntil(r.header.length)):r.header.length*r.headerRowSize,r.isAutoHeight&&this._getActualRowHeights();var i,o,a,s,l,c,e=this._getFreezeColLength();t>=this._height?(i={},o={},this.topLeftItems=[],this.topRightItems=[],this.bottomLeftItems=BI.CollectionTable.serialize(this._getActualItems(),0,e,function(e){return i[e]||(e<=r.header.length-1?r.isHeaderAutoHeight?i[e]=n.headerIntervalTree.get(e):i[e]=r.headerRowSize:r.isAutoHeight?i[e]=n.intervalTree.get(e-r.header.length):i[e]=r.rowSize)},r.columnSize,r.mergeCols,BI.range(r.header.length),r.mergeRule,function(e){return e<=0?0:o[e]||(e<=r.header.length?r.isHeaderAutoHeight?o[e]=n.headerIntervalTree.sumUntil(e):o[e]=e*r.headerRowSize:r.isAutoHeight?o[e]=t+n.intervalTree.sumUntil(e-r.header.length):o[e]=t+(e-r.header.length)*r.rowSize)}),this.bottomRightItems=BI.CollectionTable.serialize(this._getActualItems(),e,r.columnSize.length,function(e){return i[e]||(e<=r.header.length-1?r.isHeaderAutoHeight?i[e]=n.headerIntervalTree.get(e):i[e]=r.headerRowSize:r.isAutoHeight?i[e]=n.intervalTree.get(e-r.header.length):i[e]=r.rowSize)},r.columnSize,r.mergeCols,BI.range(r.header.length),r.mergeRule,function(e){return e<=0?0:o[e]||(e<=r.header.length?r.isHeaderAutoHeight?o[e]=n.headerIntervalTree.sumUntil(e):o[e]=e*r.headerRowSize:r.isAutoHeight?o[e]=t+n.intervalTree.sumUntil(e-r.header.length):o[e]=t+(e-r.header.length)*r.rowSize)})):(a={},s={},l={},c={},this.topLeftItems=BI.CollectionTable.serialize(r.header,0,e,function(e){return a[e]||(r.isHeaderAutoHeight?a[e]=n.headerIntervalTree.get(e):a[e]=r.headerRowSize)},r.columnSize,r.mergeCols,[],r.mergeRule,function(e){return 0===e?0:s[e]||(r.isHeaderAutoHeight?s[e]=n.headerIntervalTree.sumUntil(e):e*r.headerRowSize)}),this.topRightItems=BI.CollectionTable.serialize(r.header,e,r.columnSize.length,function(e){return a[e]||(r.isHeaderAutoHeight?a[e]=n.headerIntervalTree.get(e):a[e]=r.headerRowSize)},r.columnSize,!0,[],r.mergeRule,function(e){return 0===e?0:s[e]||(r.isHeaderAutoHeight?s[e]=n.headerIntervalTree.sumUntil(e):e*r.headerRowSize)}),this.bottomLeftItems=BI.CollectionTable.serialize(r.items,0,e,function(e){return l[e]||(r.isAutoHeight?l[e]=n.intervalTree.get(e):l[e]=r.rowSize)},r.columnSize,r.mergeCols,[],r.mergeRule,function(e){return 0===e?0:c[e]||(r.isAutoHeight?c[e]=n.intervalTree.sumUntil(e):e*r.rowSize)}),this.bottomRightItems=BI.CollectionTable.serialize(r.items,e,r.columnSize.length,function(e){return l[e]||(r.isAutoHeight?l[e]=n.intervalTree.get(e):l[e]=r.rowSize)},r.columnSize,r.mergeCols,[],r.mergeRule,function(e){return 0===e?0:c[e]||(r.isAutoHeight?c[e]=n.intervalTree.sumUntil(e):e*r.rowSize)}))}}),BI.shortcut("bi.collection_auto_height_table",BI.AutoHeightCollectionTable)},function(e,t,n){"use strict";var r;r=BI.DynamicCollectionTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(r.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-dynamic-collection-table",headerRowSize:25,columnSize:[],isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,header:[],items:[],regionColumnSize:[],trRenderer:null,headerEl:{},bodyEl:{},bordered:!0})},attr:function(e,t){var n=r.superclass.attr.apply(this,arguments);return BI.isNull(t)?(this.topRightCollection.attr.apply(this.topRightCollection,arguments),this.bottomRightCollection.attr.apply(this.bottomRightCollection,arguments)):n},render:function(){var t=this,n=this.options;this._width=0,this._height=0,this.topLeftCollection=BI.createWidget({type:"bi.dynamic_collection_view",stopScrollEvent:!0,renderMore:!0,columnSize:n.columnSize.slice(0,n.freezeCols.length),isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:n.mergeRule,rowSizeGetter:function(e){return n.headerRowSize}}),this.topLeftCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomLeftCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topRightCollection=BI.createWidget({type:"bi.dynamic_collection_view",columnSize:n.columnSize,isNeedFreeze:n.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:n.mergeRule,regionColumnSize:n.regionColumnSize,rowSizeGetter:function(e){return n.headerRowSize}}),this.topRightCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomRightCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomRightCollection=BI.createWidget({type:"bi.dynamic_collection_view",columnSize:n.columnSize,isNeedFreeze:n.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:n.mergeRule,regionColumnSize:n.regionColumnSize,trRenderer:n.trRenderer,el:n.bodyEl}),this.bottomRightCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomLeftCollection.setScrollTop(e.scrollTop),t.topRightCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomRightCollection.on("EVENT_SYNC",function(){t.bottomLeftCollection._calculateBlocksToRender()}),this.bottomLeftCollection=BI.createWidget({type:"bi.dynamic_collection_view",stopScrollEvent:!0,renderMore:!0,columnSize:n.columnSize.slice(0,n.freezeCols.length),isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:n.mergeRule,rowSizeGetter:function(e){return t.bottomRightCollection.trCache[e].element.height()},trRenderer:n.trRenderer}),this.bottomLeftCollection.on(BI.CollectionView.EVENT_SCROLL,function(e){t.bottomRightCollection.setScrollTop(e.scrollTop),t.topLeftCollection.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topLeftCollection]}),this.topRight=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topRightCollection]}),this.bottomLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.bottomLeftCollection]}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrolly:!1,items:[this.bottomRightCollection]}),this.contextLayout=BI.createWidget({type:"bi.absolute",cls:n.bordered?"bordered bi-split":"",element:this,items:[{el:this.topLeft,top:0,left:0},{el:this.topRight,top:0},{el:this.bottomLeft,left:0},{el:this.bottomRight}]}),this.leftScrollbar=BI.createWidget({type:"bi.grid_table_horizontal_scrollbar",height:BI.GridTableScrollbar.SIZE}),this.leftScrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(e){t.topLeftCollection.setScrollLeft(e),t.bottomLeftCollection.setScrollLeft(e),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.scrollBarLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.leftScrollbar,left:0,bottom:0}]}),this._width=n.width-BI.GridTableScrollbar.SIZE,this._height=n.height-BI.GridTableScrollbar.SIZE,BI.isChrome()&&BI.isWindows()&&!BI.isEdge()||BI.createWidget({type:"bi.absolute",element:this,items:[{el:{type:"bi.default",cls:"bi-table-fix-scroll"},top:0,right:0,bottom:0,left:0}]})},mounted:function(){var e=this.options;(0<e.header.length||0<e.items.length)&&(this._digest(),this._populate())},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedFreeze?BI.clamp(e.freezeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?0:e.header.length*e.headerRowSize},_getActualItems:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?e.header.concat(e.items):e.items},_populateScrollbar:function(){var n=this.options,e=this.getRegionSize(),r=0,e=(BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?r+=t:0,e,0}),this.leftScrollbar.setContentSize(r),this.leftScrollbar.setSize(e),this.leftScrollbar.setPosition(this.bottomLeftCollection.getScrollLeft()),this.leftScrollbar.populate(),this.scrollBarLayout.attr("items"));e[0].top=this._height,this.scrollBarLayout.attr("items",e),this.scrollBarLayout.resize()},_populateTable:function(){var n=this.options,e=this.getRegionSize(),t=(BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?0:0,e,0}),e),r=this._getFreezeHeaderHeight(),i=this._width-e,o=this._getFreezeHeaderHeight(),a=e,s=this._height-r,l=this._width-e,c=this._height-o,u=BI.DOM.getScrollWidth(),h=t+u,d=r+u,p=i+u,f=o+u,m=a+u,g=s+u,b=l+u,u=c+u,y=function y(e){e.element.css({overflow:"scroll",overflowX:"scroll",overflowY:"scroll"})},t=(this.topLeft.setWidth(t),this.topLeft.setHeight(r),this.topRight.setWidth(i),this.topRight.setHeight(o),this.bottomLeft.setWidth(a),this.bottomLeft.setHeight(s),this.bottomRight.setWidth(l),this.bottomRight.setHeight(c),this.topLeftCollection.setWidth(h),this.topLeftCollection.setHeight(d),this.topRightCollection.setWidth(p),this.topRightCollection.setHeight(f),this.bottomLeftCollection.setWidth(m),this.bottomLeftCollection.setHeight(g),this.bottomRightCollection.setWidth(b),this.bottomRightCollection.setHeight(u),y(this.topLeftCollection),y(this.topRightCollection),y(this.bottomLeftCollection),y(this.bottomRightCollection),this.contextLayout.attr("items"));t[1].left=e,t[2].top=this._getFreezeHeaderHeight(),t[3].left=e,t[3].top=this._getFreezeHeaderHeight(),this.contextLayout.attr("items",t),this.contextLayout.resize();this.topRightCollection.setColumnSize(n.columnSize),this.topRightCollection._populate(n.header),this.bottomRightCollection.setColumnSize(n.columnSize),this.bottomRightCollection._populate(n.items),n.isNeedFreeze&&0<n.freezeCols.length&&(this.topLeftCollection.setColumnSize(n.columnSize.slice(0,n.freezeCols.length)),this.topLeftCollection._populate(BI.map(n.header,function(e,t){return t.slice(0,n.freezeCols.length)})),this.bottomLeftCollection.setColumnSize(n.columnSize.slice(0,n.freezeCols.length)),this.bottomLeftCollection._populate(BI.map(n.items,function(e,t){return t.slice(0,n.freezeCols.length)})))},_digest:function(){this.options},_populate:function(){this._width<=0||this._height<=0||(!0===this._isNeedDigest&&this._digest(),this._isNeedDigest=!1,this._populateTable(),this._populateScrollbar())},getRegionSize:function(){var n=this.options,r=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(r||BI.each(n.freezeCols,function(e,t){r+=n.columnSize[t]}),r)},setVerticalScroll:function(e){},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){return this.bottomRightCollection.getScrollTop()},getLeftHorizontalScroll:function(){return this.bottomLeftCollection.getScrollLeft()},getRightHorizontalScroll:function(){return this.bottomRightCollection.getScrollLeft()},setWidth:function(e){r.superclass.setWidth.apply(this,arguments),this._width=this.options.width-BI.GridTableScrollbar.SIZE},setHeight:function(e){r.superclass.setHeight.apply(this,arguments),this._height=this.options.height-BI.GridTableScrollbar.SIZE},setColumnSize:function(e){this._isNeedDigest=!0,this.options.columnSize=e,this.topRightCollection.setColumnSize(e),this.bottomRightCollection.setColumnSize(e)},setRegionColumnSize:function(e){this._isNeedDigest=!0,this.options.regionColumnSize=e,this.topRightCollection.setRegionColumnSize(e),this.bottomRightCollection.setRegionColumnSize(e)},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},populate:function(e,t){e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate()},_restore:function(){this.topLeftCollection.restore(),this.topRightCollection.restore(),this.bottomLeftCollection.restore(),this.bottomRightCollection.restore()},restore:function(){this._restore()}}),BI.shortcut("bi.dynamic_collection_table",r)},function(e,t,n){"use strict";BI.GridTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.GridTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-grid-table-cell  bi-border-right bi-border-bottom",width:0,height:0,firstRowTopLine:!0,firstColumnLeftLine:!0,_rowIndex:0,_columnIndex:0,_left:0,_top:0,cell:{}})},_init:function(){BI.GridTableCell.superclass._init.apply(this,arguments);var e=this.options;this.cell=BI.createWidget(BI.extend({type:"bi.label"},e.cell,{cls:(e.cell.cls||"")+" grid-table-cell-wrapper",width:e.width-(e.firstColumnLeftLine&&0===e._columnIndex?1:0)-1,height:e.height-(e.firstRowTopLine&&0===e._rowIndex?1:0)-1})),BI.createWidget({type:"bi.absolute",cls:(e.firstRowTopLine?"bi-grid-table-cell-top-line":"")+(e.firstColumnLeftLine?" bi-grid-table-cell-left-line":""),element:this,items:[{el:this.cell,left:0,right:0,top:0,bottom:0}]})},setWidth:function(e){BI.GridTableCell.superclass.setWidth.apply(this,arguments);var t=this.options;this.cell.setWidth(t.width-(t.firstColumnLeftLine&&0===t._columnIndex?1:0)-1)},setHeight:function(e){BI.GridTableCell.superclass.setHeight.apply(this,arguments);var t=this.options;this.cell.setHeight(t.height-(t.firstRowTopLine&&0===t._rowIndex?1:0)-1)}}),BI.shortcut("bi.grid_table_cell",BI.GridTableCell)},function(e,t,n){"use strict";BI.GridTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.GridTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-grid-table",headerRowSize:25,rowSize:25,columnSize:[],isNeedFreeze:!1,freezeCols:[],header:[],items:[],regionColumnSize:[],customCell:!1})},render:function(){var t=this,n=this.options,r=(this._width=0,this._height=0,function r(e){return n.columnSize[e]}),i=function i(e){return n.columnSize[e+t._getFreezeColLength()]};this.topLeftGrid=BI.createWidget({type:"bi.grid_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),rowHeightGetter:this._headerRowHeightGetter.bind(this),columnWidthGetter:r}),this.topLeftGrid.on(BI.GridView.EVENT_SCROLL,function(e){t.bottomLeftGrid.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topRightGrid=BI.createWidget({type:"bi.grid_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),rowHeightGetter:this._headerRowHeightGetter.bind(this),columnWidthGetter:i}),this.topRightGrid.on(BI.GridView.EVENT_SCROLL,function(e){t.bottomRightGrid.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomLeftGrid=BI.createWidget({type:"bi.grid_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),rowHeightGetter:this._rowHeightGetter.bind(this),columnWidthGetter:r}),this.bottomLeftGrid.on(BI.GridView.EVENT_SCROLL,function(e){t.bottomRightGrid.setScrollTop(e.scrollTop),t.topLeftGrid.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.bottomRightGrid=BI.createWidget({type:"bi.grid_view",overflowX:!BI.isFireFox(),overflowY:!BI.isFireFox(),rowHeightGetter:this._rowHeightGetter.bind(this),columnWidthGetter:i}),this.bottomRightGrid.on(BI.GridView.EVENT_SCROLL,function(e){t.bottomLeftGrid.setScrollTop(e.scrollTop),t.topRightGrid.setScrollLeft(e.scrollLeft),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.topLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topLeftGrid]}),this.topRight=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.topRightGrid]}),this.bottomLeft=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.bottomLeftGrid]}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrollable:!1,scrolly:!1,items:[this.bottomRightGrid]}),this.shadow=BI.createWidget({type:"bi.layout",cls:"grid-table-shadow"}),this.contextLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.topLeft,top:0,left:0},{el:this.topRight,top:0},{el:this.bottomLeft,left:0},{el:this.bottomRight},{el:this.shadow,top:0,bottom:0}]}),this.topScrollbar=BI.createWidget({type:"bi.grid_table_scrollbar",width:BI.GridTableScrollbar.SIZE}),this.topScrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(e){t.bottomLeftGrid.setScrollTop(e),t.bottomRightGrid.setScrollTop(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.leftScrollbar=BI.createWidget({type:"bi.grid_table_horizontal_scrollbar",height:BI.GridTableScrollbar.SIZE}),this.leftScrollbar.on(BI.GridTableHorizontalScrollbar.EVENT_SCROLL,function(e){t.topLeftGrid.setScrollLeft(e),t.bottomLeftGrid.setScrollLeft(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.rightScrollbar=BI.createWidget({type:"bi.grid_table_horizontal_scrollbar",height:BI.GridTableScrollbar.SIZE}),this.rightScrollbar.on(BI.GridTableHorizontalScrollbar.EVENT_SCROLL,function(e){t.topRightGrid.setScrollLeft(e),t.bottomRightGrid.setScrollLeft(e),t._populateScrollbar(),t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.scrollBarLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.topScrollbar,right:0,top:0},{el:this.leftScrollbar,left:0},{el:this.rightScrollbar}]}),BI.isChrome()&&BI.isWindows()&&!BI.isEdge()||BI.createWidget({type:"bi.absolute",element:this,items:[{el:{type:"bi.default",cls:"bi-table-fix-scroll"},top:0,right:0,bottom:0,left:0}]}),this._width=n.width-BI.GridTableScrollbar.SIZE,this._height=n.height-BI.GridTableScrollbar.SIZE,this.header=this._getHeader(),this.items=this._getItems(),(0<n.header.length||0<n.items.length)&&this._populate()},_rowHeightGetter:function(){return this.options.rowSize},_headerRowHeightGetter:function(){return this.options.headerRowSize},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedFreeze?BI.clamp(e.freezeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?0:e.header.length*e.headerRowSize},_getActualItems:function(){var e=this.options;return e.header.length*e.headerRowSize>=this._height?e.header.concat(e.items):e.items},_getContentHeight:function(){return this._getActualItems().length*this.options.rowSize},_getHeader:function(){var r=this.options,i=this._getFreezeColLength(),o=[],a=[];return BI.each(r.header,function(n,e){o[n]=[],a[n]=[],BI.each(e,function(e,t){t=r.customCell?t:{type:"bi.grid_table_cell",cell:t};t.firstRowTopLine=!0,e===i&&0<i&&(t.firstColumnLeftLine=!1),(e<i?o:a)[n].push(t)})}),[o,a]},_populateScrollbar:function(){var n=this.options,e=this.getRegionSize(),r=0,i=0,t=(BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?r+=t:i+=t,e,0}),this.topScrollbar.setContentSize(this._getContentHeight()),this._getFreezeHeaderHeight()),o=this._height-t,o=(this.topScrollbar.setSize(o),this.topScrollbar.setPosition(Math.min(this.bottomLeftGrid.getScrollTop(),this.bottomRightGrid.getScrollTop())),this.topScrollbar.populate(),this.leftScrollbar.setContentSize(r),this.leftScrollbar.setSize(e),Math.max(this.bottomLeftGrid.getScrollLeft(),this.topLeftGrid.getScrollLeft())),a=(this.leftScrollbar.setPosition(o),this.leftScrollbar.populate(),this.rightScrollbar.setContentSize(i),this.rightScrollbar.setSize(this._width-e),Math.max(this.bottomRightGrid.getScrollLeft(),this.topRightGrid.getScrollLeft())),s=(this.rightScrollbar.setPosition(a),this.rightScrollbar.populate(),this.scrollBarLayout.attr("items")),s=(s[0].top=this._getFreezeHeaderHeight(),s[1].top=this._height,s[2].top=this._height,s[2].left=e,this.scrollBarLayout.attr("items",s),this.scrollBarLayout.resize(),!1);0<r&&0<i&&(s=e<r&&o<r-e||0<a)&&(o=this.getFirstColumnRowSize(),e=BI.sum(o),this.shadow.setHeight(Math.min(this._height,t+e))),this.shadow.setVisible(s)},_getItems:function(){var r=this.options,i=this._getFreezeColLength(),o=[],a=[],s=!(r.header&&0<r.header.length);return BI.each(this._getActualItems(),function(n,e){o[n]=[],a[n]=[],BI.each(e,function(e,t){t=r.customCell?(t&&(t.firstRowTopLine=s),t):{type:"bi.grid_table_cell",cell:t,firstRowTopLine:s};e===i&&0<i&&(t.firstColumnLeftLine=!1),(e<i?o:a)[n].push(t)})}),[o,a]},_digest:function(){var n=this.options,e=this._getFreezeColLength(),r=0,i=0;BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?r+=t:i+=t,e,0}),this.topLeftGrid.setEstimatedColumnSize(0<e?r/e:0),this.topLeftGrid.setEstimatedRowSize(n.headerRowSize),this.topRightGrid.setEstimatedColumnSize(0<n.columnSize.length-e?i/(n.columnSize.length-e):0),this.topRightGrid.setEstimatedRowSize(n.headerRowSize),this.bottomLeftGrid.setEstimatedColumnSize(0<e?r/e:0),this.bottomLeftGrid.setEstimatedRowSize(n.rowSize),this.bottomRightGrid.setEstimatedColumnSize(0<n.columnSize.length-e?i/(n.columnSize.length-e):0),this.bottomRightGrid.setEstimatedRowSize(n.rowSize),this.topLeftGrid.setColumnCount(e),this.topRightGrid.setColumnCount(n.columnSize.length-e),this.bottomLeftGrid.setColumnCount(e),this.bottomRightGrid.setColumnCount(n.columnSize.length-e)},_populateTable:function(){this.options;var e=this.getRegionSize(),t=e,n=this._getFreezeHeaderHeight(),r=this._width-e,i=this._getFreezeHeaderHeight(),o=e,a=this._height-n,s=this._width-e,l=this._height-i,c=BI.isFireFox()?0:BI.DOM.getScrollWidth(),u=t+c,h=n+c,d=r+c,p=i+c,f=o+c,m=a+c,g=s+c,c=l+c,b=function b(e){e.element.css({overflow:"scroll",overflowX:"scroll",overflowY:"scroll"})},t=(this.topLeft.setWidth(t),this.topLeft.setHeight(n),this.topRight.setWidth(r),this.topRight.setHeight(i),this.bottomLeft.setWidth(o),this.bottomLeft.setHeight(a),this.bottomRight.setWidth(s),this.bottomRight.setHeight(l),this.topLeftGrid.setWidth(u),this.topLeftGrid.setHeight(h),this.topRightGrid.setWidth(d),this.topRightGrid.setHeight(p),this.bottomLeftGrid.setWidth(f),this.bottomLeftGrid.setHeight(m),this.bottomRightGrid.setWidth(g),this.bottomRightGrid.setHeight(c),b(this.topLeftGrid),b(this.topRightGrid),b(this.bottomLeftGrid),b(this.bottomRightGrid),this.contextLayout.attr("items")),n=(t[1].left=e,t[2].top=this._getFreezeHeaderHeight(),t[3].left=e,t[3].top=this._getFreezeHeaderHeight(),t[4].left=e,this.contextLayout.attr("items",t),this.contextLayout.resize(),this._getHeader()),r=this._getItems(n);this.topLeftGrid._populate(n[0]),this.topRightGrid._populate(n[1]),this.bottomLeftGrid._populate(r[0]),this.bottomRightGrid._populate(r[1])},_syncScroll:function(){this.setLeftHorizontalScroll(this.getLeftHorizontalScroll()),this.setRightHorizontalScroll(this.getRightHorizontalScroll()),this.setVerticalScroll(this.getVerticalScroll())},_populate:function(){this._width<=0||this._height<=0||(this._digest(),this._populateTable(),this._populateScrollbar(),this._syncScroll())},attr:function(e,t){var n=BI.GridTable.superclass.attr.apply(this,arguments);if(BI.isNotNull(t))switch(e){case"scrollLeft":this.topRightGrid.attr(e,t),this.bottomRightGrid.attr(e,t);break;case"scrollTop":this.bottomLeftGrid.attr(e,t),this.bottomRightGrid.attr(e,t)}return n},getRegionSize:function(){var n=this.options,r=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(r||BI.each(n.freezeCols,function(e,t){r+=n.columnSize[t]}),r)},setVerticalScroll:function(e){this.bottomLeftGrid.setScrollTop(e),this.bottomRightGrid.setScrollTop(e),this._populateScrollbar()},setLeftHorizontalScroll:function(e){this.topLeftGrid.setScrollLeft(e),this.bottomLeftGrid.setScrollLeft(e),this._populateScrollbar()},setRightHorizontalScroll:function(e){this.topRightGrid.setScrollLeft(e),this.bottomRightGrid.setScrollLeft(e),this._populateScrollbar()},getVerticalScroll:function(){return this.bottomRightGrid.getScrollTop()},getLeftHorizontalScroll:function(){return this.bottomLeftGrid.getScrollLeft()},getRightHorizontalScroll:function(){return this.bottomRightGrid.getScrollLeft()},getActualRightHorizontalScroll:function(){return this.bottomRightGrid.element.scrollLeft()},setWidth:function(e){BI.GridTable.superclass.setWidth.apply(this,arguments),this._width=this.options.width-BI.GridTableScrollbar.SIZE},setHeight:function(e){BI.GridTable.superclass.setHeight.apply(this,arguments),this._height=this.options.height-BI.GridTableScrollbar.SIZE},setColumnSize:function(e){this.options.columnSize=e,this._isNeedDigest=!0},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this._isNeedDigest=!0},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},getFirstColumnHeaderRowSize:function(){var e=this.options,t=this.options.header;return BI.map(t,function(){return e.headerRowSize})},getFirstColumnRowSize:function(){var e=this.options,t=this.options.items;return BI.map(t,function(){return e.rowSize})},populate:function(e,t){var n=this.options.header!==t,r=this.options.items!==e;t&&n&&(this.options.header=t),e&&r&&(this.options.items=e),e&&r&&(this.items=this._getItems(),this._restore()),t&&n&&(this.header=this._getHeader(),this._restore()),this._populate()},_restore:function(){this.topLeftGrid.restore(),this.topRightGrid.restore(),this.bottomLeftGrid.restore(),this.bottomRightGrid.restore()},restore:function(){this._restore()}}),BI.shortcut("bi.grid_table",BI.GridTable)},function(e,t,n){"use strict";BI.QuickGridTable=BI.inherit(BI.GridTable,{_defaultConfig:function(){return BI.extend(BI.QuickGridTable.superclass._defaultConfig.apply(this,arguments),{extraCls:"bi-quick-grid-table"})},render:function(){BI.QuickGridTable.superclass.render.apply(this,arguments);this.options;this.topLeftGrid.setOverflowX(!1),this.topLeftGrid.setOverflowY(!1),this.topRightGrid.setOverflowX(!1),this.topRightGrid.setOverflowY(!1),this.bottomLeftGrid.setOverflowX(!1),this.bottomLeftGrid.setOverflowY(!1),this.bottomRightGrid.setOverflowX(!1),this.bottomRightGrid.setOverflowY(!1)},mounted:function(){var t=this;this._topLeftWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelLeft,this),BI.bind(this._shouldHandleLeftX,this),BI.bind(this._shouldHandleY,this)),this._topRightWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelRight,this),BI.bind(this._shouldHandleRightX,this),BI.bind(this._shouldHandleY,this)),this._bottomLeftWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelLeft,this),BI.bind(this._shouldHandleLeftX,this),BI.bind(this._shouldHandleY,this)),this._bottomRightWheelHandler=new BI.WheelHandler(BI.bind(this._onWheelRight,this),BI.bind(this._shouldHandleRightX,this),BI.bind(this._shouldHandleY,this)),this.topLeftGrid.element.mousewheel(function(e){t._topLeftWheelHandler.onWheel(e.originalEvent)}),this.topRightGrid.element.mousewheel(function(e){t._topRightWheelHandler.onWheel(e.originalEvent)}),this.bottomLeftGrid.element.mousewheel(function(e){t._bottomLeftWheelHandler.onWheel(e.originalEvent)}),this.bottomRightGrid.element.mousewheel(function(e){t._bottomRightWheelHandler.onWheel(e.originalEvent)})},_shouldHandleLeftX:function(e){return 0<e?this.bottomLeftGrid.getScrollLeft()<this.bottomLeftGrid.getMaxScrollLeft():0<this.bottomLeftGrid.getScrollLeft()},_shouldHandleRightX:function(e){return 0<e?this.bottomRightGrid.getScrollLeft()<this.bottomRightGrid.getMaxScrollLeft():0<this.bottomRightGrid.getScrollLeft()},_shouldHandleY:function(e){return 0<e?this.bottomRightGrid.getScrollTop()<this.bottomRightGrid.getMaxScrollTop():0<this.bottomRightGrid.getScrollTop()},_onWheelLeft:function(e,t){var n=this.bottomLeftGrid.getScrollTop(),r=this.bottomLeftGrid.getScrollLeft();Math.abs(t)>Math.abs(e)?e=0:t=0,r+=e,this.bottomLeftGrid.setScrollTop(n+=t),this.bottomRightGrid.setScrollTop(n),this.topLeftGrid.setScrollLeft(r),this.bottomLeftGrid.setScrollLeft(r),this._populateScrollbar(),this.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)},_onWheelRight:function(e,t){var n=this.bottomRightGrid.getScrollTop(),r=this.bottomRightGrid.getScrollLeft();Math.abs(t)>Math.abs(e)?e=0:t=0,r+=e,this.bottomLeftGrid.setScrollTop(n+=t),this.bottomRightGrid.setScrollTop(n),this.topRightGrid.setScrollLeft(r),this.bottomRightGrid.setScrollLeft(r),this._populateScrollbar(),this.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)},_populateTable:function(){var r=this.options,e=this.getRegionSize(),n=0,i=0,o=this._getFreezeColLength(),t=(BI.each(r.columnSize,function(e,t){!0===r.isNeedFreeze&&r.freezeCols.includes(e)?n+=t:i+=t,e,0}),e),a=this._getFreezeHeaderHeight(),s=this._width-e,l=this._getFreezeHeaderHeight(),c=e,u=this._height-a,h=this._width-e,d=this._height-l,t=(this.topLeft.setWidth(t),this.topLeft.setHeight(a),this.topRight.setWidth(s),this.topRight.setHeight(l),this.bottomLeft.setWidth(c),this.bottomLeft.setHeight(u),this.bottomRight.setWidth(h),this.bottomRight.setHeight(d),this.topLeftGrid.setWidth(t),this.topLeftGrid.setHeight(a),this.topRightGrid.setWidth(s),this.topRightGrid.setHeight(l),this.bottomLeftGrid.setWidth(c),this.bottomLeftGrid.setHeight(u),this.bottomRightGrid.setWidth(h),this.bottomRightGrid.setHeight(d),this.topLeftGrid.setEstimatedColumnSize(0<o?n/o:0),this.topLeftGrid.setEstimatedRowSize(r.headerRowSize),this.topRightGrid.setEstimatedColumnSize(0<r.columnSize.length-o?i/(r.columnSize.length-o):0),this.topRightGrid.setEstimatedRowSize(r.headerRowSize),this.bottomLeftGrid.setEstimatedColumnSize(0<o?n/o:0),this.bottomLeftGrid.setEstimatedRowSize(r.rowSize),this.bottomRightGrid.setEstimatedColumnSize(0<r.columnSize.length-o?i/(r.columnSize.length-o):0),this.bottomRightGrid.setEstimatedRowSize(r.rowSize),this.topLeftGrid.setColumnCount(o),this.topRightGrid.setColumnCount(r.columnSize.length-o),this.bottomLeftGrid.setColumnCount(o),this.bottomRightGrid.setColumnCount(r.columnSize.length-o),this.contextLayout.attr("items")),p=(t[1].left=e,t[2].top=this._getFreezeHeaderHeight(),t[3].left=e,t[3].top=this._getFreezeHeaderHeight(),t[4].left=e,this.contextLayout.attr("items",t),this.contextLayout.resize(),[]),f=[],m=[],g=[],b=(BI.each(r.header,function(n,e){p[n]=[],f[n]=[],BI.each(e,function(e,t){t=r.customCell?t:{type:"bi.grid_table_cell",cell:t};t.firstRowTopLine=!0,e===o&&0<o&&(t.firstColumnLeftLine=!1),(e<o?p:f)[n].push(t)})}),!(r.header&&0<r.header.length));BI.each(this._getActualItems(),function(n,e){m[n]=[],g[n]=[],BI.each(e,function(e,t){t=r.customCell?(t&&(t.firstRowTopLine=b),t):{type:"bi.grid_table_cell",cell:t,firstRowTopLine:b};(e<o?m:g)[n].push(t)})}),this.topLeftGrid._populate(p),this.topRightGrid._populate(f),this.bottomLeftGrid._populate(m),this.bottomRightGrid._populate(g)}}),BI.shortcut("bi.quick_grid_table",BI.QuickGridTable)},function(e,t,n){"use strict";BI.GridTableScrollbar=BI.inherit(BI.Widget,{_const:{FACE_MARGIN:4,FACE_MARGIN_2:8,FACE_SIZE_MIN:30,KEYBOARD_SCROLL_AMOUNT:40},_defaultConfig:function(){return BI.extend(BI.GridTableScrollbar.superclass._defaultConfig.apply(this,arguments),{baseCls:"scrollbar-layout-main public-scrollbar-main",attributes:{tabIndex:0},contentSize:0,defaultPosition:0,isOpaque:!1,orientation:"vertical",position:0,size:0})},render:function(){this.options;this.focused=!1,this.isDragging=!1,this.face=BI.createWidget({type:"bi.layout",cls:"scrollbar-layout-face public-scrollbar-face "+(this._isHorizontal()?"scrollbar-layout-face-horizontal":"scrollbar-layout-face-vertical")}),this.contextLayout=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.face,left:0,top:0}]})},mounted:function(){var t=this,e="horizontal"===this.options.orientation?this._onWheelX:this._onWheelY;this._wheelHandler=new BI.WheelHandler(BI.bind(e,this),BI.bind(this._shouldHandleX,this),BI.bind(this._shouldHandleY,this)),this._mouseMoveTracker=new BI.MouseMoveTracker(BI.bind(this._onMouseMove,this),BI.bind(this._onMouseMoveEnd,this),_global.document),this.element.on("mousedown",BI.bind(this._onMouseDown,this)),this.element.on("mousewheel",function(e){t._wheelHandler.onWheel(e.originalEvent)}),this.element.on("keydown",BI.bind(this._onKeyDown,this)),this.element.on("focus",function(){t.focused=!0,t._populate()}),this.element.on("blur",function(){t.focused=!1,t._populate()}),this._isHorizontal()?this.element.addClass("scrollbar-layout-main-horizontal"):this.element.addClass("scrollbar-layout-main-vertical"),this._populate()},_isHorizontal:function(){return"horizontal"===this.options.orientation},_getScale:function(){var e=this.options,t=e.size/e.contentSize;return t=e.size*t<this._const.FACE_SIZE_MIN?(e.size-this._const.FACE_SIZE_MIN)/(e.contentSize-e.size):t},_getFaceSize:function(){var e=this.options,t=e.size/e.contentSize,e=e.size*t;return e=e<this._const.FACE_SIZE_MIN?this._const.FACE_SIZE_MIN:e},_shouldHandleX:function(e){return"horizontal"===this.options.orientation&&this._shouldHandleChange(e)},_shouldHandleY:function(e){return"horizontal"!==this.options.orientation&&this._shouldHandleChange(e)},_shouldHandleChange:function(e){return this.options.position+e!==this.options.position},_onWheelY:function(e,t){this._onWheel(t)},_onWheelX:function(e,t){this._onWheel(e)},_onWheel:function(e){var t=this.options.contentSize-this.options.size;this.options.position+=e,this.options.position<0?this.options.position=0:this.options.position>t&&(this.options.position=t),this._populate(),this.fireEvent(BI.GridTableScrollbar.EVENT_SCROLL,this.options.position)},_onMouseDown:function(e){var t;e.target!==this.face.element[0]?(t=this._isHorizontal()?e.offsetX:e.offsetY,t/=this._getScale(),this.options.position=BI.clamp(t-.5*this._getFaceSize()/this._getScale(),0,this.options.contentSize-this.options.size),this._populate(),this.fireEvent(BI.GridTableScrollbar.EVENT_SCROLL,this.options.position)):this._mouseMoveTracker.captureMouseMoves(e);try{this.element[0].focus()}catch(e){}},_onMouseMove:function(e,t){e=this._isHorizontal()?e:t;e/=this._getScale(),this.options.position=BI.clamp(this.options.position+e,0,this.options.contentSize-this.options.size),this.isDragging=this._mouseMoveTracker.isDragging(),this._populate(),this.fireEvent(BI.GridTableScrollbar.EVENT_SCROLL,this.options.position)},_onMouseMoveEnd:function(e){this._mouseMoveTracker.releaseMouseMoves(),!0===this.isDragging&&(this.isDragging=!1,this._populate())},_onKeyDown:function(e){var t=9,n=32,r=33,i=34,o=36,a=37,s=38,l=39,c=40,u=e.keyCode;if(u!==t){var h=40,d=0;if(this._isHorizontal())switch(u){case o:d=-1,h=this.options.contentSize;break;case a:d=-1;break;case l:d=1;break;default:return}if(!this._isHorizontal())switch(u){case n:d=e.shiftKey?-1:1;break;case o:d=-1,h=this.options.contentSize;break;case s:d=-1;break;case c:d=1;break;case r:d=-1,h=this.options.size;break;case i:d=1,h=this.options.size;break;default:return}this.options.position=BI.clamp(this.options.position+h*d,0,this.options.contentSize-this.options.size),e.preventDefault(),this._populate(),this.fireEvent(BI.GridTableScrollbar.EVENT_SCROLL,this.options.position)}},_populate:function(){var e,t,n,r,i,o=this.options;o.size<1||o.contentSize<=o.size?this.setVisible(!1):(this.setVisible(!0),e=o.size,t=this._isHorizontal(),i=this.focused||this.isDragging,n=this._getFaceSize(),r=o.isOpaque,this.element[!0===r?"addClass":"removeClass"]("public-scrollbar-main-opaque"),this.element[!0===i?"addClass":"removeClass"]("public-scrollbar-main-active"),this.face.element[!0===i?"addClass":"removeClass"]("public-scrollbar-face-active"),r=o.position*this._getScale()+this._const.FACE_MARGIN,i=this.contextLayout.attr("items"),t?(this.setWidth(e),this.face.setWidth(n-this._const.FACE_MARGIN_2),i[0].left=r,i[0].top=0):(this.setHeight(e),this.face.setHeight(n-this._const.FACE_MARGIN_2),i[0].left=0,i[0].top=r),this.contextLayout.attr("items",i),this.contextLayout.resize())},setContentSize:function(e){this.options.contentSize=e},setPosition:function(e){this.options.position=e},setSize:function(e){this.options.size=e},populate:function(){this._populate()}}),BI.GridTableScrollbar.SIZE=10,BI.GridTableScrollbar.EVENT_SCROLL="EVENT_SCROLL",BI.shortcut("bi.grid_table_scrollbar",BI.GridTableScrollbar),BI.GridTableHorizontalScrollbar=BI.inherit(BI.Widget,{_const:{FACE_MARGIN:4,FACE_MARGIN_2:8,FACE_SIZE_MIN:30,KEYBOARD_SCROLL_AMOUNT:40},_defaultConfig:function(){return BI.extend(BI.GridTableHorizontalScrollbar.superclass._defaultConfig.apply(this,arguments),{attributes:{tabIndex:0},contentSize:0,position:0,size:0})},_init:function(){BI.GridTableHorizontalScrollbar.superclass._init.apply(this,arguments);var e=this,t=this.options;this.scrollbar=BI.createWidget({type:"bi.grid_table_scrollbar",orientation:"horizontal",isOpaque:!0,position:t.position,contentSize:t.contentSize,size:t.size}),this.scrollbar.on(BI.GridTableScrollbar.EVENT_SCROLL,function(){e.fireEvent(BI.GridTableHorizontalScrollbar.EVENT_SCROLL,arguments)}),BI.createWidget({type:"bi.absolute",cls:"horizontal-scrollbar",element:this,width:t.size,height:BI.GridTableScrollbar.SIZE,items:[{el:{type:"bi.absolute",scrollable:!1,height:BI.GridTableScrollbar.SIZE,items:[{el:this.scrollbar,left:0,top:0}]},top:0,left:0,right:0}]})},setContentSize:function(e){this.options.contentSize=e,this.scrollbar.setContentSize(e)},setPosition:function(e){this.options.position=e,this.scrollbar.setPosition(e)},setSize:function(e){this.setWidth(e),this.options.size=e,this.scrollbar.setSize(e)},populate:function(){this.scrollbar.populate();var e=this.options;e.size<1||e.contentSize<=e.size?this.setVisible(!1):this.setVisible(!0)}}),BI.GridTableHorizontalScrollbar.EVENT_SCROLL="EVENT_SCROLL",BI.shortcut("bi.grid_table_horizontal_scrollbar",BI.GridTableHorizontalScrollbar)},function(e,t,n){"use strict";var h,c;h=function h(e,t,n,r){for(var i=0,o=1,a=0,s=BI.Constants.getConstant("bi.constant.char.widths"),l=0,c=e.length;l<c;l++){var u=e.charCodeAt(l);if(13===u||10===u)i=0,o++;else if(n<(i+=a=32<=u&&u<=126?s[u]*t:t)&&(i=a,o++),o===r)break}return o},c=function c(e,t,n,r,i,o,a){var s=Math.ceil((a-i)/r),e=h(e||"",t,n,s);return Math.min(Math.max(e*r+i,o),a)},BI.AutoHeightGridTable=BI.inherit(BI.GridTable,{_defaultConfig:function(){return BI.extend(BI.AutoHeightGridTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-grid-table bi-grid-auto-height-table",isAutoHeight:!0,isHeaderAutoHeight:!0,fontSize:12,fontLineHeight:14,columnGaps:[],rowGap:1,headerFontSize:12,headerFontLineHeight:14,headerColumnGaps:[],headerRowGap:1,rowSize:0,headerRowSize:0,maxRowSize:400})},_getFreezeHeaderHeight:function(){var e=this.options;return e.isHeaderAutoHeight?!this.headerIntervalTree||(e=this.headerIntervalTree.sumUntil(e.header.length))>=this._height?0:e:BI.AutoHeightGridTable.superclass._getFreezeHeaderHeight.call(this)},_getActualItems:function(){var e=this.options;return e.isHeaderAutoHeight?this.headerIntervalTree&&this.headerIntervalTree.sumUntil(e.header.length)>=this._height?e.header.concat(e.items):e.items:BI.AutoHeightGridTable.superclass._getActualItems.call(this)},_getContentHeight:function(){var e,t=this.options;return t.isAutoHeight||t.isHeaderAutoHeight?t.isHeaderAutoHeight?t.isAutoHeight?this.headerIntervalTree?(e=this.headerIntervalTree.sumUntil(t.header.length))>=this._height?e+this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:0:(e=this.headerIntervalTree?this.headerIntervalTree.sumUntil(t.header.length):0)>=this._height?e+t.items.length*t.rowSize:t.items.length*t.rowSize:(e=this._getFreezeHeaderHeight())<=0?t.header.length*t.headerRowSize+(this.intervalTree?this.intervalTree.sumUntil(t.items.length):0):this.intervalTree?this.intervalTree.sumUntil(t.items.length):0:BI.AutoHeightGridTable.superclass._getContentHeight.call(this)},_getHeaderContentHeight:function(){var e=this.options;return e.isHeaderAutoHeight?this.headerIntervalTree?this.headerIntervalTree.sumUntil(e.header.length):0:e.header.length*e.headerRowSize},_getOneRowHeight:function(e){for(var t=this.options,n=this.options.items[e],r=0,i=this._getFreezeColLength(),o=0,a=n.length;o<a;o++){var s=n[o],l=t.columnSize[o]-(t.columnGaps[o]||0)-((BI.isFunction(s.columnGap)?s.columnGap():s.columnGap)||0)-(0===o||o===i?2:1);if((r=Math.max(r,c(s.text,t.fontSize,l,t.fontLineHeight,t.rowGap,t.rowSize,t.maxRowSize)))>=t.maxRowSize)return t.maxRowSize}return r},_getOneHeaderRowHeight:function(e){for(var t=this.options,n=this.options.header[e],r=0,i=this._getFreezeColLength(),o=0,a=n.length;o<a;o++){var s=n[o],l=t.columnSize[o]-(t.columnGaps[o]||0)-((s.cell?BI.isFunction(s.cell.columnGap)?s.cell.columnGap():s.cell.columnGap:s.columnGap)||0)-(0===o||o===i?2:1);if((r=Math.max(r,c((s.cell||s).text,t.headerFontSize,l,t.headerFontLineHeight,t.headerRowGap,t.headerRowSize,t.maxRowSize)))>=t.maxRowSize)return t.maxRowSize}return r},_getActualRowHeights:function(){var n=this,e=this.options,t=this.options.items;return this.intervalTree=BI.PrefixIntervalTree.empty(e.items.length),BI.each(t,function(e,t){n.intervalTree.set(e,n._getOneRowHeight(e))}),this.intervalTree},_getActualHeaderRowHeights:function(){var n=this,e=this.options,t=this.options.header;return this.headerIntervalTree=BI.PrefixIntervalTree.empty(e.header.length),BI.each(t,function(e,t){n.headerIntervalTree.set(e,n._getOneHeaderRowHeight(e))}),this.headerIntervalTree},_headerRowHeightGetter:function(e){return this.options.isHeaderAutoHeight?this.headerIntervalTree?this.headerIntervalTree.get(e):this.options.headerRowSize:BI.AutoHeightGridTable.superclass._headerRowHeightGetter.call(this,e)},_rowHeightGetter:function(e){return this.options.isAutoHeight?this.intervalTree?this.intervalTree.get(e):this.options.rowSize:BI.AutoHeightGridTable.superclass._rowHeightGetter.call(this,e)},_digest:function(){var n=this.options;if(!n.isAutoHeight&&!n.isHeaderAutoHeight)return BI.AutoHeightGridTable.superclass._digest.call(this);n.isHeaderAutoHeight&&this._getActualHeaderRowHeights(),n.isAutoHeight&&this._getActualRowHeights();var e=this._getFreezeColLength(),r=0,i=0,t=(BI.each(n.columnSize,function(e,t){!0===n.isNeedFreeze&&n.freezeCols.includes(e)?r+=t:i+=t,e,0}),0<n.items.length?this._getContentHeight()/n.items.length:0),o=this._getHeaderContentHeight()/n.header.length;this.topLeftGrid.setEstimatedColumnSize(0<e?r/e:0),this.topLeftGrid.setEstimatedRowSize(o),this.topRightGrid.setEstimatedColumnSize(0<n.columnSize.length-e?i/(n.columnSize.length-e):0),this.topRightGrid.setEstimatedRowSize(o),this.bottomLeftGrid.setEstimatedColumnSize(0<e?r/e:0),this.bottomLeftGrid.setEstimatedRowSize(t),this.bottomRightGrid.setEstimatedColumnSize(0<n.columnSize.length-e?i/(n.columnSize.length-e):0),this.bottomRightGrid.setEstimatedRowSize(t),this.topLeftGrid.setColumnCount(e),this.topRightGrid.setColumnCount(n.columnSize.length-e),this.bottomLeftGrid.setColumnCount(e),this.bottomRightGrid.setColumnCount(n.columnSize.length-e)},getFirstColumnHeaderRowSize:function(){var t=this,e=this.options;return e.isHeaderAutoHeight?(e=e.header,BI.map(e,function(e){return t.headerIntervalTree&&t.headerIntervalTree.get(e)})):BI.AutoHeightGridTable.superclass.getFirstColumnHeaderRowSize.call(this)},getFirstColumnRowSize:function(){var t=this,e=this.options;return e.isAutoHeight?(e=e.items,BI.map(e,function(e){return t.intervalTree&&t.intervalTree.get(e)})):BI.AutoHeightGridTable.superclass.getFirstColumnRowSize.call(this)}}),BI.shortcut("bi.grid_auto_height_table",BI.AutoHeightGridTable)},function(e,t,n){"use strict";BI.TableHeaderCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.TableHeaderCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-table-header-cell",text:""})},_init:function(){BI.TableHeaderCell.superclass._init.apply(this,arguments);var e=this.options;BI.createWidget({type:"bi.label",element:this,textAlign:e.textAlign||"center",height:this.options.height,text:this.options.text,value:this.options.value,lgap:e.lgap,rgap:e.rgap,hgap:e.hgap||5})}}),BI.shortcut("bi.table_header_cell",BI.TableHeaderCell)},function(e,t,n){"use strict";BI.Table=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.Table.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-table",logic:{dynamic:!1},isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:function(e,t){return BI.isEqual(e,t)},columnSize:[],headerRowSize:25,footerRowSize:25,rowSize:25,bordered:!0,stripe:!1,hover:!1,regionColumnSize:!1,header:[],footer:!1,items:[],el:{type:"bi.vertical_fill"}})},_calculateWidth:function(e){return e&&"0"!==e?1.01<(e=(e=BI.parseFloat(e))<0?0:e)?e:100*e+"%":""},_calculateHeight:function(e){return e||""},_isColumnSizeValid:function(e,n){return!BI.some(e,function(e,t){return!(n&&!n.includes(e))&&(!t||!BI.isNumeric(t)||void 0)})},_isRightFreeze:function(){return BI.isNotEmptyArray(this.options.freezeCols)&&0!==BI.first(this.options.freezeCols)},_createTopLeft:function(){var n,r,i=this.options,e=this._isRightFreeze(),t=(this.topLeftColGroupTds={},this.topLeftBodyTds={},this.topLeftBodyItems={},this._table()),o=this._createColGroup(this.columnLeft,this.topLeftColGroupTds),a=this.topLeftBody=this._body();return a.element.append(this._createHeaderCells(this.topLeftItems,this.columnLeft,this.mergeLeft,this.topLeftBodyTds,this.topLeftBodyItems)),this.topLeftContainer=BI.createWidget({type:"bi.default",element:t,width:this._calculateWidth(n),items:[o,a]}),e&&(r=!(n=0),BI.each(i.columnSize,function(e,t){BI.isNumeric(t)||(r=!1),i.freezeCols.includes(e)||(n+=t)}),r&&BI.isNumeric(n)&&1<n&&(n=BI.parseFloat(n))),this.topLeftContainer},_createTopRight:function(){var n,r,i=this.options,e=this._isRightFreeze(),t=(this.topRightColGroupTds={},this.topRightBodyTds={},this.topRightBodyItems={},this._table()),o=this._createColGroup(this.columnRight,this.topRightColGroupTds),a=this.topRightBody=this._body();return a.element.append(this._createHeaderCells(this.topRightItems,this.columnRight,this.mergeRight,this.topRightBodyTds,this.topRightBodyItems,this.columnLeft.length)),this.topRightContainer=BI.createWidget({type:"bi.default",width:this._calculateWidth(n),element:t,items:[o,a]}),e||(r=!(n=0),BI.each(i.columnSize,function(e,t){BI.isNumeric(t)||(r=!1),i.freezeCols.includes(e)||(n+=t)}),r&&BI.isNumeric(n)&&1<n&&(n=BI.parseFloat(n))),this.topRightContainer},_createBottomLeft:function(){var n,r,i=this.options,e=this._isRightFreeze(),t=(this.bottomLeftColGroupTds={},this.bottomLeftBodyTds={},this.bottomLeftBodyItems={},this._table()),o=this._createColGroup(this.columnLeft,this.bottomLeftColGroupTds),a=this._createBottomLeftBody();return this.bottomLeftContainer=BI.createWidget({type:"bi.default",width:this._calculateWidth(n),element:t,items:[o,a]}),e&&(r=!(n=0),BI.each(i.columnSize,function(e,t){BI.isNumeric(t)||(r=!1),i.freezeCols.includes(e)||(n+=t)}),r&&BI.isNumeric(n)&&1<n&&(n=BI.parseFloat(n))),this.bottomLeftContainer},_createBottomLeftBody:function(){var e=this.bottomLeftBody=this._body();return e.element.append(this._createCells(this.bottomLeftItems,this.columnLeft,this.mergeLeft,this.bottomLeftBodyTds,this.bottomLeftBodyItems)),e},_createBottomRight:function(){var n,r,i=this.options,e=this._isRightFreeze(),t=(this.bottomRightColGroupTds={},this.bottomRightBodyTds={},this.bottomRightBodyItems={},this._table()),o=this._createColGroup(this.columnRight,this.bottomRightColGroupTds),a=this._createBottomRightBody();return this.bottomRightContainer=BI.createWidget({type:"bi.default",element:t,items:[o,a]}),e||(r=!(n=0),BI.each(i.columnSize,function(e,t){BI.isNumeric(t)||(r=!1),i.freezeCols.includes(e)||(n+=t)}),r&&BI.isNumeric(n)&&1<n&&(n=BI.parseFloat(n))),this.bottomRightContainer},_createBottomRightBody:function(){var e=this.bottomRightBody=this._body();return e.element.append(this._createCells(this.bottomRightItems,this.columnRight,this.mergeRight,this.bottomRightBodyTds,this.bottomRightBodyItems,this.columnLeft.length)),e},_createFreezeTable:function(){var n=this,r=this.options,i=this._isRightFreeze(),e=this._split(r.header),e=(this.topLeftItems=e.left,this.topRightItems=e.right,e=this._split(r.items),this.bottomLeftItems=e.left,this.bottomRightItems=e.right,this.columnLeft=[],this.columnRight=[],BI.each(r.columnSize,function(e,t){(r.freezeCols.includes(e)?n[i?"columnRight":"columnLeft"]:n[i?"columnLeft":"columnRight"]).push(t)}),this.mergeLeft=[],this.mergeRight=[],BI.each(r.mergeCols,function(e,t){(r.freezeCols.includes(t)?n[i?"mergeRight":"mergeLeft"]:n[i?"mergeLeft":"mergeRight"]).push(t)}),this._createTopLeft()),t=this._createTopRight(),o=this._createBottomLeft(),a=this._createBottomRight(),e=(this.scrollTopLeft=BI.createWidget({type:"bi.adaptive",cls:"scroll-top-left",width:"100%",height:"100%",scrollable:!1,items:[e]}),this.scrollTopRight=BI.createWidget({type:"bi.adaptive",cls:"scroll-top-right",width:"100%",height:"100%",scrollable:!1,items:[t]}),this.scrollBottomLeft=BI.createWidget({type:"bi.adaptive",cls:"scroll-bottom-left",width:"100%",height:"100%",scrollable:i||null,scrollx:!i,items:[o]}),this.scrollBottomRight=BI.createWidget({type:"bi.adaptive",cls:"scroll-bottom-right",width:"100%",height:"100%",scrollable:!i||null,scrollx:i,items:[a]}),this.topLeft=BI.createWidget({type:"bi.adaptive",cls:"top-left",scrollable:!1,items:[this.scrollTopLeft]}),this.topRight=BI.createWidget({type:"bi.adaptive",cls:"top-right",scrollable:!1,items:[this.scrollTopRight]}),this.bottomLeft=BI.createWidget({type:"bi.adaptive",cls:"bottom-left",scrollable:!1,items:[this.scrollBottomLeft]}),this.bottomRight=BI.createWidget({type:"bi.adaptive",cls:"bottom-right",scrollable:!1,items:[this.scrollBottomRight]}),r.header.length,r.headerRowSize||r.rowSize,BI.sum(r.freezeCols,function(e,t){return r.columnSize[t]})),t=(this._resize=function(){n.scrollBottomLeft.element.is(":visible")&&(n.scrollBottomLeft.element.css({"overflow-x":"auto"}),n.scrollBottomRight.element.css({"overflow-x":"auto"}),(i?n.scrollBottomLeft:n.scrollBottomRight).element.css({"overflow-y":"auto"}),(n.scrollBottomLeft.element.hasHorizonScroll()||n.scrollBottomRight.element.hasHorizonScroll())&&(n.scrollBottomLeft.element.css("overflow-x","scroll"),n.scrollBottomRight.element.css("overflow-x","scroll")),n.scrollBottomLeft.element.hasVerticalScroll()?n.scrollTopLeft.element.css("overflow-y","scroll"):n.scrollTopLeft.element.css("overflow-y","hidden"),n.scrollTopLeft.element[0].scrollLeft=n.scrollBottomLeft.element[0].scrollLeft,n.scrollBottomLeft.element[0].scrollTop=n.scrollBottomRight.element[0].scrollTop),n.scrollBottomRight.element.hasVerticalScroll()?n.scrollTopRight.element.css("overflow-y","scroll"):n.scrollTopRight.element.css("overflow-y","hidden"),n.scrollTopRight.element[0].scrollLeft=n.scrollBottomRight.element[0].scrollLeft},r.regionColumnSize&&r.regionColumnSize.concat(["fill"]));0===r.freezeCols.length?(t=["fill","fill"],i?(this.topRight=null,this.bottomRight=null):(this.topLeft=null,this.bottomLeft=null)):r.freezeCols.length>=r.columnSize.length&&(t=["fill","fill"],i?(this.topLeft=null,this.bottomLeft=null):(this.topRight=null,this.bottomRight=null)),BI.createWidget(r.el,{element:this,cls:"".concat(r.bordered?"bordered":""," ").concat(r.stripe?"stripe":""," ").concat(r.hover?"hover":""),rowSize:["","fill"],items:[{type:"bi.horizontal_fill",columnSize:t||(i?["fill",e]:[e,"fill"]),items:[this.topLeft,this.topRight]},{type:"bi.horizontal_fill",columnSize:t||(i?["fill",e]:[e,"fill"]),items:[this.bottomLeft,this.bottomRight]}]}),this._initFreezeScroll(),BI.ResizeDetector.addResizeListener(this,function(){n._resize(),n.fireEvent(BI.Table.EVENT_TABLE_RESIZE)})},mounted:function(){this._resize&&this._resize(),BI.isChrome()&&BI.isWindows()&&!BI.isEdge()||BI.createWidget({type:"bi.absolute",element:this,items:[{el:{type:"bi.default",cls:"bi-table-fix-scroll"},top:0,right:0,bottom:0,left:0}]}),this.fireEvent(BI.Table.EVENT_TABLE_AFTER_INIT)},_initFreezeScroll:function(){var i=this;this.options;function e(t,n,r){t.scroll(function(e){null!=r&&r.scrollTop(t.scrollTop()),n.scrollLeft(t.scrollLeft()),i.fireEvent(BI.Table.EVENT_TABLE_SCROLL)})}e(this.scrollBottomRight.element,this.scrollTopRight.element,this.scrollBottomLeft.element),e(this.scrollBottomLeft.element,this.scrollTopLeft.element)},resize:function(){this._resize&&this._resize()},_createCells:function(e,r,u,h,d,p,t,n){var f=this,m=this.options,g={},b={},y={},v={},_={},I=(r=r||m.columnSize,u=u||m.mergeCols,h=h||{},d=d||{},p=p||0,t=t||m.rowSize,document.createDocumentFragment());return BI.each(e,function(i,o){var a=BI.$("<tr>").addClass(0==(1&i)?"odd":"even").height(t);function s(e,t){var n=1+(0|(g[t].attr("rowspan")||1));g[t].attr("rowspan",n),BI.pushDistinct(g[t].__mergeRows,e),h[e][t]=g[t],d[e][t]=v[t]}function l(e,t){r[t];var n=1+(0|(b[e].attr("colspan")||1));b[e].attr("colspan",n),BI.pushDistinct(b[e].__mergeCols,t),h[e][t]=b[e],d[e][t]=y[e]}function c(e,t){var n=BI.$("<td>").css({position:"relative"}).addClass(0==(1&t)?"odd-col":"even-col").addClass(0===e?"first-row":"").addClass(0===t?"first-col":"").addClass(t===o.length-1?"last-col":""),r=BI.createWidget(_[e][t],{type:"bi.table_cell",_row:e,_col:t+p});f.addWidget(r.getName(),r),r._mount(),n.append(r.element),a.append(n),g[t]=n,g[t].__mergeRows=[e],v[t]=r,b[e]=n,b[e].__mergeCols=[t],y[e]=r,h[e][t]=n,d[e][t]=r}BI.each(o,function(e,t){var n,r;_[i]||(_[i]={}),h[i]||(h[i]={}),d[i]||(d[i]={}),_[i][e]=t,m.isNeedMerge&&u.includes(e)?0===i&&0===e?c(0,0):0===e&&0<i?!0===(n=m.mergeRule(_[i][e],_[i-1][e]))?(s(i,e),b[i]=g[e],y[i]=v[e]):c(i,e):0===i&&0<e?!0===(r=m.mergeRule(_[i][e],_[i][e-1]))?(l(i,e),g[e]=b[i],v[e]=y[i]):c(i,e):(n=m.mergeRule(_[i][e],_[i-1][e]),(r=m.mergeRule(_[i][e],_[i][e-1]))&&n||(r&&l(i,e),n&&s(i,e),r||n||c(i,e))):c(i,e)}),I.appendChild(a[0])}),I},_createColGroupCells:function(e,n){var r=this,t=this.options,i=(e=e||t.columnSize,n=n||{},document.createDocumentFragment());return BI.each(e,function(e,t){t=r._calculateWidth(t),t=BI.$("<col>").css("width",t);n[e]=t,i.appendChild(t[0])}),i},_createHeaderCells:function(e,t,n,r,i,o){var a=this.options;return o=o||0,this._createCells(e,t,BI.range(a.columnSize.length),r,i,o,a.headerRowSize||a.rowSize,!0)},_createFooterCells:function(e,t,n,r){this.options;return this._createCells(e,t,[],n,r,0)},_createColGroup:function(e,t,n){this.options;return this.colgroup=this._colgroup(),this.colgroup.element.append(this._createColGroupCells(e,t,n)),this.colgroup},_createHeader:function(){var e=this.options;if(!1!==e.header)return this.header=this._header(),this.header.element.append(this._createHeaderCells(e.header,null,null,this.headerTds,this.headerItems)),this.header},_createFooter:function(e,t,n){var r=this.options;if(!1!==r.footer)return this.footer=this._footer(),this.footer.element.append(this._createFooterCells(r.footer,null,this.footerTds,this.footerItems)),this.footer},_createBody:function(){var e=this.options;return this.body=this._body(),this.body.element.append(this._createCells(e.items,null,null,this.bodyTds,this.bodyItems)),this.body},_createNormalTable:function(){var e=this.options,t=this._table(),n=(this.colgroupTds={},this.headerTds={},this.footerTds={},this.bodyTds={},this.headerItems={},this.footerItems={},this.bodyItems={},this._createColGroup(null,this.colgroupTds)),r=this._createHeader(),i=this._createFooter(),o=this._createBody();this.tableContainer=BI.createWidget({type:"bi.default",element:t,width:this._calculateWidth(void 0),items:[n,r,i,o]}),this._isColumnSizeValid(e.columnSize)&&(t=BI.sum(e.columnSize)||undefined,t=this._calculateWidth(t)),this.scrollBottomRight=BI.createWidget({type:"bi.adaptive",width:"100%",height:"100%",cls:"scroll-bottom-right",scrollable:!0,items:[this.tableContainer]}),BI.createWidget({type:"bi.adaptive",cls:"".concat(e.bordered?"bordered":""," ").concat(e.stripe?"stripe":"",' "bottom-right"'),element:this,scrollable:!1,items:[this.scrollBottomRight]}),this._initNormalScroll()},_initNormalScroll:function(){var t=this;this.scrollBottomRight.element.scroll(function(e){t.fireEvent(BI.Table.EVENT_TABLE_SCROLL)})},_split:function(e){var r=this.options,i=[],o=[],a=this._isRightFreeze();return BI.each(e,function(n,e){i.push([]),o.push([]),BI.each(e,function(e,t){(r.freezeCols.includes(e)?a?o:i:a?i:o)[n].push(t)})}),{left:i,right:o}},_table:function(){return BI.createWidget({type:"bi.layout",tagName:"table",cls:"table-view-table",attribute:{cellspacing:0,cellpadding:0}})},_header:function(){return BI.createWidget({type:"bi.layout",cls:"table-view-header",tagName:"thead"})},_footer:function(){return BI.createWidget({type:"bi.layout",cls:"table-view-footer",tagName:"tfoot"})},_body:function(){return BI.createWidget({type:"bi.layout",tagName:"tbody",cls:"table-view-body"})},_colgroup:function(){return BI.createWidget({type:"bi.layout",tagName:"colgroup"})},render:function(){(0<this.options.items.length||0<this.options.header.length)&&this.populate(this.options.items)},setColumnSize:function(e){var n,i,o,a,s,l,c,r,u,h,d,p=this,f=this.options,m=this._isRightFreeze();f.columnSize=e||[],f.isNeedFreeze?(n=[],i=[],BI.each(f.columnSize,function(e,t){(f.freezeCols.includes(e)?m?i:n:m?n:i).push(t)}),a=1,s=2,l=3,(c=function c(e){var t,r;switch(e){case o:t=p.topLeftColGroupTds,p.topLeftBodyTds,p.topLeftBodyItems,r=n;break;case a:t=p.topRightColGroupTds,p.topRightBodyTds,p.topRightBodyItems,r=i;break;case s:t=p.bottomLeftColGroupTds,p.bottomLeftBodyTds,p.bottomLeftBodyItems,r=n;break;case l:t=p.bottomRightColGroupTds,p.bottomRightBodyTds,p.bottomRightBodyItems,r=i}BI.each(t,function(e,t){var n=0|t.attr("width");""!==r[e]&&n!==r[e]&&(n=p._calculateWidth(r[e]),t.attr("width",n).css("width",n))})})(o=0),c(a),c(s),c(l),d=h=!(u=r=0),this.columnLeft=[],this.columnRight=[],BI.each(f.columnSize,function(e,t){(f.freezeCols.includes(e)?(BI.isNumeric(t)||(m?d=!1:h=!1),r+=t,p[m?"columnRight":"columnLeft"]):(BI.isNumeric(t)||(m?h=!1:d=!1),u+=t,p[m?"columnLeft":"columnRight"])).push(t)}),h&&(r=this._calculateWidth(r),BI.isNumeric(r)&&(r=BI.parseFloat(r))),d&&(u=this._calculateWidth(u),BI.isNumeric(u)&&(u=BI.parseFloat(u))),h||d&&m?(this.topLeftContainer.element.width(m?u:r),this.bottomLeftContainer.element.width(m?u:r)):(this.topLeftContainer.element.width(""),this.bottomLeftContainer.element.width("")),d||h&&m?(this.topRightContainer.element.width(m?r:u),this.bottomRightContainer.element.width(m?r:u)):(this.topRightContainer.element.width(""),this.bottomRightContainer.element.width("")),this.scrollTopLeft.element[0].scrollLeft=this.scrollBottomLeft.element[0].scrollLeft,this.scrollTopRight.element[0].scrollLeft=this.scrollBottomRight.element[0].scrollLeft):(BI.each(this.colgroupTds,function(e,t){var n=0|t.attr("width");""!==f.columnSize[e]&&n!==f.columnSize[e]&&(n=p._calculateWidth(f.columnSize[e]),t.attr("width",n).css("width",n))}),this._isColumnSizeValid(f.columnSize)?1.05<(e=this._calculateWidth(BI.sum(f.columnSize)))&&this.tableContainer.element.width(e):this.tableContainer.element.width(""))},getColumnSize:function(){return this.options.columnSize},getCalculateColumnSize:function(){var e=this.options,n=[];if(!0===e.isNeedFreeze){if(0<BI.size(this.bottomLeftBodyTds)||0<BI.size(this.bottomRightBodyTds))return BI.any(this.bottomLeftBodyTds,function(e,t){if(!BI.any(t,function(e,t){if(1<t.__mergeCols.length)return!0}))return BI.each(t,function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),!0})||BI.each(this.bottomLeftBodyTds[0],function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),BI.any(this.bottomRightBodyTds,function(e,t){if(!BI.any(t,function(e,t){if(1<t.__mergeCols.length)return!0}))return BI.each(t,function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),!0})||BI.each(this.bottomRightBodyTds[0],function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),n;BI.any(this.topLeftBodyTds,function(e,t){if(!BI.any(t,function(e,t){if(1<t.__mergeCols.length)return!0}))return BI.each(t,function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),!0})||BI.each(this.topLeftBodyTds[BI.size(this.topLeftBodyTds)-1],function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),BI.any(this.topRightBodyTds,function(e,t){if(!BI.any(t,function(e,t){if(1<t.__mergeCols.length)return!0}))return BI.each(t,function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)}),!0})||BI.each(this.topRightBodyTds[BI.size(this.topRightBodyTds)-1],function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)})}else BI.each(this.headerTds[BI.size(this.headerTds)-1],function(e,t){t=t.width()/t.__mergeCols.length;n.push(t)});return n},setHeaderColumnSize:function(n){var r,i,o,a,s,l,c,e,u=this,h=this.options,d=this._isRightFreeze();h.isNeedFreeze?(r=[],i=[],BI.each(n,function(e,t){(h.freezeCols.includes(e)?d?i:r:d?r:i).push(t)}),a=1,(s=function s(e){var t,n;switch(e){case o:t=u.topLeftColGroupTds,u.topLeftBodyTds,u.topLeftBodyItems,n=r;break;case a:t=u.topRightColGroupTds,u.topRightBodyTds,u.topRightBodyItems,n=i}BI.each(t,function(e,t){(0|t.attr("width"))!==n[e]&&(e=u._calculateWidth(n[e]),t.attr("width",e).css("width",e))})})(o=0),s(a),c=l=0,BI.each(n,function(e,t){h.freezeCols.includes(e)?l+=t:c+=t}),l=this._calculateWidth(l),c=this._calculateWidth(c),BI.isNumeric(l)&&(l=BI.parseFloat(l)),BI.isNumeric(c)&&(c=BI.parseFloat(c)),this.topLeftContainer.element.width(d?c:l),this.topRightContainer.element.width(d?l:c),this.scrollTopLeft.element[0].scrollLeft=this.scrollBottomLeft.element[0].scrollLeft,this.scrollTopRight.element[0].scrollLeft=this.scrollBottomRight.element[0].scrollLeft):(BI.each(this.colgroupTds,function(e,t){(0|t.attr("width"))!==n[e]&&(e=u._calculateWidth(n[e]),t.attr("width",e).css("width",e))}),e=this._calculateWidth(BI.sum(n)),this.tableContainer.element.width(e))},setRegionColumnSize:function(e){var t=this.options;t.regionColumnSize=e,0!==t.freezeCols.length&&0<t.freezeCols.length&&t.freezeCols.length<t.columnSize.length?t.isNeedFreeze&&(this.topLeft.element.css("width",e),this.bottomLeft.element.css("width",e)):t.isNeedFreeze},getRegionColumnSize:function(){return this.options.regionColumnSize},getCalculateRegionColumnSize:function(){return this.options.isNeedFreeze?[this.scrollBottomLeft.element.width(),this.scrollBottomRight.element.width()]:[this.scrollBottomRight.element.width()]},getCalculateRegionRowSize:function(){return this.options.isNeedFreeze?[this.scrollTopRight.element.height(),this.scrollBottomRight.element.height()]:[this.scrollBottomRight.element.height()]},getClientRegionColumnSize:function(){return this.options.isNeedFreeze?[this.scrollBottomLeft.element[0].clientWidth,this.scrollBottomRight.element[0].clientWidth]:[this.scrollBottomRight.element[0].clientWidth]},getClientRegionRowSize:function(){return this.options.isNeedFreeze?[this.scrollBottomLeft.element[0].clientHeight,this.scrollBottomRight.element[0].clientHeight]:[this.scrollBottomRight.element[0].clientHeight]},getScrollRegionColumnSize:function(){return this.options.isNeedFreeze?[this.scrollBottomLeft.element[0].scrollWidth,this.scrollBottomRight.element[0].scrollWidth]:[this.scrollBottomRight.element[0].scrollWidth]},getScrollRegionRowSize:function(){var e=this.options;return e.isNeedFreeze?e.freezeCols.length<e.columnSize.length?[this.scrollTopRight.element[0].scrollHeight,this.scrollBottomRight.element[0].scrollHeight]:[this.scrollTopLeft.element[0].scrollHeight,this.scrollBottomLeft.element[0].scrollHeight]:[this.scrollBottomRight.element[0].scrollHeight]},hasVerticalScroll:function(){return this.options.isNeedFreeze?this.scrollBottomRight.element.hasVerticalScroll()||this.scrollBottomLeft.element.hasVerticalScroll():this.scrollBottomRight.element.hasVerticalScroll()},setVerticalScroll:function(e){this.options.isNeedFreeze?(this.scrollBottomRight.element[0].scrollTop!==e&&(this.scrollBottomRight.element[0].scrollTop=e),this.scrollBottomLeft.element[0].scrollTop!==e&&(this.scrollBottomLeft.element[0].scrollTop=e)):this.scrollBottomRight.element[0].scrollTop!==e&&(this.scrollBottomRight.element[0].scrollTop=e)},setLeftHorizontalScroll:function(e){this.options.isNeedFreeze?(this.scrollBottomLeft.element[0].scrollLeft!==e&&(this.scrollBottomLeft.element[0].scrollLeft=e),this.scrollTopLeft.element[0].scrollLeft!==e&&(this.scrollTopLeft.element[0].scrollLeft=e)):this.scrollBottomRight.element[0].scrollLeft!==e&&(this.scrollBottomRight.element[0].scrollLeft=e)},setRightHorizontalScroll:function(e){this.options.isNeedFreeze?(this.scrollBottomRight.element[0].scrollLeft!==e&&(this.scrollBottomRight.element[0].scrollLeft=e),this.scrollTopRight.element[0].scrollLeft!==e&&(this.scrollTopRight.element[0].scrollLeft=e)):this.scrollBottomRight.element[0].scrollLeft!==e&&(this.scrollBottomRight.element[0].scrollLeft=e)},getVerticalScroll:function(){return this.options.isNeedFreeze?this.scrollBottomRight.element[0].scrollTop||this.scrollBottomLeft.element[0].scrollTop:this.scrollBottomRight.element[0].scrollTop},getLeftHorizontalScroll:function(){return(this.options.isNeedFreeze?this.scrollBottomLeft:this.scrollBottomRight).element[0].scrollLeft},getRightHorizontalScroll:function(){return this.options.isNeedFreeze,this.scrollBottomRight.element[0].scrollLeft},getColumns:function(){return this.options.isNeedFreeze?{topLeft:this.topLeftBodyItems,topRight:this.topRightBodyItems,bottomLeft:this.bottomLeftBodyItems,bottomRight:this.bottomRightBodyItems}:{header:this.headerItems,body:this.bodyItems,footer:this.footerItems}},populate:function(e,t){e&&(this.options.items=e||[],t&&(this.options.header=t),this.empty(),this.options.isNeedFreeze?this._createFreezeTable():this._createNormalTable())}}),BI.Table.EVENT_TABLE_AFTER_INIT="EVENT_TABLE_AFTER_INIT",BI.Table.EVENT_TABLE_RESIZE="EVENT_TABLE_RESIZE",BI.Table.EVENT_TABLE_SCROLL="EVENT_TABLE_SCROLL",BI.Table.EVENT_TABLE_BEFORE_COLUMN_RESIZE="EVENT_TABLE_BEFORE_COLUMN_RESIZE",BI.Table.EVENT_TABLE_COLUMN_RESIZE="EVENT_TABLE_COLUMN_RESIZE",BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE="EVENT_TABLE_AFTER_COLUMN_RESIZE",BI.Table.EVENT_TABLE_BEFORE_REGION_RESIZE="EVENT_TABLE_BEFORE_REGION_RESIZE",BI.Table.EVENT_TABLE_REGION_RESIZE="EVENT_TABLE_REGION_RESIZE",BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE="EVENT_TABLE_AFTER_REGION_RESIZE",BI.shortcut("bi.table_view",BI.Table)},function(e,t,n){"use strict";BI.ResizableTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.ResizableTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-resizable-table-cell",cell:{},minSize:30,maxSize:Number.MAX_VALUE,start:BI.emptyFn,resize:BI.emptyFn,stop:BI.emptyFn,_rowIndex:null,_columnIndex:null,_left:0,_top:0,firstRowTopLine:!0,firstColumnLeftLine:!0})},render:function(){var e=this.options;return this.cell=BI.createWidget(BI.extend({type:"bi.label"},e.cell,{width:e.width,height:e.height,_rowIndex:e._rowIndex,_columnIndex:e._columnIndex,_left:e._left,_top:e._top,firstRowTopLine:e.firstRowTopLine,firstColumnLeftLine:e.firstColumnLeftLine})),this.handler=BI.createWidget({type:"bi.absolute",cls:"resizable-table-cell-resizer-container",width:6,items:[{el:{type:"bi.layout",cls:"resizable-table-cell-resizer-knob",width:4},right:0,top:0,bottom:0}]}),[{type:"bi.vertical_adapt",columnSize:["fill"],items:[this.cell]},{type:"bi.absolute",items:[{el:this.handler,right:0,top:0,bottom:0}]}]},mounted:function(){var n=this,r=this.options,i=!1,o=0,a=0,s=r.width;function l(e){return BI.clamp(e,r.minSize,r.maxSize||Number.MAX_VALUE)}var c=new BI.MouseMoveTracker(function(e,t){c.isDragging()&&(i=!0,o=l(s+(a+=e)),n.handler.element.addClass("dragging"),r.resize(o,n))},function(){!0===i&&(o=l(o),r.stop(o),a=o=0,s=r.width||n.element.width(),i=!1),n.handler.element.removeClass("dragging"),n.handler.element.removeClass("suitable"),c.releaseMouseMoves()},_global.document);this.handler.element.on("mousedown",function(e){l(s=r.width||n.element.width()),c.captureMouseMoves(e)})},setWidth:function(e){BI.ResizableTableCell.superclass.setWidth.apply(this,arguments);var t=this.options;this.cell.setWidth(t.width)},setHeight:function(e){BI.ResizableTableCell.superclass.setHeight.apply(this,arguments);var t=this.options;this.cell.setHeight(t.height)}}),BI.shortcut("bi.resizable_table_cell",BI.ResizableTableCell)},function(e,t,n){"use strict";BI.ResizableTable=BI.inherit(BI.Widget,{props:{baseCls:"bi-resizable-table",el:{type:"bi.grid_table"},isNeedFreeze:!1,isNeedResize:!0,headerRowSize:25,rowSize:25,isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],freezeCols:[],header:[],items:[],regionColumnSize:[]},render:function(){var t=this,n=this.options;return[BI.extend({type:"bi.grid_table",width:n.width,height:n.height,headerRowSize:n.headerRowSize,rowSize:n.rowSize,columnSize:n.columnSize,isNeedFreeze:n.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:BI.bind(this._mergeRule,this),header:this._formatHeader(n.header),items:n.items,regionColumnSize:n.regionColumnSize,listeners:[{eventName:BI.Table.EVENT_TABLE_SCROLL,action:function(){t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}}]},n.el,{ref:function(e){t.table=e,n.el.ref&&n.el.ref.call(this,e)}}),{type:"bi.absolute",items:[{el:this._createResizerHandler(),left:0,top:0,bottom:0},{el:{type:"bi.layout",cls:"resizable-table-resizer",invisible:!0,width:2,ref:function(e){t.resizer=e}},left:0,top:0}]}]},mounted:function(){var n=this,r=this.options,i=0,o=0,a=0,s=!1,l=(this._populate(),new BI.MouseMoveTracker(function(e,t){l.isDragging()&&(s=!0,o+=e,i=BI.clamp(a+o,30,r.width-40),n.regionResizerHandler.element.addClass("dragging"),n._setRegionResizerHandlerPosition(i-3,0))},function(){!0===s&&(r.regionColumnSize[0]=BI.clamp(i,30,(r.width||n.element.width())-40),n.table.setRegionColumnSize(r.regionColumnSize),n._populate(),n.regionResizerHandler.element.removeClass("dragging"),n.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE),s=!1),l.releaseMouseMoves()},_global.document));this.regionResizerHandler.element.on("mousedown",function(e){a=i=n._getRegionSize(),o=0,n._setResizerPosition(0,0),l.captureMouseMoves(e)})},_mergeRule:function(e,t){var n=this.options;return"bi.resizable_table_cell"===e.type&&(e=e.cell),"bi.resizable_table_cell"===t.type&&(t=t.cell),n.mergeRule(e,t)},_createResizerHandler:function(){var t=this;return{type:"bi.absolute",cls:"resizable-table-region-resizer",invisible:!0,width:6,items:[{el:{type:"bi.layout",width:2,cls:"resizable-table-region-resizer-knob"},left:2,top:0,bottom:0}],ref:function(e){t.regionResizerHandler=e}}},_setResizerPosition:function(e,t){this.resizer.element.css({left:e+"px",top:t+"px"})},_setRegionResizerHandlerPosition:function(e,t){this.regionResizerHandler.element.css({left:e+"px",top:t+"px"})},_getRegionSize:function(){var n=this.options,r=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(r||BI.each(n.freezeCols,function(e,t){r+=n.columnSize[t]}),r)},_getHeaderHeight:function(){var e=this.options,t=this.table.getFirstColumnHeaderRowSize&&this.table.getFirstColumnHeaderRowSize();return t?BI.sum(t):e.headerRowSize*e.header.length},_getItemsHeight:function(){var e=this.options;return this.table.getFirstColumnRowSize?BI.sum(this.table.getFirstColumnRowSize()):e.items.length*e.rowSize},_getRegionRowSize:function(){var e=this.options,t=this._getHeaderHeight(),n=this._getItemsHeight();return[t,Math.min((e.height||this.element.height())-t,n)]},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedFreeze?BI.clamp(e.freezeCols.length,0,e.columnSize.length):0},_getFreezeColumnSize:function(){for(var e=this.options.columnSize,t=0,n=0,r=this._getFreezeColLength();n<r;n++)t+=e[n];return t},_getResizerLeft:function(e,t){var n=this.element.offset().left;return t.element.offset().left-n},_formatHeader:function(t){var i,o,c,u=this,h=this.options;return h.isNeedResize?(i=[],o=function o(e,t,n){u.resizer.setVisible(!0);var r=u._getRegionRowSize(),r=r[0]+r[1];u.resizer.setHeight(r),u._setResizerPosition(u._getResizerLeft(e,n)+t,0)},c=function c(r,e){u.resizer.setVisible(!1);var i=h.columnSize.slice(),o=(i[r]=e,u._getFreezeColLength()),a=u._getRegionSize(),e=(h.width||u.element.width())-BI.GridTableScrollbar.SIZE-a,s=0,l=0;r<o?0<(l=a-BI.sum(i.slice(0,o)))&&(r===o-1?(s=BI.sum(i.slice(r+1)),BI.each(i,function(e,t){r<e&&(i[e]=Math.floor(t+l*t/s))}),a-=l):(s=BI.sum(i.slice(r+1,o)),BI.each(i,function(e,t){r<e&&e<o&&(i[e]=Math.floor(t+l*t/s))}))):0<(l=e-BI.sum(i.slice(o)))&&(r===BI.size(i)-1?(s=BI.sum(i.slice(0,BI.size(i)-1)),BI.each(i,function(e,t){var n=Math.floor(l*t/s);e<r&&(i[e]=t+n,e<o&&(a+=n))})):(s=BI.sum(i.slice(r+1)),BI.each(i,function(e,t){r<e&&(i[e]=Math.floor(t+l*t/s))}))),h.columnSize=i,u.setColumnSize(i),u.setRegionColumnSize([a]),u._populate(),u.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,r)},BI.each(t,function(r,e){r===t.length-1?(i[r]=[],BI.each(e,function(e,t){if(i[r][e]={type:"bi.resizable_table_cell",cell:t,suitableSize:h.minColumnSize[e],maxSize:h.maxColumnSize[e],resize:BI.bind(o,null,e),stop:BI.bind(c,null,e)},h.isNeedMerge)for(var n=r;0<n&&u._mergeRule(i[n][e],i[n-1][e]);)i[n-1][e]={type:"bi.resizable_table_cell",cell:i[n-1][e],suitableSize:h.minColumnSize[e],maxSize:h.maxColumnSize[e],resize:BI.bind(o,null,e),stop:BI.bind(c,null,e)},n--})):i.push(e)}),i):t},_populate:function(){this.options;var e=this._getRegionSize();0<e?(this.regionResizerHandler.setVisible(!0),this._setRegionResizerHandlerPosition(e-3,this._getHeaderHeight())):this.regionResizerHandler.setVisible(!1)},setWidth:function(e){BI.ResizableTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.ResizableTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},setColumnSize:function(e){this.options.columnSize=e,this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){return this.table.getFirstColumnRowSize()},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},getActualRightHorizontalScroll:function(){return this.table.getActualRightHorizontalScroll()},attr:function(){return BI.ResizableTable.superclass.attr.apply(this,arguments),this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e,t){e&&(this.options.items=e),t&&(this.options.header=t,this.options.isNeedResize&&(t=this._formatHeader(t))),this.table.populate(e,t),this._populate()}}),BI.shortcut("bi.resizable_table",BI.ResizableTable)},function(e,t,n){"use strict";BI.ColumnSizeAdaptiveTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.ColumnSizeAdaptiveTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-column-size-adaptive-table",el:{type:"bi.resizable_table"},isNeedResize:!0,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],header:[],items:[],crossHeader:[],crossItems:[]})},_init:function(){BI.ColumnSizeAdaptiveTable.superclass._init.apply(this,arguments);var t=this,n=this.options,e=this._digest();this.table=BI.createWidget(n.el,{type:"bi.resizable_table",element:this,width:n.width,height:n.height,isNeedResize:n.isNeedResize,isNeedFreeze:n.isNeedFreeze,freezeCols:e.freezeCols,isNeedMerge:n.isNeedMerge,mergeCols:n.mergeCols,mergeRule:n.mergeRule,columnSize:e.columnSize,headerRowSize:n.headerRowSize,rowSize:n.rowSize,regionColumnSize:e.regionColumnSize,header:n.header,items:n.items,crossHeader:n.crossHeader,crossItems:n.crossItems}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){t.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){n.regionColumnSize=this.getRegionColumnSize(),t._populate(),t.table.populate(),t.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(e){n.columnSize[e]=this.getColumnSize()[e],t._populate(),t.table.populate(),t.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},_getFreezeColLength:function(){var e=this.options;return!0!==e.isNeedFreeze||e.freezeCols.length===e.columnSize.length?0:BI.clamp(e.freezeCols.length,0,e.columnSize.length)},_digest:function(){var n=this.options,e=n.regionColumnSize.slice(),t=n.freezeCols.slice(),r=n.regionColumnSize[0],i=this._getFreezeColLength(),o=[],a=BI.sum(n.columnSize,function(e,t){return t||0}),s=(BI.each(n.columnSize,function(e,t){t||o.push(e)}),(n.width-BI.GridTableScrollbar.SIZE-a)/o.length),a=n.columnSize.map(function(e,t){return e||(n.minColumnSize[t]?BI.clamp(s,n.minColumnSize,n.width-BI.GridTableScrollbar.SIZE):s)}),l=((!r||r>n.width-BI.GridTableScrollbar.SIZE||r<BI.GridTableScrollbar.SIZE)&&(u=BI.sum(a,function(e,t){return e<i?t:0}),r=BI.clamp(u,0,.8*n.width)),0===i&&(r=0),t.length>=a.length&&(t=[]),0),c=0,u=(BI.each(a,function(e,t){e<i&&(l+=t),c+=t}),0<i&&l<r&&(a[i-1]+=r-l),0<i&&r<l&&(a[i-1]=r-(l-a[i-1]),a[i-1]<(n.minColumnSize[i-1]||s)&&(a[i-1]=n.minColumnSize[i-1]||s)),c);return n.isNeedFreeze&&0<i&&(u=c-l+r),0<a.length&&u<n.width-BI.GridTableScrollbar.SIZE&&(a[a.length-1]=n.width-BI.GridTableScrollbar.SIZE-r-(c-l-a[a.length-1])),e[0]=r,{freezeCols:t,columnSize:a,regionColumnSize:e}},_populate:function(){this.options;var e=this._digest();this.table.setColumnSize(e.columnSize),this.table.setRegionColumnSize(e.regionColumnSize),this.table.attr("freezeCols",e.freezeCols)},setWidth:function(e){BI.ColumnSizeAdaptiveTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.ColumnSizeAdaptiveTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e},getColumnSize:function(){return this.table.getColumnSize()},setRegionColumnSize:function(e){this.options.regionColumnSize=e},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(e,t){var n=BI.ColumnSizeAdaptiveTable.superclass.attr.apply(this,arguments);return"freezeCols"===e?n:this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e){this.options;this._populate(),this.table.populate.apply(this.table,arguments)},destroy:function(){this.table.destroy(),BI.ColumnSizeAdaptiveTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.column_size_adaptive_table",BI.ColumnSizeAdaptiveTable)},function(e,t,n){"use strict";BI.AdaptiveTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.AdaptiveTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-adaptive-table",el:{type:"bi.resizable_table"},isNeedResize:!0,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],header:[],items:[],crossHeader:[],crossItems:[]})},_init:function(){BI.AdaptiveTable.superclass._init.apply(this,arguments);var e=this,t=this.options,n=this._digest();this.table=BI.createWidget(t.el,{type:"bi.resizable_table",element:this,width:t.width,height:t.height,isNeedResize:t.isNeedResize,isNeedFreeze:t.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:t.isNeedMerge,mergeCols:t.mergeCols,mergeRule:t.mergeRule,columnSize:n.columnSize,headerRowSize:t.headerRowSize,rowSize:t.rowSize,regionColumnSize:n.regionColumnSize,header:t.header,items:t.items,crossHeader:t.crossHeader,crossItems:t.crossItems}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){e.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),e._populate(),e.table.populate(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){t.columnSize=this.getColumnSize(),t.regionColumnSize=this.getRegionColumnSize(),e._populate(),e.table.populate(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},_getFreezeColLength:function(){var e=this.options;return!0!==e.isNeedFreeze||e.freezeCols.length===e.columnSize.length?0:BI.clamp(e.freezeCols.length,0,e.columnSize.length)},_digest:function(){var e=this.options,t=e.columnSize.slice(),n=e.regionColumnSize.slice(),r=e.freezeCols.slice(),i=e.regionColumnSize[0],o=this._getFreezeColLength(),a=((!i||i>e.width-BI.GridTableScrollbar.SIZE||i<BI.GridTableScrollbar.SIZE)&&(l=BI.sum(t,function(e,t){return e<o?t:0}),i=BI.clamp(l,.2*e.width,.8*e.width)),0===o&&(i=0),r.length>=t.length&&(r=[]),BI.isNumber(t[0])||(t=e.minColumnSize.slice()),0),s=0,l=(BI.each(t,function(e,t){e<o&&(a+=t),s+=t}),0<o&&a<i&&(t[o-1]+=i-a),s);return e.isNeedFreeze&&0<o&&(l=s-a+i),0<t.length&&l<e.width-BI.GridTableScrollbar.SIZE&&(t[t.length-1]=e.width-BI.GridTableScrollbar.SIZE-i-(s-a-t[t.length-1])),n[0]=i,{freezeCols:r,columnSize:t,regionColumnSize:n}},_populate:function(){var e=this.options,t=this._digest();e.regionColumnSize=t.regionColumnSize,e.columnSize=t.columnSize,this.table.setColumnSize(t.columnSize),this.table.setRegionColumnSize(t.regionColumnSize),this.table.attr("freezeCols",t.freezeCols)},setWidth:function(e){BI.AdaptiveTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.AdaptiveTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e},getColumnSize:function(){return this.table.getColumnSize()},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){return this.table.getFirstColumnRowSize()},setRegionColumnSize:function(e){this.options.regionColumnSize=e},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(e,t){var n=BI.AdaptiveTable.superclass.attr.apply(this,arguments);return"freezeCols"===e?n:this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e){this.options;this._populate(),this.table.populate.apply(this.table,arguments)},destroy:function(){this.table.destroy(),BI.AdaptiveTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.adaptive_table",BI.AdaptiveTable)},function(e,t,n){"use strict";BI.DynamicSummaryLayerTreeTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.DynamicSummaryLayerTreeTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-dynamic-summary-layer-tree-table",el:{type:"bi.resizable_table"},isNeedResize:!0,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,footerRowSize:25,rowSize:25,regionColumnSize:[],rowHeaderCreator:null,headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,header:[],footer:!1,items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right"})},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},_createHeader:function(e){var t=this.options,n=t.header||[],r=t.crossHeader||[],e=BI.isEmpty(n)?BI.TableTree.formatCrossItems4Special(t.crossItems,e,t.headerCellStyleGetter,{sumPosition:"right"===this.options.colPosition,summaryText:t.summaryText}):BI.TableTree.formatCrossItems(t.crossItems,e,t.headerCellStyleGetter,{sumPosition:"right"===this.options.colPosition,summaryText:t.summaryText}),i=[],e=(BI.each(e,function(e,t){e=[r[e]];i.push(e.concat(t||[]))}),BI.isFunction(t.rowHeaderCreator)?t.rowHeaderCreator():t.rowHeaderCreator);return n&&0<n.length&&(n=this._formatColumns(n),this._getHDeep()<=0?n.unshift(e||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter}):n[0]=e||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter},i.push(n)),i},_formatItems:function(e,t,n){var r=this.options,i=[];return BI.each(e,function(e,t){var n;BI.each(t.children,function(e,t){!function r(e,n){e.type||(e.type="bi.layer_tree_table_cell"),e.layer=n;var t=[e];0<(t=t.concat(e.values||[])).length&&i.push(t),BI.isNotEmptyArray(e.children)&&BI.each(e.children,function(e,t){r(t,n+1)})}(t,0)}),BI.isArray(t.values)&&(n=[{type:"bi.table_style_cell",text:r.summaryText,title:r.summaryText,styleGetter:function(){return r.summaryCellStyleGetter(!0,BI.get(t,["children",0,"dId"]))},_store:r.tableStyleCellStoreGetter}].concat(t.values),"bottom"===r.rowPosition?i.push(n):i.unshift(n))}),BI.DynamicSummaryTreeTable.formatSummaryItems(i,t,r.crossItems,1)},_formatColumns:function(e,t){return BI.isNotEmptyArray(e)?(t=t||this._getHDeep(),e.slice(Math.max(0,t-1))):e},_formatFreezeCols:function(){return 0<this.options.freezeCols.length?[0]:[]},_formatColumnSize:function(e,n){var r;return e.length<=0?[]:(r=[0],n=n||this._getHDeep(),BI.each(e,function(e,t){e<n?r[0]+=t:r.push(t)}),r)},_recomputeColumnSize:function(){var e=this.options,t=(e.regionColumnSize=this.table.getRegionColumnSize(),this.table.getColumnSize().slice());if(1<e.freezeCols.length)for(var n=0;n<e.freezeCols.length-1;n++)t.splice(1,0,0);e.columnSize=t},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep(),n=this._createHeader(n),n=this._formatItems(e.items,n,t),r=e.columnSize.slice(),i=e.minColumnSize.slice(),e=e.maxColumnSize.slice();return BI.removeAt(r,n.deletedCols),BI.removeAt(i,n.deletedCols),BI.removeAt(e,n.deletedCols),this.header=n.header,this.items=n.items,{header:n.header,items:n.items,columnSize:this._formatColumnSize(r,t),minColumnSize:this._formatColumns(i,t),maxColumnSize:this._formatColumns(e,t),freezeCols:this._formatFreezeCols()}},_init:function(){BI.DynamicSummaryLayerTreeTable.superclass._init.apply(this,arguments);var e=this,t=this.options,n=this._digest();this.table=BI.createWidget(t.el,{type:"bi.resizable_table",element:this,width:t.width,height:t.height,isNeedResize:t.isNeedResize,isNeedFreeze:t.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:t.isNeedMerge,mergeCols:[],mergeRule:t.mergeRule,columnSize:n.columnSize,minColumnSize:n.minColumnSize,maxColumnSize:n.maxColumnSize,headerRowSize:t.headerRowSize,rowSize:t.rowSize,regionColumnSize:t.regionColumnSize,header:n.header,items:n.items}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){e.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){e._recomputeColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){e._recomputeColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},setWidth:function(e){BI.DynamicSummaryLayerTreeTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.DynamicSummaryLayerTreeTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e},getColumnSize:function(){return this.options.columnSize},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){var n=this.table.getFirstColumnRowSize(),r=[];return BI.each(this.items,function(e,t){0<t[0].layer?r[r.length-1]+=n[e]:r.push(n[e])}),r},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(e,t){switch(BI.DynamicSummaryLayerTreeTable.superclass.attr.apply(this,arguments),e){case"columnSize":case"minColumnSize":case"maxColumnSize":case"freezeCols":case"mergeCols":return}return this.table.attr.apply(this.table,[e,t])},restore:function(){this.table.restore()},populate:function(e,t,n,r){var i=this.options,e=(e&&(i.items=e),t&&(i.header=t),n&&(i.crossItems=n),r&&(i.crossHeader=r),this._digest());this.table.setColumnSize(e.columnSize),this.table.attr("minColumnSize",e.minColumnSize),this.table.attr("maxColumnSize",e.maxColumnSize),this.table.attr("freezeCols",e.freezeCols),this.table.populate(e.items,e.header)},destroy:function(){this.table.destroy(),BI.DynamicSummaryLayerTreeTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.dynamic_summary_layer_tree_table",BI.DynamicSummaryLayerTreeTable)},function(e,t,n){"use strict";BI.DynamicSummaryTreeTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.DynamicSummaryTreeTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-dynamic-summary-tree-table",el:{type:"bi.resizable_table"},isNeedResize:!0,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,isNeedMergeCol:!0,isNeedMergeRow:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,footerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,summaryCellCreator:undefined,header:[],footer:!1,items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1})},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},_init:function(){BI.DynamicSummaryTreeTable.superclass._init.apply(this,arguments);var n=this,r=this.options,e=this._digest();this.table=BI.createWidget(r.el,{type:"bi.resizable_table",element:this,width:r.width,height:r.height,isNeedResize:r.isNeedResize,isNeedFreeze:r.isNeedFreeze,freezeCols:r.freezeCols,isNeedMerge:r.isNeedMerge,mergeCols:r.mergeCols,mergeRule:r.mergeRule,columnSize:r.columnSize,minColumnSize:r.minColumnSize,maxColumnSize:r.maxColumnSize,headerRowSize:r.headerRowSize,rowSize:r.rowSize,regionColumnSize:r.regionColumnSize,header:e.header,items:e.items}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){n.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){r.regionColumnSize=this.getRegionColumnSize();var e=this.getColumnSize(),t=r.columnSize.length-e.length;r.columnSize=e.slice(),r.columnSize=r.columnSize.concat(BI.makeArray(t,0)),n.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){r.regionColumnSize=this.getRegionColumnSize();var e=this.getColumnSize(),t=r.columnSize.length-e.length;r.columnSize=e.slice(),r.columnSize=r.columnSize.concat(BI.makeArray(t,0)),n.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep(),n=BI.TableTree.formatHeader(e.header,e.crossHeader,e.crossItems,t,n,e.headerCellStyleGetter,{sumPosition:"right"===e.colPosition,summaryText:e.summaryText}),r=BI.DynamicSummaryTreeTable.formatHorizontalItems(e.items,t,!1,e.summaryCellStyleGetter,{sumPosition:"bottom"===e.rowPosition,summaryText:e.summaryText,isNeedMergeRow:e.isNeedMergeRow,summaryCellCreator:e.summaryCellCreator,tableStyleCellStoreGetter:e.tableStyleCellStoreGetter}),r=BI.DynamicSummaryTreeTable.formatSummaryItems(r,n,e.crossItems,t),n=e.columnSize.slice(),t=e.minColumnSize.slice(),e=e.maxColumnSize.slice();return BI.removeAt(n,r.deletedCols),BI.removeAt(t,r.deletedCols),BI.removeAt(e,r.deletedCols),{header:r.header,items:r.items,columnSize:n,minColumnSize:t,maxColumnSize:e}},setWidth:function(e){BI.DynamicSummaryTreeTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.DynamicSummaryTreeTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e},getColumnSize:function(){return this.options.columnSize},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){var n,r,e=this.options,i=this.table.getFirstColumnRowSize();return e.isNeedMergeRow?i:(e=BI.TableTree.formatItems(e.items,this._getHDeep(),!1,e.summaryCellStyleGetter,{sumPosition:"bottom"===e.rowPosition,summaryText:e.summaryText,isNeedMergeRow:e.isNeedMergeRow,summaryCellCreator:e.summaryCellCreator}),n=[],r=null,BI.each(e,function(e,t){t[0]===r?n[n.length-1]+=i[e]:(r=t[0],n.push(i[e]))}),n)},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(e){switch(BI.DynamicSummaryTreeTable.superclass.attr.apply(this,arguments),e){case"minColumnSize":case"maxColumnSize":return}return this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e,t,n,r){var i=this.options,e=(e&&(i.items=e),t&&(i.header=t),n&&(i.crossItems=n),r&&(i.crossHeader=r),this._digest());this.table.setColumnSize(e.columnSize),this.table.attr("minColumnSize",e.minColumnSize),this.table.attr("maxColumnSize",e.maxColumnSize),this.table.populate(e.items,e.header)},destroy:function(){this.table.destroy(),BI.DynamicSummaryTreeTable.superclass.destroy.apply(this,arguments)}}),BI.extend(BI.DynamicSummaryTreeTable,{formatHorizontalItems:function(e,u,h,d,p){var f=[],m=(p=p||{}).sumPosition,g=p.summaryText,r=p.isNeedMergeRow,b=p.summaryCellCreator||function(e){return e};function y(e,t){return r||(e=BI.clone(e),t&&(e.clone=!0)),e}function v(e,n){return r?e.slice():BI.map(e,function(e,t){return y(t,n)})}return BI.each(e,function(e,t){!function c(r,i){if(BI.isArray(i.children)){var o=0;if(BI.each(i.children,function(e,t){var n;-1!=r?(n=v(r,i.summaryClone?0<i.children.length:0!==e)).push(y(i,i.summaryClone?0<i.children.length:0!==e)):n=[],o+=c(n,t)}),-1!=r?(s=v(r,!i.summaryClone)).push(y(i,!i.summaryClone)):s=[],BI.isNotEmptyArray(i.values)){for(var e=b({text:g,title:g,type:"bi.table_style_cell",styleGetter:function(){return d(-1===r,BI.get(i,["children",0,"dId"]))},_store:p.tableStyleCellStoreGetter},i,-1===r),t=s.length;t<u;t++)s.push(e);if(0<(s=h?s:s.concat(BI.map(i.values,function(e,t){var n=d(-1===r);return b(BI.extend({},t,{styles:n}),i,-1===r)}))).length)if(h)for(var n=0,a=i.values.length;n<a;n++)m?f.push(s):f.splice(f.length-o,0,s);else m?f.push(s):f.splice(f.length-o,0,s);return o+1}return o}if(-1!=r)for(var s,t=(s=r.slice()).length;t<u;t++)s.push(i);else s=[];if(!h&&BI.isArray(i.values)&&(s=s.concat(i.values)),h&&BI.isArray(i.values))for(var t=0,l=i.values.length;t<l-1;t++)0<s.length&&f.push(s);return 0<s.length&&f.push(s),i.values?1:0}(-1,t)}),BI.each(f,function(e,t){for(var n=BI.last(t),r=t.length;r<u;r++)t.push(n)}),f},formatSummaryItems:function(e,t,n,r){var i,o,a=[],s=0;return BI.each(n,function(e,t){!function n(e){if(BI.isArray(e.children)){if(BI.each(e.children,function(e,t){n(t)}),BI.isNotEmptyArray(e.values)){if(1===e.children.length)for(var t=0;t<e.values.length;t++)a.push(s+t+r);s+=e.values.length}}else e.values&&1<e.values.length?s+=e.values.length:s++}(t)}),0<a.length&&(i=[],o=[],BI.each(t,function(e,t){t=t.slice();BI.removeAt(t,a),i.push(t)}),BI.each(e,function(e,t){t=t.slice();BI.removeAt(t,a),o.push(t)}),t=i,e=o),{items:e,header:t,deletedCols:a}}}),BI.shortcut("bi.dynamic_summary_tree_table",BI.DynamicSummaryTreeTable)},function(e,t,n){"use strict";BI.LayerTreeTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.LayerTreeTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-layer-tree-table-cell",layer:0,text:""})},_init:function(){BI.LayerTreeTableCell.superclass._init.apply(this,arguments);var e=this.options;BI.createWidget({type:"bi.label",element:this.element,textAlign:"left",whiteSpace:"nowrap",height:e.height,text:e.text,value:e.value,lgap:5+30*e.layer,rgap:5})}}),BI.shortcut("bi.layer_tree_table_cell",BI.LayerTreeTableCell)},function(e,t,n){"use strict";BI.LayerTreeTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.LayerTreeTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-layer-tree-table",el:{type:"bi.resizable_table"},isNeedResize:!1,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],rowHeaderCreator:null,headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,header:[],items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1})},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},_createHeader:function(e){var t=this.options,n=t.header||[],r=t.crossHeader||[],e=BI.TableTree.formatCrossItems(t.crossItems,e,t.headerCellStyleGetter,{sumPosition:"right"===t.colPosition,summaryText:t.summaryText}),i=[];return BI.each(e,function(e,t){e=[r[e]];i.push(e.concat(t||[]))}),n&&0<n.length&&(e=this._formatColumns(n),this._getHDeep()<=0?e.unshift(t.rowHeaderCreator||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter}):e[0]=t.rowHeaderCreator||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter},i.push(e)),i},_formatItems:function(e){var n=this.options,i=[];return BI.each(e,function(e,t){BI.each(t.children,function(e,t){!function r(e,n){e.type||(e.type="bi.layer_tree_table_cell"),e.layer=n;var t=[e];0<(t=t.concat(e.values||[])).length&&i.push(t),BI.isNotEmptyArray(e.children)&&BI.each(e.children,function(e,t){r(t,n+1)})}(t,0)}),BI.isArray(t.values)&&(t=[{type:"bi.table_style_cell",text:BI.i18nText("BI-Summary_Values"),styleGetter:function(){return n.summaryCellStyleGetter(!0)},_store:n.tableStyleCellStoreGetter}].concat(t.values),i.push(t))}),i},_formatColumns:function(e,t){return BI.isNotEmptyArray(e)?(t=t||this._getHDeep(),e.slice(Math.max(0,t-1))):e},_formatFreezeCols:function(){return 0<this.options.freezeCols.length?[0]:[]},_formatColumnSize:function(e,n){var r;return e.length<=0?[]:(r=[0],n=n||this._getHDeep(),BI.each(e,function(e,t){e<n?r[0]+=t:r.push(t)}),r)},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep();return this.header=this._createHeader(n),this.items=this._formatItems(e.items),{header:this.header,items:this.items,columnSize:this._formatColumnSize(e.columnSize,t),minColumnSize:this._formatColumns(e.minColumnSize,t),maxColumnSize:this._formatColumns(e.maxColumnSize,t),freezeCols:this._formatFreezeCols()}},_init:function(){BI.LayerTreeTable.superclass._init.apply(this,arguments);var e=this,t=this.options,n=this._digest();this.table=BI.createWidget(t.el,{type:"bi.resizable_table",element:this,width:t.width,height:t.height,isNeedResize:t.isNeedResize,isNeedFreeze:t.isNeedFreeze,freezeCols:n.freezeCols,isNeedMerge:t.isNeedMerge,mergeCols:[],mergeRule:t.mergeRule,columnSize:n.columnSize,minColumnSize:n.minColumnSize,maxColumnSize:n.maxColumnSize,headerRowSize:t.headerRowSize,rowSize:t.rowSize,regionColumnSize:t.regionColumnSize,header:n.header,items:n.items}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){e.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},setWidth:function(e){BI.LayerTreeTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.LayerTreeTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e},getColumnSize:function(){var e=this.table.getColumnSize(),t=this._getHDeep(),n=[];return(n=0<t?BI.makeArray(t,e[0]/t):n).concat(e.slice(1))},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){var n=this.table.getFirstColumnRowSize(),r=[];return BI.each(this.items,function(e,t){0<t[0].layer?r[r.length-1]+=n[e]:r.push(n[e])}),r},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(e,t){switch(BI.LayerTreeTable.superclass.attr.apply(this,arguments),e){case"columnSize":case"minColumnSize":case"maxColumnSize":case"freezeCols":case"mergeCols":return}return this.table.attr.apply(this.table,[e,t])},restore:function(){this.table.restore()},populate:function(e,t,n,r){var i=this.options,e=(i.items=e||[],t&&(i.header=t),n&&(i.crossItems=n),r&&(i.crossHeader=r),this._digest());this.table.setColumnSize(e.columnSize),this.table.attr("freezeCols",e.freezeCols),this.table.attr("minColumnSize",e.minColumnSize),this.table.attr("maxColumnSize",e.maxColumnSize),this.table.populate(e.items,e.header)},destroy:function(){this.table.destroy(),BI.LayerTreeTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.layer_tree_table",BI.LayerTreeTable)},function(e,t,n){"use strict";BI.TableStyleCell=BI.inherit(BI.Single,{props:{baseCls:"bi-table-style-cell",styleGetter:BI.emptyFn},mounted:function(){var e,t,n=BI.extend({},this.options.styleGetter());n.fontSize&&this.text.element.css((e={fontSize:"".concat(null!=(e=n.fontSize)?e:12,"px")},t="fontSize",n="calc(var(--css-scale, 1) * ".concat(null!=(n=n.fontSize)?n:12,"px)"),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e))},render:function(){var e=this.options,t=this,n=BI.extend({},e.styleGetter(),{height:e.height-1});return{type:"bi.adaptive",items:[{el:{type:"bi.label",textAlign:n.textAlign||"left",css:n,hgap:5,text:e.text,title:e.text,belowMouse:!0,ref:function(e){t.text=e}}}]}},_digestStyle:function(){var e=this.options.styleGetter();e&&this.text.element.css(e)},setText:function(e){this.text.setText(e)},setHeight:function(e){BI.TableStyleCell.superclass.setHeight.call(this,e),this.text.setHeight(e-1)},populate:function(){this._digestStyle()}}),BI.shortcut("bi.table_style_cell",BI.TableStyleCell)},function(e,t,n){"use strict";BI.TableTree=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.TableTree.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-table-tree",el:{type:"bi.resizable_table"},isNeedResize:!0,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,isNeedMergeCol:!0,isNeedMergeRow:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,header:[],items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1})},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},_init:function(){BI.TableTree.superclass._init.apply(this,arguments);var e=this,t=this.options,n=this._digest();this.table=BI.createWidget(t.el,{type:"bi.resizable_table",element:this,width:t.width,height:t.height,isNeedResize:t.isNeedResize,isNeedFreeze:t.isNeedFreeze,freezeCols:t.freezeCols,isNeedMerge:t.isNeedMerge,mergeCols:t.mergeCols,mergeRule:t.mergeRule,columnSize:t.columnSize,minColumnSize:t.minColumnSize,maxColumnSize:t.maxColumnSize,headerRowSize:t.headerRowSize,rowSize:t.rowSize,regionColumnSize:t.regionColumnSize,header:n.header,items:n.items}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){e.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)})},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep();return{header:BI.TableTree.formatHeader(e.header,e.crossHeader,e.crossItems,t,n,e.headerCellStyleGetter,{sumPosition:"right"===e.colPosition,summaryText:e.summaryText}),items:BI.TableTree.formatItems(e.items,t,!1,e.summaryCellStyleGetter,{sumPosition:"bottom"===e.rowPosition,summaryText:e.summaryText,isNeedMergeRow:e.isNeedMergeRow})}},setWidth:function(e){BI.TableTree.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.TableTree.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.options.columnSize=e,this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},getFirstColumnHeaderRowSize:function(){return this.table.getFirstColumnHeaderRowSize()},getFirstColumnRowSize:function(){return this.table.getFirstColumnRowSize()},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},attr:function(){return BI.TableTree.superclass.attr.apply(this,arguments),this.table.attr.apply(this.table,arguments)},restore:function(){this.table.restore()},populate:function(e,t,n,r){var i=this.options,e=(e&&(i.items=e||[]),t&&(i.header=t),n&&(i.crossItems=n),r&&(i.crossHeader=r),this._digest());this.table.populate(e.items,e.header)},destroy:function(){this.table.destroy(),BI.TableTree.superclass.destroy.apply(this,arguments)}}),BI.extend(BI.TableTree,{formatHeader:function(e,t,n,r,i,o,a){for(var s=BI.isEmpty(e)?BI.TableTree.formatCrossItems4Special(n,i,o,a):BI.TableTree.formatCrossItems(n,i,o,a),l=[],c=0;c<i;c++){for(var u=[],h=0;h<r;h++)u.push(t[c]);l.push(u.concat(s[c]||[]))}return e&&0<e.length&&l.push(e),l},formatItems:function(e,u,h,d,p){var f=[],m=(p=p||{}).sumPosition,g=p.summaryText||BI.i18nText("BI-Summary_Values"),b=p.summaryCellCreator||function(e){return e};return BI.each(e,function(e,t){!function c(r,i){if(BI.isArray(i.children)){var o=0;if(BI.each(i.children,function(e,t){var n;-1!=r?(n=r.slice()).push(i):n=[],o+=c(n,t)}),-1!=r?(s=r.slice()).push(i):s=[],BI.isNotEmptyArray(i.values)){for(var e=b({text:g,title:g,type:"bi.table_style_cell",styleGetter:function(){return d(-1===r)},_store:p.tableStyleCellStoreGetter},i,-1===r),t=s.length;t<u;t++)s.push(e);if(0<(s=h?s:s.concat(i.values)).length)if(h)for(var n=0,a=i.values.length;n<a;n++)m?f.push(s):f.splice(f.length-o,0,s);else m?f.push(s):f.splice(f.length-o,0,s);return o+1}return o}if(-1!=r)for(var s,t=(s=r.slice()).length;t<u;t++)s.push(i);else s=[];if(!h&&BI.isArray(i.values)&&(s=s.concat(i.values)),h&&BI.isArray(i.values))for(var t=0,l=i.values.length;t<l-1;t++)0<s.length&&f.push(s);return 0<s.length&&f.push(s),i.values?1:0}(-1,t)}),BI.each(f,function(e,t){for(var n=BI.last(t),r=t.length;r<u;r++)t.push(n)}),f},formatItems4Special:function(e,c,u,h,d){var p=[],f=(d=d||{}).sumPosition,m=d.summaryText||BI.i18nText("BI-Summary_Values");return BI.each(e,function(e,t){!function l(r,i){if(BI.isArray(i.children)){var o=0;if(BI.each(i.children,function(e,t){var n;-1!=r?(n=r.slice()).push(i):n=[],o+=l(n,t)}),-1!=r?(s=r.slice()).push(i):s=[],BI.isNotEmptyArray(i.values)){for(var e={text:m,title:m,type:"bi.table_style_cell",styleGetter:function(){return h(-1===r)},_store:d.tableStyleCellStoreGetter},t=s.length;t<c;t++)s.push(e);if(0<s.length)if(u)for(var n=0,a=i.values.length;n<a;n++)f?p.push(s):p.splice(p.length-o,0,s);else f?p.push(s):p.splice(p.length-o,0,s);return o+i.values.length}return o}if(-1!=r)for(var s,t=(s=r.slice()).length;t<c;t++)s.push(i);else s=[];return 0<s.length&&p.push(s),i.values?i.values.length:0}(-1,t)}),BI.each(p,function(e,t){for(var n=BI.last(t),r=t.length;r<c;r++)t.push(n)}),p},formatCrossItems:function(e,t,n,r){e=BI.TableTree.formatItems(e,t,!0,n,r);return BI.unzip(e)},formatCrossItems4Special:function(e,t,n,r){e=BI.TableTree.formatItems4Special(e,t,!1,n,r);return BI.unzip(e)},maxDeep:function(e){var n=1;return BI.isObject(e)&&BI.each(e,function(e,t){n=Math.max(n,function i(n,e){var r=n;return BI.isNotEmptyArray(e.children)&&BI.each(e.children,function(e,t){r=Math.max(r,i(n+1,t))}),r}(1,t))}),n}}),BI.shortcut("bi.tree_table",BI.TableTree)},function(e,t,n){"use strict";BI.StyleTable=BI.inherit(BI.Widget,{props:{baseCls:"bi-components-preview-table",$testId:"bi-components-preview-table",userSelectable:!0,isNeedFreeze:!0,showSequence:!1,seqWidth:60,sequenceCellStyleGetter:BI.emptyFn,headerCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,showPartData:!1,columnSortable:!1,columnSelectable:!1,tipPosition:"bottom",zebraVeins:!0,freezeCols:[],columnSize:[],columnGaps:[],headerRowSize:30,rowSize:30,header:[],items:[],watermark:{},needFormat:!0,fontSize:12,minSize:60,regionColumnSize:[],isHeaderAutoHeight:!1,isAutoHeight:!1},mounted:function(){var n=this;this._resizeHandler=BI.debounce(function(){var e=n._getTableWidth(),t=n._getTableHeight();n.table.getWidth()===e&&n.table.getHeight()===t||(n.table.setWidth(e),n.table.setHeight(t),n.table.populate())},30),this.removeListener=BI.ResizeDetector.addResizeListener(this.wrapper,function(){n._resizeHandler()}),this._populate()},render:function(){var t=this,e=this.options,n=e.watermark;return{type:"bi.absolute",items:[{el:{type:"bi.vtape",cls:e.userSelectable?"user-selectable":"",items:this._createTable()},top:0,right:0,bottom:0,left:0},{el:{type:"bi.watermark",invisible:!n.valid,watermark:n},left:0,top:0,right:0,bottom:0}],ref:function(e){t.wrapper=e}}},_createTable:function(){var e=this.options,t=this,n={el:{type:"bi.label",cls:"bi-tips",text:BI.i18nText("BI-Conf_Current_Preview_Part_Data"),textAlign:"right"},height:e.showPartData?30:0},r={type:"bi.page_table",rowSize:e.rowSize,headerRowSize:e.headerRowSize,isNeedFreeze:e.isNeedFreeze,freezeCols:e.freezeCols,showSequence:e.showSequence,seqWidth:e.seqWidth,sequenceCellStyleGetter:e.sequenceCellStyleGetter,headerCellStyleGetter:e.headerCellStyleGetter,tableStyleCellStoreGetter:e.tableStyleCellStoreGetter,ref:function(e){t.table=e},el:{type:"bi.sequence_table",el:{type:"bi.adaptive_table",el:e.columnSelectable||e.columnSortable?{type:"bi.sortable_table",sortable:e.columnSortable,ref:function(e){t.sortableTable=e},el:{type:"bi.resizable_table",el:this._getGridConfig()},listeners:[{eventName:"EVENT_TABLE_SELECT_COLUMN",action:function(e){t.fireEvent("EVENT_TABLE_SELECT_COLUMN",e)}},{eventName:"EVENT_TABLE_SORT",action:function(){t.fireEvent("EVENT_TABLE_SORT",arguments)}}]}:{type:"bi.resizable_table",el:this._getGridConfig()},listeners:[{eventName:"EVENT_TABLE_AFTER_COLUMN_RESIZE",action:function(){t.fireEvent("EVENT_TABLE_AFTER_COLUMN_RESIZE")}}]}}};return"top"!==e.tipPosition?[r,n]:[n,r]},_getGridConfig:function(){var e=this.options;return{type:"bi.grid_auto_height_table",columnGaps:e.columnGaps,isAutoHeight:e.isAutoHeight,isHeaderAutoHeight:e.isHeaderAutoHeight,fontSize:e.fontSize,fontLineHeight:1.4*e.fontSize,headerFontSize:e.fontSize,headerFontLineHeight:1.4*e.fontSize}},_getTableWidth:function(){return this.options.width||this.element.width()},_getTableHeight:function(){var e=this.element.height();return this.options.showPartData?e-30:e},_populate:function(){this.populate(this.options.items,this.options.header)},_calculateColumnSize:function(){var t,r,e,n,i,o,a;return this.options.columnSize&&0<this.options.columnSize.length?this.options.columnSize:(t=this.options.fontSize,r=this.options.minSize,l(this.options.header,e=[]),l(this.options.items,e),n=BI.map(e,function(e,t){var n=2*Math.ceil(BI.average(BI.filter(t,function(e,t){return 0<=t}))),t=Math.ceil(BI.max(t));return n<r||t<r?r:n<t?n:t}),BI.each(this.options.header,function(e,t){BI.each(t,function(e,t){n[e]+=BI.isNumber(t.iconWidth)?t.iconWidth:0,n[e]+=BI.isNumber(t.lgap)?t.lgap:0,n[e]+=BI.isNumber(t.rgap)?t.rgap:0,n[e]+=BI.isNumber(t.hgap)?2*t.hgap:0})}),i=this._getTableWidth()-10,o=n.reduce(function(e,t){return e+t},0),i<=o?n:(a=i-o,BI.map(n,function(e,t){return e===n.length-1?t+a:(a-=Math.ceil((i-o)/n.length),t+Math.ceil((i-o)/n.length))})));function s(e){return BI.isNumber(e.width)?e.width:BI.isNotEmptyString(e.text)?BI.Func.getGBWidth(e.text)*t*1.2:0}function l(e,r){BI.each(e,function(e,t){BI.each(t,function(e,t){var n=0;BI.isNotEmptyArray(t.items)?BI.each(t.items,function(e,t){n+=s(t)}):n+=s(t),r[e]=r[e]||[],r[e].push(n)})})}},_formatItems:function(){var r=this,e=BI.deepClone(this.options.items),i=this.options.zebraVeins;return BI.each(e,function(n,e){BI.each(e,function(e,t){BI.isNotNull(r.options.header[0])&&BI.isNotNull(r.options.header[0][e])&&"number-field-font"===r.options.header[0][e].iconCls&&r.options.needFormat&&(t.text=BI.Format.numberFormat(t.text)),t.text=BI.replaceAll(t.text||"","\n","\\n"),t.cls=(t.cls||"")+" body-row "+(i?n%2!=0?"even-row":"odd-row":"")})}),e},_formatHeader:function(){var e=BI.deepClone(this.options.header);return BI.each(e,function(e,t){BI.each(t,function(e,t){t.cls=(t.cls||"")+" header-row "})}),e},populate:function(e,t,n){this.options.items=e,this.options.header=t;e=this._calculateColumnSize();this.table.attr("columnSize",e),n=n||{},!BI.isNull(n.freezeScroll)&&!1!==n.freezeScroll||(this.table.attr("scrollTop",0),this.table.attr("scrollLeft",BI.sum(e.slice(0,n.scrollLeftIndex||0)))),this.table.restore(),this.table.setWidth(this._getTableWidth()),this.table.setHeight(this._getTableHeight()),this.table.attr("regionColumnSize",this.options.regionColumnSize),this.table.attr("minColumnSize",e),this.table.attr("isNeedFreeze",!0),this.table.attr("freezeCols",this.options.freezeCols),this.table.attr("showSequence",this.options.showSequence),this.table.populate(this._formatItems(),this._formatHeader())},setHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},selectColumns:function(e){this.sortableTable&&this.sortableTable.selectColumns(e)},setSortable:function(e){this.sortableTable&&this.sortableTable.setSortable(e)},getSelectedColumns:function(){return this.sortableTable&&this.sortableTable.getSelectedColumns()},destroyed:function(){this.removeListener&&this.removeListener()},getColumnSize:function(){return this.table.getColumnSize()}}),BI.shortcut("bi.components.style_table",BI.StyleTable)},function(e,t,n){"use strict";var l,c;l=function l(e,t,n){return t<e?e:n<t?n:t},c={index:0,offset:0,position:0,contentHeight:0},BI.TableScrollHelper=function(e,t,n,r){this._rowOffsets=BI.PrefixIntervalTree.uniform(e,t),this._storedHeights=new Array(e);for(var i=0;i<e;++i)this._storedHeights[i]=t;this._rowCount=e,this._position=0,this._contentHeight=e*t,this._defaultRowHeight=t,this._rowHeightGetter=r||function(){return t},this._viewportHeight=n,this._updateHeightsInViewport(0,0)},BI.TableScrollHelper.prototype={constructor:BI.TableScrollHelper,setRowHeightGetter:function(e){this._rowHeightGetter=e},setViewportHeight:function(e){this._viewportHeight=e},getContentHeight:function(){return this._contentHeight},_updateHeightsInViewport:function(e,t){for(var n=t,r=e;n<=this._viewportHeight&&r<this._rowCount;)this._updateRowHeight(r),n+=this._storedHeights[r],r++},_updateHeightsAboveViewport:function(e){for(var t=e-1;0<=t&&e-5<=t;){var n=this._updateRowHeight(t);this._position+=n,t--}},_updateRowHeight:function(e){var t,n;return!(e<0||e>=this._rowCount)&&(t=this._rowHeightGetter(e))!==this._storedHeights[e]?(n=t-this._storedHeights[e],this._rowOffsets.set(e,t),this._storedHeights[e]=t,this._contentHeight+=n,n):0},getRowPosition:function(e){return this._updateRowHeight(e),this._rowOffsets.sumUntil(e)},scrollBy:function(e){if(0===this._rowCount)return c;var t=this._rowOffsets.greatestLowerBound(this._position),t=l(t,0,Math.max(this._rowCount-1,0)),n=this._rowOffsets.sumUntil(t),r=t,i=this._position,t=this._updateRowHeight(r),o=(0!==n&&(i+=t),this._storedHeights[r]-(i-n));if(0<=e)for(;0<e&&r<this._rowCount;)e<o?(i+=e,e=0):(e-=o,i+=o,r++),r<this._rowCount&&(this._updateRowHeight(r),o=this._storedHeights[r]);else if(e<0){e=-e;for(var a,s=this._storedHeights[r]-o;0<e&&0<=r;)e<s?(i-=e,e=0):(i-=s,e-=s,r--),0<=r&&(a=this._updateRowHeight(r),s=this._storedHeights[r],i+=a)}t=this._contentHeight-this._viewportHeight,i=l(i,0,t),this._position=i,n=this._rowOffsets.greatestLowerBound(i),n=l(n,0,Math.max(this._rowCount-1,0)),t=this._rowOffsets.sumUntil(n)-i;return this._updateHeightsInViewport(n,t),this._updateHeightsAboveViewport(n),{index:n,offset:t,position:this._position,contentHeight:this._contentHeight}},_getRowAtEndPosition:function(e){this._updateRowHeight(e);for(var t=e,n=this._storedHeights[t];n<this._viewportHeight&&0<=t;)0<=--t&&(this._updateRowHeight(t),n+=this._storedHeights[t]);e=this._rowOffsets.sumTo(e)-this._viewportHeight;return e=e<0?0:e},scrollTo:function(e){var t;return 0===this._rowCount?c:e<=0?(this._position=0,this._updateHeightsInViewport(0,0),{index:0,offset:0,position:this._position,contentHeight:this._contentHeight}):(e>=this._contentHeight-this._viewportHeight&&(t=this._rowCount-1,e=this._getRowAtEndPosition(t)),this._position=e,t=this._rowOffsets.greatestLowerBound(e),t=l(t,0,Math.max(this._rowCount-1,0)),e=this._rowOffsets.sumUntil(t)-e,this._updateHeightsInViewport(t,e),this._updateHeightsAboveViewport(t),{index:t,offset:e,position:this._position,contentHeight:this._contentHeight})},scrollToRow:function(e,t){e=l(e,0,Math.max(this._rowCount-1,0)),t=l(t,-this._storedHeights[e],0);e=this._rowOffsets.sumUntil(e);return this.scrollTo(e-t)},scrollRowIntoView:function(e){e=l(e,0,Math.max(this._rowCount-1,0));var t=this._rowOffsets.sumUntil(e),n=t+this._storedHeights[e];return t<this._position?this.scrollTo(t):this._position+this._viewportHeight<n?(t=this._getRowAtEndPosition(e),this.scrollTo(t)):this.scrollTo(this._position)}}},function(e,t,n){"use strict";BI.SequenceTableTreeNumber=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.SequenceTableTreeNumber.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-sequence-table-tree-number",isNeedFreeze:!1,startSequence:1,scrollTop:0,headerRowSize:25,rowSize:25,rowSizeGetter:BI.emptyFn,headerRowSizeGetter:BI.emptyFn,sequenceHeaderCreator:BI.emptyFn,sequenceSummaryText:BI.i18nText("BI-Summary_Values"),header:[],items:[],crossHeader:[],crossItems:[],width:60})},_init:function(){BI.SequenceTableTreeNumber.superclass._init.apply(this,arguments);var e=this.options;this.vCurr=1,this.hCurr=1,this.tasks=[],this.gridView=BI.createWidget({type:"bi.grid_view",overflowX:!1,overflowY:!1,scrollTop:e.scrollTop,columnCount:1,estimatedColumnSize:e.width,width:e.width,rowHeightGetter:this._rowHeightGetter.bind(this),columnWidthGetter:function(){return e.width}}),this.headerContainer=BI.createWidget({type:"bi.absolute",cls:"sequence-table-header-cell bi-border-top bi-border-left bi-border-bottom bi-border-right",width:e.width,scrollable:!1}),this.layout=BI.createWidget({type:"bi.vtape",element:this,items:[{el:this.headerContainer,height:2},{el:this.gridView,height:"fill"}]}),this.start=this.options.startSequence,this.cache={},this._nextState(),this.populate()},_rowHeightGetter:function(e){var t,n=this.options,r=this._getHeaderHeight();return r>=n.height?0===e?r:this.rowHeights&&(t=this.rowHeights[e-1],BI.isNotNull(t))?t:this.options.rowSize:this.rowHeights&&(t=this.rowHeights[e],BI.isNotNull(t))?t:this.options.rowSize},_getNextSequence:function(e){var n=this,r=this.start,i=this.start;return BI.each(e,function(e,t){BI.isNotEmptyArray(t.children)&&BI.each(t.children,function(e,t){0===e&&(e=n._getCacheKey(t),n.cache[e]&&(r=i=n.cache[e])),e=t,e=n._getCacheKey(e),n.cache[e]||(n.cache[e]=i),i++})}),this.start=i,r},_getStart:function(e){var n=this,r=this.start;return BI.some(e,function(e,t){if(BI.isNotEmptyArray(t.children))return BI.some(t.children,function(e,t){if(0===e){e=n._getCacheKey(t);if(n.cache[e])return r=n.cache[e],!0}})}),r},_formatNumber:function(e){var i=this.options,n=[],o=this._getStart(e);var a=0,s=0,r=(BI.each(e,function(e,t){BI.isArray(t.children)&&(BI.isNotEmptyArray(t.values)&&i.rowPosition===BICst.DESIGN.TABLE_ROW_SUM_POSITION.TOP&&(n.push({text:i.sequenceSummaryText,start:a++,top:s,cnt:1,isSummary:!0,height:i.rowSize}),s+=i.rowSize),BI.each(t.children,function(e,t){t=function r(e){var n=0;return BI.isNotEmptyArray(e.children)&&BI.each(e.children,function(e,t){n+=r(t)}),++n}(t);n.push({text:o++,start:a,top:s,cnt:t,index:e,height:t*i.rowSize}),a+=t,s+=t*i.rowSize}),BI.isNotEmptyArray(t.values)&&i.rowPosition!==BICst.DESIGN.TABLE_ROW_SUM_POSITION.TOP&&(n.push({text:i.sequenceSummaryText,start:a++,top:s,cnt:1,isSummary:!0,height:i.rowSize}),s+=i.rowSize))}),this.rowHeights=i.rowSizeGetter());return n=BI.map(n,function(e,t){return[BI.extend({type:"bi.table_style_cell",cls:"sequence-table-number-cell bi-border-left bi-border-bottom bi-border-right",width:i.width,styleGetter:!0===t.isSummary?function(){return i.summaryCellStyleGetter(!0)}:(n=t.index,function(){return i.sequenceCellStyleGetter(n)}),_store:i.tableStyleCellStoreGetter},t,{height:r[e]||t.height})];var n})},_layout:function(){var e,t=this.options,n=(this.headerContainer.empty(),this._getHeaderHeight()),r=this.layout.attr("items");n>=t.height?r[0].height=0:(BI.createWidget({type:"bi.absolute",element:this.headerContainer,items:[{el:BI.extend({type:"bi.table_style_cell",height:n-2,cls:"sequence-table-title-cell",styleGetter:t.headerCellStyleGetter,text:BI.i18nText("BI-Number_Index"),_store:t.tableStyleCellStoreGetter},t.sequenceHeaderCreator()),left:0,top:0,right:0,bottom:0}]}),r[0].height=n),this.layout.attr("items",r),this.layout.resize(),this.numbers=this._formatNumber(t.items),n>=t.height?(this.numbers.unshift([BI.extend({type:"bi.table_style_cell",height:n-2,cls:"sequence-table-title-cell",styleGetter:t.headerCellStyleGetter,text:BI.i18nText("BI-Number_Index"),_store:t.tableStyleCellStoreGetter},t.sequenceHeaderCreator())]),e=BI.isArray(this.numbers)?(BI.sum(this.rowHeights)+n)/(this.numbers.length+1):0,this.gridView.setEstimatedRowSize(e),this.gridView.setHeight(t.height)):(e=BI.isArray(this.numbers)&&0<this.numbers.length?BI.sum(this.rowHeights)/this.numbers.length:0,this.gridView.setEstimatedRowSize(e),this.gridView.setHeight(t.height-n)),this.gridView.restore()},_getHeaderHeight:function(){var e=this.options.headerRowSizeGetter();return BI.sum(e)},_nextState:function(){var e=this.options;this._getNextSequence(e.items)},_prevState:function(){var n,e=this.options;BI.some(e.items,function(e,t){if(BI.isNotEmptyArray(t.children))return BI.some(t.children,function(e,t){return n=t,!0})}),n&&BI.isNotEmptyObject(this.cache)?this.start=this.cache[this._getCacheKey(n)]:this.start=1,this._nextState()},_calculateChildrenToRender:function(){var e=this.options;this.gridView._populate(this.numbers),this.gridView.setScrollTop(e.scrollTop)},_getCacheKey:function(e){this.nullKey||(this.nullKey=BI.UUID());e=BI.isNull(e.text)?e.value:e.text;return BI.isNull(e)?this.nullKey:e},_restore:function(){this.gridView.restore()},_populate:function(){var n=this;BI.each(this.tasks,function(e,t){t.apply(n)}),this.tasks=[],this._layout(),this._calculateChildrenToRender()},setVerticalScroll:function(e){var t=this.options;t.scrollTop!==e&&(t.scrollTop=e,this.gridView.setScrollTop(t.scrollTop))},getVerticalScroll:function(){return this.options.scrollTop},setVPage:function(e){e<=1?(this.cache={},this.start=this.options.startSequence,this._restore(),this.tasks.push(this._nextState)):e===this.vCurr+1?this.tasks.push(this._nextState):e===this.vCurr-1&&this.tasks.push(this._prevState),this.vCurr=e},setHPage:function(e){e!==this.hCurr&&this.tasks.push(this._prevState),this.hCurr=e},setWidth:function(e){BI.SequenceTableTreeNumber.superclass.setWidth.apply(this,arguments),this.gridView.setWidth(e),this.headerContainer.setWidth(e)},restore:function(){this._restore()},populate:function(e,t,n,r){var i=this.options;e&&e!==this.options.items&&(i.items=e,this._restore(),this.tasks.push(this._prevState)),t&&t!==this.options.header&&(i.header=t),n&&n!==this.options.crossItems&&(i.crossItems=n),r&&r!==this.options.crossHeader&&(i.crossHeader=r),this._populate()}}),BI.shortcut("bi.sequence_table_tree_number",BI.SequenceTableTreeNumber)},function(e,t,n){"use strict";BI.SequenceTableDynamicNumber=BI.inherit(BI.SequenceTableTreeNumber,{_defaultConfig:function(){return BI.extend(BI.SequenceTableDynamicNumber.superclass._defaultConfig.apply(this,arguments),{extraCls:"bi-sequence-table-dynamic-number"})},_init:function(){BI.SequenceTableDynamicNumber.superclass._init.apply(this,arguments)},_formatNumber:function(e){var i=this.options,o=[],a=this._getStart(e);var s=0,l=0,r=(BI.each(e,function(e,t){BI.isArray(t.children)&&(BI.isNotEmptyArray(t.values)&&i.rowPosition===BICst.DESIGN.TABLE_ROW_SUM_POSITION.TOP&&(o.push({text:i.sequenceSummaryText,title:i.sequenceSummaryText,start:s++,top:l,cnt:1,isSummary:!0,height:i.rowSize}),l+=i.rowSize),BI.each(t.children,function(e,t){var t=function r(e){var n=0;return BI.isNotEmptyArray(e.children)&&(BI.each(e.children,function(e,t){n+=r(t)}),!BI.isNotEmptyArray(e.values))||n++,n}(t),n=a++;o.push({text:n,title:n,start:s,top:l,cnt:t,index:e,height:t*i.rowSize}),s+=t,l+=t*i.rowSize}),BI.isNotEmptyArray(t.values)&&i.rowPosition!==BICst.DESIGN.TABLE_ROW_SUM_POSITION.TOP&&(o.push({text:i.sequenceSummaryText,title:i.sequenceSummaryText,start:s++,top:l,cnt:1,isSummary:!0,height:i.rowSize}),l+=i.rowSize))}),this.rowHeights=i.rowSizeGetter());return o=BI.map(o,function(e,t){return[BI.extend({type:"bi.table_style_cell",cls:"sequence-table-number-cell bi-border-left bi-border-bottom bi-border-right",width:i.width,styleGetter:!0===t.isSummary?function(){return i.summaryCellStyleGetter(!0)}:(n=t.index,function(){return i.sequenceCellStyleGetter(n)}),_store:i.tableStyleCellStoreGetter},t,{height:r[e]||t.height})];var n})}}),BI.shortcut("bi.sequence_table_dynamic_number",BI.SequenceTableDynamicNumber)},function(e,t,n){"use strict";BI.PageTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.PageTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-page-table-cell",text:"",title:""})},_init:function(){BI.PageTableCell.superclass._init.apply(this,arguments),BI.createWidget({type:"bi.label",element:this,textAlign:"left",whiteSpace:"nowrap",height:this.options.height,text:this.options.text,title:this.options.title,value:this.options.value,lgap:5,rgap:5}),BI.isNotNull(this.options.styles)&&BI.isObject(this.options.styles)&&this.element.css(this.options.styles)}}),BI.shortcut("bi.page_table_cell",BI.PageTableCell)},function(e,t,n){"use strict";BI.PageTable=BI.inherit(BI.Widget,{_const:{scrollWidth:18,minScrollWidth:100},_defaultConfig:function(){return BI.extend(BI.PageTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-page-table",el:{type:"bi.sequence_table"},pager:{horizontal:{pages:!1,curr:1,hasPrev:BI.emptyFn,hasNext:BI.emptyFn,firstPage:1,lastPage:BI.emptyFn},vertical:{pages:!1,curr:1,hasPrev:BI.emptyFn,hasNext:BI.emptyFn,firstPage:1,lastPage:BI.emptyFn}},itemsCreator:BI.emptyFn,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,showSequence:!1,seqWidth:60,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,header:[],items:[],crossHeader:[],crossItems:[]})},_init:function(){BI.PageTable.superclass._init.apply(this,arguments);var n=this,r=this.options;this.hCurr=1,this.vCurr=1,this.table=BI.createWidget(r.el,{type:"bi.sequence_table",width:r.width,height:r.height&&r.height-30,isNeedResize:!0,isNeedFreeze:r.isNeedFreeze,freezeCols:r.freezeCols,isNeedMerge:r.isNeedMerge,mergeCols:r.mergeCols,mergeRule:r.mergeRule,columnSize:r.columnSize,minColumnSize:r.minColumnSize,maxColumnSize:r.maxColumnSize,headerRowSize:r.headerRowSize,rowSize:r.rowSize,showSequence:r.showSequence,seqWidth:r.seqWidth,regionColumnSize:r.regionColumnSize,headerCellStyleGetter:r.headerCellStyleGetter,summaryCellStyleGetter:r.summaryCellStyleGetter,sequenceCellStyleGetter:r.sequenceCellStyleGetter,tableStyleCellStoreGetter:r.tableStyleCellStoreGetter,header:r.header,items:r.items,crossHeader:r.crossHeader,crossItems:r.crossItems}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){n.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){r.regionColumnSize=this.getRegionColumnSize(),r.columnSize=this.getColumnSize(),n.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){r.regionColumnSize=this.getRegionColumnSize(),r.columnSize=this.getColumnSize(),n.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)}),this.pager=BI.createWidget(r.pager,{type:"bi.direction_pager",height:24}),this.pager.on(BI.Pager.EVENT_CHANGE,function(){var e=this.getVPage&&this.getVPage(),t=(BI.isNull(e)&&(e=this.getCurrentPage()),this.getHPage&&this.getHPage());r.itemsCreator({vpage:e,hpage:t},function(){n.table.setVPage?n.table.setVPage(e):n.table.setValue(e),n.table.setHPage&&n.table.setHPage(t),n.populate.apply(n,arguments)})}),BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.table,left:0,top:0},{el:this.pager,left:0,right:10,bottom:3}]})},setHPage:function(e){this.hCurr=e,this.pager.setHPage&&this.pager.setHPage(e),this.table.setHPage&&this.table.setHPage(e)},setVPage:function(e){this.vCurr=e,this.pager.setVPage&&this.pager.setVPage(e),this.table.setVPage&&this.table.setVPage(e)},getHPage:function(){var e=this.pager.getHPage&&this.pager.getHPage();return BI.isNotNull(e)||(e=this.pager.getCurrentPage&&this.pager.getCurrentPage(),BI.isNotNull(e))?e:this.hpage},getVPage:function(){var e=this.pager.getVPage&&this.pager.getVPage();return BI.isNotNull(e)||(e=this.pager.getCurrentPage&&this.pager.getCurrentPage(),BI.isNotNull(e))?e:this.vpage},setWidth:function(e){BI.PageTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){BI.PageTable.superclass.setHeight.apply(this,arguments);var t=this.options,n=!1;(this.pager.isShowPager&&this.pager.isShowPager()||this.pager.hasHNext&&this.pager.hasHNext()||this.pager.hasHPrev&&this.pager.hasHPrev()||this.pager.hasVNext&&this.pager.hasVNext()||this.pager.hasVPrev&&this.pager.hasVPrev()||this.pager.hasNext&&this.pager.hasNext()||this.pager.hasPrev&&this.pager.hasPrev())&&(n=!0),this.table.setHeight(e-(n?t.pager&&t.pager.height||30:0))},setColumnSize:function(e){this.options.columnSize=e,this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},setRegionColumnSize:function(e){this.options.columnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},getVerticalScroll:function(){return this.table.getVerticalScroll()},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},setVerticalScroll:function(e){this.table.setVerticalScroll(e)},restore:function(){this.table.restore()},attr:function(){BI.PageTable.superclass.attr.apply(this,arguments),this.table.attr.apply(this.table,arguments)},populate:function(){this.pager.populate(),this.table.populate.apply(this.table,arguments)},destroy:function(){this.table.destroy(),this.pager&&this.pager.destroy(),BI.PageTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.page_table",BI.PageTable)},function(e,t,n){"use strict";BI.PreviewTableCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.PreviewTableCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-preview-table-cell",text:""})},_init:function(){BI.PreviewTableCell.superclass._init.apply(this,arguments);var e=this.options;BI.createWidget({type:"bi.label",element:this,textAlign:e.textAlign||"left",whiteSpace:e.whiteSpace||"normal",height:this.options.height,text:this.options.text,value:this.options.value,lgap:e.lgap,rgap:e.rgap,hgap:e.hgap||5})}}),BI.shortcut("bi.preview_table_cell",BI.PreviewTableCell)},function(e,t,n){"use strict";BI.PreviewTableHeaderCell=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.PreviewTableHeaderCell.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-preview-table-header-cell",text:""})},_init:function(){BI.PreviewTableHeaderCell.superclass._init.apply(this,arguments);var e=this.options;BI.createWidget({type:"bi.label",element:this,textAlign:e.textAlign||"left",whiteSpace:e.whiteSpace||"nowrap",height:this.options.height,text:this.options.text,value:this.options.value,lgap:e.lgap,rgap:e.rgap,hgap:e.hgap||5})}}),BI.shortcut("bi.preview_table_header_cell",BI.PreviewTableHeaderCell)},function(e,t,n){"use strict";BI.PreviewTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.PreviewTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-preview-table",isNeedFreeze:!1,freezeCols:[],rowSize:null,columnSize:[],headerRowSize:30,header:[],items:[]})},_init:function(){BI.PreviewTable.superclass._init.apply(this,arguments);var e=this,t=this.options;this.table=BI.createWidget({type:"bi.table_view",element:this,isNeedResize:!1,isNeedFreeze:t.isNeedFreeze,freezeCols:t.freezeCols,rowSize:t.rowSize,columnSize:t.columnSize,headerRowSize:t.headerRowSize,header:BI.map(t.header,function(e,t){return BI.map(t,function(e,t){return BI.extend({type:"bi.preview_table_header_cell"},t)})}),items:BI.map(t.items,function(e,t){return BI.map(t,function(e,t){return BI.extend({type:"bi.preview_table_cell"},t)})})}),this.table.on(BI.Table.EVENT_TABLE_AFTER_INIT,function(){e.fireEvent(BI.Table.EVENT_TABLE_AFTER_INIT,arguments)}),this.table.on(BI.Table.EVENT_TABLE_RESIZE,function(){e._adjustColumns()}),this._adjustColumns()},_hasAdaptCol:function(e){return BI.any(e,function(e,t){return""===t})},_isPercentage:function(e){return e[0]<=1},_adjustColumns:function(){var n,r,i,e,o,a,s,l,c=this.options;!0===c.isNeedFreeze?this._isPercentage(c.columnSize)&&(this._hasAdaptCol(c.columnSize)&&(n=[],r=0,BI.each(c.columnSize,function(e,t){""===t?n.push(e):r+=t}),i=(r=1-r)/n.length,BI.each(n,function(e,t){c.columnSize[t]=i})),e=0!==BI.first(c.freezeCols),o=[],a=[],BI.each(c.columnSize,function(e,t){(c.freezeCols.includes(e)?o:a).push(t)}),s=BI.sum(o),l=BI.sum(a),BI.each(o,function(e,t){o[e]=t/s}),BI.each(a,function(e,t){a[e]=t/l}),this.table.setRegionColumnSize(e?["fill",s]:[s,"fill"]),this.table.setColumnSize(e?a.concat(o):o.concat(a))):(this._hasAdaptCol(c.columnSize)||this._isPercentage(c.columnSize))&&this.table.setRegionColumnSize(["100%"])},setColumnSize:function(e){return this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},getCalculateColumnSize:function(){return this.table.getCalculateColumnSize()},setHeaderColumnSize:function(e){return this.table.setHeaderColumnSize(e)},setRegionColumnSize:function(e){return this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},getCalculateRegionColumnSize:function(){return this.table.getCalculateRegionColumnSize()},getCalculateRegionRowSize:function(){return this.table.getCalculateRegionRowSize()},getClientRegionColumnSize:function(){return this.table.getClientRegionColumnSize()},getScrollRegionColumnSize:function(){return this.table.getScrollRegionColumnSize()},getScrollRegionRowSize:function(){return this.table.getScrollRegionRowSize()},hasVerticalScroll:function(){return this.table.hasVerticalScroll()},setVerticalScroll:function(e){return this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){return this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){return this.table.setRightHorizontalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},getLeftHorizontalScroll:function(){return this.table.getLeftHorizontalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},getColumns:function(){return this.table.getColumns()},populate:function(e,t){e=e&&BI.map(e,function(e,t){return BI.map(t,function(e,t){return BI.extend({type:"bi.preview_table_cell"},t)})}),t=t&&BI.map(t,function(e,t){return BI.map(t,function(e,t){return BI.extend({type:"bi.preview_table_header_cell"},t)})}),this.table.populate(e,t),this._adjustColumns()}}),BI.PreviewTable.EVENT_CHANGE="PreviewTable.EVENT_CHANGE",BI.shortcut("bi.preview_table",BI.PreviewTable)},function(e,t,n){"use strict";BI.SequenceTableListNumber=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.SequenceTableListNumber.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-sequence-table-list-number",isNeedFreeze:!1,scrollTop:0,startSequence:1,headerRowSize:25,rowSize:25,rowSizeGetter:BI.emptyFn,headerRowSizeGetter:BI.emptyFn,sequenceHeaderCreator:BI.emptyFn,header:[],items:[],crossHeader:[],crossItems:[],pageSize:20,width:60})},_init:function(){BI.SequenceTableListNumber.superclass._init.apply(this,arguments);var e=this.options;this.start=e.startSequence,this.gridView=BI.createWidget({type:"bi.grid_view",overflowX:!1,overflowY:!1,scrollTop:e.scrollTop,columnCount:1,estimatedColumnSize:e.width,width:e.width,rowHeightGetter:this._rowHeightGetter.bind(this),columnWidthGetter:function(){return e.width}}),this.headerContainer=BI.createWidget({type:"bi.absolute",cls:"sequence-table-header-cell bi-border-top bi-border-left bi-border-bottom bi-border-right",width:e.width,scrollable:!1}),this.layout=BI.createWidget({type:"bi.vtape",element:this,items:[{el:this.headerContainer,height:2},{el:this.gridView,height:"fill"}]}),this.populate()},_rowHeightGetter:function(e){return this.rowHeights&&(e=this.rowHeights[e],BI.isNotNull(e))?e:this.options.rowSize},_layout:function(){var e=this.options,t=(this.headerContainer.empty(),e.headerRowSizeGetter()),t=BI.sum(t),n=(BI.createWidget({type:"bi.absolute",element:this.headerContainer,items:[{el:BI.extend({type:"bi.table_style_cell",height:t-2,cls:"sequence-table-title-cell",styleGetter:e.headerCellStyleGetter,text:BI.i18nText("BI-Number_Index"),_store:e.tableStyleCellStoreGetter},e.sequenceHeaderCreator()),left:0,top:0,right:0,bottom:0}]}),this.layout.attr("items")),n=(!1===e.isNeedFreeze?n[0].height=0:!0===e.isNeedFreeze&&(n[0].height=t),this.layout.attr("items",n),this.layout.resize(),this.numbers=this._formatNumber(e.items),0<e.items.length?BI.sum(this.rowHeights)/e.items.length:0);this.gridView.setEstimatedRowSize(n),this.gridView.setHeight(e.height-t)},_formatNumber:function(e){var r=this,i=this.options,o=this.rowHeights=i.rowSizeGetter();return BI.map(e,function(n,e){return BI.map(e,function(e,t){return{type:"bi.table_style_cell",cls:"sequence-table-number-cell bi-border-left bi-border-bottom bi-border-right "+(n%2!=0?"even-row":"odd-row"),width:i.width,height:o?o[n]:i.rowSize,text:r.start+n,styleGetter:function(){return i.sequenceCellStyleGetter(r.start+n-1)},_store:i.tableStyleCellStoreGetter}})})},_calculateChildrenToRender:function(){var e=this.options;this.gridView._populate(this.numbers),this.gridView.setScrollTop(e.scrollTop)},_populate:function(){this._calculateChildrenToRender()},setVerticalScroll:function(e){var t=this.options;t.scrollTop!==e&&(t.scrollTop=e,this.gridView.setScrollTop(t.scrollTop))},getVerticalScroll:function(){return this.options.scrollTop},setVPage:function(e){var t=this.options;this.start=((e=e<1?1:e)-1)*t.pageSize+1},setWidth:function(e){BI.SequenceTableListNumber.superclass.setWidth.apply(this,arguments),this.gridView.setWidth(e),this.headerContainer.setWidth(e)},_restore:function(){this.gridView.restore()},restore:function(){this._restore()},setPagesize:function(e){this.options.pageSize=e},populate:function(e,t){var n=this.options;e&&e!==this.options.items&&(n.items=e),t&&t!==this.options.header&&(n.header=t),this._restore(),this._layout(),this._populate()}}),BI.shortcut("bi.sequence_table_list_number",BI.SequenceTableListNumber)},function(e,t,n){"use strict";BI.SequenceTable=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.SequenceTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-sequence-table",el:{type:"bi.adaptive_table"},sequence:{},isNeedResize:!0,isNeedFreeze:!1,freezeCols:[],isNeedMerge:!1,mergeCols:[],mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,header:[],items:[],crossHeader:[],crossItems:[],showSequence:!1,startSequence:1,seqWidth:60})},_init:function(){BI.SequenceTable.superclass._init.apply(this,arguments);var e=this,t=this.options;this.table=BI.createWidget(t.el,{type:"bi.adaptive_table",width:!0===t.showSequence?t.width-t.seqWidth:t.width,height:t.height,isNeedResize:t.isNeedResize,isNeedFreeze:t.isNeedFreeze,freezeCols:t.freezeCols,isNeedMerge:t.isNeedMerge,mergeCols:t.mergeCols,mergeRule:t.mergeRule,columnSize:t.columnSize,minColumnSize:t.minColumnSize,maxColumnSize:t.maxColumnSize,headerRowSize:t.headerRowSize,rowSize:t.rowSize,regionColumnSize:t.regionColumnSize,headerCellStyleGetter:t.headerCellStyleGetter,summaryCellStyleGetter:t.summaryCellStyleGetter,sequenceCellStyleGetter:t.sequenceCellStyleGetter,tableStyleCellStoreGetter:t.tableStyleCellStoreGetter,header:t.header,items:t.items,crossHeader:t.crossHeader,crossItems:t.crossItems}),this.sequence=BI.createWidget(t.sequence,{type:"bi.sequence_table_list_number",invisible:!1===t.showSequence,startSequence:t.startSequence,isNeedFreeze:t.isNeedFreeze,header:t.header,items:t.items,crossHeader:t.crossHeader,crossItems:t.crossItems,headerRowSize:t.headerRowSize,rowSize:t.rowSize,rowSizeGetter:function(){return e.table.getFirstColumnRowSize()},headerRowSizeGetter:function(){return e.table.getFirstColumnHeaderRowSize()},width:t.seqWidth,height:t.height&&t.height-BI.GridTableScrollbar.SIZE,headerCellStyleGetter:t.headerCellStyleGetter,summaryCellStyleGetter:t.summaryCellStyleGetter,sequenceCellStyleGetter:t.sequenceCellStyleGetter,tableStyleCellStoreGetter:t.tableStyleCellStoreGetter}),this.table.on(BI.Table.EVENT_TABLE_SCROLL,function(){e.sequence.getVerticalScroll()!==this.getVerticalScroll()&&e.sequence.setVerticalScroll(this.getVerticalScroll()),e.fireEvent(BI.Table.EVENT_TABLE_SCROLL,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.sequence.setVerticalScroll(this.getVerticalScroll()),e.sequence.populate(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_REGION_RESIZE,arguments)}),this.table.on(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,function(){t.regionColumnSize=this.getRegionColumnSize(),t.columnSize=this.getColumnSize(),e.sequence.setVerticalScroll(this.getVerticalScroll()),e.sequence.populate(),e.fireEvent(BI.Table.EVENT_TABLE_AFTER_COLUMN_RESIZE,arguments)}),this.htape=BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.sequence,left:0,top:0},{el:this.table,top:0,left:!0===t.showSequence?t.seqWidth:0}]}),this._populate()},_populate:function(){var e=this.options;!0===e.showSequence?(this.sequence.setVisible(!0),this.table.element.css("left",e.seqWidth+"px"),this.table.setWidth(e.width-e.seqWidth),this.sequence.setWidth(e.seqWidth)):(this.sequence.setVisible(!1),this.table.element.css("left","0px"),this.table.setWidth(e.width))},setWidth:function(e){BI.PageTable.superclass.setWidth.apply(this,arguments),this.table.setWidth(this.options.showSequence?e-this.options.seqWidth:e)},setHeight:function(e){BI.PageTable.superclass.setHeight.apply(this,arguments),this.table.setHeight(e),this.sequence.setHeight(e-BI.GridTableScrollbar.SIZE)},setColumnSize:function(e){this.options.columnSize=e,this.table.setColumnSize(e)},getColumnSize:function(){return this.table.getColumnSize()},setRegionColumnSize:function(e){this.options.columnSize=e,this.table.setRegionColumnSize(e)},getRegionColumnSize:function(){return this.table.getRegionColumnSize()},hasLeftHorizontalScroll:function(){return this.table.hasLeftHorizontalScroll()},hasRightHorizontalScroll:function(){return this.table.hasRightHorizontalScroll()},setLeftHorizontalScroll:function(e){this.table.setLeftHorizontalScroll(e)},setRightHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},setVerticalScroll:function(e){this.table.setVerticalScroll(e),this.sequence.setVerticalScroll(e)},getVerticalScroll:function(){return this.table.getVerticalScroll()},setVPage:function(e){this.sequence.setVPage&&this.sequence.setVPage(e)},setHPage:function(e){this.sequence.setHPage&&this.sequence.setHPage(e)},attr:function(){BI.SequenceTable.superclass.attr.apply(this,arguments),this.table.attr.apply(this.table,arguments),this.sequence.attr.apply(this.sequence,arguments)},restore:function(){this.table.restore(),this.sequence.restore()},populate:function(e,t,n,r){var i=this.options;e&&(i.items=e),t&&(i.header=t),n&&(i.crossItems=n),r&&(i.crossHeader=r),this._populate(),this.table.populate.apply(this.table,arguments),this.sequence.populate.apply(this.sequence,arguments),this.sequence.setVerticalScroll(this.table.getVerticalScroll())},destroy:function(){this.table.destroy(),BI.SequenceTable.superclass.destroy.apply(this,arguments)}}),BI.shortcut("bi.sequence_table",BI.SequenceTable)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-spread-sequence-grid-table",el:{},isNeedResize:!0,freezeCols:[],columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,sequenceHeaderCreator:BI.emptyFn,sequenceSummaryText:BI.i18nText("BI-Summary_Values"),header:[],items:[],showSequence:!1,startSequence:1,seqWidth:60},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},render:function(){var e=this.options;this.contextLayout=BI.createWidget({type:"bi.vertical",element:this,scrolly:!1,scrollable:!0,items:[]}),this.header=this._getHeader(),this.items=this._getItems(),(0<e.header.length||0<e.items.length)&&this._populate()},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedFreeze?BI.clamp(e.freezeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(){var e=this.options;return e.header.length*e.headerRowSize},_getActualItems:function(){return this.options.items},_getHeader:function(){var e=this.options,r=[];return BI.each(e.header,function(n,e){r[n]=[],BI.each(e,function(e,t){r[n].push({type:"bi.grid_table_cell",extraCls:(0===n?"first-row":"")+(0===e?" first-col":""),cell:t})})}),r},_getItems:function(){var i=this.options,o=[],a=!(i.header&&0<i.header.length);return BI.each(this._getActualItems(),function(r,e){o[r]=[],BI.each(e,function(e,t){var n=i.customCell?(t&&(t.firstRowTopLine=a),n.extraCls=(0===r?"first-row":"")+(0===e?" first-col":""),t):{type:"bi.grid_table_cell",cell:t,extraCls:(0===r?"first-row":"")+(0===e?" first-col":""),firstRowTopLine:a};o[r].push(n)})}),o},_populateTable:function(){var r=this.options;this.getRegionSize(),this._getFreezeColLength();BI.each(r.columnSize,function(e,t){!0===r.isNeedFreeze&&r.freezeCols.includes(e)?0:0,e,0}),this.contextLayout.populate(BI.map(this.header,function(e,t){t={type:"bi.vertical_adapt",items:BI.map(t,function(e,t){return BI.extend({width:r.columnSize[e],height:r.headerRowSize},t)})};return r.showSequence?{type:"bi.vertical_adapt",items:[{type:"bi.table_style_cell",text:BI.i18nText("BI-Number_Index"),width:r.seqWidth,height:r.headerRowSize,styleGetter:r.headerCellStyleGetter,_store:r.tableStyleCellStoreGetter},t]}:t}).concat(BI.map(this.items,function(e,t){var n,t={type:"bi.vertical_adapt",verticalAlign:"stretch",items:BI.map(t,function(e,t){return BI.extend({width:r.columnSize[e],height:r.rowSize},t)})};return r.showSequence?{type:"bi.vertical_adapt",verticalAlign:"stretch",items:[{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:r.seqWidth,styleGetter:function(){return r.sequenceCellStyleGetter(n)},text:(n=e)+1,_store:r.tableStyleCellStoreGetter},t]}:t})))},_populate:function(){this._populateTable()},getRegionSize:function(){var n=this.options,r=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(r||BI.each(n.freezeCols,function(e,t){r+=n.columnSize[t]}),r)},setVerticalScroll:function(e){},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){},getLeftHorizontalScroll:function(){},getRightHorizontalScroll:function(){},setColumnSize:function(e){this.options.columnSize=e,this._isNeedDigest=!0},setRegionColumnSize:function(e){this.options.regionColumnSize=e,this._isNeedDigest=!0},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},populate:function(e,t){var n=this.options.header!==t,r=this.options.items!==e;t&&n&&(this.options.header=t),e&&r&&(this.options.items=e),e&&r&&(this.items=this._getItems()),t&&n&&(this.header=this._getHeader()),this._populate()},restore:function(){}}),BI.shortcut("bi.spread_sequence_grid_table",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-spread-sequence-layer-tree-table",el:{},isNeedResize:!0,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,isNeedMergeCol:!0,isNeedMergeRow:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,sequenceHeaderCreator:BI.emptyFn,sequenceSummaryText:BI.i18nText("BI-Summary_Values"),header:[],items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1,showSequence:!1,startSequence:1,seqWidth:60},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},_createHeader:function(e){var t=this.options,n=t.header||[],r=t.crossHeader||[],e=BI.isEmpty(n)?BI.TableTree.formatCrossItems4Special(t.crossItems,e,t.headerCellStyleGetter,{sumPosition:"right"===this.options.colPosition,summaryText:t.summaryText}):BI.TableTree.formatCrossItems(t.crossItems,e,t.headerCellStyleGetter,{sumPosition:"right"===this.options.colPosition,summaryText:t.summaryText}),i=[],e=(BI.each(e,function(e,t){e=[r[e]];i.push(e.concat(t||[]))}),BI.isFunction(t.rowHeaderCreator)?t.rowHeaderCreator():t.rowHeaderCreator);return n&&0<n.length&&(n=this._formatColumns(n),this._getHDeep()<=0?n.unshift(e||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter}):n[0]=e||{type:"bi.table_style_cell",text:BI.i18nText("BI-Row_Header"),styleGetter:t.headerCellStyleGetter,_store:t.tableStyleCellStoreGetter},i.push(n)),i},_formatItems:function(e,t,n){var r=this.options,i=[];return BI.each(e,function(e,t){var n;BI.each(t.children,function(e,t){!function r(e,n){e.type||(e.type="bi.layer_tree_table_cell"),e.layer=n;var t=[e];0<(t=t.concat(e.values||[])).length&&i.push(t),BI.isNotEmptyArray(e.children)&&BI.each(e.children,function(e,t){r(t,n+1)})}(t,0)}),BI.isArray(t.values)&&(n=[{type:"bi.table_style_cell",text:r.summaryText,title:r.summaryText,styleGetter:function(){return r.summaryCellStyleGetter(!0,BI.get(t,["children",0,"dId"]))},_store:r.tableStyleCellStoreGetter}].concat(t.values),"bottom"===r.rowPosition?i.push(n):i.unshift(n))}),BI.DynamicSummaryTreeTable.formatSummaryItems(i,t,r.crossItems,1)},_formatColumns:function(e,t){return BI.isNotEmptyArray(e)?(t=t||this._getHDeep(),e.slice(Math.max(0,t-1))):e},_formatFreezeCols:function(){return 0<this.options.freezeCols.length?[0]:[]},_formatMergeCols:function(){return 0<this.options.mergeCols.length?[0]:[]},_formatColumnSize:function(e,n){var r;return e.length<=0?[]:(r=[0],n=n||this._getHDeep(),BI.each(e,function(e,t){e<n?r[0]+=t:r.push(t)}),r)},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep(),n=this._createHeader(n),n=this._formatItems(e.items,n,t),r=e.columnSize.slice(),i=e.minColumnSize.slice(),e=e.maxColumnSize.slice();return BI.removeAt(r,n.deletedCols),BI.removeAt(i,n.deletedCols),BI.removeAt(e,n.deletedCols),{header:n.header,items:n.items,columnSize:this._formatColumnSize(r,t),minColumnSize:this._formatColumns(i,t),maxColumnSize:this._formatColumns(e,t),freezeCols:this._formatFreezeCols(),mergeCols:this._formatMergeCols()}},render:function(){var t=this,e=this.options,n=(this._width=0,this._height=0,this._digest());this.topRightCollection=BI.createWidget({type:"bi.collection_view",cellSizeAndPositionGetter:function(e){return t.topRightItems[e]}}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrolly:!1}),this.contextLayout=BI.createWidget({type:"bi.vertical",element:this,scrolly:!1,scrollable:!0,items:[e.showSequence?{type:"bi.vertical_adapt",items:[BI.extend({type:"bi.table_style_cell",text:BI.i18nText("BI-Number_Index"),width:e.seqWidth,height:this._getFreezeHeaderHeight(n.header),styleGetter:e.headerCellStyleGetter,ref:function(e){t.headerSeq=e},_store:e.tableStyleCellStoreGetter},e.sequenceHeaderCreator()),this.topRightCollection]}:{el:this.topRightCollection},{el:this.bottomRight}]}),(0<n.header.length||0<n.items.length)&&(this._digestTable(n.header,n.items,n),this._populate(n.header,n.items,n))},populate:function(e,t,n,r){var i=this.options,n=(e&&(i.items=e),t&&(i.header=t),n&&(i.crossItems=n),r&&(i.crossHeader=r),this._digest());this.headerSeq&&this.headerSeq.setHeight(this._getFreezeHeaderHeight(n.header)),e=n.items,t=n.header,e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate(t,e,n)},_getFreezeHeaderHeight:function(e){var t=this.options;return e.length*t.headerRowSize},_populateTable:function(e,t,n){var a=this.options,r=(this.getRegionSize(),0),i=(BI.each(a.columnSize,function(e,t){!0===a.isNeedFreeze&&a.freezeCols.includes(e)?0:0,r+=t,e,0}),this.topRightCollection.setWidth(r),this.topRightCollection.setHeight(this._getFreezeHeaderHeight(e)),[]);(function(e,n,r,i,o){BI.each(e,function(e,t){!i&&a.customCell?(n[t.row][t.col]._rowIndex=t.row,n[t.row][t.col]._columnIndex=t.col,n[t.row][t.col].firstRowTopLine=i,n[t.row][t.col].firstColumnLeftLine=o,r.push(n[t.row][t.col])):(t={type:"bi.collection_table_cell",cell:n[t.row][t.col],_rowIndex:t.row,_columnIndex:t.col,firstRowTopLine:i,firstColumnLeftLine:o},r.push(t))})})(this.topRightItems,e,i,!0,!0),this.topRightCollection._populate(i),this.bottomRight.populate(this.bottomRightItems)},_digestTable:function(e,t,n){var r=this.options,i=!0===r.isNeedMerge?BI.clamp(n.mergeCols.length,0,n.columnSize.length):0;this.topRightItems=BI.CollectionTable.serialize(e,0,n.columnSize.length,r.headerRowSize,n.columnSize,!0,[],r.mergeRule),this.bottomRightItems=this._serializeItems(t,0,i,r.rowSize,n.columnSize,n.mergeCols)},_serializeItems:function(a,o,s,i,l,c,u){c=c||[],u=u||[];for(var h=this.options,d=h.startSequence,p=[],f={},m={},g={},b={},y=[],e=o;e<s;e++)y[e]=e===o?l[e]:y[e-1]+l[e];var r,v=function v(e,t){m[t]._height+=i,m[t].__mergeRows.push(e),g[e]=m[t]},_=function _(e,t){g[e]._width+=l[t],g[e].__mergeCols.push(t)},I=function I(e,t){var n=l[t],r=i,n=(b[e][t]._row=e,b[e][t]._col=t,b[e][t]._width=n,b[e][t]._height=r,{x:y[t]-l[t],y:+e*i,item:b[e][t]});m[t]=b[e][t],m[t].__mergeRows=[e],g[e]=b[e][t],g[e].__mergeCols=[t],p.push(n)},x=(BI.each(a,function(e,t){for(var n,r,i=o;i<s;i++)f[e]||(f[e]={}),b[e]||(b[e]={}),f[e][i]=t[i],b[e][i]={},!0===c||-1<c.indexOf(i)||!0===u||-1<u.indexOf(e)?0===e&&i===o?I(0,o):i===o&&0<e?!0===(n=h.mergeRule(f[e][i],f[e-1][i]))?(v(e,i),g[e]=m[i]):I(e,i):0===e&&o<i?!0===(r=h.mergeRule(f[e][i],f[e][i-1]))?(_(e,i),m[i]=g[e]):I(e,i):(n=h.mergeRule(f[e][i],f[e-1][i]),(r=h.mergeRule(f[e][i],f[e][i-1]))&&n||(r&&_(e,i),n&&v(e,i),r||n||I(e,i))):I(e,i)}),[]),n=(BI.each(p,function(e,t){var n=a[t.item._row][t.item._col];(!n.layer||n.layer<=r)&&(x=x.slice(0,n.layer||0)),t.parent=x[x.length-1],n.children&&0!==n.children.length?(x.push(t),r=n.layer):t.isLastNode=!0}),[]),E=BI.UUID();function S(e,t,n){return BI.extend({type:"bi.label",textAlign:"left",lgap:25,width:e.item._width,_columnIndex:e.item._col,_rowIndex:e.item._row,firstRowTopLine:!1,firstColumnLeftLine:!0,extraCls:"collection-cell"+(0===e.item._row?" first-row":"")+(0===e.item._col?" first-col":""),mounted:function(){e.isLastNode||BI.createWidget({type:"bi.absolute_vertical_adapt",element:this,lgap:6,items:[{type:"bi.icon_button",tagName:"label",attributes:{"for":E+"-"+e.item._row+"-"+e.item._col},cls:(n?"plus-font":"minus-font")+" icon-size-12",iconWidth:12,iconHeight:12,width:12,height:12}]})}},t,a[e.item._row][e.item._col])}function T(e,t){t=b[e][t];return"bottom"===h.rowPosition?e+t.__mergeRows.length-1:e}function C(e){e=a[e].slice(s);return{type:"bi.vertical_adapt",items:BI.map(e,function(e,t){return BI.extend({type:"bi.label",width:l[s+e],height:i,extraCls:"collection-cell"},t)})}}return BI.each(p,function(e,t){var n,r,i=a.length-1===t.item._row,o={type:"bi.vertical",scrolly:!1,items:[{type:"bi.layout",tagName:"input",cls:"spread-sequence-table-checkbox",invisible:!0,attributes:{type:"checkbox",id:E+"-"+t.item._row+"-"+t.item._col}},a[t.item._row][t.item._col].children?{type:"bi.vertical_adapt",cls:"summary-line",verticalAlign:"stretch",items:[t.parent||!0!==h.showSequence?{type:"bi.layout"}:{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:h.seqWidth,styleGetter:(r=d,function(){return i?h.summaryCellStyleGetter(!0):h.sequenceCellStyleGetter(r)}),text:i?h.summaryText:d,_store:h.tableStyleCellStoreGetter},{el:S(t,{width:y[s-1]-(0<t.item._col?y[t.item._col-1]:0)},!0)},C(T(t.item._row,t.item._col))]}:{type:"bi.layout"},{type:"bi.vertical_adapt",cls:"expand-line",verticalAlign:"stretch",items:[t.parent||!0!==h.showSequence?{type:"bi.layout"}:{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:h.seqWidth,styleGetter:(n=d,function(){return i?h.summaryCellStyleGetter(!0):h.sequenceCellStyleGetter(n)}),text:i?h.summaryText:d++,_store:h.tableStyleCellStoreGetter},{type:"bi.vertical",items:[{el:{type:"bi.vertical_adapt",verticalAlign:"stretch",items:[{el:S(t)},C(T(t.item._row,t.item._col))]}},{type:"bi.vertical",scrolly:!1,items:[]}]}]}]};t.layout=o,t.parent&&t.parent.layout.items[2].items[1].items[1].items.push(o)}),BI.each(p,function(e,t){t.parent||n.push(t.layout)}),n},_populate:function(e,t,n){!0===this._isNeedDigest&&this._digestTable(e,t,n),this._isNeedDigest=!1,this._populateTable(e,t,n)},getRegionSize:function(){var n=this.options,r=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(r||BI.each(n.freezeCols,function(e,t){r+=n.columnSize[t]}),r)},setVerticalScroll:function(e){},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){},getLeftHorizontalScroll:function(){},getRightHorizontalScroll:function(){},setColumnSize:function(e){this._isNeedDigest=!0,this.options.columnSize=e},setRegionColumnSize:function(e){this._isNeedDigest=!0,this.options.regionColumnSize=e},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},_restore:function(){this.topRightCollection.restore()},restore:function(){this._restore()}}),BI.shortcut("bi.spread_sequence_layer_tree_table",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-spread-sequence-list-table",el:{},isNeedResize:!0,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,isNeedMergeCol:!0,isNeedMergeRow:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,sequenceHeaderCreator:BI.emptyFn,sequenceSummaryText:BI.i18nText("BI-Summary_Values"),header:[],items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1,showSequence:!1,startSequence:1,seqWidth:60},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},render:function(){var t=this,e=this.options,n=(this._width=0,this._height=0,this._digest());this.topRightCollection=BI.createWidget({type:"bi.collection_view",cellSizeAndPositionGetter:function(e){return t.topRightItems[e]}}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrolly:!1}),this.contextLayout=BI.createWidget({type:"bi.vertical",element:this,scrolly:!1,scrollable:!0,items:[e.showSequence?{type:"bi.vertical_adapt",items:[BI.extend({type:"bi.table_style_cell",text:BI.i18nText("BI-Number_Index"),width:e.seqWidth,height:this._getFreezeHeaderHeight(n.header),styleGetter:e.headerCellStyleGetter,ref:function(e){t.headerSeq=e},_store:e.tableStyleCellStoreGetter},e.sequenceHeaderCreator()),this.topRightCollection]}:{el:this.topRightCollection},{el:this.bottomRight}]}),(0<n.header.length||0<n.items.length)&&(this._digestTable(n.header,n.items),this._populate(n.header,n.items))},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep(),n=BI.TableTree.formatHeader(e.header,e.crossHeader,e.crossItems,t,n,e.headerCellStyleGetter,{sumPosition:"right"===e.colPosition,summaryText:e.summaryText}),r=BI.DynamicSummaryTreeTable.formatHorizontalItems(e.items,t,!1,e.summaryCellStyleGetter,{sumPosition:"bottom"===e.rowPosition,summaryText:e.summaryText,isNeedMergeRow:e.isNeedMergeRow,tableStyleCellStoreGetter:e.tableStyleCellStoreGetter}),r=BI.DynamicSummaryTreeTable.formatSummaryItems(r,n,e.crossItems,t),n=e.columnSize.slice(),t=e.minColumnSize.slice(),e=e.maxColumnSize.slice();return BI.removeAt(n,r.deletedCols),BI.removeAt(t,r.deletedCols),BI.removeAt(e,r.deletedCols),{header:r.header,items:r.items,columnSize:n,minColumnSize:t,maxColumnSize:e}},populate:function(e,t,n,r){var i=this.options,n=(e&&(i.items=e),t&&(i.header=t),n&&(i.crossItems=n),r&&(i.crossHeader=r),this._digest());this.headerSeq&&this.headerSeq.setHeight(this._getFreezeHeaderHeight(n.header)),this.setColumnSize(n.columnSize),i.minColumnSize=n.minColumnSize,i.maxColumnSize=n.maxColumnSize,e=n.items,t=n.header,e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate(t,e)},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedMerge?BI.clamp(e.mergeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(e){var t=this.options;return e.length*t.headerRowSize},_populateTable:function(e,t){var a=this.options,n=(this.getRegionSize(),0),r=(BI.each(a.columnSize,function(e,t){!0===a.isNeedFreeze&&a.freezeCols.includes(e)?0:0,n+=t,e,0}),this.topRightCollection.setWidth(n),this.topRightCollection.setHeight(this._getFreezeHeaderHeight(e)),[]);(function(e,n,r,i,o){BI.each(e,function(e,t){!i&&a.customCell?(n[t.row][t.col]._rowIndex=t.row,n[t.row][t.col]._columnIndex=t.col,n[t.row][t.col].firstRowTopLine=i,n[t.row][t.col].firstColumnLeftLine=o,r.push(n[t.row][t.col])):(t={type:"bi.collection_table_cell",cell:n[t.row][t.col],_rowIndex:t.row,_columnIndex:t.col,firstRowTopLine:i,firstColumnLeftLine:o},r.push(t))})})(this.topRightItems,e,r,!0,!0),this.topRightCollection._populate(r),this.bottomRight.populate(this.bottomRightItems)},_digestTable:function(e,t){var n=this.options,r=this._getFreezeColLength();this.topRightItems=BI.CollectionTable.serialize(e,0,n.columnSize.length,n.headerRowSize,n.columnSize,!0,[],n.mergeRule),this.bottomRightItems=this._serializeItems(t,0,r,n.rowSize,n.columnSize,n.mergeCols)},_serializeItems:function(s,o,a,l,i,c,u){c=c||[],u=u||[];for(var h=this.options,d=h.startSequence,p=[],f={},m={},g={},b={},y=[],e=o;e<a;e++)y[e]=e===o?i[e]:y[e-1]+i[e];var v=function v(e,t){m[t]._height+=l,m[t].__mergeRows.push(e),g[e]=m[t]},_=function _(e,t){g[e]._width+=i[t],g[e].__mergeCols.push(t)},I=function I(e,t){var n=i[t],r=l,n=(b[e][t]._row=e,b[e][t]._col=t,b[e][t]._width=n,b[e][t]._height=r,{x:y[t]-i[t],y:+e*l,item:b[e][t],parent:g[e]&&g[e].el});m[t]=b[e][t],m[t].__mergeRows=[e],g[e]=b[e][t],g[e].__mergeCols=[t],g[e].el=n,p.push(n)},r=(BI.each(s,function(e,t){for(var n,r,i=o;i<a;i++)f[e]||(f[e]={}),b[e]||(b[e]={}),f[e][i]=t[i],b[e][i]={},!0===c||-1<c.indexOf(i)||!0===u||-1<u.indexOf(e)?0===e&&i===o?I(0,o):i===o&&0<e?!0===(n=h.mergeRule(f[e][i],f[e-1][i]))?(v(e,i),g[e]=m[i]):I(e,i):0===e&&o<i?!0===(r=h.mergeRule(f[e][i],f[e][i-1]))?(_(e,i),m[i]=g[e]):I(e,i):(n=h.mergeRule(f[e][i],f[e-1][i]),(r=h.mergeRule(f[e][i],f[e][i-1]))&&n||(r&&_(e,i),n&&v(e,i),r||n||I(e,i))):I(e,i)}),[]),x=BI.UUID();function E(e,t,n,r){return BI.extend({type:"bi.label",textAlign:"left",lgap:25,width:e.item._width,height:l,_columnIndex:e.item._col,_rowIndex:e.item._row,firstRowTopLine:!1,firstColumnLeftLine:!0,extraCls:"collection-cell"+(0===e.item._row?" first-row":"")+(0===e.item._col?" first-col":""),mounted:function(){r&&!e.isLastNode&&BI.createWidget({type:"bi.absolute_vertical_adapt",element:this,lgap:6,items:[{type:"bi.icon_button",tagName:"label",attributes:{"for":x+"-"+e.item._row+"-"+e.item._col},cls:(n?"plus-font":"minus-font")+" icon-size-12",iconWidth:12,iconHeight:12,width:12,height:12}]})}},t,s[e.item._row][e.item._col])}function S(e,t,n){var r,i,o=E(e,t,n,!0),a=s[e.item._row][e.item._col],a=!a.children||0===a.children.length;return e.parent||!0!==h.showSequence?a?[{el:o}]:BI.map([o].concat(BI.map(BI.range(e.item.__mergeRows.length-1),function(){return E(e,t,n,!1)})),function(e,t){return{el:t,height:l}}):(r=s.length-1===e.item._row,{type:"bi.vertical_adapt",verticalAlign:"stretch",items:[{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:h.seqWidth,styleGetter:(i=d,function(){return r?h.summaryCellStyleGetter(!0):h.sequenceCellStyleGetter(i)}),text:n?d:r?h.summaryText:d++,_store:h.tableStyleCellStoreGetter},{el:{type:"bi.vtape",width:e.item._width,scrolly:!1,scrollable:!1,items:a?[{el:o}]:BI.map([o].concat(BI.map(BI.range(e.item.__mergeRows.length-1),function(){return E(e,t,n,!1)})),function(e,t){return{el:t,height:l}})}}]})}function T(e){return e.layout.items[2].items[1].items}function C(e){e=s[e].slice(a);return{type:"bi.vertical_adapt",items:BI.map(e,function(e,t){return BI.extend({type:"bi.label",width:i[a+e],height:l,extraCls:"collection-cell"},t)})}}return BI.each(p,function(e,t){var n,r,i,o={type:"bi.vertical",scrolly:!1,items:[{type:"bi.layout",tagName:"input",cls:"spread-sequence-table-checkbox",invisible:!0,attributes:{type:"checkbox",id:x+"-"+t.item._row+"-"+t.item._col}},s[t.item._row][t.item._col].children?{type:"bi.vertical_adapt",verticalAlign:"stretch",cls:"summary-line",items:[{el:(n={width:y[a-1]-(0<(o=t).item._col?y[t.item._col-1]:0)},n=E(o,n,r=!0,!0),o.parent||!0!==h.showSequence?n:(i=s.length-1===o.item._row,{type:"bi.vertical_adapt",verticalAlign:"stretch",items:[{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:h.seqWidth,styleGetter:function(e){return function(){return i?h.summaryCellStyleGetter(!0):h.sequenceCellStyleGetter(e)}}(d),text:r?d:i?h.summaryText:d++,_store:h.tableStyleCellStoreGetter},{el:n}]}))},C(function(e,t){t=b[e][t];return"bottom"===h.rowPosition?e+t.__mergeRows.length-1:e}(t.item._row,t.item._col))]}:{type:"bi.layout"},{type:"bi.vertical_adapt",verticalAlign:"stretch",cls:"expand-line",items:[{el:t.parent||!0!==h.showSequence?{type:"bi.vtape",width:t.item._width,scrolly:!1,scrollable:!1,items:S(t)}:S(t)},{type:"bi.vertical",scrolly:!1,items:[]}]}]};t.layout=o,t.parent&&T(t.parent).push(o)}),BI.each(p,function(e,t){var n;0===T(t).length&&(n=C(t.item._row),t.isLastNode=!0,T(t).push(n)),t.parent||r.push(t.layout)}),r},_populate:function(e,t){!0===this._isNeedDigest&&this._digestTable(e,t),this._isNeedDigest=!1,this._populateTable(e,t)},getRegionSize:function(){var n=this.options,r=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(r||BI.each(n.freezeCols,function(e,t){r+=n.columnSize[t]}),r)},setVerticalScroll:function(e){},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){},getLeftHorizontalScroll:function(){},getRightHorizontalScroll:function(){},setColumnSize:function(e){this._isNeedDigest=!0,this.options.columnSize=e},setRegionColumnSize:function(e){this._isNeedDigest=!0,this.options.regionColumnSize=e},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},_restore:function(){this.topRightCollection.restore()},restore:function(){this._restore()}}),BI.shortcut("bi.spread_sequence_list_table",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-spread-sequence-table",el:{},isNeedResize:!0,freezeCols:[],isNeedMerge:!0,mergeCols:[],mergeRule:BI.emptyFn,isNeedMergeCol:!0,isNeedMergeRow:!0,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:25,rowSize:25,regionColumnSize:[],headerCellStyleGetter:BI.emptyFn,summaryCellStyleGetter:BI.emptyFn,sequenceCellStyleGetter:BI.emptyFn,tableStyleCellStoreGetter:null,sequenceHeaderCreator:BI.emptyFn,sequenceSummaryText:BI.i18nText("BI-Summary_Values"),header:[],items:[],crossHeader:[],crossItems:[],summaryText:BI.i18nText("BI-Summary_Values"),rowPosition:"bottom",colPosition:"right",showInnerSummary:!1,showSequence:!1,startSequence:1,seqWidth:60},_getVDeep:function(){return this.options.crossHeader.length},_getHDeep:function(){var e=this.options;return Math.max(e.mergeCols.length,e.freezeCols.length,BI.TableTree.maxDeep(e.items)-1)},render:function(){var t=this,e=this.options,n=(this._width=0,this._height=0,this._digest());this.topRightCollection=BI.createWidget({type:"bi.collection_view",cellSizeAndPositionGetter:function(e){return t.topRightItems[e]}}),this.bottomRight=BI.createWidget({type:"bi.vertical",scrolly:!1}),this.contextLayout=BI.createWidget({type:"bi.vertical",element:this,scrolly:!1,scrollable:!0,items:[e.showSequence?{type:"bi.vertical_adapt",items:[BI.extend({type:"bi.table_style_cell",text:BI.i18nText("BI-Number_Index"),width:e.seqWidth,height:this._getFreezeHeaderHeight(n.header),styleGetter:e.headerCellStyleGetter,ref:function(e){t.headerSeq=e},_store:e.tableStyleCellStoreGetter},e.sequenceHeaderCreator()),this.topRightCollection]}:{el:this.topRightCollection},{el:this.bottomRight}]}),(0<n.header.length||0<n.items.length)&&(this._digestTable(n.header,n.items),this._populate(n.header,n.items))},_digest:function(){var e=this.options,t=this._getHDeep(),n=this._getVDeep(),n=BI.TableTree.formatHeader(e.header,e.crossHeader,e.crossItems,t,n,e.headerCellStyleGetter,{sumPosition:"right"===e.colPosition,summaryText:e.summaryText}),r=BI.DynamicSummaryTreeTable.formatHorizontalItems(e.items,t,!1,e.summaryCellStyleGetter,{sumPosition:"bottom"===e.rowPosition,summaryText:e.summaryText,isNeedMergeRow:e.isNeedMergeRow,tableStyleCellStoreGetter:e.tableStyleCellStoreGetter}),r=BI.DynamicSummaryTreeTable.formatSummaryItems(r,n,e.crossItems,t),n=e.columnSize.slice(),t=e.minColumnSize.slice(),e=e.maxColumnSize.slice();return BI.removeAt(n,r.deletedCols),BI.removeAt(t,r.deletedCols),BI.removeAt(e,r.deletedCols),{header:r.header,items:r.items,columnSize:n,minColumnSize:t,maxColumnSize:e}},populate:function(e,t,n,r){var i=this.options,n=(e&&(i.items=e),t&&(i.header=t),n&&(i.crossItems=n),r&&(i.crossHeader=r),this._digest());this.headerSeq&&this.headerSeq.setHeight(this._getFreezeHeaderHeight(n.header)),this.setColumnSize(n.columnSize),i.minColumnSize=n.minColumnSize,i.maxColumnSize=n.maxColumnSize,e=n.items,t=n.header,e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate(t,e)},_getFreezeColLength:function(){var e=this.options;return!0===e.isNeedMerge?BI.clamp(e.mergeCols.length,0,e.columnSize.length):0},_getFreezeHeaderHeight:function(e){var t=this.options;return e.length*t.headerRowSize},_populateTable:function(e,t){var a=this.options,n=(this.getRegionSize(),0),r=(BI.each(a.columnSize,function(e,t){!0===a.isNeedFreeze&&a.freezeCols.includes(e)?0:0,n+=t,e,0}),this.topRightCollection.setWidth(n),this.topRightCollection.setHeight(this._getFreezeHeaderHeight(e)),[]);(function(e,n,r,i,o){BI.each(e,function(e,t){!i&&a.customCell?(n[t.row][t.col]._rowIndex=t.row,n[t.row][t.col]._columnIndex=t.col,n[t.row][t.col].firstRowTopLine=i,n[t.row][t.col].firstColumnLeftLine=o,r.push(n[t.row][t.col])):(t={type:"bi.collection_table_cell",cell:n[t.row][t.col],_rowIndex:t.row,_columnIndex:t.col,firstRowTopLine:i,firstColumnLeftLine:o},r.push(t))})})(this.topRightItems,e,r,!0,!0),this.topRightCollection._populate(r),this.bottomRight.populate(this.bottomRightItems)},_digestTable:function(e,t){var n=this.options,r=this._getFreezeColLength();this.topRightItems=BI.CollectionTable.serialize(e,0,n.columnSize.length,n.headerRowSize,n.columnSize,!0,[],n.mergeRule),this.bottomRightItems=this._serializeItems(t,0,r,n.rowSize,n.columnSize,n.mergeCols)},_serializeItems:function(o,a,s,i,l,c,u){c=c||[],u=u||[];for(var h=this.options,d=h.startSequence,p=[],f={},m={},g={},b={},y=[],e=a;e<s;e++)y[e]=e===a?l[e]:y[e-1]+l[e];var v=function v(e,t){m[t]._height+=i,m[t].__mergeRows.push(e),g[e]=m[t]},_=function _(e,t){g[e]._width+=l[t],g[e].__mergeCols.push(t)},I=function I(e,t){var n=l[t],r=i,n=(b[e][t]._row=e,b[e][t]._col=t,b[e][t]._width=n,b[e][t]._height=r,{x:y[t]-l[t],y:+e*i,item:b[e][t],parent:g[e]&&g[e].el});m[t]=b[e][t],m[t].__mergeRows=[e],g[e]=b[e][t],g[e].__mergeCols=[t],g[e].el=n,p.push(n)},r=(BI.each(o,function(e,t){for(var n,r,i=a;i<s;i++)f[e]||(f[e]={}),b[e]||(b[e]={}),f[e][i]=t[i],b[e][i]={},!0===c||-1<c.indexOf(i)||!0===u||-1<u.indexOf(e)?0===e&&i===a?I(0,a):i===a&&0<e?!0===(n=h.mergeRule(f[e][i],f[e-1][i]))?(v(e,i),g[e]=m[i]):I(e,i):0===e&&a<i?!0===(r=h.mergeRule(f[e][i],f[e][i-1]))?(_(e,i),m[i]=g[e]):I(e,i):(n=h.mergeRule(f[e][i],f[e-1][i]),(r=h.mergeRule(f[e][i],f[e][i-1]))&&n||(r&&_(e,i),n&&v(e,i),r||n||I(e,i))):I(e,i)}),[]),x=BI.UUID();function E(e,t,n){var r,i,t=BI.extend({type:"bi.label",textAlign:"left",lgap:25,width:e.item._width,_columnIndex:e.item._col,_rowIndex:e.item._row,firstRowTopLine:!1,firstColumnLeftLine:!0,extraCls:"collection-cell"+(0===e.item._row?" first-row":"")+(0===e.item._col?" first-col":""),mounted:function(){e.isLastNode||BI.createWidget({type:"bi.absolute_vertical_adapt",element:this,lgap:6,items:[{type:"bi.icon_button",tagName:"label",attributes:{"for":x+"-"+e.item._row+"-"+e.item._col},cls:(n?"plus-font":"minus-font")+" icon-size-12",iconWidth:12,iconHeight:12,width:12,height:12}]})}},t,o[e.item._row][e.item._col]);return e.parent||!0!==h.showSequence?t:(r=o.length-1===e.item._row,{type:"bi.vertical_adapt",verticalAlign:"stretch",items:[{type:"bi.table_style_cell",cls:"sequence-table-title-cell",width:h.seqWidth,styleGetter:(i=d,function(){return r?h.summaryCellStyleGetter(!0):h.sequenceCellStyleGetter(i)}),text:n?d:r?h.summaryText:d++,_store:h.tableStyleCellStoreGetter},{el:t}]})}function S(e){return e.layout.items[2].items[1].items}function T(e){e=o[e].slice(s);return{type:"bi.vertical_adapt",items:BI.map(e,function(e,t){return BI.extend({type:"bi.label",width:l[s+e],height:i,extraCls:"collection-cell"},t)})}}return BI.each(p,function(e,t){var n={type:"bi.vertical",scrolly:!1,items:[{type:"bi.layout",tagName:"input",cls:"spread-sequence-table-checkbox",invisible:!0,attributes:{type:"checkbox",id:x+"-"+t.item._row+"-"+t.item._col}},o[t.item._row][t.item._col].children?{type:"bi.vertical_adapt",verticalAlign:"stretch",cls:"summary-line",items:[{el:E(t,{width:y[s-1]-(0<t.item._col?y[t.item._col-1]:0)},!0)},T(function(e,t){t=b[e][t];return"bottom"===h.rowPosition?e+t.__mergeRows.length-1:e}(t.item._row,t.item._col))]}:{type:"bi.layout"},{type:"bi.vertical_adapt",verticalAlign:"stretch",cls:"expand-line",items:[{el:E(t)},{type:"bi.vertical",scrolly:!1,items:[]}]}]};t.layout=n,t.parent&&S(t.parent).push(n)}),BI.each(p,function(e,t){var n;0===S(t).length&&(n=T(t.item._row),t.isLastNode=!0,S(t).push(n)),t.parent||r.push(t.layout)}),r},_populate:function(e,t){!0===this._isNeedDigest&&this._digestTable(e,t),this._isNeedDigest=!1,this._populateTable(e,t)},getRegionSize:function(){var n=this.options,r=n.regionColumnSize[0]||0;return!1===n.isNeedFreeze||0===n.freezeCols.length?0:(r||BI.each(n.freezeCols,function(e,t){r+=n.columnSize[t]}),r)},setVerticalScroll:function(e){},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){},getLeftHorizontalScroll:function(){},getRightHorizontalScroll:function(){},setColumnSize:function(e){this._isNeedDigest=!0,this.options.columnSize=e},setRegionColumnSize:function(e){this._isNeedDigest=!0,this.options.regionColumnSize=e},getColumnSize:function(){return this.options.columnSize},getRegionColumnSize:function(){return this.options.regionColumnSize},_restore:function(){this.topRightCollection.restore()},restore:function(){this._restore()}}),BI.shortcut("bi.spread_sequence_table",r)},function(e,t,n){"use strict";n(42);var i=n(72),h=(n(71),["items","id","pId","layer","isParent","draggable","checkable","open","prevComponent"]);function d(e,t){if(null==e)return{};var n,r=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],0<=t.indexOf(n)||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),o=0;o<i.length;o++)n=i[o],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}function r(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){a(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}var s=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(s.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-sticky-table",headerRowSize:30,rowSize:30,columnSize:[],minColumnSize:[],maxColumnSize:[],freezeCols:[0],scrollLeft:0,scrollTop:0,sortable:!0,checkable:!0,bordered:!1,stripe:!1,hover:!1,header:[],items:[],itemsCreator:BI.emptyFn})},render:function(){var e,n=this,t=this,r=this.options;this.headerColletion=BI.createWidget({type:"bi.sticky_table_header",css:{overflowY:"scroll",overflowX:"hidden"},columnSize:r.columnSize,minColumnSize:r.minColumnSize,maxColumnSize:r.maxColumnSize,freezeCols:r.freezeCols.slice(),header:r.header,headerRowSize:r.headerRowSize}),this.bottomRightCollection=BI.createWidget({type:"bi.virtual_tree_list",css:{overflowY:"scroll",overflowX:"auto"},items:this._formatItems(r.items),itemsCreator:function(e,t){r.itemsCreator(e,function(e){t(n._formatItems(e))})},el:{type:"bi.virtual_group_list",configRender:function(e){return o(o({},e),{},{scrolly:!1})},listeners:[{eventName:"EVENT_CHANGE",action:function(){t.fireEvent("EVENT_CHANGE",arguments)}}],rowHeight:r.rowSize,el:{type:"bi.sticky_table_layout",ref:function(e){n.tableColletion=e},mirror:{appendTo:this.element[0]},columnSize:r.columnSize,minColumnSize:r.minColumnSize,maxColumnSize:r.maxColumnSize,isNeedFreeze:r.isNeedFreeze,freezeCols:r.freezeCols.slice(),sortable:r.sortable,checkable:r.checkable,listeners:(a(e={},i.StickyTableLayout.EVENT_STOP_DRAG,function(e){BI.nextTick(function(){n.bottomRightCollection.move(e[0],e[1]),n.fireEvent("EVENT_STOP_DRAG",n.bottomRightCollection.getTree(),e[0],e[1]),n.fireEvent("EVENT_SORT",n.bottomRightCollection.getTree(),e[0],e[1])})}),a(e,i.StickyTableLayout.EVENT_START_DRAG,function(e){r.scrollLeft=0,n._scrollHandler(),n.bottomRightCollection.element.scrollLeft(0),n.headerColletion.element.scrollLeft(0),n.fireEvent("EVENT_START_DRAG",n.bottomRightCollection.getTree(),e)}),e)}}}),this.contextLayout=BI.createWidget({type:"bi.vertical_fill",rowSize:["","fill"],cls:"".concat(r.bordered?"bordered":""," ").concat(r.stripe?"stripe":""," ").concat(r.hover?"hover":""),element:this,items:[{el:this.headerColletion},{el:this.bottomRightCollection}]})},_scrollHandler:function(){var e=this.options,t=(0<e.scrollLeft?this.element.addClass("fixed-left-scroll"):this.element.removeClass("fixed-left-scroll"),this.tableColletion.table.element.width()),n=this.element.width();t-(e.scrollLeft+n-BI.GridTableScrollbar.SIZE)<1?this.element.removeClass("fixed-right-scroll"):this.element.addClass("fixed-right-scroll")},_freeHandler:function(){var n,r=this;this._hasOtherFreezeCol()&&(n=this.headerColletion.getRealColumnSize(),this.options.freezeCols.forEach(function(e){var t=r.options.header[0].length;0!==e&&e!==t-1&&r.element[0].style.setProperty("--index-".concat(e,"-left"),"".concat(n.slice(0,e).reduce(function(e,t){return t+e},0),"px"))}))},_handleResize:function(){this.options.scrollLeft=this.bottomRightCollection.element.scrollLeft(),this._scrollHandler(),this._freeHandler()},_hasOtherFreezeCol:function(){var r=this.options;return BI.some(r.freezeCols,function(e,t){var n=r.header[0].length;if(0!==t&&t!==n-1)return!0})},mounted:function(){var e=this,t=this.options;(0<t.header.length||0<t.items.length)&&(this._digest(),this._populate()),this._scrollHandler(),this._freeHandler(),this.bottomRightCollection.element.scroll(function(){t.scrollTop=e.bottomRightCollection.element.scrollTop(),t.scrollLeft=e.bottomRightCollection.element.scrollLeft(),e._scrollHandler(),e.headerColletion.element.scrollLeft(t.scrollLeft)}),this.resizeObserver=BI.ResizeDetector.addResizeListener(this,this._handleResize.bind(this))},destroyed:function(){this.resizeObserver()},_populateTable:function(){var e=this.options;this.headerColletion.populate(e.header),this.bottomRightCollection.populate(this._formatItems(e.items))},_formatItems:function(e){var u=this;return e.map(function(e){var t=e.items,n=e.id,r=e.pId,i=e.layer,o=e.isParent,a=e.draggable,s=e.checkable,l=e.open,c=e.prevComponent,e=d(e,h);return{type:"bi.sticky_table_row",id:n,pId:r,layer:i,isParent:o,draggable:a,checkable:s,prevComponent:c,open:l,height:u.options.rowSize,dimension:e,items:t}})},_digest:function(){this.options},_populate:function(){this._populateTable()},setVerticalScroll:function(e){return this.bottomRightCollection.scrollTo(e)},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){return this.options.scrollTop},getRightHorizontalScroll:function(){return this.options.scrollLeft},setWidth:function(e){s.superclass.setWidth.apply(this,arguments),this._width=this.options.width-BI.GridTableScrollbar.SIZE},setHeight:function(e){s.superclass.setHeight.apply(this,arguments),this._height=this.options.height-BI.GridTableScrollbar.SIZE},setColumnSize:function(e){this.options;this._isNeedDigest=!0,this.options.columnSize=e,this.headerColletion.setColumnSize(e),this.tableColletion.setColumnSize(e),this._scrollHandler(),this._freeHandler()},getColumnSize:function(){return this.options.columnSize},getRegionSize:function(){return 0},getRegionColumnSize:function(){return[]},setRegionColumnSize:function(){},getValue:function(){return this.bottomRightCollection.getValue()},populate:function(e,t){e&&e!==this.options.items&&(this._isNeedDigest=!0,this.options.items=e,this._restore()),t&&t!==this.options.header&&(this._isNeedDigest=!0,this.options.header=t,this._restore()),this._populate()},_restore:function(){},restore:function(){this._restore()}}),l=(BI.shortcut("bi.freeze_table",s),BI.TableComponnet=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(l.superclass._defaultConfig.apply(this,arguments),{freezeCols:[],isNeedMerge:!1,mergeRule:BI.emptyFn,columnSize:[],minColumnSize:[],maxColumnSize:[],headerRowSize:30,rowSize:30,sortable:!0,resizable:!0,checkable:!0,bordered:!1,stripe:!0,hover:!0,header:[],items:[],itemsCreator:BI.emptyFn})},attr:function(e,t){var n=l.superclass.attr.apply(this,arguments);return BI.isNull(t)?n:this.table.attr.apply(this.table,arguments)},render:function(){var r=this,e=this.options;return e.items[0]&&0<e.items[0].length?{type:"bi.resizable_table",ref:function(e){r.table=e},el:{type:"bi.table_view",bordered:e.bordered,stripe:e.stripe,hover:e.hover},width:e.width,height:e.height,isNeedFreeze:!0,freezeCols:e.freezeCols,isNeedResize:e.isNeedResize||e.resizable,minColumnSize:e.minColumnSize,maxColumnSize:e.maxColumnSize,columnSize:e.columnSize,headerRowSize:e.headerRowSize,rowSize:e.rowSize,isNeedMerge:e.isNeedMerge,mergeRule:e.mergeRule,header:e.header,items:e.items}:{type:"bi.resizable_table",ref:function(e){r.table=e},el:{type:"bi.freeze_table",ref:function(e){r.innerTable=e},listeners:[{eventName:"EVENT_SORT",action:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.fireEvent.apply(r,["EVENT_SORT"].concat(t))}},{eventName:"EVENT_START_DRAG",action:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.fireEvent.apply(r,["EVENT_START_DRAG"].concat(t))}},{eventName:"EVENT_STOP_DRAG",action:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.fireEvent.apply(r,["EVENT_STOP_DRAG"].concat(t))}},{eventName:"EVENT_CHANGE",action:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.fireEvent.apply(r,["EVENT_CHANGE"].concat(t))}}],freezeCols:e.freezeCols,itemsCreator:e.itemsCreator,sortable:e.sortable,checkable:e.checkable,bordered:e.bordered,stripe:e.stripe,hover:e.hover},width:e.width,height:e.height,isNeedResize:e.isNeedResize||e.resizable,minColumnSize:e.minColumnSize,maxColumnSize:e.maxColumnSize,columnSize:e.columnSize,headerRowSize:e.headerRowSize,rowSize:e.rowSize,header:e.header,items:e.items}},setVerticalScroll:function(e){return this.table.setVerticalScroll(e)},setLeftHorizontalScroll:function(e){},setRightHorizontalScroll:function(e){},getVerticalScroll:function(){return this.table.getVerticalScroll()},getRightHorizontalScroll:function(){return this.table.getRightHorizontalScroll()},setWidth:function(e){l.superclass.setWidth.apply(this,arguments),this.table.setWidth(e)},setHeight:function(e){l.superclass.setHeight.apply(this,arguments),this.table.setHeight(e)},setColumnSize:function(e){this.table.setColumnSize(e)},getColumnSize:function(){return this.options.columnSize},populate:function(e,t){this.table.populate(e,t)},getValue:function(){return this.innerTable.getValue()},restore:function(){this.table.restore()}}));BI.shortcut("bi.components.table",l)},function(e,t,n){"use strict";BI.WaterMark=BI.inherit(BI.Widget,{props:{baseCls:"bi-watermark",watermark:{},angle:20},mounted:function(){var e=this;BI.$(this.container.paper.canvas).css({position:"absolute",zIndex:"99999",pointerEvents:"none"}),this.canvas=BI.Func.createEmptyCanvas(),this._paint(),BI.ResizeDetector.addResizeListener(this,function(){e._paint()})},render:function(){var t=this,e=this.options;return this.value=BI.extend({text:"",fontSize:12,color:"#999",horizontalGap:200,verticalGap:100},e.watermark),{type:"bi.svg",ref:function(e){t.container=e}}},_initCanvas:function(){var e=this.container.element.width(),t=this.container.element.height();return 0!==t&&0!==e&&(this.canvas.width=e,this.canvas.height=t,!0)},_initSvg:function(){this.svgImage&&this.container.clear()},_paint:function(){var e;this._initCanvas()&&(this._initSvg(),BI.Func.paintWaterMark(this.canvas,this.value),e=this.canvas.toDataURL("image/png"),this.svgImage=this.container.image(e,0,0,this.canvas.width,this.canvas.height))},setValue:function(e){this.value=BI.extend(this.value,e),this._paint()}}),BI.shortcut("bi.watermark",BI.WaterMark)},function(e,t,n){"use strict";BI.DivWaterMark=BI.inherit(BI.Widget,{props:{baseCls:"bi-div-watermark",watermark:{},angle:20},mounted:function(){var e=this;this.options;this.element.css({fontSize:this.value.fontSize+"px",color:this.value.color}),this._showWatermark(),BI.ResizeDetector.addResizeListener(this,function(){e._showWatermark()})},render:function(){var t=this,e=this.options;return this.value=BI.extend({text:"",fontSize:12,color:"#999",horizontalGap:200,verticalGap:100},e.watermark),this.deg=Math.PI/180*this.options.angle,this.markWidth=BI.DOM.getTextSizeWidth(this.value.text,this.value.fontSize)+this.value.horizontalGap,{type:"bi.absolute",ref:function(e){t.container=e},items:[{el:{type:"bi.button_group",layouts:[{type:"bi.vertical",bgap:this.value.verticalGap}],cls:"watermark-container",ref:function(e){t.watermarkContainer=e}},left:0,top:0,right:0,bottom:0}]}},setValue:function(e){this.value=BI.extend(this.value,e),this._showWatermark()},_showWatermark:function(){this.options;for(var e=this.value.horizontalGap,t=(this.markWidth=BI.DOM.getTextSizeWidth(this.value.text,this.value.fontSize)+e,[]),n=this._getContainerSize(),r=BI.DOM.getTextSizeHeight(this.value.text,this.value.fontSize)+this.value.verticalGap,i=BI.parseInt(n.width/this.markWidth),o=BI.parseInt(n.height/r),a=this._addFilterForOldIE(),s=(this.value.text+"").split("\n"),l=0;l<o+3;l++){for(var c=[],u=0;u<i+3;u++){var h=1<s.length?BI.createWidget({type:"bi.vertical",hgap:e/2,items:BI.map(s,function(e,t){return{type:"bi.label",cls:"watermark-text",text:t}})}):BI.createWidget({type:"bi.label",hgap:e/2,cls:"watermark-text",text:this.value.text});h.element.css(BI.extend({fontSize:this.value.fontSize+"px",color:this.value.color},a)),c.push(h)}t.push({el:{type:"bi.horizontal",scrollx:!1,items:c},lgap:l%2==0?-this.markWidth/2:0})}this.watermarkContainer.populate(t),this.container.attr("items")[0].left=-this._getContainerLeft(),this.container.attr("items")[0].right=-this.markWidth,this.container.attr("items")[0].bottom=-this._getContainerBottom(),this.container.resize()},_addFilterForOldIE:function(){var e,t;return BI.isIE9Below()?(e=-this.deg,{filter:"progid:DXImageTransform.Microsoft.Chroma(color='white') progid:DXImageTransform.Microsoft.Matrix(M11="+(t=Math.cos(e))+",M12="+-1*Math.sin(e)+",M21="+Math.sin(e)+",M22="+t+",SizingMethod='auto expand')"}):{}},_getContainerSize:function(){var e=this.element.height(),t=this.element.width();return{width:t*Math.cos(this.deg)+e*Math.sin(this.deg),height:t*Math.sin(this.deg)+e/Math.cos(this.deg)}},_getContainerLeft:function(){return this.element.height()*Math.tan(Math.PI/180*20)},_getContainerBottom:function(){return this._getContainerSize().height-this.element.height()}}),BI.shortcut("bi.div.watermark",BI.DivWaterMark)},function(e,t){e.exports=function(e){function t(e){"undefined"!=typeof console&&(console.error||console.log)("[Script Loader]",e)}try{"undefined"!=typeof execScript&&"undefined"!=typeof attachEvent&&"undefined"==typeof addEventListener?execScript(e):"undefined"!=typeof eval?eval.call(null,e):t("EvalError: No eval function available")}catch(n){t(n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="10.3.0"},function(e,t,n){"use strict";e.exports=function(t,n){return function(e){return t(n(e))}}},function(n,e,t){"use strict";!function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e="object"==(void 0===e?"undefined":t(e))&&e&&e.Object===Object&&e;n.exports=e}.call(this,t(68))},function(e,t,n){"use strict";var r=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return r.call(e)}catch(t){}try{return e+""}catch(t){}}return""}},function(e,t,n){"use strict";n=n(19)(n(10),"Set");e.exports=n},function(e,t,n){"use strict";var o=n(426),a=n(12);e.exports=function s(e,t,n,r,i){return e===t||(null==e||null==t||!a(e)&&!a(t)?e!=e&&t!=t:o(e,t,n,r,s,i))}},function(e,t,n){"use strict";var g=n(79),b=n(215),y=n(80);e.exports=function(e,t,n,r,i,o){var a=1&n,s=e.length,l=t.length;if(s!=l&&!(a&&s<l))return!1;var l=o.get(e),c=o.get(t);if(l&&c)return l==t&&c==e;var u=-1,h=!0,d=2&n?new g:undefined;for(o.set(e,t),o.set(t,e);++u<s;){var p,f=e[u],m=t[u];if((p=r?a?r(m,f,u,t,e,o):r(f,m,u,e,t,o):p)!==undefined){if(p)continue;h=!1;break}if(d){if(!b(t,function(e,t){if(!y(d,t)&&(f===e||i(f,e,n,r,o)))return d.push(t)})){h=!1;break}}else if(f!==m&&!i(f,m,n,r,o)){h=!1;break}}return o["delete"](e),o["delete"](t),h}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},function(e,t,n){"use strict";n=n(10).Uint8Array;e.exports=n},function(e,t,n){"use strict";var r=n(218),i=n(83),o=n(5);e.exports=function(e){return r(e,o,i)}},function(e,t,n){"use strict";var r=n(82),i=n(0);e.exports=function(e,t,n){return t=t(e),i(e)?t:r(t,n(e))}},function(e,t,n){"use strict";e.exports=function(){return[]}},function(e,t,n){"use strict";var u=n(432),h=n(48),d=n(0),p=n(49),f=n(55),m=n(76),g=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n,r=d(e),i=!r&&h(e),o=!r&&!i&&p(e),a=!r&&!i&&!o&&m(e),s=r||i||o||a,l=s?u(e.length,String):[],c=l.length;for(n in e)!t&&!g.call(e,n)||s&&("length"==n||o&&("offset"==n||"parent"==n)||a&&("buffer"==n||"byteLength"==n||"byteOffset"==n)||f(n,c))||l.push(n);return l}},function(e,t,n){"use strict";var r=n(11);e.exports=function(e){return e==e&&!r(e)}},function(e,t,n){"use strict";e.exports=function(t,n){return function(e){return null!=e&&(e[t]===n&&(n!==undefined||t in Object(e)))}}},function(e,t,n){"use strict";var r=n(438);e.exports=function(e){return null==e?"":r(e)}},function(e,t,n){"use strict";var s=n(56),l=n(48),c=n(0),u=n(55),h=n(75),d=n(34);e.exports=function(e,t,n){for(var r=-1,i=(t=s(t,e)).length,o=!1;++r<i;){var a=d(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&h(i)&&u(a,i)&&(c(e)||l(e))}},function(e,t,n){"use strict";e.exports=function(t){return function(e){return null==e?undefined:e[t]}}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}},function(e,t,n){"use strict";var r=n(19),n=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();e.exports=n},function(e,t,n){"use strict";var r=n(82),i=n(229),o=n(83),n=n(219),a=Object.getOwnPropertySymbols;e.exports=a?function(e){for(var t=[];e;)r(t,o(e)),e=i(e);return t}:n},function(e,t,n){"use strict";n=n(209)(Object.getPrototypeOf,Object);e.exports=n},function(e,t,n){"use strict";var r=n(218),i=n(228),o=n(59);e.exports=function(e){return r(e,o,i)}},function(e,t,n){"use strict";var r=n(480),i=n(31),n=n(50),n=n&&n.isRegExp,n=n?i(n):r;e.exports=n},function(e,t,n){"use strict";var r=n(32),i=n(13),o=n(481),a=n(230);e.exports=function(e,n){var t;return null==e?{}:(t=r(a(e),function(e){return[e]}),n=i(n),o(e,t,function(e,t){return n(e,t[0])}))}},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.firstForTerminal=t.firstForBranching=t.firstForSequence=t.first=void 0,r(n(16))),s=r(n(98)),o=r(n(4)),a=n(2),l=n(2);function c(e){if(e instanceof a.NonTerminal)return c(e.referencedRule);if(e instanceof a.Terminal)return d(e);if((0,l.isSequenceProd)(e))return u(e);if((0,l.isBranchingProd)(e))return h(e);throw Error("non exhaustive match")}function u(e){for(var t,n=[],r=e.definition,i=0,o=r.length>i,a=!0;o&&a;)t=r[i],a=(0,l.isOptionalProd)(t),n=n.concat(c(t)),o=r.length>(i+=1);return(0,s["default"])(n)}function h(e){e=(0,o["default"])(e.definition,c);return(0,s["default"])((0,i["default"])(e))}function d(e){return[e.terminalType]}t.first=c,t.firstForSequence=u,t.firstForBranching=h,t.firstForTerminal=d},function(e,t,n){"use strict";var r=n(96);e.exports=function(e,t){return!!(null==e?0:e.length)&&-1<r(e,t,0)}},function(e,t,n){"use strict";e.exports=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IN=void 0,t.IN="_~IN~_"},function(h,y,e){"use strict";function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||n({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var r,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},t=function(e){return e&&e.__esModule?e:{"default":e}},a=(Object.defineProperty(y,"__esModule",{value:!0}),y.charCodeToOptimizedIndex=y.minOptimizationVal=y.buildLineBreakIssueMessage=y.LineTerminatorOptimizedTester=y.isShortPattern=y.isCustomPattern=y.cloneEmptyGroups=y.performWarningRuntimeChecks=y.performRuntimeChecks=y.addStickyFlag=y.addStartOfInput=y.findUnreachablePatterns=y.findModesThatDoNotExist=y.findInvalidGroupType=y.findDuplicatePatterns=y.findUnsupportedFlags=y.findStartOfInputAnchor=y.findEmptyMatchRegExps=y.findEndOfInputAnchor=y.findInvalidPatterns=y.findMissingPatterns=y.validatePatterns=y.analyzeTokenTypes=y.enableSticky=y.disableSticky=y.SUPPORT_STICKY=y.MODES=y.DEFAULT_MODE=void 0,e(100)),_=e(63),d=t(e(40)),I=t(e(9)),s=t(e(64)),x=t(e(0)),p=t(e(15)),f=t(e(16)),E=t(e(101)),i=t(e(102)),S=t(e(504)),T=t(e(4)),C=t(e(3)),w=t(e(39)),B=t(e(30)),R=t(e(22)),m=t(e(103)),N=t(e(7)),g=t(e(5)),A=t(e(231)),l=t(e(104)),W=t(e(241)),O=t(e(23)),L=t(e(18)),k=e(37),P=e(508),c=e(105),z="PATTERN";function u(e){var t=(0,l["default"])(e,function(e){return!(0,N["default"])(e,z)});return{errors:(0,T["default"])(t,function(e){return{message:"Token Type: ->"+e.name+"<- missing static 'PATTERN' property",type:_.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}}),valid:(0,i["default"])(e,t)}}function b(e){var t=(0,l["default"])(e,function(e){e=e[z];return!((0,A["default"])(e)||(0,B["default"])(e)||(0,N["default"])(e,"exec")||(0,w["default"])(e))});return{errors:(0,T["default"])(t,function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:_.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}}),valid:(0,i["default"])(e,t)}}y.DEFAULT_MODE="defaultMode",y.MODES="modes",y.SUPPORT_STICKY="boolean"==typeof new RegExp("(?:)").sticky,y.disableSticky=function(){y.SUPPORT_STICKY=!1},y.enableSticky=function(){y.SUPPORT_STICKY=!0},y.analyzeTokenTypes=function(e,o){(n=(o=(0,W["default"])(o,{useSticky:y.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"],tracer:function n(e,t){return t()}})).tracer)("initCharCodeToOptimizedIndexMap",function(){if((0,I["default"])(V)){V=new Array(65536);for(var e=0;e<65536;e++)V[e]=255<e?255+~~(e/255):e}}),n("Reject Lexer.NA",function(){r=(0,E["default"])(e,function(e){return e[z]===_.Lexer.NA})});var n,r,i,a,s,l,c,u,h,d,p,t,f,m=!1,g=(n("Transform Patterns",function(){i=(m=!1,T["default"])(r,function(e){var t,e=e[z];if((0,A["default"])(e))return 1!==(t=e.source).length||"^"===t||"$"===t||"."===t||e.ignoreCase?2!==t.length||"\\"!==t[0]||(0,L["default"])(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],t[1])?(o.useSticky?F:M)(e):t[1]:t;if((0,B["default"])(e))return m=!0,{exec:e};if("object"===v(e))return m=!0,e;if("string"==typeof e)return 1===e.length?e:(t=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),e=new RegExp(t),(o.useSticky?F:M)(e));throw Error("non exhaustive match")})}),n("misc mapping",function(){a=(0,T["default"])(r,function(e){return e.tokenTypeIdx}),s=(0,T["default"])(r,function(e){e=e.GROUP;if(e===_.Lexer.SKIPPED)return undefined;if((0,w["default"])(e))return e;if((0,R["default"])(e))return!1;throw Error("non exhaustive match")}),l=(0,T["default"])(r,function(e){e=e.LONGER_ALT;if(e)return(0,x["default"])(e)?(0,T["default"])(e,function(e){return(0,S["default"])(r,e)}):[(0,S["default"])(r,e)]}),c=(0,T["default"])(r,function(e){return e.PUSH_MODE}),u=(0,T["default"])(r,function(e){return(0,N["default"])(e,"POP_MODE")})}),n("Line Terminator Handling",function(){var t=re(o.lineTerminatorCharacters);h=(0,T["default"])(r,function(e){return!1}),"onlyOffset"!==o.positionTracking&&(h=(0,T["default"])(r,function(e){return(0,N["default"])(e,"LINE_BREAKS")?!!e.LINE_BREAKS:!1===te(e,t)&&(0,P.canMatchCharCode)(t,e.PATTERN)}))}),n("Misc Mapping #2",function(){d=(0,T["default"])(r,D),p=(0,T["default"])(i,ee),t=(0,O["default"])(r,function(e,t){t=t.GROUP;return(0,w["default"])(t)&&t!==_.Lexer.SKIPPED&&(e[t]=[]),e},{}),f=(0,T["default"])(i,function(e,t){return{pattern:i[t],longerAlt:l[t],canLineTerminator:h[t],isCustom:d[t],"short":p[t],group:s[t],push:c[t],pop:u[t],tokenTypeIdx:a[t],tokenType:r[t]}})}),!0),b=[];return o.safeMode||n("First Char Optimization",function(){b=(0,O["default"])(r,function(t,e,n){var r,i;return"string"==typeof e.PATTERN?(i=j(e.PATTERN.charCodeAt(0)),H(t,i,f[n])):(0,x["default"])(e.START_CHARS_HINT)?(0,C["default"])(e.START_CHARS_HINT,function(e){e=j("string"==typeof e?e.charCodeAt(0):e);r!==e&&H(t,r=e,f[n])}):(0,A["default"])(e.PATTERN)?e.PATTERN.unicode?(g=!1,o.ensureOptimizations&&(0,k.PRINT_ERROR)("".concat(P.failedOptimizationPrefixMsg)+"\tUnable to analyze < ".concat(e.PATTERN.toString()," > pattern.\n")+"\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE")):(i=(0,P.getOptimizedStartCodesIndices)(e.PATTERN,o.ensureOptimizations),(0,I["default"])(i)&&(g=!1),(0,C["default"])(i,function(e){H(t,e,f[n])})):(o.ensureOptimizations&&(0,k.PRINT_ERROR)("".concat(P.failedOptimizationPrefixMsg)+"\tTokenType: <".concat(e.name,"> is using a custom token pattern without providing <start_chars_hint> parameter.\n")+"\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),g=!1),t},[])}),{emptyGroups:t,patternIdxToConfig:f,charCodeToPatternIdxToConfig:b,hasCustom:m,canBeOptimized:g}},y.validatePatterns=function(e,t){var n,r=[],e=u(e),r=r.concat(e.errors),i=(e=b(e.valid)).valid;return r=(r=(r=(r=(r=r.concat(e.errors)).concat((e=i,n=[],e=(0,l["default"])(e,function(e){return(0,A["default"])(e[z])}),n=(n=(n=(n=(n=n.concat(U(e))).concat(X(e))).concat(q(e))).concat(K(e))).concat($(e))))).concat(Z(i))).concat(Q(i,t))).concat(J(i))},y.findMissingPatterns=u,y.findInvalidPatterns=b;var G=/[^\\][$]/;function U(e){t=a.BaseRegExpVisitor,o(n,t),n.prototype.visitEndAnchor=function(e){this.found=!0};var t,i=n;function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.found=!1,e}e=(0,l["default"])(e,function(e){e=e.PATTERN;try{var t=(0,c.getRegExpAst)(e),n=new i;return n.visit(t),n.found}catch(r){return G.test(e.source)}});return(0,T["default"])(e,function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+e.name+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:_.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}})}function $(e){e=(0,l["default"])(e,function(e){return e.PATTERN.test("")});return(0,T["default"])(e,function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' must not match an empty string",type:_.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}})}y.findEndOfInputAnchor=U,y.findEmptyMatchRegExps=$;var Y=/[^\\[][\^]|^\^/;function X(e){t=a.BaseRegExpVisitor,o(n,t),n.prototype.visitStartAnchor=function(e){this.found=!0};var t,i=n;function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.found=!1,e}e=(0,l["default"])(e,function(e){e=e.PATTERN;try{var t=(0,c.getRegExpAst)(e),n=new i;return n.visit(t),n.found}catch(r){return Y.test(e.source)}});return(0,T["default"])(e,function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+e.name+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:_.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}})}function q(e){e=(0,l["default"])(e,function(e){e=e[z];return e instanceof RegExp&&(e.multiline||e.global)});return(0,T["default"])(e,function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:_.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}})}function K(e){var r=[],t=(0,T["default"])(e,function(n){return(0,O["default"])(e,function(e,t){return n.PATTERN.source!==t.PATTERN.source||(0,L["default"])(r,t)||t.PATTERN===_.Lexer.NA||(r.push(t),e.push(t)),e},[])}),t=(0,s["default"])(t),t=(0,l["default"])(t,function(e){return 1<e.length});return(0,T["default"])(t,function(e){var t=(0,T["default"])(e,function(e){return e.name}),n=(0,d["default"])(e).PATTERN;return{message:"The same RegExp pattern ->".concat(n,"<-")+"has been used in all of the following Token Types: ".concat(t.join(", ")," <-"),type:_.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}})}function Z(e){e=(0,l["default"])(e,function(e){return!!(0,N["default"])(e,"GROUP")&&((e=e.GROUP)!==_.Lexer.SKIPPED&&e!==_.Lexer.NA&&!(0,w["default"])(e))});return(0,T["default"])(e,function(e){return{message:"Token Type: ->"+e.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:_.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}})}function Q(e,t){e=(0,l["default"])(e,function(e){return e.PUSH_MODE!==undefined&&!(0,L["default"])(t,e.PUSH_MODE)});return(0,T["default"])(e,function(e){return{message:"Token Type: ->".concat(e.name,"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->").concat(e.PUSH_MODE,"<-")+"which does not exist",type:_.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}})}function J(e){var o=[],t=(0,O["default"])(e,function(e,t,n){var r,i=t.PATTERN;return i!==_.Lexer.NA&&((0,w["default"])(i)?e.push({str:i,idx:n,tokenType:t}):(0,A["default"])(i)&&(r=i,(0,m["default"])([".","\\","[","]","|","^","$","(",")","?","*","+","{"],function(e){return-1!==r.source.indexOf(e)})===undefined)&&e.push({str:i.source,idx:n,tokenType:t})),e},[]);return(0,C["default"])(e,function(r,i){(0,C["default"])(t,function(e){var t=e.str,n=e.idx,e=e.tokenType;i<n&&function(e,t){{var n;if((0,A["default"])(t))return null!==(n=t.exec(e))&&0===n.index;if((0,B["default"])(t))return t(e,0,[],{});if((0,N["default"])(t,"exec"))return t.exec(e,0,[],{});if("string"==typeof t)return t===e;throw Error("non exhaustive match")}}(t,r.PATTERN)&&(n="Token: ->".concat(e.name,"<- can never be matched.\n")+"Because it appears AFTER the Token Type ->".concat(r.name,"<-")+"in the lexer's definition.\nSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE",o.push({message:n,type:_.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[r,e]}))})}),o}function M(e){var t=e.ignoreCase?"i":"";return new RegExp("^(?:".concat(e.source,")"),t)}function F(e){var t=e.ignoreCase?"iy":"y";return new RegExp("".concat(e.source),t)}function D(e){e=e.PATTERN;if((0,A["default"])(e))return!1;if((0,B["default"])(e))return!0;if((0,N["default"])(e,"exec"))return!0;if((0,w["default"])(e))return!1;throw Error("non exhaustive match")}function ee(e){return!(!(0,w["default"])(e)||1!==e.length)&&e.charCodeAt(0)}function te(e,t){if((0,N["default"])(e,"LINE_BREAKS"))return!1;if((0,A["default"])(e.PATTERN)){try{(0,P.canMatchCharCode)(t,e.PATTERN)}catch(n){return{issue:_.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}if((0,w["default"])(e.PATTERN))return!1;if(D(e))return{issue:_.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function ne(e,t){if(t.issue===_.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n"+"\tThe problem is in the <".concat(e.name,"> Token Type\n")+"\t Root cause: ".concat(t.errMsg,".\n")+"\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(t.issue===_.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n"+"\tThe problem is in the <".concat(e.name,"> Token Type\n")+"\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function re(e){return(0,T["default"])(e,function(e){return(0,w["default"])(e)?e.charCodeAt(0):e})}function H(e,t,n){e[t]===undefined?e[t]=[n]:e[t].push(n)}y.findStartOfInputAnchor=X,y.findUnsupportedFlags=q,y.findDuplicatePatterns=K,y.findInvalidGroupType=Z,y.findModesThatDoNotExist=Q,y.findUnreachablePatterns=J,y.addStartOfInput=M,y.addStickyFlag=F,y.performRuntimeChecks=function(e,t,n){var i=[];return(0,N["default"])(e,y.DEFAULT_MODE)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+y.DEFAULT_MODE+"> property in its definition\n",type:_.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),(0,N["default"])(e,y.MODES)||i.push({message:"A MultiMode Lexer cannot be initialized without a <"+y.MODES+"> property in its definition\n",type:_.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),(0,N["default"])(e,y.MODES)&&(0,N["default"])(e,y.DEFAULT_MODE)&&!(0,N["default"])(e.modes,e.defaultMode)&&i.push({message:"A MultiMode Lexer cannot be initialized with a ".concat(y.DEFAULT_MODE,": <").concat(e.defaultMode,">")+"which does not exist\n",type:_.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),(0,N["default"])(e,y.MODES)&&(0,C["default"])(e.modes,function(n,r){(0,C["default"])(n,function(t,e){(0,R["default"])(t)?i.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:"+"<".concat(r,"> at index: <").concat(e,">\n"),type:_.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED}):(0,N["default"])(t,"LONGER_ALT")&&(e=(0,x["default"])(t.LONGER_ALT)?t.LONGER_ALT:[t.LONGER_ALT],(0,C["default"])(e,function(e){(0,R["default"])(e)||(0,L["default"])(n,e)||i.push({message:"A MultiMode Lexer cannot be initialized with a longer_alt <".concat(e.name,"> on token <").concat(t.name,"> outside of mode <").concat(r,">\n"),type:_.LexerDefinitionErrorType.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})}))})}),i},y.performWarningRuntimeChecks=function(e,t,n){var r=[],i=!1,e=(0,s["default"])((0,f["default"])((0,p["default"])(e.modes))),e=(0,E["default"])(e,function(e){return e[z]===_.Lexer.NA}),o=re(n);return t&&(0,C["default"])(e,function(e){var t=te(e,o);!1!==t?(t={message:ne(e,t),type:t.issue,tokenType:e},r.push(t)):(0,N["default"])(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(i=!0):(0,P.canMatchCharCode)(o,e.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:_.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),r},y.cloneEmptyGroups=function(n){var r={},e=(0,g["default"])(n);return(0,C["default"])(e,function(e){var t=n[e];if(!(0,x["default"])(t))throw Error("non exhaustive match");r[e]=[]}),r},y.isCustomPattern=D,y.isShortPattern=ee,y.LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,n=this.lastIndex;n<t;n++){var r=e.charCodeAt(n);if(10===r)return this.lastIndex=n+1,!0;if(13===r)return 10===e.charCodeAt(n+1)?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0},y.buildLineBreakIssueMessage=ne,y.minOptimizationVal=256;var V=[];function j(e){return e<y.minOptimizationVal?e:V[e]}y.charCodeToOptimizedIndex=j},function(e,t,n){"use strict";var o=n(21);e.exports=function(e,r){var i=[];return o(e,function(e,t,n){r(e,t,n)&&i.push(e)}),i}},function(e,t,n){"use strict";var i=n(233),o=n(13),a=n(38),s=Math.max;e.exports=function(e,t,n){var r=null==e?0:e.length;return r?((n=null==n?0:a(n))<0&&(n=s(r+n,0)),i(e,o(t,3),n)):-1}},function(e,t,n){"use strict";var r=n(94),h=n(33),d=n(61),p=n(59),f=Object.prototype,m=f.hasOwnProperty,n=r(function(e,t){e=Object(e);var n=-1,r=t.length,i=2<r?t[2]:undefined;for(i&&d(t[0],t[1],i)&&(r=1);++n<r;)for(var o=t[n],a=p(o),s=-1,l=a.length;++s<l;){var c=a[s],u=e[c];(u===undefined||h(u,f[c])&&!m.call(e,c))&&(e[c]=o[c])}return e});e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLexerErrorProvider=void 0,t.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return"Unable to pop Lexer Mode after encountering Token ->".concat(e.image,"<- The Mode Stack is empty")},buildUnexpectedCharactersMessage:function(e,t,n,r,i){return"unexpected character: ->".concat(e.charAt(t),"<- at offset: ").concat(t,",")+" skipped ".concat(n," characters.")}}},function(z,e,t){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||n({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var r,i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=function(e){return e&&e.__esModule?e:{"default":e}},m=(Object.defineProperty(e,"__esModule",{value:!0}),e.checkPrefixAlternativesAmbiguities=e.validateSomeNonEmptyLookaheadPath=e.validateTooManyAlts=e.RepetitionCollector=e.validateAmbiguousAlternationAlternatives=e.validateEmptyOrAlternative=e.getFirstNoneTerminal=e.validateNoLeftRecursion=e.validateRuleIsOverridden=e.validateRuleDoesNotAlreadyExist=e.OccurrenceValidationCollector=e.identifyProductionForDuplicates=e.validateGrammar=void 0,o(t(40))),g=o(t(9)),M=o(t(91)),l=o(t(16)),F=o(t(104)),D=o(t(101)),H=o(t(102)),b=o(t(4)),y=o(t(3)),V=o(t(244)),h=o(t(23)),j=o(t(232)),W=o(t(15)),v=o(t(18)),_=o(t(514)),G=o(t(17)),I=t(6),x=t(2),d=t(66),U=t(67),a=t(2),s=t(2),$=o(t(107)),Y=o(t(64)),X=t(27);function E(e){return"".concat((0,x.getProductionDslName)(e),"_#_").concat(e.idx,"_#_").concat(S(e))}function S(e){return e instanceof a.Terminal?e.terminalType.name:e instanceof a.NonTerminal?e.nonTerminalName:""}e.validateGrammar=function(t,n,e,o,r){var i,a,s,l=(0,_["default"])(t,function(e){return r=e,i=o,e=new T,r.accept(e),e=e.allProductions,e=(0,V["default"])(e,E),e=(0,j["default"])(e,function(e){return 1<e.length}),(0,b["default"])((0,W["default"])(e),function(e){var t=(0,m["default"])(e),e=i.buildDuplicateFoundError(r,e),n=(0,x.getProductionDslName)(t),e={message:e,type:I.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:r.name,dslName:n,occurrence:t.idx},n=S(t);return n&&(e.parameter=n),e});var r,i}),c=(0,_["default"])(t,function(e){return w(e,e,o)}),u=[],h=[],d=[],e=((0,g["default"])(c)&&(u=(0,_["default"])(t,function(e){return N(e,o)}),h=(0,_["default"])(t,function(e){return A(e,n,o)}),d=q(t,n,o)),p=t,i=o,a=[],s=(0,b["default"])(e,function(e){return e.name}),(0,y["default"])(p,function(e){var t=e.name;(0,v["default"])(s,t)&&(e=i.buildNamespaceConflictError(e),a.push({message:e,type:I.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t}))}),a),p=(0,_["default"])(t,function(e){return P(e,o)}),f=(0,_["default"])(t,function(e){return C(e,t,r,o)});return l.concat(d,c,u,h,e,p,f)},e.identifyProductionForDuplicates=E;c=s.GAstVisitor,i(u,c),u.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},u.prototype.visitOption=function(e){this.allProductions.push(e)},u.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},u.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},u.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},u.prototype.visitRepetition=function(e){this.allProductions.push(e)},u.prototype.visitAlternation=function(e){this.allProductions.push(e)},u.prototype.visitTerminal=function(e){this.allProductions.push(e)};var c,T=u;function u(){var e=null!==c&&c.apply(this,arguments)||this;return e.allProductions=[],e}function C(n,e,t,r){var i=[];return 1<(0,h["default"])(e,function(e,t){return t.name===n.name?e+1:e},0)&&(e=r.buildDuplicateRuleNameError({topLevelRule:n,grammarName:t}),i.push({message:e,type:I.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:n.name})),i}function w(n,e,r,i){void 0===i&&(i=[]);var t,o=[],e=p(e.definition);return(0,g["default"])(e)?[]:(t=n.name,(0,v["default"])(e,n)&&o.push({message:r.buildLeftRecursionError({topLevelRule:n,leftRecursionPath:i}),type:I.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:t}),t=(0,H["default"])(e,i.concat([n])),e=(0,_["default"])(t,function(e){var t=(0,G["default"])(i);return t.push(e),w(n,e,r,t)}),o.concat(e))}function p(e){var t=[];if((0,g["default"])(e))return t;var n=(0,m["default"])(e);if(n instanceof a.NonTerminal)t.push(n.referencedRule);else if(n instanceof a.Alternative||n instanceof a.Option||n instanceof a.RepetitionMandatory||n instanceof a.RepetitionMandatoryWithSeparator||n instanceof a.RepetitionWithSeparator||n instanceof a.Repetition)t=t.concat(p(n.definition));else if(n instanceof a.Alternation)t=(0,l["default"])((0,b["default"])(n.definition,function(e){return p(e.definition)}));else if(!(n instanceof a.Terminal))throw Error("non exhaustive match");var n=(0,x.isOptionalProd)(n),r=1<e.length;return n&&r?(n=(0,M["default"])(e),t.concat(p(n))):t}e.OccurrenceValidationCollector=T,e.validateRuleDoesNotAlreadyExist=C,e.validateRuleIsOverridden=function(e,t,n){var r=[];return(0,v["default"])(t,e)||(t="Invalid rule override, rule: ->".concat(e,"<- cannot be overridden in the grammar: ->").concat(n,"<-")+"as it is not defined in any of the super grammars ",r.push({message:t,type:I.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),r},e.validateNoLeftRecursion=w,e.getFirstNoneTerminal=p;f=s.GAstVisitor,i(R,f),R.prototype.visitAlternation=function(e){this.alternations.push(e)};var f,B=R;function R(){var e=null!==f&&f.apply(this,arguments)||this;return e.alternations=[],e}function N(r,i){var e=new B,e=(r.accept(e),e.alternations);return(0,_["default"])(e,function(n){var e=(0,$["default"])(n.definition);return(0,_["default"])(e,function(e,t){e=(0,U.nextPossibleTokensAfter)([e],[],X.tokenStructuredMatcher,1);return(0,g["default"])(e)?[{message:i.buildEmptyAlternationError({topLevelRule:r,alternation:n,emptyChoiceIdx:t}),type:I.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:r.name,occurrence:n.idx,alternative:t+1}]:[]})})}function A(l,c,u){var e=new B,e=(l.accept(e),e.alternations),e=(0,D["default"])(e,function(e){return!0===e.ignoreAmbiguities});return(0,_["default"])(e,function(e){var o,a,n,r,s,t=e.idx,i=e.maxLookahead||c,t=(0,d.getLookaheadPathsForOr)(t,l,i,e),i=(o=t,a=e,n=l,r=u,s=[],i=(0,h["default"])(o,function(e,t,i){return!0!==a.definition[i].ignoreAmbiguities&&(0,y["default"])(t,function(n){var r=[i];(0,y["default"])(o,function(e,t){i!==t&&(0,d.containsPath)(e,n)&&!0!==a.definition[t].ignoreAmbiguities&&r.push(t)}),1<r.length&&!(0,d.containsPath)(s,n)&&(s.push(n),e.push({alts:r,path:n}))}),e},[]),(0,b["default"])(i,function(e){var t=(0,b["default"])(e.alts,function(e){return e+1});return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:a,ambiguityIndices:t,prefixPath:e.path}),type:I.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:a.idx,alternatives:e.alts}})),t=K(t,e,l,u);return i.concat(t)})}e.validateEmptyOrAlternative=N,e.validateAmbiguousAlternationAlternatives=A;O=s.GAstVisitor,i(k,O),k.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},k.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},k.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},k.prototype.visitRepetition=function(e){this.allProductions.push(e)};var O,L=k;function k(){var e=null!==O&&O.apply(this,arguments)||this;return e.allProductions=[],e}function P(t,n){var e=new B,e=(t.accept(e),e.alternations);return(0,_["default"])(e,function(e){return 255<e.definition.length?[{message:n.buildTooManyAlternativesError({topLevelRule:t,alternation:e}),type:I.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:t.name,occurrence:e.idx}]:[]})}function q(e,o,a){var s=[];return(0,y["default"])(e,function(i){var e=new L,e=(i.accept(e),e.allProductions);(0,y["default"])(e,function(e){var t=(0,d.getProdType)(e),n=e.maxLookahead||o,r=e.idx,r=(0,d.getLookaheadPathsForOptionalProd)(r,i,t,n)[0];(0,g["default"])((0,l["default"])(r))&&(t=a.buildEmptyRepetitionError({topLevelRule:i,repetition:e}),s.push({message:t,type:I.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name}))})}),s}function K(e,i,o,a){var n=(0,h["default"])(e,function(e,t,n){t=(0,b["default"])(t,function(e){return{idx:n,path:e}});return e.concat(t)},[]);return(0,Y["default"])((0,_["default"])(n,function(e){var r,t;return!0===i.definition[e.idx].ignoreAmbiguities?[]:(r=e.idx,t=e.path,e=(0,F["default"])(n,function(e){return!0!==i.definition[e.idx].ignoreAmbiguities&&e.idx<r&&(0,d.isStrictPrefixOfPath)(e.path,t)}),(0,b["default"])(e,function(e){var t=[e.idx+1,r+1],n=0===i.idx?"":i.idx;return{message:a.buildAlternationPrefixAmbiguityError({topLevelRule:o,alternation:i,ambiguityIndices:t,prefixPath:e.path}),type:I.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:o.name,occurrence:n,alternatives:t}}))}))}e.RepetitionCollector=L,e.validateTooManyAlts=P,e.validateSomeNonEmptyLookaheadPath=q,e.checkPrefixAlternativesAmbiguities=K},function(e,t,n){"use strict";var r=n(88),n=n(511),i=Object.prototype.hasOwnProperty,n=n(function(e,t,n){i.call(e,n)?e[n].push(t):r(e,n,[t])});e.exports=n},function(e,o,t){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||n({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var r,i,a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=function(e){return e&&e.__esModule?e:{"default":e}},c=(Object.defineProperty(o,"__esModule",{value:!0}),o.attemptInRepetitionRecovery=o.Recoverable=o.InRuleRecoveryException=o.IN_RULE_RECOVERY_EXCEPTION=o.EOF_FOLLOW_KEY=void 0,t(26)),l=s(t(9)),d=s(t(107)),u=s(t(16)),h=s(t(4)),p=s(t(103)),f=s(t(7)),m=s(t(18)),g=s(t(17)),b=t(41),y=t(237),v=t(6),_=(o.EOF_FOLLOW_KEY={},o.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException",i=Error,a(I,i),I);function I(e){e=i.call(this,e)||this;return e.name=o.IN_RULE_RECOVERY_EXCEPTION,e}function x(){}function E(e,t,n,r,i,o,a){var r=this.getKeyForAutomaticLookahead(r,i),s=this.firstAfterRepMap[r],l=(s===undefined&&(l=this.getCurrRuleFullName(),s=new o(this.getGAstProductions()[l],i).startWalking(),this.firstAfterRepMap[r]=s),s.token),i=s.occurrence,o=s.isEndOfRule;1===this.RULE_STACK.length&&o&&l===undefined&&(l=c.EOF,i=1),l!==undefined&&i!==undefined&&this.shouldInRepetitionRecoveryBeTried(l,i,a)&&this.tryInRepetitionRecovery(e,t,n,l)}o.InRuleRecoveryException=_,x.prototype.initRecoverable=function(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=((0,f["default"])(e,"recoveryEnabled")?e:v.DEFAULT_PARSER_CONFIG).recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=E)},x.prototype.getTokenToInsert=function(e){e=(0,c.createTokenInstance)(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return e.isInsertedInRecovery=!0,e},x.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},x.prototype.canTokenTypeBeDeletedInRecovery=function(e){return!0},x.prototype.tryInRepetitionRecovery=function(e,t,n,r){for(var i=this,o=this.findReSyncTokenType(),a=this.exportLexerState(),s=[],l=!1,c=this.LA(1),u=this.LA(1),h=function h(){var e=i.LA(0),e=i.errorMessageProvider.buildMismatchTokenMessage({expected:r,actual:c,previous:e,ruleName:i.getCurrRuleFullName()}),e=new b.MismatchedTokenException(e,c,i.LA(0));e.resyncedTokens=(0,d["default"])(s),i.SAVE_ERROR(e)};!l;){if(this.tokenMatcher(u,r))return void h();if(n.call(this))return h(),void e.apply(this,t);this.tokenMatcher(u,o)?l=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,s))}this.importLexerState(a)},x.prototype.shouldInRepetitionRecoveryBeTried=function(e,t,n){return!1!==n&&(!this.tokenMatcher(this.LA(1),e)&&(!this.isBackTracking()&&!this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t))))},x.prototype.getFollowsForInRuleRecovery=function(e,t){e=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(e)},x.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e))return t=this.SKIP_TOKEN(),this.consumeToken(),t;throw new _("sad sad panda")},x.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},x.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var n,r=this;return!!this.canTokenTypeBeInsertedInRecovery(e)&&(!(0,l["default"])(t)&&(n=this.LA(1),(0,p["default"])(t,function(e){return r.tokenMatcher(n,e)})!==undefined))},x.prototype.canRecoverWithSingleTokenDeletion=function(e){return!!this.canTokenTypeBeDeletedInRecovery(e)&&this.tokenMatcher(this.LA(2),e)},x.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),t=this.getFollowSetFromFollowKey(t);return(0,m["default"])(t,e)},x.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),n=2;;){var r=(0,p["default"])(e,function(e){return(0,c.tokenMatcher)(t,e)});if(r!==undefined)return r;t=this.LA(n),n++}},x.prototype.getCurrFollowKey=function(){var e,t,n;return 1===this.RULE_STACK.length?o.EOF_FOLLOW_KEY:(e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName(),{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(n)})},x.prototype.buildFullFollowKeyStack=function(){var n=this,r=this.RULE_STACK,i=this.RULE_OCCURRENCE_STACK;return(0,h["default"])(r,function(e,t){return 0===t?o.EOF_FOLLOW_KEY:{ruleName:n.shortRuleNameToFullName(e),idxInCallingRule:i[t],inRule:n.shortRuleNameToFullName(r[t-1])}})},x.prototype.flattenFollowSet=function(){var t=this,e=(0,h["default"])(this.buildFullFollowKeyStack(),function(e){return t.getFollowSetFromFollowKey(e)});return(0,u["default"])(e)},x.prototype.getFollowSetFromFollowKey=function(e){return e===o.EOF_FOLLOW_KEY?[c.EOF]:(e=e.ruleName+e.idxInCallingRule+y.IN+e.inRule,this.resyncFollows[e])},x.prototype.addToResyncTokens=function(e,t){return this.tokenMatcher(e,c.EOF)||t.push(e),t},x.prototype.reSyncTo=function(e){for(var t=[],n=this.LA(1);!1===this.tokenMatcher(n,e);)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,t);return(0,d["default"])(t)},x.prototype.attemptInRepetitionRecovery=function(e,t,n,r,i,o,a){},x.prototype.getCurrentGrammarPath=function(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:(0,g["default"])(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}},x.prototype.getHumanReadableRuleStack=function(){var t=this;return(0,h["default"])(this.RULE_STACK,function(e){return t.shortRuleNameToFullName(e)})},o.Recoverable=x,o.attemptInRepetitionRecovery=E},function(e,t,n){"use strict";window.BICst=window.BICst||{},BICst.FORMULA_STATE=BICst.FORMULA_STATE||{},BICst.FORMULA_STATE.VALID="valid",BICst.FORMULA_STATE.INVALID="invalid",BICst.FORMULA_STATE.AGG_INVALID="aggInvalid",BICst.FORMULA_STATE.FIXED_INVALID="fixedInvalid",BICst.FORMULA_STATE.RAPID_INVALID="rapidInvalid",BICst.FORMULA_STATE.FIELD_MISS="field_miss",BICst.FORMULA_STATE.NOT_SUPPORT_STRING_OR_DATE="no_string_or_date",BICst.FORMULA_STATE.DETAIL_FILTER_NOT_SUPPORT="detail filter not support",BICst.FORMULA_WIDGET_FIELD_TYPE=BICst.FORMULA_WIDGET_FIELD_TYPE||{},BICst.FORMULA_WIDGET_FIELD_TYPE.DATE=1,BICst.FORMULA_WIDGET_FIELD_TYPE.STRING=2,BICst.FORMULA_WIDGET_FIELD_TYPE.NUMBER=3,BICst.DESIGN=BICst.DESIGN||{},BICst.DESIGN.TABLE_ROW_SUM_POSITION=BICst.DESIGN.TABLE_ROW_SUM_POSITION||{},BICst.DESIGN.TABLE_ROW_SUM_POSITION.TOP="top",BICst.DESIGN.TABLE_ROW_SUM_POSITION.BOTTOM="bottom",BICst.FORMULA_KEYWORD_TYPE={},BICst.FORMULA_KEYWORD_TYPE.KEYWORD=1,BICst.FORMULA_KEYWORD_TYPE.FUNCTION=2,BICst.FORMULA_KEYWORD_TYPE.PARAM=3},function(e,t,n){"use strict";BI.config("bi.grid_table_scrollbar",function(e){return BI.isIE9Below()?BI.extend(e,{type:"bi.native_table_scrollbar"}):e}),BI.config("bi.grid_table_horizontal_scrollbar",function(e){return BI.isIE9Below()?BI.extend(e,{type:"bi.native_table_horizontal_scrollbar"}):e}),BI.config("bi.watermark",function(e){return BI.isIE9Below()?BI.extend(e,{type:"bi.div.watermark"}):e}),_global.BI.$&&BI.$(function(){BI.isIE9Below()&&(BI.GridTableScrollbar.SIZE=18)})},function(e,t,n){"use strict";!function(n){function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}try{!function(e){var t="undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this;t.Clipboard=e()}(function(){return function l(r,i,o){function a(n,e){if(!i[n]){if(!r[n]){if(s)return s(n,!0);var t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}t=i[n]={exports:{}};r[n][0].call(t.exports,function(e){var t=r[n][1][e];return a(t||e)},t,t.exports,l,r,i,o)}return i[n].exports}for(var s=!1,e=0;e<o.length;e++)a(o[e]);return a}({1:[function(e,t,n){var r;"undefined"==typeof Element||Element.prototype.matches||((r=Element.prototype).matches=r.matchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector||r.webkitMatchesSelector),t.exports=function(e,t){for(;e&&9!==e.nodeType;){if(e.matches(t))return e;e=e.parentNode}}},{}],2:[function(e,t,n){var a=e("./closest");t.exports=function(e,t,n,r,i){var o=function(t,n,e,r){return function(e){e.delegateTarget=a(e.target,n),e.delegateTarget&&r.call(t,e)}}.apply(this,arguments);return e.addEventListener(n,o,i),{destroy:function(){e.removeEventListener(n,o,i)}}}},{"./closest":1}],3:[function(e,t,n){n.node=function(e){return e!==undefined&&e instanceof HTMLElement&&1===e.nodeType},n.nodeList=function(e){var t=Object.prototype.toString.call(e);return e!==undefined&&("[object NodeList]"===t||"[object HTMLCollection]"===t)&&"length"in e&&(0===e.length||n.node(e[0]))},n.string=function(e){return"string"==typeof e||e instanceof String},n.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},{}],4:[function(e,t,n){var c=e("./is"),u=e("delegate");t.exports=function(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!c.string(t))throw new TypeError("Second argument must be a String");if(!c.fn(n))throw new TypeError("Third argument must be a Function");if(c.node(e))return s=t,l=n,(a=e).addEventListener(s,l),{destroy:function(){a.removeEventListener(s,l)}};if(c.nodeList(e))return r=e,i=t,o=n,Array.prototype.forEach.call(r,function(e){e.addEventListener(i,o)}),{destroy:function(){Array.prototype.forEach.call(r,function(e){e.removeEventListener(i,o)})}};if(c.string(e))return u(document.body,e,t,n);var r,i,o,a,s,l;throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},{"./is":3,delegate:2}],5:[function(e,t,n){t.exports=function(e){var t,n;return e="SELECT"===e.nodeName?(e.focus(),e.value):"INPUT"===e.nodeName||"TEXTAREA"===e.nodeName?((t=e.hasAttribute("readonly"))||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),t||e.removeAttribute("readonly"),e.value):(e.hasAttribute("contenteditable")&&e.focus(),t=window.getSelection(),(n=document.createRange()).selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t.toString())}},{}],6:[function(e,t,n){function r(){}r.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function i(){r.off(e,i),t.apply(n,arguments)}return i._=t,this.on(e,i,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;r<i;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var o=0,a=r.length;o<a;o++)r[o].fn!==t&&r[o].fn._!==t&&i.push(r[o]);return i.length?n[e]=i:delete n[e],this}},t.exports=r},{}],7:[function(e,t,n){var r,i;r=this,i=function(e,t){var n=(t=t)&&t.__esModule?t:{"default":t};var r="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(e){return h(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":h(e)};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)})(o,[{key:"resolveOptions",value:function(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:{};this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir"),t=(this.removeFake(),this.fakeHandlerCallback=function(){return e.removeFake()},this.fakeHandler=document.body.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[t?"right":"left"]="-9999px",window.pageYOffset||document.documentElement.scrollTop);this.fakeElem.style.top=t+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,n["default"])(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,n["default"])(this.target),this.copyText()}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(e){this.emitter.emit(e?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:"copy";if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(e!==undefined){if(!e||"object"!==(void 0===e?"undefined":r(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}]);t=o;function o(e){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");this.resolveOptions(e),this.initSelection()}e.exports=t},void 0!==n?i(t,e("select")):(i(n={exports:{}},r.select),r.clipboardAction=n.exports)},{select:5}],8:[function(e,t,n){var r,i;r=this,i=function(e,t,n,r){var i=a(t),t=a(n),o=a(r);function a(e){return e&&e.__esModule?e:{"default":e}}n=function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e};function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+h(t));if(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t)if(Object.setPrototypeOf)Object.setPrototypeOf(e,t);else for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}l(c,t["default"]),n(c,[{key:"resolveOptions",value:function(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:{};this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText}},{key:"listenClick",value:function(e){var t=this;this.listener=(0,o["default"])(e,"click",function(e){return t.onClick(e)})}},{key:"onClick",value:function(e){e=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new i["default"]({action:this.action(e),target:this.target(e),text:this.text(e),trigger:e,emitter:this})}},{key:"defaultAction",value:function(e){return u("action",e)}},{key:"defaultTarget",value:function(e){e=u("target",e);if(e)return document.querySelector(e)}},{key:"defaultText",value:function(e){return u("text",e)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:["copy","cut"],e="string"==typeof e?[e]:e,t=!!document.queryCommandSupported;return e.forEach(function(e){t=t&&!!document.queryCommandSupported(e)}),t}}]);r=c;function c(e,t){var n;if(this instanceof c)return(n=function(e,t){if(e)return!t||"object"!==h(t)&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this))).resolveOptions(t),n.listenClick(e),n;throw new TypeError("Cannot call a class as a function")}function u(e,t){e="data-clipboard-"+e;if(t.hasAttribute(e))return t.getAttribute(e)}e.exports=r},void 0!==n?i(t,e("./clipboard-action"),e("tiny-emitter"),e("good-listener")):(i(n={exports:{}},r.clipboardAction,r.tinyEmitter,r.goodListener),r.clipboard=n.exports)},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)})}catch(e){}}.call(this,n(68))},function(e,t,n){"use strict";BI.ClipBoard=BI.inherit(BI.BasicButton,{_defaultConfig:function(){return BI.extend(BI.ClipBoard.superclass._defaultConfig.apply(this,arguments),{extraCls:"bi-clipboard",el:{type:"bi.layout"},copy:BI.emptyFn,afterCopy:BI.emptyFn})},render:function(){return this.options.el},mounted:function(){var e=this.options;if(window.Clipboard)this.clipboard=new Clipboard(this.element[0],{text:function(){return BI.isFunction(e.copy)?e.copy():e.copy}}),this.clipboard.on("success",e.afterCopy);else{if(!window.clipboardData)throw new Error("not support");this.element.on("click",function(){window.clipboardData.setData("Text",BI.isFunction(e.copy)?e.copy():e.copy)&&e.afterCopy()})}},destroyed:function(){this.clipboard&&this.clipboard.destroy()}}),BI.shortcut("bi.clipboard",BI.ClipBoard)},function(e,t,n){"use strict";BI.Draggable=BI.inherit(BI.Widget,{props:{baseCls:"bi-materials-draggable",onDragStart:BI.emptyFn,onDrag:BI.emptyFn,onDragEnd:BI.emptyFn,el:{}},render:function(){var o=this,a=this.options;return this.startX=0,this.startY=0,this.tracker=new BI.MouseMoveTracker(function(e,t){var n=BI.$("body").width(),r=BI.$("body").height(),i=o.element.bounds(),e=(o.startX+=e,o.startY+=t,BI.clamp(o.startX,0,n-i.width)),t=BI.clamp(o.startY,0,r-i.height);o.element.css({left:e+"px",top:t+"px"}),a.onDrag({left:e,top:t})},function(){o.tracker.releaseMouseMoves(),a.onDragEnd()},window),this.options.el},mounted:function(){var n=this,r=this.options;this.element.mousedown(function(e){var t=n.element.offset();n.startX=t.left,n.startY=t.top,n.tracker.captureMouseMoves(e),r.onDragStart()})}}),BI.shortcut("bi.materials.draggable",BI.Draggable)},function(e,t,n){"use strict";BI.CodeEditor=BI.inherit(BI.Single,{props:{baseCls:"bi-code-editor",value:"",watermark:"",lineHeight:2,readOnly:!1,lineNumbers:!1,paramMatch:!0,paramFormatter:function(e){return e}},render:function(){var n=this.options,r=this,e={lineWrapping:!0,lineNumbers:n.lineNumbers,readOnly:n.readOnly,specialChars:/[\u0000-\u001f\u007f\u00ad\u200c-\u200f\u2028\u2029\ufeff]/,mode:n.mode};n.readOnly&&(e.cursorBlinkRate=-1),this.editor=BI.CodeMirror(this.element[0],e),1===n.lineHeight?this.element.addClass("codemirror-low-line-height"):this.element.addClass("codemirror-high-line-height"),this.editor.on("change",function(e,t){!0===e.options.readOnly&&"paste"===t.origin&&r.editor.setValue(n.value),r._checkWaterMark(),BI.nextTick(function(){r.fireEvent(BI.CodeEditor.EVENT_CHANGE)})}),this.editor.on("focus",function(){r._checkWaterMark(!1),r.fireEvent(BI.CodeEditor.EVENT_FOCUS)}),this.editor.on("blur",function(){r.watermark.setVisible(BI.isEmptyString(r.getValue())),r.fireEvent(BI.CodeEditor.EVENT_BLUR)}),this.editor.on("inputRead",function(e,t){"paste"===t.origin&&BI.nextTick(function(){r.editor.replaceSelection(" ");var e=r.editor.getDoc().getCursor();r.editor.getDoc().replaceRange("",{line:e.line,ch:e.ch-1},e)})}),this.watermark=BI.createWidget({type:"bi.label",text:n.watermark,cls:"bi-water-mark",whiteSpace:"normal",textAlign:"left"}),this.watermark.element.bind("mousedown",function(e){r.insertString(""),r.editor.focus(),e.stopEvent()}),this.watermark.element.bind("click",function(e){r.editor.focus(),e.stopEvent()}),BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.watermark,top:3,left:n.lineNumbers?36:6,right:n.lineNumbers?36:6}]})},mounted:function(){var e=this.options;(BI.isNumber(e.value)||BI.isString(e.value))&&this.setValue(e.value),BI.isNotNull(e.style)&&this.setStyle(e.style)},_setEnable:function(e){BI.CodeEditor.superclass._setEnable.apply(this,arguments),this.editor.setOption("readOnly",!0!==e&&"nocursor")},_checkWaterMark:function(){var e=this.options;BI.isEmptyString(this.editor.getValue())&&BI.isKey(e.watermark)?this.watermark&&this.watermark.visible():this.watermark&&this.watermark.invisible()},_insertParam:function(e){var t=e,n="param",r=(e=this.options.paramFormatter(e),BI.isNotNull(e.match(/^<!.*!>$/))&&(n="error-param"),BI.isNotEmptyString(this.editor.getSelection())&&this.editor.replaceSelection(""),this.editor.getCursor()),i=(this.editor.replaceSelection("​"+e+"​"),this.editor.getCursor()),n={className:n,atomic:!0,replacedWith:BI.$("<span class='"+n+" start end' />").text(e)[0]};n.value=t,this.editor.markText(r,i,n)},_insertString:function(e){this.editor.replaceSelection(e)},_analyzeContent:function(e){return e.match(/\n|\$[\{][^\}]*[\}]|((?!\$\{).)*((?!\$\{).)|\$[^\{]*[^\$\{]/g)},getValue:function(){return this.editor.getValue("\n",function(e){var r=e.text,i=0;return _.forEach(_.sortBy(e.markedSpans,"from"),function(e,t){switch(e.marker.className){case"param":case"error-param":var n=e.to-e.from;r=r.substr(0,e.from+i)+"${"+e.marker.value+"}"+r.substr(e.to+i,r.length),i=(i+=3)+(e.marker.value.length-n)}}),r})},setValue:function(e){var r=this,t=this.options;this.refresh(),this.options.value=e,r.editor.setValue(""),t.paramMatch?(t=this._analyzeContent(e||""),BI.each(t,function(e,t){var n=t.match(/\$[\{][^\}]*[\}]/);BI.isNotEmptyArray(n)?r._insertParam(n[0].substring(2,t.length-1)):r._insertString(t)})):r.editor.setValue(e),this._checkWaterMark()},insertParam:function(e){this._insertParam(e),this.editor.focus()},insertString:function(e){this._insertString(e),this.editor.focus()},focus:function(){this.editor.focus()},blur:function(){this.editor.getInputField().blur()},setStyle:function(e){this.style=e,this.element.css(e)},getStyle:function(){return this.style},refresh:function(){var e=this;BI.nextTick(function(){e.editor.refresh()})},setVisible:function(e){BI.CodeEditor.superclass.setVisible.apply(this,arguments),e&&this.refresh()}}),BI.CodeEditor.EVENT_CHANGE="EVENT_CHANGE",BI.CodeEditor.EVENT_BLUR="EVENT_BLUR",BI.CodeEditor.EVENT_FOCUS="EVENT_FOCUS",BI.shortcut("bi.code_editor",BI.CodeEditor)},function(e,t,n){"use strict";function r(e,t,n){n=n||{},this.tokens=e,this.flags={lastToken:null,indentationLevel:0},this.flagsStore=[],this.valueGetter=n.valueGetter,this.output=t.getOutput()}r.prototype.beautify=function(){for(var e=this.tokens.next();e;)this.handleToken(e),this.flags.lastToken=e,e=this.tokens.next();return this.output.getResult()},r.prototype.handleToken=function(e){switch(e.type){case"string":this.handleString(e);break;case"field":this.handleField(e);break;case"comma":this.handleComma(e);break;case"bracket":this.handleBracket(e);break;case"atom":case"word":this.handleWord(e);break;case"keyword":this.handleKeyword(e);break;case"operator":this.handleOperator(e);break;default:this.handleCommon(e)}},r.prototype.handleCommon=function(e){this.checkNeedSpace(),this.output.addToken(e)},r.prototype.handleOperator=function(e){this.output.addSpaceBeforeToken(),this.output.addToken(e)},r.prototype.handleKeyword=function(e){this.checkNeedSpace(),this.output.addToken(e)},r.prototype.handleBracket=function(e){this.checkNeedSpace(),"("===e.string&&(this.flagsStore.push(this.flags),this.flags={lastToken:null,indentationLevel:this.flags.indentationLevel},this.output.addToken(e),this.indent(),this.output.addNewLine()),")"===e.string&&0<this.flagsStore.length&&(this.flags=this.flagsStore.pop(),this.setIndent(),this.output.addNewLine(),this.output.addToken(e))},r.prototype.checkNeedSpace=function(){this.flags.lastToken&&"operator"===this.flags.lastToken.type&&this.output.addSpaceBeforeToken()},r.prototype.handleComma=function(e){this.output.addToken(e),this.output.addNewLine()},r.prototype.handleString=function(e){this.checkNeedSpace(),this.output.addToken(e)},r.prototype.handleField=function(e){this.checkNeedSpace(),this.output.addToken(e,{valueGetter:this.valueGetter})},r.prototype.handleWord=function(e){this.checkNeedSpace(),this.output.addToken(e)},r.prototype.indent=function(){this.flags.indentationLevel+=1,this.output.setIndent(this.flags.indentationLevel)},r.prototype.setIndent=function(){this.output.setIndent(this.flags.indentationLevel)},r.prototype.deIndent=function(){this.flags.indentationLevel=this.flags.indentationLevel<0?0:this.flags.indentationLevel-1,this.output.setIndent(this.flags.indentationLevel)},BI.CodeMirror.defineExtension("beautify",function(e){return new r(this.getTokens(),this,e).beautify()})},function(e,t,n){"use strict";function r(){this.lines=[],this.previousLine=null,this.currentLine=null,this.nextLine=new i,this.addOutputLine()}function i(){this._indent_count=0,this.items=[]}r.prototype.addToken=function(e,t){this.currentLine.addText((t=t||{}).valueGetter?t.valueGetter(e.string):e.string)},r.prototype.addNewLine=function(e){return!(this.isEmpty()||!e&&this.justAddedNewline())&&(this.addOutputLine(),!0)},r.prototype.addNewLine=function(e){return!(this.isEmpty()||!e&&this.justAddedNewline())&&(this.addOutputLine(),!0)},r.prototype.addOutputLine=function(){this.previousLine=this.currentLine,this.currentLine=this.nextLine.cloneEmpty(),this.lines.push(this.currentLine)},r.prototype.justAddedNewline=function(){return this.currentLine.isEmpty()},r.prototype.isEmpty=function(){return!this.previousLine&&this.currentLine.isEmpty()},r.prototype.setIndent=function(e){this.nextLine.setIndent(e=e||0)},r.prototype.addSpaceBeforeToken=function(){this.justAddedNewline()||this.currentLine.addText(" ")},r.prototype.getResult=function(e){return this.lines.join("\n")},i.prototype.setIndent=function(e){this.isEmpty()&&(this._indent_count=e||0)},i.prototype.addText=function(e){this.items.push(e)},i.prototype.cloneEmpty=function(){var e=new i;return e.setIndent(this._indent_count),e},i.prototype.isEmpty=function(){return 0===this.items.length},i.prototype.toString=function(){for(var e="",t=0;t<this._indent_count;t++)e+="\t";return e+this.items.join("")},BI.CodeMirror.defineExtension("getOutput",function(){return new r})},function(e,t,n){"use strict";function r(e){this.tokens=e.filter(function(e){return!e.string.match(/\s/)})||[],this.position=-1}r.prototype.hasNext=function(){return 0<this.tokens.length&&this.position<this.tokens.length-1},r.prototype.next=function(){var e=null;return e=this.hasNext()?this.tokens[++this.position]:e},r.prototype.peek=function(e){var t=null;return e=e||0,t=0<=(e+=this.position)&&e<this.tokens.length?this.tokens[e]:t},BI.CodeMirror.defineExtension("getTokens",function(){var t=this;return new r(BI.flatten(BI.map(BI.range(0,this.getDoc().lineCount()),function(e){return t.getLineTokens(e)})))})},function(e,t,n){"use strict";var s,l;s=BI.CodeMirror,l=s.Pos,s.registerHelper("hint","formula",function(e,t){return function(e,t,n){var r=e.getCursor(),i=n(e,r);if(!/\b(?:string)\b/.test(i.type)){i.state=s.innerMode(e.getMode(),i.state).state,/^[\w$_\u4e00-\u9fa5]*$/.test(i.string)?i.end>r.ch&&(i.end=r.ch,i.string=i.string.slice(0,r.ch-i.start)):i={start:r.ch,end:r.ch,string:"",state:i.state,type:"."==i.string?"property":null};for(var o,a=i;"property"==a.type;){if("."!=(a=n(e,l(r.line,a.start))).string)return;a=n(e,l(r.line,a.start)),(o=o||[]).push(a)}return{list:function(e,t,n){var i=[],o=[],a=e.string;if(a)if(t&&t.length)t.pop();else for(var r=n,s=function(n){var e=[n.text];n.type===BICst.FORMULA_KEYWORD_TYPE.PARAM&&(t=BI.makeFirstPY(n.text,{splitChar:"​"}),r=t.toUpperCase(),(e=t.split("​").concat(r.split("​"))).push(n.text));{var t,r;BI.some(e,function(e,t){return 0==t.lastIndexOf(a,0)})&&(t=BI.filter(i,function(e,t){return t.value===n.value}),r=BI.some(t,function(e,t){return t.type===n.type}),!BI.isEmptyArray(t)&&r||(o.push(n.text),i.push(n)))}},l=0,c=r.length;l<c;++l)s(r[l]);return i}(i,o,t),from:l(r.line,i.start),to:l(r.line,i.end)}}}(e,e.keywordsGetter(),function(e,t){return e.getTokenAt(t)})})},function(e,t,n){"use strict";!function(M){"use strict";var F="CodeMirror-hint",D="CodeMirror-hint-active";function i(e,t){this.cm=e;this.options=t;this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor("start");this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var n=this;e.on("cursorActivity",this.activityFunc=function(){n.cursorActivity()})}M.showHint=function(e,t,n){if(!t)return e.showHint(n);if(n&&n["async"])t["async"]=true;var r={hint:t};if(n)for(var i in n)r[i]=n[i];return e.showHint(r)},M.defineExtension("showHint",function(e){e=a(this,this.getCursor("start"),e);var t=this.listSelections();if(t.length>1)return;if(this.somethingSelected()){if(!e.hint.supportsSelection)return;for(var n=0;n<t.length;n++)if(t[n].head.line!=t[n].anchor.line)return}if(this.state.completionActive)this.state.completionActive.close();var r=this.state.completionActive=new i(this,e);if(!r.options.hint)return;M.signal(this,"startCompletion",this);r.update(true)}),M.defineExtension("closeHint",function(){if(this.state.completionActive)this.state.completionActive.close()});var r=window.requestAnimationFrame||function(e){return setTimeout(e,1e3/60)},o=window.cancelAnimationFrame||clearTimeout;function a(e,t,n){var r=e.options.hintOptions;var i={};for(var o in u)i[o]=u[o];if(r)for(var o in r)if(r[o]!==undefined)i[o]=r[o];if(n)for(var o in n)if(n[o]!==undefined)i[o]=n[o];if(i.hint.resolve)i.hint=i.hint.resolve(e,t);return i}function H(e){if(typeof e==="string")return e;return e.text}function V(e,r){var i={Up:function l(){r.moveFocus(-1)},Down:function c(){r.moveFocus(1)},PageUp:function u(){r.moveFocus(-r.menuSize()+1,true)},PageDown:function h(){r.moveFocus(r.menuSize()-1,true)},Home:function d(){r.setFocus(0)},End:function p(){r.setFocus(r.length-1)},Enter:r.pick,Tab:r.pick,Esc:r.close};var t=e.options.customKeys;var o=t?{}:i;function n(e,t){var n;if(typeof t!=="string")n=function n(e){return t(e,r)};else if(i.hasOwnProperty(t))n=i[t];else n=t;o[e]=n}if(t)for(var a in t)if(t.hasOwnProperty(a))n(a,t[a]);var s=e.options.extraKeys;if(s)for(var a in s)if(s.hasOwnProperty(a))n(a,s[a]);return o}function j(e,t){while(t&&t!=e){if(t.nodeName.toUpperCase()==="DIV"&&t.parentNode==e)return t;t=t.parentNode}}function s(i,e){this.completion=i;this.data=e;this.picked=false;var n=this,o=i.cm;var a=o.getInputField().ownerDocument;var s=a.defaultView||a.parentWindow;var l=this.hints=a.createElement("div");var t=BI.createWidget({type:"bi.button_group",cls:"CodeMirror-hints bi-card",element:l,layouts:[{type:"bi.vertical"}]});this.selectedHint=e.selectedHint||0;var r=e.list;var c=[];for(var u=0;u<r.length;++u){var h=a.createElement("div"),d=r[u];var p={};var f=F+(u!=this.selectedHint?"":" "+D);if(d.className!=null)f=d.className+" "+f;if(d.render)p=BI.createWidget(d.render(h,e,d));else{var m=d.displayText||H(d);p=BI.createWidget({type:BI.isNotNull(d.iconCls)?"bi.icon_text_item":"bi.single_select_item",logic:{dynamic:true},height:24,cls:BI.isNotNull(d.iconCls)?f+" "+d.iconCls:f,textAlign:"left",text:m,title:m})}p.element[0].hintId=u;c.push(p)}t.populate(c);var g=o.cursorCoords(i.options.alignWithWord?e.from:null);var b=g.left,y=g.bottom,v=true;l.style.left=b+"px";l.style.top=y+"px";var _=s.innerWidth||Math.max(a.body.offsetWidth,a.documentElement.offsetWidth);var I=s.innerHeight||Math.max(a.body.offsetHeight,a.documentElement.offsetHeight);(i.options.container||a.body).appendChild(l);var x=l.getBoundingClientRect(),E=x.bottom-I;var S=l.scrollHeight>l.clientHeight+1;var T=o.getScrollInfo();if(E>0){var C=x.bottom-x.top,w=g.top-(g.bottom-x.top);if(w-C>0){l.style.top=(y=g.top-C)+"px";v=false}else if(C>I){l.style.height=I-5+"px";l.style.top=(y=g.bottom-x.top)+"px";var B=o.getCursor();if(e.from.ch!=B.ch){g=o.cursorCoords(B);l.style.left=(b=g.left)+"px";x=l.getBoundingClientRect()}}}var R=x.right-_;if(R>0){if(x.right-x.left>_){l.style.width=_-5+"px";R-=x.right-x.left-_}l.style.left=(b=g.left-R)+"px"}if(S)for(var N=l.firstChild;N;N=N.nextSibling)N.style.paddingRight=o.display.nativeBarWidth+"px";o.addKeyMap(this.keyMap=V(i,{moveFocus:function O(e,t){n.changeActive(n.selectedHint+e,t)},setFocus:function L(e){n.changeActive(e)},menuSize:function k(){return n.screenAmount()},length:r.length,close:function P(){i.close()},pick:function z(){n.pick()},data:e}));if(i.options.closeOnUnfocus){var A;o.on("blur",this.onBlur=function(){A=setTimeout(function(){i.close()},100)});o.on("focus",this.onFocus=function(){clearTimeout(A)})}o.on("scroll",this.onScroll=function(){var e=o.getScrollInfo(),t=o.getWrapperElement().getBoundingClientRect();var n=y+T.top-e.top;var r=n-(s.pageYOffset||(a.documentElement||a.body).scrollTop);if(!v)r+=l.offsetHeight;if(r<=t.top||r>=t.bottom)return i.close();l.style.top=n+"px";l.style.left=b+T.left-e.left+"px"});M.on(l,"dblclick",function(e){var t=j(l,e.target||e.srcElement);if(t&&t.hintId!=null){n.changeActive(t.hintId);n.pick()}});M.on(l,"click",function(e){var t=j(l,e.target||e.srcElement);if(t&&t.hintId!=null){n.changeActive(t.hintId);if(i.options.completeOnSingleClick)n.pick()}});M.on(l,"mousedown",function(){setTimeout(function(){o.focus()},20)});M.signal(e,"select",r[this.selectedHint],l.childNodes[this.selectedHint]);return true}function l(e,t){if(!e.somethingSelected())return t;var n=[];for(var r=0;r<t.length;r++)if(t[r].supportsSelection)n.push(t[r]);return n}function c(e,t,n,r){if(e["async"])e(t,r,n);else{var i=e(t,n);if(i&&i.then)i.then(r);else r(i)}}function e(e,t){var a=e.getHelpers(t,"hint"),n;if(a.length){var s=function s(e,n,r){var i=l(e,a);function o(t){if(t==i.length)return n(null);c(i[t],e,r,function(e){if(e&&e.list.length>0)n(e);else o(t+1)})}o(0)};s["async"]=true;s.supportsSelection=true;return s}else if(n=e.getHelper(e.getCursor(),"hintWords"))return function(e){return M.hint.fromList(e,{words:n})};else if(M.hint.anyword)return function(e,t){return M.hint.anyword(e,t)};else return function(){}}i.prototype={close:function t(){if(!this.active())return;this.cm.state.completionActive=null;this.tick=null;this.cm.off("cursorActivity",this.activityFunc);if(this.widget&&this.data)M.signal(this.data,"close");if(this.widget)this.widget.close();M.signal(this.cm,"endCompletion",this.cm)},active:function n(){return this.cm.state.completionActive==this},pick:function h(e,t){var n=e.list[t];if(n.hint)n.hint(this.cm,e,n);else switch(n.type){case BICst.FORMULA_KEYWORD_TYPE.KEYWORD:this.cm.replaceRange(H(n).toUpperCase(),n.from||e.from,n.to||e.to,"complete");this.cm.replaceSelection(" ");break;case BICst.FORMULA_KEYWORD_TYPE.FUNCTION:this.cm.replaceRange(H(n).toUpperCase(),n.from||e.from,n.to||e.to,"complete");var r=this.cm.getCursor();this.cm.markText(n.from||e.from,r,{className:"#function",atomic:true});this.cm.replaceSelection("()");r=this.cm.getCursor();r.ch=r.ch-1;this.cm.setCursor(r);this.cm.focus();break;case BICst.FORMULA_KEYWORD_TYPE.PARAM:var i=n.value;var o=n.text;var a=e.from;var s=o.replaceAll("^<!.*!>$",function(e){return e.substring(2,e.length-2)});this.cm.replaceRange("​"+s+"​",a,e.to,"complete");var r=this.cm.getCursor("to");var l="fieldName";this.cm.markText(a,r,{className:l,handleMouseEvents:true,atomic:true,startStyle:"start",endStyle:"end",value:i,replacedWith:BI.$("<span class='"+l+"  start end' />").text(s)[0]});break;default:break}M.signal(e,"pick",n);this.close()},cursorActivity:function d(){if(this.debounce){o(this.debounce);this.debounce=0}var e=this.cm.getCursor(),t=this.cm.getLine(e.line);if(e.line!=this.startPos.line||t.length-e.ch!=this.startLen-this.startPos.ch||e.ch<this.startPos.ch||this.cm.somethingSelected()||!e.ch||this.options.closeCharacters.test(t.charAt(e.ch-1)))this.close();else{var n=this;this.debounce=r(function(){n.update()});if(this.widget)this.widget.disable()}},update:function p(t){if(this.tick==null)return;var n=this,r=++this.tick;c(this.options.hint,this.cm,this.options,function(e){if(n.tick==r)n.finishUpdate(e,t)})},finishUpdate:function f(e,t){if(this.data)M.signal(this.data,"update");var n=this.widget&&this.widget.picked||t&&this.options.completeSingle;if(this.widget)this.widget.close();this.data=e;if(e&&e.list.length)if(n&&e.list.length==1)this.pick(e,0);else{this.widget=new s(this,e);M.signal(e,"shown")}}},s.prototype={close:function t(){if(this.completion.widget!=this)return;this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var e=this.completion.cm;if(this.completion.options.closeOnUnfocus){e.off("blur",this.onBlur);e.off("focus",this.onFocus)}e.off("scroll",this.onScroll)},disable:function m(){this.completion.cm.removeKeyMap(this.keyMap);var e=this;this.keyMap={Enter:function t(){e.picked=true}};this.completion.cm.addKeyMap(this.keyMap)},pick:function h(){this.completion.pick(this.data,this.selectedHint)},changeActive:function g(e,t){if(e>=this.data.list.length)e=t?this.data.list.length-1:0;else if(e<0)e=t?0:this.data.list.length-1;if(this.selectedHint==e)return;var n=this.hints.childNodes[this.selectedHint];if(n)n.className=n.className.replace(" "+D,"");n=this.hints.childNodes[this.selectedHint=e];n.className+=" "+D;if(n.offsetTop<this.hints.scrollTop)this.hints.scrollTop=n.offsetTop-3;else if(n.offsetTop+n.offsetHeight>this.hints.scrollTop+this.hints.clientHeight)this.hints.scrollTop=n.offsetTop+n.offsetHeight-this.hints.clientHeight+3;M.signal(this.data,"select",this.data.list[this.selectedHint],n)},screenAmount:function b(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},M.registerHelper("hint","auto",{resolve:e}),M.registerHelper("hint","fromList",function(e,t){var n=e.getCursor(),r=e.getTokenAt(n);var i,o=M.Pos(n.line,r.start),a=n;if(r.start<n.ch&&/\w/.test(r.string.charAt(n.ch-r.start-1)))i=r.string.substr(0,n.ch-r.start);else{i="";o=n}var s=[];for(var l=0;l<t.words.length;l++){var c=t.words[l];if(c.slice(0,i.length)==i)s.push(c)}if(s.length)return{list:s,from:o,to:a}}),M.commands.autocomplete=M.showHint;var u={hint:M.hint.auto,completeSingle:true,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:true,container:null,customKeys:null,extraKeys:null};M.defineOption("hintOptions",null)}(BI.CodeMirror)},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e){return e&&e.bracketRegex||/[(){}[\]]/}function u(e,t,n){var r=e.getLineHandle(t.line),i=t.ch-1,o=n&&n.afterCursor,a=(null==o&&(o=/(^| )cm-fat-cursor($| )/.test(e.getWrapperElement().className)),m(n)),o=!o&&0<=i&&a.test(r.text.charAt(i))&&b[r.text.charAt(i)]||a.test(r.text.charAt(i+1))&&b[r.text.charAt(++i)];return!o||(a=">"==o.charAt(1)?1:-1,n&&n.strict&&0<a!=(i==t.ch)||(r=e.getTokenTypeAt(g(t.line,i+1)),null==(e=s(e,g(t.line,i+(0<a?1:0)),a,r||null,n))))?null:{from:g(t.line,i),to:e&&e.pos,match:e&&e.ch==o.charAt(0),forward:0<a}}function s(e,t,n,r,i){for(var o=i&&i.maxScanLineLength||1e4,a=i&&i.maxScanLines||1e3,s=[],l=m(i),c=0<n?Math.min(t.line+a,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-a),u=t.line;u!=c;u+=n){var h=e.getLine(u);if(h){var d=0<n?0:h.length-1,p=0<n?h.length:-1;if(!(h.length>o))for(u==t.line&&(d=t.ch-(n<0?1:0));d!=p;d+=n){var f=h.charAt(d);if(l.test(f)&&(r===undefined||e.getTokenTypeAt(g(u,d+1))==r))if(">"==b[f].charAt(1)==0<n)s.push(f);else{if(!s.length)return{pos:g(u,d),ch:f};s.pop()}}}}return u-n!=(0<n?e.lastLine():e.firstLine())&&null}function o(e,t,n){for(var r=e.state.matchBrackets.maxHighlightLineLength||1e3,i=[],o=e.listSelections(),a=0;a<o.length;a++){var s,l=o[a].empty()&&u(e,o[a].head,n);l&&e.getLine(l.from.line).length<=r&&(s=l.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",i.push(e.markText(l.from,g(l.from.line,l.from.ch+1),{className:s})),l.to&&e.getLine(l.to.line).length<=r&&i.push(e.markText(l.to,g(l.to.line,l.to.ch+1),{className:s})))}if(i.length){h&&e.state.focused&&e.focus();var c=function c(){e.operation(function(){for(var e=0;e<i.length;e++)i[e].clear()})};if(!t)return c;setTimeout(c,800)}}var a,h,g,b;a=BI.CodeMirror,h=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),g=a.Pos,b={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"},a.defineOption("matchBrackets",!1,function(e,t,n){var r=function r(){var e=arguments;BI.defer(function(){!function(e){e.operation(function(){e.state.matchBrackets.currentlyHighlighted&&(e.state.matchBrackets.currentlyHighlighted(),e.state.matchBrackets.currentlyHighlighted=null),e.state.matchBrackets.currentlyHighlighted=o(e,!1,e.state.matchBrackets)})}.apply(null,e)})};n&&n!=a.Init&&(e.off("cursorActivity",r),e.state.matchBrackets&&e.state.matchBrackets.currentlyHighlighted&&(e.state.matchBrackets.currentlyHighlighted(),e.state.matchBrackets.currentlyHighlighted=null)),t&&(e.state.matchBrackets="object"==i(t)?t:{},e.on("cursorActivity",r))}),a.defineExtension("matchBrackets",function(){o(this,!0)}),a.defineExtension("findMatchingBracket",function(e,t,n){return u(this,e,t=!n&&"boolean"!=typeof t?t:n?(n.strict=t,n):t?{strict:!0}:null)}),a.defineExtension("scanForBracket",function(e,t,n,r){return s(this,e,t,n,r)})},function(e,t,n){"use strict";!function(e){"use strict";e.defineMode("formula",function(e){function t(e){var t={};for(var n=0,r=e.length;n<r;++n)t[e[n]]=true;return t}var i=t(["false","true"]);var o=t(BI.map(e.keywordsGetter(),"text"));function n(e,t){if(e.eatSpace())return null;var n=e.next();if(n==='"'||n==="'"){a(e,n);return"string"}if(n==="​"){a(e,n);return"field"}if(/,/.test(n))return"comma";if(/[()\[\]]/.test(n))return"bracket";if(/[+\-*\/=<>!&\^|]/.test(n))return"operator";e.eatWhile(/[\u4e00-\u9fa5\w-.]/);var r=e.current();if(i.hasOwnProperty(r))return"atom";if(o.hasOwnProperty(r))return"keyword";return"word"}function a(e,t){var n=false,r;while((r=e.next())!=null){if(r===t&&!n)return false;n=!n&&r==="\\"}return n}function r(e,t){return(t.tokens[0]||n)(e,t)}return{startState:function s(){return{tokens:[]}},token:function l(e,t){return r(e,t)},fold:"brace"}}),e.defineMIME("text/fx-formula","formula"),e.defineOption("keywordsGetter",false,function(e,t){e.keywordsGetter=BI.isFunction(t)?t:function(e){return e}})}(BI.CodeMirror)},function(e,t,n){"use strict";BI.FormulaCollections=["abs","ABS","acos","ACOS","acosh","ACOSH","add2array","ADD2ARRAY","and","AND","array","ARRAY","asin","ASIN","asinh","ASINH","atan","ATAN","atan2","ATAN2","atanh","ATANH","average","AVERAGE","bitnot","BITNOT","bitoperation","BITOPERATION","ceiling","CEILING","char","CHAR","circular","CIRCULAR","class","CLASS","cnmoney","CNMONEY","code","CODE","col","COL","colcount","COLCOUNT","colname","COLNAME","combin","COMBIN","concatenate","CONCATENATE","correl","CORREL","cos","COS","cosh","COSH","count","COUNT","crosslayertotal","CROSSLAYERTOTAL","date","DATE","datedelta","DATEDELTA","datedif","DATEDIF","dateinmonth","DATEINMONTH","dateinquarter","DATEINQUARTER","dateinweek","DATEINWEEK","dateinyear","DATEINYEAR","datesubdate","DATESUBDATE","datetime","DATETIME","datetonumber","DATETONUMBER","day","DAY","days360","DAYS360","daysofmonth","DAYSOFMONTH","daysofquarter","DAYSOFQUARTER","daysofyear","DAYSOFYEAR","dayvalue","DAYVALUE","decimal","DECIMAL","decode","DECODE","degrees","DEGREES","encode","ENCODE","endwith","ENDWITH","enmoney","ENMONEY","ennumber","ENNUMBER","eval","EVAL","even","EVEN","exact","EXACT","exp","EXP","fact","FACT","fields","FIELDS","filename","FILENAME","filesize","FILESIZE","filetype","FILETYPE","find","FIND","floor","FLOOR","format","FORMAT","getuserdepartments","GETUSERDEPARTMENTS","getuserjobtitles","GETUSERJOBTITLES","greparray","GREPARRAY","hierarchy","HIERARCHY","hour","HOUR","i18n","I18N","if","IF","inarray","INARRAY","index","INDEX","indexof","INDEXOF","indexofarray","INDEXOFARRAY","int","INT","isnull","ISNULL","joinarray","JOINARRAY","jvm","JVM","layertotal","LAYERTOTAL","left","LEFT","len","LEN","let","LET","ln","LN","log","LOG","log10","LOG10","lower","LOWER","lunar","LUNAR","map","MAP","maparray","MAPARRAY","max","MAX","median","MEDIAN","mid","MID","min","MIN","minute","MINUTE","mod","MOD","mom","MOM","month","MONTH","monthdelta","MONTHDELTA","now","NOW","numto","NUMTO","nvl","NVL","odd","ODD","or","OR","pi","PI","power","POWER","product","PRODUCT","promotion","PROMOTION","proper","PROPER","proportion","PROPORTION","radians","RADIANS","rand","RAND","randbetween","RANDBETWEEN","range","RANGE","rank","RANK","records","RECORDS","regexp","REGEXP","removearray","REMOVEARRAY","repeat","REPEAT","replace","REPLACE","reverse","REVERSE","reversearray","REVERSEARRAY","right","RIGHT","round","ROUND","round5","ROUND5","rounddown","ROUNDDOWN","roundup","ROUNDUP","row","ROW","rowcount","ROWCOUNT","second","SECOND","seq","SEQ","sign","SIGN","sin","SIN","sinh","SINH","slicearray","SLICEARRAY","sort","SORT","sortarray","SORTARRAY","split","SPLIT","sql","SQL","sqrt","SQRT","startwith","STARTWITH","stdev","STDEV","substitute","SUBSTITUTE","sum","SUM","sumsq","SUMSQ","switch","SWITCH","tabledatafields","TABLEDATAFIELDS","tabledatas","TABLEDATAS","tables","TABLES","tan","TAN","tanh","TANH","time","TIME","tobigdecimal","TOBIGDECIMAL","tobinary","TOBINARY","todate","TODATE","today","TODAY","todouble","TODOUBLE","tohex","TOHEX","toimage","TOIMAGE","tointeger","TOINTEGER","tooctal","TOOCTAL","totext","TOTEXT","treelayer","TREELAYER","trim","TRIM","trunc","TRUNC","uniquearray","UNIQUEARRAY","upper","UPPER","uuid","UUID","value","VALUE","webimage","WEBIMAGE","week","WEEK","weekdate","WEEKDATE","weekday","WEEKDAY","weightedaverage","WEIGHTEDAVERAGE","year","YEAR","yeardelta","YEARDELTA"]},function(e,t,n){"use strict";var o=(n=n(111))&&n.__esModule?n:{"default":n};var r=function r(){var t={};this.addChecker=function(e){BI.extend(t,e)},this.$get=function(){return function(){return t}}};BI.provider("bi.formula_editor.checker",r),BI.FormulaEditor=BI.inherit(BI.Single,{constants:{paramRegex:/(\$[\{][^\}]*[\}])/},props:{baseCls:"bi-formula-editor",watermark:"",value:"",showHint:!0,showTip:!0,lineHeight:2,lineWrapping:!0,lineNumbers:!1,paramFormatter:function(e){return e},valueGetter:function(e){return e},keywordsGetter:function(){return BI.FormulaCollections},formulaChecker:BI.emptyFn,paramTypeGetter:BI.emptyFn},render:function(){var n=this.options,i=this,r=(this.errorTipText="",this._isEditing=!1,this.formulaEditor=BI.createWidget({type:"bi.default"}),BI.CodeMirror.hint.formula),o=(BI.CodeMirror.hint.formula=function(e,t){var n=r(e,t);return n&&(BI.CodeMirror.on(n,"shown",function(){i.fireEvent("EVENT_SHOW_HINT",BI.get(n,"list",[]))}),BI.CodeMirror.on(n,"select",function(e){i.fireEvent("EVENT_SELECT_HINT",e)}),BI.CodeMirror.on(n,"pick",function(e){i.fireEvent("EVENT_PICK_HINT",e)})),n},this.editor=BI.CodeMirror(this.formulaEditor.element[0],{lineWrapping:n.lineWrapping,lineNumbers:n.lineNumbers,mode:"formula",specialChars:/[\u0000-\u001f\u007f\u00ad\u200c-\u200f\u2028\u2029\ufeff]/,matchBrackets:BI.isIE()?null:{maxScanLines:2e3,maxHighlightLineLength:2e3},keywordsGetter:function(){var e=n.keywordsGetter();return BI.map(e,function(e,t){return BI.isKey(t)?{text:t,value:t,type:BICst.FORMULA_KEYWORD_TYPE.FUNCTION,iconCls:"formula-function-font"}:t})},configureMouse:function(){return{addNew:!1}}}),1===n.lineHeight?this.element.addClass("codemirror-low-line-height"):this.element.addClass("codemirror-high-line-height"),BI.debounce(function(){BI.nextTick(function(){i.fireEvent(BI.FormulaEditor.EVENT_CHANGE)})},300)),a=(this.editor.on("change",function(e,t){i._checkWaterMark(),n.showHint&&i.editor.hasFocus()&&BI.CodeMirror.showHint(e,BI.CodeMirror.formulaHint,{completeSingle:!1}),o()}),this.editor.setOption("extraKeys",{"Ctrl-X":function(e){i._getSelection(e),e.replaceSelection(""),e.focus()},"Cmd-X":function(e){i._getSelection(e),e.replaceSelection(""),e.focus()},"Cmd-C":function(e){i._getSelection(e)},"Ctrl-C":function(e){i._getSelection(e)}}),{"（）":"()","【】":"[]","｛｝":"{}","「」":"{}","『』":"{}","，":",","（":"(","【":"[","｛":"{","）":")","】":"]","｝":"}","「":"{","」":"}","『":"{","』":"}","“”":'""',"‘’":"''","“":'"',"‘":"'","”":'"',"’":"'"}),e=(this.editor.on("inputRead",function(e,t){if(("*compose"===t.origin||"+input"===t.origin)&&a[t.text[0]]){var n=e.getCursor(),n=e.getTokenAt(n);if(/\b(?:string)\b/.test(n.type)){e=n.string.length;if(2<n.string.length&&'"'===n.string.charAt(0)&&'"'===n.string.charAt(e-1))return}var r=BI.clone(t.from);BI.nextTick(function(){var e=i.editor.getDoc().getCursor();i.editor.getDoc().replaceRange("",r,e),i._setValue(a[t.text[0]],r),o()})}"paste"===t.origin&&(r=BI.clone(t.from),BI.nextTick(function(){var e=i.editor.getDoc().getCursor();i.editor.getDoc().replaceRange("",r,e),i._setValue(i._removeInvisibleChar(t.text.join("\n")),r),o()}))}),this.editor.on("focus",function(){i._isEditing=!0,i._checkWaterMark(),i.fireEvent(BI.FormulaEditor.EVENT_FOCUS)}),this.editor.on("blur",function(){i._isEditing=!1,i.fireEvent(BI.FormulaEditor.EVENT_BLUR)}),this.editor.on("keyup",function(e,t){i.fireEvent(BI.FormulaEditor.EVENT_KEY_UP,t.key)}),this.editor.on("cursorActivity",function(e){i.fireEvent(BI.FormulaEditor.EVENT_CURSOR_ACTIVITY,e)}),[{el:{type:"bi.vertical",invisible:!0,items:[{type:"bi.label",cls:"error-tip",hgap:5,vgap:2,ref:function(e){i.errorText=e},text:""}],ref:function(e){i.errorTip=e}},left:0,bottom:0},{el:{type:"bi.vertical",invisible:!n.showTip,items:[{type:"bi.label",hgap:5,vgap:2,cls:"bi-tips",text:BI.i18nText("BI-Basic_Formula_Valid")}],ref:function(e){i.normalTip=e}},left:0,bottom:0}]);BI.isKey(this.options.watermark)?((i=this).watermark=BI.createWidget({type:"bi.text",cls:"bi-water-mark",text:this.options.watermark,whiteSpace:"normal",textAlign:"left"}),BI.createWidget({type:"bi.absolute",element:i,items:[{el:this.formulaEditor,left:0,right:0,top:0,bottom:n.showTip?24:0},{el:i.watermark,left:6,right:6,top:3}].concat(e)}),this.watermark.element.bind("mousedown",function(e){i.insertString(""),i.editor.focus(),e.stopEvent()}),this.watermark.element.bind("click",function(e){i.editor.focus(),e.stopEvent()})):BI.createWidget({type:"bi.absolute",element:i,items:[{el:this.formulaEditor,left:0,right:0,top:0,bottom:n.showTip?24:0}].concat(e)})},mounted:function(){var e=this.options;BI.isNotNull(e.value)&&this.setValue(e.value)},_removeInvisibleChar:function(e){return BI.replaceAll(e||"","​","")},_getSelection:function(e){var t=this,n=(this.clipboard||(r=BI.createWidget({type:"bi.layout",invisible:!0}),this.clipboard=BI.createWidget({type:"bi.clipboard",el:r,copy:function(){return n},afterCopy:function(){t.clipboard.destroy(),t.clipboard=null}}),BI.createWidget({type:"bi.absolute",element:"body",items:[{el:this.clipboard}]})),e.getDoc().getSelection()||""),r=BI.filter(n.split("​"),function(e){return e%2==1}).sort(function(e,t){return t.length-e.length}),r=BI.map(r,function(e,t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}),n=n.replaceAll(BI.concat(r,"​").join("|"),function(e,t){return"​"!==e?0===t||"​"!==n[t-1]?e:"${"+e+"}":""});this.clipboard.element.click()},_checkWaterMark:function(){var e=this.options;!this.disabledWaterMark&&BI.isEmptyString(this.editor.getValue())&&BI.isKey(e.watermark)?this.watermark&&this.watermark.visible():this.watermark&&this.watermark.invisible()},_setEnable:function(e){BI.FormulaEditor.superclass._setEnable.apply(this,arguments),this.editor.setOption("readOnly",!0!==e&&"nocursor")},_analyzeContent:function(e){return e.match(/\$[\{][^\}]*[\}]|(\w|\.)+|\$\{[^\$\(\)\+\-\*\/)\$,]*\w\}|\$\{[^\$\(\)\+\-\*\/]*\w\}|\$\{[^\$\(\)\+\-\*\/]*[\u4e00-\u9fa5]\}|\w|(.)|\n/g)},selectAll:function(){this.editor.execCommand("selectAll"),this._isEditing=!0},disableWaterMark:function(){this.disabledWaterMark=!0,this._checkWaterMark()},focus:function(){!0==!this._isEditing&&(this.editor.focus(),this.selectAll())},showTip:function(e){this.normalTip.setVisible(!1),this.errorTip.setVisible(!0),e&&this.errorText.setText(e)},hideTip:function(){this.normalTip.setVisible(!0),this.errorTip.setVisible(!1)},getTip:function(){return this.errorTipText},_insertField:function(e,t){var n=e,e=this.options.paramFormatter(e)||"undefined",r=BI.clone(this.editor.getCursor("from")),i=e.replaceAll("^<!.*!>$",function(e){return e.substring(2,e.length-2)}),o=(this.editor.replaceSelection("​"+i+"​"),this.editor.getCursor("to")),a="fieldName";BI.isNotNull(e.match("^<!.*!>$"))&&!t&&(a="error-field"),this.editor.markText(r,o,{className:a,handleMouseEvents:!0,atomic:!0,startStyle:"start",endStyle:"end",value:n,replacedWith:BI.$("<span class='"+a+"  start end' />").text(i)[0]})},insertField:function(e,t){this._insertField(e,t),this.editor.focus()},_insertFunction:function(e){var t=BI.clone(this.editor.getCursor("from")),e=(this.editor.replaceSelection(e),this.editor.getCursor("to"));this.editor.markText(t,e,{className:"#function",atomic:!0}),this.editor.replaceSelection("()"),(e=this.editor.getCursor()).ch=e.ch-1,this.editor.setCursor(e)},_isFunction:function(n){return BI.some(this.options.keywordsGetter(),function(e,t){t=t.text||t;return n===t.toLowerCase()||n===t.toUpperCase()})},_setFunction:function(e){var t=this.editor.getCursor(),e=(this.editor.replaceSelection(e),this.editor.getCursor());this.editor.markText(t,e,{className:"#function",atomic:!0})},insertFunction:function(e){this._insertFunction(e),this.editor.focus()},_insertOperator:function(e){var t=this.editor.getCursor(),e=(this.editor.replaceSelection(e),this.editor.getCursor());this.editor.markText(t,e,{className:"%operator",atomic:!0})},insertOperator:function(e){this._insertOperator(e),this.editor.focus()},_insertString:function(e){this.editor.replaceSelection(e)},insertString:function(e){this._insertString(e),this.editor.focus()},getFormulaString:function(){return this.editor.getValue()},getUsedFields:function(){var r=[];return this.editor.getValue(!0,function(e){_.forEach(e.markedSpans,function(e,t){switch(e.marker.className){case"fieldName":case"error-field":var n=e.marker.value;BI.contains(r,n)||r.push(n)}})}),r},getCheckString:function(){return this.editor.getValue(!0,function(e){var r=e.text,i=0,e=_.clone(e.markedSpans)||[];return e.sort(function(e,t){return e.from-t.from}),_.forEach(e,function(e,t){switch(e.marker.className){case"fieldName":case"error-field":var n=e.to-e.from;r=r.substr(0,e.from+i)+"$a"+r.substr(e.to+i,r.length),i=i+2-n}}),r}).replaceAll("(\\$\\{.*?\\})\\s*|​",function(e,t){return"​"!==e?t:""})},getValue:function(){return this.editor.getValue("\n",function(e){var i=e.text,o=0,e=_.clone(e.markedSpans)||[];return e.sort(function(e,t){return e.from-t.from}),_.forEach(e,function(e,t){switch(e.marker.className){case"fieldName":case"error-field":var n=e.to-e.from,r=e.marker.value;i=i.substr(0,e.from+o)+"${"+r+"}"+i.substr(e.to+o,i.length),o+=r.length-n+3}}),i}).replaceAll("(\\$\\{.*?\\})\\s*|​",function(e,t){return"​"!==e?t:""})},markField:function(e){var t=e.invalid?"error-field":"fieldName";this.editor.markText(e.from,e.to,{handleMouseEvents:!0,className:t,atomic:!0,startStyle:"start",endStyle:"end",value:e.value,replacedWith:BI.$("<span class='"+t+"  start end' />").text(e.text)[0]})},markFunction:function(e){this.editor.markText(e.from,e.to,{className:"#function",atomic:!0})},getParamWrap:function(){return"​"},beautify:function(){var t=this,n=this.options,e=this.editor.beautify({valueGetter:function(e){return"${"+n.valueGetter(t._removeInvisibleChar(e))+"}"}});this.setValue(e)},_setValue:function(e,t){var s=this,l=this.constants,c=this.options,u=this._analyzeContent(e=e||""),h=[],d=[],p=0,f=0,m="",g=(BI.isNotNull(t)&&(p=t.line,f=t.ch),s.getParamWrap());BI.each(u,function(e,t){var n,r,i,o,a,e=e===u.length-1?"":u[e+1];l.paramRegex.test(t)?(n=t.substring(2,t.length-1),r=c.paramFormatter(n),i=(r=BI.isNull(r)?c.valueGetter(n)?(r=n,n=c.valueGetter(r),c.paramFormatter(n)):"<!"+n+"!>":r).replaceAll("^<!.*!>$",function(e){return e.substring(2,e.length-2)}),i=g+i+g,o=BI.CodeMirror.Pos(p,f),m+=i,f+=i.length,a=BI.CodeMirror.Pos(p,f),h.push({from:o,to:a,value:n,invalid:/^<!.*!>$/.test(r),text:i})):("("===e[0]&&s._isFunction(t)&&(o=BI.CodeMirror.Pos(p,f),a=BI.CodeMirror.Pos(p,f+t.length),d.push({from:o,to:a,value:t})),"\n"===t&&(p++,f=0),m+=t,"\n"!==t&&(f+=t.length))}),this.insertString(m),BI.each(h,function(e,t){s.markField(t)}),BI.each(d,function(e,t){s.markFunction(t)})},setValue:function(e){this.editor.setValue(""),this._setValue(e)},refresh:function(){var e=this;BI.nextTick(function(){e.editor.refresh()})},setVisible:function(e){BI.FormulaEditor.superclass.setVisible.apply(this,arguments),e&&this.refresh()},check:function(e){var t,n=this,r=new o["default"](this.options.formulaChecker()),e=e||this.getValue();if(e){try{r.parse(e.replace(/\$\{.*?\}/g,function(e){var t=e.substring(2,e.length-1);switch(n.options.paramTypeGetter(t)){case"number":return 1;case"boolean":return!0;case"date":return'"bi-date-place-holder"';default:return'"'+t+'"'}}))}catch(i){t=i}return t}}}),BI.FormulaEditor.EVENT_CHANGE="EVENT_CHANGE",BI.FormulaEditor.EVENT_BLUR="EVENT_BLUR",BI.FormulaEditor.EVENT_FOCUS="EVENT_FOCUS",BI.FormulaEditor.EVENT_KEY_UP="EVENT_KEY_UP",BI.FormulaEditor.EVENT_CURSOR_ACTIVITY="EVENT_CURSOR_ACTIVITY",BI.shortcut("bi.formula_editor",BI.FormulaEditor)},function(e,t,n){"use strict";BI.RichEditorAction=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.RichEditorAction.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"",used:!0})},_init:function(){BI.RichEditorAction.superclass._init.apply(this,arguments);var n=this,r=this.options;r.editor.on(BI.NicEditor.EVENT_SELECTED,function(t){BI.defer(function(){var e;!0===r.used&&(e=window.getSelection().focusNode,n.setEnable(!0),n.checkNodes(e||t.target),n.key(t))})})},checkNodes:function(e){if(e){var t=e;do{if(this.options.tags&&BI.contains(this.options.tags,t.nodeName))return this.activate(),!0}while(t=t.parentNode&&t.className&&-1<=t.className.indexOf("bi-nic-editor"));for(t=e;3==t.nodeType;)t=t.parentNode;if(this.options.css)for(var n in this.options.css){if(null==this.options.css[n])return this.activate(this._getDomStyle(t,n),e),!0;if(BI.$(t).css(n)==this.options.css[n])return this.activate(),!0}this.deactivate()}return!1},start:function(){},key:function(){},keydown:function(){},hideIf:function(e){},activate:function(){},deactivate:function(){},restoreRng:function(){this.options.editor.restoreRng()},doCommand:function(e){this.restoreRng(),this.options.command&&this.options.editor.nicCommand(this.options.command,e)},getValue:function(){},_getDomStyle:function(e,n){var r,i,o=this;return"color"===n?o._getDomColor(e):(r=BI.$(e).css(n),e.children&&1===e.children.length?o._getDomStyle(e.children[0],n)||r:(i=null,BI.each(e.children,function(e,t){""!==t.innerText&&(t=o._getDomStyle(t,n)||r,i?i!==t&&(i=r):i=t)}),i||r))},_getDomColor:function(e){for(var t=BI.get(e,["style","color"],BI.DOM.hex2rgb(e.getAttribute("color")));BI.isEmpty(t)&&"P"!==e.tagName;)e=e.parentNode,t=BI.get(e,["style","color"],BI.DOM.hex2rgb(e.getAttribute("color")));return t="transparent"===(t=""!==t&&"inherit"!==t?t:"")?"rgba(0, 0, 0, 0)":t}})},function(e,t,n){"use strict";BI.RichEditorParamAction=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorParamAction.superclass._defaultConfig.apply(this,arguments),{paramFormatter:function(e){return e}})},_init:function(){BI.RichEditorParamAction.superclass._init.apply(this,arguments)},addParam:function(e,t){var n=this.options,r=n.editor.instance,i=new Image,n=n.paramFormatter(e),o=BI.DOM.getImage(n);i.src=o.src,i.alt=BI.isFunction(t)?t(e):e,BI.$(i).addClass("rich-editor-param"),BI.$(i).attr("style",o.style),BI.$(i).attr("name",window.encodeURIComponent(n)),r.insertHTML(BI.$("<div>").append(i).html(),!0)}})},function(e,t,n){"use strict";BI.RichEditorTextToolbar=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.RichEditorTextToolbar.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-rich-editor-text-toolbar",buttons:[{type:"bi.rich_editor_font_chooser"},{type:"bi.rich_editor_size_chooser"},{type:"bi.rich_editor_bold_button"},{type:"bi.rich_editor_italic_button"},{type:"bi.rich_editor_underline_button"},{type:"bi.rich_editor_color_chooser"},{type:"bi.rich_editor_background_color_chooser"},{type:"bi.rich_editor_align_left_button"},{type:"bi.rich_editor_align_center_button"},{type:"bi.rich_editor_align_right_button"},{type:"bi.rich_editor_param_button"}],height:34})},_init:function(){BI.RichEditorTextToolbar.superclass._init.apply(this,arguments);var n=this.options,e=BI.createWidgets(BI.map(n.buttons,function(e,t){return BI.extend(t,{editor:n.editor,height:24})}));BI.createWidget({type:"bi.horizontal",element:this,items:e,hgap:3,vgap:5})},mounted:function(){var e=this;BI.isIE9Below()&&(this.element.mousedown(function(){e._noSelect(e.element[0])}),this._noSelect(this.element[0]))},_noSelect:function(e){e.setAttribute&&"input"!=e.nodeName.toLowerCase()&&"textarea"!=e.nodeName.toLowerCase()&&e.setAttribute("unselectable","on");for(var t=0;t<e.childNodes.length;t++)this._noSelect(e.childNodes[t])}}),BI.shortcut("bi.rich_editor_text_toolbar",BI.RichEditorTextToolbar)},function(e,t,n){"use strict";function r(){return BI.isIE()&&BI.getIEVersion()<11}function d(e){return BI.isNull(e)?"":BI.replaceAll(e+"",'&|\\$|{|}|"|<|>',function(e){return i[e]||"&nbsp;"})}var i,o,a,s,l,c,u,h,p,f,m,g;i={"&":"&amp;",$:"&dollar;","{":"&lcub;","}":"&rcub;",'"':"&quot;","<":"&lt;",">":"&gt;"},o={NORMAL:"normal",ESCAPE:"escape",JSON:"json"},BI.NicEditor=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.NicEditor.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-nic-editor",$testId:"bi-nic-editor",scrollable:!0})},_init:function(){BI.NicEditor.superclass._init.apply(this,arguments);var e=this.options,e=(BI.$(document).bind("mousedown."+this.getName(),BI.bind(this.selectCheck,this)),e.scrollable?{}:{scrollable:!1,scrolly:!1});BI.createWidget(BI.extend(e,{type:"bi.vertical",element:this,items:[this.instance=this.addInstance()]}))},addInstance:function(){var e,t=this.options,t={type:"bi.nic_editor_instance",ne:this,height:t.height,maxHeight:t.maxHeight||null,readOnly:t.readOnly,singleLine:t.singleLine};return this.element[0].contentEditable||window.opera?e=BI.createWidget(t):console.error("不支持此浏览器"),e},insertElem:function(e){this.selectedInstance&&this.selectedInstance.insertElem(e)},insertHTML:function(e){this.selectedInstance&&this.selectedInstance.insertHTML(e)},nicCommand:function(e,t){this.selectedInstance&&this.selectedInstance.nicCommand(e,t)},selectCheck:function(e){var t=e.target;do{if(t===this.instance.element[0]||!this.instance.element.is(":visible"))return;if(this.instance.checkToolbar(t))return void this.instance.saveRng()}while(t=t.parentNode);this.instance.saveRng(),this.fireEvent("blur",t),this.lastSelectedInstance=this.selectedInstance||this.lastSelectedInstance,this.selectedInstance=null},blur:function(){this.instance.blur(),this.instance.nicCommand("UnSelect")},focus:function(){this.instance.focus()},bindToolbar:function(e){this.instance.bindToolbar(e)},setValue:function(e){BI.isString(e)?this.instance.setContent(e):this.instance.setJSONValue(e)},getValue:function(e){switch(e){case o.ESCAPE:return this.instance.getEscapeContent();case o.JSON:return this.instance.getJSONValue();default:return this.instance.getContent()}},getContentHeight:function(){return this.instance.getContentHeight()},getInstance:function(){return this.instance},restoreRng:function(){this.selectedInstance=this.instance,this.selectedInstance.restoreRng()},destroyed:function(){(window.getSelection?window.getSelection():document.selection).removeAllRanges(),BI.$(document).unbind("mousedown."+this.getName())}}),BI.NicEditor.EVENT_SELECTED="selected",BI.NicEditor.EVENT_BLUR="blur",BI.NicEditor.EVENT_FOCUS="focus",BI.NicEditor.EVENT_KEYDOWN="keydown",BI.NicEditor.EVENT_KEYUP="keyup",BI.NicEditor.htmlEncode=d,BI.NicEditor.htmlDecode=function(e){return BI.isNull(e)?"":BI.replaceAll(e+"","&amp;|&dollar;|&lcub;|&rcub;|&quot;|&lt;|&gt;|&nbsp;",function(e){switch(e){case"&amp;":return"&";case"&dollar;":return"$";case"&lcub;":return"{";case"&rcub;":return"}";case"&quot;":return'"';case"&lt;":return"<";case"&gt;":return">";default:return" "}})},BI.NicEditor.FormatType=o,BI.shortcut("bi.nic_editor",BI.NicEditor),a="niceditor-",s=["class","style","color","face","name","width","height","alt","src","align","href","target"],l={1:12,2:13,3:16,4:18,5:24,6:32,7:48},c=["div","p","span","font","b","strong","i","u","em","br"],u=["color","font-family","font-size","font-weight"],h=["style","face","color"],p=function p(n){return 3!==n.nodeType&&1===n.nodeType&&"img"!==n.tagName.toLowerCase()&&(n.style.cssText=BI.reduce(n.style.cssText.split(";"),function(e,t){var n=BI.replaceAll(e.split(":")[0]," ",""),r="";return t+(r=u.includes(n)?n+":"+e.split(":")[1]:r)+";"},""),BI.each(Object.values(n.attributes),function(e,t){t&&!h.includes(t.name)&&n.removeAttribute(t.name)})),n},f=function f(e){if(e&&3!==e.nodeType){if(1===e.nodeType){var t=e.tagName.toLowerCase();if(c.includes(t)||"img"===t&&e.className.includes("rich-editor-param"))p(e);else try{var n=e.innerText;return"style"!==t&&"script"!==t&&"title"!==t||(n=""),e.parentNode.replaceChild(document.createTextNode(n),e),e}catch(i){console.log(i)}}for(var r=e.childNodes.length-1;0<=r;r--)1!==e.childNodes[r].nodeType&&3!==e.childNodes[r].nodeType?e.removeChild(e.childNodes[r]):f(e.childNodes[r])}return e},m={replaceHtmlSymbol:function(e){return null==e?"":e.replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;").replace(/(\r\n|\r|\n)/g,"<br/>")},_cleanBlockAttr:function(e,n){return function r(e){var i=BI.$(e),t=BI.map(e.attributes,function(e,t){return t.nodeName});return i[0]&&"SCRIPT"===i[0].tagName?(i.destroy(),null):i[0]&&3===i[0].nodeType?i[0]:(BI.each(n,function(e,t){var n,r;t&&("fontSize"===e&&i[0].style&&i[0].style.fontSize?(n=-1<(t=i[0].style.fontSize).indexOf("pt")?4/3:1,r=BI.Constants.getConstant("bi.constant.materials.rich_editor.font_size_range"),i.css(e,BI.clamp(parseInt(t)*n,r.MIN,r.MAX)+"px")):i.css(e,""))}),BI.each(t,function(e,t){try{"size"===t&&"FONT"===i[0].tagName&&i.css("fontSize",l[i.attr("size")]),BI.contains(s,t)||i.removeAttr(t)}catch(n){}}),BI.each(e.children,function(e,t){r(t)}),e)}(e)},_formatAttr:function(e){var t=BI.isIE();return function n(e){return t&&e.style&&""!==e.style.textAlign&&(e.align=e.style.textAlign,e.style.textAlign=""),BI.each(e.children,function(e,t){n(t)}),e}(e)},getPasteHtml:function(e,t){var n;return(e=!e&&t?BI.$("<p>"+m.replaceHtmlSymbol(t)+"</p>"):e)?(n=document.createElement("div"),BI.each(e,function(e,t){n.appendChild(t)}),f(n),BI.reduce(n.childNodes,function(e,t){return t+((3===e.nodeType?e.nodeValue:e.outerHTML)||"")},"")):""},getFormatHtml:function(e){return BI.reduce(e,function(e,t){e=m._cleanBlockAttr(e,{fontSize:!0});return t+((3===(e=m._formatAttr(e)).nodeType?e.nodeValue:e.outerHTML)||"")},"")}},g=BI.inherit(BI.Layout,{isSelected:!1,_init:function(){g.superclass._init.apply(this,arguments);var e=this.options,t=(t=e.value||"<br>").startWith("<p>")?t:"<p>"+t+"</p>";this.ne=this.options.ne,this.elm=BI.createWidget({type:"bi.layout",width:e.width-8,scrollable:!1}),this.elm.element.css({minHeight:BI.isNumber(e.height)?e.height-8+"px":e.height,outline:"none",padding:"0 10px",wordBreak:"break-all"}).html(e.readOnly?BI.Text.formatText(t):t),e.readOnly&&this.elm.element.attr("contentEditable",!1),this.element.css("maxHeight",e.maxHeight?e.maxHeight+"px":null),this.e=BI.createWidget({type:"bi.layout",invisible:!0,tagName:"textarea"}),BI.createWidget({type:"bi.default",element:this,scrolly:!0,items:[this.elm,this.e]}),this.ne.on("blur",BI.bind(this.blur,this)),this.start(),this.blur()},start:function(){this.elm.element.attr("contentEditable",!0!==this.options.readOnly),this.getContent(),this.instanceDoc=document.defaultView,this.elm.element.on("mousedown",BI.bind(this.selected,this)),this.elm.element.on("keydown",BI.bind(this.keyDown,this)),this.elm.element.on("focus",BI.bind(this.selected,this)),this.elm.element.on("blur",BI.bind(this.blur,this)),this.elm.element.on("keyup",BI.bind(this.selected,this)),this.elm.element.on("paste",BI.bind(this.paste,this)),this.ne.fireEvent("add")},getSel:function(){return window.getSelection?window.getSelection():document.selection},getRng:function(){var e=this.getSel();if(e&&0!==e.rangeCount)return 0<e.rangeCount?e.getRangeAt(0):e.createRange()},getSavedRng:function(){return this.savedRange},selRng:function(e,t){window.getSelection?(t.removeAllRanges(),t.addRange(e)):e.select()},selElm:function(){var e=this.getRng();if(e){if(e.startContainer){var t=e.startContainer;if(1==e.cloneContents().childNodes.length)for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n].ownerDocument.createRange();if(r.selectNode(t.childNodes[n]),1!=e.compareBoundaryPoints(Range.START_TO_START,r)&&-1!=e.compareBoundaryPoints(Range.END_TO_END,r))return t.childNodes[n]}return t}return"Control"==this.getSel().type?e.item(0):e.parentElement()}},saveRng:function(e){try{var t=this.getRng();(this._isChildOf(this.getSelectionContainerElem(t),this.element[0])&&(!this.savedRange||this.savedRange.collapsed)||e)&&(this.savedRange=t,this.savedSel=this.getSel())}catch(n){}},getSelectionContainerElem:function(e){if(e)return 1===(e=e.commonAncestorContainer).nodeType?e:e.parentNode},setFocus:function(e){try{e.focus()}catch(a){}if(window.getSelection){var t=function(e){var t=BI.$(e)[0];if(!t)return 0;switch(t.nodeType){case 7:case 10:return 0;case 3:case 8:return t.length;default:return t.childNodes.length}}(e),n=BI.$(e).contents().last(),r=document.createRange(),n=(n.is("br")?--t:n[0]||3===e.nodeType||(t=0),BI.$(e).is("img")?r.setEndAfter(e,t):r.setEnd(e,t),r.collapse(!1),window.getSelection());n.removeAllRanges(),n.addRange(r)}else{try{e.focus()}catch(a){}(t=document.selection.createRange()).moveStart("character",-e.innerText.length);for(var i=t.text,o=0;o<e.innerText.length;o++)e.innerText.substring(0,o+1)==i.substring(i.length-o-1,i.length)&&(result=o+1)}},removeRng:function(){this.savedRange=null},restoreRng:function(){this.savedRange&&this.selRng(this.savedRange,this.savedSel),this.savedRange=null},restoreRngAndClearRange:function(){this.savedRange&&(this.savedRange.setStart(this.savedRange.endContainer,this.savedRange.endOffset),this.selRng(this.savedRange,this.savedSel))},keyDown:function(e,t){if(8===e.keyCode){var n=this.elm.element.html().toLowerCase().trim();if("<p><br></p>"===n||"<p></p>"===n)return void e.preventDefault()}13===e.keyCode&&this.options.singleLine?e.preventDefault():this.ne.fireEvent("keydown",e)},selected:function(e){var t;"mousedown"===e.type&&this.removeRng(),e.target||this.selElm()||this.selElm(),e.ctrlKey||((t=this.ne.selectedInstance)!=this&&(t&&this.ne.fireEvent("blur",e),(this.ne.selectedInstance=this).ne.fireEvent("focus",e)),this.ne.fireEvent("selected",e),this.isFocused=!0,this.elm.element.addClass(a+"selected")),this.ne.fireEvent("keyup",e),8!==e.keyCode||(t=this.elm.element.html().toLowerCase().trim())&&"<br>"!==t||(e=BI.$(this._getNewLine()),this.elm.element.html(""),this.elm.element.append(e),this.setFocus(e[0]))},focus:function(){var e=this;try{this.removeRng(),this.setFocus(this.elm.element[0]),this.nicCommand("selectAll")}catch(t){setTimeout(function(){e.focus()})}},blur:function(){this.isFocused=!1,this.elm.element.removeClass(a+"selected")},paste:function(e){var t="",n="";if(e.originalEvent.clipboardData&&!BI.isIE()&&(t=e.originalEvent.clipboardData.getData("text/html"),n=e.originalEvent.clipboardData.getData("text/plain")),t)try{this.saveRng(),this.insertHTML(m.getPasteHtml(BI.$(t),n)),e.preventDefault()}catch(e){this._pasteByBin()}else BI.isEmpty(n)&&this._pasteByBin()},_pasteByBin:function(){var r=this,i=BI.$("<div contenteditable='true' />").addClass("bi-paste-bin").attr("tabIndex","-1").appendTo(this.element);this.savedRange=null,this.saveRng(!0),i.focus(),BI.defer(function(){r.restoreRng();var e=BI.$("<div />").append(i.contents()),t=i[0].innerText,e=m.getPasteHtml(e,t);try{r.insertHTML(e)}catch(n){r.insertHTML("<p>"+t+"</p>")}i.remove()})},saveContent:function(){this.ne.fireEvent("save"),this.e.element.value(this.getContent())},getElm:function(){return this.elm},getEscapeContent:function(){return this.ne.fireEvent("get"),this.elm.element?BI.reduce(this.elm.element.contents(),function(e,t){return t+function h(e){var r={"for":"htmlFor","class":"className"},t="",n="",i="",o=e,e=o.nodeType,a=String.prototype.toLowerCase.call(o.tagName||"");switch(e){case 1:var s=o.attributes,l="";if(s){for(var c={},u=0;u<s.length;u++)c[s[u].nodeName]=undefined;"input"===o.tagName?"checkbox"===o.type||"radio"===o.type?c.checked=!1:"file"!==o.type&&(c.value=""):"option"===a?c.selected=!1:"textarea"===a&&(c.value=""),BI.each(c,function(e,t){var n=r[e]||e;(o.getAttribute?o.getAttribute(e):o[n])!==t&&(l=l+" "+e+'="'+d(o.getAttribute(e))+'"')})}t="<"+a+l+">",BI.contains(["img","br","input","hr","meta","link","param"],a)||(n="</"+a+">");break;case 3:t=d(o.nodeValue)||""}return BI.each(o.childNodes,function(e,t){i+=h(t)}),t+i+n}(e)},""):""},getContent:function(){return this.content=this.getElm().element.html(),this.ne.fireEvent("get"),this.content},getParseContent:function(){},getContentHeight:function(){return this.elm.element.height()},getJSONValue:function(){return this.getContent(),{tagName:"root",childNodes:BI.map(this.getElm().element.contents(),function(e,t){return function l(r){var i={"for":"htmlFor","class":"className"},e={nodeType:r.nodeType},t=(r.tagName?e.tagName=r.tagName.toLowerCase():r.nodeName&&(e.nodeName=r.nodeName),r.nodeValue&&(e.nodeValue=r.nodeValue),r.attributes);if(t){for(var n={},o=0;o<t.length;o++)n[t[o].nodeName]=undefined;"input"===e.tagName?"checkbox"===r.type||"radio"===r.type?n.checked=!1:"file"!==r.type&&(n.value=""):"option"===e.tagName?n.selected=!1:"textarea"===e.tagName&&(n.value="");var a=[];BI.each(n,function(e,t){var n=i[e]||e;(n=r.getAttribute?r.getAttribute(e):r[n])!==t&&a.push([e,n])}),a.length&&(e.attributes=a)}var s=r.childNodes;if("textarea"!==e.tagName&&s&&s.length)for(a=e.childNodes=[],o=0;o<s.length;o++)a[o]=l(s[o]);return e}(t)})}},setJSONValue:function(e){var n="",e="root"===(e=e||{}).tagName?e.childNodes:BI.isArray(e)?e:[e];BI.each(e,function(e,t){n+=function a(e){var t="",n="",r="",i="string"==typeof e?JSON.parse(e):e,e=i.nodeType,o=i.tagName;switch(e){case 1:t="<"+o+BI.reduce(i.attributes,function(e,t){return t+" "+d(e[0])+'="'+d(e[1])+'"'},"")+">",BI.contains(["img","br","input","hr","meta","link","param"],o)||(n="</"+o+">");break;case 3:t=d(i.nodeValue)||""}return BI.each(i.childNodes,function(e,t){r+=a(t)}),t+r+n}(t)}),this.setContent(n)},setContent:function(e){e=(e=(e=e||(r()?"":"<br>")).startWith("<p")?e:"<p>"+e).endWith("</p>")?e:e+"</p>",this.content=m.getFormatHtml(BI.$(e)),this.ne.fireEvent("set"),this.elm.element.html(this.content)},insertElem:function(e){var t=this.getRng();t.insertNode&&(t.deleteContents(),t.insertNode(e))},insertHTML:function(e,t){this.restoreRng();var r=this.getSel(),i=this.savedRange||this.getRng();if(i){if(t)return n(e);try{if(!document.queryCommandSupported("insertHTML"))throw new Error("Does not support this command");this.nicCommand("insertHTML",e)}catch(o){n(e)}}function n(e){if(i.insertNode){var t=BI.$(e);if(i.deleteContents(),i.startContainer&&i.endContainer&&i.endContainer===i.startContainer&&"BR"===i.startContainer.tagName)try{i.setStart(i.startContainer.parentNode,i.startContainer.parentNode.childNodes.length-1),i.setEnd(i.endContainer.parentNode,i.endContainer.parentNode.childNodes.length)}catch(o){i.setStart(i.startContainer.parentNode,0),i.setEnd(i.endContainer.parentNode,0)}for(var n=0;n<t.length;n++)i.insertNode(t[n]);i.endContainer&&(r.removeAllRanges(),i.setStart(i.endContainer,i.endOffset),i.setEnd(i.endContainer,i.endOffset),r.addRange(i))}else i.pasteHTML&&i.pasteHTML(e)}},bindToolbar:function(e){this.toolbar=e},checkToolbar:function(e){return this.toolbar&&this.toolbar.element[0]===e},nicCommand:function(e,t){document.execCommand(e,!1,t)},initSelection:function(e){var t=this._getNewLine(),n=this.elm.element,r=n.children();if(r.length){r=r.last();if(e){var e=r.html().toLowerCase(),i=r.nodeName;if("<br>"!==e&&"<br/>"!==e||"P"!==i)return n.append(t),void this.initSelection()}for(var o,a=r[0];a;)a=(o=a).childNodes?a.childNodes[a.childNodes.length-1]:null;this.setFocus(o)}else n.append(t),this.initSelection()},_getNewLine:function(){return r()?"<p>&nbsp;</p>":"<p><br></p>"},_isChildOf:function(e,t){var n;if(e&&t)for(n=e.parentNode;n;){if(t===n)return!0;n=n.parentNode}return!1}}),BI.shortcut("bi.nic_editor_instance",g)},function(e,t,n){"use strict";BI.RichEditorBackgroundChooserTrigger=BI.inherit(BI.Widget,{_defaultConfig:function(){var e=BI.RichEditorBackgroundChooserTrigger.superclass._defaultConfig.apply(this,arguments);return BI.extend(e,{width:20,height:20})},_init:function(){BI.RichEditorBackgroundChooserTrigger.superclass._init.apply(this,arguments),this.font=BI.createWidget({type:"bi.icon_button",title:BI.i18nText("BI-Basic_Background_Color"),cls:"text-background-font"}),this.underline=BI.createWidget({type:"bi.icon_button",cls:"text-color-underline-font"}),BI.createWidget({type:"bi.absolute_center_adapt",element:this,items:[{el:this.underline},{el:this.font}]})},setValue:function(e){this.underline.element.css("color",e)},getValue:function(){return this.underline.element.css("color")}}),BI.shortcut("bi.rich_editor_background_color_chooser_trigger",BI.RichEditorBackgroundChooserTrigger)},function(e,t,n){"use strict";BI.RichEditorAlignCenterButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorAlignCenterButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"justifycenter"})},_init:function(){BI.RichEditorAlignCenterButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.align=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Word_Align_Center"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-align-center-font"}),this.align.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){for(var t=this,n=e;3===n.nodeType;)n=n.parentNode;for(;1===n.nodeType&&"div"===n.tagName.toLowerCase();)n=n.firstChild;n&&1===n.nodeType||BI.isNotNull(n.tagName)||(n=n.parentNode);try{BI.defer(function(){"center"===BI.get(getComputedStyle(n),"textAlign")||"-moz-center"===BI.get(getComputedStyle(n),"textAlign")?t.activate():t.deactivate()})}catch(r){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.align.setSelected(!0)},deactivate:function(){this.align.setSelected(!1)}}),BI.shortcut("bi.rich_editor_align_center_button",BI.RichEditorAlignCenterButton)},function(e,t,n){"use strict";BI.RichEditorAlignLeftButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorAlignLeftButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"justifyleft"})},_init:function(){BI.RichEditorAlignLeftButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.align=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Word_Align_Left"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-align-left-font"}),this.align.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){for(var t=this,n=e;3===n.nodeType;)n=n.parentNode;for(;1===n.nodeType&&"div"===n.tagName.toLowerCase();)n=n.firstChild;n&&1===n.nodeType||BI.isNotNull(n.tagName)||(n=n.parentNode);try{BI.defer(function(){"left"===BI.get(getComputedStyle(n),"textAlign")||"start"===BI.get(getComputedStyle(n),"textAlign")||"-moz-left"===BI.get(getComputedStyle(n),"textAlign")?t.activate():t.deactivate()})}catch(r){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.align.setSelected(!0)},deactivate:function(){this.align.setSelected(!1)}}),BI.shortcut("bi.rich_editor_align_left_button",BI.RichEditorAlignLeftButton)},function(e,t,n){"use strict";BI.RichEditorAlignRightButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorAlignRightButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"justifyright"})},_init:function(){BI.RichEditorAlignRightButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.align=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Word_Align_Right"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-align-right-font"}),this.align.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){for(var t=this,n=e;3===n.nodeType;)n=n.parentNode;for(;1===n.nodeType&&"div"===n.tagName.toLowerCase();)n=n.firstChild;n&&1===n.nodeType||BI.isNotNull(n.tagName)||(n=n.parentNode);try{BI.defer(function(){"right"===BI.get(getComputedStyle(n),"textAlign")||"-moz-right"===BI.get(getComputedStyle(n),"textAlign")?t.activate():t.deactivate()})}catch(r){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.align.setSelected(!0)},deactivate:function(){this.align.setSelected(!1)}}),BI.shortcut("bi.rich_editor_align_right_button",BI.RichEditorAlignRightButton)},function(e,t,n){"use strict";BI.RichEditorBoldButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorBoldButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"Bold",tags:["B","STRONG"],css:{}})},_init:function(){BI.RichEditorBoldButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.bold=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Basic_Bold"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-bold-font"}),this.bold.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){var t=this;try{BI.defer(function(){document.queryCommandState("bold")?t.activate():t.deactivate()})}catch(n){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.bold.setSelected(!0)},deactivate:function(){this.bold.setSelected(!1)}}),BI.shortcut("bi.rich_editor_bold_button",BI.RichEditorBoldButton)},function(e,t,n){"use strict";BI.RichEditorItalicButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorItalicButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"Italic",tags:["EM","I"],css:{fontStyle:"italic"}})},_init:function(){BI.RichEditorItalicButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.italic=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Basic_Italic"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-italic-font"}),this.italic.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){var t=this;try{BI.defer(function(){document.queryCommandState("italic")?t.activate():t.deactivate()})}catch(n){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.italic.setSelected(!0)},deactivate:function(){this.italic.setSelected(!1)}}),BI.shortcut("bi.rich_editor_italic_button",BI.RichEditorItalicButton)},function(e,t,n){"use strict";BI.RichEditorParamButton=BI.inherit(BI.RichEditorParamAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorParamButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:30})},_init:function(){BI.RichEditorParamButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.param=BI.createWidget({type:"bi.button",element:this,level:"ignore",minWidth:0,text:BI.i18nText("BI-Formula_Insert"),height:t.height,width:t.width}),this.param.on(BI.Button.EVENT_CHANGE,function(){e.addParam("参数")})},activate:function(){},deactivate:function(){}}),BI.shortcut("bi.rich_editor_param_button",BI.RichEditorParamButton)},function(e,t,n){"use strict";BI.RichEditorUnderlineButton=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorUnderlineButton.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"Underline",tags:["U"],css:{}})},_init:function(){BI.RichEditorUnderlineButton.superclass._init.apply(this,arguments);var e=this,t=this.options;this.underline=BI.createWidget({type:"bi.icon_button",element:this,title:BI.i18nText("BI-Basic_Underline"),height:t.height,width:t.width,cls:"text-toolbar-button bi-list-item-active text-underline-font"}),this.underline.on(BI.IconButton.EVENT_CHANGE,function(){e.doCommand()})},checkNodes:function(e){var t=this;try{BI.defer(function(){document.queryCommandState("underline")?t.activate():t.deactivate()})}catch(n){BI.RichEditorBoldButton.superclass.checkNodes(e)}},activate:function(){this.underline.setSelected(!0)},deactivate:function(){this.underline.setSelected(!1)}}),BI.shortcut("bi.rich_editor_underline_button",BI.RichEditorUnderlineButton)},function(e,t,n){"use strict";BI.RichEditorColorChooserTrigger=BI.inherit(BI.Widget,{_defaultConfig:function(){var e=BI.RichEditorColorChooserTrigger.superclass._defaultConfig.apply(this,arguments);return BI.extend(e,{width:20,height:20})},_init:function(){BI.RichEditorColorChooserTrigger.superclass._init.apply(this,arguments),this.font=BI.createWidget({type:"bi.icon_button",title:BI.i18nText("BI-Basic_Font_Color"),cls:"text-color-font",warningTitle:this.options.warningTitle}),this.underline=BI.createWidget({type:"bi.icon_button",cls:"text-color-underline-font"}),BI.createWidget({type:"bi.absolute_center_adapt",element:this,items:[{el:this.underline},{el:this.font}]}),BI.isNotNull(this.options.value)&&this.setValue(this.options.value)},setValue:function(e){this.underline.element.css("color",e)},getValue:function(){return this.underline.element.css("color")}}),BI.shortcut("bi.rich_editor_color_chooser_trigger",BI.RichEditorColorChooserTrigger)},function(e,t,n){"use strict";BI.RichEditorBackgroundColorChooser=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorBackgroundColorChooser.superclass._defaultConfig.apply(this,arguments),{width:20,height:20})},_init:function(){BI.RichEditorBackgroundColorChooser.superclass._init.apply(this,arguments);var t=this,e=this.options;this.colorchooser=BI.createWidget({type:"bi.color_chooser",container:null,element:this,width:e.width,height:e.height,destroyWhenHide:e.destroyWhenHide,recommendColorsGetter:e.recommendColorsGetter,el:{type:"bi.rich_editor_background_color_chooser_trigger",title:BI.i18nText("BI-Widget_Background_Colour"),cls:"text-toolbar-button"}}),this.colorchooser.on(BI.ColorChooser.EVENT_CHANGE,function(){var e=this.getValue();t.fireEvent("EVENT_CHANGE",e)}),this.colorchooser.on(BI.ColorChooser.EVENT_AFTER_POPUPVIEW,function(){t.fireEvent("EVENT_AFTER_POPUPVIEW")})},setValue:function(e){this.colorchooser.setValue(e)},hideIf:function(e){0<!this.colorchooser.element.find(e.target).length&&this.colorchooser.hideView()},deactivate:function(){}}),BI.RichEditorBackgroundColorChooser.EVENT_CHANGE="EVENT_CHANGE",BI.RichEditorBackgroundColorChooser.EVENT_AFTER_POPUPVIEW="EVENT_AFTER_POPUPVIEW",BI.shortcut("bi.rich_editor_background_color_chooser",BI.RichEditorBackgroundColorChooser)},function(e,t,n){"use strict";BI.RichEditorColorChooser=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorColorChooser.superclass._defaultConfig.apply(this,arguments),{width:20,height:20,command:"foreColor",css:{color:null}})},_init:function(){BI.RichEditorColorChooser.superclass._init.apply(this,arguments);var t=this,e=this.options;this.colorchooser=BI.createWidget({type:"bi.color_chooser",container:null,element:this,width:e.width,height:e.height,destroyWhenHide:e.destroyWhenHide,recommendColorsGetter:e.recommendColorsGetter,el:{type:"bi.rich_editor_color_chooser_trigger",title:BI.i18nText("BI-Font_Colour"),cls:"text-toolbar-button",disabled:e.disabled,warningTitle:e.warningTitle}}),this.colorchooser.on(BI.ColorChooser.EVENT_CHANGE,function(){var e=this.getValue();BI.isIE()?t.doCommand(e):(document.execCommand("styleWithCSS",null,!0),t.doCommand(e||"inherit"),document.execCommand("styleWithCSS",null,!1))})},hideIf:function(e){0<!this.colorchooser.element.find(e.target).length&&this.colorchooser.hideView()},activate:function(t){var n=this;BI.delay(function(){var e=BI.DOM.rgb2hex(t);0===(BI.DOM.isRGBColor(t)?BI.DOM.rgba2json(t):{}).a&&(e="transparent"),n.colorchooser.setValue(e)},0)},deactivate:function(){this.colorchooser.setValue("")}}),BI.shortcut("bi.rich_editor_color_chooser",BI.RichEditorColorChooser)},function(e,t,n){"use strict";BI.RichEditorFontChooser=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorFontChooser.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-rich-editor-font-chooser bi-card",command:"FontName",width:100,height:24,css:{fontFamily:null},$testId:"bi-rich-editor-font-chooser",simple:!1})},_init:function(){BI.RichEditorSizeChooser.superclass._init.apply(this,arguments);var t=this,e=this.options;this.trigger=BI.createWidget({type:"bi.text_trigger",height:e.height,triggerWidth:16,text:BI.i18nText("BI-Basic_Default")}),this.combo=BI.createWidget({type:"bi.combo",cls:e.simple?"bi-border-bottom":"bi-border",container:null,element:this,el:this.trigger,adjustLength:1,popup:{minWidth:70,el:{type:"bi.button_group",items:BI.createItems(t._formatArray(BI.isNotEmptyArray(e.fontList)?e.fontList:BI.Constants.getConstant("bi.constant.materials.rich_editor.font_family")),{type:"bi.single_select_item"}),layouts:[{type:"bi.vertical"}]}}}),this.combo.on(BI.Combo.EVENT_CHANGE,function(){var e=this.getValue()[0];t.activate(e),t.doCommand(e),this.hideView(),this.setValue([])})},_formatArray:function(e){return BI.map(e,function(e,t){return{text:t.text,value:BI.isString(t.value)?t.value.replaceAll('"',""):""}})},hideIf:function(e){0<!this.combo.element.find(e.target).length&&this.combo.hideView()},activate:function(n){var e=this.options,r=(n={"STHeiti, Hei, SimHei":"STHeiti, Hei, SimHei, 黑体","STSong, Song, SimSun":"STSong, Song, SimSun, 宋体",'STFangSong, "Fang Song", FangSong':'STFangSong, "Fang Song", FangSong, 仿宋',"STKaiti, Kai, KaiTi":"STKaiti, Kai, KaiTi, 楷体"}[n]||n,BI.i18nText("BI-Basic_Default"));BI.any(e.fontList||BI.Constants.getConstant("bi.constant.materials.rich_editor.font_family"),function(e,t){if(n.replaceAll('"',"")===t.value.replaceAll('"',""))return r=t.text,!0}),this.fontFamily=n,this.trigger.setText(r),this.combo.setValue(n.replaceAll('"',""))},deactivate:function(){this.trigger.setText(BI.i18nText("BI-Basic_Default")),this.combo.setValue()},getValue:function(){return this.fontFamily||BI.FontFamily.DEFAULT}}),BI.shortcut("bi.rich_editor_font_chooser",BI.RichEditorFontChooser),BI.FontFamily={DEFAULT:'Avenir, Segoe UI, PingFangSC-Regular, "Microsoft YaHei"',SIM_HEI:"STHeiti, Hei, SimHei, 黑体",SIM_SUN:"STSong, Song, SimSun, 宋体",FANG_SONG:'STFangSong, "Fang Song", FangSong, 仿宋',KAI_TI:"STKaiti, Kai, KaiTi, 楷体",YOU_SHE:"YouShe",PANG_MEM:"pangMen",ARIAL:"Arial",HELVETICA_NEUE:'"Helvetica Neue"',VERDANA:"Verdana",TIMES_NEW_ROMAN:'"Times New Roman"',DIGITAL_NUMBERS:'"Digital Numbers"',POPPINS_BOLD:'"Poppins Bold"'}},function(e,t,n){"use strict";BI.RichEditorSizeChooser=BI.inherit(BI.RichEditorAction,{_defaultConfig:function(){return BI.extend(BI.RichEditorSizeChooser.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-rich-editor-size-chooser bi-card",command:"FontSize",width:50,height:24,css:{fontSize:null},$testId:"bi-rich-editor-size-chooser",simple:!1})},_init:function(){BI.RichEditorSizeChooser.superclass._init.apply(this,arguments);var t=this,e=this.options;this.trigger=BI.createWidget({type:"bi.text_trigger",height:e.height,triggerWidth:16,text:BI.i18nText("BI-Font_Size"),disabled:e.disabled,warningTitle:e.warningTitle}),this.combo=BI.createWidget({type:"bi.combo",cls:e.simple?"bi-border-bottom":"bi-border",container:null,element:this,el:this.trigger,adjustLength:1,popup:{maxWidth:70,minWidth:70,el:{type:"bi.button_group",items:BI.createItems(BI.Constants.getConstant("bi.constant.materials.rich_editor.font_size"),{type:"bi.single_select_item"}),layouts:[{type:"bi.vertical"}]}}}),this.combo.on(BI.Combo.EVENT_CHANGE,function(){var e=this.getValue()[0];t.doAction(e),this.hideView(),this.setValue([])})},hideIf:function(e){0<!this.combo.element.find(e.target).length&&this.combo.hideView()},doAction:function(r){this.activate(r);var i=this.options.editor.instance,e=i.getSavedRng();e&&!e.collapsed?(this.doCommand(7),BI.each(document.getElementsByTagName("font"),function(e,t){BI.contains(BI.$(t).parents(),i.element[0])&&7==t.size&&(!function n(e){BI.$(e).css("font-size",""),BI.each(e.childNodes,function(e,t){n(t)})}(t),BI.$(t).removeAttr("size").css("font-size",r+"px"))})):i.restoreRng()},activate:function(e){e=(e=(e||12)+"").replace("px","");this.fontSize=e,this.trigger.setText(e),this.combo.setValue(BI.parseInt(e))},deactivate:function(){this.trigger.setText(BI.i18nText("BI-Font_Size")),this.combo.setValue()},getValue:function(){return this.fontSize||12}}),BI.shortcut("bi.rich_editor_size_chooser",BI.RichEditorSizeChooser)},function(e,t,n){"use strict";BI.constant("bi.constant.materials.rich_editor.font_family",[{value:BI.FontFamily.DEFAULT,text:BI.i18nText("BI-Basic_Default")},{value:BI.FontFamily.SIM_HEI,text:BI.i18nText("BI-Basic_Sim_Hei")},{value:BI.FontFamily.SIM_SUN,text:BI.i18nText("BI-Basic_Sim_Sun")},{value:BI.FontFamily.FANG_SONG,text:BI.i18nText("BI-Basic_Fang_Song")},{value:BI.FontFamily.KAI_TI,text:BI.i18nText("BI-Basic_Kai_Ti")},{value:BI.FontFamily.ARIAL,text:"Arial"},{value:BI.FontFamily.HELVETICA_NEUE,text:"Helvetica Neue"},{value:BI.FontFamily.VERDANA,text:"Verdana"},{value:BI.FontFamily.TIMES_NEW_ROMAN,text:"Times New Roman"}]),BI.constant("bi.constant.materials.rich_editor.font_size",[{value:12,text:12},{value:13,text:13},{value:14,text:14},{value:16,text:16},{value:18,text:18},{value:20,text:20},{value:22,text:22},{value:24,text:24},{value:26,text:26},{value:28,text:28},{value:30,text:30},{value:32,text:32},{value:34,text:34},{value:36,text:36},{value:38,text:38},{value:40,text:40},{value:64,text:64},{value:128,text:128}]),BI.constant("bi.constant.materials.rich_editor.font_size_range",{MAX:128,MIN:12})},function(e,t,n){"use strict";BI.RichEditor=BI.inherit(BI.Widget,{props:{baseCls:"bi-rich-editor bi-textarea"+(BI.isIE()?" hack":""),toolbar:{},readOnly:!1,scrollable:!0},_defaultConfig:function(){return BI.extend(BI.RichEditor.superclass._defaultConfig.apply(this,arguments),{adjustLength:1,adjustXOffset:0,adjustYOffset:0})},render:function(){var t=this,n=this.options,e={type:"bi.nic_editor",width:n.width,height:n.height,readOnly:n.readOnly,scrollable:n.scrollable,ref:function(){t.editor=this},listeners:[{eventName:BI.NicEditor.EVENT_BLUR,action:function(){!n.readOnly&&t.combo.isViewVisible()&&t.combo.hideView(),t.fireEvent(BI.RichEditor.EVENT_CONFIRM)}},{eventName:BI.NicEditor.EVENT_FOCUS,action:function(){n.readOnly||t.combo.isViewVisible()||t.combo.showView(),t.fireEvent(BI.RichEditor.EVENT_FOCUS)}}]};return n.readOnly?e:(this.editor=BI.createWidget(e),{type:"bi.combo",container:n.container,toggle:!1,trigger:"click",direction:"top,right",isNeedAdjustWidth:!1,isNeedAdjustHeight:!1,adjustLength:n.adjustLength,adjustXOffset:n.adjustXOffset,adjustYOffset:n.adjustYOffset,ref:function(){t.combo=this},el:this.editor,popup:{el:BI.extend({type:"bi.rich_editor_text_toolbar",editor:this.editor},n.toolbar,{ref:function(e){t.editor.bindToolbar(e),n.toolbar.ref&&n.toolbar.ref(e)}}),height:34,stopPropagation:!1,stopEvent:!1},listeners:[{eventName:BI.Combo.EVENT_AFTER_HIDEVIEW,action:function(){t.fireEvent(BI.RichEditor.EVENT_AFTER_HIDEVIEW)}}]})},mounted:function(){var e=this.options;BI.isNotNull(e.value)&&this.editor.setValue(e.value)},focus:function(){this.editor.focus()},setValue:function(e){this.editor.setValue(e)},getValue:function(e){return this.editor.getValue(e)},setVisible:function(e){e||this.combo.hideView(),BI.RichEditor.superclass.setVisible.apply(this,arguments)},getContentHeight:function(){return this.editor.getContentHeight()},getEditor:function(){return this.editor}}),BI.RichEditor.EVENT_AFTER_HIDEVIEW="EVENT_AFTER_HIDEVIEW",BI.RichEditor.EVENT_CONFIRM="EVENT_CONFIRM",BI.RichEditor.EVENT_FOCUS="EVENT_FOCUS",BI.shortcut("bi.rich_editor",BI.RichEditor)},function(e,t,n){"use strict";function d(e){return"[object Array]"==Object.prototype.toString.call(e)}function p(e){return"string"==typeof e?e:e.text}function f(e,t){return(t=d(t)?{columns:t}:t).text||(t.text=e),t}function v(e){return I[e.toUpperCase()]}function m(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}function s(e,t){var n;if(BI.isNotEmptyString(e))return n=e.length,t=p(t).substr(0,n),e.toUpperCase()===t.toUpperCase()}function g(e,t,n,r){if(d(n))for(var i=0;i<n.length;i++)s(t,n[i])&&e.push(r(n[i],i));else for(var o in n){var a;!n.hasOwnProperty(o)||s(t,a=(a=n[o])&&!0!==a?a.displayText?{text:a.text,displayText:a.displayText}:a.text:o)&&e.push(r(a,-1))}}function b(e){for(var t=p(e).split("."),n=0;n<t.length;n++)t[n]=E+t[n].replace(new RegExp(E,"g"),E+E)+E;var r=t.join(".");return"string"==typeof e?r:((e=m(e)).text=r,e)}function y(e,t){for(var n=t.doc,r=n.getValue(),i=e.toUpperCase(),o="",a="",s=[],l={start:T(0,0),end:T(t.lastLine(),t.getLineHandle(t.lastLine()).length)},c=r.indexOf(S.QUERY_DIV);-1!=c;)s.push(n.posFromIndex(c)),c=r.indexOf(S.QUERY_DIV,c+1);s.unshift(T(0,0)),s.push(T(t.lastLine(),t.getLineHandle(t.lastLine()).text.length));for(var u=null,h=t.getCursor(),d=0;d<s.length;d++){if((null==u||0<C(h,u))&&C(h,s[d])<=0){l={start:u,end:s[d]};break}u=s[d]}for(var p=n.getRange(l.start,l.end,!1),d=0;d<p.length;d++){for(var f=p[d],m=(y=b=g=m=void 0,f),g=function(e){var t=e.toUpperCase();t===i&&v(o)&&(a=o),t!==S.ALIAS_KEYWORD&&(o=e)},b=m.split(/\s+/),y=0;y<b.length;y++)b[y]&&g(b[y].replace(/[,;]/g,""));if(a)break}return a}var _,I,x,E,S,T,C;_=BI.CodeMirror,S={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},T=_.Pos,C=_.cmpPos,_.registerHelper("hint","sql",function(e,t){I=function(e){var t={};if(d(e))for(var n=e.length-1;0<=n;n--){var r=e[n];t[p(r).toUpperCase()]=f(p(r),r)}else if(e)for(var i in e)t[i.toUpperCase()]=f(i,e[i]);return t}(t&&t.tables);var i,n,r,o,a=t&&t.defaultTable,s=t&&t.disableKeywords,l=(x=a&&v(a),i=function(e){e=e.doc.modeOption;"sql"===e&&(e="text/x-sql");return _.resolveMode(e).keywords}(e),BI.size(i)),c=[],u=e.getCursor(),h=e.getTokenAt(u),t=(t.supportFunction&&(BI.each(BI.FormulaCollections,function(e,t){0!=t.lastIndexOf(h.string,0)||BI.contains(c,t)||c.push(t)}),i=BI.keys(i),BI.each(c,function(e,t){var n=t.toLowerCase(),r=t.toUpperCase();BI.contains(i,n)||BI.contains(i,r)||i.push(t)})),E=function(e){e=e.doc.modeOption;"sql"===e&&(e="text/x-sql");return _.resolveMode(e).identifierQuote||"`"}(e),(x=(x=a&&!x?y(a,e):x)||[]).columns&&(x=x.columns),[]);return h.end>u.ch&&(h.end=u.ch,h.string=h.string.slice(0,u.ch-h.start)),h.string.match(/^[.`"\w@]\w*$/)?(o=h.string,n=h.start,r=h.end):(n=r=u.ch,o=""),"."==o.charAt(0)||o.charAt(0)==E?n=function(e,t,n,r){var i=!1,o=[],a=t.start,s=!0;for(;s;)s="."==t.string.charAt(0),i=i||t.string.charAt(0)==E,a=t.start,o.unshift(function(e){"."==e.charAt(0)&&(e=e.substr(1));for(var t=e.split(E+E),n=0;n<t.length;n++)t[n]=t[n].replace(new RegExp(E,"g"),"");return t.join(E)}(t.string)),"."==(t=r.getTokenAt(T(e.line,t.start))).string&&(s=!0,t=r.getTokenAt(T(e.line,t.start)));var l=o.join("."),c=(g(n,l,I,function(e){return i?b(e):e}),g(n,l,x,function(e){return i?b(e):e}),l=o.pop(),o.join(".")),u=!1,h=c;v(c)||(c=y(d=c,r))!==d&&(u=!0);var d=v(c);d&&d.columns&&(d=d.columns);d&&g(n,l,d,function(e){var t=1==u?h:c;return"string"==typeof e?e=t+"."+e:(e=m(e)).text=t+"."+e.text,i?b(e):e});return a}(u,h,t,e):(g(t,o,I,function(e){return e}),g(t,o,x,function(e){return e}),s||g(t,o,i,function(e,t){return{type:t<l?BICst.FORMULA_KEYWORD_TYPE.KEYWORD:BICst.FORMULA_KEYWORD_TYPE.FUNCTION,text:e}})),{list:t,from:T(u.line,n),to:T(u.line,r)}})},function(e,t,n){"use strict";!function(I){"use strict";I.defineMode("sql",function(i,e){"use strict";var o=e.client||{},a=e.atoms||{"false":true,"true":true,"null":true},s=e.builtin||{},l=e.keywords||{},c=e.operatorChars||/^[*+\-%<>!=&|~^]/,u=e.support||{},h=e.hooks||{},d=e.dateSQL||{date:true,time:true,timestamp:true},p=e.functions||{};function f(e,t){var n=e.next();if(h[n]){var r=h[n](e,t);if(r!==false)return r}if(u.hexNumber&&(n=="0"&&e.match(/^[xX][0-9a-fA-F]+/)||(n=="x"||n=="X")&&e.match(/^'[0-9a-fA-F]+'/)))return"number";else if(u.binaryNumber&&((n=="b"||n=="B")&&e.match(/^'[01]+'/)||n=="0"&&e.match(/^b[01]+/)))return"number";else if(n.charCodeAt(0)>47&&n.charCodeAt(0)<58){e.match(/^[0-9]*(\.[0-9]+)?([eE][-+]?[0-9]+)?/);u.decimallessFloat&&e.match(/^\.(?!\.)/);return"number"}else if(n=="?"&&(e.eatSpace()||e.eol()||e.eat(";")))return"variable-3";else if(n=="'"||n=='"'&&u.doubleQuote){t.tokenize=m(n);return t.tokenize(e,t)}else if((u.nCharCast&&(n=="n"||n=="N")||u.charsetCast&&n=="_"&&e.match(/[a-z][a-z0-9]*/i))&&(e.peek()=="'"||e.peek()=='"'))return"keyword";else if(/^[\(\),\;\[\]]/.test(n))return null;else if(u.commentSlashSlash&&n=="/"&&e.eat("/")){e.skipToEnd();return"comment"}else if(u.commentHash&&n=="#"||n=="-"&&e.eat("-")&&(!u.commentSpaceRequired||e.eat(" "))){e.skipToEnd();return"comment"}else if(n=="/"&&e.eat("*")){t.tokenize=g(1);return t.tokenize(e,t)}else if(n=="."){if(u.zerolessFloat&&e.match(/^(?:\d+(?:e[+-]?\d+)?)/i))return"number";if(e.match(/^\.+/))return null;if(u.ODBCdotTable&&e.match(/^[\w\d_]+/))return"variable-2"}else if(c.test(n)){e.eatWhile(c);return null}else if(n=="{"&&(e.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/)||e.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/)))return"number";else{e.eatWhile(/^[_\w\d]/);var i=e.current().toLowerCase();if(d.hasOwnProperty(i)&&(e.match(/^( )+'[^']*'/)||e.match(/^( )+"[^"]*"/)))return"number";if(a.hasOwnProperty(i))return"atom";if(s.hasOwnProperty(i))return"builtin";if(p.hasOwnProperty(i)&&e.peek()==="(")return"function";if(l.hasOwnProperty(i))return"keyword";if(o.hasOwnProperty(i))return"string-2";return null}}function m(i){return function(e,t){var n=false,r;while((r=e.next())!=null){if(r==i&&!n){t.tokenize=f;break}n=!n&&r=="\\"}return"string"}}function g(r){return function(e,t){var n=e.match(/^.*?(\/\*|\*\/)/);if(!n)e.skipToEnd();else if(n[1]=="/*")t.tokenize=g(r+1);else if(r>1)t.tokenize=g(r-1);else t.tokenize=f;return"comment"}}function b(e,t,n){t.context={prev:t.context,indent:e.indentation(),col:e.column(),type:n}}function y(e){e.indent=e.context.indent;e.context=e.context.prev}return{startState:function t(){return{tokenize:f,context:null}},token:function v(e,t){if(e.sol())if(t.context&&t.context.align==null)t.context.align=false;if(t.tokenize==f&&e.eatSpace())return null;var n=t.tokenize(e,t);if(n=="comment")return n;if(t.context&&t.context.align==null)t.context.align=true;var r=e.current();if(r=="(")b(e,t,")");else if(r=="[")b(e,t,"]");else if(t.context&&t.context.type==r)y(t);return n},indent:function _(e,t){var n=e.context;if(!n)return I.Pass;var r=t.charAt(0)==n.type;if(n.align)return n.col+(r?0:1);return n.indent+(r?0:i.indentUnit)},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:u.commentSlashSlash?"//":u.commentHash?"#":"--"}}),function(){"use strict";function e(e){var t;while((t=e.next())!=null)if(t=="`"&&!e.eat("`"))return"variable-2";e.backUp(e.current().length-1);return e.eatWhile(/\w/)?"variable-2":null}function t(e){var t;while((t=e.next())!=null)if(t=='"'&&!e.eat('"'))return"variable-2";e.backUp(e.current().length-1);return e.eatWhile(/\w/)?"variable-2":null}function n(e){if(e.eat("@")){e.match(/^session\./);e.match(/^local\./);e.match(/^global\./)}if(e.eat("'")){e.match(/^.*'/);return"variable-2"}else if(e.eat('"')){e.match(/^.*"/);return"variable-2"}else if(e.eat("`")){e.match(/^.*`/);return"variable-2"}else if(e.match(/^[0-9a-zA-Z$\.\_]+/))return"variable-2";return null}function r(e){if(e.eat("N"))return"atom";return e.match(/^[a-zA-Z.#!?]/)?"variable-2":null}var i="alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit ";function o(e){var t={},n=e.split(" ");for(var r=0;r<n.length;++r)t[n[r]]=true;return t}I.defineMIME("text/x-sql",{name:"sql",keywords:o(i+"begin"),builtin:o("bool boolean bit blob enum long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision real date datetime year unsigned signed decimal numeric"),atoms:o("false true null unknown"),operatorChars:/^[*+\-%<>!=]/,dateSQL:o("date time timestamp"),support:o("ODBCdotTable doubleQuote binaryNumber hexNumber"),functions:BI.makeObject(BI.FormulaCollections,true)})}()}(BI.CodeMirror)},function(e,t,n){"use strict";BI.SQLEditor=BI.inherit(BI.Widget,{props:function(){return{baseCls:"bi-sql-editor",value:"",lineHeight:2,showHint:!0,supportFunction:!1,supportParam:!1,paramFormatter:function(e){return e},watermark:BI.i18nText("BI-Please_Enter_SQL"),lineWrapping:!0,lineNumbers:!1}},render:function(){var n=this.options,r=this,e={mode:"text/x-sql",lineWrapping:n.lineWrapping,lineNumbers:n.lineNumbers,readOnly:n.readOnly};n.readOnly&&(e.cursorBlinkRate=-1),this.editor=BI.CodeMirror(this.element[0],e),1===n.lineHeight?this.element.addClass("codemirror-low-line-height"):this.element.addClass("codemirror-high-line-height"),this.editor.on("change",function(e,t){r._checkWaterMark(),n.showHint&&r.editor.hasFocus()&&BI.CodeMirror.showHint(e,BI.CodeMirror.sqlHint,{completeSingle:!1,supportFunction:n.supportFunction}),BI.nextTick(function(){r.fireEvent(BI.FormulaEditor.EVENT_CHANGE)})}),this.editor.on("focus",function(){r._checkWaterMark(),r.fireEvent(BI.FormulaEditor.EVENT_FOCUS)}),this.editor.on("blur",function(){r.fireEvent(BI.FormulaEditor.EVENT_BLUR)}),this.watermark=BI.createWidget({type:"bi.label",text:n.watermark,cls:"bi-water-mark",whiteSpace:"normal",textAlign:"left"}),this.watermark.element.bind("mousedown",function(e){r._insertString(""),r.editor.focus(),e.stopEvent()}),this.watermark.element.bind("click",function(e){r.editor.focus(),e.stopEvent()}),BI.createWidget({type:"bi.absolute",element:this,items:[{el:this.watermark,top:3,left:6,right:6}]}),BI.isKey(n.value)&&BI.nextTick(function(){r.setValue(n.value)})},_setEnable:function(e){BI.SQLEditor.superclass._setEnable.apply(this,arguments),this.editor.setOption("readOnly",!0!==e&&"nocursor")},_insertString:function(e){this.editor.replaceSelection(e)},_insertParam:function(e){var t=e,n=(e=this.options.paramFormatter(e),this.editor.getCursor()),r=(this.editor.replaceSelection("​"+e+"​"),this.editor.getCursor()),i="param",i={className:i=BI.isNotNull(e.match(/^<!.*!>$/))?"error-param":i,atomic:!0,replacedWith:BI.$("<span class='"+i+" start end' />").text(e)[0]};i.value=t,this.editor.markText(n,r,i)},_checkWaterMark:function(){var e=this.options;!this.disabledWaterMark&&BI.isEmptyString(this.editor.getValue())&&BI.isKey(e.watermark)?this.watermark&&this.watermark.visible():this.watermark&&this.watermark.invisible()},insertString:function(e){this._insertString(e),this.editor.focus()},insertParam:function(e){this._insertParam(e),this.editor.focus()},_analyzeContent:function(e){return e.match(/\n|\$[\{][^\}]*[\}]|((?!\$\{).)*((?!\$\{).)|\$[^\{]*[^\$\{]/g)},getValue:function(){return this.editor.getValue("\n",function(e){var r=e.text,i=0;return _.forEach(_.sortBy(e.markedSpans,"from"),function(e,t){switch(e.marker.className){case"param":case"error-param":var n=e.to-e.from;r=r.substr(0,e.from+i)+"${"+e.marker.value+"}"+r.substr(e.to+i,r.length),i=(i+=3)+(e.marker.value.length-n)}}),r})},setValue:function(e){var r=this,t=this.options;this.refresh(),r.editor.setValue(""),t.supportParam?(t=this._analyzeContent(e||""),BI.each(t,function(e,t){var n=t.match(/\$[\{][^\}]*[\}]/);BI.isNotEmptyArray(n)?r._insertParam(n[0].substring(2,t.length-1)):r._insertString(t)})):this._insertString(e),this._checkWaterMark()},refresh:function(){var e=this;BI.nextTick(function(){e.editor.refresh()})},setVisible:function(e){BI.SQLEditor.superclass.setVisible.apply(this,arguments),e&&this.refresh()}}),BI.shortcut("bi.sql_editor",BI.SQLEditor)},function(e,t,n){"use strict";BI.FormulaFieldPane=BI.inherit(BI.Widget,{props:{baseCls:"bi-formula-field-pane bi-card",items:[],itemsCreator:undefined,searcherHeight:28,searcherGap:8,itemHeight:24,leafItemHeight:24,fieldTreeHgap:0,nodeGap:0},_store:function(){return BI.Models.getModel("bi.model.material.formula_field_pane")},watch:{fieldKeyword:function(){this._search()}},render:function(){var t=this,e=this.options;return{type:"bi.vtape",vgap:e.searcherGap,hgap:e.searcherGap,items:[{el:{type:"bi.vertical",items:[{type:"bi.search_editor",ref:function(e){t.search=e},height:e.searcherHeight,listeners:[{eventName:BI.SearchEditor.EVENT_CHANGE,action:BI.debounce(BI.bind(function(){t.store.setKeyword(t.search.getValue())}),BI.EVENT_RESPONSE_TIME)},{eventName:BI.SearchEditor.EVENT_CLEAR,action:BI.debounce(BI.bind(function(){t.store.setKeyword(t.search.getValue())}),BI.EVENT_RESPONSE_TIME)}]}]},height:e.searcherHeight},{el:{type:"bi.vertical",items:[{type:"bi.formula_fields_tree",items:e.items,itemsCreator:e.itemsCreator,itemHeight:e.itemHeight,leafItemHeight:e.leafItemHeight,nodeGap:e.nodeGap,redmark:function(){return!0},ref:function(e){t.fieldTree=e},listeners:[{eventName:BI.FormulaFieldsTree.EVENT_CHANGE,action:function(){t.fireEvent(BI.FormulaFieldPane.EVENT_CHANGE,this.getValue())}}]}]},hgap:e.fieldTreeHgap}]}},_search:function(){var n=this,e=this.options,e=BI.map(e.items,function(e,t){t=BI.Func.getSearchResult(t,n.model.fieldKeyword,"text");return t.match.concat(t.find)});this.fieldTree.populate(e,this.model.fieldKeyword)},getAllLeaves:function(){return this.fieldTree.getAllLeaves()},populate:function(e,t){this.options.items=e,this.fieldTree.populate(e,t)}}),BI.FormulaFieldPane.EVENT_SEARCH="EVENT_SEARCH",BI.FormulaFieldPane.EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.formula_field_pane",BI.FormulaFieldPane)},function(e,t,n){"use strict";var r;r=BI.inherit(Fix.Model,{context:["fieldKeyword"],state:function(){return{}},computed:{},actions:{setKeyword:function(e){this.model.fieldKeyword=e}}}),BI.model("bi.model.material.formula_field_pane",r)},function(e,t,n){"use strict";var r=BI.inherit(BI.BasicButton,{props:function(){return{extraCls:"bi-list-item",id:"",pId:"",height:24,hgap:0,lgap:0,rgap:0}},render:function(){var t=this,e=this.options;return{type:"bi.label",ref:function(e){t.text=e},textAlign:"left",whiteSpace:"nowrap",textHeight:e.height,height:e.height,hgap:e.hgap,lgap:e.lgap,rgap:e.hgap,text:e.text,value:e.value,py:e.py,keyword:e.keyword}},doRedMark:function(){this.text.doRedMark.apply(this.text,arguments)},unRedMark:function(){this.text.unRedMark.apply(this.text,arguments)},doHighLight:function(){this.text.doHighLight.apply(this.text,arguments)},unHighLight:function(){this.text.unHighLight.apply(this.text,arguments)},getId:function(){return this.options.id},getPId:function(){return this.options.pId}});BI.shortcut("bi.formula_fields_tree.item",r)},function(e,t,n){"use strict";BI.FormulaFieldsTree=BI.inherit(BI.Widget,{_const:{leafGap:40},props:{baseCls:"bi-formula-field-tree",chooseType:0,items:[],itemsCreator:undefined,redmark:BI.emptyFn,itemHeight:24,leafItemHeight:24,nodeGap:0},render:function(){var e=this.options,t=(this._const,this),n=this._formatItems(BI.deepClone(e.items));return{type:"bi.level_tree",element:this,chooseType:e.chooseType,expander:{isDefaultInit:!0,showLine:!1},items:n,el:{behaviors:{redmark:e.redmark}},ref:function(e){t.fieldtree=e},listeners:[{eventName:BI.LevelTree.EVENT_CHANGE,action:function(){t.fireEvent(BI.FormulaFieldsTree.EVENT_CHANGE),t.fieldtree.setValue()}}]}},_getFieldNum:function(e,t){return BI.isNotNull(e[t])?e[t].length:0},_formatItems:function(e,t){var n,r,i=this.options,o=this._const;return i.itemsCreator?i.itemsCreator(e,t):(n={},BI.each(e,function(e,t){BI.each(BI.Func.getSortedResult(t,"text"),function(e,t){t.fieldType===BICst.COLUMN.CALCULATE&&(t.fieldType=BICst.COLUMN.NUMBER),n[t.fieldType]||(n[t.fieldType]=[]),n[t.fieldType].push(t)})}),r=[{id:BICst.COLUMN.NUMBER,type:"bi.arrow_group_node",$testId:"bi-formula-field-tree-number-node",text:BI.i18nText("BI-Conf_Formula_Numberic_Field")+"("+this._getFieldNum(n,BICst.COLUMN.NUMBER)+")",value:BICst.COLUMN.NUMBER,isParent:!0,open:!0}],1<e.length&&r.push({id:BICst.COLUMN.STRING,type:"bi.arrow_group_node",$testId:"bi-formula-field-tree-string-node",text:BI.i18nText("BI-Conf_Formula_Text_Field")+"("+this._getFieldNum(n,BICst.COLUMN.STRING)+")",value:BICst.COLUMN.STRING,isParent:!0,open:!!t&&0<this._getFieldNum(n,BICst.COLUMN.STRING)||!1}),2<e.length&&r.push({id:BICst.COLUMN.DATE,type:"bi.arrow_group_node",$testId:"bi-formula-field-tree-date-node",text:BI.i18nText("BI-Conf_Formula_Time_Field")+"("+this._getFieldNum(n,BICst.COLUMN.DATE)+")",value:BICst.COLUMN.DATE,isParent:!0,open:!!t&&0<this._getFieldNum(n,BICst.COLUMN.DATE)||!1}),3<e.length&&r.push({id:BICst.FORMULA_WIDGET_FIELD_TYPE.DATE,$testId:"bi-formula-field-tree-date-widget-node",type:"bi.arrow_group_node",text:BI.i18nText("BI-Design_Date_Widget_Field")+"("+e[3].length+")",value:BICst.FORMULA_WIDGET_FIELD_TYPE.DATE,isParent:!0,open:!!t&&0<e[3].length||!1}),4<e.length&&r.push({id:BICst.FORMULA_WIDGET_FIELD_TYPE.STRING,$testId:"bi-formula-field-tree-string-widget-node",type:"bi.arrow_group_node",text:BI.i18nText("BI-Design_String_Widget_Field")+"("+e[4].length+")",value:BICst.FORMULA_WIDGET_FIELD_TYPE.STRING,isParent:!0,open:!!t&&0<e[4].length||!1}),5<e.length&&r.push({id:BICst.FORMULA_WIDGET_FIELD_TYPE.NUMBER,$testId:"bi-formula-field-tree-number-widget-node",type:"bi.arrow_group_node",text:BI.i18nText("BI-Design_Number_Widget_Field")+"("+e[5].length+")",value:BICst.FORMULA_WIDGET_FIELD_TYPE.NUMBER,isParent:!0,open:!!t&&0<e[5].length||!1}),BI.each(r,function(e,t){BI.extend(t,{height:i.itemHeight,hgap:i.nodeGap,iconWrapperWidth:24,expandIcon:"tree-expander-expand-font",collapseIcon:"tree-expander-collapse-font"})}),BI.each(e,function(e,t){BI.each(t,function(e,t){r.push(BI.extend({id:BI.UUID(),pId:t.fieldType},t,{type:"bi.formula_fields_tree.item",$testId:"bi-formula-field-tree-field-item-"+t.text,cls:"field-item-draggable",textAlign:"left",lgap:o.leafGap,height:i.leafItemHeight}))})}),r)},populate:function(e,t){e=this._formatItems(BI.deepClone(e),BI.isNotNull(t)&&BI.isNotEmptyString(t));this.fieldtree.populate(e,t)},getValue:function(){return this.fieldtree.getValue()},setValue:function(e){this.fieldtree.setValue(e)},doBehavior:function(){this.fieldtree.doBehavior.apply(this.fieldtree,arguments)},getNodeByValue:function(e){return this.fieldtree.getNodeByValue(e)},setTriggerExpand:function(e){e=this.fieldtree.getNodeById(e);BI.isNotNull(e)&&e.showView()},setTriggerCollapse:function(e){this.fieldtree.getNodeById(e).hideView()},expandAll:function(){var n=this;BI.each([BICst.COLUMN.NUMBER,BICst.COLUMN.STRING,BICst.COLUMN.DATE],function(e,t){n.setTriggerExpand(t)})},getAllLeaves:function(){return this.fieldtree.getAllLeaves()}}),BI.FormulaFieldsTree.EVENT_CHANGE="EVENT_CHANGE",BI.shortcut("bi.formula_fields_tree",BI.FormulaFieldsTree)},function(e,t,n){"use strict";var r=BI.inherit(BI.Widget,{props:{baseCls:"bi-formula-function-describe",open:!1,expandable:!0,defaultHyperLink:null},render:function(){var t=this,e=this.options;return{type:"bi.vertical_fill",rowSize:[36,e.expandable?164:"fill"],cls:"bi-split-top formula-describe-pane",items:[{el:{type:"bi.basic_button",ref:function(e){t.expanderTrigger=e},selected:!0,invisible:!0,render:function(){return{type:"bi.left_right_vertical_adapt",height:36,items:{left:[{type:"bi.label",text:BI.i18nText("BI-Conf_Function_Description"),cls:"more-function-button"}],right:[{type:"bi.icon_change_button",iconCls:"column-next-page-h-font",width:25,invisible:!e.expandable,ref:function(e){t.describeButton=e}}]},lhgap:10,rhgap:10}},handler:function(){e.expandable&&(this.isSelected()?(t.describeButton.setIcon("column-next-page-h-font"),t.describeGroup.setVisible(!0)):(t.describeButton.setIcon("column-pre-page-h-font"),t.describeGroup.setVisible(!1)))}}},{type:"bi.button_group",layouts:[{type:"bi.vertical",hgap:20,vgap:5}],ref:function(e){t.describeGroup=e},items:[{type:"bi.vertical",vgap:10,items:[{type:"bi.text",whiteSpace:"normal",textAlign:"left",text:BI.i18nText("BI-Formula_Function_Tip1")},{type:"bi.html_label",cls:"cm-s-default",whiteSpace:"normal",textAlign:"left",text:BI.i18nText("BI-Formula_Function_Tip2")},e.defaultHyperLink?{type:"bi.a",cls:"hyperlink-button",whiteSpace:"normal",textAlign:"left",text:BI.i18nText("BI-Formula_Help_Document"),href:e.defaultHyperLink}:null]}]}]}},populate:function(e){this.expanderTrigger.setVisible(!0),this.describeGroup.populate([BI.isFunction(e.description)?e.description():{type:"bi.vertical",bgap:5,items:[{type:"bi.label",cls:"cm-strong",textAlign:"left",text:e.text+":"},{type:"bi.label",whiteSpace:"normal",textAlign:"left",text:e.description},e.hyperlink?{type:"bi.a",text:BI.i18nText("BI-Formula_Function_More_Example"),href:e.hyperlink}:null]}])}});BI.shortcut("bi.formula_function_describe",r)},function(e,t,n){"use strict";var r=BI.inherit(BI.BasicButton,{_defaultConfig:function(){return BI.extend(BI.TreeTextLeafItem.superclass._defaultConfig.apply(this,arguments),{extraCls:"bi-list-item-active2",id:"",pId:"",height:24,hgap:0,lgap:0,rgap:0,description:""})},mounted:function(){var e=this;this.element.hover(function(){e.fireEvent("EVENT_HOVER",e.getValue())})},render:function(){var t=this,e=this.options;return{type:"bi.label",ref:function(e){t.text=e},cls:"draggable-handle",textAlign:"left",whiteSpace:"nowrap",height:e.height,hgap:e.hgap,lgap:e.lgap,rgap:e.hgap,text:e.text,value:e.value,py:e.py,keyword:e.keyword}},doRedMark:function(){this.text.doRedMark.apply(this.text,arguments)},unRedMark:function(){this.text.unRedMark.apply(this.text,arguments)},doHighLight:function(){this.text.doHighLight.apply(this.text,arguments)},unHighLight:function(){this.text.unHighLight.apply(this.text,arguments)},getId:function(){return this.options.id},getPId:function(){return this.options.pId}});BI.shortcut("bi.formula_functions_tree.item",r)},function(e,t,n){"use strict";BI.FormulaFunctionsTree=BI.inherit(BI.Widget,{_const:{leafGap:40},props:{baseCls:"bi-formula-function-tree bi-card",chooseType:0,items:[],redmark:BI.emptyFn,itemHeight:24,leafItemHeight:24,nodeGap:0},_store:function(){return BI.Models.getModel("bi.model.material.formula_functions_tree")},render:function(){var e=this,t=this.options;return{type:"bi.level_tree",expander:{isDefaultInit:!0,showLine:!1},items:this._getFormatNodes(t.items),el:{behaviors:{redmark:t.redmark}},ref:function(){e.fieldtree=this},listeners:[{eventName:BI.LevelTree.EVENT_CHANGE,action:function(){e.fireEvent(BI.FormulaFunctionsTree.EVENT_CHANGE,e._getSelectItem(e.getValue(),t.items)),e.fieldtree.setValue(e.getValue())}}]}},_getFieldNum:function(e,t){return BI.isNotNull(e[t])?e[t].length:0},_getFormatNodes:function(e,t){var n=this.options,r=this._const,i=this,o={},t=(BI.each(e,function(e,t){o[t.fieldType]||(o[t.fieldType]=[]),o[t.fieldType].push(t)}),BI.isNotNull(t)&&BI.isNotEmptyString(t)),t=[{id:BICst.FUNCTION.MATH,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-math-node",text:BI.i18nText("BI-Conf_Formula_Numberic_Function")+"("+i._getFieldNum(o,BICst.FUNCTION.MATH)+")",value:BICst.FUNCTION.MATH,isParent:!0,open:t},{id:BICst.FUNCTION.TEXT,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-text-node",text:BI.i18nText("BI-Conf_Formula_Text_Function")+"("+i._getFieldNum(o,BICst.FUNCTION.TEXT)+")",value:BICst.FUNCTION.TEXT,isParent:!0,open:t},{id:BICst.FUNCTION.DATE,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-date-node",text:BI.i18nText("BI-Conf_Formula_Time_Function")+"("+i._getFieldNum(o,BICst.FUNCTION.DATE)+")",value:BICst.FUNCTION.DATE,isParent:!0,open:t},{id:BICst.FUNCTION.ARRAY,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-array-node",text:BI.i18nText("BI-Conf_Formula_Array_Function")+"("+i._getFieldNum(o,BICst.FUNCTION.ARRAY)+")",value:BICst.FUNCTION.ARRAY,isParent:!0,open:t},{id:BICst.FUNCTION.LOGIC,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-logic-node",text:BI.i18nText("BI-Conf_Formula_Logic_Function")+"("+i._getFieldNum(o,BICst.FUNCTION.LOGIC)+")",value:BICst.FUNCTION.LOGIC,isParent:!0,open:t},{id:BICst.FUNCTION.ANALYSIS,type:"bi.arrow_group_node",text:BI.i18nText("BI-Conf_Formula_Analysis")+"("+i._getFieldNum(o,BICst.FUNCTION.ANALYSIS)+")",value:BICst.FUNCTION.ANALYSIS,isParent:!0,open:t},{id:BICst.FUNCTION.OTHER,$testId:"bi-formula-function-tree-other-node",type:"bi.arrow_group_node",text:BI.i18nText("BI-Conf_Formula_Other_Function")+"("+i._getFieldNum(o,BICst.FUNCTION.OTHER)+")",value:BICst.FUNCTION.OTHER,isParent:!0,open:t},{id:BICst.FUNCTION.AGG,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-agg-node",text:BI.i18nText("BI-Design_Function_AGG")+"("+i._getFieldNum(o,BICst.FUNCTION.AGG)+")",value:BICst.FUNCTION.AGG,isParent:!0,open:t},{id:BICst.FUNCTION.TABLE_CAL,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-table-cal-node",text:BI.i18nText("BI-Design_Rapid_Function")+"("+i._getFieldNum(o,BICst.FUNCTION.TABLE_CAL)+")",value:BICst.FUNCTION.TABLE_CAL,isParent:!0,open:t},{id:BICst.FUNCTION.COMMON,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-common-node",text:BI.i18nText("BI-Basic_Common_Function")+"("+i._getFieldNum(o,BICst.FUNCTION.COMMON)+")",value:BICst.FUNCTION.COMMON,isParent:!0,open:t},{id:BICst.FUNCTION.FIXED_CAL,type:"bi.arrow_group_node",$testId:"bi-formula-function-tree-fixed-cal-node",text:BI.i18nText("BI-Design_Fixed_Function")+"("+i._getFieldNum(o,BICst.FUNCTION.FIXED_CAL)+")",value:BICst.FUNCTION.FIXED_CAL,isParent:!0,open:t}],a=BI.filter(t,function(e,t){return BI.extend(t,{height:n.itemHeight,hgap:n.nodeGap,iconWrapperWidth:24,expandIcon:"tree-expander-expand-font",collapseIcon:"tree-expander-collapse-font"}),BI.contains(i.model.availableFunctionValues,t.value)});return a.sort(function(e,t){return BI.indexOf(i.model.availableFunctionValues,e.value)-BI.indexOf(i.model.availableFunctionValues,t.value)}),BI.first(a).open=!0,BI.each(e,function(e,t){a.push(BI.extend({id:BI.UUID(),pId:t.fieldType},t,{type:"bi.formula_functions_tree.item",$testId:"bi-formula-function-tree-item-"+BI.toLowerCase(t.text),cls:"function-item-draggable",textAlign:"left",lgap:r.leafGap,height:n.leafItemHeight,listeners:[{eventName:"EVENT_HOVER",action:function(){i.fieldtree.setValue(t.value),i.fireEvent(BI.FormulaFunctionsTree.EVENT_HOVER,i._getSelectItem([t.value],n.items))}}]}))}),a},populate:function(e,t){this.options.items=e,this.fieldtree.populate(this._getFormatNodes(e,t),t)},getValue:function(){return this.fieldtree.getValue()},setValue:function(e){this.fieldtree.setValue(e)},doBehavior:function(){this.fieldtree.doBehavior.apply(this.fieldtree,arguments)},getNodeByValue:function(e){return this.fieldtree.getNodeByValue(e)},setTriggerExpand:function(e){e=this.fieldtree.getNodeById(e);BI.isNotNull(e)&&e.showView()},setTriggerCollapse:function(e){this.fieldtree.getNodeById(e).hideView()},expandAll:function(){var n=this;BI.each([BICst.FUNCTION.MATH,BICst.FUNCTION.ARRAY,BICst.FUNCTION.DATE,BICst.FUNCTION.LOGIC,BICst.FUNCTION.ANALYSIS,BICst.FUNCTION.OTHER,BICst.FUNCTION.TEXT,BICst.FUNCTION.COMMON,BICst.FUNCTION.AGG,BICst.FUNCTION.FIXED_CAL],function(e,t){n.setTriggerExpand(t)})},_getSelectItem:function(n,e){return BI.find(e,function(e,t){return t.value===n[0]})},getAllLeaves:function(){return this.fieldtree.getAllLeaves()}}),BI.FormulaFunctionsTree.EVENT_CHANGE="EVENT_CHANGE",BI.FormulaFunctionsTree.EVENT_HOVER="EVENT_HOVER",BI.shortcut("bi.formula_functions_tree",BI.FormulaFunctionsTree)},function(e,t,n){"use strict";var r;r=BI.inherit(Fix.Model,{context:["functionTypes"],computed:{availableFunctionValues:function(){var n=BI.Services.getService("bi.service.material.formula_insert");return BI.map(this.model.functionTypes,function(e,t){return n.getFunctionValueByType(t)})}}}),BI.model("bi.model.material.formula_functions_tree",r)},function(e,t,n){"use strict";BI.FormulaFunctionPane=BI.inherit(BI.Widget,{props:{baseCls:"bi-formula-function-pane bi-card",items:[],searcherHeight:24,searcherGap:10,functionTreeHgap:0,itemHeight:24,leafItemHeight:24,nodeGap:0},_store:function(){return BI.Models.getModel("bi.model.material.formula_function_pane")},watch:{functionKeyword:function(e){var t=this.options,n=e.toLowerCase(),r=[];BI.each(t.items,function(e,t){(-1<t.value.toLowerCase().indexOf(n)||BI.isEmptyString(n))&&r.push(t)}),this.functionTree.populate(r,n),this.fireEvent(BI.FormulaFunctionPane.EVENT_SEARCH)}},render:function(){var t=this,e=this.options;return{type:"bi.htape",items:[{el:{type:"bi.vtape",cls:"bi-split-left",vgap:e.searcherGap,hgap:e.searcherGap,items:[{el:{type:"bi.vertical",items:[{type:"bi.search_editor",height:e.searcherHeight,listeners:[{eventName:BI.SearchEditor.EVENT_CHANGE,action:function(){t.store.setKeyword(this.getValue())}},{eventName:BI.SearchEditor.EVENT_CLEAR,action:function(){t.store.setKeyword(this.getValue())}}]}]},height:e.searcherHeight},{el:{type:"bi.vertical",items:[{type:"bi.formula_functions_tree",cls:"style-top",items:e.items,itemHeight:e.itemHeight,leafItemHeight:e.leafItemHeight,nodeGap:e.nodeGap,ref:function(e){t.functionTree=e},redmark:function(){return!0},listeners:[{eventName:BI.FormulaFunctionsTree.EVENT_CHANGE,action:function(e){t.fireEvent(BI.FormulaFunctionPane.EVENT_INSET,e)}},{eventName:BI.FormulaFunctionsTree.EVENT_HOVER,action:function(e){t.fireEvent(BI.FormulaFunctionPane.EVENT_HOVER,e)}}]}]},hgap:e.functionTreeHgap}]}}]}},getAllLeaves:function(){return this.functionTree.getAllLeaves()},setValue:function(e){this.functionTree.setValue(e)}}),BI.FormulaFunctionPane.EVENT_INSET="EVENT_INSET",BI.FormulaFunctionPane.EVENT_HOVER="EVENT_HOVER",BI.FormulaFunctionPane.EVENT_CLOSE="EVENT_CLOSE",BI.FormulaFunctionPane.EVENT_SEARCH="EVENT_SEARCH",BI.shortcut("bi.formula_function_pane",BI.FormulaFunctionPane)},function(e,t,n){"use strict";var r;r=BI.inherit(Fix.Model,{context:["functionKeyword"],state:function(){return{}},computed:{},actions:{setKeyword:function(e){this.model.functionKeyword=e}}}),BI.model("bi.model.material.formula_function_pane",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{constants:{hgap:7.5,textWidth:14,textHeight:17,enableSwitcher:!1},_defaultConfig:function(){return BI.extend(r.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-formula-symbol-group",fieldType:BICst.FORMULA_GENERATE_TYPE.AUTO,itemHeight:24})},render:function(){var t=this,e=this.constants,n=this.options,e={left:[{type:"bi.button_group",chooseType:-1,items:BI.createItems([{cls:"operator-plus-font",$testId:"bi-formula-symbol-group-plus",value:"+"},{cls:"operator-minus-font",$testId:"bi-formula-symbol-group-minus",value:"-"},{cls:"operator-multi-font",$testId:"bi-formula-symbol-group-mul",value:"*"},{cls:"operator-divide-font",$testId:"bi-formula-symbol-group-div",value:"/"},{cls:"operator-left-brackets-font",$testId:"bi-formula-symbol-group-left-brackets",value:"("},{cls:"operator-right-brackets-font",$testId:"bi-formula-symbol-group-right-brackets",value:")"}],{type:"bi.icon_button",forceNotSelected:!0,once:!1,textWidth:e.textWidth,textHeight:e.textHeight,cls:"symbol-button bi-list-item"}),layouts:[{type:"bi.vertical_adapt",lgap:15}],listeners:[{eventName:BI.ButtonGroup.EVENT_CHANGE,action:function(e){t.fireEvent("EVENT_CHANGE",e)}}],ref:function(e){t.symbolgroup=e}}]};return!0===this.options.enableSwitcher&&(e.right=[{el:{type:"bi.label",text:BI.i18nText("BI-Basic_Field_Type")},rgap:10},{el:{type:"bi.icon_combo",cls:"bi-list-item",items:[{iconCls:"formula-auto-font",text:BI.i18nText("BI-Basic_Auto"),$testId:"bi-formula-symbol-group-auto",value:BICst.FORMULA_GENERATE_TYPE.AUTO,height:n.itemHeight},{iconCls:"string-field-font",$testId:"bi-formula-symbol-group-string",text:BI.i18nText("BI-Basic_Text"),value:BICst.FORMULA_GENERATE_TYPE.STRING,height:n.itemHeight},{iconCls:"number-field-font",$testId:"bi-formula-symbol-group-number",text:BI.i18nText("BI-Basic_Number"),value:BICst.FORMULA_GENERATE_TYPE.NUMBER,height:n.itemHeight},{iconCls:"date-field-font",$testId:"bi-formula-symbol-group-date",text:BI.i18nText("BI-Basic_Time"),value:BICst.FORMULA_GENERATE_TYPE.DATE,height:n.itemHeight}],value:this.options.fieldType,ref:function(e){t.iconCombo=e},listeners:[{eventName:BI.IconCombo.EVENT_CHANGE,action:function(){t.fireEvent("EVENT_TYPE_CHANGE")}}]},rgap:5}]),{type:"bi.left_right_vertical_adapt",llgap:5,items:e}},getValue:function(){if(BI.isNotNull(this.iconCombo))return this.iconCombo.getValue()},setValue:function(e){BI.isNotNull(this.iconCombo)&&this.iconCombo.setValue(e||BICst.FORMULA_GENERATE_TYPE.AUTO)}}),BI.shortcut("bi.symbol_group",r)},function(e,t,n){"use strict";BI.FormulaInsert=BI.inherit(BI.Widget,{constants:{height:30,width:160,right:10,button_bottom:7,pane_bottom:-1,MORE_FUNCTION:0,RETRACT:1,retract_width:30,more_width:200,function_pane_width:180,field_pane_width:220,describe_height:200,describe_retract_height:36,enableSwitcher:!1,abandonFunctions:[],functionRegex:/\w+/},props:function(){return{baseCls:"bi-formula-insert",fieldItems:[],fieldItemsCreator:undefined,errorFieldItems:[],functionTypes:["COMMON","MATH","DATETIME","ARRAY","TEXT","LOGIC","OTHER"],validationChecker:function(){return BICst.FORMULA_STATE.VALID},keywordsGetter:function(){return BI.FormulaCollections},formulaJSONGetter:function(){return BI.FormulaJSONs},checkFormulaValidation:BI.Func.checkFormulaValidation,searcherHeight:24,searcherGap:10,functionTreeHgap:0,fieldTreeHgap:0,itemHeight:24,nodeGap:0,functionPaneOpened:!1,autoCheck:!0,direction:"horizontal",watermark:BI.i18nText("BI-Conf_Formula_Water_Mark")}},_store:function(){return BI.Models.getModel("bi.model.material.formula_insert",{fieldItems:this.options.fieldItems,functionTypes:this.options.functionTypes,formulaJSONGetter:this.options.formulaJSONGetter})},render:function(){var i=this,e=this.options,t=this.constants;return i.validation=BICst.FORMULA_STATE.VALID,BI.FormulaCollections=BI.filter(BI.FormulaOriginCollections,function(e,t){return BI.contains(i.model.availableFunctions,t.toUpperCase())}),this.fieldPane=BI.createWidget({type:"bi.formula_field_pane",cls:"bi-formula-field-pane",items:e.fieldItems,itemsCreator:e.fieldItemsCreator,searcherGap:e.searcherGap,searcherHeight:e.searcherHeight,fieldTreeHgap:e.fieldTreeHgap,itemHeight:e.itemHeight,leafItemHeight:e.leafItemHeight||e.itemHeight,nodeGap:e.nodeGap,width:t.field_pane_width,listeners:[{eventName:BI.FormulaFieldPane.EVENT_CHANGE,action:function(e){i.store.insertField(e[0]),i.formulaedit.insertField(e[0],!0)}},{eventName:BI.FormulaFieldPane.EVENT_SEARCH,action:function(){i._bindFieldDragEvent()}}]}),this.symbolgroup=BI.createWidget({type:"bi.symbol_group",height:t.height,enableSwitcher:e.enableSwitcher,fieldType:e.fieldType,itemHeight:e.itemHeight,cls:"symbol-group-column",listeners:[{eventName:"EVENT_CHANGE",action:function(e){i.store.insertOperator(e),i.formulaedit.insertOperator(e)}},{eventName:"EVENT_TYPE_CHANGE",action:function(){i.fireEvent(BI.FormulaInsert.EVENT_TYPE_CHANGE)}}]}),this.formulaedit=BI.createWidget({type:"bi.formula_editor",$testId:"bi-formula-editor",cls:"bi-split-top",tipType:"warning",paramFormatter:BI.bind(this._paramFormatter,this),valueGetter:BI.bind(this._valueGetter,this),formulaChecker:e.formulaChecker,paramTypeGetter:function(e){var t=i.fieldsDetailMap[e]||{};switch(t.type){case BICst.COLUMN.DATE:return"date";case BICst.COLUMN.NUMBER:return"number";case BICst.COLUMN.STRING:return"string";default:return t.type}},keywordsGetter:function(){return e.keywordsGetter().concat(BI.map(BI.flatten(i._getSortedResult(e.fieldItems)),function(e,t){return{iconCls:i._getIconCls(t),text:t.text,value:t.value,type:BICst.FORMULA_KEYWORD_TYPE.PARAM}}))},watermark:e.watermark,listeners:[{eventName:BI.FormulaEditor.EVENT_CHANGE,action:function(){i._checkValidation()}},{eventName:BI.FormulaEditor.EVENT_BLUR,action:function(){i.hideTip(),i.checkValidation()||(i.formulaedit.setTitle(i.formulaedit.getTip()||i.getErrorText()||BI.i18nText("BI-Basic_Formula_Invalid"),{belowMouse:!0}),i.showTip())}},{eventName:BI.FormulaEditor.EVENT_FOCUS,action:function(){i.formulaedit.setTitle(""),i.checkValidation()||i.showTip()}},{eventName:BI.FormulaEditor.EVENT_KEY_UP,action:function(e){i.store.inputOperator(e)}},{eventName:BI.FormulaEditor.EVENT_CURSOR_ACTIVITY,action:function(e){var n=e.getCursor(),t=e.getTokenAt(n),r="",e=("keyword"===t.type?r=t.string:"bracket"===t.type&&"("===t.string&&(t=e.getLineTokens(n.line),BI.some(t,function(e,t){t.end===n.ch-1&&(r=t.string)})),i._getFunction(r));BI.isNotNull(e)&&(i.describePane.setVisible(!0),i.describePane.populate(e),i.functionpane.setValue(e.value))}},{eventName:"EVENT_SELECT_HINT",action:function(e){}},{eventName:"EVENT_PICK_HINT",action:function(e){e=i._getFunction(e.value);BI.isNotNull(e)&&(i.describePane.setVisible(!0),i.describePane.populate(e),i.functionpane.setValue(e.value))}}]}),this.describePane=BI.createWidget({type:"bi.formula_function_describe",cls:"bi-split-top formula-describe-pane",expandable:"horizontal"===e.direction,invisible:"horizontal"===e.direction,defaultHyperLink:e.defaultHyperLink}),this.functionbutton=BI.createWidget({type:"bi.node_button",open:e.functionPaneOpened,render:function(){return{type:"bi.vertical",width:t.retract_width,cls:"bi-background",items:[{type:"bi.icon_change_button",ref:function(e){i.functionTriggerBtn=e},iconCls:e.functionPaneOpened?"formula-collapse":"formula-expand",cls:"more-function-button",height:30},{type:"bi.label",textWidth:13,textHeight:18,whiteSpace:"normal",text:BI.i18nText("BI-Basic_Function")}]}},handler:function(){this.isOpened()?i._closeFunctionPane():i._openFunctionPane()}}),this.functionpane=BI.createWidget({type:"bi.formula_function_pane",items:i.model.functionItems,searcherHeight:e.searcherHeight,searcherGap:e.searcherGap,functionTreeHgap:e.functionTreeHgap,itemHeight:e.itemHeight,leafItemHeight:e.leafItemHeight||e.itemHeight,nodeGap:e.nodeGap,width:t.function_pane_width,invisible:"horizontal"===e.direction&&!e.functionPaneOpened,listeners:[{eventName:BI.FormulaFunctionPane.EVENT_INSET,action:function(e){e=e.text;BI.isNotEmptyString(e)&&(i.store.insertFunction(e),i.formulaedit.insertFunction(e))}},{eventName:BI.FormulaFunctionPane.EVENT_SEARCH,action:function(){i._bindFunctionDragEvent()}},{eventName:BI.FormulaFunctionPane.EVENT_HOVER,action:function(e){var t=e.text;BI.isNotEmptyString(t)&&(i.describePane.setVisible(!0),i.describePane.populate(e))}}]}),this.formulaedit.element.droppable({accept:".field-item-draggable,.function-item-draggable",drop:function(e,t){var n=t.helper.attr("fieldId"),t=t.helper.attr("func");BI.isNotNull(n)&&(i.store.insertDragField(n,!0),i.formulaedit.insertField(n,!0)),BI.isNotNull(t)&&(i.store.insertDragFunction(t),i.formulaedit.insertFunction(t))}}),this._bindFunctionDragEvent(),this.populate(e.fieldItems),"vertical"===e.direction?{type:"bi.vertical_fill",rowSize:[.5,"fill"],items:[{el:{type:"bi.vertical_fill",rowSize:["","fill"],horizontalAlign:"stretch",items:[{el:this.symbolgroup},{el:this.formulaedit}]}},{el:{type:"bi.horizontal_fill",columnSize:[.5,.5],items:[{type:"bi.horizontal_fill",columnSize:[.6,.4],cls:"bi-split-top bi-split-right",items:[{el:this.fieldPane},{el:this.functionpane}]},{el:this.describePane}]}}],ref:function(e){i.formulaPane=e}}:{type:"bi.horizontal_fill",columnSize:["","fill"],items:[{el:{type:"bi.horizontal_fill",cls:"bi-split-right",items:[{el:this.functionbutton},{el:this.functionpane}]}},{el:{type:"bi.horizontal_fill",columnSize:["","fill"],items:[{el:this.fieldPane},{type:"bi.vertical_fill",rowSize:["","fill",""],cls:"bi-split-left",items:[{el:this.symbolgroup},{el:this.formulaedit},{el:this.describePane}]}]}}],ref:function(e){i.formulaPane=e}}},mounted:function(){var e=this.options;BI.isNotNull(e.value)&&this.setValue(e.value)},_getSortedResult:function(e){return BI.map(e,function(e,t){return BI.Func.getSortedResult(t,"text")})},_getIconCls:function(e){if(e.iconCls)return e.iconCls;var t;switch(e.fieldType){case BICst.COLUMN.STRING:t="string-field-font";break;case BICst.COLUMN.NUMBER:t="number-field-font";break;case BICst.COLUMN.DATE:t="date-field-font"}return t},_paramFormatter:function(e){return BI.has(this.fieldErrorValueTextMap,e)?"<!"+this.fieldErrorValueTextMap[e]+"!>":this.fieldValueTextMap[e]},_valueGetter:function(e){return this.fieldErrorTextValueMap[e]||this.fieldTextValueMap[e]},_getFunctionItems:function(e){var r=this,e=(this.constants,this._analyzeContent(e.replaceAll(/[\'\"](.+?)[\'\"]/g,"")||"")||[]),n=(this.functionArray=[],BI.each(e.reverse(),function(e,n){var t=r._getFunction(n);BI.isNotEmptyObject(t)&&!BI.some(r.functionArray,function(e,t){return t.text.toLowerCase()===n.toLowerCase()})&&r.functionArray.push(t)}),[]);BI.each(this.functionArray,function(e,t){t=BI.createWidget({type:"bi.vertical",items:[{type:"bi.label",cls:"cm-strong",textAlign:"left",text:t.text+":"},{type:"bi.label",whiteSpace:"normal",textAlign:"left",text:t.description}]});n.push(t)}),this.describePane.populate(n.slice(0,1)),BI.isEmptyArray(n)?this.describePane.setVisible(!1):this.describePane.isVisible()||this.describePane.setVisible(!0)},_reHsize:function(e){this.formulaPane.options.items[0].width=e,this.formulaPane.resize()},_getFunction:function(i){return BI.find(this.model.functionItems,function(e,t){var n,r;return t.text===i||(t=t.text.toLowerCase(),n=i.toLowerCase(),r=i.toUpperCase(),t===n&&(r===i||n===i))})},_checkValidation:function(){var n,r,i=this,e=this.options,t=i.formulaedit.getCheckString(),o=i.getValue(),a=i.getUsedFields(),s=BI.map(e.errorFieldItems,"value"),l=!BI.some(a,function(e,t){return BI.contains(s,t)}),c=l;l&&(n=BI.map(BI.flatten(e.fieldItems),"value"),c=!BI.some(a,function(e,t){return!BI.contains(n,t)})),c?(r=BI.UUID(),i.store.setLastCheckId(r),l=this.formulaedit.check(o),e.autoCheck&&BI.isNotNull(l)?(c=JSON.parse(l.message),this._dealCheckResult(r,o,!1,{errorCode:[],errorMessage:[c.errorText]},{usedFields:a})):e.checkFormulaValidation?e.checkFormulaValidation({str:t,origin:o,fieldsMap:this.fieldsDetailMap},function(e,t){i._dealCheckResult(r,o,e,t,{usedFields:a})}):i._dealCheckResult(r,o,!0,{},{usedFields:a})):(i.validation=BICst.FORMULA_STATE.FIELD_MISS,i.showTip(),i.fireEvent(BI.FormulaInsert.EVENT_ERROR))},_dealCheckResult:function(e,t,n,r,i){var o,a;i=i||{},r=r||{},this.errorMessage=[],e===this.model.lastCheckId&&(e=r.errorCode,a=r.errorMessage,n?o=this.options.validationChecker(i.usedFields,t,r):(this.errorMessage=a,BI.contains(e,BICst.ErrorCode.FORMULA_ERROR.DIS_AGGRESSIVE_FUNCTION_HAS_FIELD_WITH_DETAIL_FILTER)&&(o=BICst.FORMULA_STATE.DETAIL_FILTER_NOT_SUPPORT)),(o=BI.isNull(o)?n?BICst.FORMULA_STATE.VALID:BICst.FORMULA_STATE.INVALID:o)===BICst.FORMULA_STATE.VALID?(this.validation=BICst.FORMULA_STATE.VALID,this.hideTip(),this.fireEvent(BI.FormulaInsert.EVENT_CHANGE),this.fireEvent(BI.FormulaInsert.EVENT_VALID)):(this.validation=o,this.showTip(),this.fireEvent(BI.FormulaInsert.EVENT_ERROR)))},_analyzeContent:function(e){return e.match(/\$[\{][^\}]*[\}]|\w+(\.\w+)*|\$\{[^\$\(\)\+\-\*\/)\$,]*\w\}|\$\{[^\$\(\)\+\-\*\/]*\w\}|\$\{[^\$\(\)\+\-\*\/]*[\u4e00-\u9fa5]\}|\w|(.)|\n/g)},_createFieldTextValueMap:function(e){var n={};return BI.each(e,function(e,t){BI.each(t,function(e,t){n[t.text]=t.value})}),n},_createErrorTextValueMap:function(){var n={};return BI.each(this.options.errorFieldItems,function(e,t){n[t.text]=t.value}),n},_createErrorValueTextMap:function(){var n={};return BI.each(this.options.errorFieldItems,function(e,t){n[t.value]=t.text}),n},_createFieldValueTextMap:function(e){var n={};return BI.each(e,function(e,t){BI.each(t,function(e,t){n[t.value]=t.text})}),n},_createFieldDetailMap:function(e){var r={};return BI.each(e,function(e,t){BI.each(t,function(e,t){var n=t.fieldType;switch(n){case BICst.FORMULA_WIDGET_FIELD_TYPE.DATE:n=BICst.COLUMN.DATE;break;case BICst.FORMULA_WIDGET_FIELD_TYPE.STRING:n=BICst.COLUMN.STRING;break;case BICst.FORMULA_WIDGET_FIELD_TYPE.NUMBER:case BICst.COLUMN.CALCULATE:n=BICst.COLUMN.NUMBER}r[t.value]={type:n,isAgg:t.isAgg||!1,hasDetailFilter:t.hasDetailFilter||!1,freeAggregate:t.freeAggregate||!1}})}),r},_bindFieldDragEvent:function(){var n=this;BI.each(n.fieldPane.getAllLeaves(),function(e,t){t.element.draggable({cursorAt:{top:5,left:5},helper:function(){var e=BI.createWidget({type:"bi.helper",value:t.getValue(),text:n.fieldValueTextMap[t.getValue()]});return BI.createWidget({element:n,type:"bi.default",items:[e]}),e.element.attr({fieldId:t.getValue(),field:n.fieldValueTextMap[t.getValue()]}),e.element}})})},_bindFunctionDragEvent:function(){var n=this;BI.each(n.functionpane.getAllLeaves(),function(e,t){t.element.draggable({cursorAt:{top:5,left:5},handle:".draggable-handle",helper:function(){var e=BI.createWidget({type:"bi.helper",value:t.getValue(),text:t.getValue()});return BI.createWidget({element:n,type:"bi.default",items:[e]}),e.element.attr({func:t.getValue()}),e.element}})})},_openFunctionPane:function(){this.functionTriggerBtn.setIcon("formula-collapse"),this.functionpane.setVisible(!0)},_closeFunctionPane:function(){this.functionTriggerBtn.setIcon("formula-expand"),this.functionpane.setVisible(!1)},checkValidation:function(){return this.validation===BICst.FORMULA_STATE.VALID},getErrorText:function(){if(BI.isEmptyString(this.getValue()))return BI.i18nText("BI-Basic_Please_Add_Formula");if(BI.isNotEmptyArray(this.errorMessage))return this.errorMessage.join("\n");var e="";switch(this.validation){case BICst.FORMULA_STATE.DETAIL_FILTER_NOT_SUPPORT:e=BI.i18nText("BI-Design_Formula_Not_Support_Detail_Filter");break;case BICst.FORMULA_STATE.AGG_INVALID:e=BI.i18nText("BI-Design_Detail_Table_Not_Support_AGG");break;case BICst.FORMULA_STATE.FIXED_INVALID:e=BI.i18nText("BI-Design_Detail_Table_Not_Support_Fixed");break;case BICst.FORMULA_STATE.FIELD_MISS:e=BI.i18nText("BI-Basic_Field_Cannot_Find");break;case BICst.FORMULA_STATE.NOT_SUPPORT_STRING_OR_DATE:e=BI.i18nText("BI-Design_Not_Support_Date_Or_String");break;case BICst.FORMULA_STATE.RAPID_INVALID:e=BI.i18nText("BI-Design_Detail_Table_Not_Support_Rapid");break;default:e=BI.i18nText("BI-Basic_Formula_Invalid")}return e},showTip:function(){this.formulaedit.showTip(this.getErrorText())},hideTip:function(){this.formulaedit.hideTip()},refresh:function(){this.formulaedit.refresh()},setValue:function(e){this.formulaedit.refresh(),this.formulaedit.setValue(e),this._checkValidation()},getFormulaString:function(){return this.formulaedit.getFormulaString()},getUsedFields:function(){return this.formulaedit.getUsedFields()},setFormulaFieldType:function(e){return this.symbolgroup.setValue(e)},getFormulaFieldType:function(){return this.symbolgroup.getValue()},getValue:function(){return this.formulaedit.getValue()},populate:function(e){this.options.fieldItems=e,this.fieldTextValueMap=this._createFieldTextValueMap(e),this.fieldValueTextMap=this._createFieldValueTextMap(e),this.fieldErrorTextValueMap=this._createErrorTextValueMap(),this.fieldErrorValueTextMap=this._createErrorValueTextMap(),this.fieldsDetailMap=this._createFieldDetailMap(e),this.fieldPane.populate(e),this._bindFieldDragEvent()}}),BI.FormulaInsert.EVENT_VALID="EVENT_VALID",BI.FormulaInsert.EVENT_ERROR="EVENT_ERROR",BI.FormulaInsert.EVENT_CHANGE="EVENT_CHANGE",BI.FormulaInsert.EVENT_TYPE_CHANGE="EVENT_TYPE_CHANGE",BI.shortcut("bi.formula_insert",BI.FormulaInsert)},function(e,t,n){"use strict";var r;r=BI.inherit(Fix.Model,{childContext:["fieldKeyword","functionKeyword","functionTypes"],state:function(){var e=this.options;return{fieldItems:e.fieldItems,fieldKeyword:"",functionKeyword:"",functionTypes:e.functionTypes,lastCheckId:null}},computed:{allFieldItems:function(){return BI.flatten(this.options.fieldItems)},numberFieldItems:function(){return BI.filter(this.model.allFieldItems,function(e,t){return t.fieldType===BICst.COLUMN.NUMBER})},numberFieldIds:function(){return BI.map(this.model.numberFieldItems,"value")},stringFieldItems:function(){return BI.filter(this.model.allFieldItems,function(e,t){return t.fieldType===BICst.COLUMN.STRING})},stringFieldIds:function(){return BI.map(this.model.stringFieldItems,"value")},dateFieldItems:function(){return BI.filter(this.model.allFieldItems,function(e,t){return t.fieldType===BICst.COLUMN.DATE})},dateFieldIds:function(){return BI.map(this.model.dateFieldItems,"value")},functionItems:function i(){var n=this,e=this.options.formulaJSONGetter(),i=[],r=BI.Services.getService("bi.service.material.formula_insert");return BI.each(e,function(e,t){n.model.functionTypes.includes(t.type)&&i.push({text:t.name,value:t.name,fieldType:r.getFunctionValueByType(t.type),description:t.def})}),i},availableFunctions:function(){return BI.map(this.model.functionItems,"value")}},actions:{insertOperator:function(e){},inputOperator:function(e){},insertField:function(e){},insertFunction:function(e){},insertDragFunction:function(e){},insertDragField:function(e){},addFunctionType:function(e){this.model.functionTypes.push(e)},setLastCheckId:function(e){this.model.lastCheckId=e}}}),BI.model("bi.model.material.formula_insert",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.OB,{getFunctionValueByType:function(e){switch(e){case"MATH":return BICst.FUNCTION.MATH;case"TEXT":return BICst.FUNCTION.TEXT;case"DATETIME":return BICst.FUNCTION.DATE;case"ARRAY":return BICst.FUNCTION.ARRAY;case"LOGIC":return BICst.FUNCTION.LOGIC;case"AGG":return BICst.FUNCTION.AGG;case"COMMON":return BICst.FUNCTION.COMMON;case"TABLE_CAL":return BICst.FUNCTION.TABLE_CAL;case"ANALYSIS":return BICst.FUNCTION.ANALYSIS;case"OTHER":return BICst.FUNCTION.OTHER;case"FIXED_CAL":return BICst.FUNCTION.FIXED_CAL;default:return}}}),BI.service("bi.service.material.formula_insert",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.BasicButton,{props:{baseCls:"bi-components-formula-text-func-button cursor-pointer",$testId:"bi-components-formula-text-func-button"},render:function(){return{type:"bi.horizontal_adapt",items:[{type:"bi.text_button",textWidth:13,textHeight:18,whiteSpace:"normal",text:BI.i18nText("BI-Basic_Function")}]}}}),BI.shortcut("bi.components.formula.text_func_button",r)},function(e,t,n){"use strict";n(207)(n(542))},function(e,t,n){"use strict";BI.Svg=BI.inherit(BI.Widget,{_defaultConfig:function(){return BI.extend(BI.Svg.superclass._defaultConfig.apply(this,arguments),{baseCls:"bi-svg"})},_init:function(){BI.Svg.superclass._init.apply(this,arguments),this.paper=Raphael(this.element[0]),this.element.css("overflow","hidden"),BI.$(this.paper.canvas).width("100%").height("100%").css({left:"0",top:"0"}).appendTo(this.element),this.top=this.paper.top,this.bottom=this.paper.bottom,this.customAttributes=this.paper.customAttributes,this.ca=this.paper.ca,this.raphael=this.paper.raphael},add:function(){return this.paper.add.apply(this.paper,arguments)},path:function(){return this.paper.path.apply(this.paper,arguments)},image:function(){return this.paper.image.apply(this.paper,arguments)},rect:function(){return this.paper.rect.apply(this.paper,arguments)},circle:function(){return this.paper.circle.apply(this.paper,arguments)},ellipse:function(){return this.paper.ellipse.apply(this.paper,arguments)},text:function(){return this.paper.text.apply(this.paper,arguments)},print:function(){return this.paper.print.apply(this.paper,arguments)},setStart:function(){return this.paper.setStart.apply(this.paper,arguments)},setFinish:function(){return this.paper.setFinish.apply(this.paper,arguments)},setSize:function(){return this.paper.setSize.apply(this.paper,arguments)},setViewBox:function(){return this.paper.setViewBox.apply(this.paper,arguments)},getById:function(){return this.paper.getById.apply(this.paper,arguments)},getElementByPoint:function(){return this.paper.getElementByPoint.apply(this.paper,arguments)},getElementsByPoint:function(){return this.paper.getElementsByPoint.apply(this.paper,arguments)},getFont:function(){return this.paper.getFont.apply(this.paper,arguments)},set:function(){return this.paper.set.apply(this.paper,arguments)},remove:function(){return this.paper.remove.apply(this.paper,arguments)},clear:function(){return this.paper.clear.apply(this.paper,arguments)}}),BI.shortcut("bi.svg",BI.Svg)},function(e,n,t){"use strict";!function(e){var t;function b(e,t){var n,r,i,o,a,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return r=!(n=!0),{s:function(){s=s.call(e)},n:function(){var e=s.next();return n=e.done,e},e:function(e){r=!0,i=e},f:function(){try{n||null==s["return"]||s["return"]()}finally{if(r)throw i}}};if(Array.isArray(e)||(s=l(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),o=0,{s:a=function a(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){var n;if(e)return"string"==typeof e?r(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1})}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function c(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window,t=function(){return n=[function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(64),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(60),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(51),i=(Object.defineProperty(t,"closest",{enumerable:!0,get:function(){return o(r)["default"]}}),n(49));function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"requestNextAnimationFrame",{enumerable:!0,get:function(){return o(i)["default"]}})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(44);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(47),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),i=(Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})}),n(13)),o=(Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})}),n(12)),a=(Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})}),n(6)),n=(Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}),n(37)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=(Object.defineProperty(t,"Sensor",{enumerable:!0,get:function(){return c(r)["default"]}}),n(46)),o=(Object.defineProperty(t,"MouseSensor",{enumerable:!0,get:function(){return c(i)["default"]}}),n(43)),a=(Object.defineProperty(t,"TouchSensor",{enumerable:!0,get:function(){return c(o)["default"]}}),n(41)),s=(Object.defineProperty(t,"DragSensor",{enumerable:!0,get:function(){return c(a)["default"]}}),n(39)),l=(Object.defineProperty(t,"ForceTouchSensor",{enumerable:!0,get:function(){return c(s)["default"]}}),n(3));function c(e){return e&&e.__esModule?e:{"default":e}}Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(18);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(23);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(27);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(30);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(33);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(62),i=(Object.defineProperty(t,"Announcement",{enumerable:!0,get:function(){return s(r)["default"]}}),Object.defineProperty(t,"defaultAnnouncementOptions",{enumerable:!0,get:function(){return r.defaultOptions}}),n(59)),o=(Object.defineProperty(t,"Focusable",{enumerable:!0,get:function(){return s(i)["default"]}}),n(57)),a=(Object.defineProperty(t,"Mirror",{enumerable:!0,get:function(){return s(o)["default"]}}),Object.defineProperty(t,"defaultMirrorOptions",{enumerable:!0,get:function(){return o.defaultOptions}}),n(53));function s(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"Scrollable",{enumerable:!0,get:function(){return s(a)["default"]}}),Object.defineProperty(t,"defaultScrollableOptions",{enumerable:!0,get:function(){return a.defaultOptions}})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(63);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(65);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n=n(1),n=(n=n)&&n.__esModule?n:{"default":n};var i=Symbol("onSortableSorted"),o=t.defaultOptions={duration:150,easingFunction:"ease-in-out",horizontal:!1},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=r({},o,e.getOptions()),e.lastAnimationFrame=null,e[i]=e[i].bind(x(e)),e}E(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("sortable:sorted",this[i])},n.detach=function(){this.draggable.off("sortable:sorted",this[i])},n.getOptions=function(){return this.draggable.options.swapAnimation||{}},n[i]=function(e){var t=this,n=e.oldIndex,r=e.newIndex,e=e.dragEvent,i=e.source,o=e.over;cancelAnimationFrame(this.lastAnimationFrame),this.lastAnimationFrame=requestAnimationFrame(function(){r<=n?a(i,o,t.options):a(o,i,t.options)})},e}(n["default"]);function a(r,i,e){for(var o=e.duration,a=e.easingFunction,e=e.horizontal,t=0,n=[r,i];t<n.length;t++)n[t].style.pointerEvents="none";e?(e=r.offsetWidth,r.style.transform="translate3d(".concat(e,"px, 0, 0)"),i.style.transform="translate3d(-".concat(e,"px, 0, 0)")):(e=r.offsetHeight,r.style.transform="translate3d(0, ".concat(e,"px, 0)"),i.style.transform="translate3d(0, -".concat(e,"px, 0)")),requestAnimationFrame(function(){for(var e=0,t=[r,i];e<t.length;e++){var n=t[e];n.addEventListener("transitionend",s),n.style.transition="transform ".concat(o,"ms ").concat(a),n.style.transform=""}})}function s(e){e.target.style.transition="",e.target.style.pointerEvents="",e.target.removeEventListener("transitionend",s)}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var n=n(15),r=(r=n)&&r.__esModule?r:{"default":r};t["default"]=r["default"],t.defaultOptions=n.defaultOptions},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),r=(r=r)&&r.__esModule?r:{"default":r},i=n(7);var o=Symbol("onDragStart"),a=Symbol("onDragStop"),s=Symbol("onDragOver"),l=Symbol("onDragOut"),c=Symbol("onMirrorCreated"),u=Symbol("onMirrorDestroy"),n=function(t){function e(e){e=t.call(this,e)||this;return e.firstSource=null,e.mirror=null,e[o]=e[o].bind(x(e)),e[a]=e[a].bind(x(e)),e[s]=e[s].bind(x(e)),e[l]=e[l].bind(x(e)),e[c]=e[c].bind(x(e)),e[u]=e[u].bind(x(e)),e}E(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("drag:start",this[o]).on("drag:stop",this[a]).on("drag:over",this[s]).on("drag:out",this[l]).on("droppable:over",this[s]).on("droppable:out",this[l]).on("mirror:created",this[c]).on("mirror:destroy",this[u])},n.detach=function(){this.draggable.off("drag:start",this[o]).off("drag:stop",this[a]).off("drag:over",this[s]).off("drag:out",this[l]).off("droppable:over",this[s]).off("droppable:out",this[l]).off("mirror:created",this[c]).off("mirror:destroy",this[u])},n[o]=function(e){e.canceled()||(this.firstSource=e.source)},n[a]=function(){this.firstSource=null},n[s]=function(e){var t,n=this;e.canceled()||((t=e.source||e.dragEvent.source)===this.firstSource?this.firstSource=null:(e=new i.SnapInEvent({dragEvent:e,snappable:e.over||e.droppable}),this.draggable.trigger(e),e.canceled()||(this.mirror&&(this.mirror.style.display="none"),t.classList.remove(this.draggable.getClassNameFor("source:dragging")),t.classList.add(this.draggable.getClassNameFor("source:placed")),setTimeout(function(){t.classList.remove(n.draggable.getClassNameFor("source:placed"))},this.draggable.options.placedTimeout))))},n[l]=function(e){var t;e.canceled()||(t=e.source||e.dragEvent.source,e=new i.SnapOutEvent({dragEvent:e,snappable:e.over||e.droppable}),this.draggable.trigger(e),e.canceled()||(this.mirror&&(this.mirror.style.display=""),t.classList.add(this.draggable.getClassNameFor("source:dragging"))))},n[c]=function(e){e=e.mirror;this.mirror=e},n[u]=function(){this.mirror=null},e}(r["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.SnapOutEvent=t.SnapInEvent=t.SnapEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"dragEvent",get:function(){return this.data.dragEvent}},{key:"snappable",get:function(){return this.data.snappable}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),r=((t.SnapEvent=n).type="snap",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n)),r=((t.SnapInEvent=r).type="snap:in",r.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n));(t.SnapOutEvent=r).type="snap:out",r.cancelable=!0},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),n=(Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})}),n(17)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=n(1),i=(i=i)&&i.__esModule?i:{"default":i},o=n(2);var a=Symbol("onMirrorCreated"),s=Symbol("onMirrorDestroy"),l=Symbol("onDragOver"),c=Symbol("resize"),u=t.defaultOptions={},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=r({},u,e.getOptions()),e.lastWidth=0,e.lastHeight=0,e.mirror=null,e[a]=e[a].bind(x(e)),e[s]=e[s].bind(x(e)),e[l]=e[l].bind(x(e)),e}E(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("mirror:created",this[a]).on("drag:over",this[l]).on("drag:over:container",this[l])},n.detach=function(){this.draggable.off("mirror:created",this[a]).off("mirror:destroy",this[s]).off("drag:over",this[l]).off("drag:over:container",this[l])},n.getOptions=function(){return this.draggable.options.resizeMirror||{}},n[a]=function(e){e=e.mirror;this.mirror=e},n[s]=function(){this.mirror=null},n[l]=function(e){this[c](e)},n[c]=function(e){var n=this,r=e.overContainer,i=e.over;requestAnimationFrame(function(){n.mirror.parentNode!==r&&r.appendChild(n.mirror);var t=i||n.draggable.getDraggableElementsForContainer(r)[0];t&&(0,o.requestNextAnimationFrame)(function(){var e=t.getBoundingClientRect();n.lastHeight===e.height&&n.lastWidth===e.width||(n.mirror.style.width="".concat(e.width,"px"),n.mirror.style.height="".concat(e.height,"px"),n.lastWidth=e.width,n.lastHeight=e.height)})})},e}(i["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var n=n(20),r=(r=n)&&r.__esModule?r:{"default":r};t["default"]=r["default"],t.defaultOptions=n.defaultOptions},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),r=(r=r)&&r.__esModule?r:{"default":r},i=n(2),o=n(8);var a=Symbol("onDragMove"),s=Symbol("onDragStop"),l=Symbol("onRequestAnimationFrame"),n=function(t){function e(e){e=t.call(this,e)||this;return e.currentlyCollidingElement=null,e.lastCollidingElement=null,e.currentAnimationFrame=null,e[a]=e[a].bind(x(e)),e[s]=e[s].bind(x(e)),e[l]=e[l].bind(x(e)),e}E(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("drag:move",this[a]).on("drag:stop",this[s])},n.detach=function(){this.draggable.off("drag:move",this[a]).off("drag:stop",this[s])},n.getCollidables=function(){var e=this.draggable.options.collidables;return"string"==typeof e?Array.prototype.slice.call(document.querySelectorAll(e)):e instanceof NodeList||e instanceof Array?Array.prototype.slice.call(e):e instanceof HTMLElement?[e]:"function"==typeof e?e():[]},n[a]=function(e){var t=e.sensorEvent.target,t=(this.currentAnimationFrame=requestAnimationFrame(this[l](t)),this.currentlyCollidingElement&&e.cancel(),new o.CollidableInEvent({dragEvent:e,collidingElement:this.currentlyCollidingElement})),e=new o.CollidableOutEvent({dragEvent:e,collidingElement:this.lastCollidingElement}),n=Boolean(this.currentlyCollidingElement&&this.lastCollidingElement!==this.currentlyCollidingElement),r=Boolean(!this.currentlyCollidingElement&&this.lastCollidingElement);n?(this.lastCollidingElement&&this.draggable.trigger(e),this.draggable.trigger(t)):r&&this.draggable.trigger(e),this.lastCollidingElement=this.currentlyCollidingElement},n[s]=function(e){var t=this.currentlyCollidingElement||this.lastCollidingElement,e=new o.CollidableOutEvent({dragEvent:e,collidingElement:t});t&&this.draggable.trigger(e),this.lastCollidingElement=null,this.currentlyCollidingElement=null},n[l]=function(e){var n=this;return function(){var t=n.getCollidables();n.currentlyCollidingElement=(0,i.closest)(e,function(e){return t.includes(e)})}},e}(r["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.CollidableOutEvent=t.CollidableInEvent=t.CollidableEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"dragEvent",get:function(){return this.data.dragEvent}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),r=((t.CollidableEvent=n).type="collidable",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"collidingElement",get:function(){return this.data.collidingElement}}]),t}(n)),r=((t.CollidableInEvent=r).type="collidable:in",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"collidingElement",get:function(){return this.data.collidingElement}}]),t}(n));(t.CollidableOutEvent=r).type="collidable:out"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),n=(Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})}),n(22)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(24),i=(Object.defineProperty(t,"Collidable",{enumerable:!0,get:function(){return s(r)["default"]}}),n(21)),o=(Object.defineProperty(t,"ResizeMirror",{enumerable:!0,get:function(){return s(i)["default"]}}),Object.defineProperty(t,"defaultResizeMirrorOptions",{enumerable:!0,get:function(){return i.defaultOptions}}),n(19)),a=(Object.defineProperty(t,"Snappable",{enumerable:!0,get:function(){return s(o)["default"]}}),n(16));function s(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"SwapAnimation",{enumerable:!0,get:function(){return s(a)["default"]}}),Object.defineProperty(t,"defaultSwapAnimationOptions",{enumerable:!0,get:function(){return a.defaultOptions}})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=n(5),i=(i=i)&&i.__esModule?i:{"default":i},a=n(9);var o=Symbol("onDragStart"),s=Symbol("onDragOverContainer"),l=Symbol("onDragOver"),c=Symbol("onDragStop");var u={"sortable:sorted":function(e){var t,n=(e=e.dragEvent).source.textContent.trim()||e.source.id||"sortable element";return e.over?(t=e.over.textContent.trim()||e.over.id||"sortable element",e=e.source.compareDocumentPosition(e.over)&Node.DOCUMENT_POSITION_FOLLOWING,"Placed ".concat(n,e?" after ":" before ").concat(t)):"Placed ".concat(n," into a different container")}},n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,r({},t,{announcements:r({},u,t.announcements||{})}))||this;return e.startIndex=null,e.startContainer=null,e[o]=e[o].bind(x(e)),e[s]=e[s].bind(x(e)),e[l]=e[l].bind(x(e)),e[c]=e[c].bind(x(e)),e.on("drag:start",e[o]).on("drag:over:container",e[s]).on("drag:over",e[l]).on("drag:stop",e[c]),e}E(e,n);var t=e.prototype;return t.destroy=function(){n.prototype.destroy.call(this),this.off("drag:start",this[o]).off("drag:over:container",this[s]).off("drag:over",this[l]).off("drag:stop",this[c])},t.index=function h(e){return this.getDraggableElementsForContainer(e.parentNode).indexOf(e)},t[o]=function(e){this.startContainer=e.source.parentNode,this.startIndex=this.index(e.source);var t=new a.SortableStartEvent({dragEvent:e,startIndex:this.startIndex,startContainer:this.startContainer});this.trigger(t),t.canceled()&&e.cancel()},t[s]=function(e){var t,n,r,i,o;e.canceled()||(n=e.source,r=e.over,i=e.overContainer,t=this.index(n),o=new a.SortableSortEvent({dragEvent:e,currentIndex:t,source:n,over:r}),this.trigger(o),o.canceled()||(o=d({source:n,over:r,overContainer:i,children:this.getDraggableElementsForContainer(i)}))&&(n=o.oldContainer,r=o.newContainer,i=this.index(e.source),o=new a.SortableSortedEvent({dragEvent:e,oldIndex:t,newIndex:i,oldContainer:n,newContainer:r}),this.trigger(o)))},t[l]=function(e){var t,n,r,i,o;e.over!==e.originalSource&&e.over!==e.source&&(o=e.source,n=e.over,r=e.overContainer,t=this.index(o),i=new a.SortableSortEvent({dragEvent:e,currentIndex:t,source:o,over:n}),this.trigger(i),i.canceled()||(i=d({source:o,over:n,overContainer:r,children:this.getDraggableElementsForContainer(r)}))&&(n=i.oldContainer,r=i.newContainer,i=this.index(o),o=new a.SortableSortedEvent({dragEvent:e,oldIndex:t,newIndex:i,oldContainer:n,newContainer:r}),this.trigger(o)))},t[c]=function(e){e=new a.SortableStopEvent({dragEvent:e,oldIndex:this.startIndex,newIndex:this.index(e.source),oldContainer:this.startContainer,newContainer:e.source.parentNode});this.trigger(e),this.startIndex=null,this.startContainer=null},e}(i["default"]);function h(e){return Array.prototype.indexOf.call(e.parentNode.children,e)}function d(e){var t,n,r=e.source,i=e.over,o=e.overContainer,e=!e.children.length,a=r.parentNode!==o,s=i&&!a;return e?(e=o,n=r.parentNode,e.appendChild(r),{oldContainer:n,newContainer:e}):s?(n=i,s=h(e=r),t=h(n),s<t?e.parentNode.insertBefore(e,n.nextElementSibling):e.parentNode.insertBefore(e,n),{oldContainer:e.parentNode,newContainer:e.parentNode}):a?(s=i,t=o,a=(e=r).parentNode,s?s.parentNode.insertBefore(e,s):t.appendChild(e),{oldContainer:a,newContainer:e.parentNode}):null}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.SortableStopEvent=t.SortableSortedEvent=t.SortableSortEvent=t.SortableStartEvent=t.SortableEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"dragEvent",get:function(){return this.data.dragEvent}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),r=((t.SortableEvent=n).type="sortable",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"startIndex",get:function(){return this.data.startIndex}},{key:"startContainer",get:function(){return this.data.startContainer}}]),t}(n)),r=((t.SortableStartEvent=r).type="sortable:start",r.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"currentIndex",get:function(){return this.data.currentIndex}},{key:"over",get:function(){return this.data.oldIndex}},{key:"overContainer",get:function(){return this.data.newIndex}}]),t}(n)),r=((t.SortableSortEvent=r).type="sortable:sort",r.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"oldIndex",get:function(){return this.data.oldIndex}},{key:"newIndex",get:function(){return this.data.newIndex}},{key:"oldContainer",get:function(){return this.data.oldContainer}},{key:"newContainer",get:function(){return this.data.newContainer}}]),t}(n)),r=((t.SortableSortedEvent=r).type="sortable:sorted",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"oldIndex",get:function(){return this.data.oldIndex}},{key:"newIndex",get:function(){return this.data.newIndex}},{key:"oldContainer",get:function(){return this.data.oldContainer}},{key:"newContainer",get:function(){return this.data.newContainer}}]),t}(n));(t.SortableStopEvent=r).type="sortable:stop"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),n=(Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})}),n(26)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=n(5),i=(i=i)&&i.__esModule?i:{"default":i},o=n(10);var a=Symbol("onDragStart"),s=Symbol("onDragOver"),l=Symbol("onDragStop");var c={"swappabled:swapped":function(e){var t=e.dragEvent,e=e.swappedElement,t=t.source.textContent.trim()||t.source.id||"swappable element",e=e.textContent.trim()||e.id||"swappable element";return"Swapped ".concat(t," with ").concat(e)}},n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,r({},t,{announcements:r({},c,t.announcements||{})}))||this;return e.lastOver=null,e[a]=e[a].bind(x(e)),e[s]=e[s].bind(x(e)),e[l]=e[l].bind(x(e)),e.on("drag:start",e[a]).on("drag:over",e[s]).on("drag:stop",e[l]),e}E(e,n);var t=e.prototype;return t.destroy=function(){n.prototype.destroy.call(this),this.off("drag:start",this._onDragStart).off("drag:over",this._onDragOver).off("drag:stop",this._onDragStop)},t[a]=function(e){var t=new o.SwappableStartEvent({dragEvent:e});this.trigger(t),t.canceled()&&e.cancel()},t[s]=function(e){var t;e.over===e.originalSource||e.over===e.source||e.canceled()||(t=new o.SwappableSwapEvent({dragEvent:e,over:e.over,overContainer:e.overContainer}),this.trigger(t),t.canceled()||(this.lastOver&&this.lastOver!==e.over&&u(this.lastOver,e.source),this.lastOver===e.over?this.lastOver=null:this.lastOver=e.over,u(e.source,e.over),t=new o.SwappableSwappedEvent({dragEvent:e,swappedElement:e.over}),this.trigger(t)))},t[l]=function(e){e=new o.SwappableStopEvent({dragEvent:e});this.trigger(e),this.lastOver=null},e}(i["default"]);function u(t,n){var e,r,i=n.parentNode,o=t.parentNode;e=function(e){o.insertBefore(e,t),i.insertBefore(t,n),o.insertBefore(n,e)},r=document.createElement("div"),e(r),r.parentNode.removeChild(r)}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.SwappableStopEvent=t.SwappableSwappedEvent=t.SwappableSwapEvent=t.SwappableStartEvent=t.SwappableEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"dragEvent",get:function(){return this.data.dragEvent}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),r=((t.SwappableEvent=n).type="swappable",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n)),r=((t.SwappableStartEvent=r).type="swappable:start",r.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"over",get:function(){return this.data.over}},{key:"overContainer",get:function(){return this.data.overContainer}}]),t}(n)),r=((t.SwappableSwapEvent=r).type="swappable:swap",r.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"swappedElement",get:function(){return this.data.swappedElement}}]),t}(n)),r=((t.SwappableSwappedEvent=r).type="swappable:swapped",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n));(t.SwappableStopEvent=r).type="swappable:stop"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),n=(Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})}),n(29)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=n(2),i=n(5),i=(i=i)&&i.__esModule?i:{"default":i},l=n(11);var o=Symbol("onDragStart"),a=Symbol("onDragMove"),c=Symbol("onDragStop"),u=Symbol("dropInDropZone"),h=Symbol("returnToOriginalDropzone"),d=Symbol("closestDropzone"),p=Symbol("getDropzones");var f={"droppable:dropped":function(e){var t=e.dragEvent,e=e.dropzone,t=t.source.textContent.trim()||t.source.id||"draggable element",e=e.textContent.trim()||e.id||"droppable element";return"Dropped ".concat(t," into ").concat(e)},"droppable:returned":function(e){var t=e.dragEvent,e=e.dropzone,t=t.source.textContent.trim()||t.source.id||"draggable element",e=e.textContent.trim()||e.id||"droppable element";return"Returned ".concat(t," from ").concat(e)}},m={"droppable:active":"draggable-dropzone--active","droppable:occupied":"draggable-dropzone--occupied"},g={dropzone:".draggable-droppable"},n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,r({},g,t,{classes:r({},m,t.classes||{}),announcements:r({},f,t.announcements||{})}))||this;return e.dropzones=null,e.lastDropzone=null,e.initialDropzone=null,e[o]=e[o].bind(x(e)),e[a]=e[a].bind(x(e)),e[c]=e[c].bind(x(e)),e.on("drag:start",e[o]).on("drag:move",e[a]).on("drag:stop",e[c]),e}E(e,n);var t=e.prototype;return t.destroy=function(){n.prototype.destroy.call(this),this.off("drag:start",this[o]).off("drag:move",this[a]).off("drag:stop",this[c])},t[o]=function(e){if(!e.canceled()){this.dropzones=_(this[p]());var t=(0,s.closest)(e.sensorEvent.target,this.options.dropzone);if(t){var n=new l.DroppableStartEvent({dragEvent:e,dropzone:t});if(this.trigger(n),n.canceled())e.cancel();else{this.initialDropzone=t;var r,i=b(this.dropzones);try{for(i.s();!(r=i.n()).done;){var o=r.value;o.classList.contains(this.getClassNameFor("droppable:occupied"))||o.classList.add(this.getClassNameFor("droppable:active"))}}catch(a){i.e(a)}finally{i.f()}}}else e.cancel()}},t[a]=function(e){var t;e.canceled()||((t=this[d](e.sensorEvent.target))&&!t.classList.contains(this.getClassNameFor("droppable:occupied"))&&this[u](e,t)?this.lastDropzone=t:t&&t!==this.initialDropzone||!this.lastDropzone||(this[h](e),this.lastDropzone=null))},t[c]=function(e){var t,e=new l.DroppableStopEvent({dragEvent:e,dropzone:this.lastDropzone||this.initialDropzone}),e=(this.trigger(e),this.getClassNameFor("droppable:occupied")),n=b(this.dropzones);try{for(n.s();!(t=n.n()).done;)t.value.classList.remove(this.getClassNameFor("droppable:active"))}catch(r){n.e(r)}finally{n.f()}this.lastDropzone&&this.lastDropzone!==this.initialDropzone&&this.initialDropzone.classList.remove(e),this.dropzones=null,this.lastDropzone=null,this.initialDropzone=null},t[u]=function(e,t){var n=new l.DroppableDroppedEvent({dragEvent:e,dropzone:t});return this.trigger(n),!n.canceled()&&(n=this.getClassNameFor("droppable:occupied"),this.lastDropzone&&this.lastDropzone.classList.remove(n),t.appendChild(e.source),t.classList.add(n),!0)},t[h]=function(e){var t=new l.DroppableReturnedEvent({dragEvent:e,dropzone:this.lastDropzone});this.trigger(t),t.canceled()||(this.initialDropzone.appendChild(e.source),this.lastDropzone.classList.remove(this.getClassNameFor("droppable:occupied")))},t[d]=function(e){return this.dropzones?(0,s.closest)(e,this.dropzones):null},t[p]=function(){var e=this.options.dropzone;return"string"==typeof e?document.querySelectorAll(e):e instanceof NodeList||e instanceof Array?e:"function"==typeof e?e():[]},e}(i["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DroppableStopEvent=t.DroppableReturnedEvent=t.DroppableDroppedEvent=t.DroppableStartEvent=t.DroppableEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"dragEvent",get:function(){return this.data.dragEvent}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),r=((t.DroppableEvent=n).type="droppable",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"dropzone",get:function(){return this.data.dropzone}}]),t}(n)),r=((t.DroppableStartEvent=r).type="droppable:start",r.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"dropzone",get:function(){return this.data.dropzone}}]),t}(n)),r=((t.DroppableDroppedEvent=r).type="droppable:dropped",r.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"dropzone",get:function(){return this.data.dropzone}}]),t}(n)),r=((t.DroppableReturnedEvent=r).type="droppable:returned",r.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"dropzone",get:function(){return this.data.dropzone}}]),t}(n));(t.DroppableStopEvent=r).type="droppable:stop",r.cancelable=!0},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),n=(Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})}),n(32)),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){function e(){this.callbacks={}}var t=e.prototype;return t.on=function(e){this.callbacks[e]||(this.callbacks[e]=[]);for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return(e=this.callbacks[e]).push.apply(e,n),this},t.off=function(e,t){if(!this.callbacks[e])return null;for(var n=this.callbacks[e].slice(0),r=0;r<n.length;r++)t===n[r]&&this.callbacks[e].splice(r,1);return this},t.trigger=function(e){if(!this.callbacks[e.type])return null;for(var t=_(this.callbacks[e.type]),n=[],r=t.length-1;0<=r;r--){var i=t[r];try{i(e)}catch(o){n.push(o)}}return n.length&&console.error("Draggable caught errors while triggering '".concat(e.type,"'"),n),this},e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(35),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l=n(2),r=n(12),i=n(36),a=(i=i)&&i.__esModule?i:{"default":i},s=n(6),c=n(13),u=n(14);var h=Symbol("onDragStart"),d=Symbol("onDragMove"),p=Symbol("onDragStop"),f=Symbol("onDragPressure"),m={"drag:start":function(e){return"Picked up ".concat(e.source.textContent.trim()||e.source.id||"draggable element")},"drag:stop":function(e){return"Released ".concat(e.source.textContent.trim()||e.source.id||"draggable element")}},g={"container:dragging":"draggable-container--is-dragging","source:dragging":"draggable-source--is-dragging","source:placed":"draggable-source--placed","container:placed":"draggable-container--placed","body:dragging":"draggable--is-dragging","draggable:over":"draggable--over","container:over":"draggable-container--over","source:original":"draggable--original",mirror:"draggable-mirror"},b=t.defaultOptions={draggable:".draggable-source",handle:null,delay:100,placedTimeout:800,plugins:[],sensors:[]},i=function(){function r(){var t=this,e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[document.body],n=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{};if(e instanceof NodeList||e instanceof Array)this.containers=_(e);else{if(!(e instanceof HTMLElement))throw new Error("Draggable containers are expected to be of type `NodeList`, `HTMLElement[]` or `HTMLElement`");this.containers=[e]}this.options=o({},b,n,{classes:o({},g,n.classes||{}),announcements:o({},m,n.announcements||{})}),this.emitter=new a["default"],this.dragging=!1,this.plugins=[],this.sensors=[],this[h]=this[h].bind(this),this[d]=this[d].bind(this),this[p]=this[p].bind(this),this[f]=this[f].bind(this),document.addEventListener("drag:start",this[h],!0),document.addEventListener("drag:move",this[d],!0),document.addEventListener("drag:stop",this[p],!0),document.addEventListener("drag:pressure",this[f],!0);e=Object.values(r.Plugins).map(function(e){return e}),n=[s.MouseSensor,s.TouchSensor],this.addPlugin.apply(this,[].concat(_(e),_(this.options.plugins))),this.addSensor.apply(this,[].concat(n,_(this.options.sensors))),e=new c.DraggableInitializedEvent({draggable:this});this.on("mirror:created",function(e){e=e.mirror;return t.mirror=e}),this.on("mirror:destroy",function(){return t.mirror=null}),this.trigger(e)}var e=r.prototype;return e.destroy=function(){document.removeEventListener("drag:start",this[h],!0),document.removeEventListener("drag:move",this[d],!0),document.removeEventListener("drag:stop",this[p],!0),document.removeEventListener("drag:pressure",this[f],!0);var e=new c.DraggableDestroyEvent({draggable:this});this.trigger(e),this.removePlugin.apply(this,_(this.plugins.map(function(e){return e.constructor}))),this.removeSensor.apply(this,_(this.sensors.map(function(e){return e.constructor})))},e.addPlugin=function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=n.map(function(e){return new e(t)});return i.forEach(function(e){return e.attach()}),this.plugins=[].concat(_(this.plugins),_(i)),this},e.removePlugin=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.plugins.filter(function(e){return t.includes(e.constructor)}).forEach(function(e){return e.detach()}),this.plugins=this.plugins.filter(function(e){return!t.includes(e.constructor)}),this},e.addSensor=function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=n.map(function(e){return new e(t.containers,t.options)});return i.forEach(function(e){return e.attach()}),this.sensors=[].concat(_(this.sensors),_(i)),this},e.removeSensor=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sensors.filter(function(e){return t.includes(e.constructor)}).forEach(function(e){return e.detach()}),this.sensors=this.sensors.filter(function(e){return!t.includes(e.constructor)}),this},e.addContainer=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.containers=[].concat(_(this.containers),t),this.sensors.forEach(function(e){return e.addContainer.apply(e,t)}),this},e.removeContainer=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.containers=this.containers.filter(function(e){return!t.includes(e)}),this.sensors.forEach(function(e){return e.removeContainer.apply(e,t)}),this},e.on=function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=this.emitter).on.apply(t,[e].concat(r)),this},e.off=function(e,t){return this.emitter.off(e,t),this},e.trigger=function(e){return this.emitter.trigger(e),this},e.getClassNameFor=function(e){return this.options.classes[e]},e.isDragging=function(){return Boolean(this.dragging)},e.getDraggableElements=function(){var n=this;return this.containers.reduce(function(e,t){return[].concat(_(e),_(n.getDraggableElementsForContainer(t)))},[])},e.getDraggableElementsForContainer=function(e){var t=this;return _(e.querySelectorAll(this.options.draggable)).filter(function(e){return e!==t.originalSource&&e!==t.mirror})},e[h]=function(t){var n=this,e=y(t),r=e.target,i=e.container;this.containers.includes(i)&&((!this.options.handle||!r||(0,l.closest)(r,this.options.handle))&&(this.originalSource=(0,l.closest)(r,this.options.draggable),this.sourceContainer=i,this.originalSource)?(this.lastPlacedSource&&this.lastPlacedContainer&&(clearTimeout(this.placedTimeoutID),this.lastPlacedSource.classList.remove(this.getClassNameFor("source:placed")),this.lastPlacedContainer.classList.remove(this.getClassNameFor("container:placed"))),this.source=this.originalSource.cloneNode(!0),this.originalSource.parentNode.insertBefore(this.source,this.originalSource),this.originalSource.style.display="none",r=new u.DragStartEvent({source:this.source,originalSource:this.originalSource,sourceContainer:i,sensorEvent:e}),this.trigger(r),this.dragging=!r.canceled(),r.canceled()?(this.source.parentNode.removeChild(this.source),this.originalSource.style.display=null):(this.originalSource.classList.add(this.getClassNameFor("source:original")),this.source.classList.add(this.getClassNameFor("source:dragging")),this.sourceContainer.classList.add(this.getClassNameFor("container:dragging")),document.body.classList.add(this.getClassNameFor("body:dragging")),v(document.body,"none"),requestAnimationFrame(function(){var e=y(t).clone({target:n.source});n[d](o({},t,{detail:e}))}))):e.cancel())},e[d]=function(e){var t,n,r,i,o,a,s;this.dragging&&(t=(e=y(e)).container,n=e.target,o=new u.DragMoveEvent({source:this.source,originalSource:this.originalSource,sourceContainer:t,sensorEvent:e}),this.trigger(o),o.canceled()&&e.cancel(),n=(0,l.closest)(n,this.options.draggable),o=(0,l.closest)(e.target,this.containers),r=e.overContainer||o,a=this.currentOverContainer&&r!==this.currentOverContainer,s=this.currentOver&&n!==this.currentOver,i=r&&this.currentOverContainer!==r,o=o&&n&&this.currentOver!==n,s&&(s=new u.DragOutEvent({source:this.source,originalSource:this.originalSource,sourceContainer:t,sensorEvent:e,over:this.currentOver}),this.currentOver.classList.remove(this.getClassNameFor("draggable:over")),this.currentOver=null,this.trigger(s)),a&&(s=new u.DragOutContainerEvent({source:this.source,originalSource:this.originalSource,sourceContainer:t,sensorEvent:e,overContainer:this.currentOverContainer}),this.currentOverContainer.classList.remove(this.getClassNameFor("container:over")),this.currentOverContainer=null,this.trigger(s)),i&&(r.classList.add(this.getClassNameFor("container:over")),a=new u.DragOverContainerEvent({source:this.source,originalSource:this.originalSource,sourceContainer:t,sensorEvent:e,overContainer:r}),this.currentOverContainer=r,this.trigger(a)),o&&(n.classList.add(this.getClassNameFor("draggable:over")),s=new u.DragOverEvent({source:this.source,originalSource:this.originalSource,sourceContainer:t,sensorEvent:e,overContainer:r,over:n}),this.currentOver=n,this.trigger(s)))},e[p]=function(e){var t=this;this.dragging&&(this.dragging=!1,e=new u.DragStopEvent({source:this.source,originalSource:this.originalSource,sensorEvent:e.sensorEvent,sourceContainer:this.sourceContainer}),this.trigger(e),this.source.parentNode.insertBefore(this.originalSource,this.source),this.source.parentNode.removeChild(this.source),this.originalSource.style.display="",this.source.classList.remove(this.getClassNameFor("source:dragging")),this.originalSource.classList.remove(this.getClassNameFor("source:original")),this.originalSource.classList.add(this.getClassNameFor("source:placed")),this.sourceContainer.classList.add(this.getClassNameFor("container:placed")),this.sourceContainer.classList.remove(this.getClassNameFor("container:dragging")),document.body.classList.remove(this.getClassNameFor("body:dragging")),v(document.body,""),this.currentOver&&this.currentOver.classList.remove(this.getClassNameFor("draggable:over")),this.currentOverContainer&&this.currentOverContainer.classList.remove(this.getClassNameFor("container:over")),this.lastPlacedSource=this.originalSource,this.lastPlacedContainer=this.sourceContainer,this.placedTimeoutID=setTimeout(function(){t.lastPlacedSource&&t.lastPlacedSource.classList.remove(t.getClassNameFor("source:placed")),t.lastPlacedContainer&&t.lastPlacedContainer.classList.remove(t.getClassNameFor("container:placed")),t.lastPlacedSource=null,t.lastPlacedContainer=null},this.options.placedTimeout),this.source=null,this.originalSource=null,this.currentOverContainer=null,this.currentOver=null,this.sourceContainer=null)},e[f]=function(e){var t;this.dragging&&(e=y(e),t=this.source||(0,l.closest)(e.originalEvent.target,this.options.draggable),t=new u.DragPressureEvent({sensorEvent:e,source:t,pressure:e.pressure}),this.trigger(t))},r}();function y(e){return e.detail}function v(e,t){e.style.webkitUserSelect=t,e.style.mozUserSelect=t,e.style.msUserSelect=t,e.style.oUserSelect=t,e.style.userSelect=t}(t["default"]=i).Plugins={Announcement:r.Announcement,Focusable:r.Focusable,Mirror:r.Mirror,Scrollable:r.Scrollable}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),r=(r=r)&&r.__esModule?r:{"default":r},i=n(3);var o=Symbol("onMouseForceWillBegin"),a=Symbol("onMouseForceDown"),s=Symbol("onMouseDown"),l=Symbol("onMouseForceChange"),c=Symbol("onMouseMove"),u=Symbol("onMouseUp"),h=Symbol("onMouseForceGlobalChange"),n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,t)||this;return e.mightDrag=!1,e[o]=e[o].bind(x(e)),e[a]=e[a].bind(x(e)),e[s]=e[s].bind(x(e)),e[l]=e[l].bind(x(e)),e[c]=e[c].bind(x(e)),e[u]=e[u].bind(x(e)),e}E(e,n);var t=e.prototype;return t.attach=function(){var e,t=b(this.containers);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.addEventListener("webkitmouseforcewillbegin",this[o],!1),n.addEventListener("webkitmouseforcedown",this[a],!1),n.addEventListener("mousedown",this[s],!0),n.addEventListener("webkitmouseforcechanged",this[l],!1)}}catch(r){t.e(r)}finally{t.f()}document.addEventListener("mousemove",this[c]),document.addEventListener("mouseup",this[u])},t.detach=function(){var e,t=b(this.containers);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.removeEventListener("webkitmouseforcewillbegin",this[o],!1),n.removeEventListener("webkitmouseforcedown",this[a],!1),n.removeEventListener("mousedown",this[s],!0),n.removeEventListener("webkitmouseforcechanged",this[l],!1)}}catch(r){t.e(r)}finally{t.f()}document.removeEventListener("mousemove",this[c]),document.removeEventListener("mouseup",this[u])},t[o]=function(e){e.preventDefault(),this.mightDrag=!0},t[a]=function(e){var t,n;this.dragging||(n=document.elementFromPoint(e.clientX,e.clientY),t=e.currentTarget,n=new i.DragStartSensorEvent({clientX:e.clientX,clientY:e.clientY,target:n,container:t,originalEvent:e}),this.trigger(t,n),this.currentContainer=t,this.dragging=!n.canceled(),this.mightDrag=!1)},t[u]=function(e){this.dragging&&(e=new i.DragStopSensorEvent({clientX:e.clientX,clientY:e.clientY,target:null,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,e),this.currentContainer=null,this.dragging=!1,this.mightDrag=!1)},t[s]=function(e){this.mightDrag&&(e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault())},t[c]=function(e){var t;this.dragging&&(t=document.elementFromPoint(e.clientX,e.clientY),t=new i.DragMoveSensorEvent({clientX:e.clientX,clientY:e.clientY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,t))},t[l]=function(e){var t,n;this.dragging||(n=e.target,t=e.currentTarget,n=new i.DragPressureSensorEvent({pressure:e.webkitForce,clientX:e.clientX,clientY:e.clientY,target:n,container:t,originalEvent:e}),this.trigger(t,n))},t[h]=function(e){var t;this.dragging&&(t=e.target,t=new i.DragPressureSensorEvent({pressure:e.webkitForce,clientX:e.clientX,clientY:e.clientY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,t))},e}(r["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(38),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(4),r=(r=r)&&r.__esModule?r:{"default":r},o=n(3);var a=Symbol("onMouseDown"),s=Symbol("onMouseUp"),l=Symbol("onDragStart"),c=Symbol("onDragOver"),u=Symbol("onDragEnd"),h=Symbol("onDrop"),d=Symbol("reset"),n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,t)||this;return e.mouseDownTimeout=null,e.draggableElement=null,e.nativeDraggableElement=null,e[a]=e[a].bind(x(e)),e[s]=e[s].bind(x(e)),e[l]=e[l].bind(x(e)),e[c]=e[c].bind(x(e)),e[u]=e[u].bind(x(e)),e[h]=e[h].bind(x(e)),e}E(e,n);var t=e.prototype;return t.attach=function(){document.addEventListener("mousedown",this[a],!0)},t.detach=function(){document.removeEventListener("mousedown",this[a],!0)},t[l]=function(e){var t,n=this,r=(e.dataTransfer.setData("text",""),e.dataTransfer.effectAllowed=this.options.type,document.elementFromPoint(e.clientX,e.clientY));this.currentContainer=(0,i.closest)(e.target,this.containers),this.currentContainer&&(t=new o.DragStartSensorEvent({clientX:e.clientX,clientY:e.clientY,target:r,container:this.currentContainer,originalEvent:e}),setTimeout(function(){n.trigger(n.currentContainer,t),t.canceled()?n.dragging=!1:n.dragging=!0},0))},t[c]=function(e){var t,n;this.dragging&&(n=document.elementFromPoint(e.clientX,e.clientY),t=this.currentContainer,n=new o.DragMoveSensorEvent({clientX:e.clientX,clientY:e.clientY,target:n,container:t,originalEvent:e}),this.trigger(t,n),n.canceled()||(e.preventDefault(),e.dataTransfer.dropEffect=this.options.type))},t[u]=function(e){var t,n;this.dragging&&(document.removeEventListener("mouseup",this[s],!0),n=document.elementFromPoint(e.clientX,e.clientY),t=this.currentContainer,n=new o.DragStopSensorEvent({clientX:e.clientX,clientY:e.clientY,target:n,container:t,originalEvent:e}),this.trigger(t,n),this.dragging=!1,this[d]())},t[h]=function(e){e.preventDefault()},t[a]=function(e){var t,n,r=this;e.target&&(e.target.form||e.target.contenteditable)||((t=(0,i.closest)(e.target,function(e){return e.draggable}))&&(t.draggable=!1,this.nativeDraggableElement=t),document.addEventListener("mouseup",this[s],!0),document.addEventListener("dragstart",this[l],!1),document.addEventListener("dragover",this[c],!1),document.addEventListener("dragend",this[u],!1),document.addEventListener("drop",this[h],!1),(n=(0,i.closest)(e.target,this.options.draggable))&&(this.mouseDownTimeout=setTimeout(function(){n.draggable=!0,r.draggableElement=n},this.options.delay)))},t[s]=function(){this[d]()},t[d]=function(){clearTimeout(this.mouseDownTimeout),document.removeEventListener("mouseup",this[s],!0),document.removeEventListener("dragstart",this[l],!1),document.removeEventListener("dragover",this[c],!1),document.removeEventListener("dragend",this[u],!1),document.removeEventListener("drop",this[h],!1),this.nativeDraggableElement&&(this.nativeDraggableElement.draggable=!0,this.nativeDraggableElement=null),this.draggableElement&&(this.draggableElement.draggable=!1,this.draggableElement=null)},e}(r["default"]);t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(40),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(4),i=(i=i)&&i.__esModule?i:{"default":i},o=n(3);var a=Symbol("onTouchStart"),s=Symbol("onTouchHold"),l=Symbol("onTouchEnd"),c=Symbol("onTouchMove"),u=!1,n=(window.addEventListener("touchmove",function(e){u&&e.preventDefault()},{passive:!1}),function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,t)||this;return e.currentScrollableParent=null,e.tapTimeout=null,e.touchMoved=!1,e[a]=e[a].bind(x(e)),e[s]=e[s].bind(x(e)),e[l]=e[l].bind(x(e)),e[c]=e[c].bind(x(e)),e}E(e,n);var t=e.prototype;return t.attach=function(){document.addEventListener("touchstart",this[a])},t.detach=function(){document.removeEventListener("touchstart",this[a])},t[a]=function(e){var t=(0,r.closest)(e.target,this.containers);t&&(document.addEventListener("touchmove",this[c]),document.addEventListener("touchend",this[l]),document.addEventListener("touchcancel",this[l]),t.addEventListener("contextmenu",h),this.currentContainer=t,this.tapTimeout=setTimeout(this[s](e,t),this.options.delay))},t[s]=function(n,r){var i=this;return function(){var e,t;i.touchMoved||(t=n.touches[0]||n.changedTouches[0],e=n.target,t=new o.DragStartSensorEvent({clientX:t.pageX,clientY:t.pageY,target:e,container:r,originalEvent:n}),i.trigger(r,t),i.dragging=!t.canceled(),u=i.dragging)}},t[c]=function(e){var t,n;this.touchMoved=!0,this.dragging&&(n=e.touches[0]||e.changedTouches[0],t=document.elementFromPoint(n.pageX-window.scrollX,n.pageY-window.scrollY),n=new o.DragMoveSensorEvent({clientX:n.pageX,clientY:n.pageY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,n))},t[l]=function(e){var t,n;this.touchMoved=!1,u=!1,document.removeEventListener("touchend",this[l]),document.removeEventListener("touchcancel",this[l]),document.removeEventListener("touchmove",this[c]),this.currentContainer&&this.currentContainer.removeEventListener("contextmenu",h),clearTimeout(this.tapTimeout),this.dragging&&(n=e.touches[0]||e.changedTouches[0],t=document.elementFromPoint(n.pageX-window.scrollX,n.pageY-window.scrollY),e.preventDefault(),n=new o.DragStopSensorEvent({clientX:n.pageX,clientY:n.pageY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,n),this.currentContainer=null,this.dragging=!1)},e}(i["default"]));function h(e){e.preventDefault(),e.stopPropagation()}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(42),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DragPressureSensorEvent=t.DragStopSensorEvent=t.DragMoveSensorEvent=t.DragStartSensorEvent=t.SensorEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"originalEvent",get:function(){return this.data.originalEvent}},{key:"clientX",get:function(){return this.data.clientX}},{key:"clientY",get:function(){return this.data.clientY}},{key:"target",get:function(){return this.data.target}},{key:"container",get:function(){return this.data.container}},{key:"pressure",get:function(){return this.data.pressure}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),r=function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(t.SensorEvent=n),r=((t.DragStartSensorEvent=r).type="drag:start",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n)),r=((t.DragMoveSensorEvent=r).type="drag:move",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n)),r=((t.DragStopSensorEvent=r).type="drag:stop",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n));(t.DragPressureSensorEvent=r).type="drag:pressure"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),r=n(4),r=(r=r)&&r.__esModule?r:{"default":r},a=n(3);var s=Symbol("onContextMenuWhileDragging"),i=Symbol("onMouseDown"),l=Symbol("onMouseMove"),c=Symbol("onMouseUp"),n=function(n){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{},e=n.call(this,e,t)||this;return e.mouseDown=!1,e.mouseDownTimeout=null,e.openedContextMenu=!1,e[s]=e[s].bind(x(e)),e[i]=e[i].bind(x(e)),e[l]=e[l].bind(x(e)),e[c]=e[c].bind(x(e)),e}E(e,n);var t=e.prototype;return t.attach=function(){document.addEventListener("mousedown",this[i],!0)},t.detach=function(){document.removeEventListener("mousedown",this[i],!0)},t[i]=function(t){var n,r,i=this;0!==t.button||t.ctrlKey||t.metaKey||(document.addEventListener("mouseup",this[c]),n=document.elementFromPoint(t.clientX,t.clientY),(r=(0,o.closest)(n,this.containers))&&(document.addEventListener("dragstart",u),this.mouseDown=!0,clearTimeout(this.mouseDownTimeout),this.mouseDownTimeout=setTimeout(function(){var e;i.mouseDown&&(e=new a.DragStartSensorEvent({clientX:t.clientX,clientY:t.clientY,target:n,container:r,originalEvent:t}),i.trigger(r,e),i.currentContainer=r,i.dragging=!e.canceled(),i.dragging&&(document.addEventListener("contextmenu",i[s]),document.addEventListener("mousemove",i[l])))},this.options.delay)))},t[l]=function(e){var t;this.dragging&&(t=document.elementFromPoint(e.clientX,e.clientY),t=new a.DragMoveSensorEvent({clientX:e.clientX,clientY:e.clientY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,t))},t[c]=function(e){var t;this.mouseDown=Boolean(this.openedContextMenu),this.openedContextMenu?this.openedContextMenu=!1:(document.removeEventListener("mouseup",this[c]),document.removeEventListener("dragstart",u),this.dragging&&(t=document.elementFromPoint(e.clientX,e.clientY),t=new a.DragStopSensorEvent({clientX:e.clientX,clientY:e.clientY,target:t,container:this.currentContainer,originalEvent:e}),this.trigger(this.currentContainer,t),document.removeEventListener("contextmenu",this[s]),document.removeEventListener("mousemove",this[l]),this.currentContainer=null,this.dragging=!1))},t[s]=function(e){e.preventDefault(),this.openedContextMenu=!0},e}(r["default"]);function u(e){e.preventDefault()}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(45),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t["default"]=function(){function e(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:[],t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:{};this.containers=_(e),this.options=r({},t),this.dragging=!1,this.currentContainer=null}var t=e.prototype;return t.attach=function(){return this},t.detach=function(){return this},t.addContainer=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.containers=[].concat(_(this.containers),t)},t.removeContainer=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.containers=this.containers.filter(function(e){return!t.includes(e)})},t.trigger=function(e,t){var n=document.createEvent("Event");return n.detail=t,n.initEvent(t.type,!0,!0),e.dispatchEvent(n),this.lastEvent=t},e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){return requestAnimationFrame(function(){requestAnimationFrame(e)})}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(48),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e,t){if(e){var n=t,r=t,i=t,o=t,a=Boolean("string"==typeof t),s=Boolean("function"==typeof t),l=Boolean(t instanceof NodeList||t instanceof Array),c=Boolean(t instanceof HTMLElement),u=e;do{if(function(e){return e&&(a?h.call(e,n):l?_(i).includes(e):c?o===e:s&&r(e))}(u=u.correspondingUseElement||u.correspondingElement||u))return u}while((u=u.parentNode)&&u!==document.body&&u!==document)}return null};var h=Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(50),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=t.scroll=t.onDragStop=t.onDragMove=t.onDragStart=undefined;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=n(1),i=(i=i)&&i.__esModule?i:{"default":i},o=n(2);var a=t.onDragStart=Symbol("onDragStart"),s=t.onDragMove=Symbol("onDragMove"),l=t.onDragStop=Symbol("onDragStop"),c=t.scroll=Symbol("scroll"),u=t.defaultOptions={speed:6,sensitivity:50,scrollableElements:[]},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=r({},u,e.getOptions()),e.currentMousePosition=null,e.scrollAnimationFrame=null,e.scrollableElement=null,e.findScrollableElementFrame=null,e[a]=e[a].bind(x(e)),e[s]=e[s].bind(x(e)),e[l]=e[l].bind(x(e)),e[c]=e[c].bind(x(e)),e}E(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("drag:start",this[a]).on("drag:move",this[s]).on("drag:stop",this[l])},n.detach=function(){this.draggable.off("drag:start",this[a]).off("drag:move",this[s]).off("drag:stop",this[l])},n.getOptions=function(){return this.draggable.options.scrollable||{}},n.getScrollableElement=function(e){var t,n;return this.hasDefinedScrollableElements()?(0,o.closest)(e,this.options.scrollableElements)||document.documentElement:(e=e)&&(t=getComputedStyle(e).getPropertyValue("position"),n="absolute"===t,e=(0,o.closest)(e,function(e){return(!n||"static"!==getComputedStyle(e).getPropertyValue("position"))&&(e=e,e=(e=getComputedStyle(e,null)).getPropertyValue("overflow")+e.getPropertyValue("overflow-y")+e.getPropertyValue("overflow-x"),/(auto|scroll)/.test(e))}),"fixed"!==t&&e)?e:h()},n.hasDefinedScrollableElements=function(){return Boolean(0!==this.options.scrollableElements.length)},n[a]=function(e){var t=this;this.findScrollableElementFrame=requestAnimationFrame(function(){t.scrollableElement=t.getScrollableElement(e.source)})},n[s]=function(e){var t,n,r=this;this.findScrollableElementFrame=requestAnimationFrame(function(){r.scrollableElement=r.getScrollableElement(e.sensorEvent.target)}),this.scrollableElement&&(t=e.sensorEvent,n={x:0,y:0},"ontouchstart"in window&&(n.y=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n.x=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),this.currentMousePosition={clientX:t.clientX-n.x,clientY:t.clientY-n.y},this.scrollAnimationFrame=requestAnimationFrame(this[c]))},n[l]=function(){cancelAnimationFrame(this.scrollAnimationFrame),cancelAnimationFrame(this.findScrollableElementFrame),this.scrollableElement=null,this.scrollAnimationFrame=null,this.findScrollableElementFrame=null,this.currentMousePosition=null},n[c]=function(){var e,t,n,r,i,o,a,s,l;this.scrollableElement&&this.currentMousePosition&&(cancelAnimationFrame(this.scrollAnimationFrame),e=(t=this.options).speed,t=t.sensitivity,s=(n=this.scrollableElement.getBoundingClientRect()).bottom>window.innerHeight,l=n.top<0,r=h(),i=this.scrollableElement,o=this.currentMousePosition.clientX,a=this.currentMousePosition.clientY,i===document.body||i===document.documentElement||(l||s)?(s=(l=window).innerHeight,l=l.innerWidth,a<t?r.scrollTop-=e:s-a<t&&(r.scrollTop+=e),o<t?r.scrollLeft-=e:l-o<t&&(r.scrollLeft+=e)):(s=i.offsetHeight,l=i.offsetWidth,n.top+s-a<t?i.scrollTop+=e:a-n.top<t&&(i.scrollTop-=e),n.left+l-o<t?i.scrollLeft+=e:o-n.left<t&&(i.scrollLeft-=e)),this.scrollAnimationFrame=requestAnimationFrame(this[c]))},e}(i["default"]);function h(){return document.scrollingElement||document.documentElement}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var n=n(52),r=(r=n)&&r.__esModule?r:{"default":r};t["default"]=r["default"],t.defaultOptions=n.defaultOptions},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MirrorDestroyEvent=t.MirrorMoveEvent=t.MirrorAttachedEvent=t.MirrorCreatedEvent=t.MirrorCreateEvent=t.MirrorEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"source",get:function(){return this.data.source}},{key:"originalSource",get:function(){return this.data.originalSource}},{key:"sourceContainer",get:function(){return this.data.sourceContainer}},{key:"sensorEvent",get:function(){return this.data.sensorEvent}},{key:"dragEvent",get:function(){return this.data.dragEvent}},{key:"originalEvent",get:function(){return this.sensorEvent?this.sensorEvent.originalEvent:null}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),r=function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(t.MirrorEvent=n),r=((t.MirrorCreateEvent=r).type="mirror:create",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"mirror",get:function(){return this.data.mirror}}]),t}(n)),r=((t.MirrorCreatedEvent=r).type="mirror:created",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"mirror",get:function(){return this.data.mirror}}]),t}(n)),r=((t.MirrorAttachedEvent=r).type="mirror:attached",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"mirror",get:function(){return this.data.mirror}}]),t}(n)),r=((t.MirrorMoveEvent=r).type="mirror:move",r.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"mirror",get:function(){return this.data.mirror}}]),t}(n));(t.MirrorDestroyEvent=r).type="mirror:destroy",r.cancelable=!0},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(54);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=t.getAppendableContainer=t.onScroll=t.onMirrorMove=t.onMirrorCreated=t.onDragStop=t.onDragMove=t.onDragStart=undefined;var p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},r=n(1),r=(r=r)&&r.__esModule?r:{"default":r},s=n(55);function f(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var i=t.onDragStart=Symbol("onDragStart"),o=t.onDragMove=Symbol("onDragMove"),a=t.onDragStop=Symbol("onDragStop"),l=t.onMirrorCreated=Symbol("onMirrorCreated"),c=t.onMirrorMove=Symbol("onMirrorMove"),u=t.onScroll=Symbol("onScroll"),h=t.getAppendableContainer=Symbol("getAppendableContainer"),d=t.defaultOptions={constrainDimensions:!1,xAxis:!0,yAxis:!0,cursorOffsetX:null,cursorOffsetY:null},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=p({},d,e.getOptions()),e.scrollOffset={x:0,y:0},e.initialScrollOffset={x:window.scrollX,y:window.scrollY},e[i]=e[i].bind(x(e)),e[o]=e[o].bind(x(e)),e[a]=e[a].bind(x(e)),e[l]=e[l].bind(x(e)),e[c]=e[c].bind(x(e)),e[u]=e[u].bind(x(e)),e}E(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("drag:start",this[i]).on("drag:move",this[o]).on("drag:stop",this[a]).on("mirror:created",this[l]).on("mirror:move",this[c])},n.detach=function(){this.draggable.off("drag:start",this[i]).off("drag:move",this[o]).off("drag:stop",this[a]).off("mirror:created",this[l]).off("mirror:move",this[c])},n.getOptions=function(){return this.draggable.options.mirror||{}},n[i]=function(e){var t,n,r,i,o,a;e.canceled()||("ontouchstart"in window&&document.addEventListener("scroll",this[u],!0),this.initialScrollOffset={x:window.scrollX,y:window.scrollY},a=e.source,t=e.originalSource,n=e.sourceContainer,r=e.sensorEvent,i=new s.MirrorCreateEvent({source:a,originalSource:t,sourceContainer:n,sensorEvent:r,dragEvent:e}),this.draggable.trigger(i),/^drag/.test(r.originalEvent.type)||i.canceled()||(i=this[h](a)||n,this.mirror=a.cloneNode(!0),o=new s.MirrorCreatedEvent({source:a,originalSource:t,sourceContainer:n,sensorEvent:r,dragEvent:e,mirror:this.mirror}),a=new s.MirrorAttachedEvent({source:a,originalSource:t,sourceContainer:n,sensorEvent:r,dragEvent:e,mirror:this.mirror}),this.draggable.trigger(o),i.appendChild(this.mirror),this.draggable.trigger(a)))},n[o]=function(e){var t,n,r,i;this.mirror&&!e.canceled()&&(i=e.source,t=e.originalSource,n=e.sourceContainer,r=e.sensorEvent,i=new s.MirrorMoveEvent({source:i,originalSource:t,sourceContainer:n,sensorEvent:r,dragEvent:e,mirror:this.mirror}),this.draggable.trigger(i))},n[a]=function(e){var t,n,r;"ontouchstart"in window&&document.removeEventListener("scroll",this[u],!0),this.initialScrollOffset={x:0,y:0},this.scrollOffset={x:0,y:0},this.mirror&&(r=e.source,t=e.sourceContainer,n=e.sensorEvent,r=new s.MirrorDestroyEvent({source:r,mirror:this.mirror,sourceContainer:t,sensorEvent:n,dragEvent:e}),this.draggable.trigger(r),r.canceled()||this.mirror.parentNode.removeChild(this.mirror))},n[u]=function(){this.scrollOffset={x:window.scrollX-this.initialScrollOffset.x,y:window.scrollY-this.initialScrollOffset.y}},n[l]=function(e){var i=this,o=function o(e){var t=e.mirrorOffset,n=e.initialX,r=e.initialY,e=f(e,["mirrorOffset","initialX","initialY"]);return i.mirrorOffset=t,i.initialX=n,i.initialY=r,p({mirrorOffset:t,initialX:n,initialY:r},e)},e={mirror:e.mirror,source:e.source,sensorEvent:e.sensorEvent,mirrorClass:this.draggable.getClassNameFor("mirror"),scrollOffset:this.scrollOffset,options:this.options};return Promise.resolve(e).then(m).then(g).then(b).then(y).then(_({initial:!0})).then(v).then(o)},n[c]=function(e){return e.canceled()?null:(e={mirror:e.mirror,sensorEvent:e.sensorEvent,mirrorOffset:this.mirrorOffset,options:this.options,initialX:this.initialX,initialY:this.initialY,scrollOffset:this.scrollOffset},Promise.resolve(e).then(_({raf:!0})))},n[h]=function(e){var t=this.options.appendTo;return"string"==typeof t?document.querySelector(t):t instanceof HTMLElement?t:"function"==typeof t?t(e):e.parentNode},e}(r["default"]);function m(e){var n=e.source,r=f(e,["source"]);return I(function(e){var t=n.getBoundingClientRect();e(p({source:n,sourceRect:t},r))})}function g(e){var r=e.sensorEvent,i=e.sourceRect,o=e.options,a=f(e,["sensorEvent","sourceRect","options"]);return I(function(e){var t=null===o.cursorOffsetY?r.clientY-i.top:o.cursorOffsetY,n=null===o.cursorOffsetX?r.clientX-i.left:o.cursorOffsetX;e(p({sensorEvent:r,sourceRect:i,mirrorOffset:{top:t,left:n},options:o},a))})}function b(e){var r=e.mirror,i=e.source,o=e.options,a=f(e,["mirror","source","options"]);return I(function(e){var t,n;o.constrainDimensions&&(t=(n=getComputedStyle(i)).getPropertyValue("height"),n=n.getPropertyValue("width")),r.style.position="fixed",r.style.pointerEvents="none",r.style.top=0,r.style.left=0,r.style.margin=0,o.constrainDimensions&&(r.style.height=t,r.style.width=n),e(p({mirror:r,source:i,options:o},a))})}function y(e){var t=e.mirror,n=e.mirrorClass,r=f(e,["mirror","mirrorClass"]);return I(function(e){t.classList.add(n),e(p({mirror:t,mirrorClass:n},r))})}function v(e){var t=e.mirror,n=f(e,["mirror"]);return I(function(e){t.removeAttribute("id"),delete t.id,e(p({mirror:t},n))})}function _(e){var e=0<arguments.length&&e!==undefined?e:{},t=e.withFrame,n=void 0!==t&&t,t=e.initial,d=void 0!==t&&t;return function(e){var i=e.mirror,o=e.sensorEvent,a=e.mirrorOffset,s=e.initialY,l=e.initialX,c=e.scrollOffset,u=e.options,h=f(e,["mirror","sensorEvent","mirrorOffset","initialY","initialX","scrollOffset","options"]);return I(function(e){var t,n,r=p({mirror:i,sensorEvent:o,mirrorOffset:a,options:u},h);a&&(t=o.clientX-a.left-c.x,n=o.clientY-a.top-c.y,u.xAxis&&u.yAxis||d?i.style.transform="translate3d(".concat(t,"px, ").concat(n,"px, 0)"):u.xAxis&&!u.yAxis?i.style.transform="translate3d(".concat(t,"px, ").concat(s,"px, 0)"):u.yAxis&&!u.xAxis&&(i.style.transform="translate3d(".concat(l,"px, ").concat(n,"px, 0)")),d&&(r.initialX=t,r.initialY=n)),e(r)},{frame:n})}}function I(n,e){var e=(1<arguments.length&&e!==undefined?e:{}).raf,r=void 0!==e&&e;return new Promise(function(e,t){r?requestAnimationFrame(function(){n(e,t)}):n(e,t)})}t["default"]=n},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var n=n(56),r=(r=n)&&r.__esModule?r:{"default":r};t["default"]=r["default"],t.defaultOptions=n.defaultOptions},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n=n(1),n=(n=n)&&n.__esModule?n:{"default":n};var i=Symbol("onInitialize"),o=Symbol("onDestroy"),a={},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=r({},a,e.getOptions()),e[i]=e[i].bind(x(e)),e[o]=e[o].bind(x(e)),e}E(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("draggable:initialize",this[i]).on("draggable:destroy",this[o])},n.detach=function(){this.draggable.off("draggable:initialize",this[i]).off("draggable:destroy",this[o])},n.getOptions=function(){return this.draggable.options.focusable||{}},n.getElements=function(){return[].concat(_(this.draggable.containers),_(this.draggable.getDraggableElements()))},n[i]=function(){var e=this;requestAnimationFrame(function(){e.getElements().forEach(function(e){e=e,Boolean(!e.getAttribute("tabindex")&&-1===e.tabIndex)&&(s.push(e),e.tabIndex=0)})})},n[o]=function(){var e=this;requestAnimationFrame(function(){e.getElements().forEach(function(e){var t;e=e,-1!==(t=s.indexOf(e))&&(e.tabIndex=-1,s.splice(t,1))})})},e}(n["default"]),s=(t["default"]=n,[])},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var n=n(58),n=(n=n)&&n.__esModule?n:{"default":n};t["default"]=n["default"]},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){function e(e){this.draggable=e}var t=e.prototype;return t.attach=function(){throw new Error("Not Implemented")},t.detach=function(){throw new Error("Not Implemented")},e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n=n(1),n=(n=n)&&n.__esModule?n:{"default":n};var i=Symbol("onInitialize"),o=Symbol("onDestroy"),a=Symbol("announceEvent"),s=Symbol("announceMessage"),l=t.defaultOptions={expire:7e3},n=function(t){function e(e){e=t.call(this,e)||this;return e.options=r({},l,e.getOptions()),e.originalTriggerMethod=e.draggable.trigger,e[i]=e[i].bind(x(e)),e[o]=e[o].bind(x(e)),e}E(e,t);var n=e.prototype;return n.attach=function(){this.draggable.on("draggable:initialize",this[i])},n.detach=function(){this.draggable.off("draggable:destroy",this[o])},n.getOptions=function(){return this.draggable.options.announcements||{}},n[a]=function(e){var t=this.options[e.type];t&&"string"==typeof t&&this[s](t),t&&"function"==typeof t&&this[s](t(e))},n[s]=function(e){var t,n;e=e,t=(t={expire:this.options.expire}).expire,(n=document.createElement("div")).textContent=e,c.appendChild(n),setTimeout(function(){c.removeChild(n)},t)},n[i]=function(){var t=this;this.draggable.trigger=function(e){try{t[a](e)}finally{t.originalTriggerMethod.call(t.draggable,e)}}},n[o]=function(){this.draggable.trigger=this.originalTriggerMethod},e}(n["default"]),c=(t["default"]=n,(t=document.createElement("div")).setAttribute("id","draggable-live-region"),t.setAttribute("aria-relevant","additions"),t.setAttribute("aria-atomic","true"),t.setAttribute("aria-live","assertive"),t.setAttribute("role","log"),t.style.position="fixed",t.style.width="1px",t.style.height="1px",t.style.top="-1px",t.style.overflow="hidden",t);document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(c)})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOptions=undefined;var n=n(61),r=(r=n)&&r.__esModule?r:{"default":r};t["default"]=r["default"],t.defaultOptions=n.defaultOptions},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DraggableDestroyEvent=t.DraggableInitializedEvent=t.DraggableEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"draggable",get:function(){return this.data.draggable}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),r=((t.DraggableEvent=n).type="draggable",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n)),r=((t.DraggableInitializedEvent=r).type="draggable:initialize",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n));(t.DraggableDestroyEvent=r).type="draggable:destroy"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=Symbol("canceled"),o=function(){function e(e){this[i]=!1,this.data=e}var t=e.prototype;return t.cancel=function(){this[i]=!0},t.canceled=function(){return Boolean(this[i])},t.clone=function(e){return new this.constructor(r({},this.data,e))},a(e,[{key:"type",get:function(){return this.constructor.type}},{key:"cancelable",get:function(){return this.constructor.cancelable}}]),e}();(t["default"]=o).type="event",o.cancelable=!1},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DragStopEvent=t.DragPressureEvent=t.DragOutContainerEvent=t.DragOverContainerEvent=t.DragOutEvent=t.DragOverEvent=t.DragMoveEvent=t.DragStartEvent=t.DragEvent=undefined;var n=n(0);var n=function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"source",get:function(){return this.data.source}},{key:"originalSource",get:function(){return this.data.originalSource}},{key:"mirror",get:function(){return this.data.mirror}},{key:"sourceContainer",get:function(){return this.data.sourceContainer}},{key:"sensorEvent",get:function(){return this.data.sensorEvent}},{key:"originalEvent",get:function(){return this.sensorEvent?this.sensorEvent.originalEvent:null}}]),t}(((n=n)&&n.__esModule?n:{"default":n})["default"]),r=((t.DragEvent=n).type="drag",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n)),r=((t.DragStartEvent=r).type="drag:start",r.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n)),r=((t.DragMoveEvent=r).type="drag:move",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"overContainer",get:function(){return this.data.overContainer}},{key:"over",get:function(){return this.data.over}}]),t}(n)),r=((t.DragOverEvent=r).type="drag:over",r.cancelable=!0,function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"overContainer",get:function(){return this.data.overContainer}},{key:"over",get:function(){return this.data.over}}]),t}(n)),r=((t.DragOutEvent=r).type="drag:out",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"overContainer",get:function(){return this.data.overContainer}}]),t}(n)),r=((t.DragOverContainerEvent=r).type="drag:over:container",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"overContainer",get:function(){return this.data.overContainer}}]),t}(n)),r=((t.DragOutContainerEvent=r).type="drag:out:container",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),a(t,[{key:"pressure",get:function(){return this.data.pressure}}]),t}(n)),r=((t.DragPressureEvent=r).type="drag:pressure",function(e){function t(){return e.apply(this,arguments)||this}return E(t,e),t}(n));(t.DragStopEvent=r).type="drag:stop"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Plugins=t.Sensors=t.Sortable=t.Swappable=t.Droppable=t.Draggable=t.BasePlugin=t.BaseEvent=undefined;var r=n(5),i=(Object.defineProperty(t,"Draggable",{enumerable:!0,get:function(){return h(r)["default"]}}),n(34)),o=(Object.defineProperty(t,"Droppable",{enumerable:!0,get:function(){return h(i)["default"]}}),n(31)),a=(Object.defineProperty(t,"Swappable",{enumerable:!0,get:function(){return h(o)["default"]}}),n(28)),s=(Object.defineProperty(t,"Sortable",{enumerable:!0,get:function(){return h(a)["default"]}}),n(0)),s=h(s),l=h(n(1)),c=u(n(6)),n=u(n(25));function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function h(e){return e&&e.__esModule?e:{"default":e}}t.BaseEvent=s["default"],t.BasePlugin=l["default"],t.Sensors=c,t.Plugins=n}],r={},i.m=n,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===o(t)&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=66);function i(e){var t;return(r[e]||(t=r[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,i),t.l=!0,t)).exports}var n,r},"object"===o(n)&&"object"===o(e)?e.exports=t():(t="function"==typeof(t=t)?t.apply(n,[]):t)!==undefined&&(e.exports=t)}.call(this,t(44)(e))},function(e,t,n){"use strict";var r=n(28),i=n(305),o=n(306),a=n(307),s=n(309),n=n(322);BI.extend(BI,{FormulaInserter:r.FormulaInserter,ComplexFormulaInserter:i.ComplexFormulaInserter,RegularFormulaInserter:o.RegularFormulaInserter,FormulaOpeartingPanel:a.FormulaOpeartingPanel,ParameterEditor:s.ParameterEditor,initSocket:n.initSocket})},function(e,t){e.exports=BI.CodeMirror},function(e,t,n){"use strict";function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function o(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}Object.defineProperty(t,"__esModule",{value:!0});n=(t.FormulaFunctionItem=void 0,n(1).shortcut)()((n=function(i){var e,t;function n(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return o(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e=i.call.apply(i,[this].concat(n))||this),"props",{baseCls:"bi-list-item-select",text:"",title:"",value:""}),e}return t=i,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.render=function(){var r=this;return{type:BI.TextButton.xtype,text:this.options.text,value:this.options.value,trigger:"dblclick",textAlign:"left",hgap:5,handler:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.fireEvent.apply(r,[BI.Controller.EVENT_CHANGE,BI.Events.CLICK].concat(t))}}},n}(BI.BasicButton),o(n,"xtype","bi.formula.function_item"),n=n))||n;t.FormulaFunctionItem=n},function(e,t,n){"use strict";function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}Object.defineProperty(t,"__esModule",{value:!0});n=(t.FormulaVarItem=void 0,n(1).shortcut)()((n=function(i){var e;function t(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return a(o(e=i.call.apply(i,[this].concat(n))||this),"leaf",void 0),a(o(e),"props",{text:"",title:"",value:"",layoutType:BI.MidTreeLeafItem.xtype}),e}e=i,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.render=function(){var r=this;return{type:BI.HTapeLayout.xtype,items:[{type:BI.Label.xtype,width:16},{type:this.options.layoutType,cls:"bi-list-item-select",ref:function(e){r.leaf=e},text:this.options.text,value:this.options.value,trigger:"dblclick",textAlign:"left",handler:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.fireEvent.apply(r,[BI.Controller.EVENT_CHANGE,BI.Events.CLICK].concat(t))}}]}},n.setSelected=function(e){i.prototype.setSelected.call(this,e),this.leaf.setSelected(e)},t}(BI.BasicButton),a(n,"xtype","bi.formula.var_item"),n=n))||n;t.FormulaVarItem=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComplexFormulaInserter=void 0;var r=n(28);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}n=(0,n(1).shortcut)()((n=function(i){var e;function t(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return a(o(e=i.call.apply(i,[this].concat(n))||this),"props",{value:{formula:"",keepFormulaWhenExportOrEdit:!1,keepFormulaWhenReportOrAnalyze:!0}}),a(o(e),"exportOrEditCheckbox",void 0),a(o(e),"reportOrAnalyzeCheckbox",void 0),e}e=i,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.getToolbarLayout=function(){var t=this;return{type:BI.VerticalAdaptLayout.xtype,items:[{type:BI.MultiSelectItem.xtype,ref:function(e){t.exportOrEditCheckbox=e},width:180,lgap:10,text:BI.i18nText("BI-Basic_Export_Or_Edit_Keep_Formula"),selected:this.options.value.keepFormulaWhenExportOrEdit,listeners:[{eventName:BI.MultiSelectItem.EVENT_CHANGE,action:function(){t.exportOrEditCheckbox.isSelected()?(t.reportOrAnalyzeCheckbox.setEnable(!1),t.reportOrAnalyzeCheckbox.setSelected(!0)):t.reportOrAnalyzeCheckbox.setEnable(!0)}}]},{type:BI.MultiSelectItem.xtype,ref:function(e){t.reportOrAnalyzeCheckbox=e},width:220,lgap:10,text:BI.i18nText("BI-Basic_Report_Or_Analyze_Keep_Formula"),disabled:this.options.value.keepFormulaWhenExportOrEdit,selected:this.options.value.keepFormulaWhenReportOrAnalyze},{type:BI.Button.xtype,text:BI.i18nText("BI-Basic_Check_Validation"),handler:function(){t.validate()}}]}},n.getValue=function(){return{formula:this.formulaEditor.getValue(),keepFormulaWhenExportOrEdit:this.exportOrEditCheckbox.isSelected(),keepFormulaWhenReportOrAnalyze:this.reportOrAnalyzeCheckbox.isSelected()}},t}(r.FormulaInserter),a(n,"xtype","bi.formula_operating_panel.complex.inserter"),r=n))||r;t.ComplexFormulaInserter=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RegularFormulaInserter=void 0;var r=n(28);function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}var i,o=(0,n(1).shortcut)()((n=function(e){var t,n;function r(){return e.apply(this,arguments)||this}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,l(t,n),r.prototype.getToolbarLayout=function(){var e=this;return{type:BI.AbsoluteLayout.xtype,items:[{el:{type:BI.Button.xtype,text:BI.i18nText("BI-Basic_Check_Validation"),handler:function(){e.validate()}},right:93,top:12}]}},r}(r.FormulaInserter),r="bi.formula_operating_panel.regular.inserter",(i="xtype")in(o=n)?Object.defineProperty(o,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[i]=r,i=n))||i;t.RegularFormulaInserter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FormulaOpeartingPanel=void 0;var r=n(1),a=n(45),i=n(308),s=n(28),l=n(46);function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function u(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function h(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}i=(0,r.shortcut)()(r=(0,r.store)(i.FormulaModel)((n=function(o){var e;function t(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return h(c(t=o.call.apply(o,[this].concat(n))||this),"functionTypeGroup",void 0),h(c(t),"functionNameGroup",void 0),h(c(t),"model",void 0),h(c(t),"store",void 0),h(c(t),"descriptionLabel",void 0),h(c(t),"searchEditor",void 0),h(c(t),"relatedFunctionNameGroup",void 0),h(c(t),"formulaEditor",void 0),h(c(t),"varTree",void 0),h(c(t),"props",{inserterType:s.FormulaInserter.xtype,value:{formula:""},configLoader:function(){return new Promise(function(e){e({vars:[],JSONs:[]})})}}),h(c(t),"watch",{functionNames:function(){t.functionNameGroup.populate(t.model.functionNames),t.scrollFunctionName2View()},selectedFunctionNameOrVarName:function(){(0,a.isBelong2FormulaFunction)(t.model.selectedFunctionNameOrVarName)&&(t.functionNameGroup.setValue(t.model.selectedFunctionNameOrVarName),t.scrollFunctionName2View())},selectedFunctionType:function(){t.functionTypeGroup.setValue(t.model.selectedFunctionType),t.functionNameGroup.setValue(t.model.selectedFunctionNameOrVarName)},functionDescription:function(){t.descriptionLabel.setText(t.model.functionDescription)},relatedFunctionNames:function i(){var i=t.model.relatedFunctionNames,e=(t.relatedFunctionNameGroup.populate(i),BI.isEmptyArray(i)?null:BI.first(i).value);t.relatedFunctionNameGroup.setValue(e),e&&t.store.setSelectedFunctionName(e)},isCached:function(){t.functionTypeGroup.populate((0,a.transformFormulaJSONs2FunctionTypes)()),t.functionTypeGroup.setValue(t.model.selectedFunctionType),t.functionNameGroup.setValue(t.model.selectedFunctionNameOrVarName),t.varTree.populate((0,a.transformFormulaVarItems)())}}),t}e=o,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,u(n,e);var n=t.prototype;return n.render=function(){var i=this;return{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.LeftRightVerticalAdaptLayout.xtype,items:{left:[{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Please_Input_Formula")}],right:[{type:BI.SearchEditor.xtype,ref:function(e){i.searchEditor=e},width:194,listeners:[{eventName:BI.SearchEditor.EVENT_ENTER,action:function(){i.store.setKeyword(i.searchEditor.getValue())}},{eventName:BI.SearchEditor.EVENT_EMPTY,action:function(){i.store.setKeyword("")}}]},{lgap:5,el:{type:BI.Button.xtype,text:BI.i18nText("BI-Basic_Search"),minWidth:0,width:54,handler:function(){i.store.setKeyword(i.searchEditor.getValue())}}}]}},height:24},{el:{type:BI.HTapeLayout.xtype,items:[{type:this.options.inserterType,ref:function(e){i.formulaEditor=e},value:this.options.value,rgap:10,listeners:[{eventName:"EVENT_SHOW_HINT",action:function(e){i.store.setSelectedFunctionName(e),i.scrollFunctionName2View()}},{eventName:"EVENT_SELECT_HINT",action:function(e){i.store.setSelectedFunctionName(e),i.scrollFunctionName2View()}}]},{el:{type:BI.ButtonGroup.xtype,ref:function(e){i.relatedFunctionNameGroup=e},cls:"bi-border",items:this.model.relatedFunctionNames,layouts:[{type:BI.VerticalLayout.xtype}],listeners:[{eventName:BI.ButtonGroup.EVENT_CHANGE,action:function(e){i.store.setSelectedFunctionName(e)}}]},width:253}]},height:200,tgap:10},{type:BI.HTapeLayout.xtype,items:[{el:{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Function_Type"),textAlign:"left"},height:24},{type:BI.ButtonGroup.xtype,ref:function(e){i.functionTypeGroup=e},value:this.model.selectedFunctionType,cls:"bi-border",items:(0,a.transformFormulaJSONs2FunctionTypes)(),layouts:[{type:BI.VerticalLayout.xtype}],listeners:[{eventName:BI.ButtonGroup.EVENT_CHANGE,action:function(e){i.store.setSelectedFunctionType(e)}}]}]},width:135},{el:{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Function_Name"),textAlign:"left"},height:24},{type:BI.ButtonGroup.xtype,ref:function(e){i.functionNameGroup=e},value:this.model.selectedFunctionNameOrVarName,cls:"bi-border",items:this.model.functionNames,layouts:[{type:BI.VerticalLayout.xtype}],listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(e,t,n,r){i.store.setSelectedFunctionName(t,!1),"dblclick"===r.type&&i.formulaEditor.insertFunction(t)}}]}]},lgap:5,width:135},{el:{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Vars"),textAlign:"left"},height:24},{type:BI.CustomTree.xtype,cls:"bi-border",chooseType:BI.Selection.Single,ref:function(e){i.varTree=e},el:{type:BI.ButtonTree.xtype,layouts:[{type:BI.VerticalLayout.xtype}]},items:(0,a.transformFormulaVarItems)(),listeners:[{eventName:BI.Controller.EVENT_CHANGE,action:function(e,t,n,r){e===BI.Events.CLICK&&(i.store.setSelectedVarName(t),r&&"dblclick"===r.type&&i.formulaEditor.insertField(t))}}]}]},lgap:5,width:300},{el:{type:BI.VTapeLayout.xtype,items:[{el:{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Function_Description"),textAlign:"left"},height:24},{type:BI.VerticalLayout.xtype,cls:"bi-border",items:[{el:{type:BI.Text.xtype,ref:function(e){i.descriptionLabel=e},text:this.model.functionDescription,whiteSpace:"normal",hgap:5}}]}]},lgap:5}]}]}},n.beforeRender=function(t){var n=this;(0,a.isFormulaConfigCached)()?t():(this.loading(),this.options.configLoader().then(function(e){n.loaded(),(0,a.setFormulaConfigCache)(e),n.store.setSelectedFunctionName(l.DEFAULT_FUNCTION_NAME),t()}))},n.scrollFunctionName2View=function(){var e,t=this;this.model.needScrollToView&&(e=this.functionNameGroup.getAllButtons().find(function(e){return e.getValue()===t.model.selectedFunctionNameOrVarName}),BI.isNull(e)||e.element[0].scrollIntoView())},n.getValue=function(){return this.formulaEditor.getValue()},n.loadConfigData=function(e){(0,a.isFormulaConfigCached)()||((0,a.setFormulaConfigCache)(e),this.store.setSelectedFunctionName(l.DEFAULT_FUNCTION_NAME))},t}(BI.Pane),h(n,"xtype","bi.formula_operating_panel"),r=n))||r)||r;t.FormulaOpeartingPanel=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FormulaModel=void 0;var r=n(1),o=n(45),a=n(46);function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function c(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}n=(0,r.model)()((n=function(i){var e,t;function n(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return c(s(r=i.call.apply(i,[this].concat(t))||this),"computed",{functionNames:function(){return(0,o.transformFormulaJSONs2FunctionNames)(r.model.selectedFunctionType)},functionDescription:function(){return(0,o.getFunctionDescriptionByFunctionName)(r.model.selectedFunctionNameOrVarName)||(0,o.getVarDescriptionByVarName)(r.model.selectedFunctionNameOrVarName)},relatedFunctionNames:function(){return(0,o.getSearchedFunctionNames)(r.model.keyword)}}),c(s(r),"actions",{setSelectedFunctionType:function(e){r.model.selectedFunctionType=e,r.model.selectedFunctionNameOrVarName=(BI.first((0,o.transformFormulaJSONs2FunctionNames)(r.model.selectedFunctionType))||{}).value},setSelectedFunctionName:function(e){var t=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],e=e.toUpperCase(),n=(0,o.getFunctionTypeByFunctionName)(e);BI.isNull(n)||(r.model.selectedFunctionType=n,r.model.selectedFunctionNameOrVarName=e,r.model.needScrollToView=t)},setKeyword:function(e){r.model.keyword=e},setSelectedVarName:function(e){r.model.selectedFunctionNameOrVarName=e}}),r}return t=i,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.state=function(){return{selectedFunctionType:(0,o.getFunctionTypeByFunctionName)(a.DEFAULT_FUNCTION_NAME)||a.DEFAULT_FUNCTION_TYPE,selectedFunctionNameOrVarName:a.DEFAULT_FUNCTION_NAME,keyword:"",needScrollToView:!0}},n}(r.Model),c(n,"xtype","bi.model.formula_operating_panel"),r=n))||r;t.FormulaModel=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterEditor=void 0;var r=n(1),i=n(310),o=n(311),a=n(321),s=n(110);function l(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){var n;if(e)return"string"==typeof e?c(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach(function(e){f(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function p(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function f(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}i=(0,r.shortcut)()(r=(0,r.store)(i.ParameterModel)((n=function(i){var e;function t(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return f(d(t=i.call.apply(i,[this].concat(n))||this),"props",{height:200,title:"",headers:s.defaultHeaderItems,value:[]}),f(d(t),"parameterInputs",void 0),f(d(t),"model",void 0),f(d(t),"store",void 0),f(d(t),"watch",{parameters:function(){t.parameterInputs.populate(t.renderParameterInputs())},selectedId:function(e){t.parameterInputs.setValue(e)}}),t}e=i,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,p(n,e);var n=t.prototype;return n.render=function(){var t=this;return this.setDefaultValue(),{type:BI.VTapeLayout.xtype,items:[{el:this.renderHeader(),height:25},{el:{type:BI.CenterLayout.xtype,cls:"bi-border",items:[{type:BI.Label.xtype,text:BI.i18nText("BI-Basic_Parameter_Name")},{type:BI.Label.xtype,cls:"bi-border-left",text:BI.i18nText("BI-Basic_Parameter_Value")}]},height:25},{type:BI.ButtonGroup.xtype,cls:"bi-border",layouts:[{type:BI.VerticalLayout.xtype}],items:this.renderParameterInputs(),ref:function(e){t.parameterInputs=e}}]}},n.renderHeader=function(){var e=this,t=this.options,n=t.title,t=t.headers;return{type:a.ParameterHeader.xtype,title:n,headers:t,listeners:[{eventName:"EVENT_INSERT",action:function(){e.addItem({name:"",value:"",id:BI.UUID(),type:"String"})}},{eventName:"EVENT_DELETE",action:function(){e.removeSelectedItem()}},{eventName:"EVENT_MOVE_UP",action:function(){e.moveUp()}},{eventName:"EVENT_MOVE_DOWN",action:function(){e.moveDown()}},{eventName:"EVENT_REFRESH",action:function(){e.refresh(),e.fireEvent("EVENT_REFRESH")}}]}},n.getValue=function(){return this.model.parameters.map(function(e){return{name:e.name,value:e.value,type:e.type}})},n.setValue=function(e){this.store.setParameters(e.map(function(e){return h(h({},e),{},{id:BI.UUID()})}))},n.addItem=function(e){var t=e.name,t=void 0===t?"":t,n=e.value,n=void 0===n?"":n,e=e.type,e=void 0===e?"String":e;this.store.setParameters([].concat(l(this.model.parameters),[{name:t,value:n,type:e,id:BI.UUID()}]))},n.removeSelectedItem=function(){var t=this;this.model.selectedId?BI.Msg.confirm(BI.i18nText("BI-Basic_Prompt"),BI.i18nText("BI-Basic_Parameter_Delete_Confirm"),function(e){e&&t.store.removeSelectedParameter()}):BI.Msg.alert(BI.i18nText("BI-Basic_Prompt"),BI.i18nText("BI-Basic_Parameter_Delete_Alert"))},n.moveUp=function(){this.store.move("up")},n.moveDown=function(){this.store.move("down")},n.refresh=function(){this.setDefaultValue()},n.setDefaultValue=function(){var e=this.options.value;this.setValue(void 0===e?[]:e)},n.renderParameterInputs=function(){var t=this;return this.model.parameters.map(function(e){return{type:o.ParameterInput.xtype,inputName:e.name,inputValue:e.value,inputType:e.type,id:e.id,value:e.id,selected:e.id===t.model.selectedId,listeners:[{eventName:"EVENT_CHANGE",action:function(){t.fireEvent("EVENT_CHANGE")}}]}})},t}(BI.Widget),f(n,"xtype","bi.parameter_editor"),r=n))||r)||r;t.ParameterEditor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterModel=void 0;var n=n(1);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}n=(0,n.model)()((n=function(i){var e,t;function n(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a(o(r=i.call.apply(i,[this].concat(t))||this),"childContext",["selectedId","parameters"]),a(o(r),"actions",{setParameters:function(e){r.model.parameters=e},removeSelectedParameter:function(){r.setParameters(r.model.parameters.filter(function(e){return e.id!==r.model.selectedId}))},move:function(e){var t,n;r.model.selectedId&&(t=r.model.parameters.findIndex(function(e){return e.id===r.model.selectedId}),"up"===e&&0<t&&(n=r.model.parameters.splice(t,1)[0],r.model.parameters.splice(t-1,0,n)),"down"===e&&t<r.model.parameters.length-1&&(n=r.model.parameters.splice(t,1)[0],r.model.parameters.splice(t+1,0,n)))}}),r}return t=i,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.state=function(){return{parameters:[],selectedId:""}},n}(n.Model),a(n,"xtype","bi.model.parameter_editor"),n=n))||n;t.ParameterModel=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterInput=void 0;var r=n(1),o=(n(312),n(14)),n=(n(319),n(320));function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function s(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}r=(0,r.shortcut)()(n=(0,r.store)(n.ParameterInputModel)((r=function(i){var e;function t(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return s(a(e=i.call.apply(i,[this].concat(n))||this),"props",{inputName:"",inputValue:"",inputType:"String",height:22,id:"",baseCls:"parameter-editor-input",value:""}),s(a(e),"store",void 0),s(a(e),"model",void 0),s(a(e),"tab",void 0),s(a(e),"parameterName",void 0),s(a(e),"parameterValue",void 0),s(a(e),"iconCombo",void 0),e}e=i,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.render=function(){var t=this,e=this.options,n=e.inputName,r=(e.inputValue,this.options.inputType),i=this.options.id;return{type:BI.CenterLayout.xtype,cls:"bi-border",items:[{type:BI.Editor.xtype,height:22,allowBlank:!0,value:n,ref:function(e){t.parameterName=e},listeners:[{eventName:BI.TextEditor.EVENT_CHANGE,action:function(){n=t.parameterName.getValue(),t.tab.setSelect(n?r:"tip"),t.store.setParameterName(i,n),t.fireEvent(BI.TextEditor.EVENT_CHANGE)}},{eventName:BI.TextEditor.EVENT_FOCUS,action:function(){t.store.setSelectedId(i)}}]},{type:BI.HTapeLayout.xtype,items:[{type:BI.Tab.xtype,single:!0,showIndex:n?r:"tip",ref:function(e){t.tab=e},cardCreator:function(e){return t.renderInputs(e)}}]}]}},n.renderInputs=function(e){var n=this,t=this.options,r=t.inputValue,i=t.id;return"tip"===e?{type:BI.TextButton.xtype,cls:"bi-error bi-border-left",text:BI.i18nText("BI-Basic_Parameter_Please_Set_Parameter_Name"),handler:function(){n.parameterName.focus()}}:(t=(0,o.getInput)(e),{type:BI.HTapeLayout.xtype,items:[{el:{type:BI.IconCombo.xtype,cls:"bi-border-left bi-border-right",height:22,width:25,value:e,items:this.renderDownList(),ref:function(e){n.iconCombo=e},listeners:[{eventName:"EVENT_CHANGE",action:function(){n.tab.setSelect("tip");var e=n.iconCombo.getValue()[0];e&&n.tab.setSelect(e),n.store.setParameterValue(i,"",e),n.fireEvent("EVENT_CHANGE")}}]},width:25},{type:t,value:r,listeners:[{eventName:"EVENT_CHANGE",action:function(e){var t=n.iconCombo.getValue()[0];n.store.setParameterValue(i,e,t),n.fireEvent("EVENT_CHANGE")}},{eventName:"EVENT_FOCUS",action:function(){n.store.setSelectedId(i)}}]}]})},n.renderDownList=function(){return[{text:BI.i18nText("BI-Basic_Parameter_Type_String"),value:"String",iconCls:"parameter-string-font"},{text:BI.i18nText("BI-Basic_Parameter_Type_Int"),value:"Integer",iconCls:"parameter-int-font"},{text:BI.i18nText("BI-Basic_Parameter_Type_Number"),value:"Double",iconCls:"parameter-double-font"},{text:BI.i18nText("BI-Basic_Parameter_Type_Date"),value:"Date",iconCls:"parameter-date-font"},{text:BI.i18nText("BI-Basic_Parameter_Type_Boolean"),value:"Boolean",iconCls:"parameter-boolean-font"},{text:BI.i18nText("BI-Basic_Parameter_Type_Formula"),value:"Formula",iconCls:"parameter-formula-font"}]},t}(BI.BasicButton),s(r,"xtype","bi.parameter_editor.parameter_input"),n=r))||n)||n;t.ParameterInput=r},function(e,t,n){"use strict";n(313),n(314),n(315),n(316),n(317),n(318)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputBoolean=void 0;var r=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}r=(0,r.shortcut)()(n=(0,n.input)("Boolean")((r=function(i){var e;function t(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return a(o(e=i.call.apply(i,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),a(o(e),"hasSelected",void 0),e}e=i,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.render=function(){var t=this,e=this.options.value;return this.hasSelected="true"===e,{type:BI.MultiSelectItem.xtype,width:80,selected:this.hasSelected,text:"true",ref:function(e){t.input=e},listeners:[{eventName:BI.MultiSelectItem.EVENT_CHANGE,action:function(){t.hasSelected=!t.hasSelected,t.fireEvent("EVENT_CHANGE",t.hasSelected)}}]}},n.doClick=function(){this.fireEvent("EVENT_FOCUS")},t}(BI.BasicButton),a(r,"xtype","bi.parameter_editor.parameter_input.boolean"),n=r))||n)||n;t.InputBoolean=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputDate=void 0;var r=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}r=(0,r.shortcut)()(n=(0,n.input)("Date")((r=function(i){var e,t;function n(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return a(o(e=i.call.apply(i,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),e}return t=i,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.render=function(){var r=this,e=this.options.value.split("-");return{type:BI.DynamicDateCombo.xtype,height:22,allowBlank:!0,value:3===e.length?{year:e[0],month:e[1],day:e[2]}:"",ref:function(e){r.input=e},listeners:[{eventName:BI.DynamicDateCombo.EVENT_CONFIRM,action:function(){var e=r.input.getValue().value,t=e.day,n=e.month,e=e.year;r.fireEvent("EVENT_CHANGE","".concat(e,"-").concat(n,"-").concat(t))}},{eventName:BI.DynamicDateCombo.EVENT_FOCUS,action:function(){r.fireEvent("EVENT_FOCUS")}}]}},n}(BI.Widget),a(r,"xtype","bi.parameter_editor.parameter_input.date"),n=r))||n)||n;t.InputDate=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputInt=void 0;var r=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}r=(0,r.shortcut)()(n=(0,n.input)("Integer")((r=function(i){var e,t;function n(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return a(o(e=i.call.apply(i,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),e}return t=i,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.render=function(){var t=this,e=this.options.value;return{type:BI.Editor.xtype,height:22,allowBlank:!0,value:e,ref:function(e){t.input=e},validationChecker:function(e){return BI.isInteger(e)},listeners:[{eventName:BI.Editor.EVENT_CHANGE,action:function(){var e=t.input.getValue();t.fireEvent("EVENT_CHANGE",e)}},{eventName:BI.Editor.EVENT_FOCUS,action:function(){t.fireEvent("EVENT_FOCUS")}}]}},n}(BI.Widget),a(r,"xtype","bi.parameter_editor.parameter_input.int"),n=r))||n)||n;t.InputInt=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputDouble=void 0;var r=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}r=(0,r.shortcut)()(n=(0,n.input)("Double")((r=function(i){var e,t;function n(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return a(o(e=i.call.apply(i,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),e}return t=i,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.render=function(){var t=this,e=this.options.value;return{type:BI.Editor.xtype,height:22,allowBlank:!0,value:e,ref:function(e){t.input=e},validationChecker:function(e){return BI.isNumeric(e)},listeners:[{eventName:BI.Editor.EVENT_CHANGE,action:function(){var e=t.input.getValue();t.fireEvent("EVENT_CHANGE",e)}},{eventName:BI.Editor.EVENT_FOCUS,action:function(){t.fireEvent("EVENT_FOCUS")}}]}},n}(BI.Widget),a(r,"xtype","bi.parameter_editor.parameter_input.double"),n=r))||n)||n;t.InputDouble=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputString=void 0;var r=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}r=(0,r.shortcut)()(n=(0,n.input)("String")((r=function(i){var e,t;function n(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return a(o(e=i.call.apply(i,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),e}return t=i,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.render=function(){var t=this,e=this.options.value;return{type:BI.Editor.xtype,height:22,allowBlank:!0,value:e,ref:function(e){t.input=e},listeners:[{eventName:BI.Editor.EVENT_CHANGE,action:function(){var e=t.input.getValue();t.fireEvent("EVENT_CHANGE",e)}},{eventName:BI.Editor.EVENT_FOCUS,action:function(){t.fireEvent("EVENT_FOCUS")}}]}},n}(BI.Widget),a(r,"xtype","bi.parameter_editor.parameter_input.string"),n=r))||n)||n;t.InputString=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputFormula=void 0;var r=n(1),n=n(14);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}r=(0,r.shortcut)()(n=(0,n.input)("Formula")((r=function(i){var e;function t(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return a(o(e=i.call.apply(i,[this].concat(n))||this),"props",{value:""}),a(o(e),"input",void 0),e}e=i,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.mounted=function(){},n.render=function(){var t=this,e=this.options.value;return{type:BI.Editor.xtype,height:22,allowBlank:!0,value:e,ref:function(e){t.input=e},listeners:[{eventName:BI.Editor.EVENT_CHANGE,action:function(){var e=t.input.getValue();t.fireEvent("EVENT_CHANGE",e)}},{eventName:BI.Editor.EVENT_FOCUS,action:function(){t.fireEvent("EVENT_FOCUS")}}]}},t}(BI.Widget),a(r,"xtype","bi.parameter_editor.parameter_input.formula"),n=r))||n)||n;t.InputFormula=r},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterInputModel=void 0;var n=n(1);function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}n=(0,n.model)()((n=function(i){var e,t;function n(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a(o(r=i.call.apply(i,[this].concat(t))||this),"context",["selectedId","parameters"]),a(o(r),"actions",{setSelectedId:function(e){r.model.selectedId=e},setParameterName:function(e,t){e=r.getParameter(e);e&&(e.name=t)},setParameterValue:function(e,t,n){e=r.getParameter(e);e&&(e.value=t,e.type=n)}}),r}return t=i,(e=n).prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t),n.prototype.getParameter=function(t){return this.model.parameters.find(function(e){return e.id===t})},n}(n.Model),a(n,"xtype","bi.model.parameter_editor.parameter_input"),n=n))||n;t.ParameterInputModel=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterHeader=void 0;var r=n(1),o=n(110);function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function l(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}return e})(e,t)}function a(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}n=(0,r.shortcut)()((n=function(i){var e;function t(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return a(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e=i.call.apply(i,[this].concat(n))||this),"props",{title:"",headers:o.defaultHeaderItems}),e}e=i,(n=t).prototype=Object.create(e.prototype),n.prototype.constructor=n,l(n,e);var n=t.prototype;return n.render=function(){var e=this.options.title;return{type:BI.LeftRightVerticalAdaptLayout.xtype,items:{left:[{type:BI.Label.xtype,lgap:2,text:e,textAlign:"left"}],right:this.renderItem()}}},n.renderItem=function(){var n=this;return this.options.headers.map(function(t){var e;return BI.isString(t)?(e=o.headerItemsData.find(function(e){return e.type===t}))?{type:BI.IconButton.xtype,cls:e.cls,width:25,title:BI.i18nText(e.title),handler:function(){n.fireEvent(e.event)}}:{type:"bi.default"}:t})},t}(BI.Widget),a(n,"xtype","bi.parameter_editor.header"),r=n))||r;t.ParameterHeader=n},function(e,t,n){"use strict";function r(e,t){var n=e.requestUrl,r=e.contextPath,i=e.webSocketNameSpace,o=e.query,a=e.options,r="".concat("/"===r?"":r,"/websocket");try{var s=io("".concat(n).concat(location.port?":".concat(location.port):"").concat(i),BI.extend({query:o,path:r,transports:["websocket","polling"],timeout:15e3},a)),l=!0;return s.on("connect_error",function(){s.off("connect_error"),s.off("connect"),l&&u(s,e,t)}),s.on("connect",function(){l=!1,t("success")}),s}catch(c){throw new Error(c)}}function u(t,e,n){var r=e.webSocketPort,i=e.requestUrl,o=e.webSocketNameSpace,a=e.query,s=e.webSocketContextName,e=e.options;try{return BI.isNull(t)?t=io("".concat(i,":").concat(r.shift()).concat(o),BI.extend({query:a,path:s,transports:["polling","websocket"],timeout:5e3},e)):(t.io.opts.path=s,t.io.opts.query=a,t.io.opts.transports=["polling","websocket"],t.io.uri="".concat(i,":").concat(r.shift()).concat(o),t.io.connect(function(){})),t.on("connect_error",function(){var e;e=t.io,BI.isEmptyArray(r)?n("fail"):(e.uri="".concat(i,":").concat(r.shift()).concat(o),e.connect(function(){}))}),t.on("connect",function(){n("success")}),t}catch(l){throw new Error(l)}}Object.defineProperty(t,"__esModule",{value:!0}),t.initSocket=function(e,t){t=BI.isFunction(t)?t:BI.emptyFn;if(e.useJavaxWebSocket)return r(e,t);return u(null,e,t)}},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n(207)(n(388))},function(e,t){e.exports='// version 5.42.2\r\n// CodeMirror, copyright (c) by Marijn Haverbeke and others\r\n// Distributed under an MIT license: https://codemirror.net/LICENSE\r\n\r\n// This is CodeMirror (https://codemirror.net), a code editor\r\n// implemented in JavaScript on top of the browser\'s DOM.\r\n//\r\n// You can find some technical background for some of the code below\r\n// at http://marijnhaverbeke.nl/blog/#cm-internals .\r\n\r\n(function (global, factory) {\r\n    typeof exports === \'object\' && typeof module !== \'undefined\' ? module.exports = factory() :\r\n        typeof define === \'function\' && define.amd ? define(factory) :\r\n            (BI.CodeMirror = BI.CodeMirror || factory());\r\n}(this, (function () { \'use strict\';\r\n\r\n    // Kludges for bugs and behavior differences that can\'t be feature\r\n    // detected are enabled based on userAgent etc sniffing.\r\n    var userAgent = navigator.userAgent;\r\n    var platform = navigator.platform;\r\n\r\n    var gecko = /gecko\\/\\d/i.test(userAgent);\r\n    var ie_upto10 = /MSIE \\d/.test(userAgent);\r\n    var ie_11up = /Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(userAgent);\r\n    var edge = /Edge\\/(\\d+)/.exec(userAgent);\r\n    var ie = ie_upto10 || ie_11up || edge;\r\n    var ie_version = ie && (ie_upto10 ? document.documentMode || 6 : +(edge || ie_11up)[1]);\r\n    var webkit = !edge && /WebKit\\//.test(userAgent);\r\n    var qtwebkit = webkit && /Qt\\/\\d+\\.\\d+/.test(userAgent);\r\n    var chrome = !edge && /Chrome\\//.test(userAgent);\r\n    var presto = /Opera\\//.test(userAgent);\r\n    var safari = /Apple Computer/.test(navigator.vendor);\r\n    var mac_geMountainLion = /Mac OS X 1\\d\\D([8-9]|\\d\\d)\\D/.test(userAgent);\r\n    var phantom = /PhantomJS/.test(userAgent);\r\n\r\n    var ios = !edge && /AppleWebKit/.test(userAgent) && /Mobile\\/\\w+/.test(userAgent);\r\n    var android = /Android/.test(userAgent);\r\n    // This is woefully incomplete. Suggestions for alternative methods welcome.\r\n    var mobile = ios || android || /webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);\r\n    var mac = ios || /Mac/.test(platform);\r\n    var chromeOS = /\\bCrOS\\b/.test(userAgent);\r\n    var windows = /win/i.test(platform);\r\n\r\n    var presto_version = presto && userAgent.match(/Version\\/(\\d*\\.\\d*)/);\r\n    if (presto_version) { presto_version = Number(presto_version[1]); }\r\n    if (presto_version && presto_version >= 15) { presto = false; webkit = true; }\r\n    // Some browsers use the wrong event properties to signal cmd/ctrl on OS X\r\n    var flipCtrlCmd = mac && (qtwebkit || presto && (presto_version == null || presto_version < 12.11));\r\n    var captureRightClick = gecko || (ie && ie_version >= 9);\r\n\r\n    function classTest(cls) { return new RegExp("(^|\\\\s)" + cls + "(?:$|\\\\s)\\\\s*") }\r\n\r\n    var rmClass = function(node, cls) {\r\n        var current = node.className;\r\n        var match = classTest(cls).exec(current);\r\n        if (match) {\r\n            var after = current.slice(match.index + match[0].length);\r\n            node.className = current.slice(0, match.index) + (after ? match[1] + after : "");\r\n        }\r\n    };\r\n\r\n    function removeChildren(e) {\r\n        for (var count = e.childNodes.length; count > 0; --count)\r\n        { e.removeChild(e.firstChild); }\r\n        return e\r\n    }\r\n\r\n    function removeChildrenAndAdd(parent, e) {\r\n        return removeChildren(parent).appendChild(e)\r\n    }\r\n\r\n    function elt(tag, content, className, style) {\r\n        var e = document.createElement(tag);\r\n        if (className) { e.className = className; }\r\n        if (style) { e.style.cssText = style; }\r\n        if (typeof content == "string") { e.appendChild(document.createTextNode(content)); }\r\n        else if (content) { for (var i = 0; i < content.length; ++i) { e.appendChild(content[i]); } }\r\n        return e\r\n    }\r\n    // wrapper for elt, which removes the elt from the accessibility tree\r\n    function eltP(tag, content, className, style) {\r\n        var e = elt(tag, content, className, style);\r\n        e.setAttribute("role", "presentation");\r\n        return e\r\n    }\r\n\r\n    var range;\r\n    if (document.createRange) { range = function(node, start, end, endNode) {\r\n        var r = document.createRange();\r\n        r.setEnd(endNode || node, end);\r\n        r.setStart(node, start);\r\n        return r\r\n    }; }\r\n    else { range = function(node, start, end) {\r\n        var r = document.body.createTextRange();\r\n        try { r.moveToElementText(node.parentNode); }\r\n        catch(e) { return r }\r\n        r.collapse(true);\r\n        r.moveEnd("character", end);\r\n        r.moveStart("character", start);\r\n        return r\r\n    }; }\r\n\r\n    function contains(parent, child) {\r\n        if (child.nodeType == 3) // Android browser always returns false when child is a textnode\r\n        { child = child.parentNode; }\r\n        if (parent.contains)\r\n        { return parent.contains(child) }\r\n        do {\r\n            if (child.nodeType == 11) { child = child.host; }\r\n            if (child == parent) { return true }\r\n        } while (child = child.parentNode)\r\n    }\r\n\r\n    function activeElt() {\r\n        // IE and Edge may throw an "Unspecified Error" when accessing document.activeElement.\r\n        // IE < 10 will throw when accessed while the page is loading or in an iframe.\r\n        // IE > 9 and Edge will throw when accessed in an iframe if document.body is unavailable.\r\n        var activeElement;\r\n        try {\r\n            activeElement = document.activeElement;\r\n        } catch(e) {\r\n            activeElement = document.body || null;\r\n        }\r\n        while (activeElement && activeElement.shadowRoot && activeElement.shadowRoot.activeElement)\r\n        { activeElement = activeElement.shadowRoot.activeElement; }\r\n        return activeElement\r\n    }\r\n\r\n    function addClass(node, cls) {\r\n        var current = node.className;\r\n        if (!classTest(cls).test(current)) { node.className += (current ? " " : "") + cls; }\r\n    }\r\n    function joinClasses(a, b) {\r\n        var as = a.split(" ");\r\n        for (var i = 0; i < as.length; i++)\r\n        { if (as[i] && !classTest(as[i]).test(b)) { b += " " + as[i]; } }\r\n        return b\r\n    }\r\n\r\n    var selectInput = function(node) { node.select(); };\r\n    if (ios) // Mobile Safari apparently has a bug where select() is broken.\r\n    { selectInput = function(node) { node.selectionStart = 0; node.selectionEnd = node.value.length; }; }\r\n    else if (ie) // Suppress mysterious IE10 errors\r\n    { selectInput = function(node) { try { node.select(); } catch(_e) {} }; }\r\n\r\n    function bind(f) {\r\n        var args = Array.prototype.slice.call(arguments, 1);\r\n        return function(){return f.apply(null, args)}\r\n    }\r\n\r\n    function copyObj(obj, target, overwrite) {\r\n        if (!target) { target = {}; }\r\n        for (var prop in obj)\r\n        { if (obj.hasOwnProperty(prop) && (overwrite !== false || !target.hasOwnProperty(prop)))\r\n        { target[prop] = obj[prop]; } }\r\n        return target\r\n    }\r\n\r\n    // Counts the column offset in a string, taking tabs into account.\r\n    // Used mostly to find indentation.\r\n    function countColumn(string, end, tabSize, startIndex, startValue) {\r\n        if (end == null) {\r\n            end = string.search(/[^\\s\\u00a0]/);\r\n            if (end == -1) { end = string.length; }\r\n        }\r\n        for (var i = startIndex || 0, n = startValue || 0;;) {\r\n            var nextTab = string.indexOf("\\t", i);\r\n            if (nextTab < 0 || nextTab >= end)\r\n            { return n + (end - i) }\r\n            n += nextTab - i;\r\n            n += tabSize - (n % tabSize);\r\n            i = nextTab + 1;\r\n        }\r\n    }\r\n\r\n    var Delayed = function() {this.id = null;};\r\n    Delayed.prototype.set = function (ms, f) {\r\n        clearTimeout(this.id);\r\n        this.id = setTimeout(f, ms);\r\n    };\r\n\r\n    function indexOf(array, elt) {\r\n        for (var i = 0; i < array.length; ++i)\r\n        { if (array[i] == elt) { return i } }\r\n        return -1\r\n    }\r\n\r\n    // Number of pixels added to scroller and sizer to hide scrollbar\r\n    var scrollerGap = 30;\r\n\r\n    // Returned or thrown by various protocols to signal \'I\'m not\r\n    // handling this\'.\r\n    var Pass = {toString: function(){return "CodeMirror.Pass"}};\r\n\r\n    // Reused option objects for setSelection & friends\r\n    var sel_dontScroll = {scroll: false}, sel_mouse = {origin: "*mouse"}, sel_move = {origin: "+move"};\r\n\r\n    // The inverse of countColumn -- find the offset that corresponds to\r\n    // a particular column.\r\n    function findColumn(string, goal, tabSize) {\r\n        for (var pos = 0, col = 0;;) {\r\n            var nextTab = string.indexOf("\\t", pos);\r\n            if (nextTab == -1) { nextTab = string.length; }\r\n            var skipped = nextTab - pos;\r\n            if (nextTab == string.length || col + skipped >= goal)\r\n            { return pos + Math.min(skipped, goal - col) }\r\n            col += nextTab - pos;\r\n            col += tabSize - (col % tabSize);\r\n            pos = nextTab + 1;\r\n            if (col >= goal) { return pos }\r\n        }\r\n    }\r\n\r\n    var spaceStrs = [""];\r\n    function spaceStr(n) {\r\n        while (spaceStrs.length <= n)\r\n        { spaceStrs.push(lst(spaceStrs) + " "); }\r\n        return spaceStrs[n]\r\n    }\r\n\r\n    function lst(arr) { return arr[arr.length-1] }\r\n\r\n    function map(array, f) {\r\n        var out = [];\r\n        for (var i = 0; i < array.length; i++) { out[i] = f(array[i], i); }\r\n        return out\r\n    }\r\n\r\n    function insertSorted(array, value, score) {\r\n        var pos = 0, priority = score(value);\r\n        while (pos < array.length && score(array[pos]) <= priority) { pos++; }\r\n        array.splice(pos, 0, value);\r\n    }\r\n\r\n    function nothing() {}\r\n\r\n    function createObj(base, props) {\r\n        var inst;\r\n        if (Object.create) {\r\n            inst = Object.create(base);\r\n        } else {\r\n            nothing.prototype = base;\r\n            inst = new nothing();\r\n        }\r\n        if (props) { copyObj(props, inst); }\r\n        return inst\r\n    }\r\n\r\n    var nonASCIISingleCaseWordChar = /[\\u00df\\u0587\\u0590-\\u05f4\\u0600-\\u06ff\\u3040-\\u309f\\u30a0-\\u30ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\uac00-\\ud7af]/;\r\n    function isWordCharBasic(ch) {\r\n        return /\\w/.test(ch) || ch > "\\x80" &&\r\n            (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch))\r\n    }\r\n    function isWordChar(ch, helper) {\r\n        if (!helper) { return isWordCharBasic(ch) }\r\n        if (helper.source.indexOf("\\\\w") > -1 && isWordCharBasic(ch)) { return true }\r\n        return helper.test(ch)\r\n    }\r\n\r\n    function isEmpty(obj) {\r\n        for (var n in obj) { if (obj.hasOwnProperty(n) && obj[n]) { return false } }\r\n        return true\r\n    }\r\n\r\n    // Extending unicode characters. A series of a non-extending char +\r\n    // any number of extending chars is treated as a single unit as far\r\n    // as editing and measuring is concerned. This is not fully correct,\r\n    // since some scripts/fonts/browsers also treat other configurations\r\n    // of code points as a group.\r\n    var extendingChars = /[\\u0300-\\u036f\\u0483-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u064b-\\u065e\\u0670\\u06d6-\\u06dc\\u06de-\\u06e4\\u06e7\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0900-\\u0902\\u093c\\u0941-\\u0948\\u094d\\u0951-\\u0955\\u0962\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2\\u09e3\\u0a01\\u0a02\\u0a3c\\u0a41\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70\\u0a71\\u0a75\\u0a81\\u0a82\\u0abc\\u0ac1-\\u0ac5\\u0ac7\\u0ac8\\u0acd\\u0ae2\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57\\u0b62\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62\\u0c63\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc\\u0ccd\\u0cd5\\u0cd6\\u0ce2\\u0ce3\\u0d3e\\u0d41-\\u0d44\\u0d4d\\u0d57\\u0d62\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9\\u0ebb\\u0ebc\\u0ec8-\\u0ecd\\u0f18\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86\\u0f87\\u0f90-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039\\u103a\\u103d\\u103e\\u1058\\u1059\\u105e-\\u1060\\u1071-\\u1074\\u1082\\u1085\\u1086\\u108d\\u109d\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927\\u1928\\u1932\\u1939-\\u193b\\u1a17\\u1a18\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1b00-\\u1b03\\u1b34\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80\\u1b81\\u1ba2-\\u1ba5\\u1ba8\\u1ba9\\u1c2c-\\u1c33\\u1c36\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1dc0-\\u1de6\\u1dfd-\\u1dff\\u200c\\u200d\\u20d0-\\u20f0\\u2cef-\\u2cf1\\u2de0-\\u2dff\\u302a-\\u302f\\u3099\\u309a\\ua66f-\\ua672\\ua67c\\ua67d\\ua6f0\\ua6f1\\ua802\\ua806\\ua80b\\ua825\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc\\uaa29-\\uaa2e\\uaa31\\uaa32\\uaa35\\uaa36\\uaa43\\uaa4c\\uaab0\\uaab2-\\uaab4\\uaab7\\uaab8\\uaabe\\uaabf\\uaac1\\uabe5\\uabe8\\uabed\\udc00-\\udfff\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe26\\uff9e\\uff9f]/;\r\n    function isExtendingChar(ch) { return ch.charCodeAt(0) >= 768 && extendingChars.test(ch) }\r\n\r\n    // Returns a number from the range [`0`; `str.length`] unless `pos` is outside that range.\r\n    function skipExtendingChars(str, pos, dir) {\r\n        while ((dir < 0 ? pos > 0 : pos < str.length) && isExtendingChar(str.charAt(pos))) { pos += dir; }\r\n        return pos\r\n    }\r\n\r\n    // Returns the value from the range [`from`; `to`] that satisfies\r\n    // `pred` and is closest to `from`. Assumes that at least `to`\r\n    // satisfies `pred`. Supports `from` being greater than `to`.\r\n    function findFirst(pred, from, to) {\r\n        // At any point we are certain `to` satisfies `pred`, don\'t know\r\n        // whether `from` does.\r\n        var dir = from > to ? -1 : 1;\r\n        for (;;) {\r\n            if (from == to) { return from }\r\n            var midF = (from + to) / 2, mid = dir < 0 ? Math.ceil(midF) : Math.floor(midF);\r\n            if (mid == from) { return pred(mid) ? from : to }\r\n            if (pred(mid)) { to = mid; }\r\n            else { from = mid + dir; }\r\n        }\r\n    }\r\n\r\n    // The display handles the DOM integration, both for input reading\r\n    // and content drawing. It holds references to DOM nodes and\r\n    // display-related state.\r\n\r\n    function Display(place, doc, input) {\r\n        var d = this;\r\n        this.input = input;\r\n\r\n        // Covers bottom-right square when both scrollbars are present.\r\n        d.scrollbarFiller = elt("div", null, "CodeMirror-scrollbar-filler");\r\n        d.scrollbarFiller.setAttribute("cm-not-content", "true");\r\n        // Covers bottom of gutter when coverGutterNextToScrollbar is on\r\n        // and h scrollbar is present.\r\n        d.gutterFiller = elt("div", null, "CodeMirror-gutter-filler");\r\n        d.gutterFiller.setAttribute("cm-not-content", "true");\r\n        // Will contain the actual code, positioned to cover the viewport.\r\n        d.lineDiv = eltP("div", null, "CodeMirror-code");\r\n        // Elements are added to these to represent selection and cursors.\r\n        d.selectionDiv = elt("div", null, null, "position: relative; z-index: 1");\r\n        d.cursorDiv = elt("div", null, "CodeMirror-cursors");\r\n        // A visibility: hidden element used to find the size of things.\r\n        d.measure = elt("div", null, "CodeMirror-measure");\r\n        // When lines outside of the viewport are measured, they are drawn in this.\r\n        d.lineMeasure = elt("div", null, "CodeMirror-measure");\r\n        // Wraps everything that needs to exist inside the vertically-padded coordinate system\r\n        d.lineSpace = eltP("div", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv],\r\n            null, "position: relative; outline: none");\r\n        var lines = eltP("div", [d.lineSpace], "CodeMirror-lines");\r\n        // Moved around its parent to cover visible view.\r\n        d.mover = elt("div", [lines], null, "position: relative");\r\n        // Set to the height of the document, allowing scrolling.\r\n        d.sizer = elt("div", [d.mover], "CodeMirror-sizer");\r\n        d.sizerWidth = null;\r\n        // Behavior of elts with overflow: auto and padding is\r\n        // inconsistent across browsers. This is used to ensure the\r\n        // scrollable area is big enough.\r\n        d.heightForcer = elt("div", null, null, "position: absolute; height: " + scrollerGap + "px; width: 1px;");\r\n        // Will contain the gutters, if any.\r\n        d.gutters = elt("div", null, "CodeMirror-gutters");\r\n        d.lineGutter = null;\r\n        // Actual scrollable element.\r\n        d.scroller = elt("div", [d.sizer, d.heightForcer, d.gutters], "CodeMirror-scroll");\r\n        d.scroller.setAttribute("tabIndex", "-1");\r\n        // The element in which the editor lives.\r\n        d.wrapper = elt("div", [d.scrollbarFiller, d.gutterFiller, d.scroller], "CodeMirror");\r\n\r\n        // Work around IE7 z-index bug (not perfect, hence IE7 not really being supported)\r\n        if (ie && ie_version < 8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }\r\n        if (!webkit && !(gecko && mobile)) { d.scroller.draggable = true; }\r\n\r\n        if (place) {\r\n            if (place.appendChild) { place.appendChild(d.wrapper); }\r\n            else { place(d.wrapper); }\r\n        }\r\n\r\n        // Current rendered range (may be bigger than the view window).\r\n        d.viewFrom = d.viewTo = doc.first;\r\n        d.reportedViewFrom = d.reportedViewTo = doc.first;\r\n        // Information about the rendered lines.\r\n        d.view = [];\r\n        d.renderedView = null;\r\n        // Holds info about a single rendered line when it was rendered\r\n        // for measurement, while not in view.\r\n        d.externalMeasured = null;\r\n        // Empty space (in pixels) above the view\r\n        d.viewOffset = 0;\r\n        d.lastWrapHeight = d.lastWrapWidth = 0;\r\n        d.updateLineNumbers = null;\r\n\r\n        d.nativeBarWidth = d.barHeight = d.barWidth = 0;\r\n        d.scrollbarsClipped = false;\r\n\r\n        // Used to only resize the line number gutter when necessary (when\r\n        // the amount of lines crosses a boundary that makes its width change)\r\n        d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;\r\n        // Set to true when a non-horizontal-scrolling line widget is\r\n        // added. As an optimization, line widget aligning is skipped when\r\n        // this is false.\r\n        d.alignWidgets = false;\r\n\r\n        d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\r\n\r\n        // Tracks the maximum line length so that the horizontal scrollbar\r\n        // can be kept static when scrolling.\r\n        d.maxLine = null;\r\n        d.maxLineLength = 0;\r\n        d.maxLineChanged = false;\r\n\r\n        // Used for measuring wheel scrolling granularity\r\n        d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;\r\n\r\n        // True when shift is held down.\r\n        d.shift = false;\r\n\r\n        // Used to track whether anything happened since the context menu\r\n        // was opened.\r\n        d.selForContextMenu = null;\r\n\r\n        d.activeTouch = null;\r\n\r\n        input.init(d);\r\n    }\r\n\r\n    // Find the line object corresponding to the given line number.\r\n    function getLine(doc, n) {\r\n        n -= doc.first;\r\n        if (n < 0 || n >= doc.size) { throw new Error("There is no line " + (n + doc.first) + " in the document.") }\r\n        var chunk = doc;\r\n        while (!chunk.lines) {\r\n            for (var i = 0;; ++i) {\r\n                var child = chunk.children[i], sz = child.chunkSize();\r\n                if (n < sz) { chunk = child; break }\r\n                n -= sz;\r\n            }\r\n        }\r\n        return chunk.lines[n]\r\n    }\r\n\r\n    // Get the part of a document between two positions, as an array of\r\n    // strings.\r\n    function getBetween(doc, start, end) {\r\n        var out = [], n = start.line;\r\n        doc.iter(start.line, end.line + 1, function (line) {\r\n            var text = line.text;\r\n            if (n == end.line) { text = text.slice(0, end.ch); }\r\n            if (n == start.line) { text = text.slice(start.ch); }\r\n            out.push(text);\r\n            ++n;\r\n        });\r\n        return out\r\n    }\r\n\r\n    function getLines(doc, from, to, lineFilter) {\r\n        var out = [];\r\n        doc.iter(from, to, function (line) {\r\n            var text = line.text;\r\n            if (lineFilter) {\r\n                text = lineFilter(line);\r\n            }\r\n            out.push(text);\r\n        });\r\n        return out;\r\n    }\r\n\r\n    // Update the height of a line, propagating the height change\r\n    // upwards to parent nodes.\r\n    function updateLineHeight(line, height) {\r\n        var diff = height - line.height;\r\n        if (diff) { for (var n = line; n; n = n.parent) { n.height += diff; } }\r\n    }\r\n\r\n    // Given a line object, find its line number by walking up through\r\n    // its parent links.\r\n    function lineNo(line) {\r\n        if (line.parent == null) { return null }\r\n        var cur = line.parent, no = indexOf(cur.lines, line);\r\n        for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {\r\n            for (var i = 0;; ++i) {\r\n                if (chunk.children[i] == cur) { break }\r\n                no += chunk.children[i].chunkSize();\r\n            }\r\n        }\r\n        return no + cur.first\r\n    }\r\n\r\n    // Find the line at the given vertical position, using the height\r\n    // information in the document tree.\r\n    function lineAtHeight(chunk, h) {\r\n        var n = chunk.first;\r\n        outer: do {\r\n            for (var i$1 = 0; i$1 < chunk.children.length; ++i$1) {\r\n                var child = chunk.children[i$1], ch = child.height;\r\n                if (h < ch) { chunk = child; continue outer }\r\n                h -= ch;\r\n                n += child.chunkSize();\r\n            }\r\n            return n\r\n        } while (!chunk.lines)\r\n        var i = 0;\r\n        for (; i < chunk.lines.length; ++i) {\r\n            var line = chunk.lines[i], lh = line.height;\r\n            if (h < lh) { break }\r\n            h -= lh;\r\n        }\r\n        return n + i\r\n    }\r\n\r\n    function isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size}\r\n\r\n    function lineNumberFor(options, i) {\r\n        return String(options.lineNumberFormatter(i + options.firstLineNumber))\r\n    }\r\n\r\n    // A Pos instance represents a position within the text.\r\n    function Pos(line, ch, sticky) {\r\n        if ( sticky === void 0 ) sticky = null;\r\n\r\n        if (!(this instanceof Pos)) { return new Pos(line, ch, sticky) }\r\n        this.line = line;\r\n        this.ch = ch;\r\n        this.sticky = sticky;\r\n    }\r\n\r\n    // Compare two positions, return 0 if they are the same, a negative\r\n    // number when a is less, and a positive number otherwise.\r\n    function cmp(a, b) { return a.line - b.line || a.ch - b.ch }\r\n\r\n    function equalCursorPos(a, b) { return a.sticky == b.sticky && cmp(a, b) == 0 }\r\n\r\n    function copyPos(x) {return Pos(x.line, x.ch)}\r\n    function maxPos(a, b) { return cmp(a, b) < 0 ? b : a }\r\n    function minPos(a, b) { return cmp(a, b) < 0 ? a : b }\r\n\r\n    // Most of the external API clips given positions to make sure they\r\n    // actually exist within the document.\r\n    function clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1))}\r\n    function clipPos(doc, pos) {\r\n        if (pos.line < doc.first) { return Pos(doc.first, 0) }\r\n        var last = doc.first + doc.size - 1;\r\n        if (pos.line > last) { return Pos(last, getLine(doc, last).text.length) }\r\n        return clipToLen(pos, getLine(doc, pos.line).text.length)\r\n    }\r\n    function clipToLen(pos, linelen) {\r\n        var ch = pos.ch;\r\n        if (ch == null || ch > linelen) { return Pos(pos.line, linelen) }\r\n        else if (ch < 0) { return Pos(pos.line, 0) }\r\n        else { return pos }\r\n    }\r\n    function clipPosArray(doc, array) {\r\n        var out = [];\r\n        for (var i = 0; i < array.length; i++) { out[i] = clipPos(doc, array[i]); }\r\n        return out\r\n    }\r\n\r\n    // Optimize some code when these features are not used.\r\n    var sawReadOnlySpans = false, sawCollapsedSpans = false;\r\n\r\n    function seeReadOnlySpans() {\r\n        sawReadOnlySpans = true;\r\n    }\r\n\r\n    function seeCollapsedSpans() {\r\n        sawCollapsedSpans = true;\r\n    }\r\n\r\n    // TEXTMARKER SPANS\r\n\r\n    function MarkedSpan(marker, from, to) {\r\n        this.marker = marker;\r\n        this.from = from; this.to = to;\r\n    }\r\n\r\n    // Search an array of spans for a span matching the given marker.\r\n    function getMarkedSpanFor(spans, marker) {\r\n        if (spans) { for (var i = 0; i < spans.length; ++i) {\r\n            var span = spans[i];\r\n            if (span.marker == marker) { return span }\r\n        } }\r\n    }\r\n    // Remove a span from an array, returning undefined if no spans are\r\n    // left (we don\'t store arrays for lines without spans).\r\n    function removeMarkedSpan(spans, span) {\r\n        var r;\r\n        for (var i = 0; i < spans.length; ++i)\r\n        { if (spans[i] != span) { (r || (r = [])).push(spans[i]); } }\r\n        return r\r\n    }\r\n    // Add a span to a line.\r\n    function addMarkedSpan(line, span) {\r\n        line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];\r\n        span.marker.attachLine(line);\r\n    }\r\n\r\n    // Used for the algorithm that adjusts markers for a change in the\r\n    // document. These functions cut an array of spans at a given\r\n    // character position, returning an array of remaining chunks (or\r\n    // undefined if nothing remains).\r\n    function markedSpansBefore(old, startCh, isInsert) {\r\n        var nw;\r\n        if (old) { for (var i = 0; i < old.length; ++i) {\r\n            var span = old[i], marker = span.marker;\r\n            var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);\r\n            if (startsBefore || span.from == startCh && marker.type == "bookmark" && (!isInsert || !span.marker.insertLeft)) {\r\n                var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh)\r\n                ;(nw || (nw = [])).push(new MarkedSpan(marker, span.from, endsAfter ? null : span.to));\r\n            }\r\n        } }\r\n        return nw\r\n    }\r\n    function markedSpansAfter(old, endCh, isInsert) {\r\n        var nw;\r\n        if (old) { for (var i = 0; i < old.length; ++i) {\r\n            var span = old[i], marker = span.marker;\r\n            var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);\r\n            if (endsAfter || span.from == endCh && marker.type == "bookmark" && (!isInsert || span.marker.insertLeft)) {\r\n                var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh)\r\n                ;(nw || (nw = [])).push(new MarkedSpan(marker, startsBefore ? null : span.from - endCh,\r\n                    span.to == null ? null : span.to - endCh));\r\n            }\r\n        } }\r\n        return nw\r\n    }\r\n\r\n    // Given a change object, compute the new set of marker spans that\r\n    // cover the line in which the change took place. Removes spans\r\n    // entirely within the change, reconnects spans belonging to the\r\n    // same marker that appear on both sides of the change, and cuts off\r\n    // spans partially within the change. Returns an array of span\r\n    // arrays with one element for each line in (after) the change.\r\n    function stretchSpansOverChange(doc, change) {\r\n        if (change.full) { return null }\r\n        var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;\r\n        var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;\r\n        if (!oldFirst && !oldLast) { return null }\r\n\r\n        var startCh = change.from.ch, endCh = change.to.ch, isInsert = cmp(change.from, change.to) == 0;\r\n        // Get the spans that \'stick out\' on both sides\r\n        var first = markedSpansBefore(oldFirst, startCh, isInsert);\r\n        var last = markedSpansAfter(oldLast, endCh, isInsert);\r\n\r\n        // Next, merge those two ends\r\n        var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);\r\n        if (first) {\r\n            // Fix up .to properties of first\r\n            for (var i = 0; i < first.length; ++i) {\r\n                var span = first[i];\r\n                if (span.to == null) {\r\n                    var found = getMarkedSpanFor(last, span.marker);\r\n                    if (!found) { span.to = startCh; }\r\n                    else if (sameLine) { span.to = found.to == null ? null : found.to + offset; }\r\n                }\r\n            }\r\n        }\r\n        if (last) {\r\n            // Fix up .from in last (or move them into first in case of sameLine)\r\n            for (var i$1 = 0; i$1 < last.length; ++i$1) {\r\n                var span$1 = last[i$1];\r\n                if (span$1.to != null) { span$1.to += offset; }\r\n                if (span$1.from == null) {\r\n                    var found$1 = getMarkedSpanFor(first, span$1.marker);\r\n                    if (!found$1) {\r\n                        span$1.from = offset;\r\n                        if (sameLine) { (first || (first = [])).push(span$1); }\r\n                    }\r\n                } else {\r\n                    span$1.from += offset;\r\n                    if (sameLine) { (first || (first = [])).push(span$1); }\r\n                }\r\n            }\r\n        }\r\n        // Make sure we didn\'t create any zero-length spans\r\n        if (first) { first = clearEmptySpans(first); }\r\n        if (last && last != first) { last = clearEmptySpans(last); }\r\n\r\n        var newMarkers = [first];\r\n        if (!sameLine) {\r\n            // Fill gap with whole-line-spans\r\n            var gap = change.text.length - 2, gapMarkers;\r\n            if (gap > 0 && first)\r\n            { for (var i$2 = 0; i$2 < first.length; ++i$2)\r\n            { if (first[i$2].to == null)\r\n            { (gapMarkers || (gapMarkers = [])).push(new MarkedSpan(first[i$2].marker, null, null)); } } }\r\n            for (var i$3 = 0; i$3 < gap; ++i$3)\r\n            { newMarkers.push(gapMarkers); }\r\n            newMarkers.push(last);\r\n        }\r\n        return newMarkers\r\n    }\r\n\r\n    // Remove spans that are empty and don\'t have a clearWhenEmpty\r\n    // option of false.\r\n    function clearEmptySpans(spans) {\r\n        for (var i = 0; i < spans.length; ++i) {\r\n            var span = spans[i];\r\n            if (span.from != null && span.from == span.to && span.marker.clearWhenEmpty !== false)\r\n            { spans.splice(i--, 1); }\r\n        }\r\n        if (!spans.length) { return null }\r\n        return spans\r\n    }\r\n\r\n    // Used to \'clip\' out readOnly ranges when making a change.\r\n    function removeReadOnlyRanges(doc, from, to) {\r\n        var markers = null;\r\n        doc.iter(from.line, to.line + 1, function (line) {\r\n            if (line.markedSpans) { for (var i = 0; i < line.markedSpans.length; ++i) {\r\n                var mark = line.markedSpans[i].marker;\r\n                if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))\r\n                { (markers || (markers = [])).push(mark); }\r\n            } }\r\n        });\r\n        if (!markers) { return null }\r\n        var parts = [{from: from, to: to}];\r\n        for (var i = 0; i < markers.length; ++i) {\r\n            var mk = markers[i], m = mk.find(0);\r\n            for (var j = 0; j < parts.length; ++j) {\r\n                var p = parts[j];\r\n                if (cmp(p.to, m.from) < 0 || cmp(p.from, m.to) > 0) { continue }\r\n                var newParts = [j, 1], dfrom = cmp(p.from, m.from), dto = cmp(p.to, m.to);\r\n                if (dfrom < 0 || !mk.inclusiveLeft && !dfrom)\r\n                { newParts.push({from: p.from, to: m.from}); }\r\n                if (dto > 0 || !mk.inclusiveRight && !dto)\r\n                { newParts.push({from: m.to, to: p.to}); }\r\n                parts.splice.apply(parts, newParts);\r\n                j += newParts.length - 3;\r\n            }\r\n        }\r\n        return parts\r\n    }\r\n\r\n    // Connect or disconnect spans from a line.\r\n    function detachMarkedSpans(line) {\r\n        var spans = line.markedSpans;\r\n        if (!spans) { return }\r\n        for (var i = 0; i < spans.length; ++i)\r\n        { spans[i].marker.detachLine(line); }\r\n        line.markedSpans = null;\r\n    }\r\n    function attachMarkedSpans(line, spans) {\r\n        if (!spans) { return }\r\n        for (var i = 0; i < spans.length; ++i)\r\n        { spans[i].marker.attachLine(line); }\r\n        line.markedSpans = spans;\r\n    }\r\n\r\n    // Helpers used when computing which overlapping collapsed span\r\n    // counts as the larger one.\r\n    function extraLeft(marker) { return marker.inclusiveLeft ? -1 : 0 }\r\n    function extraRight(marker) { return marker.inclusiveRight ? 1 : 0 }\r\n\r\n    // Returns a number indicating which of two overlapping collapsed\r\n    // spans is larger (and thus includes the other). Falls back to\r\n    // comparing ids when the spans cover exactly the same range.\r\n    function compareCollapsedMarkers(a, b) {\r\n        var lenDiff = a.lines.length - b.lines.length;\r\n        if (lenDiff != 0) { return lenDiff }\r\n        var aPos = a.find(), bPos = b.find();\r\n        var fromCmp = cmp(aPos.from, bPos.from) || extraLeft(a) - extraLeft(b);\r\n        if (fromCmp) { return -fromCmp }\r\n        var toCmp = cmp(aPos.to, bPos.to) || extraRight(a) - extraRight(b);\r\n        if (toCmp) { return toCmp }\r\n        return b.id - a.id\r\n    }\r\n\r\n    // Find out whether a line ends or starts in a collapsed span. If\r\n    // so, return the marker for that span.\r\n    function collapsedSpanAtSide(line, start) {\r\n        var sps = sawCollapsedSpans && line.markedSpans, found;\r\n        if (sps) { for (var sp = (void 0), i = 0; i < sps.length; ++i) {\r\n            sp = sps[i];\r\n            if (sp.marker.collapsed && (start ? sp.from : sp.to) == null &&\r\n                (!found || compareCollapsedMarkers(found, sp.marker) < 0))\r\n            { found = sp.marker; }\r\n        } }\r\n        return found\r\n    }\r\n    function collapsedSpanAtStart(line) { return collapsedSpanAtSide(line, true) }\r\n    function collapsedSpanAtEnd(line) { return collapsedSpanAtSide(line, false) }\r\n\r\n    function collapsedSpanAround(line, ch) {\r\n        var sps = sawCollapsedSpans && line.markedSpans, found;\r\n        if (sps) { for (var i = 0; i < sps.length; ++i) {\r\n            var sp = sps[i];\r\n            if (sp.marker.collapsed && (sp.from == null || sp.from < ch) && (sp.to == null || sp.to > ch) &&\r\n                (!found || compareCollapsedMarkers(found, sp.marker) < 0)) { found = sp.marker; }\r\n        } }\r\n        return found\r\n    }\r\n\r\n    // Test whether there exists a collapsed span that partially\r\n    // overlaps (covers the start or end, but not both) of a new span.\r\n    // Such overlap is not allowed.\r\n    function conflictingCollapsedRange(doc, lineNo$$1, from, to, marker) {\r\n        var line = getLine(doc, lineNo$$1);\r\n        var sps = sawCollapsedSpans && line.markedSpans;\r\n        if (sps) { for (var i = 0; i < sps.length; ++i) {\r\n            var sp = sps[i];\r\n            if (!sp.marker.collapsed) { continue }\r\n            var found = sp.marker.find(0);\r\n            var fromCmp = cmp(found.from, from) || extraLeft(sp.marker) - extraLeft(marker);\r\n            var toCmp = cmp(found.to, to) || extraRight(sp.marker) - extraRight(marker);\r\n            if (fromCmp >= 0 && toCmp <= 0 || fromCmp <= 0 && toCmp >= 0) { continue }\r\n            if (fromCmp <= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.to, from) >= 0 : cmp(found.to, from) > 0) ||\r\n                fromCmp >= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.from, to) <= 0 : cmp(found.from, to) < 0))\r\n            { return true }\r\n        } }\r\n    }\r\n\r\n    // A visual line is a line as drawn on the screen. Folding, for\r\n    // example, can cause multiple logical lines to appear on the same\r\n    // visual line. This finds the start of the visual line that the\r\n    // given line is part of (usually that is the line itself).\r\n    function visualLine(line) {\r\n        var merged;\r\n        while (merged = collapsedSpanAtStart(line))\r\n        { line = merged.find(-1, true).line; }\r\n        return line\r\n    }\r\n\r\n    function visualLineEnd(line) {\r\n        var merged;\r\n        while (merged = collapsedSpanAtEnd(line))\r\n        { line = merged.find(1, true).line; }\r\n        return line\r\n    }\r\n\r\n    // Returns an array of logical lines that continue the visual line\r\n    // started by the argument, or undefined if there are no such lines.\r\n    function visualLineContinued(line) {\r\n        var merged, lines;\r\n        while (merged = collapsedSpanAtEnd(line)) {\r\n            line = merged.find(1, true).line\r\n            ;(lines || (lines = [])).push(line);\r\n        }\r\n        return lines\r\n    }\r\n\r\n    // Get the line number of the start of the visual line that the\r\n    // given line number is part of.\r\n    function visualLineNo(doc, lineN) {\r\n        var line = getLine(doc, lineN), vis = visualLine(line);\r\n        if (line == vis) { return lineN }\r\n        return lineNo(vis)\r\n    }\r\n\r\n    // Get the line number of the start of the next visual line after\r\n    // the given line.\r\n    function visualLineEndNo(doc, lineN) {\r\n        if (lineN > doc.lastLine()) { return lineN }\r\n        var line = getLine(doc, lineN), merged;\r\n        if (!lineIsHidden(doc, line)) { return lineN }\r\n        while (merged = collapsedSpanAtEnd(line))\r\n        { line = merged.find(1, true).line; }\r\n        return lineNo(line) + 1\r\n    }\r\n\r\n    // Compute whether a line is hidden. Lines count as hidden when they\r\n    // are part of a visual line that starts with another line, or when\r\n    // they are entirely covered by collapsed, non-widget span.\r\n    function lineIsHidden(doc, line) {\r\n        var sps = sawCollapsedSpans && line.markedSpans;\r\n        if (sps) { for (var sp = (void 0), i = 0; i < sps.length; ++i) {\r\n            sp = sps[i];\r\n            if (!sp.marker.collapsed) { continue }\r\n            if (sp.from == null) { return true }\r\n            if (sp.marker.widgetNode) { continue }\r\n            if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))\r\n            { return true }\r\n        } }\r\n    }\r\n    function lineIsHiddenInner(doc, line, span) {\r\n        if (span.to == null) {\r\n            var end = span.marker.find(1, true);\r\n            return lineIsHiddenInner(doc, end.line, getMarkedSpanFor(end.line.markedSpans, span.marker))\r\n        }\r\n        if (span.marker.inclusiveRight && span.to == line.text.length)\r\n        { return true }\r\n        for (var sp = (void 0), i = 0; i < line.markedSpans.length; ++i) {\r\n            sp = line.markedSpans[i];\r\n            if (sp.marker.collapsed && !sp.marker.widgetNode && sp.from == span.to &&\r\n                (sp.to == null || sp.to != span.from) &&\r\n                (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&\r\n                lineIsHiddenInner(doc, line, sp)) { return true }\r\n        }\r\n    }\r\n\r\n    // Find the height above the given line.\r\n    function heightAtLine(lineObj) {\r\n        lineObj = visualLine(lineObj);\r\n\r\n        var h = 0, chunk = lineObj.parent;\r\n        for (var i = 0; i < chunk.lines.length; ++i) {\r\n            var line = chunk.lines[i];\r\n            if (line == lineObj) { break }\r\n            else { h += line.height; }\r\n        }\r\n        for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {\r\n            for (var i$1 = 0; i$1 < p.children.length; ++i$1) {\r\n                var cur = p.children[i$1];\r\n                if (cur == chunk) { break }\r\n                else { h += cur.height; }\r\n            }\r\n        }\r\n        return h\r\n    }\r\n\r\n    // Compute the character length of a line, taking into account\r\n    // collapsed ranges (see markText) that might hide parts, and join\r\n    // other lines onto it.\r\n    function lineLength(line) {\r\n        if (line.height == 0) { return 0 }\r\n        var len = line.text.length, merged, cur = line;\r\n        while (merged = collapsedSpanAtStart(cur)) {\r\n            var found = merged.find(0, true);\r\n            cur = found.from.line;\r\n            len += found.from.ch - found.to.ch;\r\n        }\r\n        cur = line;\r\n        while (merged = collapsedSpanAtEnd(cur)) {\r\n            var found$1 = merged.find(0, true);\r\n            len -= cur.text.length - found$1.from.ch;\r\n            cur = found$1.to.line;\r\n            len += cur.text.length - found$1.to.ch;\r\n        }\r\n        return len\r\n    }\r\n\r\n    // Find the longest line in the document.\r\n    function findMaxLine(cm) {\r\n        var d = cm.display, doc = cm.doc;\r\n        d.maxLine = getLine(doc, doc.first);\r\n        d.maxLineLength = lineLength(d.maxLine);\r\n        d.maxLineChanged = true;\r\n        doc.iter(function (line) {\r\n            var len = lineLength(line);\r\n            if (len > d.maxLineLength) {\r\n                d.maxLineLength = len;\r\n                d.maxLine = line;\r\n            }\r\n        });\r\n    }\r\n\r\n    // BIDI HELPERS\r\n\r\n    function iterateBidiSections(order, from, to, f) {\r\n        if (!order) { return f(from, to, "ltr", 0) }\r\n        var found = false;\r\n        for (var i = 0; i < order.length; ++i) {\r\n            var part = order[i];\r\n            if (part.from < to && part.to > from || from == to && part.to == from) {\r\n                f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? "rtl" : "ltr", i);\r\n                found = true;\r\n            }\r\n        }\r\n        if (!found) { f(from, to, "ltr"); }\r\n    }\r\n\r\n    var bidiOther = null;\r\n    function getBidiPartAt(order, ch, sticky) {\r\n        var found;\r\n        bidiOther = null;\r\n        for (var i = 0; i < order.length; ++i) {\r\n            var cur = order[i];\r\n            if (cur.from < ch && cur.to > ch) { return i }\r\n            if (cur.to == ch) {\r\n                if (cur.from != cur.to && sticky == "before") { found = i; }\r\n                else { bidiOther = i; }\r\n            }\r\n            if (cur.from == ch) {\r\n                if (cur.from != cur.to && sticky != "before") { found = i; }\r\n                else { bidiOther = i; }\r\n            }\r\n        }\r\n        return found != null ? found : bidiOther\r\n    }\r\n\r\n    // Bidirectional ordering algorithm\r\n    // See http://unicode.org/reports/tr9/tr9-13.html for the algorithm\r\n    // that this (partially) implements.\r\n\r\n    // One-char codes used for character types:\r\n    // L (L):   Left-to-Right\r\n    // R (R):   Right-to-Left\r\n    // r (AL):  Right-to-Left Arabic\r\n    // 1 (EN):  European Number\r\n    // + (ES):  European Number Separator\r\n    // % (ET):  European Number Terminator\r\n    // n (AN):  Arabic Number\r\n    // , (CS):  Common Number Separator\r\n    // m (NSM): Non-Spacing Mark\r\n    // b (BN):  Boundary Neutral\r\n    // s (B):   Paragraph Separator\r\n    // t (S):   Segment Separator\r\n    // w (WS):  Whitespace\r\n    // N (ON):  Other Neutrals\r\n\r\n    // Returns null if characters are ordered as they appear\r\n    // (left-to-right), or an array of sections ({from, to, level}\r\n    // objects) in the order in which they occur visually.\r\n    var bidiOrdering = (function() {\r\n        // Character types for codepoints 0 to 0xff\r\n        var lowTypes = "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";\r\n        // Character types for codepoints 0x600 to 0x6f9\r\n        var arabicTypes = "nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";\r\n        function charType(code) {\r\n            if (code <= 0xf7) { return lowTypes.charAt(code) }\r\n            else if (0x590 <= code && code <= 0x5f4) { return "R" }\r\n            else if (0x600 <= code && code <= 0x6f9) { return arabicTypes.charAt(code - 0x600) }\r\n            else if (0x6ee <= code && code <= 0x8ac) { return "r" }\r\n            else if (0x2000 <= code && code <= 0x200b) { return "w" }\r\n            else if (code == 0x200c) { return "b" }\r\n            else { return "L" }\r\n        }\r\n\r\n        var bidiRE = /[\\u0590-\\u05f4\\u0600-\\u06ff\\u0700-\\u08ac]/;\r\n        var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;\r\n\r\n        function BidiSpan(level, from, to) {\r\n            this.level = level;\r\n            this.from = from; this.to = to;\r\n        }\r\n\r\n        return function(str, direction) {\r\n            var outerType = direction == "ltr" ? "L" : "R";\r\n\r\n            if (str.length == 0 || direction == "ltr" && !bidiRE.test(str)) { return false }\r\n            var len = str.length, types = [];\r\n            for (var i = 0; i < len; ++i)\r\n            { types.push(charType(str.charCodeAt(i))); }\r\n\r\n            // W1. Examine each non-spacing mark (NSM) in the level run, and\r\n            // change the type of the NSM to the type of the previous\r\n            // character. If the NSM is at the start of the level run, it will\r\n            // get the type of sor.\r\n            for (var i$1 = 0, prev = outerType; i$1 < len; ++i$1) {\r\n                var type = types[i$1];\r\n                if (type == "m") { types[i$1] = prev; }\r\n                else { prev = type; }\r\n            }\r\n\r\n            // W2. Search backwards from each instance of a European number\r\n            // until the first strong type (R, L, AL, or sor) is found. If an\r\n            // AL is found, change the type of the European number to Arabic\r\n            // number.\r\n            // W3. Change all ALs to R.\r\n            for (var i$2 = 0, cur = outerType; i$2 < len; ++i$2) {\r\n                var type$1 = types[i$2];\r\n                if (type$1 == "1" && cur == "r") { types[i$2] = "n"; }\r\n                else if (isStrong.test(type$1)) { cur = type$1; if (type$1 == "r") { types[i$2] = "R"; } }\r\n            }\r\n\r\n            // W4. A single European separator between two European numbers\r\n            // changes to a European number. A single common separator between\r\n            // two numbers of the same type changes to that type.\r\n            for (var i$3 = 1, prev$1 = types[0]; i$3 < len - 1; ++i$3) {\r\n                var type$2 = types[i$3];\r\n                if (type$2 == "+" && prev$1 == "1" && types[i$3+1] == "1") { types[i$3] = "1"; }\r\n                else if (type$2 == "," && prev$1 == types[i$3+1] &&\r\n                    (prev$1 == "1" || prev$1 == "n")) { types[i$3] = prev$1; }\r\n                prev$1 = type$2;\r\n            }\r\n\r\n            // W5. A sequence of European terminators adjacent to European\r\n            // numbers changes to all European numbers.\r\n            // W6. Otherwise, separators and terminators change to Other\r\n            // Neutral.\r\n            for (var i$4 = 0; i$4 < len; ++i$4) {\r\n                var type$3 = types[i$4];\r\n                if (type$3 == ",") { types[i$4] = "N"; }\r\n                else if (type$3 == "%") {\r\n                    var end = (void 0);\r\n                    for (end = i$4 + 1; end < len && types[end] == "%"; ++end) {}\r\n                    var replace = (i$4 && types[i$4-1] == "!") || (end < len && types[end] == "1") ? "1" : "N";\r\n                    for (var j = i$4; j < end; ++j) { types[j] = replace; }\r\n                    i$4 = end - 1;\r\n                }\r\n            }\r\n\r\n            // W7. Search backwards from each instance of a European number\r\n            // until the first strong type (R, L, or sor) is found. If an L is\r\n            // found, then change the type of the European number to L.\r\n            for (var i$5 = 0, cur$1 = outerType; i$5 < len; ++i$5) {\r\n                var type$4 = types[i$5];\r\n                if (cur$1 == "L" && type$4 == "1") { types[i$5] = "L"; }\r\n                else if (isStrong.test(type$4)) { cur$1 = type$4; }\r\n            }\r\n\r\n            // N1. A sequence of neutrals takes the direction of the\r\n            // surrounding strong text if the text on both sides has the same\r\n            // direction. European and Arabic numbers act as if they were R in\r\n            // terms of their influence on neutrals. Start-of-level-run (sor)\r\n            // and end-of-level-run (eor) are used at level run boundaries.\r\n            // N2. Any remaining neutrals take the embedding direction.\r\n            for (var i$6 = 0; i$6 < len; ++i$6) {\r\n                if (isNeutral.test(types[i$6])) {\r\n                    var end$1 = (void 0);\r\n                    for (end$1 = i$6 + 1; end$1 < len && isNeutral.test(types[end$1]); ++end$1) {}\r\n                    var before = (i$6 ? types[i$6-1] : outerType) == "L";\r\n                    var after = (end$1 < len ? types[end$1] : outerType) == "L";\r\n                    var replace$1 = before == after ? (before ? "L" : "R") : outerType;\r\n                    for (var j$1 = i$6; j$1 < end$1; ++j$1) { types[j$1] = replace$1; }\r\n                    i$6 = end$1 - 1;\r\n                }\r\n            }\r\n\r\n            // Here we depart from the documented algorithm, in order to avoid\r\n            // building up an actual levels array. Since there are only three\r\n            // levels (0, 1, 2) in an implementation that doesn\'t take\r\n            // explicit embedding into account, we can build up the order on\r\n            // the fly, without following the level-based algorithm.\r\n            var order = [], m;\r\n            for (var i$7 = 0; i$7 < len;) {\r\n                if (countsAsLeft.test(types[i$7])) {\r\n                    var start = i$7;\r\n                    for (++i$7; i$7 < len && countsAsLeft.test(types[i$7]); ++i$7) {}\r\n                    order.push(new BidiSpan(0, start, i$7));\r\n                } else {\r\n                    var pos = i$7, at = order.length;\r\n                    for (++i$7; i$7 < len && types[i$7] != "L"; ++i$7) {}\r\n                    for (var j$2 = pos; j$2 < i$7;) {\r\n                        if (countsAsNum.test(types[j$2])) {\r\n                            if (pos < j$2) { order.splice(at, 0, new BidiSpan(1, pos, j$2)); }\r\n                            var nstart = j$2;\r\n                            for (++j$2; j$2 < i$7 && countsAsNum.test(types[j$2]); ++j$2) {}\r\n                            order.splice(at, 0, new BidiSpan(2, nstart, j$2));\r\n                            pos = j$2;\r\n                        } else { ++j$2; }\r\n                    }\r\n                    if (pos < i$7) { order.splice(at, 0, new BidiSpan(1, pos, i$7)); }\r\n                }\r\n            }\r\n            if (direction == "ltr") {\r\n                if (order[0].level == 1 && (m = str.match(/^\\s+/))) {\r\n                    order[0].from = m[0].length;\r\n                    order.unshift(new BidiSpan(0, 0, m[0].length));\r\n                }\r\n                if (lst(order).level == 1 && (m = str.match(/\\s+$/))) {\r\n                    lst(order).to -= m[0].length;\r\n                    order.push(new BidiSpan(0, len - m[0].length, len));\r\n                }\r\n            }\r\n\r\n            return direction == "rtl" ? order.reverse() : order\r\n        }\r\n    })();\r\n\r\n    // Get the bidi ordering for the given line (and cache it). Returns\r\n    // false for lines that are fully left-to-right, and an array of\r\n    // BidiSpan objects otherwise.\r\n    function getOrder(line, direction) {\r\n        var order = line.order;\r\n        if (order == null) { order = line.order = bidiOrdering(line.text, direction); }\r\n        return order\r\n    }\r\n\r\n    // EVENT HANDLING\r\n\r\n    // Lightweight event framework. on/off also work on DOM nodes,\r\n    // registering native DOM handlers.\r\n\r\n    var noHandlers = [];\r\n\r\n    var on = function(emitter, type, f) {\r\n        if (emitter.addEventListener) {\r\n            emitter.addEventListener(type, f, false);\r\n        } else if (emitter.attachEvent) {\r\n            emitter.attachEvent("on" + type, f);\r\n        } else {\r\n            var map$$1 = emitter._handlers || (emitter._handlers = {});\r\n            map$$1[type] = (map$$1[type] || noHandlers).concat(f);\r\n        }\r\n    };\r\n\r\n    function getHandlers(emitter, type) {\r\n        return emitter._handlers && emitter._handlers[type] || noHandlers\r\n    }\r\n\r\n    function off(emitter, type, f) {\r\n        if (emitter.removeEventListener) {\r\n            emitter.removeEventListener(type, f, false);\r\n        } else if (emitter.detachEvent) {\r\n            emitter.detachEvent("on" + type, f);\r\n        } else {\r\n            var map$$1 = emitter._handlers, arr = map$$1 && map$$1[type];\r\n            if (arr) {\r\n                var index = indexOf(arr, f);\r\n                if (index > -1)\r\n                { map$$1[type] = arr.slice(0, index).concat(arr.slice(index + 1)); }\r\n            }\r\n        }\r\n    }\r\n\r\n    function signal(emitter, type /*, values...*/) {\r\n        var handlers = getHandlers(emitter, type);\r\n        if (!handlers.length) { return }\r\n        var args = Array.prototype.slice.call(arguments, 2);\r\n        for (var i = 0; i < handlers.length; ++i) { handlers[i].apply(null, args); }\r\n    }\r\n\r\n    // The DOM events that CodeMirror handles can be overridden by\r\n    // registering a (non-DOM) handler on the editor for the event name,\r\n    // and preventDefault-ing the event in that handler.\r\n    function signalDOMEvent(cm, e, override) {\r\n        if (typeof e == "string")\r\n        { e = {type: e, preventDefault: function() { this.defaultPrevented = true; }}; }\r\n        signal(cm, override || e.type, cm, e);\r\n        return e_defaultPrevented(e) || e.codemirrorIgnore\r\n    }\r\n\r\n    function signalCursorActivity(cm) {\r\n        var arr = cm._handlers && cm._handlers.cursorActivity;\r\n        if (!arr) { return }\r\n        var set = cm.curOp.cursorActivityHandlers || (cm.curOp.cursorActivityHandlers = []);\r\n        for (var i = 0; i < arr.length; ++i) { if (indexOf(set, arr[i]) == -1)\r\n        { set.push(arr[i]); } }\r\n    }\r\n\r\n    function hasHandler(emitter, type) {\r\n        return getHandlers(emitter, type).length > 0\r\n    }\r\n\r\n    // Add on and off methods to a constructor\'s prototype, to make\r\n    // registering events on such objects more convenient.\r\n    function eventMixin(ctor) {\r\n        ctor.prototype.on = function(type, f) {on(this, type, f);};\r\n        ctor.prototype.off = function(type, f) {off(this, type, f);};\r\n    }\r\n\r\n    // Due to the fact that we still support jurassic IE versions, some\r\n    // compatibility wrappers are needed.\r\n\r\n    function e_preventDefault(e) {\r\n        if (e.preventDefault) { e.preventDefault(); }\r\n        else { e.returnValue = false; }\r\n    }\r\n    function e_stopPropagation(e) {\r\n        if (e.stopPropagation) { e.stopPropagation(); }\r\n        else { e.cancelBubble = true; }\r\n    }\r\n    function e_defaultPrevented(e) {\r\n        return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false\r\n    }\r\n    function e_stop(e) {e_preventDefault(e); e_stopPropagation(e);}\r\n\r\n    function e_target(e) {return e.target || e.srcElement}\r\n    function e_button(e) {\r\n        var b = e.which;\r\n        if (b == null) {\r\n            if (e.button & 1) { b = 1; }\r\n            else if (e.button & 2) { b = 3; }\r\n            else if (e.button & 4) { b = 2; }\r\n        }\r\n        if (mac && e.ctrlKey && b == 1) { b = 3; }\r\n        return b\r\n    }\r\n\r\n    // Detect drag-and-drop\r\n    var dragAndDrop = function() {\r\n        // There is *some* kind of drag-and-drop support in IE6-8, but I\r\n        // couldn\'t get it to work yet.\r\n        if (ie && ie_version < 9) { return false }\r\n        var div = elt(\'div\');\r\n        return "draggable" in div || "dragDrop" in div\r\n    }();\r\n\r\n    var zwspSupported;\r\n    function zeroWidthElement(measure) {\r\n        if (zwspSupported == null) {\r\n            var test = elt("span", "\\u200b");\r\n            removeChildrenAndAdd(measure, elt("span", [test, document.createTextNode("x")]));\r\n            if (measure.firstChild.offsetHeight != 0)\r\n            { zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !(ie && ie_version < 8); }\r\n        }\r\n        var node = zwspSupported ? elt("span", "\\u200b") :\r\n            elt("span", "\\u00a0", null, "display: inline-block; width: 1px; margin-right: -1px");\r\n        node.setAttribute("cm-text", "");\r\n        return node\r\n    }\r\n\r\n    // Feature-detect IE\'s crummy client rect reporting for bidi text\r\n    var badBidiRects;\r\n    function hasBadBidiRects(measure) {\r\n        if (badBidiRects != null) { return badBidiRects }\r\n        var txt = removeChildrenAndAdd(measure, document.createTextNode("A\\u062eA"));\r\n        var r0 = range(txt, 0, 1).getBoundingClientRect();\r\n        var r1 = range(txt, 1, 2).getBoundingClientRect();\r\n        removeChildren(measure);\r\n        if (!r0 || r0.left == r0.right) { return false } // Safari returns null in some cases (#2780)\r\n        return badBidiRects = (r1.right - r0.right < 3)\r\n    }\r\n\r\n    // See if "".split is the broken IE version, if so, provide an\r\n    // alternative way to split lines.\r\n    var splitLinesAuto = "\\n\\nb".split(/\\n/).length != 3 ? function (string) {\r\n        var pos = 0, result = [], l = string.length;\r\n        while (pos <= l) {\r\n            var nl = string.indexOf("\\n", pos);\r\n            if (nl == -1) { nl = string.length; }\r\n            var line = string.slice(pos, string.charAt(nl - 1) == "\\r" ? nl - 1 : nl);\r\n            var rt = line.indexOf("\\r");\r\n            if (rt != -1) {\r\n                result.push(line.slice(0, rt));\r\n                pos += rt + 1;\r\n            } else {\r\n                result.push(line);\r\n                pos = nl + 1;\r\n            }\r\n        }\r\n        return result\r\n    } : function (string) { return string.split(/\\r\\n?|\\n/); };\r\n\r\n    var hasSelection = window.getSelection ? function (te) {\r\n        try { return te.selectionStart != te.selectionEnd }\r\n        catch(e) { return false }\r\n    } : function (te) {\r\n        var range$$1;\r\n        try {range$$1 = te.ownerDocument.selection.createRange();}\r\n        catch(e) {}\r\n        if (!range$$1 || range$$1.parentElement() != te) { return false }\r\n        return range$$1.compareEndPoints("StartToEnd", range$$1) != 0\r\n    };\r\n\r\n    var hasCopyEvent = (function () {\r\n        var e = elt("div");\r\n        if ("oncopy" in e) { return true }\r\n        e.setAttribute("oncopy", "return;");\r\n        return typeof e.oncopy == "function"\r\n    })();\r\n\r\n    var badZoomedRects = null;\r\n    function hasBadZoomedRects(measure) {\r\n        if (badZoomedRects != null) { return badZoomedRects }\r\n        var node = removeChildrenAndAdd(measure, elt("span", "x"));\r\n        var normal = node.getBoundingClientRect();\r\n        var fromRange = range(node, 0, 1).getBoundingClientRect();\r\n        return badZoomedRects = Math.abs(normal.left - fromRange.left) > 1\r\n    }\r\n\r\n    // Known modes, by name and by MIME\r\n    var modes = {}, mimeModes = {};\r\n\r\n    // Extra arguments are stored as the mode\'s dependencies, which is\r\n    // used by (legacy) mechanisms like loadmode.js to automatically\r\n    // load a mode. (Preferred mechanism is the require/define calls.)\r\n    function defineMode(name, mode) {\r\n        if (arguments.length > 2)\r\n        { mode.dependencies = Array.prototype.slice.call(arguments, 2); }\r\n        modes[name] = mode;\r\n    }\r\n\r\n    function defineMIME(mime, spec) {\r\n        mimeModes[mime] = spec;\r\n    }\r\n\r\n    // Given a MIME type, a {name, ...options} config object, or a name\r\n    // string, return a mode config object.\r\n    function resolveMode(spec) {\r\n        if (typeof spec == "string" && mimeModes.hasOwnProperty(spec)) {\r\n            spec = mimeModes[spec];\r\n        } else if (spec && typeof spec.name == "string" && mimeModes.hasOwnProperty(spec.name)) {\r\n            var found = mimeModes[spec.name];\r\n            if (typeof found == "string") { found = {name: found}; }\r\n            spec = createObj(found, spec);\r\n            spec.name = found.name;\r\n        } else if (typeof spec == "string" && /^[\\w\\-]+\\/[\\w\\-]+\\+xml$/.test(spec)) {\r\n            return resolveMode("application/xml")\r\n        } else if (typeof spec == "string" && /^[\\w\\-]+\\/[\\w\\-]+\\+json$/.test(spec)) {\r\n            return resolveMode("application/json")\r\n        }\r\n        if (typeof spec == "string") { return {name: spec} }\r\n        else { return spec || {name: "null"} }\r\n    }\r\n\r\n    // Given a mode spec (anything that resolveMode accepts), find and\r\n    // initialize an actual mode object.\r\n    function getMode(options, spec) {\r\n        spec = resolveMode(spec);\r\n        var mfactory = modes[spec.name];\r\n        if (!mfactory) { return getMode(options, "text/plain") }\r\n        var modeObj = mfactory(options, spec);\r\n        if (modeExtensions.hasOwnProperty(spec.name)) {\r\n            var exts = modeExtensions[spec.name];\r\n            for (var prop in exts) {\r\n                if (!exts.hasOwnProperty(prop)) { continue }\r\n                if (modeObj.hasOwnProperty(prop)) { modeObj["_" + prop] = modeObj[prop]; }\r\n                modeObj[prop] = exts[prop];\r\n            }\r\n        }\r\n        modeObj.name = spec.name;\r\n        if (spec.helperType) { modeObj.helperType = spec.helperType; }\r\n        if (spec.modeProps) { for (var prop$1 in spec.modeProps)\r\n        { modeObj[prop$1] = spec.modeProps[prop$1]; } }\r\n\r\n        return modeObj\r\n    }\r\n\r\n    // This can be used to attach properties to mode objects from\r\n    // outside the actual mode definition.\r\n    var modeExtensions = {};\r\n    function extendMode(mode, properties) {\r\n        var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});\r\n        copyObj(properties, exts);\r\n    }\r\n\r\n    function copyState(mode, state) {\r\n        if (state === true) { return state }\r\n        if (mode.copyState) { return mode.copyState(state) }\r\n        var nstate = {};\r\n        for (var n in state) {\r\n            var val = state[n];\r\n            if (val instanceof Array) { val = val.concat([]); }\r\n            nstate[n] = val;\r\n        }\r\n        return nstate\r\n    }\r\n\r\n    // Given a mode and a state (for that mode), find the inner mode and\r\n    // state at the position that the state refers to.\r\n    function innerMode(mode, state) {\r\n        var info;\r\n        while (mode.innerMode) {\r\n            info = mode.innerMode(state);\r\n            if (!info || info.mode == mode) { break }\r\n            state = info.state;\r\n            mode = info.mode;\r\n        }\r\n        return info || {mode: mode, state: state}\r\n    }\r\n\r\n    function startState(mode, a1, a2) {\r\n        return mode.startState ? mode.startState(a1, a2) : true\r\n    }\r\n\r\n    // STRING STREAM\r\n\r\n    // Fed to the mode parsers, provides helper functions to make\r\n    // parsers more succinct.\r\n\r\n    var StringStream = function(string, tabSize, lineOracle) {\r\n        this.pos = this.start = 0;\r\n        this.string = string;\r\n        this.tabSize = tabSize || 8;\r\n        this.lastColumnPos = this.lastColumnValue = 0;\r\n        this.lineStart = 0;\r\n        this.lineOracle = lineOracle;\r\n    };\r\n\r\n    StringStream.prototype.eol = function () {return this.pos >= this.string.length};\r\n    StringStream.prototype.sol = function () {return this.pos == this.lineStart};\r\n    StringStream.prototype.peek = function () {return this.string.charAt(this.pos) || undefined};\r\n    StringStream.prototype.next = function () {\r\n        if (this.pos < this.string.length)\r\n        { return this.string.charAt(this.pos++) }\r\n    };\r\n    StringStream.prototype.eat = function (match) {\r\n        var ch = this.string.charAt(this.pos);\r\n        var ok;\r\n        if (typeof match == "string") { ok = ch == match; }\r\n        else { ok = ch && (match.test ? match.test(ch) : match(ch)); }\r\n        if (ok) {++this.pos; return ch}\r\n    };\r\n    StringStream.prototype.eatWhile = function (match) {\r\n        var start = this.pos;\r\n        while (this.eat(match)){}\r\n        return this.pos > start\r\n    };\r\n    StringStream.prototype.eatSpace = function () {\r\n        var start = this.pos;\r\n        while (/[\\s\\u00a0]/.test(this.string.charAt(this.pos))) { ++this.pos; }\r\n        return this.pos > start\r\n    };\r\n    StringStream.prototype.skipToEnd = function () {this.pos = this.string.length;};\r\n    StringStream.prototype.skipTo = function (ch) {\r\n        var found = this.string.indexOf(ch, this.pos);\r\n        if (found > -1) {this.pos = found; return true}\r\n    };\r\n    StringStream.prototype.backUp = function (n) {this.pos -= n;};\r\n    StringStream.prototype.column = function () {\r\n        if (this.lastColumnPos < this.start) {\r\n            this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);\r\n            this.lastColumnPos = this.start;\r\n        }\r\n        return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0)\r\n    };\r\n    StringStream.prototype.indentation = function () {\r\n        return countColumn(this.string, null, this.tabSize) -\r\n            (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0)\r\n    };\r\n    StringStream.prototype.match = function (pattern, consume, caseInsensitive) {\r\n        if (typeof pattern == "string") {\r\n            var cased = function (str) { return caseInsensitive ? str.toLowerCase() : str; };\r\n            var substr = this.string.substr(this.pos, pattern.length);\r\n            if (cased(substr) == cased(pattern)) {\r\n                if (consume !== false) { this.pos += pattern.length; }\r\n                return true\r\n            }\r\n        } else {\r\n            var match = this.string.slice(this.pos).match(pattern);\r\n            if (match && match.index > 0) { return null }\r\n            if (match && consume !== false) { this.pos += match[0].length; }\r\n            return match\r\n        }\r\n    };\r\n    StringStream.prototype.current = function (){return this.string.slice(this.start, this.pos)};\r\n    StringStream.prototype.hideFirstChars = function (n, inner) {\r\n        this.lineStart += n;\r\n        try { return inner() }\r\n        finally { this.lineStart -= n; }\r\n    };\r\n    StringStream.prototype.lookAhead = function (n) {\r\n        var oracle = this.lineOracle;\r\n        return oracle && oracle.lookAhead(n)\r\n    };\r\n    StringStream.prototype.baseToken = function () {\r\n        var oracle = this.lineOracle;\r\n        return oracle && oracle.baseToken(this.pos)\r\n    };\r\n\r\n    var SavedContext = function(state, lookAhead) {\r\n        this.state = state;\r\n        this.lookAhead = lookAhead;\r\n    };\r\n\r\n    var Context = function(doc, state, line, lookAhead) {\r\n        this.state = state;\r\n        this.doc = doc;\r\n        this.line = line;\r\n        this.maxLookAhead = lookAhead || 0;\r\n        this.baseTokens = null;\r\n        this.baseTokenPos = 1;\r\n    };\r\n\r\n    Context.prototype.lookAhead = function (n) {\r\n        var line = this.doc.getLine(this.line + n);\r\n        if (line != null && n > this.maxLookAhead) { this.maxLookAhead = n; }\r\n        return line\r\n    };\r\n\r\n    Context.prototype.baseToken = function (n) {\r\n        if (!this.baseTokens) { return null }\r\n        while (this.baseTokens[this.baseTokenPos] <= n)\r\n        { this.baseTokenPos += 2; }\r\n        var type = this.baseTokens[this.baseTokenPos + 1];\r\n        return {type: type && type.replace(/( |^)overlay .*/, ""),\r\n            size: this.baseTokens[this.baseTokenPos] - n}\r\n    };\r\n\r\n    Context.prototype.nextLine = function () {\r\n        this.line++;\r\n        if (this.maxLookAhead > 0) { this.maxLookAhead--; }\r\n    };\r\n\r\n    Context.fromSaved = function (doc, saved, line) {\r\n        if (saved instanceof SavedContext)\r\n        { return new Context(doc, copyState(doc.mode, saved.state), line, saved.lookAhead) }\r\n        else\r\n        { return new Context(doc, copyState(doc.mode, saved), line) }\r\n    };\r\n\r\n    Context.prototype.save = function (copy) {\r\n        var state = copy !== false ? copyState(this.doc.mode, this.state) : this.state;\r\n        return this.maxLookAhead > 0 ? new SavedContext(state, this.maxLookAhead) : state\r\n    };\r\n\r\n\r\n    // Compute a style array (an array starting with a mode generation\r\n    // -- for invalidation -- followed by pairs of end positions and\r\n    // style strings), which is used to highlight the tokens on the\r\n    // line.\r\n    function highlightLine(cm, line, context, forceToEnd) {\r\n        // A styles array always starts with a number identifying the\r\n        // mode/overlays that it is based on (for easy invalidation).\r\n        var st = [cm.state.modeGen], lineClasses = {};\r\n        // Compute the base array of styles\r\n        runMode(cm, line.text, cm.doc.mode, context, function (end, style) { return st.push(end, style); },\r\n            lineClasses, forceToEnd);\r\n        var state = context.state;\r\n\r\n        // Run overlays, adjust style array.\r\n        var loop = function ( o ) {\r\n            context.baseTokens = st;\r\n            var overlay = cm.state.overlays[o], i = 1, at = 0;\r\n            context.state = true;\r\n            runMode(cm, line.text, overlay.mode, context, function (end, style) {\r\n                var start = i;\r\n                // Ensure there\'s a token end at the current position, and that i points at it\r\n                while (at < end) {\r\n                    var i_end = st[i];\r\n                    if (i_end > end)\r\n                    { st.splice(i, 1, end, st[i+1], i_end); }\r\n                    i += 2;\r\n                    at = Math.min(end, i_end);\r\n                }\r\n                if (!style) { return }\r\n                if (overlay.opaque) {\r\n                    st.splice(start, i - start, end, "overlay " + style);\r\n                    i = start + 2;\r\n                } else {\r\n                    for (; start < i; start += 2) {\r\n                        var cur = st[start+1];\r\n                        st[start+1] = (cur ? cur + " " : "") + "overlay " + style;\r\n                    }\r\n                }\r\n            }, lineClasses);\r\n            context.state = state;\r\n            context.baseTokens = null;\r\n            context.baseTokenPos = 1;\r\n        };\r\n\r\n        for (var o = 0; o < cm.state.overlays.length; ++o) loop( o );\r\n\r\n        return {styles: st, classes: lineClasses.bgClass || lineClasses.textClass ? lineClasses : null}\r\n    }\r\n\r\n    function getLineStyles(cm, line, updateFrontier) {\r\n        if (!line.styles || line.styles[0] != cm.state.modeGen) {\r\n            var context = getContextBefore(cm, lineNo(line));\r\n            var resetState = line.text.length > cm.options.maxHighlightLength && copyState(cm.doc.mode, context.state);\r\n            var result = highlightLine(cm, line, context);\r\n            if (resetState) { context.state = resetState; }\r\n            line.stateAfter = context.save(!resetState);\r\n            line.styles = result.styles;\r\n            if (result.classes) { line.styleClasses = result.classes; }\r\n            else if (line.styleClasses) { line.styleClasses = null; }\r\n            if (updateFrontier === cm.doc.highlightFrontier)\r\n            { cm.doc.modeFrontier = Math.max(cm.doc.modeFrontier, ++cm.doc.highlightFrontier); }\r\n        }\r\n        return line.styles\r\n    }\r\n\r\n    function getContextBefore(cm, n, precise) {\r\n        var doc = cm.doc, display = cm.display;\r\n        if (!doc.mode.startState) { return new Context(doc, true, n) }\r\n        var start = findStartLine(cm, n, precise);\r\n        var saved = start > doc.first && getLine(doc, start - 1).stateAfter;\r\n        var context = saved ? Context.fromSaved(doc, saved, start) : new Context(doc, startState(doc.mode), start);\r\n\r\n        doc.iter(start, n, function (line) {\r\n            processLine(cm, line.text, context);\r\n            var pos = context.line;\r\n            line.stateAfter = pos == n - 1 || pos % 5 == 0 || pos >= display.viewFrom && pos < display.viewTo ? context.save() : null;\r\n            context.nextLine();\r\n        });\r\n        if (precise) { doc.modeFrontier = context.line; }\r\n        return context\r\n    }\r\n\r\n    // Lightweight form of highlight -- proceed over this line and\r\n    // update state, but don\'t save a style array. Used for lines that\r\n    // aren\'t currently visible.\r\n    function processLine(cm, text, context, startAt) {\r\n        var mode = cm.doc.mode;\r\n        var stream = new StringStream(text, cm.options.tabSize, context);\r\n        stream.start = stream.pos = startAt || 0;\r\n        if (text == "") { callBlankLine(mode, context.state); }\r\n        while (!stream.eol()) {\r\n            readToken(mode, stream, context.state);\r\n            stream.start = stream.pos;\r\n        }\r\n    }\r\n\r\n    function callBlankLine(mode, state) {\r\n        if (mode.blankLine) { return mode.blankLine(state) }\r\n        if (!mode.innerMode) { return }\r\n        var inner = innerMode(mode, state);\r\n        if (inner.mode.blankLine) { return inner.mode.blankLine(inner.state) }\r\n    }\r\n\r\n    function readToken(mode, stream, state, inner) {\r\n        for (var i = 0; i < 10; i++) {\r\n            if (inner) { inner[0] = innerMode(mode, state).mode; }\r\n            var style = mode.token(stream, state);\r\n            if (stream.pos > stream.start) { return style }\r\n        }\r\n        throw new Error("Mode " + mode.name + " failed to advance stream.")\r\n    }\r\n\r\n    var Token = function(stream, type, state) {\r\n        this.start = stream.start; this.end = stream.pos;\r\n        this.string = stream.current();\r\n        this.type = type || null;\r\n        this.state = state;\r\n    };\r\n\r\n    // Utility for getTokenAt and getLineTokens\r\n    function takeToken(cm, pos, precise, asArray) {\r\n        var doc = cm.doc, mode = doc.mode, style;\r\n        pos = clipPos(doc, pos);\r\n        var line = getLine(doc, pos.line), context = getContextBefore(cm, pos.line, precise);\r\n        var stream = new StringStream(line.text, cm.options.tabSize, context), tokens;\r\n        if (asArray) { tokens = []; }\r\n        while ((asArray || stream.pos < pos.ch) && !stream.eol()) {\r\n            stream.start = stream.pos;\r\n            style = readToken(mode, stream, context.state);\r\n            if (asArray) { tokens.push(new Token(stream, style, copyState(doc.mode, context.state))); }\r\n        }\r\n        return asArray ? tokens : new Token(stream, style, context.state)\r\n    }\r\n\r\n    function extractLineClasses(type, output) {\r\n        if (type) { for (;;) {\r\n            var lineClass = type.match(/(?:^|\\s+)line-(background-)?(\\S+)/);\r\n            if (!lineClass) { break }\r\n            type = type.slice(0, lineClass.index) + type.slice(lineClass.index + lineClass[0].length);\r\n            var prop = lineClass[1] ? "bgClass" : "textClass";\r\n            if (output[prop] == null)\r\n            { output[prop] = lineClass[2]; }\r\n            else if (!(new RegExp("(?:^|\\s)" + lineClass[2] + "(?:$|\\s)")).test(output[prop]))\r\n            { output[prop] += " " + lineClass[2]; }\r\n        } }\r\n        return type\r\n    }\r\n\r\n    // Run the given mode\'s parser over a line, calling f for each token.\r\n    function runMode(cm, text, mode, context, f, lineClasses, forceToEnd) {\r\n        var flattenSpans = mode.flattenSpans;\r\n        if (flattenSpans == null) { flattenSpans = cm.options.flattenSpans; }\r\n        var curStart = 0, curStyle = null;\r\n        var stream = new StringStream(text, cm.options.tabSize, context), style;\r\n        var inner = cm.options.addModeClass && [null];\r\n        if (text == "") { extractLineClasses(callBlankLine(mode, context.state), lineClasses); }\r\n        while (!stream.eol()) {\r\n            if (stream.pos > cm.options.maxHighlightLength) {\r\n                flattenSpans = false;\r\n                if (forceToEnd) { processLine(cm, text, context, stream.pos); }\r\n                stream.pos = text.length;\r\n                style = null;\r\n            } else {\r\n                style = extractLineClasses(readToken(mode, stream, context.state, inner), lineClasses);\r\n            }\r\n            if (inner) {\r\n                var mName = inner[0].name;\r\n                if (mName) { style = "m-" + (style ? mName + " " + style : mName); }\r\n            }\r\n            if (!flattenSpans || curStyle != style) {\r\n                while (curStart < stream.start) {\r\n                    curStart = Math.min(stream.start, curStart + 5000);\r\n                    f(curStart, curStyle);\r\n                }\r\n                curStyle = style;\r\n            }\r\n            stream.start = stream.pos;\r\n        }\r\n        while (curStart < stream.pos) {\r\n            // Webkit seems to refuse to render text nodes longer than 57444\r\n            // characters, and returns inaccurate measurements in nodes\r\n            // starting around 5000 chars.\r\n            var pos = Math.min(stream.pos, curStart + 5000);\r\n            f(pos, curStyle);\r\n            curStart = pos;\r\n        }\r\n    }\r\n\r\n    // Finds the line to start with when starting a parse. Tries to\r\n    // find a line with a stateAfter, so that it can start with a\r\n    // valid state. If that fails, it returns the line with the\r\n    // smallest indentation, which tends to need the least context to\r\n    // parse correctly.\r\n    function findStartLine(cm, n, precise) {\r\n        var minindent, minline, doc = cm.doc;\r\n        var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);\r\n        for (var search = n; search > lim; --search) {\r\n            if (search <= doc.first) { return doc.first }\r\n            var line = getLine(doc, search - 1), after = line.stateAfter;\r\n            if (after && (!precise || search + (after instanceof SavedContext ? after.lookAhead : 0) <= doc.modeFrontier))\r\n            { return search }\r\n            var indented = countColumn(line.text, null, cm.options.tabSize);\r\n            if (minline == null || minindent > indented) {\r\n                minline = search - 1;\r\n                minindent = indented;\r\n            }\r\n        }\r\n        return minline\r\n    }\r\n\r\n    function retreatFrontier(doc, n) {\r\n        doc.modeFrontier = Math.min(doc.modeFrontier, n);\r\n        if (doc.highlightFrontier < n - 10) { return }\r\n        var start = doc.first;\r\n        for (var line = n - 1; line > start; line--) {\r\n            var saved = getLine(doc, line).stateAfter;\r\n            // change is on 3\r\n            // state on line 1 looked ahead 2 -- so saw 3\r\n            // test 1 + 2 < 3 should cover this\r\n            if (saved && (!(saved instanceof SavedContext) || line + saved.lookAhead < n)) {\r\n                start = line + 1;\r\n                break\r\n            }\r\n        }\r\n        doc.highlightFrontier = Math.min(doc.highlightFrontier, start);\r\n    }\r\n\r\n    // LINE DATA STRUCTURE\r\n\r\n    // Line objects. These hold state related to a line, including\r\n    // highlighting info (the styles array).\r\n    var Line = function(text, markedSpans, estimateHeight) {\r\n        this.text = text;\r\n        attachMarkedSpans(this, markedSpans);\r\n        this.height = estimateHeight ? estimateHeight(this) : 1;\r\n    };\r\n\r\n    Line.prototype.lineNo = function () { return lineNo(this) };\r\n    eventMixin(Line);\r\n\r\n    // Change the content (text, markers) of a line. Automatically\r\n    // invalidates cached information and tries to re-estimate the\r\n    // line\'s height.\r\n    function updateLine(line, text, markedSpans, estimateHeight) {\r\n        line.text = text;\r\n        if (line.stateAfter) { line.stateAfter = null; }\r\n        if (line.styles) { line.styles = null; }\r\n        if (line.order != null) { line.order = null; }\r\n        detachMarkedSpans(line);\r\n        attachMarkedSpans(line, markedSpans);\r\n        var estHeight = estimateHeight ? estimateHeight(line) : 1;\r\n        if (estHeight != line.height) { updateLineHeight(line, estHeight); }\r\n    }\r\n\r\n    // Detach a line from the document tree and its markers.\r\n    function cleanUpLine(line) {\r\n        line.parent = null;\r\n        detachMarkedSpans(line);\r\n    }\r\n\r\n    // Convert a style as returned by a mode (either null, or a string\r\n    // containing one or more styles) to a CSS style. This is cached,\r\n    // and also looks for line-wide styles.\r\n    var styleToClassCache = {}, styleToClassCacheWithMode = {};\r\n    function interpretTokenStyle(style, options) {\r\n        if (!style || /^\\s*$/.test(style)) { return null }\r\n        var cache = options.addModeClass ? styleToClassCacheWithMode : styleToClassCache;\r\n        return cache[style] ||\r\n            (cache[style] = style.replace(/\\S+/g, "cm-$&"))\r\n    }\r\n\r\n    // Render the DOM representation of the text of a line. Also builds\r\n    // up a \'line map\', which points at the DOM nodes that represent\r\n    // specific stretches of text, and is used by the measuring code.\r\n    // The returned object contains the DOM node, this map, and\r\n    // information about line-wide styles that were set by the mode.\r\n    function buildLineContent(cm, lineView) {\r\n        // The padding-right forces the element to have a \'border\', which\r\n        // is needed on Webkit to be able to get line-level bounding\r\n        // rectangles for it (in measureChar).\r\n        var content = eltP("span", null, null, webkit ? "padding-right: .1px" : null);\r\n        var builder = {pre: eltP("pre", [content], "CodeMirror-line"), content: content,\r\n            col: 0, pos: 0, cm: cm,\r\n            trailingSpace: false,\r\n            splitSpaces: cm.getOption("lineWrapping")};\r\n        lineView.measure = {};\r\n\r\n        // Iterate over the logical lines that make up this visual line.\r\n        for (var i = 0; i <= (lineView.rest ? lineView.rest.length : 0); i++) {\r\n            var line = i ? lineView.rest[i - 1] : lineView.line, order = (void 0);\r\n            builder.pos = 0;\r\n            builder.addToken = buildToken;\r\n            // Optionally wire in some hacks into the token-rendering\r\n            // algorithm, to deal with browser quirks.\r\n            if (hasBadBidiRects(cm.display.measure) && (order = getOrder(line, cm.doc.direction)))\r\n            { builder.addToken = buildTokenBadBidi(builder.addToken, order); }\r\n            builder.map = [];\r\n            var allowFrontierUpdate = lineView != cm.display.externalMeasured && lineNo(line);\r\n            insertLineContent(line, builder, getLineStyles(cm, line, allowFrontierUpdate));\r\n            if (line.styleClasses) {\r\n                if (line.styleClasses.bgClass)\r\n                { builder.bgClass = joinClasses(line.styleClasses.bgClass, builder.bgClass || ""); }\r\n                if (line.styleClasses.textClass)\r\n                { builder.textClass = joinClasses(line.styleClasses.textClass, builder.textClass || ""); }\r\n            }\r\n\r\n            // Ensure at least a single node is present, for measuring.\r\n            if (builder.map.length == 0)\r\n            { builder.map.push(0, 0, builder.content.appendChild(zeroWidthElement(cm.display.measure))); }\r\n\r\n            // Store the map and a cache object for the current logical line\r\n            if (i == 0) {\r\n                lineView.measure.map = builder.map;\r\n                lineView.measure.cache = {};\r\n            } else {\r\n                (lineView.measure.maps || (lineView.measure.maps = [])).push(builder.map)\r\n                ;(lineView.measure.caches || (lineView.measure.caches = [])).push({});\r\n            }\r\n        }\r\n\r\n        // See issue #2901\r\n        if (webkit) {\r\n            var last = builder.content.lastChild;\r\n            if (/\\bcm-tab\\b/.test(last.className) || (last.querySelector && last.querySelector(".cm-tab")))\r\n            { builder.content.className = "cm-tab-wrap-hack"; }\r\n        }\r\n\r\n        signal(cm, "renderLine", cm, lineView.line, builder.pre);\r\n        if (builder.pre.className)\r\n        { builder.textClass = joinClasses(builder.pre.className, builder.textClass || ""); }\r\n\r\n        return builder\r\n    }\r\n\r\n    function defaultSpecialCharPlaceholder(ch) {\r\n        var token = elt("span", "\\u2022", "cm-invalidchar");\r\n        token.title = "\\\\u" + ch.charCodeAt(0).toString(16);\r\n        token.setAttribute("aria-label", token.title);\r\n        return token\r\n    }\r\n\r\n    // Build up the DOM representation for a single token, and add it to\r\n    // the line map. Takes care to render special characters separately.\r\n    function buildToken(builder, text, style, startStyle, endStyle, css, attributes) {\r\n        if (!text) { return }\r\n        var displayText = builder.splitSpaces ? splitSpaces(text, builder.trailingSpace) : text;\r\n        var special = builder.cm.state.specialChars, mustWrap = false;\r\n        var content;\r\n        if (!special.test(text)) {\r\n            builder.col += text.length;\r\n            content = document.createTextNode(displayText);\r\n            builder.map.push(builder.pos, builder.pos + text.length, content);\r\n            if (ie && ie_version < 9) { mustWrap = true; }\r\n            builder.pos += text.length;\r\n        } else {\r\n            content = document.createDocumentFragment();\r\n            var pos = 0;\r\n            while (true) {\r\n                special.lastIndex = pos;\r\n                var m = special.exec(text);\r\n                var skipped = m ? m.index - pos : text.length - pos;\r\n                if (skipped) {\r\n                    var txt = document.createTextNode(displayText.slice(pos, pos + skipped));\r\n                    if (ie && ie_version < 9) { content.appendChild(elt("span", [txt])); }\r\n                    else { content.appendChild(txt); }\r\n                    builder.map.push(builder.pos, builder.pos + skipped, txt);\r\n                    builder.col += skipped;\r\n                    builder.pos += skipped;\r\n                }\r\n                if (!m) { break }\r\n                pos += skipped + 1;\r\n                var txt$1 = (void 0);\r\n                if (m[0] == "\\t") {\r\n                    var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;\r\n                    txt$1 = content.appendChild(elt("span", spaceStr(tabWidth), "cm-tab"));\r\n                    txt$1.setAttribute("role", "presentation");\r\n                    txt$1.setAttribute("cm-text", "\\t");\r\n                    builder.col += tabWidth;\r\n                } else if (m[0] == "\\r" || m[0] == "\\n") {\r\n                    txt$1 = content.appendChild(elt("span", m[0] == "\\r" ? "\\u240d" : "\\u2424", "cm-invalidchar"));\r\n                    txt$1.setAttribute("cm-text", m[0]);\r\n                    builder.col += 1;\r\n                } else {\r\n                    txt$1 = builder.cm.options.specialCharPlaceholder(m[0]);\r\n                    txt$1.setAttribute("cm-text", m[0]);\r\n                    if (ie && ie_version < 9) { content.appendChild(elt("span", [txt$1])); }\r\n                    else { content.appendChild(txt$1); }\r\n                    builder.col += 1;\r\n                }\r\n                builder.map.push(builder.pos, builder.pos + 1, txt$1);\r\n                builder.pos++;\r\n            }\r\n        }\r\n        builder.trailingSpace = displayText.charCodeAt(text.length - 1) == 32;\r\n        if (style || startStyle || endStyle || mustWrap || css) {\r\n            var fullStyle = style || "";\r\n            if (startStyle) { fullStyle += startStyle; }\r\n            if (endStyle) { fullStyle += endStyle; }\r\n            var token = elt("span", [content], fullStyle, css);\r\n            if (attributes) {\r\n                for (var attr in attributes) { if (attributes.hasOwnProperty(attr) && attr != "style" && attr != "class")\r\n                { token.setAttribute(attr, attributes[attr]); } }\r\n            }\r\n            return builder.content.appendChild(token)\r\n        }\r\n        builder.content.appendChild(content);\r\n    }\r\n\r\n    // Change some spaces to NBSP to prevent the browser from collapsing\r\n    // trailing spaces at the end of a line when rendering text (issue #1362).\r\n    function splitSpaces(text, trailingBefore) {\r\n        if (text.length > 1 && !/  /.test(text)) { return text }\r\n        var spaceBefore = trailingBefore, result = "";\r\n        for (var i = 0; i < text.length; i++) {\r\n            var ch = text.charAt(i);\r\n            if (ch == " " && spaceBefore && (i == text.length - 1 || text.charCodeAt(i + 1) == 32))\r\n            { ch = "\\u00a0"; }\r\n            result += ch;\r\n            spaceBefore = ch == " ";\r\n        }\r\n        return result\r\n    }\r\n\r\n    // Work around nonsense dimensions being reported for stretches of\r\n    // right-to-left text.\r\n    function buildTokenBadBidi(inner, order) {\r\n        return function (builder, text, style, startStyle, endStyle, css, attributes) {\r\n            style = style ? style + " cm-force-border" : "cm-force-border";\r\n            var start = builder.pos, end = start + text.length;\r\n            for (;;) {\r\n                // Find the part that overlaps with the start of this text\r\n                var part = (void 0);\r\n                for (var i = 0; i < order.length; i++) {\r\n                    part = order[i];\r\n                    if (part.to > start && part.from <= start) { break }\r\n                }\r\n                if (part.to >= end) { return inner(builder, text, style, startStyle, endStyle, css, attributes) }\r\n                inner(builder, text.slice(0, part.to - start), style, startStyle, null, css, attributes);\r\n                startStyle = null;\r\n                text = text.slice(part.to - start);\r\n                start = part.to;\r\n            }\r\n        }\r\n    }\r\n\r\n    function buildCollapsedSpan(builder, size, marker, ignoreWidget) {\r\n        var widget = !ignoreWidget && marker.widgetNode;\r\n        if (widget) { builder.map.push(builder.pos, builder.pos + size, widget); }\r\n        if (!ignoreWidget && builder.cm.display.input.needsContentAttribute) {\r\n            if (!widget)\r\n            { widget = builder.content.appendChild(document.createElement("span")); }\r\n            widget.setAttribute("cm-marker", marker.id);\r\n        }\r\n        if (widget) {\r\n            builder.cm.display.input.setUneditable(widget);\r\n            builder.content.appendChild(widget);\r\n        }\r\n        builder.pos += size;\r\n        builder.trailingSpace = false;\r\n    }\r\n\r\n    // Outputs a number of spans to make up a line, taking highlighting\r\n    // and marked text into account.\r\n    function insertLineContent(line, builder, styles) {\r\n        var spans = line.markedSpans, allText = line.text, at = 0;\r\n        if (!spans) {\r\n            for (var i$1 = 1; i$1 < styles.length; i$1+=2)\r\n            { builder.addToken(builder, allText.slice(at, at = styles[i$1]), interpretTokenStyle(styles[i$1+1], builder.cm.options)); }\r\n            return\r\n        }\r\n\r\n        var len = allText.length, pos = 0, i = 1, text = "", style, css;\r\n        var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, collapsed, attributes;\r\n        for (;;) {\r\n            if (nextChange == pos) { // Update current marker set\r\n                spanStyle = spanEndStyle = spanStartStyle = css = "";\r\n                attributes = null;\r\n                collapsed = null; nextChange = Infinity;\r\n                var foundBookmarks = [], endStyles = (void 0);\r\n                for (var j = 0; j < spans.length; ++j) {\r\n                    var sp = spans[j], m = sp.marker;\r\n                    if (m.type == "bookmark" && sp.from == pos && m.widgetNode) {\r\n                        foundBookmarks.push(m);\r\n                    } else if (sp.from <= pos && (sp.to == null || sp.to > pos || m.collapsed && sp.to == pos && sp.from == pos)) {\r\n                        if (sp.to != null && sp.to != pos && nextChange > sp.to) {\r\n                            nextChange = sp.to;\r\n                            spanEndStyle = "";\r\n                        }\r\n                        if (m.className) { spanStyle += " " + m.className; }\r\n                        if (m.css) { css = (css ? css + ";" : "") + m.css; }\r\n                        if (m.startStyle && sp.from == pos) { spanStartStyle += " " + m.startStyle; }\r\n                        if (m.endStyle && sp.to == nextChange) { (endStyles || (endStyles = [])).push(m.endStyle, sp.to); }\r\n                        // support for the old title property\r\n                        // https://github.com/codemirror/CodeMirror/pull/5673\r\n                        if (m.title) { (attributes || (attributes = {})).title = m.title; }\r\n                        if (m.attributes) {\r\n                            for (var attr in m.attributes)\r\n                            { (attributes || (attributes = {}))[attr] = m.attributes[attr]; }\r\n                        }\r\n                        if (m.collapsed && (!collapsed || compareCollapsedMarkers(collapsed.marker, m) < 0))\r\n                        { collapsed = sp; }\r\n                    } else if (sp.from > pos && nextChange > sp.from) {\r\n                        nextChange = sp.from;\r\n                    }\r\n                }\r\n                if (endStyles) { for (var j$1 = 0; j$1 < endStyles.length; j$1 += 2)\r\n                { if (endStyles[j$1 + 1] == nextChange) { spanEndStyle += " " + endStyles[j$1]; } } }\r\n\r\n                if (!collapsed || collapsed.from == pos) { for (var j$2 = 0; j$2 < foundBookmarks.length; ++j$2)\r\n                { buildCollapsedSpan(builder, 0, foundBookmarks[j$2]); } }\r\n                if (collapsed && (collapsed.from || 0) == pos) {\r\n                    buildCollapsedSpan(builder, (collapsed.to == null ? len + 1 : collapsed.to) - pos,\r\n                        collapsed.marker, collapsed.from == null);\r\n                    if (collapsed.to == null) { return }\r\n                    if (collapsed.to == pos) { collapsed = false; }\r\n                }\r\n            }\r\n            if (pos >= len) { break }\r\n\r\n            var upto = Math.min(len, nextChange);\r\n            while (true) {\r\n                if (text) {\r\n                    var end = pos + text.length;\r\n                    if (!collapsed) {\r\n                        var tokenText = end > upto ? text.slice(0, upto - pos) : text;\r\n                        builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,\r\n                            spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : "", css, attributes);\r\n                    }\r\n                    if (end >= upto) {text = text.slice(upto - pos); pos = upto; break}\r\n                    pos = end;\r\n                    spanStartStyle = "";\r\n                }\r\n                text = allText.slice(at, at = styles[i++]);\r\n                style = interpretTokenStyle(styles[i++], builder.cm.options);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    // These objects are used to represent the visible (currently drawn)\r\n    // part of the document. A LineView may correspond to multiple\r\n    // logical lines, if those are connected by collapsed ranges.\r\n    function LineView(doc, line, lineN) {\r\n        // The starting line\r\n        this.line = line;\r\n        // Continuing lines, if any\r\n        this.rest = visualLineContinued(line);\r\n        // Number of logical lines in this visual line\r\n        this.size = this.rest ? lineNo(lst(this.rest)) - lineN + 1 : 1;\r\n        this.node = this.text = null;\r\n        this.hidden = lineIsHidden(doc, line);\r\n    }\r\n\r\n    // Create a range of LineView objects for the given lines.\r\n    function buildViewArray(cm, from, to) {\r\n        var array = [], nextPos;\r\n        for (var pos = from; pos < to; pos = nextPos) {\r\n            var view = new LineView(cm.doc, getLine(cm.doc, pos), pos);\r\n            nextPos = pos + view.size;\r\n            array.push(view);\r\n        }\r\n        return array\r\n    }\r\n\r\n    var operationGroup = null;\r\n\r\n    function pushOperation(op) {\r\n        if (operationGroup) {\r\n            operationGroup.ops.push(op);\r\n        } else {\r\n            op.ownsGroup = operationGroup = {\r\n                ops: [op],\r\n                delayedCallbacks: []\r\n            };\r\n        }\r\n    }\r\n\r\n    function fireCallbacksForOps(group) {\r\n        // Calls delayed callbacks and cursorActivity handlers until no\r\n        // new ones appear\r\n        var callbacks = group.delayedCallbacks, i = 0;\r\n        do {\r\n            for (; i < callbacks.length; i++)\r\n            { callbacks[i].call(null); }\r\n            for (var j = 0; j < group.ops.length; j++) {\r\n                var op = group.ops[j];\r\n                if (op.cursorActivityHandlers)\r\n                { while (op.cursorActivityCalled < op.cursorActivityHandlers.length)\r\n                { op.cursorActivityHandlers[op.cursorActivityCalled++].call(null, op.cm); } }\r\n            }\r\n        } while (i < callbacks.length)\r\n    }\r\n\r\n    function finishOperation(op, endCb) {\r\n        var group = op.ownsGroup;\r\n        if (!group) { return }\r\n\r\n        try { fireCallbacksForOps(group); }\r\n        finally {\r\n            operationGroup = null;\r\n            endCb(group);\r\n        }\r\n    }\r\n\r\n    var orphanDelayedCallbacks = null;\r\n\r\n    // Often, we want to signal events at a point where we are in the\r\n    // middle of some work, but don\'t want the handler to start calling\r\n    // other methods on the editor, which might be in an inconsistent\r\n    // state or simply not expect any other events to happen.\r\n    // signalLater looks whether there are any handlers, and schedules\r\n    // them to be executed when the last operation ends, or, if no\r\n    // operation is active, when a timeout fires.\r\n    function signalLater(emitter, type /*, values...*/) {\r\n        var arr = getHandlers(emitter, type);\r\n        if (!arr.length) { return }\r\n        var args = Array.prototype.slice.call(arguments, 2), list;\r\n        if (operationGroup) {\r\n            list = operationGroup.delayedCallbacks;\r\n        } else if (orphanDelayedCallbacks) {\r\n            list = orphanDelayedCallbacks;\r\n        } else {\r\n            list = orphanDelayedCallbacks = [];\r\n            setTimeout(fireOrphanDelayed, 0);\r\n        }\r\n        var loop = function ( i ) {\r\n            list.push(function () { return arr[i].apply(null, args); });\r\n        };\r\n\r\n        for (var i = 0; i < arr.length; ++i)\r\n            loop( i );\r\n    }\r\n\r\n    function fireOrphanDelayed() {\r\n        var delayed = orphanDelayedCallbacks;\r\n        orphanDelayedCallbacks = null;\r\n        for (var i = 0; i < delayed.length; ++i) { delayed[i](); }\r\n    }\r\n\r\n    // When an aspect of a line changes, a string is added to\r\n    // lineView.changes. This updates the relevant part of the line\'s\r\n    // DOM structure.\r\n    function updateLineForChanges(cm, lineView, lineN, dims) {\r\n        for (var j = 0; j < lineView.changes.length; j++) {\r\n            var type = lineView.changes[j];\r\n            if (type == "text") { updateLineText(cm, lineView); }\r\n            else if (type == "gutter") { updateLineGutter(cm, lineView, lineN, dims); }\r\n            else if (type == "class") { updateLineClasses(cm, lineView); }\r\n            else if (type == "widget") { updateLineWidgets(cm, lineView, dims); }\r\n        }\r\n        lineView.changes = null;\r\n    }\r\n\r\n    // Lines with gutter elements, widgets or a background class need to\r\n    // be wrapped, and have the extra elements added to the wrapper div\r\n    function ensureLineWrapped(lineView) {\r\n        if (lineView.node == lineView.text) {\r\n            lineView.node = elt("div", null, null, "position: relative");\r\n            if (lineView.text.parentNode)\r\n            { lineView.text.parentNode.replaceChild(lineView.node, lineView.text); }\r\n            lineView.node.appendChild(lineView.text);\r\n            if (ie && ie_version < 8) { lineView.node.style.zIndex = 2; }\r\n        }\r\n        return lineView.node\r\n    }\r\n\r\n    function updateLineBackground(cm, lineView) {\r\n        var cls = lineView.bgClass ? lineView.bgClass + " " + (lineView.line.bgClass || "") : lineView.line.bgClass;\r\n        if (cls) { cls += " CodeMirror-linebackground"; }\r\n        if (lineView.background) {\r\n            if (cls) { lineView.background.className = cls; }\r\n            else { lineView.background.parentNode.removeChild(lineView.background); lineView.background = null; }\r\n        } else if (cls) {\r\n            var wrap = ensureLineWrapped(lineView);\r\n            lineView.background = wrap.insertBefore(elt("div", null, cls), wrap.firstChild);\r\n            cm.display.input.setUneditable(lineView.background);\r\n        }\r\n    }\r\n\r\n    // Wrapper around buildLineContent which will reuse the structure\r\n    // in display.externalMeasured when possible.\r\n    function getLineContent(cm, lineView) {\r\n        var ext = cm.display.externalMeasured;\r\n        if (ext && ext.line == lineView.line) {\r\n            cm.display.externalMeasured = null;\r\n            lineView.measure = ext.measure;\r\n            return ext.built\r\n        }\r\n        return buildLineContent(cm, lineView)\r\n    }\r\n\r\n    // Redraw the line\'s text. Interacts with the background and text\r\n    // classes because the mode may output tokens that influence these\r\n    // classes.\r\n    function updateLineText(cm, lineView) {\r\n        var cls = lineView.text.className;\r\n        var built = getLineContent(cm, lineView);\r\n        if (lineView.text == lineView.node) { lineView.node = built.pre; }\r\n        lineView.text.parentNode.replaceChild(built.pre, lineView.text);\r\n        lineView.text = built.pre;\r\n        if (built.bgClass != lineView.bgClass || built.textClass != lineView.textClass) {\r\n            lineView.bgClass = built.bgClass;\r\n            lineView.textClass = built.textClass;\r\n            updateLineClasses(cm, lineView);\r\n        } else if (cls) {\r\n            lineView.text.className = cls;\r\n        }\r\n    }\r\n\r\n    function updateLineClasses(cm, lineView) {\r\n        updateLineBackground(cm, lineView);\r\n        if (lineView.line.wrapClass)\r\n        { ensureLineWrapped(lineView).className = lineView.line.wrapClass; }\r\n        else if (lineView.node != lineView.text)\r\n        { lineView.node.className = ""; }\r\n        var textClass = lineView.textClass ? lineView.textClass + " " + (lineView.line.textClass || "") : lineView.line.textClass;\r\n        lineView.text.className = textClass || "";\r\n    }\r\n\r\n    function updateLineGutter(cm, lineView, lineN, dims) {\r\n        if (lineView.gutter) {\r\n            lineView.node.removeChild(lineView.gutter);\r\n            lineView.gutter = null;\r\n        }\r\n        if (lineView.gutterBackground) {\r\n            lineView.node.removeChild(lineView.gutterBackground);\r\n            lineView.gutterBackground = null;\r\n        }\r\n        if (lineView.line.gutterClass) {\r\n            var wrap = ensureLineWrapped(lineView);\r\n            lineView.gutterBackground = elt("div", null, "CodeMirror-gutter-background " + lineView.line.gutterClass,\r\n                ("left: " + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + "px; width: " + (dims.gutterTotalWidth) + "px"));\r\n            cm.display.input.setUneditable(lineView.gutterBackground);\r\n            wrap.insertBefore(lineView.gutterBackground, lineView.text);\r\n        }\r\n        var markers = lineView.line.gutterMarkers;\r\n        if (cm.options.lineNumbers || markers) {\r\n            var wrap$1 = ensureLineWrapped(lineView);\r\n            var gutterWrap = lineView.gutter = elt("div", null, "CodeMirror-gutter-wrapper", ("left: " + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + "px"));\r\n            cm.display.input.setUneditable(gutterWrap);\r\n            wrap$1.insertBefore(gutterWrap, lineView.text);\r\n            if (lineView.line.gutterClass)\r\n            { gutterWrap.className += " " + lineView.line.gutterClass; }\r\n            if (cm.options.lineNumbers && (!markers || !markers["CodeMirror-linenumbers"]))\r\n            { lineView.lineNumber = gutterWrap.appendChild(\r\n                elt("div", lineNumberFor(cm.options, lineN),\r\n                    "CodeMirror-linenumber CodeMirror-gutter-elt",\r\n                    ("left: " + (dims.gutterLeft["CodeMirror-linenumbers"]) + "px; width: " + (cm.display.lineNumInnerWidth) + "px"))); }\r\n            if (markers) { for (var k = 0; k < cm.options.gutters.length; ++k) {\r\n                var id = cm.options.gutters[k], found = markers.hasOwnProperty(id) && markers[id];\r\n                if (found)\r\n                { gutterWrap.appendChild(elt("div", [found], "CodeMirror-gutter-elt",\r\n                    ("left: " + (dims.gutterLeft[id]) + "px; width: " + (dims.gutterWidth[id]) + "px"))); }\r\n            } }\r\n        }\r\n    }\r\n\r\n    function updateLineWidgets(cm, lineView, dims) {\r\n        if (lineView.alignable) { lineView.alignable = null; }\r\n        for (var node = lineView.node.firstChild, next = (void 0); node; node = next) {\r\n            next = node.nextSibling;\r\n            if (node.className == "CodeMirror-linewidget")\r\n            { lineView.node.removeChild(node); }\r\n        }\r\n        insertLineWidgets(cm, lineView, dims);\r\n    }\r\n\r\n    // Build a line\'s DOM representation from scratch\r\n    function buildLineElement(cm, lineView, lineN, dims) {\r\n        var built = getLineContent(cm, lineView);\r\n        lineView.text = lineView.node = built.pre;\r\n        if (built.bgClass) { lineView.bgClass = built.bgClass; }\r\n        if (built.textClass) { lineView.textClass = built.textClass; }\r\n\r\n        updateLineClasses(cm, lineView);\r\n        updateLineGutter(cm, lineView, lineN, dims);\r\n        insertLineWidgets(cm, lineView, dims);\r\n        return lineView.node\r\n    }\r\n\r\n    // A lineView may contain multiple logical lines (when merged by\r\n    // collapsed spans). The widgets for all of them need to be drawn.\r\n    function insertLineWidgets(cm, lineView, dims) {\r\n        insertLineWidgetsFor(cm, lineView.line, lineView, dims, true);\r\n        if (lineView.rest) { for (var i = 0; i < lineView.rest.length; i++)\r\n        { insertLineWidgetsFor(cm, lineView.rest[i], lineView, dims, false); } }\r\n    }\r\n\r\n    function insertLineWidgetsFor(cm, line, lineView, dims, allowAbove) {\r\n        if (!line.widgets) { return }\r\n        var wrap = ensureLineWrapped(lineView);\r\n        for (var i = 0, ws = line.widgets; i < ws.length; ++i) {\r\n            var widget = ws[i], node = elt("div", [widget.node], "CodeMirror-linewidget");\r\n            if (!widget.handleMouseEvents) { node.setAttribute("cm-ignore-events", "true"); }\r\n            positionLineWidget(widget, node, lineView, dims);\r\n            cm.display.input.setUneditable(node);\r\n            if (allowAbove && widget.above)\r\n            { wrap.insertBefore(node, lineView.gutter || lineView.text); }\r\n            else\r\n            { wrap.appendChild(node); }\r\n            signalLater(widget, "redraw");\r\n        }\r\n    }\r\n\r\n    function positionLineWidget(widget, node, lineView, dims) {\r\n        if (widget.noHScroll) {\r\n            (lineView.alignable || (lineView.alignable = [])).push(node);\r\n            var width = dims.wrapperWidth;\r\n            node.style.left = dims.fixedPos + "px";\r\n            if (!widget.coverGutter) {\r\n                width -= dims.gutterTotalWidth;\r\n                node.style.paddingLeft = dims.gutterTotalWidth + "px";\r\n            }\r\n            node.style.width = width + "px";\r\n        }\r\n        if (widget.coverGutter) {\r\n            node.style.zIndex = 5;\r\n            node.style.position = "relative";\r\n            if (!widget.noHScroll) { node.style.marginLeft = -dims.gutterTotalWidth + "px"; }\r\n        }\r\n    }\r\n\r\n    function widgetHeight(widget) {\r\n        if (widget.height != null) { return widget.height }\r\n        var cm = widget.doc.cm;\r\n        if (!cm) { return 0 }\r\n        if (!contains(document.body, widget.node)) {\r\n            var parentStyle = "position: relative;";\r\n            if (widget.coverGutter)\r\n            { parentStyle += "margin-left: -" + cm.display.gutters.offsetWidth + "px;"; }\r\n            if (widget.noHScroll)\r\n            { parentStyle += "width: " + cm.display.wrapper.clientWidth + "px;"; }\r\n            removeChildrenAndAdd(cm.display.measure, elt("div", [widget.node], null, parentStyle));\r\n        }\r\n        return widget.height = widget.node.parentNode.offsetHeight\r\n    }\r\n\r\n    // Return true when the given mouse event happened in a widget\r\n    function eventInWidget(display, e) {\r\n        for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {\r\n            if (!n || (n.nodeType == 1 && n.getAttribute("cm-ignore-events") == "true") ||\r\n                (n.parentNode == display.sizer && n != display.mover))\r\n            { return true }\r\n        }\r\n    }\r\n\r\n    // POSITION MEASUREMENT\r\n\r\n    function paddingTop(display) {return display.lineSpace.offsetTop}\r\n    function paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight}\r\n    function paddingH(display) {\r\n        if (display.cachedPaddingH) { return display.cachedPaddingH }\r\n        var e = removeChildrenAndAdd(display.measure, elt("pre", "x"));\r\n        var style = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;\r\n        var data = {left: parseInt(style.paddingLeft), right: parseInt(style.paddingRight)};\r\n        if (!isNaN(data.left) && !isNaN(data.right)) { display.cachedPaddingH = data; }\r\n        return data\r\n    }\r\n\r\n    function scrollGap(cm) { return scrollerGap - cm.display.nativeBarWidth }\r\n    function displayWidth(cm) {\r\n        return cm.display.scroller.clientWidth - scrollGap(cm) - cm.display.barWidth\r\n    }\r\n    function displayHeight(cm) {\r\n        return cm.display.scroller.clientHeight - scrollGap(cm) - cm.display.barHeight\r\n    }\r\n\r\n    // Ensure the lineView.wrapping.heights array is populated. This is\r\n    // an array of bottom offsets for the lines that make up a drawn\r\n    // line. When lineWrapping is on, there might be more than one\r\n    // height.\r\n    function ensureLineHeights(cm, lineView, rect) {\r\n        var wrapping = cm.options.lineWrapping;\r\n        var curWidth = wrapping && displayWidth(cm);\r\n        if (!lineView.measure.heights || wrapping && lineView.measure.width != curWidth) {\r\n            var heights = lineView.measure.heights = [];\r\n            if (wrapping) {\r\n                lineView.measure.width = curWidth;\r\n                var rects = lineView.text.firstChild.getClientRects();\r\n                for (var i = 0; i < rects.length - 1; i++) {\r\n                    var cur = rects[i], next = rects[i + 1];\r\n                    if (Math.abs(cur.bottom - next.bottom) > 2)\r\n                    { heights.push((cur.bottom + next.top) / 2 - rect.top); }\r\n                }\r\n            }\r\n            heights.push(rect.bottom - rect.top);\r\n        }\r\n    }\r\n\r\n    // Find a line map (mapping character offsets to text nodes) and a\r\n    // measurement cache for the given line number. (A line view might\r\n    // contain multiple lines when collapsed ranges are present.)\r\n    function mapFromLineView(lineView, line, lineN) {\r\n        if (lineView.line == line)\r\n        { return {map: lineView.measure.map, cache: lineView.measure.cache} }\r\n        for (var i = 0; i < lineView.rest.length; i++)\r\n        { if (lineView.rest[i] == line)\r\n        { return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]} } }\r\n        for (var i$1 = 0; i$1 < lineView.rest.length; i$1++)\r\n        { if (lineNo(lineView.rest[i$1]) > lineN)\r\n        { return {map: lineView.measure.maps[i$1], cache: lineView.measure.caches[i$1], before: true} } }\r\n    }\r\n\r\n    // Render a line into the hidden node display.externalMeasured. Used\r\n    // when measurement is needed for a line that\'s not in the viewport.\r\n    function updateExternalMeasurement(cm, line) {\r\n        line = visualLine(line);\r\n        var lineN = lineNo(line);\r\n        var view = cm.display.externalMeasured = new LineView(cm.doc, line, lineN);\r\n        view.lineN = lineN;\r\n        var built = view.built = buildLineContent(cm, view);\r\n        view.text = built.pre;\r\n        removeChildrenAndAdd(cm.display.lineMeasure, built.pre);\r\n        return view\r\n    }\r\n\r\n    // Get a {top, bottom, left, right} box (in line-local coordinates)\r\n    // for a given character.\r\n    function measureChar(cm, line, ch, bias) {\r\n        return measureCharPrepared(cm, prepareMeasureForLine(cm, line), ch, bias)\r\n    }\r\n\r\n    // Find a line view that corresponds to the given line number.\r\n    function findViewForLine(cm, lineN) {\r\n        if (lineN >= cm.display.viewFrom && lineN < cm.display.viewTo)\r\n        { return cm.display.view[findViewIndex(cm, lineN)] }\r\n        var ext = cm.display.externalMeasured;\r\n        if (ext && lineN >= ext.lineN && lineN < ext.lineN + ext.size)\r\n        { return ext }\r\n    }\r\n\r\n    // Measurement can be split in two steps, the set-up work that\r\n    // applies to the whole line, and the measurement of the actual\r\n    // character. Functions like coordsChar, that need to do a lot of\r\n    // measurements in a row, can thus ensure that the set-up work is\r\n    // only done once.\r\n    function prepareMeasureForLine(cm, line) {\r\n        var lineN = lineNo(line);\r\n        var view = findViewForLine(cm, lineN);\r\n        if (view && !view.text) {\r\n            view = null;\r\n        } else if (view && view.changes) {\r\n            updateLineForChanges(cm, view, lineN, getDimensions(cm));\r\n            cm.curOp.forceUpdate = true;\r\n        }\r\n        if (!view)\r\n        { view = updateExternalMeasurement(cm, line); }\r\n\r\n        var info = mapFromLineView(view, line, lineN);\r\n        return {\r\n            line: line, view: view, rect: null,\r\n            map: info.map, cache: info.cache, before: info.before,\r\n            hasHeights: false\r\n        }\r\n    }\r\n\r\n    // Given a prepared measurement object, measures the position of an\r\n    // actual character (or fetches it from the cache).\r\n    function measureCharPrepared(cm, prepared, ch, bias, varHeight) {\r\n        if (prepared.before) { ch = -1; }\r\n        var key = ch + (bias || ""), found;\r\n        if (prepared.cache.hasOwnProperty(key)) {\r\n            found = prepared.cache[key];\r\n        } else {\r\n            if (!prepared.rect)\r\n            { prepared.rect = prepared.view.text.getBoundingClientRect(); }\r\n            if (!prepared.hasHeights) {\r\n                ensureLineHeights(cm, prepared.view, prepared.rect);\r\n                prepared.hasHeights = true;\r\n            }\r\n            found = measureCharInner(cm, prepared, ch, bias);\r\n            if (!found.bogus) { prepared.cache[key] = found; }\r\n        }\r\n        return {left: found.left, right: found.right,\r\n            top: varHeight ? found.rtop : found.top,\r\n            bottom: varHeight ? found.rbottom : found.bottom}\r\n    }\r\n\r\n    var nullRect = {left: 0, right: 0, top: 0, bottom: 0};\r\n\r\n    function nodeAndOffsetInLineMap(map$$1, ch, bias) {\r\n        var node, start, end, collapse, mStart, mEnd;\r\n        // First, search the line map for the text node corresponding to,\r\n        // or closest to, the target character.\r\n        for (var i = 0; i < map$$1.length; i += 3) {\r\n            mStart = map$$1[i];\r\n            mEnd = map$$1[i + 1];\r\n            if (ch < mStart) {\r\n                start = 0; end = 1;\r\n                collapse = "left";\r\n            } else if (ch < mEnd) {\r\n                start = ch - mStart;\r\n                end = start + 1;\r\n            } else if (i == map$$1.length - 3 || ch == mEnd && map$$1[i + 3] > ch) {\r\n                end = mEnd - mStart;\r\n                start = end - 1;\r\n                if (ch >= mEnd) { collapse = "right"; }\r\n            }\r\n            if (start != null) {\r\n                node = map$$1[i + 2];\r\n                if (mStart == mEnd && bias == (node.insertLeft ? "left" : "right"))\r\n                { collapse = bias; }\r\n                if (bias == "left" && start == 0)\r\n                { while (i && map$$1[i - 2] == map$$1[i - 3] && map$$1[i - 1].insertLeft) {\r\n                    node = map$$1[(i -= 3) + 2];\r\n                    collapse = "left";\r\n                } }\r\n                if (bias == "right" && start == mEnd - mStart)\r\n                { while (i < map$$1.length - 3 && map$$1[i + 3] == map$$1[i + 4] && !map$$1[i + 5].insertLeft) {\r\n                    node = map$$1[(i += 3) + 2];\r\n                    collapse = "right";\r\n                } }\r\n                break\r\n            }\r\n        }\r\n        return {node: node, start: start, end: end, collapse: collapse, coverStart: mStart, coverEnd: mEnd}\r\n    }\r\n\r\n    function getUsefulRect(rects, bias) {\r\n        var rect = nullRect;\r\n        if (bias == "left") { for (var i = 0; i < rects.length; i++) {\r\n            if ((rect = rects[i]).left != rect.right) { break }\r\n        } } else { for (var i$1 = rects.length - 1; i$1 >= 0; i$1--) {\r\n            if ((rect = rects[i$1]).left != rect.right) { break }\r\n        } }\r\n        return rect\r\n    }\r\n\r\n    function measureCharInner(cm, prepared, ch, bias) {\r\n        var place = nodeAndOffsetInLineMap(prepared.map, ch, bias);\r\n        var node = place.node, start = place.start, end = place.end, collapse = place.collapse;\r\n\r\n        var rect;\r\n        if (node.nodeType == 3) { // If it is a text node, use a range to retrieve the coordinates.\r\n            for (var i$1 = 0; i$1 < 4; i$1++) { // Retry a maximum of 4 times when nonsense rectangles are returned\r\n                while (start && isExtendingChar(prepared.line.text.charAt(place.coverStart + start))) { --start; }\r\n                while (place.coverStart + end < place.coverEnd && isExtendingChar(prepared.line.text.charAt(place.coverStart + end))) { ++end; }\r\n                if (ie && ie_version < 9 && start == 0 && end == place.coverEnd - place.coverStart)\r\n                { rect = node.parentNode.getBoundingClientRect(); }\r\n                else\r\n                { rect = getUsefulRect(range(node, start, end).getClientRects(), bias); }\r\n                if (rect.left || rect.right || start == 0) { break }\r\n                end = start;\r\n                start = start - 1;\r\n                collapse = "right";\r\n            }\r\n            if (ie && ie_version < 11) { rect = maybeUpdateRectForZooming(cm.display.measure, rect); }\r\n        } else { // If it is a widget, simply get the box for the whole widget.\r\n            if (start > 0) { collapse = bias = "right"; }\r\n            var rects;\r\n            if (cm.options.lineWrapping && (rects = node.getClientRects()).length > 1)\r\n            { rect = rects[bias == "right" ? rects.length - 1 : 0]; }\r\n            else\r\n            { rect = node.getBoundingClientRect(); }\r\n        }\r\n        if (ie && ie_version < 9 && !start && (!rect || !rect.left && !rect.right)) {\r\n            var rSpan = node.parentNode.getClientRects()[0];\r\n            if (rSpan)\r\n            { rect = {left: rSpan.left, right: rSpan.left + charWidth(cm.display), top: rSpan.top, bottom: rSpan.bottom}; }\r\n            else\r\n            { rect = nullRect; }\r\n        }\r\n\r\n        var rtop = rect.top - prepared.rect.top, rbot = rect.bottom - prepared.rect.top;\r\n        var mid = (rtop + rbot) / 2;\r\n        var heights = prepared.view.measure.heights;\r\n        var i = 0;\r\n        for (; i < heights.length - 1; i++)\r\n        { if (mid < heights[i]) { break } }\r\n        var top = i ? heights[i - 1] : 0, bot = heights[i];\r\n        var result = {left: (collapse == "right" ? rect.right : rect.left) - prepared.rect.left,\r\n            right: (collapse == "left" ? rect.left : rect.right) - prepared.rect.left,\r\n            top: top, bottom: bot};\r\n        if (!rect.left && !rect.right) { result.bogus = true; }\r\n        if (!cm.options.singleCursorHeightPerLine) { result.rtop = rtop; result.rbottom = rbot; }\r\n\r\n        return result\r\n    }\r\n\r\n    // Work around problem with bounding client rects on ranges being\r\n    // returned incorrectly when zoomed on IE10 and below.\r\n    function maybeUpdateRectForZooming(measure, rect) {\r\n        if (!window.screen || screen.logicalXDPI == null ||\r\n            screen.logicalXDPI == screen.deviceXDPI || !hasBadZoomedRects(measure))\r\n        { return rect }\r\n        var scaleX = screen.logicalXDPI / screen.deviceXDPI;\r\n        var scaleY = screen.logicalYDPI / screen.deviceYDPI;\r\n        return {left: rect.left * scaleX, right: rect.right * scaleX,\r\n            top: rect.top * scaleY, bottom: rect.bottom * scaleY}\r\n    }\r\n\r\n    function clearLineMeasurementCacheFor(lineView) {\r\n        if (lineView.measure) {\r\n            lineView.measure.cache = {};\r\n            lineView.measure.heights = null;\r\n            if (lineView.rest) { for (var i = 0; i < lineView.rest.length; i++)\r\n            { lineView.measure.caches[i] = {}; } }\r\n        }\r\n    }\r\n\r\n    function clearLineMeasurementCache(cm) {\r\n        cm.display.externalMeasure = null;\r\n        removeChildren(cm.display.lineMeasure);\r\n        for (var i = 0; i < cm.display.view.length; i++)\r\n        { clearLineMeasurementCacheFor(cm.display.view[i]); }\r\n    }\r\n\r\n    function clearCaches(cm) {\r\n        clearLineMeasurementCache(cm);\r\n        cm.display.cachedCharWidth = cm.display.cachedTextHeight = cm.display.cachedPaddingH = null;\r\n        if (!cm.options.lineWrapping) { cm.display.maxLineChanged = true; }\r\n        cm.display.lineNumChars = null;\r\n    }\r\n\r\n    function pageScrollX() {\r\n        // Work around https://bugs.chromium.org/p/chromium/issues/detail?id=489206\r\n        // which causes page_Offset and bounding client rects to use\r\n        // different reference viewports and invalidate our calculations.\r\n        if (chrome && android) { return -(document.body.getBoundingClientRect().left - parseInt(getComputedStyle(document.body).marginLeft)) }\r\n        return window.pageXOffset || (document.documentElement || document.body).scrollLeft\r\n    }\r\n    function pageScrollY() {\r\n        if (chrome && android) { return -(document.body.getBoundingClientRect().top - parseInt(getComputedStyle(document.body).marginTop)) }\r\n        return window.pageYOffset || (document.documentElement || document.body).scrollTop\r\n    }\r\n\r\n    function widgetTopHeight(lineObj) {\r\n        var height = 0;\r\n        if (lineObj.widgets) { for (var i = 0; i < lineObj.widgets.length; ++i) { if (lineObj.widgets[i].above)\r\n        { height += widgetHeight(lineObj.widgets[i]); } } }\r\n        return height\r\n    }\r\n\r\n    // Converts a {top, bottom, left, right} box from line-local\r\n    // coordinates into another coordinate system. Context may be one of\r\n    // "line", "div" (display.lineDiv), "local"./null (editor), "window",\r\n    // or "page".\r\n    function intoCoordSystem(cm, lineObj, rect, context, includeWidgets) {\r\n        if (!includeWidgets) {\r\n            var height = widgetTopHeight(lineObj);\r\n            rect.top += height; rect.bottom += height;\r\n        }\r\n        if (context == "line") { return rect }\r\n        if (!context) { context = "local"; }\r\n        var yOff = heightAtLine(lineObj);\r\n        if (context == "local") { yOff += paddingTop(cm.display); }\r\n        else { yOff -= cm.display.viewOffset; }\r\n        if (context == "page" || context == "window") {\r\n            var lOff = cm.display.lineSpace.getBoundingClientRect();\r\n            yOff += lOff.top + (context == "window" ? 0 : pageScrollY());\r\n            var xOff = lOff.left + (context == "window" ? 0 : pageScrollX());\r\n            rect.left += xOff; rect.right += xOff;\r\n        }\r\n        rect.top += yOff; rect.bottom += yOff;\r\n        return rect\r\n    }\r\n\r\n    // Coverts a box from "div" coords to another coordinate system.\r\n    // Context may be "window", "page", "div", or "local"./null.\r\n    function fromCoordSystem(cm, coords, context) {\r\n        if (context == "div") { return coords }\r\n        var left = coords.left, top = coords.top;\r\n        // First move into "page" coordinate system\r\n        if (context == "page") {\r\n            left -= pageScrollX();\r\n            top -= pageScrollY();\r\n        } else if (context == "local" || !context) {\r\n            var localBox = cm.display.sizer.getBoundingClientRect();\r\n            left += localBox.left;\r\n            top += localBox.top;\r\n        }\r\n\r\n        var lineSpaceBox = cm.display.lineSpace.getBoundingClientRect();\r\n        return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top}\r\n    }\r\n\r\n    function charCoords(cm, pos, context, lineObj, bias) {\r\n        if (!lineObj) { lineObj = getLine(cm.doc, pos.line); }\r\n        return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, bias), context)\r\n    }\r\n\r\n    // Returns a box for a given cursor position, which may have an\r\n    // \'other\' property containing the position of the secondary cursor\r\n    // on a bidi boundary.\r\n    // A cursor Pos(line, char, "before") is on the same visual line as `char - 1`\r\n    // and after `char - 1` in writing order of `char - 1`\r\n    // A cursor Pos(line, char, "after") is on the same visual line as `char`\r\n    // and before `char` in writing order of `char`\r\n    // Examples (upper-case letters are RTL, lower-case are LTR):\r\n    //     Pos(0, 1, ...)\r\n    //     before   after\r\n    // ab     a|b     a|b\r\n    // aB     a|B     aB|\r\n    // Ab     |Ab     A|b\r\n    // AB     B|A     B|A\r\n    // Every position after the last character on a line is considered to stick\r\n    // to the last character on the line.\r\n    function cursorCoords(cm, pos, context, lineObj, preparedMeasure, varHeight) {\r\n        lineObj = lineObj || getLine(cm.doc, pos.line);\r\n        if (!preparedMeasure) { preparedMeasure = prepareMeasureForLine(cm, lineObj); }\r\n        function get(ch, right) {\r\n            var m = measureCharPrepared(cm, preparedMeasure, ch, right ? "right" : "left", varHeight);\r\n            if (right) { m.left = m.right; } else { m.right = m.left; }\r\n            return intoCoordSystem(cm, lineObj, m, context)\r\n        }\r\n        var order = getOrder(lineObj, cm.doc.direction), ch = pos.ch, sticky = pos.sticky;\r\n        if (ch >= lineObj.text.length) {\r\n            ch = lineObj.text.length;\r\n            sticky = "before";\r\n        } else if (ch <= 0) {\r\n            ch = 0;\r\n            sticky = "after";\r\n        }\r\n        if (!order) { return get(sticky == "before" ? ch - 1 : ch, sticky == "before") }\r\n\r\n        function getBidi(ch, partPos, invert) {\r\n            var part = order[partPos], right = part.level == 1;\r\n            return get(invert ? ch - 1 : ch, right != invert)\r\n        }\r\n        var partPos = getBidiPartAt(order, ch, sticky);\r\n        var other = bidiOther;\r\n        var val = getBidi(ch, partPos, sticky == "before");\r\n        if (other != null) { val.other = getBidi(ch, other, sticky != "before"); }\r\n        return val\r\n    }\r\n\r\n    // Used to cheaply estimate the coordinates for a position. Used for\r\n    // intermediate scroll updates.\r\n    function estimateCoords(cm, pos) {\r\n        var left = 0;\r\n        pos = clipPos(cm.doc, pos);\r\n        if (!cm.options.lineWrapping) { left = charWidth(cm.display) * pos.ch; }\r\n        var lineObj = getLine(cm.doc, pos.line);\r\n        var top = heightAtLine(lineObj) + paddingTop(cm.display);\r\n        return {left: left, right: left, top: top, bottom: top + lineObj.height}\r\n    }\r\n\r\n    // Positions returned by coordsChar contain some extra information.\r\n    // xRel is the relative x position of the input coordinates compared\r\n    // to the found position (so xRel > 0 means the coordinates are to\r\n    // the right of the character position, for example). When outside\r\n    // is true, that means the coordinates lie outside the line\'s\r\n    // vertical range.\r\n    function PosWithInfo(line, ch, sticky, outside, xRel) {\r\n        var pos = Pos(line, ch, sticky);\r\n        pos.xRel = xRel;\r\n        if (outside) { pos.outside = true; }\r\n        return pos\r\n    }\r\n\r\n    // Compute the character position closest to the given coordinates.\r\n    // Input must be lineSpace-local ("div" coordinate system).\r\n    function coordsChar(cm, x, y) {\r\n        var doc = cm.doc;\r\n        y += cm.display.viewOffset;\r\n        if (y < 0) { return PosWithInfo(doc.first, 0, null, true, -1) }\r\n        var lineN = lineAtHeight(doc, y), last = doc.first + doc.size - 1;\r\n        if (lineN > last)\r\n        { return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, null, true, 1) }\r\n        if (x < 0) { x = 0; }\r\n\r\n        var lineObj = getLine(doc, lineN);\r\n        for (;;) {\r\n            var found = coordsCharInner(cm, lineObj, lineN, x, y);\r\n            var collapsed = collapsedSpanAround(lineObj, found.ch + (found.xRel > 0 ? 1 : 0));\r\n            if (!collapsed) { return found }\r\n            var rangeEnd = collapsed.find(1);\r\n            if (rangeEnd.line == lineN) { return rangeEnd }\r\n            lineObj = getLine(doc, lineN = rangeEnd.line);\r\n        }\r\n    }\r\n\r\n    function wrappedLineExtent(cm, lineObj, preparedMeasure, y) {\r\n        y -= widgetTopHeight(lineObj);\r\n        var end = lineObj.text.length;\r\n        var begin = findFirst(function (ch) { return measureCharPrepared(cm, preparedMeasure, ch - 1).bottom <= y; }, end, 0);\r\n        end = findFirst(function (ch) { return measureCharPrepared(cm, preparedMeasure, ch).top > y; }, begin, end);\r\n        return {begin: begin, end: end}\r\n    }\r\n\r\n    function wrappedLineExtentChar(cm, lineObj, preparedMeasure, target) {\r\n        if (!preparedMeasure) { preparedMeasure = prepareMeasureForLine(cm, lineObj); }\r\n        var targetTop = intoCoordSystem(cm, lineObj, measureCharPrepared(cm, preparedMeasure, target), "line").top;\r\n        return wrappedLineExtent(cm, lineObj, preparedMeasure, targetTop)\r\n    }\r\n\r\n    // Returns true if the given side of a box is after the given\r\n    // coordinates, in top-to-bottom, left-to-right order.\r\n    function boxIsAfter(box, x, y, left) {\r\n        return box.bottom <= y ? false : box.top > y ? true : (left ? box.left : box.right) > x\r\n    }\r\n\r\n    function coordsCharInner(cm, lineObj, lineNo$$1, x, y) {\r\n        // Move y into line-local coordinate space\r\n        y -= heightAtLine(lineObj);\r\n        var preparedMeasure = prepareMeasureForLine(cm, lineObj);\r\n        // When directly calling `measureCharPrepared`, we have to adjust\r\n        // for the widgets at this line.\r\n        var widgetHeight$$1 = widgetTopHeight(lineObj);\r\n        var begin = 0, end = lineObj.text.length, ltr = true;\r\n\r\n        var order = getOrder(lineObj, cm.doc.direction);\r\n        // If the line isn\'t plain left-to-right text, first figure out\r\n        // which bidi section the coordinates fall into.\r\n        if (order) {\r\n            var part = (cm.options.lineWrapping ? coordsBidiPartWrapped : coordsBidiPart)\r\n            (cm, lineObj, lineNo$$1, preparedMeasure, order, x, y);\r\n            ltr = part.level != 1;\r\n            // The awkward -1 offsets are needed because findFirst (called\r\n            // on these below) will treat its first bound as inclusive,\r\n            // second as exclusive, but we want to actually address the\r\n            // characters in the part\'s range\r\n            begin = ltr ? part.from : part.to - 1;\r\n            end = ltr ? part.to : part.from - 1;\r\n        }\r\n\r\n        // A binary search to find the first character whose bounding box\r\n        // starts after the coordinates. If we run across any whose box wrap\r\n        // the coordinates, store that.\r\n        var chAround = null, boxAround = null;\r\n        var ch = findFirst(function (ch) {\r\n            var box = measureCharPrepared(cm, preparedMeasure, ch);\r\n            box.top += widgetHeight$$1; box.bottom += widgetHeight$$1;\r\n            if (!boxIsAfter(box, x, y, false)) { return false }\r\n            if (box.top <= y && box.left <= x) {\r\n                chAround = ch;\r\n                boxAround = box;\r\n            }\r\n            return true\r\n        }, begin, end);\r\n\r\n        var baseX, sticky, outside = false;\r\n        // If a box around the coordinates was found, use that\r\n        if (boxAround) {\r\n            // Distinguish coordinates nearer to the left or right side of the box\r\n            var atLeft = x - boxAround.left < boxAround.right - x, atStart = atLeft == ltr;\r\n            ch = chAround + (atStart ? 0 : 1);\r\n            sticky = atStart ? "after" : "before";\r\n            baseX = atLeft ? boxAround.left : boxAround.right;\r\n        } else {\r\n            // (Adjust for extended bound, if necessary.)\r\n            if (!ltr && (ch == end || ch == begin)) { ch++; }\r\n            // To determine which side to associate with, get the box to the\r\n            // left of the character and compare it\'s vertical position to the\r\n            // coordinates\r\n            sticky = ch == 0 ? "after" : ch == lineObj.text.length ? "before" :\r\n                (measureCharPrepared(cm, preparedMeasure, ch - (ltr ? 1 : 0)).bottom + widgetHeight$$1 <= y) == ltr ?\r\n                    "after" : "before";\r\n            // Now get accurate coordinates for this place, in order to get a\r\n            // base X position\r\n            var coords = cursorCoords(cm, Pos(lineNo$$1, ch, sticky), "line", lineObj, preparedMeasure);\r\n            baseX = coords.left;\r\n            outside = y < coords.top || y >= coords.bottom;\r\n        }\r\n\r\n        ch = skipExtendingChars(lineObj.text, ch, 1);\r\n        return PosWithInfo(lineNo$$1, ch, sticky, outside, x - baseX)\r\n    }\r\n\r\n    function coordsBidiPart(cm, lineObj, lineNo$$1, preparedMeasure, order, x, y) {\r\n        // Bidi parts are sorted left-to-right, and in a non-line-wrapping\r\n        // situation, we can take this ordering to correspond to the visual\r\n        // ordering. This finds the first part whose end is after the given\r\n        // coordinates.\r\n        var index = findFirst(function (i) {\r\n            var part = order[i], ltr = part.level != 1;\r\n            return boxIsAfter(cursorCoords(cm, Pos(lineNo$$1, ltr ? part.to : part.from, ltr ? "before" : "after"),\r\n                "line", lineObj, preparedMeasure), x, y, true)\r\n        }, 0, order.length - 1);\r\n        var part = order[index];\r\n        // If this isn\'t the first part, the part\'s start is also after\r\n        // the coordinates, and the coordinates aren\'t on the same line as\r\n        // that start, move one part back.\r\n        if (index > 0) {\r\n            var ltr = part.level != 1;\r\n            var start = cursorCoords(cm, Pos(lineNo$$1, ltr ? part.from : part.to, ltr ? "after" : "before"),\r\n                "line", lineObj, preparedMeasure);\r\n            if (boxIsAfter(start, x, y, true) && start.top > y)\r\n            { part = order[index - 1]; }\r\n        }\r\n        return part\r\n    }\r\n\r\n    function coordsBidiPartWrapped(cm, lineObj, _lineNo, preparedMeasure, order, x, y) {\r\n        // In a wrapped line, rtl text on wrapping boundaries can do things\r\n        // that don\'t correspond to the ordering in our `order` array at\r\n        // all, so a binary search doesn\'t work, and we want to return a\r\n        // part that only spans one line so that the binary search in\r\n        // coordsCharInner is safe. As such, we first find the extent of the\r\n        // wrapped line, and then do a flat search in which we discard any\r\n        // spans that aren\'t on the line.\r\n        var ref = wrappedLineExtent(cm, lineObj, preparedMeasure, y);\r\n        var begin = ref.begin;\r\n        var end = ref.end;\r\n        if (/\\s/.test(lineObj.text.charAt(end - 1))) { end--; }\r\n        var part = null, closestDist = null;\r\n        for (var i = 0; i < order.length; i++) {\r\n            var p = order[i];\r\n            if (p.from >= end || p.to <= begin) { continue }\r\n            var ltr = p.level != 1;\r\n            var endX = measureCharPrepared(cm, preparedMeasure, ltr ? Math.min(end, p.to) - 1 : Math.max(begin, p.from)).right;\r\n            // Weigh against spans ending before this, so that they are only\r\n            // picked if nothing ends after\r\n            var dist = endX < x ? x - endX + 1e9 : endX - x;\r\n            if (!part || closestDist > dist) {\r\n                part = p;\r\n                closestDist = dist;\r\n            }\r\n        }\r\n        if (!part) { part = order[order.length - 1]; }\r\n        // Clip the part to the wrapped line.\r\n        if (part.from < begin) { part = {from: begin, to: part.to, level: part.level}; }\r\n        if (part.to > end) { part = {from: part.from, to: end, level: part.level}; }\r\n        return part\r\n    }\r\n\r\n    var measureText;\r\n    // Compute the default text height.\r\n    function textHeight(display) {\r\n        if (display.cachedTextHeight != null) { return display.cachedTextHeight }\r\n        if (measureText == null) {\r\n            measureText = elt("pre");\r\n            // Measure a bunch of lines, for browsers that compute\r\n            // fractional heights.\r\n            for (var i = 0; i < 49; ++i) {\r\n                measureText.appendChild(document.createTextNode("x"));\r\n                measureText.appendChild(elt("br"));\r\n            }\r\n            measureText.appendChild(document.createTextNode("x"));\r\n        }\r\n        removeChildrenAndAdd(display.measure, measureText);\r\n        var height = measureText.offsetHeight / 50;\r\n        if (height > 3) { display.cachedTextHeight = height; }\r\n        removeChildren(display.measure);\r\n        return height || 1\r\n    }\r\n\r\n    // Compute the default character width.\r\n    function charWidth(display) {\r\n        if (display.cachedCharWidth != null) { return display.cachedCharWidth }\r\n        var anchor = elt("span", "xxxxxxxxxx");\r\n        var pre = elt("pre", [anchor]);\r\n        removeChildrenAndAdd(display.measure, pre);\r\n        var rect = anchor.getBoundingClientRect(), width = (rect.right - rect.left) / 10;\r\n        if (width > 2) { display.cachedCharWidth = width; }\r\n        return width || 10\r\n    }\r\n\r\n    // Do a bulk-read of the DOM positions and sizes needed to draw the\r\n    // view, so that we don\'t interleave reading and writing to the DOM.\r\n    function getDimensions(cm) {\r\n        var d = cm.display, left = {}, width = {};\r\n        var gutterLeft = d.gutters.clientLeft;\r\n        for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {\r\n            left[cm.options.gutters[i]] = n.offsetLeft + n.clientLeft + gutterLeft;\r\n            width[cm.options.gutters[i]] = n.clientWidth;\r\n        }\r\n        return {fixedPos: compensateForHScroll(d),\r\n            gutterTotalWidth: d.gutters.offsetWidth,\r\n            gutterLeft: left,\r\n            gutterWidth: width,\r\n            wrapperWidth: d.wrapper.clientWidth}\r\n    }\r\n\r\n    // Computes display.scroller.scrollLeft + display.gutters.offsetWidth,\r\n    // but using getBoundingClientRect to get a sub-pixel-accurate\r\n    // result.\r\n    function compensateForHScroll(display) {\r\n        return display.scroller.getBoundingClientRect().left - display.sizer.getBoundingClientRect().left\r\n    }\r\n\r\n    // Returns a function that estimates the height of a line, to use as\r\n    // first approximation until the line becomes visible (and is thus\r\n    // properly measurable).\r\n    function estimateHeight(cm) {\r\n        var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;\r\n        var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);\r\n        return function (line) {\r\n            if (lineIsHidden(cm.doc, line)) { return 0 }\r\n\r\n            var widgetsHeight = 0;\r\n            if (line.widgets) { for (var i = 0; i < line.widgets.length; i++) {\r\n                if (line.widgets[i].height) { widgetsHeight += line.widgets[i].height; }\r\n            } }\r\n\r\n            if (wrapping)\r\n            { return widgetsHeight + (Math.ceil(line.text.length / perLine) || 1) * th }\r\n            else\r\n            { return widgetsHeight + th }\r\n        }\r\n    }\r\n\r\n    function estimateLineHeights(cm) {\r\n        var doc = cm.doc, est = estimateHeight(cm);\r\n        doc.iter(function (line) {\r\n            var estHeight = est(line);\r\n            if (estHeight != line.height) { updateLineHeight(line, estHeight); }\r\n        });\r\n    }\r\n\r\n    // Given a mouse event, find the corresponding position. If liberal\r\n    // is false, it checks whether a gutter or scrollbar was clicked,\r\n    // and returns null if it was. forRect is used by rectangular\r\n    // selections, and tries to estimate a character position even for\r\n    // coordinates beyond the right of the text.\r\n    function posFromMouse(cm, e, liberal, forRect) {\r\n        var display = cm.display;\r\n        if (!liberal && e_target(e).getAttribute("cm-not-content") == "true") { return null }\r\n\r\n        var x, y, space = display.lineSpace.getBoundingClientRect();\r\n        // Fails unpredictably on IE[67] when mouse is dragged around quickly.\r\n        try { x = e.clientX - space.left; y = e.clientY - space.top; }\r\n        catch (e) { return null }\r\n        var coords = coordsChar(cm, x, y), line;\r\n        if (forRect && coords.xRel == 1 && (line = getLine(cm.doc, coords.line).text).length == coords.ch) {\r\n            var colDiff = countColumn(line, line.length, cm.options.tabSize) - line.length;\r\n            coords = Pos(coords.line, Math.max(0, Math.round((x - paddingH(cm.display).left) / charWidth(cm.display)) - colDiff));\r\n        }\r\n        return coords\r\n    }\r\n\r\n    // Find the view element corresponding to a given line. Return null\r\n    // when the line isn\'t visible.\r\n    function findViewIndex(cm, n) {\r\n        if (n >= cm.display.viewTo) { return null }\r\n        n -= cm.display.viewFrom;\r\n        if (n < 0) { return null }\r\n        var view = cm.display.view;\r\n        for (var i = 0; i < view.length; i++) {\r\n            n -= view[i].size;\r\n            if (n < 0) { return i }\r\n        }\r\n    }\r\n\r\n    function updateSelection(cm) {\r\n        cm.display.input.showSelection(cm.display.input.prepareSelection());\r\n    }\r\n\r\n    function prepareSelection(cm, primary) {\r\n        if ( primary === void 0 ) primary = true;\r\n\r\n        var doc = cm.doc, result = {};\r\n        var curFragment = result.cursors = document.createDocumentFragment();\r\n        var selFragment = result.selection = document.createDocumentFragment();\r\n\r\n        for (var i = 0; i < doc.sel.ranges.length; i++) {\r\n            if (!primary && i == doc.sel.primIndex) { continue }\r\n            var range$$1 = doc.sel.ranges[i];\r\n            if (range$$1.from().line >= cm.display.viewTo || range$$1.to().line < cm.display.viewFrom) { continue }\r\n            var collapsed = range$$1.empty();\r\n            if (collapsed || cm.options.showCursorWhenSelecting)\r\n            { drawSelectionCursor(cm, range$$1.head, curFragment); }\r\n            if (!collapsed)\r\n            { drawSelectionRange(cm, range$$1, selFragment); }\r\n        }\r\n        return result\r\n    }\r\n\r\n    // Draws a cursor for the given range\r\n    function drawSelectionCursor(cm, head, output) {\r\n        var pos = cursorCoords(cm, head, "div", null, null, !cm.options.singleCursorHeightPerLine);\r\n\r\n        var cursor = output.appendChild(elt("div", "\\u00a0", "CodeMirror-cursor"));\r\n        cursor.style.left = pos.left + "px";\r\n        cursor.style.top = pos.top + "px";\r\n        cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + "px";\r\n\r\n        if (pos.other) {\r\n            // Secondary cursor, shown when on a \'jump\' in bi-directional text\r\n            var otherCursor = output.appendChild(elt("div", "\\u00a0", "CodeMirror-cursor CodeMirror-secondarycursor"));\r\n            otherCursor.style.display = "";\r\n            otherCursor.style.left = pos.other.left + "px";\r\n            otherCursor.style.top = pos.other.top + "px";\r\n            otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + "px";\r\n        }\r\n    }\r\n\r\n    function cmpCoords(a, b) { return a.top - b.top || a.left - b.left }\r\n\r\n    // Draws the given range as a highlighted selection\r\n    function drawSelectionRange(cm, range$$1, output) {\r\n        var display = cm.display, doc = cm.doc;\r\n        var fragment = document.createDocumentFragment();\r\n        var padding = paddingH(cm.display), leftSide = padding.left;\r\n        var rightSide = Math.max(display.sizerWidth, displayWidth(cm) - display.sizer.offsetLeft) - padding.right;\r\n        var docLTR = doc.direction == "ltr";\r\n\r\n        function add(left, top, width, bottom) {\r\n            if (top < 0) { top = 0; }\r\n            top = Math.round(top);\r\n            bottom = Math.round(bottom);\r\n            fragment.appendChild(elt("div", null, "CodeMirror-selected", ("position: absolute; left: " + left + "px;\\n                             top: " + top + "px; width: " + (width == null ? rightSide - left : width) + "px;\\n                             height: " + (bottom - top) + "px")));\r\n        }\r\n\r\n        function drawForLine(line, fromArg, toArg) {\r\n            var lineObj = getLine(doc, line);\r\n            var lineLen = lineObj.text.length;\r\n            var start, end;\r\n            function coords(ch, bias) {\r\n                return charCoords(cm, Pos(line, ch), "div", lineObj, bias)\r\n            }\r\n\r\n            function wrapX(pos, dir, side) {\r\n                var extent = wrappedLineExtentChar(cm, lineObj, null, pos);\r\n                var prop = (dir == "ltr") == (side == "after") ? "left" : "right";\r\n                var ch = side == "after" ? extent.begin : extent.end - (/\\s/.test(lineObj.text.charAt(extent.end - 1)) ? 2 : 1);\r\n                return coords(ch, prop)[prop]\r\n            }\r\n\r\n            var order = getOrder(lineObj, doc.direction);\r\n            iterateBidiSections(order, fromArg || 0, toArg == null ? lineLen : toArg, function (from, to, dir, i) {\r\n                var ltr = dir == "ltr";\r\n                var fromPos = coords(from, ltr ? "left" : "right");\r\n                var toPos = coords(to - 1, ltr ? "right" : "left");\r\n\r\n                var openStart = fromArg == null && from == 0, openEnd = toArg == null && to == lineLen;\r\n                var first = i == 0, last = !order || i == order.length - 1;\r\n                if (toPos.top - fromPos.top <= 3) { // Single line\r\n                    var openLeft = (docLTR ? openStart : openEnd) && first;\r\n                    var openRight = (docLTR ? openEnd : openStart) && last;\r\n                    var left = openLeft ? leftSide : (ltr ? fromPos : toPos).left;\r\n                    var right = openRight ? rightSide : (ltr ? toPos : fromPos).right;\r\n                    add(left, fromPos.top, right - left, fromPos.bottom);\r\n                } else { // Multiple lines\r\n                    var topLeft, topRight, botLeft, botRight;\r\n                    if (ltr) {\r\n                        topLeft = docLTR && openStart && first ? leftSide : fromPos.left;\r\n                        topRight = docLTR ? rightSide : wrapX(from, dir, "before");\r\n                        botLeft = docLTR ? leftSide : wrapX(to, dir, "after");\r\n                        botRight = docLTR && openEnd && last ? rightSide : toPos.right;\r\n                    } else {\r\n                        topLeft = !docLTR ? leftSide : wrapX(from, dir, "before");\r\n                        topRight = !docLTR && openStart && first ? rightSide : fromPos.right;\r\n                        botLeft = !docLTR && openEnd && last ? leftSide : toPos.left;\r\n                        botRight = !docLTR ? rightSide : wrapX(to, dir, "after");\r\n                    }\r\n                    add(topLeft, fromPos.top, topRight - topLeft, fromPos.bottom);\r\n                    if (fromPos.bottom < toPos.top) { add(leftSide, fromPos.bottom, null, toPos.top); }\r\n                    add(botLeft, toPos.top, botRight - botLeft, toPos.bottom);\r\n                }\r\n\r\n                if (!start || cmpCoords(fromPos, start) < 0) { start = fromPos; }\r\n                if (cmpCoords(toPos, start) < 0) { start = toPos; }\r\n                if (!end || cmpCoords(fromPos, end) < 0) { end = fromPos; }\r\n                if (cmpCoords(toPos, end) < 0) { end = toPos; }\r\n            });\r\n            return {start: start, end: end}\r\n        }\r\n\r\n        var sFrom = range$$1.from(), sTo = range$$1.to();\r\n        if (sFrom.line == sTo.line) {\r\n            drawForLine(sFrom.line, sFrom.ch, sTo.ch);\r\n        } else {\r\n            var fromLine = getLine(doc, sFrom.line), toLine = getLine(doc, sTo.line);\r\n            var singleVLine = visualLine(fromLine) == visualLine(toLine);\r\n            var leftEnd = drawForLine(sFrom.line, sFrom.ch, singleVLine ? fromLine.text.length + 1 : null).end;\r\n            var rightStart = drawForLine(sTo.line, singleVLine ? 0 : null, sTo.ch).start;\r\n            if (singleVLine) {\r\n                if (leftEnd.top < rightStart.top - 2) {\r\n                    add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);\r\n                    add(leftSide, rightStart.top, rightStart.left, rightStart.bottom);\r\n                } else {\r\n                    add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);\r\n                }\r\n            }\r\n            if (leftEnd.bottom < rightStart.top)\r\n            { add(leftSide, leftEnd.bottom, null, rightStart.top); }\r\n        }\r\n\r\n        output.appendChild(fragment);\r\n    }\r\n\r\n    // Cursor-blinking\r\n    function restartBlink(cm) {\r\n        if (!cm.state.focused) { return }\r\n        var display = cm.display;\r\n        clearInterval(display.blinker);\r\n        var on = true;\r\n        display.cursorDiv.style.visibility = "";\r\n        if (cm.options.cursorBlinkRate > 0)\r\n        { display.blinker = setInterval(function () { return display.cursorDiv.style.visibility = (on = !on) ? "" : "hidden"; },\r\n            cm.options.cursorBlinkRate); }\r\n        else if (cm.options.cursorBlinkRate < 0)\r\n        { display.cursorDiv.style.visibility = "hidden"; }\r\n    }\r\n\r\n    function ensureFocus(cm) {\r\n        if (!cm.state.focused) { cm.display.input.focus(); onFocus(cm); }\r\n    }\r\n\r\n    function delayBlurEvent(cm) {\r\n        cm.state.delayingBlurEvent = true;\r\n        setTimeout(function () { if (cm.state.delayingBlurEvent) {\r\n            cm.state.delayingBlurEvent = false;\r\n            onBlur(cm);\r\n        } }, 100);\r\n    }\r\n\r\n    function onFocus(cm, e) {\r\n        if (cm.state.delayingBlurEvent) { cm.state.delayingBlurEvent = false; }\r\n\r\n        if (cm.options.readOnly == "nocursor") { return }\r\n        if (!cm.state.focused) {\r\n            signal(cm, "focus", cm, e);\r\n            cm.state.focused = true;\r\n            addClass(cm.display.wrapper, "CodeMirror-focused");\r\n            // This test prevents this from firing when a context\r\n            // menu is closed (since the input reset would kill the\r\n            // select-all detection hack)\r\n            if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {\r\n                cm.display.input.reset();\r\n                if (webkit) { setTimeout(function () { return cm.display.input.reset(true); }, 20); } // Issue #1730\r\n            }\r\n            cm.display.input.receivedFocus();\r\n        }\r\n        restartBlink(cm);\r\n    }\r\n    function onBlur(cm, e) {\r\n        if (cm.state.delayingBlurEvent) { return }\r\n\r\n        if (cm.state.focused) {\r\n            signal(cm, "blur", cm, e);\r\n            cm.state.focused = false;\r\n            rmClass(cm.display.wrapper, "CodeMirror-focused");\r\n        }\r\n        clearInterval(cm.display.blinker);\r\n        setTimeout(function () { if (!cm.state.focused) { cm.display.shift = false; } }, 150);\r\n    }\r\n\r\n    // Read the actual heights of the rendered lines, and update their\r\n    // stored heights to match.\r\n    function updateHeightsInViewport(cm) {\r\n        var display = cm.display;\r\n        var prevBottom = display.lineDiv.offsetTop;\r\n        for (var i = 0; i < display.view.length; i++) {\r\n            var cur = display.view[i], wrapping = cm.options.lineWrapping;\r\n            var height = (void 0), width = 0;\r\n            if (cur.hidden) { continue }\r\n            if (ie && ie_version < 8) {\r\n                var bot = cur.node.offsetTop + cur.node.offsetHeight;\r\n                height = bot - prevBottom;\r\n                prevBottom = bot;\r\n            } else {\r\n                var box = cur.node.getBoundingClientRect();\r\n                height = box.bottom - box.top;\r\n                // Check that lines don\'t extend past the right of the current\r\n                // editor width\r\n                if (!wrapping && cur.text.firstChild)\r\n                { width = cur.text.firstChild.getBoundingClientRect().right - box.left - 1; }\r\n            }\r\n            var diff = cur.line.height - height;\r\n            if (height < 2) { height = textHeight(display); }\r\n            if (diff > .005 || diff < -.005) {\r\n                updateLineHeight(cur.line, height);\r\n                updateWidgetHeight(cur.line);\r\n                if (cur.rest) { for (var j = 0; j < cur.rest.length; j++)\r\n                { updateWidgetHeight(cur.rest[j]); } }\r\n            }\r\n            if (width > cm.display.sizerWidth) {\r\n                var chWidth = Math.ceil(width / charWidth(cm.display));\r\n                if (chWidth > cm.display.maxLineLength) {\r\n                    cm.display.maxLineLength = chWidth;\r\n                    cm.display.maxLine = cur.line;\r\n                    cm.display.maxLineChanged = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Read and store the height of line widgets associated with the\r\n    // given line.\r\n    function updateWidgetHeight(line) {\r\n        if (line.widgets) { for (var i = 0; i < line.widgets.length; ++i) {\r\n            var w = line.widgets[i], parent = w.node.parentNode;\r\n            if (parent) { w.height = parent.offsetHeight; }\r\n        } }\r\n    }\r\n\r\n    // Compute the lines that are visible in a given viewport (defaults\r\n    // the the current scroll position). viewport may contain top,\r\n    // height, and ensure (see op.scrollToPos) properties.\r\n    function visibleLines(display, doc, viewport) {\r\n        var top = viewport && viewport.top != null ? Math.max(0, viewport.top) : display.scroller.scrollTop;\r\n        top = Math.floor(top - paddingTop(display));\r\n        var bottom = viewport && viewport.bottom != null ? viewport.bottom : top + display.wrapper.clientHeight;\r\n\r\n        var from = lineAtHeight(doc, top), to = lineAtHeight(doc, bottom);\r\n        // Ensure is a {from: {line, ch}, to: {line, ch}} object, and\r\n        // forces those lines into the viewport (if possible).\r\n        if (viewport && viewport.ensure) {\r\n            var ensureFrom = viewport.ensure.from.line, ensureTo = viewport.ensure.to.line;\r\n            if (ensureFrom < from) {\r\n                from = ensureFrom;\r\n                to = lineAtHeight(doc, heightAtLine(getLine(doc, ensureFrom)) + display.wrapper.clientHeight);\r\n            } else if (Math.min(ensureTo, doc.lastLine()) >= to) {\r\n                from = lineAtHeight(doc, heightAtLine(getLine(doc, ensureTo)) - display.wrapper.clientHeight);\r\n                to = ensureTo;\r\n            }\r\n        }\r\n        return {from: from, to: Math.max(to, from + 1)}\r\n    }\r\n\r\n    // Re-align line numbers and gutter marks to compensate for\r\n    // horizontal scrolling.\r\n    function alignHorizontally(cm) {\r\n        var display = cm.display, view = display.view;\r\n        if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) { return }\r\n        var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;\r\n        var gutterW = display.gutters.offsetWidth, left = comp + "px";\r\n        for (var i = 0; i < view.length; i++) { if (!view[i].hidden) {\r\n            if (cm.options.fixedGutter) {\r\n                if (view[i].gutter)\r\n                { view[i].gutter.style.left = left; }\r\n                if (view[i].gutterBackground)\r\n                { view[i].gutterBackground.style.left = left; }\r\n            }\r\n            var align = view[i].alignable;\r\n            if (align) { for (var j = 0; j < align.length; j++)\r\n            { align[j].style.left = left; } }\r\n        } }\r\n        if (cm.options.fixedGutter)\r\n        { display.gutters.style.left = (comp + gutterW) + "px"; }\r\n    }\r\n\r\n    // Used to ensure that the line number gutter is still the right\r\n    // size for the current document size. Returns true when an update\r\n    // is needed.\r\n    function maybeUpdateLineNumberWidth(cm) {\r\n        if (!cm.options.lineNumbers) { return false }\r\n        var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;\r\n        if (last.length != display.lineNumChars) {\r\n            var test = display.measure.appendChild(elt("div", [elt("div", last)],\r\n                "CodeMirror-linenumber CodeMirror-gutter-elt"));\r\n            var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;\r\n            display.lineGutter.style.width = "";\r\n            display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding) + 1;\r\n            display.lineNumWidth = display.lineNumInnerWidth + padding;\r\n            display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;\r\n            display.lineGutter.style.width = display.lineNumWidth + "px";\r\n            updateGutterSpace(cm);\r\n            return true\r\n        }\r\n        return false\r\n    }\r\n\r\n    // SCROLLING THINGS INTO VIEW\r\n\r\n    // If an editor sits on the top or bottom of the window, partially\r\n    // scrolled out of view, this ensures that the cursor is visible.\r\n    function maybeScrollWindow(cm, rect) {\r\n        if (signalDOMEvent(cm, "scrollCursorIntoView")) { return }\r\n\r\n        var display = cm.display, box = display.sizer.getBoundingClientRect(), doScroll = null;\r\n        if (rect.top + box.top < 0) { doScroll = true; }\r\n        else if (rect.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) { doScroll = false; }\r\n        if (doScroll != null && !phantom) {\r\n            var scrollNode = elt("div", "\\u200b", null, ("position: absolute;\\n                         top: " + (rect.top - display.viewOffset - paddingTop(cm.display)) + "px;\\n                         height: " + (rect.bottom - rect.top + scrollGap(cm) + display.barHeight) + "px;\\n                         left: " + (rect.left) + "px; width: " + (Math.max(2, rect.right - rect.left)) + "px;"));\r\n            cm.display.lineSpace.appendChild(scrollNode);\r\n            scrollNode.scrollIntoView(doScroll);\r\n            cm.display.lineSpace.removeChild(scrollNode);\r\n        }\r\n    }\r\n\r\n    // Scroll a given position into view (immediately), verifying that\r\n    // it actually became visible (as line heights are accurately\r\n    // measured, the position of something may \'drift\' during drawing).\r\n    function scrollPosIntoView(cm, pos, end, margin) {\r\n        if (margin == null) { margin = 0; }\r\n        var rect;\r\n        if (!cm.options.lineWrapping && pos == end) {\r\n            // Set pos and end to the cursor positions around the character pos sticks to\r\n            // If pos.sticky == "before", that is around pos.ch - 1, otherwise around pos.ch\r\n            // If pos == Pos(_, 0, "before"), pos and end are unchanged\r\n            pos = pos.ch ? Pos(pos.line, pos.sticky == "before" ? pos.ch - 1 : pos.ch, "after") : pos;\r\n            end = pos.sticky == "before" ? Pos(pos.line, pos.ch + 1, "before") : pos;\r\n        }\r\n        for (var limit = 0; limit < 5; limit++) {\r\n            var changed = false;\r\n            var coords = cursorCoords(cm, pos);\r\n            var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);\r\n            rect = {left: Math.min(coords.left, endCoords.left),\r\n                top: Math.min(coords.top, endCoords.top) - margin,\r\n                right: Math.max(coords.left, endCoords.left),\r\n                bottom: Math.max(coords.bottom, endCoords.bottom) + margin};\r\n            var scrollPos = calculateScrollPos(cm, rect);\r\n            var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;\r\n            if (scrollPos.scrollTop != null) {\r\n                updateScrollTop(cm, scrollPos.scrollTop);\r\n                if (Math.abs(cm.doc.scrollTop - startTop) > 1) { changed = true; }\r\n            }\r\n            if (scrollPos.scrollLeft != null) {\r\n                setScrollLeft(cm, scrollPos.scrollLeft);\r\n                if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) { changed = true; }\r\n            }\r\n            if (!changed) { break }\r\n        }\r\n        return rect\r\n    }\r\n\r\n    // Scroll a given set of coordinates into view (immediately).\r\n    function scrollIntoView(cm, rect) {\r\n        var scrollPos = calculateScrollPos(cm, rect);\r\n        if (scrollPos.scrollTop != null) { updateScrollTop(cm, scrollPos.scrollTop); }\r\n        if (scrollPos.scrollLeft != null) { setScrollLeft(cm, scrollPos.scrollLeft); }\r\n    }\r\n\r\n    // Calculate a new scroll position needed to scroll the given\r\n    // rectangle into view. Returns an object with scrollTop and\r\n    // scrollLeft properties. When these are undefined, the\r\n    // vertical/horizontal position does not need to be adjusted.\r\n    function calculateScrollPos(cm, rect) {\r\n        var display = cm.display, snapMargin = textHeight(cm.display);\r\n        if (rect.top < 0) { rect.top = 0; }\r\n        var screentop = cm.curOp && cm.curOp.scrollTop != null ? cm.curOp.scrollTop : display.scroller.scrollTop;\r\n        var screen = displayHeight(cm), result = {};\r\n        if (rect.bottom - rect.top > screen) { rect.bottom = rect.top + screen; }\r\n        var docBottom = cm.doc.height + paddingVert(display);\r\n        var atTop = rect.top < snapMargin, atBottom = rect.bottom > docBottom - snapMargin;\r\n        if (rect.top < screentop) {\r\n            result.scrollTop = atTop ? 0 : rect.top;\r\n        } else if (rect.bottom > screentop + screen) {\r\n            var newTop = Math.min(rect.top, (atBottom ? docBottom : rect.bottom) - screen);\r\n            if (newTop != screentop) { result.scrollTop = newTop; }\r\n        }\r\n\r\n        var screenleft = cm.curOp && cm.curOp.scrollLeft != null ? cm.curOp.scrollLeft : display.scroller.scrollLeft;\r\n        var screenw = displayWidth(cm) - (cm.options.fixedGutter ? display.gutters.offsetWidth : 0);\r\n        var tooWide = rect.right - rect.left > screenw;\r\n        if (tooWide) { rect.right = rect.left + screenw; }\r\n        if (rect.left < 10)\r\n        { result.scrollLeft = 0; }\r\n        else if (rect.left < screenleft)\r\n        { result.scrollLeft = Math.max(0, rect.left - (tooWide ? 0 : 10)); }\r\n        else if (rect.right > screenw + screenleft - 3)\r\n        { result.scrollLeft = rect.right + (tooWide ? 0 : 10) - screenw; }\r\n        return result\r\n    }\r\n\r\n    // Store a relative adjustment to the scroll position in the current\r\n    // operation (to be applied when the operation finishes).\r\n    function addToScrollTop(cm, top) {\r\n        if (top == null) { return }\r\n        resolveScrollToPos(cm);\r\n        cm.curOp.scrollTop = (cm.curOp.scrollTop == null ? cm.doc.scrollTop : cm.curOp.scrollTop) + top;\r\n    }\r\n\r\n    // Make sure that at the end of the operation the current cursor is\r\n    // shown.\r\n    function ensureCursorVisible(cm) {\r\n        resolveScrollToPos(cm);\r\n        var cur = cm.getCursor();\r\n        cm.curOp.scrollToPos = {from: cur, to: cur, margin: cm.options.cursorScrollMargin};\r\n    }\r\n\r\n    function scrollToCoords(cm, x, y) {\r\n        if (x != null || y != null) { resolveScrollToPos(cm); }\r\n        if (x != null) { cm.curOp.scrollLeft = x; }\r\n        if (y != null) { cm.curOp.scrollTop = y; }\r\n    }\r\n\r\n    function scrollToRange(cm, range$$1) {\r\n        resolveScrollToPos(cm);\r\n        cm.curOp.scrollToPos = range$$1;\r\n    }\r\n\r\n    // When an operation has its scrollToPos property set, and another\r\n    // scroll action is applied before the end of the operation, this\r\n    // \'simulates\' scrolling that position into view in a cheap way, so\r\n    // that the effect of intermediate scroll commands is not ignored.\r\n    function resolveScrollToPos(cm) {\r\n        var range$$1 = cm.curOp.scrollToPos;\r\n        if (range$$1) {\r\n            cm.curOp.scrollToPos = null;\r\n            var from = estimateCoords(cm, range$$1.from), to = estimateCoords(cm, range$$1.to);\r\n            scrollToCoordsRange(cm, from, to, range$$1.margin);\r\n        }\r\n    }\r\n\r\n    function scrollToCoordsRange(cm, from, to, margin) {\r\n        var sPos = calculateScrollPos(cm, {\r\n            left: Math.min(from.left, to.left),\r\n            top: Math.min(from.top, to.top) - margin,\r\n            right: Math.max(from.right, to.right),\r\n            bottom: Math.max(from.bottom, to.bottom) + margin\r\n        });\r\n        scrollToCoords(cm, sPos.scrollLeft, sPos.scrollTop);\r\n    }\r\n\r\n    // Sync the scrollable area and scrollbars, ensure the viewport\r\n    // covers the visible area.\r\n    function updateScrollTop(cm, val) {\r\n        if (Math.abs(cm.doc.scrollTop - val) < 2) { return }\r\n        if (!gecko) { updateDisplaySimple(cm, {top: val}); }\r\n        setScrollTop(cm, val, true);\r\n        if (gecko) { updateDisplaySimple(cm); }\r\n        startWorker(cm, 100);\r\n    }\r\n\r\n    function setScrollTop(cm, val, forceScroll) {\r\n        val = Math.min(cm.display.scroller.scrollHeight - cm.display.scroller.clientHeight, val);\r\n        if (cm.display.scroller.scrollTop == val && !forceScroll) { return }\r\n        cm.doc.scrollTop = val;\r\n        cm.display.scrollbars.setScrollTop(val);\r\n        if (cm.display.scroller.scrollTop != val) { cm.display.scroller.scrollTop = val; }\r\n    }\r\n\r\n    // Sync scroller and scrollbar, ensure the gutter elements are\r\n    // aligned.\r\n    function setScrollLeft(cm, val, isScroller, forceScroll) {\r\n        val = Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth);\r\n        if ((isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) && !forceScroll) { return }\r\n        cm.doc.scrollLeft = val;\r\n        alignHorizontally(cm);\r\n        if (cm.display.scroller.scrollLeft != val) { cm.display.scroller.scrollLeft = val; }\r\n        cm.display.scrollbars.setScrollLeft(val);\r\n    }\r\n\r\n    // SCROLLBARS\r\n\r\n    // Prepare DOM reads needed to update the scrollbars. Done in one\r\n    // shot to minimize update/measure roundtrips.\r\n    function measureForScrollbars(cm) {\r\n        var d = cm.display, gutterW = d.gutters.offsetWidth;\r\n        var docH = Math.round(cm.doc.height + paddingVert(cm.display));\r\n        return {\r\n            clientHeight: d.scroller.clientHeight,\r\n            viewHeight: d.wrapper.clientHeight,\r\n            scrollWidth: d.scroller.scrollWidth, clientWidth: d.scroller.clientWidth,\r\n            viewWidth: d.wrapper.clientWidth,\r\n            barLeft: cm.options.fixedGutter ? gutterW : 0,\r\n            docHeight: docH,\r\n            scrollHeight: docH + scrollGap(cm) + d.barHeight,\r\n            nativeBarWidth: d.nativeBarWidth,\r\n            gutterWidth: gutterW\r\n        }\r\n    }\r\n\r\n    var NativeScrollbars = function(place, scroll, cm) {\r\n        this.cm = cm;\r\n        var vert = this.vert = elt("div", [elt("div", null, null, "min-width: 1px")], "CodeMirror-vscrollbar");\r\n        var horiz = this.horiz = elt("div", [elt("div", null, null, "height: 100%; min-height: 1px")], "CodeMirror-hscrollbar");\r\n        vert.tabIndex = horiz.tabIndex = -1;\r\n        place(vert); place(horiz);\r\n\r\n        on(vert, "scroll", function () {\r\n            if (vert.clientHeight) { scroll(vert.scrollTop, "vertical"); }\r\n        });\r\n        on(horiz, "scroll", function () {\r\n            if (horiz.clientWidth) { scroll(horiz.scrollLeft, "horizontal"); }\r\n        });\r\n\r\n        this.checkedZeroWidth = false;\r\n        // Need to set a minimum width to see the scrollbar on IE7 (but must not set it on IE8).\r\n        if (ie && ie_version < 8) { this.horiz.style.minHeight = this.vert.style.minWidth = "18px"; }\r\n    };\r\n\r\n    NativeScrollbars.prototype.update = function (measure) {\r\n        var needsH = measure.scrollWidth > measure.clientWidth + 1;\r\n        var needsV = measure.scrollHeight > measure.clientHeight + 1;\r\n        var sWidth = measure.nativeBarWidth;\r\n\r\n        if (needsV) {\r\n            this.vert.style.display = "block";\r\n            this.vert.style.bottom = needsH ? sWidth + "px" : "0";\r\n            var totalHeight = measure.viewHeight - (needsH ? sWidth : 0);\r\n            // A bug in IE8 can cause this value to be negative, so guard it.\r\n            this.vert.firstChild.style.height =\r\n                Math.max(0, measure.scrollHeight - measure.clientHeight + totalHeight) + "px";\r\n        } else {\r\n            this.vert.style.display = "";\r\n            this.vert.firstChild.style.height = "0";\r\n        }\r\n\r\n        if (needsH) {\r\n            this.horiz.style.display = "block";\r\n            this.horiz.style.right = needsV ? sWidth + "px" : "0";\r\n            this.horiz.style.left = measure.barLeft + "px";\r\n            var totalWidth = measure.viewWidth - measure.barLeft - (needsV ? sWidth : 0);\r\n            this.horiz.firstChild.style.width =\r\n                Math.max(0, measure.scrollWidth - measure.clientWidth + totalWidth) + "px";\r\n        } else {\r\n            this.horiz.style.display = "";\r\n            this.horiz.firstChild.style.width = "0";\r\n        }\r\n\r\n        if (!this.checkedZeroWidth && measure.clientHeight > 0) {\r\n            if (sWidth == 0) { this.zeroWidthHack(); }\r\n            this.checkedZeroWidth = true;\r\n        }\r\n\r\n        return {right: needsV ? sWidth : 0, bottom: needsH ? sWidth : 0}\r\n    };\r\n\r\n    NativeScrollbars.prototype.setScrollLeft = function (pos) {\r\n        if (this.horiz.scrollLeft != pos) { this.horiz.scrollLeft = pos; }\r\n        if (this.disableHoriz) { this.enableZeroWidthBar(this.horiz, this.disableHoriz, "horiz"); }\r\n    };\r\n\r\n    NativeScrollbars.prototype.setScrollTop = function (pos) {\r\n        if (this.vert.scrollTop != pos) { this.vert.scrollTop = pos; }\r\n        if (this.disableVert) { this.enableZeroWidthBar(this.vert, this.disableVert, "vert"); }\r\n    };\r\n\r\n    NativeScrollbars.prototype.zeroWidthHack = function () {\r\n        var w = mac && !mac_geMountainLion ? "12px" : "18px";\r\n        this.horiz.style.height = this.vert.style.width = w;\r\n        this.horiz.style.pointerEvents = this.vert.style.pointerEvents = "none";\r\n        this.disableHoriz = new Delayed;\r\n        this.disableVert = new Delayed;\r\n    };\r\n\r\n    NativeScrollbars.prototype.enableZeroWidthBar = function (bar, delay, type) {\r\n        bar.style.pointerEvents = "auto";\r\n        function maybeDisable() {\r\n            // To find out whether the scrollbar is still visible, we\r\n            // check whether the element under the pixel in the bottom\r\n            // right corner of the scrollbar box is the scrollbar box\r\n            // itself (when the bar is still visible) or its filler child\r\n            // (when the bar is hidden). If it is still visible, we keep\r\n            // it enabled, if it\'s hidden, we disable pointer events.\r\n            var box = bar.getBoundingClientRect();\r\n            var elt$$1 = type == "vert" ? document.elementFromPoint(box.right - 1, (box.top + box.bottom) / 2)\r\n                : document.elementFromPoint((box.right + box.left) / 2, box.bottom - 1);\r\n            if (elt$$1 != bar) { bar.style.pointerEvents = "none"; }\r\n            else { delay.set(1000, maybeDisable); }\r\n        }\r\n        delay.set(1000, maybeDisable);\r\n    };\r\n\r\n    NativeScrollbars.prototype.clear = function () {\r\n        var parent = this.horiz.parentNode;\r\n        parent.removeChild(this.horiz);\r\n        parent.removeChild(this.vert);\r\n    };\r\n\r\n    var NullScrollbars = function () {};\r\n\r\n    NullScrollbars.prototype.update = function () { return {bottom: 0, right: 0} };\r\n    NullScrollbars.prototype.setScrollLeft = function () {};\r\n    NullScrollbars.prototype.setScrollTop = function () {};\r\n    NullScrollbars.prototype.clear = function () {};\r\n\r\n    function updateScrollbars(cm, measure) {\r\n        if (!measure) { measure = measureForScrollbars(cm); }\r\n        var startWidth = cm.display.barWidth, startHeight = cm.display.barHeight;\r\n        updateScrollbarsInner(cm, measure);\r\n        for (var i = 0; i < 4 && startWidth != cm.display.barWidth || startHeight != cm.display.barHeight; i++) {\r\n            if (startWidth != cm.display.barWidth && cm.options.lineWrapping)\r\n            { updateHeightsInViewport(cm); }\r\n            updateScrollbarsInner(cm, measureForScrollbars(cm));\r\n            startWidth = cm.display.barWidth; startHeight = cm.display.barHeight;\r\n        }\r\n    }\r\n\r\n    // Re-synchronize the fake scrollbars with the actual size of the\r\n    // content.\r\n    function updateScrollbarsInner(cm, measure) {\r\n        var d = cm.display;\r\n        var sizes = d.scrollbars.update(measure);\r\n\r\n        d.sizer.style.paddingRight = (d.barWidth = sizes.right) + "px";\r\n        d.sizer.style.paddingBottom = (d.barHeight = sizes.bottom) + "px";\r\n        d.heightForcer.style.borderBottom = sizes.bottom + "px solid transparent";\r\n\r\n        if (sizes.right && sizes.bottom) {\r\n            d.scrollbarFiller.style.display = "block";\r\n            d.scrollbarFiller.style.height = sizes.bottom + "px";\r\n            d.scrollbarFiller.style.width = sizes.right + "px";\r\n        } else { d.scrollbarFiller.style.display = ""; }\r\n        if (sizes.bottom && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {\r\n            d.gutterFiller.style.display = "block";\r\n            d.gutterFiller.style.height = sizes.bottom + "px";\r\n            d.gutterFiller.style.width = measure.gutterWidth + "px";\r\n        } else { d.gutterFiller.style.display = ""; }\r\n    }\r\n\r\n    var scrollbarModel = {"native": NativeScrollbars, "null": NullScrollbars};\r\n\r\n    function initScrollbars(cm) {\r\n        if (cm.display.scrollbars) {\r\n            cm.display.scrollbars.clear();\r\n            if (cm.display.scrollbars.addClass)\r\n            { rmClass(cm.display.wrapper, cm.display.scrollbars.addClass); }\r\n        }\r\n\r\n        cm.display.scrollbars = new scrollbarModel[cm.options.scrollbarStyle](function (node) {\r\n            cm.display.wrapper.insertBefore(node, cm.display.scrollbarFiller);\r\n            // Prevent clicks in the scrollbars from killing focus\r\n            on(node, "mousedown", function () {\r\n                if (cm.state.focused) { setTimeout(function () { return cm.display.input.focus(); }, 0); }\r\n            });\r\n            node.setAttribute("cm-not-content", "true");\r\n        }, function (pos, axis) {\r\n            if (axis == "horizontal") { setScrollLeft(cm, pos); }\r\n            else { updateScrollTop(cm, pos); }\r\n        }, cm);\r\n        if (cm.display.scrollbars.addClass)\r\n        { addClass(cm.display.wrapper, cm.display.scrollbars.addClass); }\r\n    }\r\n\r\n    // Operations are used to wrap a series of changes to the editor\r\n    // state in such a way that each change won\'t have to update the\r\n    // cursor and display (which would be awkward, slow, and\r\n    // error-prone). Instead, display updates are batched and then all\r\n    // combined and executed at once.\r\n\r\n    var nextOpId = 0;\r\n    // Start a new operation.\r\n    function startOperation(cm) {\r\n        cm.curOp = {\r\n            cm: cm,\r\n            viewChanged: false,      // Flag that indicates that lines might need to be redrawn\r\n            startHeight: cm.doc.height, // Used to detect need to update scrollbar\r\n            forceUpdate: false,      // Used to force a redraw\r\n            updateInput: 0,       // Whether to reset the input textarea\r\n            typing: false,           // Whether this reset should be careful to leave existing text (for compositing)\r\n            changeObjs: null,        // Accumulated changes, for firing change events\r\n            cursorActivityHandlers: null, // Set of handlers to fire cursorActivity on\r\n            cursorActivityCalled: 0, // Tracks which cursorActivity handlers have been called already\r\n            selectionChanged: false, // Whether the selection needs to be redrawn\r\n            updateMaxLine: false,    // Set when the widest line needs to be determined anew\r\n            scrollLeft: null, scrollTop: null, // Intermediate scroll position, not pushed to DOM yet\r\n            scrollToPos: null,       // Used to scroll to a specific position\r\n            focus: false,\r\n            id: ++nextOpId           // Unique ID\r\n        };\r\n        pushOperation(cm.curOp);\r\n    }\r\n\r\n    // Finish an operation, updating the display and signalling delayed events\r\n    function endOperation(cm) {\r\n        var op = cm.curOp;\r\n        if (op) { finishOperation(op, function (group) {\r\n            for (var i = 0; i < group.ops.length; i++)\r\n            { group.ops[i].cm.curOp = null; }\r\n            endOperations(group);\r\n        }); }\r\n    }\r\n\r\n    // The DOM updates done when an operation finishes are batched so\r\n    // that the minimum number of relayouts are required.\r\n    function endOperations(group) {\r\n        var ops = group.ops;\r\n        for (var i = 0; i < ops.length; i++) // Read DOM\r\n        { endOperation_R1(ops[i]); }\r\n        for (var i$1 = 0; i$1 < ops.length; i$1++) // Write DOM (maybe)\r\n        { endOperation_W1(ops[i$1]); }\r\n        for (var i$2 = 0; i$2 < ops.length; i$2++) // Read DOM\r\n        { endOperation_R2(ops[i$2]); }\r\n        for (var i$3 = 0; i$3 < ops.length; i$3++) // Write DOM (maybe)\r\n        { endOperation_W2(ops[i$3]); }\r\n        for (var i$4 = 0; i$4 < ops.length; i$4++) // Read DOM\r\n        { endOperation_finish(ops[i$4]); }\r\n    }\r\n\r\n    function endOperation_R1(op) {\r\n        var cm = op.cm, display = cm.display;\r\n        maybeClipScrollbars(cm);\r\n        if (op.updateMaxLine) { findMaxLine(cm); }\r\n\r\n        op.mustUpdate = op.viewChanged || op.forceUpdate || op.scrollTop != null ||\r\n            op.scrollToPos && (op.scrollToPos.from.line < display.viewFrom ||\r\n                op.scrollToPos.to.line >= display.viewTo) ||\r\n            display.maxLineChanged && cm.options.lineWrapping;\r\n        op.update = op.mustUpdate &&\r\n            new DisplayUpdate(cm, op.mustUpdate && {top: op.scrollTop, ensure: op.scrollToPos}, op.forceUpdate);\r\n    }\r\n\r\n    function endOperation_W1(op) {\r\n        op.updatedDisplay = op.mustUpdate && updateDisplayIfNeeded(op.cm, op.update);\r\n    }\r\n\r\n    function endOperation_R2(op) {\r\n        var cm = op.cm, display = cm.display;\r\n        if (op.updatedDisplay) { updateHeightsInViewport(cm); }\r\n\r\n        op.barMeasure = measureForScrollbars(cm);\r\n\r\n        // If the max line changed since it was last measured, measure it,\r\n        // and ensure the document\'s width matches it.\r\n        // updateDisplay_W2 will use these properties to do the actual resizing\r\n        if (display.maxLineChanged && !cm.options.lineWrapping) {\r\n            op.adjustWidthTo = measureChar(cm, display.maxLine, display.maxLine.text.length).left + 3;\r\n            cm.display.sizerWidth = op.adjustWidthTo;\r\n            op.barMeasure.scrollWidth =\r\n                Math.max(display.scroller.clientWidth, display.sizer.offsetLeft + op.adjustWidthTo + scrollGap(cm) + cm.display.barWidth);\r\n            op.maxScrollLeft = Math.max(0, display.sizer.offsetLeft + op.adjustWidthTo - displayWidth(cm));\r\n        }\r\n\r\n        if (op.updatedDisplay || op.selectionChanged)\r\n        { op.preparedSelection = display.input.prepareSelection(); }\r\n    }\r\n\r\n    function endOperation_W2(op) {\r\n        var cm = op.cm;\r\n\r\n        if (op.adjustWidthTo != null) {\r\n            cm.display.sizer.style.minWidth = op.adjustWidthTo + "px";\r\n            if (op.maxScrollLeft < cm.doc.scrollLeft)\r\n            { setScrollLeft(cm, Math.min(cm.display.scroller.scrollLeft, op.maxScrollLeft), true); }\r\n            cm.display.maxLineChanged = false;\r\n        }\r\n\r\n        var takeFocus = op.focus && op.focus == activeElt();\r\n        if (op.preparedSelection)\r\n        { cm.display.input.showSelection(op.preparedSelection, takeFocus); }\r\n        if (op.updatedDisplay || op.startHeight != cm.doc.height)\r\n        { updateScrollbars(cm, op.barMeasure); }\r\n        if (op.updatedDisplay)\r\n        { setDocumentHeight(cm, op.barMeasure); }\r\n\r\n        if (op.selectionChanged) { restartBlink(cm); }\r\n\r\n        if (cm.state.focused && op.updateInput)\r\n        { cm.display.input.reset(op.typing); }\r\n        if (takeFocus) { ensureFocus(op.cm); }\r\n    }\r\n\r\n    function endOperation_finish(op) {\r\n        var cm = op.cm, display = cm.display, doc = cm.doc;\r\n\r\n        if (op.updatedDisplay) { postUpdateDisplay(cm, op.update); }\r\n\r\n        // Abort mouse wheel delta measurement, when scrolling explicitly\r\n        if (display.wheelStartX != null && (op.scrollTop != null || op.scrollLeft != null || op.scrollToPos))\r\n        { display.wheelStartX = display.wheelStartY = null; }\r\n\r\n        // Propagate the scroll position to the actual DOM scroller\r\n        if (op.scrollTop != null) { setScrollTop(cm, op.scrollTop, op.forceScroll); }\r\n\r\n        if (op.scrollLeft != null) { setScrollLeft(cm, op.scrollLeft, true, true); }\r\n        // If we need to scroll a specific position into view, do so.\r\n        if (op.scrollToPos) {\r\n            var rect = scrollPosIntoView(cm, clipPos(doc, op.scrollToPos.from),\r\n                clipPos(doc, op.scrollToPos.to), op.scrollToPos.margin);\r\n            maybeScrollWindow(cm, rect);\r\n        }\r\n\r\n        // Fire events for markers that are hidden/unidden by editing or\r\n        // undoing\r\n        var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;\r\n        if (hidden) { for (var i = 0; i < hidden.length; ++i)\r\n        { if (!hidden[i].lines.length) { signal(hidden[i], "hide"); } } }\r\n        if (unhidden) { for (var i$1 = 0; i$1 < unhidden.length; ++i$1)\r\n        { if (unhidden[i$1].lines.length) { signal(unhidden[i$1], "unhide"); } } }\r\n\r\n        if (display.wrapper.offsetHeight)\r\n        { doc.scrollTop = cm.display.scroller.scrollTop; }\r\n\r\n        // Fire change events, and delayed event handlers\r\n        if (op.changeObjs)\r\n        { signal(cm, "changes", cm, op.changeObjs); }\r\n        if (op.update)\r\n        { op.update.finish(); }\r\n    }\r\n\r\n    // Run the given function in an operation\r\n    function runInOp(cm, f) {\r\n        if (cm.curOp) { return f() }\r\n        startOperation(cm);\r\n        try { return f() }\r\n        finally { endOperation(cm); }\r\n    }\r\n    // Wraps a function in an operation. Returns the wrapped function.\r\n    function operation(cm, f) {\r\n        return function() {\r\n            if (cm.curOp) { return f.apply(cm, arguments) }\r\n            startOperation(cm);\r\n            try { return f.apply(cm, arguments) }\r\n            finally { endOperation(cm); }\r\n        }\r\n    }\r\n    // Used to add methods to editor and doc instances, wrapping them in\r\n    // operations.\r\n    function methodOp(f) {\r\n        return function() {\r\n            if (this.curOp) { return f.apply(this, arguments) }\r\n            startOperation(this);\r\n            try { return f.apply(this, arguments) }\r\n            finally { endOperation(this); }\r\n        }\r\n    }\r\n    function docMethodOp(f) {\r\n        return function() {\r\n            var cm = this.cm;\r\n            if (!cm || cm.curOp) { return f.apply(this, arguments) }\r\n            startOperation(cm);\r\n            try { return f.apply(this, arguments) }\r\n            finally { endOperation(cm); }\r\n        }\r\n    }\r\n\r\n    // Updates the display.view data structure for a given change to the\r\n    // document. From and to are in pre-change coordinates. Lendiff is\r\n    // the amount of lines added or subtracted by the change. This is\r\n    // used for changes that span multiple lines, or change the way\r\n    // lines are divided into visual lines. regLineChange (below)\r\n    // registers single-line changes.\r\n    function regChange(cm, from, to, lendiff) {\r\n        if (from == null) { from = cm.doc.first; }\r\n        if (to == null) { to = cm.doc.first + cm.doc.size; }\r\n        if (!lendiff) { lendiff = 0; }\r\n\r\n        var display = cm.display;\r\n        if (lendiff && to < display.viewTo &&\r\n            (display.updateLineNumbers == null || display.updateLineNumbers > from))\r\n        { display.updateLineNumbers = from; }\r\n\r\n        cm.curOp.viewChanged = true;\r\n\r\n        if (from >= display.viewTo) { // Change after\r\n            if (sawCollapsedSpans && visualLineNo(cm.doc, from) < display.viewTo)\r\n            { resetView(cm); }\r\n        } else if (to <= display.viewFrom) { // Change before\r\n            if (sawCollapsedSpans && visualLineEndNo(cm.doc, to + lendiff) > display.viewFrom) {\r\n                resetView(cm);\r\n            } else {\r\n                display.viewFrom += lendiff;\r\n                display.viewTo += lendiff;\r\n            }\r\n        } else if (from <= display.viewFrom && to >= display.viewTo) { // Full overlap\r\n            resetView(cm);\r\n        } else if (from <= display.viewFrom) { // Top overlap\r\n            var cut = viewCuttingPoint(cm, to, to + lendiff, 1);\r\n            if (cut) {\r\n                display.view = display.view.slice(cut.index);\r\n                display.viewFrom = cut.lineN;\r\n                display.viewTo += lendiff;\r\n            } else {\r\n                resetView(cm);\r\n            }\r\n        } else if (to >= display.viewTo) { // Bottom overlap\r\n            var cut$1 = viewCuttingPoint(cm, from, from, -1);\r\n            if (cut$1) {\r\n                display.view = display.view.slice(0, cut$1.index);\r\n                display.viewTo = cut$1.lineN;\r\n            } else {\r\n                resetView(cm);\r\n            }\r\n        } else { // Gap in the middle\r\n            var cutTop = viewCuttingPoint(cm, from, from, -1);\r\n            var cutBot = viewCuttingPoint(cm, to, to + lendiff, 1);\r\n            if (cutTop && cutBot) {\r\n                display.view = display.view.slice(0, cutTop.index)\r\n                    .concat(buildViewArray(cm, cutTop.lineN, cutBot.lineN))\r\n                    .concat(display.view.slice(cutBot.index));\r\n                display.viewTo += lendiff;\r\n            } else {\r\n                resetView(cm);\r\n            }\r\n        }\r\n\r\n        var ext = display.externalMeasured;\r\n        if (ext) {\r\n            if (to < ext.lineN)\r\n            { ext.lineN += lendiff; }\r\n            else if (from < ext.lineN + ext.size)\r\n            { display.externalMeasured = null; }\r\n        }\r\n    }\r\n\r\n    // Register a change to a single line. Type must be one of "text",\r\n    // "gutter", "class", "widget"\r\n    function regLineChange(cm, line, type) {\r\n        cm.curOp.viewChanged = true;\r\n        var display = cm.display, ext = cm.display.externalMeasured;\r\n        if (ext && line >= ext.lineN && line < ext.lineN + ext.size)\r\n        { display.externalMeasured = null; }\r\n\r\n        if (line < display.viewFrom || line >= display.viewTo) { return }\r\n        var lineView = display.view[findViewIndex(cm, line)];\r\n        if (lineView.node == null) { return }\r\n        var arr = lineView.changes || (lineView.changes = []);\r\n        if (indexOf(arr, type) == -1) { arr.push(type); }\r\n    }\r\n\r\n    // Clear the view.\r\n    function resetView(cm) {\r\n        cm.display.viewFrom = cm.display.viewTo = cm.doc.first;\r\n        cm.display.view = [];\r\n        cm.display.viewOffset = 0;\r\n    }\r\n\r\n    function viewCuttingPoint(cm, oldN, newN, dir) {\r\n        var index = findViewIndex(cm, oldN), diff, view = cm.display.view;\r\n        if (!sawCollapsedSpans || newN == cm.doc.first + cm.doc.size)\r\n        { return {index: index, lineN: newN} }\r\n        var n = cm.display.viewFrom;\r\n        for (var i = 0; i < index; i++)\r\n        { n += view[i].size; }\r\n        if (n != oldN) {\r\n            if (dir > 0) {\r\n                if (index == view.length - 1) { return null }\r\n                diff = (n + view[index].size) - oldN;\r\n                index++;\r\n            } else {\r\n                diff = n - oldN;\r\n            }\r\n            oldN += diff; newN += diff;\r\n        }\r\n        while (visualLineNo(cm.doc, newN) != newN) {\r\n            if (index == (dir < 0 ? 0 : view.length - 1)) { return null }\r\n            newN += dir * view[index - (dir < 0 ? 1 : 0)].size;\r\n            index += dir;\r\n        }\r\n        return {index: index, lineN: newN}\r\n    }\r\n\r\n    // Force the view to cover a given range, adding empty view element\r\n    // or clipping off existing ones as needed.\r\n    function adjustView(cm, from, to) {\r\n        var display = cm.display, view = display.view;\r\n        if (view.length == 0 || from >= display.viewTo || to <= display.viewFrom) {\r\n            display.view = buildViewArray(cm, from, to);\r\n            display.viewFrom = from;\r\n        } else {\r\n            if (display.viewFrom > from)\r\n            { display.view = buildViewArray(cm, from, display.viewFrom).concat(display.view); }\r\n            else if (display.viewFrom < from)\r\n            { display.view = display.view.slice(findViewIndex(cm, from)); }\r\n            display.viewFrom = from;\r\n            if (display.viewTo < to)\r\n            { display.view = display.view.concat(buildViewArray(cm, display.viewTo, to)); }\r\n            else if (display.viewTo > to)\r\n            { display.view = display.view.slice(0, findViewIndex(cm, to)); }\r\n        }\r\n        display.viewTo = to;\r\n    }\r\n\r\n    // Count the number of lines in the view whose DOM representation is\r\n    // out of date (or nonexistent).\r\n    function countDirtyView(cm) {\r\n        var view = cm.display.view, dirty = 0;\r\n        for (var i = 0; i < view.length; i++) {\r\n            var lineView = view[i];\r\n            if (!lineView.hidden && (!lineView.node || lineView.changes)) { ++dirty; }\r\n        }\r\n        return dirty\r\n    }\r\n\r\n    // HIGHLIGHT WORKER\r\n\r\n    function startWorker(cm, time) {\r\n        if (cm.doc.highlightFrontier < cm.display.viewTo)\r\n        { cm.state.highlight.set(time, bind(highlightWorker, cm)); }\r\n    }\r\n\r\n    function highlightWorker(cm) {\r\n        var doc = cm.doc;\r\n        if (doc.highlightFrontier >= cm.display.viewTo) { return }\r\n        var end = +new Date + cm.options.workTime;\r\n        var context = getContextBefore(cm, doc.highlightFrontier);\r\n        var changedLines = [];\r\n\r\n        doc.iter(context.line, Math.min(doc.first + doc.size, cm.display.viewTo + 500), function (line) {\r\n            if (context.line >= cm.display.viewFrom) { // Visible\r\n                var oldStyles = line.styles;\r\n                var resetState = line.text.length > cm.options.maxHighlightLength ? copyState(doc.mode, context.state) : null;\r\n                var highlighted = highlightLine(cm, line, context, true);\r\n                if (resetState) { context.state = resetState; }\r\n                line.styles = highlighted.styles;\r\n                var oldCls = line.styleClasses, newCls = highlighted.classes;\r\n                if (newCls) { line.styleClasses = newCls; }\r\n                else if (oldCls) { line.styleClasses = null; }\r\n                var ischange = !oldStyles || oldStyles.length != line.styles.length ||\r\n                    oldCls != newCls && (!oldCls || !newCls || oldCls.bgClass != newCls.bgClass || oldCls.textClass != newCls.textClass);\r\n                for (var i = 0; !ischange && i < oldStyles.length; ++i) { ischange = oldStyles[i] != line.styles[i]; }\r\n                if (ischange) { changedLines.push(context.line); }\r\n                line.stateAfter = context.save();\r\n                context.nextLine();\r\n            } else {\r\n                if (line.text.length <= cm.options.maxHighlightLength)\r\n                { processLine(cm, line.text, context); }\r\n                line.stateAfter = context.line % 5 == 0 ? context.save() : null;\r\n                context.nextLine();\r\n            }\r\n            if (+new Date > end) {\r\n                startWorker(cm, cm.options.workDelay);\r\n                return true\r\n            }\r\n        });\r\n        doc.highlightFrontier = context.line;\r\n        doc.modeFrontier = Math.max(doc.modeFrontier, context.line);\r\n        if (changedLines.length) { runInOp(cm, function () {\r\n            for (var i = 0; i < changedLines.length; i++)\r\n            { regLineChange(cm, changedLines[i], "text"); }\r\n        }); }\r\n    }\r\n\r\n    // DISPLAY DRAWING\r\n\r\n    var DisplayUpdate = function(cm, viewport, force) {\r\n        var display = cm.display;\r\n\r\n        this.viewport = viewport;\r\n        // Store some values that we\'ll need later (but don\'t want to force a relayout for)\r\n        this.visible = visibleLines(display, cm.doc, viewport);\r\n        this.editorIsHidden = !display.wrapper.offsetWidth;\r\n        this.wrapperHeight = display.wrapper.clientHeight;\r\n        this.wrapperWidth = display.wrapper.clientWidth;\r\n        this.oldDisplayWidth = displayWidth(cm);\r\n        this.force = force;\r\n        this.dims = getDimensions(cm);\r\n        this.events = [];\r\n    };\r\n\r\n    DisplayUpdate.prototype.signal = function (emitter, type) {\r\n        if (hasHandler(emitter, type))\r\n        { this.events.push(arguments); }\r\n    };\r\n    DisplayUpdate.prototype.finish = function () {\r\n        for (var i = 0; i < this.events.length; i++)\r\n        { signal.apply(null, this.events[i]); }\r\n    };\r\n\r\n    function maybeClipScrollbars(cm) {\r\n        var display = cm.display;\r\n        if (!display.scrollbarsClipped && display.scroller.offsetWidth) {\r\n            display.nativeBarWidth = display.scroller.offsetWidth - display.scroller.clientWidth;\r\n            display.heightForcer.style.height = scrollGap(cm) + "px";\r\n            display.sizer.style.marginBottom = -display.nativeBarWidth + "px";\r\n            display.sizer.style.borderRightWidth = scrollGap(cm) + "px";\r\n            display.scrollbarsClipped = true;\r\n        }\r\n    }\r\n\r\n    function selectionSnapshot(cm) {\r\n        if (cm.hasFocus()) { return null }\r\n        var active = activeElt();\r\n        if (!active || !contains(cm.display.lineDiv, active)) { return null }\r\n        var result = {activeElt: active};\r\n        if (window.getSelection) {\r\n            var sel = window.getSelection();\r\n            if (sel.anchorNode && sel.extend && contains(cm.display.lineDiv, sel.anchorNode)) {\r\n                result.anchorNode = sel.anchorNode;\r\n                result.anchorOffset = sel.anchorOffset;\r\n                result.focusNode = sel.focusNode;\r\n                result.focusOffset = sel.focusOffset;\r\n            }\r\n        }\r\n        return result\r\n    }\r\n\r\n    function restoreSelection(snapshot) {\r\n        if (!snapshot || !snapshot.activeElt || snapshot.activeElt == activeElt()) { return }\r\n        snapshot.activeElt.focus();\r\n        if (snapshot.anchorNode && contains(document.body, snapshot.anchorNode) && contains(document.body, snapshot.focusNode)) {\r\n            var sel = window.getSelection(), range$$1 = document.createRange();\r\n            range$$1.setEnd(snapshot.anchorNode, snapshot.anchorOffset);\r\n            range$$1.collapse(false);\r\n            sel.removeAllRanges();\r\n            sel.addRange(range$$1);\r\n            sel.extend(snapshot.focusNode, snapshot.focusOffset);\r\n        }\r\n    }\r\n\r\n    // Does the actual updating of the line display. Bails out\r\n    // (returning false) when there is nothing to be done and forced is\r\n    // false.\r\n    function updateDisplayIfNeeded(cm, update) {\r\n        var display = cm.display, doc = cm.doc;\r\n\r\n        if (update.editorIsHidden) {\r\n            resetView(cm);\r\n            return false\r\n        }\r\n\r\n        // Bail out if the visible area is already rendered and nothing changed.\r\n        if (!update.force &&\r\n            update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo &&\r\n            (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) &&\r\n            display.renderedView == display.view && countDirtyView(cm) == 0)\r\n        { return false }\r\n\r\n        if (maybeUpdateLineNumberWidth(cm)) {\r\n            resetView(cm);\r\n            update.dims = getDimensions(cm);\r\n        }\r\n\r\n        // Compute a suitable new viewport (from & to)\r\n        var end = doc.first + doc.size;\r\n        var from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);\r\n        var to = Math.min(end, update.visible.to + cm.options.viewportMargin);\r\n        if (display.viewFrom < from && from - display.viewFrom < 20) { from = Math.max(doc.first, display.viewFrom); }\r\n        if (display.viewTo > to && display.viewTo - to < 20) { to = Math.min(end, display.viewTo); }\r\n        if (sawCollapsedSpans) {\r\n            from = visualLineNo(cm.doc, from);\r\n            to = visualLineEndNo(cm.doc, to);\r\n        }\r\n\r\n        var different = from != display.viewFrom || to != display.viewTo ||\r\n            display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;\r\n        adjustView(cm, from, to);\r\n\r\n        display.viewOffset = heightAtLine(getLine(cm.doc, display.viewFrom));\r\n        // Position the mover div to align with the current scroll position\r\n        cm.display.mover.style.top = display.viewOffset + "px";\r\n\r\n        var toUpdate = countDirtyView(cm);\r\n        if (!different && toUpdate == 0 && !update.force && display.renderedView == display.view &&\r\n            (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))\r\n        { return false }\r\n\r\n        // For big changes, we hide the enclosing element during the\r\n        // update, since that speeds up the operations on most browsers.\r\n        var selSnapshot = selectionSnapshot(cm);\r\n        if (toUpdate > 4) { display.lineDiv.style.display = "none"; }\r\n        patchDisplay(cm, display.updateLineNumbers, update.dims);\r\n        if (toUpdate > 4) { display.lineDiv.style.display = ""; }\r\n        display.renderedView = display.view;\r\n        // There might have been a widget with a focused element that got\r\n        // hidden or updated, if so re-focus it.\r\n        restoreSelection(selSnapshot);\r\n\r\n        // Prevent selection and cursors from interfering with the scroll\r\n        // width and height.\r\n        removeChildren(display.cursorDiv);\r\n        removeChildren(display.selectionDiv);\r\n        display.gutters.style.height = display.sizer.style.minHeight = 0;\r\n\r\n        if (different) {\r\n            display.lastWrapHeight = update.wrapperHeight;\r\n            display.lastWrapWidth = update.wrapperWidth;\r\n            startWorker(cm, 400);\r\n        }\r\n\r\n        display.updateLineNumbers = null;\r\n\r\n        return true\r\n    }\r\n\r\n    function postUpdateDisplay(cm, update) {\r\n        var viewport = update.viewport;\r\n\r\n        for (var first = true;; first = false) {\r\n            if (!first || !cm.options.lineWrapping || update.oldDisplayWidth == displayWidth(cm)) {\r\n                // Clip forced viewport to actual scrollable area.\r\n                if (viewport && viewport.top != null)\r\n                { viewport = {top: Math.min(cm.doc.height + paddingVert(cm.display) - displayHeight(cm), viewport.top)}; }\r\n                // Updated line heights might result in the drawn area not\r\n                // actually covering the viewport. Keep looping until it does.\r\n                update.visible = visibleLines(cm.display, cm.doc, viewport);\r\n                if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)\r\n                { break }\r\n            }\r\n            if (!updateDisplayIfNeeded(cm, update)) { break }\r\n            updateHeightsInViewport(cm);\r\n            var barMeasure = measureForScrollbars(cm);\r\n            updateSelection(cm);\r\n            updateScrollbars(cm, barMeasure);\r\n            setDocumentHeight(cm, barMeasure);\r\n            update.force = false;\r\n        }\r\n\r\n        update.signal(cm, "update", cm);\r\n        if (cm.display.viewFrom != cm.display.reportedViewFrom || cm.display.viewTo != cm.display.reportedViewTo) {\r\n            update.signal(cm, "viewportChange", cm, cm.display.viewFrom, cm.display.viewTo);\r\n            cm.display.reportedViewFrom = cm.display.viewFrom; cm.display.reportedViewTo = cm.display.viewTo;\r\n        }\r\n    }\r\n\r\n    function updateDisplaySimple(cm, viewport) {\r\n        var update = new DisplayUpdate(cm, viewport);\r\n        if (updateDisplayIfNeeded(cm, update)) {\r\n            updateHeightsInViewport(cm);\r\n            postUpdateDisplay(cm, update);\r\n            var barMeasure = measureForScrollbars(cm);\r\n            updateSelection(cm);\r\n            updateScrollbars(cm, barMeasure);\r\n            setDocumentHeight(cm, barMeasure);\r\n            update.finish();\r\n        }\r\n    }\r\n\r\n    // Sync the actual display DOM structure with display.view, removing\r\n    // nodes for lines that are no longer in view, and creating the ones\r\n    // that are not there yet, and updating the ones that are out of\r\n    // date.\r\n    function patchDisplay(cm, updateNumbersFrom, dims) {\r\n        var display = cm.display, lineNumbers = cm.options.lineNumbers;\r\n        var container = display.lineDiv, cur = container.firstChild;\r\n\r\n        function rm(node) {\r\n            var next = node.nextSibling;\r\n            // Works around a throw-scroll bug in OS X Webkit\r\n            if (webkit && mac && cm.display.currentWheelTarget == node)\r\n            { node.style.display = "none"; }\r\n            else\r\n            { node.parentNode.removeChild(node); }\r\n            return next\r\n        }\r\n\r\n        var view = display.view, lineN = display.viewFrom;\r\n        // Loop over the elements in the view, syncing cur (the DOM nodes\r\n        // in display.lineDiv) with the view as we go.\r\n        for (var i = 0; i < view.length; i++) {\r\n            var lineView = view[i];\r\n            if (lineView.hidden) ; else if (!lineView.node || lineView.node.parentNode != container) { // Not drawn yet\r\n                var node = buildLineElement(cm, lineView, lineN, dims);\r\n                container.insertBefore(node, cur);\r\n            } else { // Already drawn\r\n                while (cur != lineView.node) { cur = rm(cur); }\r\n                var updateNumber = lineNumbers && updateNumbersFrom != null &&\r\n                    updateNumbersFrom <= lineN && lineView.lineNumber;\r\n                if (lineView.changes) {\r\n                    if (indexOf(lineView.changes, "gutter") > -1) { updateNumber = false; }\r\n                    updateLineForChanges(cm, lineView, lineN, dims);\r\n                }\r\n                if (updateNumber) {\r\n                    removeChildren(lineView.lineNumber);\r\n                    lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options, lineN)));\r\n                }\r\n                cur = lineView.node.nextSibling;\r\n            }\r\n            lineN += lineView.size;\r\n        }\r\n        while (cur) { cur = rm(cur); }\r\n    }\r\n\r\n    function updateGutterSpace(cm) {\r\n        var width = cm.display.gutters.offsetWidth;\r\n        cm.display.sizer.style.marginLeft = width + "px";\r\n    }\r\n\r\n    function setDocumentHeight(cm, measure) {\r\n        cm.display.sizer.style.minHeight = measure.docHeight + "px";\r\n        cm.display.heightForcer.style.top = measure.docHeight + "px";\r\n        cm.display.gutters.style.height = (measure.docHeight + cm.display.barHeight + scrollGap(cm)) + "px";\r\n    }\r\n\r\n    // Rebuild the gutter elements, ensure the margin to the left of the\r\n    // code matches their width.\r\n    function updateGutters(cm) {\r\n        var gutters = cm.display.gutters, specs = cm.options.gutters;\r\n        removeChildren(gutters);\r\n        var i = 0;\r\n        for (; i < specs.length; ++i) {\r\n            var gutterClass = specs[i];\r\n            var gElt = gutters.appendChild(elt("div", null, "CodeMirror-gutter " + gutterClass));\r\n            if (gutterClass == "CodeMirror-linenumbers") {\r\n                cm.display.lineGutter = gElt;\r\n                gElt.style.width = (cm.display.lineNumWidth || 1) + "px";\r\n            }\r\n        }\r\n        gutters.style.display = i ? "" : "none";\r\n        updateGutterSpace(cm);\r\n    }\r\n\r\n    // Make sure the gutters options contains the element\r\n    // "CodeMirror-linenumbers" when the lineNumbers option is true.\r\n    function setGuttersForLineNumbers(options) {\r\n        var found = indexOf(options.gutters, "CodeMirror-linenumbers");\r\n        if (found == -1 && options.lineNumbers) {\r\n            options.gutters = options.gutters.concat(["CodeMirror-linenumbers"]);\r\n        } else if (found > -1 && !options.lineNumbers) {\r\n            options.gutters = options.gutters.slice(0);\r\n            options.gutters.splice(found, 1);\r\n        }\r\n    }\r\n\r\n    // Since the delta values reported on mouse wheel events are\r\n    // unstandardized between browsers and even browser versions, and\r\n    // generally horribly unpredictable, this code starts by measuring\r\n    // the scroll effect that the first few mouse wheel events have,\r\n    // and, from that, detects the way it can convert deltas to pixel\r\n    // offsets afterwards.\r\n    //\r\n    // The reason we want to know the amount a wheel event will scroll\r\n    // is that it gives us a chance to update the display before the\r\n    // actual scrolling happens, reducing flickering.\r\n\r\n    var wheelSamples = 0, wheelPixelsPerUnit = null;\r\n    // Fill in a browser-detected starting value on browsers where we\r\n    // know one. These don\'t have to be accurate -- the result of them\r\n    // being wrong would just be a slight flicker on the first wheel\r\n    // scroll (if it is large enough).\r\n    if (ie) { wheelPixelsPerUnit = -.53; }\r\n    else if (gecko) { wheelPixelsPerUnit = 15; }\r\n    else if (chrome) { wheelPixelsPerUnit = -.7; }\r\n    else if (safari) { wheelPixelsPerUnit = -1/3; }\r\n\r\n    function wheelEventDelta(e) {\r\n        var dx = e.wheelDeltaX, dy = e.wheelDeltaY;\r\n        if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) { dx = e.detail; }\r\n        if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) { dy = e.detail; }\r\n        else if (dy == null) { dy = e.wheelDelta; }\r\n        return {x: dx, y: dy}\r\n    }\r\n    function wheelEventPixels(e) {\r\n        var delta = wheelEventDelta(e);\r\n        delta.x *= wheelPixelsPerUnit;\r\n        delta.y *= wheelPixelsPerUnit;\r\n        return delta\r\n    }\r\n\r\n    function onScrollWheel(cm, e) {\r\n        var delta = wheelEventDelta(e), dx = delta.x, dy = delta.y;\r\n\r\n        var display = cm.display, scroll = display.scroller;\r\n        // Quit if there\'s nothing to scroll here\r\n        var canScrollX = scroll.scrollWidth > scroll.clientWidth;\r\n        var canScrollY = scroll.scrollHeight > scroll.clientHeight;\r\n        if (!(dx && canScrollX || dy && canScrollY)) { return }\r\n\r\n        // Webkit browsers on OS X abort momentum scrolls when the target\r\n        // of the scroll event is removed from the scrollable element.\r\n        // This hack (see related code in patchDisplay) makes sure the\r\n        // element is kept around.\r\n        if (dy && mac && webkit) {\r\n            outer: for (var cur = e.target, view = display.view; cur != scroll; cur = cur.parentNode) {\r\n                for (var i = 0; i < view.length; i++) {\r\n                    if (view[i].node == cur) {\r\n                        cm.display.currentWheelTarget = cur;\r\n                        break outer\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // On some browsers, horizontal scrolling will cause redraws to\r\n        // happen before the gutter has been realigned, causing it to\r\n        // wriggle around in a most unseemly way. When we have an\r\n        // estimated pixels/delta value, we just handle horizontal\r\n        // scrolling entirely here. It\'ll be slightly off from native, but\r\n        // better than glitching out.\r\n        if (dx && !gecko && !presto && wheelPixelsPerUnit != null) {\r\n            if (dy && canScrollY)\r\n            { updateScrollTop(cm, Math.max(0, scroll.scrollTop + dy * wheelPixelsPerUnit)); }\r\n            setScrollLeft(cm, Math.max(0, scroll.scrollLeft + dx * wheelPixelsPerUnit));\r\n            // Only prevent default scrolling if vertical scrolling is\r\n            // actually possible. Otherwise, it causes vertical scroll\r\n            // jitter on OSX trackpads when deltaX is small and deltaY\r\n            // is large (issue #3579)\r\n            if (!dy || (dy && canScrollY))\r\n            { e_preventDefault(e); }\r\n            display.wheelStartX = null; // Abort measurement, if in progress\r\n            return\r\n        }\r\n\r\n        // \'Project\' the visible viewport to cover the area that is being\r\n        // scrolled into view (if we know enough to estimate it).\r\n        if (dy && wheelPixelsPerUnit != null) {\r\n            var pixels = dy * wheelPixelsPerUnit;\r\n            var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;\r\n            if (pixels < 0) { top = Math.max(0, top + pixels - 50); }\r\n            else { bot = Math.min(cm.doc.height, bot + pixels + 50); }\r\n            updateDisplaySimple(cm, {top: top, bottom: bot});\r\n        }\r\n\r\n        if (wheelSamples < 20) {\r\n            if (display.wheelStartX == null) {\r\n                display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;\r\n                display.wheelDX = dx; display.wheelDY = dy;\r\n                setTimeout(function () {\r\n                    if (display.wheelStartX == null) { return }\r\n                    var movedX = scroll.scrollLeft - display.wheelStartX;\r\n                    var movedY = scroll.scrollTop - display.wheelStartY;\r\n                    var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||\r\n                        (movedX && display.wheelDX && movedX / display.wheelDX);\r\n                    display.wheelStartX = display.wheelStartY = null;\r\n                    if (!sample) { return }\r\n                    wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);\r\n                    ++wheelSamples;\r\n                }, 200);\r\n            } else {\r\n                display.wheelDX += dx; display.wheelDY += dy;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Selection objects are immutable. A new one is created every time\r\n    // the selection changes. A selection is one or more non-overlapping\r\n    // (and non-touching) ranges, sorted, and an integer that indicates\r\n    // which one is the primary selection (the one that\'s scrolled into\r\n    // view, that getCursor returns, etc).\r\n    var Selection = function(ranges, primIndex) {\r\n        this.ranges = ranges;\r\n        this.primIndex = primIndex;\r\n    };\r\n\r\n    Selection.prototype.primary = function () { return this.ranges[this.primIndex] };\r\n\r\n    Selection.prototype.equals = function (other) {\r\n        if (other == this) { return true }\r\n        if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length) { return false }\r\n        for (var i = 0; i < this.ranges.length; i++) {\r\n            var here = this.ranges[i], there = other.ranges[i];\r\n            if (!equalCursorPos(here.anchor, there.anchor) || !equalCursorPos(here.head, there.head)) { return false }\r\n        }\r\n        return true\r\n    };\r\n\r\n    Selection.prototype.deepCopy = function () {\r\n        var out = [];\r\n        for (var i = 0; i < this.ranges.length; i++)\r\n        { out[i] = new Range(copyPos(this.ranges[i].anchor), copyPos(this.ranges[i].head)); }\r\n        return new Selection(out, this.primIndex)\r\n    };\r\n\r\n    Selection.prototype.somethingSelected = function () {\r\n        for (var i = 0; i < this.ranges.length; i++)\r\n        { if (!this.ranges[i].empty()) { return true } }\r\n        return false\r\n    };\r\n\r\n    Selection.prototype.contains = function (pos, end) {\r\n        if (!end) { end = pos; }\r\n        for (var i = 0; i < this.ranges.length; i++) {\r\n            var range = this.ranges[i];\r\n            if (cmp(end, range.from()) >= 0 && cmp(pos, range.to()) <= 0)\r\n            { return i }\r\n        }\r\n        return -1\r\n    };\r\n\r\n    var Range = function(anchor, head) {\r\n        this.anchor = anchor; this.head = head;\r\n    };\r\n\r\n    Range.prototype.from = function () { return minPos(this.anchor, this.head) };\r\n    Range.prototype.to = function () { return maxPos(this.anchor, this.head) };\r\n    Range.prototype.empty = function () { return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch };\r\n\r\n    // Take an unsorted, potentially overlapping set of ranges, and\r\n    // build a selection out of it. \'Consumes\' ranges array (modifying\r\n    // it).\r\n    function normalizeSelection(cm, ranges, primIndex) {\r\n        var mayTouch = cm && cm.options.selectionsMayTouch;\r\n        var prim = ranges[primIndex];\r\n        ranges.sort(function (a, b) { return cmp(a.from(), b.from()); });\r\n        primIndex = indexOf(ranges, prim);\r\n        for (var i = 1; i < ranges.length; i++) {\r\n            var cur = ranges[i], prev = ranges[i - 1];\r\n            var diff = cmp(prev.to(), cur.from());\r\n            if (mayTouch && !cur.empty() ? diff > 0 : diff >= 0) {\r\n                var from = minPos(prev.from(), cur.from()), to = maxPos(prev.to(), cur.to());\r\n                var inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;\r\n                if (i <= primIndex) { --primIndex; }\r\n                ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));\r\n            }\r\n        }\r\n        return new Selection(ranges, primIndex)\r\n    }\r\n\r\n    function simpleSelection(anchor, head) {\r\n        return new Selection([new Range(anchor, head || anchor)], 0)\r\n    }\r\n\r\n    // Compute the position of the end of a change (its \'to\' property\r\n    // refers to the pre-change end).\r\n    function changeEnd(change) {\r\n        if (!change.text) { return change.to }\r\n        return Pos(change.from.line + change.text.length - 1,\r\n            lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0))\r\n    }\r\n\r\n    // Adjust a position to refer to the post-change position of the\r\n    // same text, or the end of the change if the change covers it.\r\n    function adjustForChange(pos, change) {\r\n        if (cmp(pos, change.from) < 0) { return pos }\r\n        if (cmp(pos, change.to) <= 0) { return changeEnd(change) }\r\n\r\n        var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;\r\n        if (pos.line == change.to.line) { ch += changeEnd(change).ch - change.to.ch; }\r\n        return Pos(line, ch)\r\n    }\r\n\r\n    function computeSelAfterChange(doc, change) {\r\n        var out = [];\r\n        for (var i = 0; i < doc.sel.ranges.length; i++) {\r\n            var range = doc.sel.ranges[i];\r\n            out.push(new Range(adjustForChange(range.anchor, change),\r\n                adjustForChange(range.head, change)));\r\n        }\r\n        return normalizeSelection(doc.cm, out, doc.sel.primIndex)\r\n    }\r\n\r\n    function offsetPos(pos, old, nw) {\r\n        if (pos.line == old.line)\r\n        { return Pos(nw.line, pos.ch - old.ch + nw.ch) }\r\n        else\r\n        { return Pos(nw.line + (pos.line - old.line), pos.ch) }\r\n    }\r\n\r\n    // Used by replaceSelections to allow moving the selection to the\r\n    // start or around the replaced test. Hint may be "start" or "around".\r\n    function computeReplacedSel(doc, changes, hint) {\r\n        var out = [];\r\n        var oldPrev = Pos(doc.first, 0), newPrev = oldPrev;\r\n        for (var i = 0; i < changes.length; i++) {\r\n            var change = changes[i];\r\n            var from = offsetPos(change.from, oldPrev, newPrev);\r\n            var to = offsetPos(changeEnd(change), oldPrev, newPrev);\r\n            oldPrev = change.to;\r\n            newPrev = to;\r\n            if (hint == "around") {\r\n                var range = doc.sel.ranges[i], inv = cmp(range.head, range.anchor) < 0;\r\n                out[i] = new Range(inv ? to : from, inv ? from : to);\r\n            } else {\r\n                out[i] = new Range(from, from);\r\n            }\r\n        }\r\n        return new Selection(out, doc.sel.primIndex)\r\n    }\r\n\r\n    // Used to get the editor into a consistent state again when options change.\r\n\r\n    function loadMode(cm) {\r\n        cm.doc.mode = getMode(cm.options, cm.doc.modeOption);\r\n        resetModeState(cm);\r\n    }\r\n\r\n    function resetModeState(cm) {\r\n        cm.doc.iter(function (line) {\r\n            if (line.stateAfter) { line.stateAfter = null; }\r\n            if (line.styles) { line.styles = null; }\r\n        });\r\n        cm.doc.modeFrontier = cm.doc.highlightFrontier = cm.doc.first;\r\n        startWorker(cm, 100);\r\n        cm.state.modeGen++;\r\n        if (cm.curOp) { regChange(cm); }\r\n    }\r\n\r\n    // DOCUMENT DATA STRUCTURE\r\n\r\n    // By default, updates that start and end at the beginning of a line\r\n    // are treated specially, in order to make the association of line\r\n    // widgets and marker elements with the text behave more intuitive.\r\n    function isWholeLineUpdate(doc, change) {\r\n        return change.from.ch == 0 && change.to.ch == 0 && lst(change.text) == "" &&\r\n            (!doc.cm || doc.cm.options.wholeLineUpdateBefore)\r\n    }\r\n\r\n    // Perform a change on the document data structure.\r\n    function updateDoc(doc, change, markedSpans, estimateHeight$$1) {\r\n        function spansFor(n) {return markedSpans ? markedSpans[n] : null}\r\n        function update(line, text, spans) {\r\n            updateLine(line, text, spans, estimateHeight$$1);\r\n            signalLater(line, "change", line, change);\r\n        }\r\n        function linesFor(start, end) {\r\n            var result = [];\r\n            for (var i = start; i < end; ++i)\r\n            { result.push(new Line(text[i], spansFor(i), estimateHeight$$1)); }\r\n            return result\r\n        }\r\n\r\n        var from = change.from, to = change.to, text = change.text;\r\n        var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);\r\n        var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;\r\n\r\n        // Adjust the line structure\r\n        if (change.full) {\r\n            doc.insert(0, linesFor(0, text.length));\r\n            doc.remove(text.length, doc.size - text.length);\r\n        } else if (isWholeLineUpdate(doc, change)) {\r\n            // This is a whole-line replace. Treated specially to make\r\n            // sure line objects move the way they are supposed to.\r\n            var added = linesFor(0, text.length - 1);\r\n            update(lastLine, lastLine.text, lastSpans);\r\n            if (nlines) { doc.remove(from.line, nlines); }\r\n            if (added.length) { doc.insert(from.line, added); }\r\n        } else if (firstLine == lastLine) {\r\n            if (text.length == 1) {\r\n                update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);\r\n            } else {\r\n                var added$1 = linesFor(1, text.length - 1);\r\n                added$1.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight$$1));\r\n                update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\r\n                doc.insert(from.line + 1, added$1);\r\n            }\r\n        } else if (text.length == 1) {\r\n            update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));\r\n            doc.remove(from.line + 1, nlines);\r\n        } else {\r\n            update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\r\n            update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);\r\n            var added$2 = linesFor(1, text.length - 1);\r\n            if (nlines > 1) { doc.remove(from.line + 1, nlines - 1); }\r\n            doc.insert(from.line + 1, added$2);\r\n        }\r\n\r\n        signalLater(doc, "change", doc, change);\r\n    }\r\n\r\n    // Call f for all linked documents.\r\n    function linkedDocs(doc, f, sharedHistOnly) {\r\n        function propagate(doc, skip, sharedHist) {\r\n            if (doc.linked) { for (var i = 0; i < doc.linked.length; ++i) {\r\n                var rel = doc.linked[i];\r\n                if (rel.doc == skip) { continue }\r\n                var shared = sharedHist && rel.sharedHist;\r\n                if (sharedHistOnly && !shared) { continue }\r\n                f(rel.doc, shared);\r\n                propagate(rel.doc, doc, shared);\r\n            } }\r\n        }\r\n        propagate(doc, null, true);\r\n    }\r\n\r\n    // Attach a document to an editor.\r\n    function attachDoc(cm, doc) {\r\n        if (doc.cm) { throw new Error("This document is already in use.") }\r\n        cm.doc = doc;\r\n        doc.cm = cm;\r\n        estimateLineHeights(cm);\r\n        loadMode(cm);\r\n        setDirectionClass(cm);\r\n        if (!cm.options.lineWrapping) { findMaxLine(cm); }\r\n        cm.options.mode = doc.modeOption;\r\n        regChange(cm);\r\n    }\r\n\r\n    function setDirectionClass(cm) {\r\n        (cm.doc.direction == "rtl" ? addClass : rmClass)(cm.display.lineDiv, "CodeMirror-rtl");\r\n    }\r\n\r\n    function directionChanged(cm) {\r\n        runInOp(cm, function () {\r\n            setDirectionClass(cm);\r\n            regChange(cm);\r\n        });\r\n    }\r\n\r\n    function History(startGen) {\r\n        // Arrays of change events and selections. Doing something adds an\r\n        // event to done and clears undo. Undoing moves events from done\r\n        // to undone, redoing moves them in the other direction.\r\n        this.done = []; this.undone = [];\r\n        this.undoDepth = Infinity;\r\n        // Used to track when changes can be merged into a single undo\r\n        // event\r\n        this.lastModTime = this.lastSelTime = 0;\r\n        this.lastOp = this.lastSelOp = null;\r\n        this.lastOrigin = this.lastSelOrigin = null;\r\n        // Used by the isClean() method\r\n        this.generation = this.maxGeneration = startGen || 1;\r\n    }\r\n\r\n    // Create a history change event from an updateDoc-style change\r\n    // object.\r\n    function historyChangeFromChange(doc, change) {\r\n        var histChange = {from: copyPos(change.from), to: changeEnd(change), text: getBetween(doc, change.from, change.to)};\r\n        attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);\r\n        linkedDocs(doc, function (doc) { return attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1); }, true);\r\n        return histChange\r\n    }\r\n\r\n    // Pop all selection events off the end of a history array. Stop at\r\n    // a change event.\r\n    function clearSelectionEvents(array) {\r\n        while (array.length) {\r\n            var last = lst(array);\r\n            if (last.ranges) { array.pop(); }\r\n            else { break }\r\n        }\r\n    }\r\n\r\n    // Find the top change event in the history. Pop off selection\r\n    // events that are in the way.\r\n    function lastChangeEvent(hist, force) {\r\n        if (force) {\r\n            clearSelectionEvents(hist.done);\r\n            return lst(hist.done)\r\n        } else if (hist.done.length && !lst(hist.done).ranges) {\r\n            return lst(hist.done)\r\n        } else if (hist.done.length > 1 && !hist.done[hist.done.length - 2].ranges) {\r\n            hist.done.pop();\r\n            return lst(hist.done)\r\n        }\r\n    }\r\n\r\n    // Register a change in the history. Merges changes that are within\r\n    // a single operation, or are close together with an origin that\r\n    // allows merging (starting with "+") into a single event.\r\n    function addChangeToHistory(doc, change, selAfter, opId) {\r\n        var hist = doc.history;\r\n        hist.undone.length = 0;\r\n        var time = +new Date, cur;\r\n        var last;\r\n\r\n        if ((hist.lastOp == opId ||\r\n            hist.lastOrigin == change.origin && change.origin &&\r\n            ((change.origin.charAt(0) == "+" && hist.lastModTime > time - (doc.cm ? doc.cm.options.historyEventDelay : 500)) ||\r\n                change.origin.charAt(0) == "*")) &&\r\n            (cur = lastChangeEvent(hist, hist.lastOp == opId))) {\r\n            // Merge this change into the last event\r\n            last = lst(cur.changes);\r\n            if (cmp(change.from, change.to) == 0 && cmp(change.from, last.to) == 0) {\r\n                // Optimized case for simple insertion -- don\'t want to add\r\n                // new changesets for every character typed\r\n                last.to = changeEnd(change);\r\n            } else {\r\n                // Add new sub-event\r\n                cur.changes.push(historyChangeFromChange(doc, change));\r\n            }\r\n        } else {\r\n            // Can not be merged, start a new event.\r\n            var before = lst(hist.done);\r\n            if (!before || !before.ranges)\r\n            { pushSelectionToHistory(doc.sel, hist.done); }\r\n            cur = {changes: [historyChangeFromChange(doc, change)],\r\n                generation: hist.generation};\r\n            hist.done.push(cur);\r\n            while (hist.done.length > hist.undoDepth) {\r\n                hist.done.shift();\r\n                if (!hist.done[0].ranges) { hist.done.shift(); }\r\n            }\r\n        }\r\n        hist.done.push(selAfter);\r\n        hist.generation = ++hist.maxGeneration;\r\n        hist.lastModTime = hist.lastSelTime = time;\r\n        hist.lastOp = hist.lastSelOp = opId;\r\n        hist.lastOrigin = hist.lastSelOrigin = change.origin;\r\n\r\n        if (!last) { signal(doc, "historyAdded"); }\r\n    }\r\n\r\n    function selectionEventCanBeMerged(doc, origin, prev, sel) {\r\n        var ch = origin.charAt(0);\r\n        return ch == "*" ||\r\n            ch == "+" &&\r\n            prev.ranges.length == sel.ranges.length &&\r\n            prev.somethingSelected() == sel.somethingSelected() &&\r\n            new Date - doc.history.lastSelTime <= (doc.cm ? doc.cm.options.historyEventDelay : 500)\r\n    }\r\n\r\n    // Called whenever the selection changes, sets the new selection as\r\n    // the pending selection in the history, and pushes the old pending\r\n    // selection into the \'done\' array when it was significantly\r\n    // different (in number of selected ranges, emptiness, or time).\r\n    function addSelectionToHistory(doc, sel, opId, options) {\r\n        var hist = doc.history, origin = options && options.origin;\r\n\r\n        // A new event is started when the previous origin does not match\r\n        // the current, or the origins don\'t allow matching. Origins\r\n        // starting with * are always merged, those starting with + are\r\n        // merged when similar and close together in time.\r\n        if (opId == hist.lastSelOp ||\r\n            (origin && hist.lastSelOrigin == origin &&\r\n                (hist.lastModTime == hist.lastSelTime && hist.lastOrigin == origin ||\r\n                    selectionEventCanBeMerged(doc, origin, lst(hist.done), sel))))\r\n        { hist.done[hist.done.length - 1] = sel; }\r\n        else\r\n        { pushSelectionToHistory(sel, hist.done); }\r\n\r\n        hist.lastSelTime = +new Date;\r\n        hist.lastSelOrigin = origin;\r\n        hist.lastSelOp = opId;\r\n        if (options && options.clearRedo !== false)\r\n        { clearSelectionEvents(hist.undone); }\r\n    }\r\n\r\n    function pushSelectionToHistory(sel, dest) {\r\n        var top = lst(dest);\r\n        if (!(top && top.ranges && top.equals(sel)))\r\n        { dest.push(sel); }\r\n    }\r\n\r\n    // Used to store marked span information in the history.\r\n    function attachLocalSpans(doc, change, from, to) {\r\n        var existing = change["spans_" + doc.id], n = 0;\r\n        doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function (line) {\r\n            if (line.markedSpans)\r\n            { (existing || (existing = change["spans_" + doc.id] = {}))[n] = line.markedSpans; }\r\n            ++n;\r\n        });\r\n    }\r\n\r\n    // When un/re-doing restores text containing marked spans, those\r\n    // that have been explicitly cleared should not be restored.\r\n    function removeClearedSpans(spans) {\r\n        if (!spans) { return null }\r\n        var out;\r\n        for (var i = 0; i < spans.length; ++i) {\r\n            if (spans[i].marker.explicitlyCleared) { if (!out) { out = spans.slice(0, i); } }\r\n            else if (out) { out.push(spans[i]); }\r\n        }\r\n        return !out ? spans : out.length ? out : null\r\n    }\r\n\r\n    // Retrieve and filter the old marked spans stored in a change event.\r\n    function getOldSpans(doc, change) {\r\n        var found = change["spans_" + doc.id];\r\n        if (!found) { return null }\r\n        var nw = [];\r\n        for (var i = 0; i < change.text.length; ++i)\r\n        { nw.push(removeClearedSpans(found[i])); }\r\n        return nw\r\n    }\r\n\r\n    // Used for un/re-doing changes from the history. Combines the\r\n    // result of computing the existing spans with the set of spans that\r\n    // existed in the history (so that deleting around a span and then\r\n    // undoing brings back the span).\r\n    function mergeOldSpans(doc, change) {\r\n        var old = getOldSpans(doc, change);\r\n        var stretched = stretchSpansOverChange(doc, change);\r\n        if (!old) { return stretched }\r\n        if (!stretched) { return old }\r\n\r\n        for (var i = 0; i < old.length; ++i) {\r\n            var oldCur = old[i], stretchCur = stretched[i];\r\n            if (oldCur && stretchCur) {\r\n                spans: for (var j = 0; j < stretchCur.length; ++j) {\r\n                    var span = stretchCur[j];\r\n                    for (var k = 0; k < oldCur.length; ++k)\r\n                    { if (oldCur[k].marker == span.marker) { continue spans } }\r\n                    oldCur.push(span);\r\n                }\r\n            } else if (stretchCur) {\r\n                old[i] = stretchCur;\r\n            }\r\n        }\r\n        return old\r\n    }\r\n\r\n    // Used both to provide a JSON-safe object in .getHistory, and, when\r\n    // detaching a document, to split the history in two\r\n    function copyHistoryArray(events, newGroup, instantiateSel) {\r\n        var copy = [];\r\n        for (var i = 0; i < events.length; ++i) {\r\n            var event = events[i];\r\n            if (event.ranges) {\r\n                copy.push(instantiateSel ? Selection.prototype.deepCopy.call(event) : event);\r\n                continue\r\n            }\r\n            var changes = event.changes, newChanges = [];\r\n            copy.push({changes: newChanges});\r\n            for (var j = 0; j < changes.length; ++j) {\r\n                var change = changes[j], m = (void 0);\r\n                newChanges.push({from: change.from, to: change.to, text: change.text});\r\n                if (newGroup) { for (var prop in change) { if (m = prop.match(/^spans_(\\d+)$/)) {\r\n                    if (indexOf(newGroup, Number(m[1])) > -1) {\r\n                        lst(newChanges)[prop] = change[prop];\r\n                        delete change[prop];\r\n                    }\r\n                } } }\r\n            }\r\n        }\r\n        return copy\r\n    }\r\n\r\n    // The \'scroll\' parameter given to many of these indicated whether\r\n    // the new cursor position should be scrolled into view after\r\n    // modifying the selection.\r\n\r\n    // If shift is held or the extend flag is set, extends a range to\r\n    // include a given position (and optionally a second position).\r\n    // Otherwise, simply returns the range between the given positions.\r\n    // Used for cursor motion and such.\r\n    function extendRange(range, head, other, extend) {\r\n        if (extend) {\r\n            var anchor = range.anchor;\r\n            if (other) {\r\n                var posBefore = cmp(head, anchor) < 0;\r\n                if (posBefore != (cmp(other, anchor) < 0)) {\r\n                    anchor = head;\r\n                    head = other;\r\n                } else if (posBefore != (cmp(head, other) < 0)) {\r\n                    head = other;\r\n                }\r\n            }\r\n            return new Range(anchor, head)\r\n        } else {\r\n            return new Range(other || head, head)\r\n        }\r\n    }\r\n\r\n    // Extend the primary selection range, discard the rest.\r\n    function extendSelection(doc, head, other, options, extend) {\r\n        if (extend == null) { extend = doc.cm && (doc.cm.display.shift || doc.extend); }\r\n        setSelection(doc, new Selection([extendRange(doc.sel.primary(), head, other, extend)], 0), options);\r\n    }\r\n\r\n    // Extend all selections (pos is an array of selections with length\r\n    // equal the number of selections)\r\n    function extendSelections(doc, heads, options) {\r\n        var out = [];\r\n        var extend = doc.cm && (doc.cm.display.shift || doc.extend);\r\n        for (var i = 0; i < doc.sel.ranges.length; i++)\r\n        { out[i] = extendRange(doc.sel.ranges[i], heads[i], null, extend); }\r\n        var newSel = normalizeSelection(doc.cm, out, doc.sel.primIndex);\r\n        setSelection(doc, newSel, options);\r\n    }\r\n\r\n    // Updates a single range in the selection.\r\n    function replaceOneSelection(doc, i, range, options) {\r\n        var ranges = doc.sel.ranges.slice(0);\r\n        ranges[i] = range;\r\n        setSelection(doc, normalizeSelection(doc.cm, ranges, doc.sel.primIndex), options);\r\n    }\r\n\r\n    // Reset the selection to a single range.\r\n    function setSimpleSelection(doc, anchor, head, options) {\r\n        setSelection(doc, simpleSelection(anchor, head), options);\r\n    }\r\n\r\n    // Give beforeSelectionChange handlers a change to influence a\r\n    // selection update.\r\n    function filterSelectionChange(doc, sel, options) {\r\n        var obj = {\r\n            ranges: sel.ranges,\r\n            update: function(ranges) {\r\n                this.ranges = [];\r\n                for (var i = 0; i < ranges.length; i++)\r\n                { this.ranges[i] = new Range(clipPos(doc, ranges[i].anchor),\r\n                    clipPos(doc, ranges[i].head)); }\r\n            },\r\n            origin: options && options.origin\r\n        };\r\n        signal(doc, "beforeSelectionChange", doc, obj);\r\n        if (doc.cm) { signal(doc.cm, "beforeSelectionChange", doc.cm, obj); }\r\n        if (obj.ranges != sel.ranges) { return normalizeSelection(doc.cm, obj.ranges, obj.ranges.length - 1) }\r\n        else { return sel }\r\n    }\r\n\r\n    function setSelectionReplaceHistory(doc, sel, options) {\r\n        var done = doc.history.done, last = lst(done);\r\n        if (last && last.ranges) {\r\n            done[done.length - 1] = sel;\r\n            setSelectionNoUndo(doc, sel, options);\r\n        } else {\r\n            setSelection(doc, sel, options);\r\n        }\r\n    }\r\n\r\n    // Set a new selection.\r\n    function setSelection(doc, sel, options) {\r\n        setSelectionNoUndo(doc, sel, options);\r\n        addSelectionToHistory(doc, doc.sel, doc.cm ? doc.cm.curOp.id : NaN, options);\r\n    }\r\n\r\n    function setSelectionNoUndo(doc, sel, options) {\r\n        if (hasHandler(doc, "beforeSelectionChange") || doc.cm && hasHandler(doc.cm, "beforeSelectionChange"))\r\n        { sel = filterSelectionChange(doc, sel, options); }\r\n\r\n        var bias = options && options.bias ||\r\n            (cmp(sel.primary().head, doc.sel.primary().head) < 0 ? -1 : 1);\r\n        setSelectionInner(doc, skipAtomicInSelection(doc, sel, bias, true));\r\n\r\n        if (!(options && options.scroll === false) && doc.cm)\r\n        { ensureCursorVisible(doc.cm); }\r\n    }\r\n\r\n    function setSelectionInner(doc, sel) {\r\n        if (sel.equals(doc.sel)) { return }\r\n\r\n        doc.sel = sel;\r\n\r\n        if (doc.cm) {\r\n            doc.cm.curOp.updateInput = 1;\r\n            doc.cm.curOp.selectionChanged = true;\r\n            signalCursorActivity(doc.cm);\r\n        }\r\n        signalLater(doc, "cursorActivity", doc);\r\n    }\r\n\r\n    // Verify that the selection does not partially select any atomic\r\n    // marked ranges.\r\n    function reCheckSelection(doc) {\r\n        setSelectionInner(doc, skipAtomicInSelection(doc, doc.sel, null, false));\r\n    }\r\n\r\n    // Return a selection that does not partially select any atomic\r\n    // ranges.\r\n    function skipAtomicInSelection(doc, sel, bias, mayClear) {\r\n        var out;\r\n        for (var i = 0; i < sel.ranges.length; i++) {\r\n            var range = sel.ranges[i];\r\n            var old = sel.ranges.length == doc.sel.ranges.length && doc.sel.ranges[i];\r\n            var newAnchor = skipAtomic(doc, range.anchor, old && old.anchor, bias, mayClear);\r\n            var newHead = skipAtomic(doc, range.head, old && old.head, bias, mayClear);\r\n            if (out || newAnchor != range.anchor || newHead != range.head) {\r\n                if (!out) { out = sel.ranges.slice(0, i); }\r\n                out[i] = new Range(newAnchor, newHead);\r\n            }\r\n        }\r\n        return out ? normalizeSelection(doc.cm, out, sel.primIndex) : sel\r\n    }\r\n\r\n    function skipAtomicInner(doc, pos, oldPos, dir, mayClear) {\r\n        var line = getLine(doc, pos.line);\r\n        if (line.markedSpans) { for (var i = 0; i < line.markedSpans.length; ++i) {\r\n            var sp = line.markedSpans[i], m = sp.marker;\r\n            if ((sp.from == null || (m.inclusiveLeft ? sp.from <= pos.ch : sp.from < pos.ch)) &&\r\n                (sp.to == null || (m.inclusiveRight ? sp.to >= pos.ch : sp.to > pos.ch))) {\r\n                if (mayClear) {\r\n                    signal(m, "beforeCursorEnter");\r\n                    if (m.explicitlyCleared) {\r\n                        if (!line.markedSpans) { break }\r\n                        else {--i; continue}\r\n                    }\r\n                }\r\n                if (!m.atomic) { continue }\r\n\r\n                if (oldPos) {\r\n                    var near = m.find(dir < 0 ? 1 : -1), diff = (void 0);\r\n                    if (dir < 0 ? m.inclusiveRight : m.inclusiveLeft)\r\n                    { near = movePos(doc, near, -dir, near && near.line == pos.line ? line : null); }\r\n                    if (near && near.line == pos.line && (diff = cmp(near, oldPos)) && (dir < 0 ? diff < 0 : diff > 0))\r\n                    { return skipAtomicInner(doc, near, pos, dir, mayClear) }\r\n                }\r\n\r\n                var far = m.find(dir < 0 ? -1 : 1);\r\n                if (dir < 0 ? m.inclusiveLeft : m.inclusiveRight)\r\n                { far = movePos(doc, far, dir, far.line == pos.line ? line : null); }\r\n                return far ? skipAtomicInner(doc, far, pos, dir, mayClear) : null\r\n            }\r\n        } }\r\n        return pos\r\n    }\r\n\r\n    // Ensure a given position is not inside an atomic range.\r\n    function skipAtomic(doc, pos, oldPos, bias, mayClear) {\r\n        var dir = bias || 1;\r\n        var found = skipAtomicInner(doc, pos, oldPos, dir, mayClear) ||\r\n            (!mayClear && skipAtomicInner(doc, pos, oldPos, dir, true)) ||\r\n            skipAtomicInner(doc, pos, oldPos, -dir, mayClear) ||\r\n            (!mayClear && skipAtomicInner(doc, pos, oldPos, -dir, true));\r\n        if (!found) {\r\n            doc.cantEdit = true;\r\n            return Pos(doc.first, 0)\r\n        }\r\n        return found\r\n    }\r\n\r\n    function movePos(doc, pos, dir, line) {\r\n        if (dir < 0 && pos.ch == 0) {\r\n            if (pos.line > doc.first) { return clipPos(doc, Pos(pos.line - 1)) }\r\n            else { return null }\r\n        } else if (dir > 0 && pos.ch == (line || getLine(doc, pos.line)).text.length) {\r\n            if (pos.line < doc.first + doc.size - 1) { return Pos(pos.line + 1, 0) }\r\n            else { return null }\r\n        } else {\r\n            return new Pos(pos.line, pos.ch + dir)\r\n        }\r\n    }\r\n\r\n    function selectAll(cm) {\r\n        cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()), sel_dontScroll);\r\n    }\r\n\r\n    // UPDATING\r\n\r\n    // Allow "beforeChange" event handlers to influence a change\r\n    function filterChange(doc, change, update) {\r\n        var obj = {\r\n            canceled: false,\r\n            from: change.from,\r\n            to: change.to,\r\n            text: change.text,\r\n            origin: change.origin,\r\n            cancel: function () { return obj.canceled = true; }\r\n        };\r\n        if (update) { obj.update = function (from, to, text, origin) {\r\n            if (from) { obj.from = clipPos(doc, from); }\r\n            if (to) { obj.to = clipPos(doc, to); }\r\n            if (text) { obj.text = text; }\r\n            if (origin !== undefined) { obj.origin = origin; }\r\n        }; }\r\n        signal(doc, "beforeChange", doc, obj);\r\n        if (doc.cm) { signal(doc.cm, "beforeChange", doc.cm, obj); }\r\n\r\n        if (obj.canceled) {\r\n            if (doc.cm) { doc.cm.curOp.updateInput = 2; }\r\n            return null\r\n        }\r\n        return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin}\r\n    }\r\n\r\n    // Apply a change to a document, and add it to the document\'s\r\n    // history, and propagating it to all linked documents.\r\n    function makeChange(doc, change, ignoreReadOnly) {\r\n        if (doc.cm) {\r\n            if (!doc.cm.curOp) { return operation(doc.cm, makeChange)(doc, change, ignoreReadOnly) }\r\n            if (doc.cm.state.suppressEdits) { return }\r\n        }\r\n\r\n        if (hasHandler(doc, "beforeChange") || doc.cm && hasHandler(doc.cm, "beforeChange")) {\r\n            change = filterChange(doc, change, true);\r\n            if (!change) { return }\r\n        }\r\n\r\n        // Possibly split or suppress the update based on the presence\r\n        // of read-only spans in its range.\r\n        var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);\r\n        if (split) {\r\n            for (var i = split.length - 1; i >= 0; --i)\r\n            { makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [""] : change.text, origin: change.origin}); }\r\n        } else {\r\n            makeChangeInner(doc, change);\r\n        }\r\n    }\r\n\r\n    function makeChangeInner(doc, change) {\r\n        if (change.text.length == 1 && change.text[0] == "" && cmp(change.from, change.to) == 0) { return }\r\n        var selAfter = computeSelAfterChange(doc, change);\r\n        addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);\r\n\r\n        makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));\r\n        var rebased = [];\r\n\r\n        linkedDocs(doc, function (doc, sharedHist) {\r\n            if (!sharedHist && indexOf(rebased, doc.history) == -1) {\r\n                rebaseHist(doc.history, change);\r\n                rebased.push(doc.history);\r\n            }\r\n            makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));\r\n        });\r\n    }\r\n\r\n    // Revert a change stored in a document\'s history.\r\n    function makeChangeFromHistory(doc, type, allowSelectionOnly) {\r\n        var suppress = doc.cm && doc.cm.state.suppressEdits;\r\n        if (suppress && !allowSelectionOnly) { return }\r\n\r\n        var hist = doc.history, event, selAfter = doc.sel;\r\n        var source = type == "undo" ? hist.done : hist.undone, dest = type == "undo" ? hist.undone : hist.done;\r\n\r\n        // Verify that there is a useable event (so that ctrl-z won\'t\r\n        // needlessly clear selection events)\r\n        var i = 0;\r\n        for (; i < source.length; i++) {\r\n            event = source[i];\r\n            if (allowSelectionOnly ? event.ranges && !event.equals(doc.sel) : !event.ranges)\r\n            { break }\r\n        }\r\n        if (i == source.length) { return }\r\n        hist.lastOrigin = hist.lastSelOrigin = null;\r\n\r\n        for (;;) {\r\n            event = source.pop();\r\n            if (event.ranges) {\r\n                pushSelectionToHistory(event, dest);\r\n                if (allowSelectionOnly && !event.equals(doc.sel)) {\r\n                    setSelection(doc, event, {clearRedo: false});\r\n                    return\r\n                }\r\n                selAfter = event;\r\n            } else if (suppress) {\r\n                source.push(event);\r\n                return\r\n            } else { break }\r\n        }\r\n\r\n        // Build up a reverse change object to add to the opposite history\r\n        // stack (redo when undoing, and vice versa).\r\n        var antiChanges = [];\r\n        pushSelectionToHistory(selAfter, dest);\r\n        dest.push({changes: antiChanges, generation: hist.generation});\r\n        hist.generation = event.generation || ++hist.maxGeneration;\r\n\r\n        var filter = hasHandler(doc, "beforeChange") || doc.cm && hasHandler(doc.cm, "beforeChange");\r\n\r\n        var loop = function ( i ) {\r\n            var change = event.changes[i];\r\n            change.origin = type;\r\n            if (filter && !filterChange(doc, change, false)) {\r\n                source.length = 0;\r\n                return {}\r\n            }\r\n\r\n            antiChanges.push(historyChangeFromChange(doc, change));\r\n\r\n            var after = i ? computeSelAfterChange(doc, change) : lst(source);\r\n            makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));\r\n            if (!i && doc.cm) { doc.cm.scrollIntoView({from: change.from, to: changeEnd(change)}); }\r\n            var rebased = [];\r\n\r\n            // Propagate to the linked documents\r\n            linkedDocs(doc, function (doc, sharedHist) {\r\n                if (!sharedHist && indexOf(rebased, doc.history) == -1) {\r\n                    rebaseHist(doc.history, change);\r\n                    rebased.push(doc.history);\r\n                }\r\n                makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));\r\n            });\r\n        };\r\n\r\n        for (var i$1 = event.changes.length - 1; i$1 >= 0; --i$1) {\r\n            var returned = loop( i$1 );\r\n\r\n            if ( returned ) return returned.v;\r\n        }\r\n    }\r\n\r\n    // Sub-views need their line numbers shifted when text is added\r\n    // above or below them in the parent document.\r\n    function shiftDoc(doc, distance) {\r\n        if (distance == 0) { return }\r\n        doc.first += distance;\r\n        doc.sel = new Selection(map(doc.sel.ranges, function (range) { return new Range(\r\n            Pos(range.anchor.line + distance, range.anchor.ch),\r\n            Pos(range.head.line + distance, range.head.ch)\r\n        ); }), doc.sel.primIndex);\r\n        if (doc.cm) {\r\n            regChange(doc.cm, doc.first, doc.first - distance, distance);\r\n            for (var d = doc.cm.display, l = d.viewFrom; l < d.viewTo; l++)\r\n            { regLineChange(doc.cm, l, "gutter"); }\r\n        }\r\n    }\r\n\r\n    // More lower-level change function, handling only a single document\r\n    // (not linked ones).\r\n    function makeChangeSingleDoc(doc, change, selAfter, spans) {\r\n        if (doc.cm && !doc.cm.curOp)\r\n        { return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans) }\r\n\r\n        if (change.to.line < doc.first) {\r\n            shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));\r\n            return\r\n        }\r\n        if (change.from.line > doc.lastLine()) { return }\r\n\r\n        // Clip the change to the size of this doc\r\n        if (change.from.line < doc.first) {\r\n            var shift = change.text.length - 1 - (doc.first - change.from.line);\r\n            shiftDoc(doc, shift);\r\n            change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),\r\n                text: [lst(change.text)], origin: change.origin};\r\n        }\r\n        var last = doc.lastLine();\r\n        if (change.to.line > last) {\r\n            change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),\r\n                text: [change.text[0]], origin: change.origin};\r\n        }\r\n\r\n        change.removed = getBetween(doc, change.from, change.to);\r\n\r\n        if (!selAfter) { selAfter = computeSelAfterChange(doc, change); }\r\n        if (doc.cm) { makeChangeSingleDocInEditor(doc.cm, change, spans); }\r\n        else { updateDoc(doc, change, spans); }\r\n        setSelectionNoUndo(doc, selAfter, sel_dontScroll);\r\n    }\r\n\r\n    // Handle the interaction of a change to a document with the editor\r\n    // that this document is part of.\r\n    function makeChangeSingleDocInEditor(cm, change, spans) {\r\n        var doc = cm.doc, display = cm.display, from = change.from, to = change.to;\r\n\r\n        var recomputeMaxLength = false, checkWidthStart = from.line;\r\n        if (!cm.options.lineWrapping) {\r\n            checkWidthStart = lineNo(visualLine(getLine(doc, from.line)));\r\n            doc.iter(checkWidthStart, to.line + 1, function (line) {\r\n                if (line == display.maxLine) {\r\n                    recomputeMaxLength = true;\r\n                    return true\r\n                }\r\n            });\r\n        }\r\n\r\n        if (doc.sel.contains(change.from, change.to) > -1)\r\n        { signalCursorActivity(cm); }\r\n\r\n        updateDoc(doc, change, spans, estimateHeight(cm));\r\n\r\n        if (!cm.options.lineWrapping) {\r\n            doc.iter(checkWidthStart, from.line + change.text.length, function (line) {\r\n                var len = lineLength(line);\r\n                if (len > display.maxLineLength) {\r\n                    display.maxLine = line;\r\n                    display.maxLineLength = len;\r\n                    display.maxLineChanged = true;\r\n                    recomputeMaxLength = false;\r\n                }\r\n            });\r\n            if (recomputeMaxLength) { cm.curOp.updateMaxLine = true; }\r\n        }\r\n\r\n        retreatFrontier(doc, from.line);\r\n        startWorker(cm, 400);\r\n\r\n        var lendiff = change.text.length - (to.line - from.line) - 1;\r\n        // Remember that these lines changed, for updating the display\r\n        if (change.full)\r\n        { regChange(cm); }\r\n        else if (from.line == to.line && change.text.length == 1 && !isWholeLineUpdate(cm.doc, change))\r\n        { regLineChange(cm, from.line, "text"); }\r\n        else\r\n        { regChange(cm, from.line, to.line + 1, lendiff); }\r\n\r\n        var changesHandler = hasHandler(cm, "changes"), changeHandler = hasHandler(cm, "change");\r\n        if (changeHandler || changesHandler) {\r\n            var obj = {\r\n                from: from, to: to,\r\n                text: change.text,\r\n                removed: change.removed,\r\n                origin: change.origin\r\n            };\r\n            if (changeHandler) { signalLater(cm, "change", cm, obj); }\r\n            if (changesHandler) { (cm.curOp.changeObjs || (cm.curOp.changeObjs = [])).push(obj); }\r\n        }\r\n        cm.display.selForContextMenu = null;\r\n    }\r\n\r\n    function replaceRange(doc, code, from, to, origin) {\r\n        var assign;\r\n\r\n        if (!to) { to = from; }\r\n        if (cmp(to, from) < 0) { (assign = [to, from], from = assign[0], to = assign[1]); }\r\n        if (typeof code == "string") { code = doc.splitLines(code); }\r\n        makeChange(doc, {from: from, to: to, text: code, origin: origin});\r\n    }\r\n\r\n    // Rebasing/resetting history to deal with externally-sourced changes\r\n\r\n    function rebaseHistSelSingle(pos, from, to, diff) {\r\n        if (to < pos.line) {\r\n            pos.line += diff;\r\n        } else if (from < pos.line) {\r\n            pos.line = from;\r\n            pos.ch = 0;\r\n        }\r\n    }\r\n\r\n    // Tries to rebase an array of history events given a change in the\r\n    // document. If the change touches the same lines as the event, the\r\n    // event, and everything \'behind\' it, is discarded. If the change is\r\n    // before the event, the event\'s positions are updated. Uses a\r\n    // copy-on-write scheme for the positions, to avoid having to\r\n    // reallocate them all on every rebase, but also avoid problems with\r\n    // shared position objects being unsafely updated.\r\n    function rebaseHistArray(array, from, to, diff) {\r\n        for (var i = 0; i < array.length; ++i) {\r\n            var sub = array[i], ok = true;\r\n            if (sub.ranges) {\r\n                if (!sub.copied) { sub = array[i] = sub.deepCopy(); sub.copied = true; }\r\n                for (var j = 0; j < sub.ranges.length; j++) {\r\n                    rebaseHistSelSingle(sub.ranges[j].anchor, from, to, diff);\r\n                    rebaseHistSelSingle(sub.ranges[j].head, from, to, diff);\r\n                }\r\n                continue\r\n            }\r\n            for (var j$1 = 0; j$1 < sub.changes.length; ++j$1) {\r\n                var cur = sub.changes[j$1];\r\n                if (to < cur.from.line) {\r\n                    cur.from = Pos(cur.from.line + diff, cur.from.ch);\r\n                    cur.to = Pos(cur.to.line + diff, cur.to.ch);\r\n                } else if (from <= cur.to.line) {\r\n                    ok = false;\r\n                    break\r\n                }\r\n            }\r\n            if (!ok) {\r\n                array.splice(0, i + 1);\r\n                i = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    function rebaseHist(hist, change) {\r\n        var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;\r\n        rebaseHistArray(hist.done, from, to, diff);\r\n        rebaseHistArray(hist.undone, from, to, diff);\r\n    }\r\n\r\n    // Utility for applying a change to a line by handle or number,\r\n    // returning the number and optionally registering the line as\r\n    // changed.\r\n    function changeLine(doc, handle, changeType, op) {\r\n        var no = handle, line = handle;\r\n        if (typeof handle == "number") { line = getLine(doc, clipLine(doc, handle)); }\r\n        else { no = lineNo(handle); }\r\n        if (no == null) { return null }\r\n        if (op(line, no) && doc.cm) { regLineChange(doc.cm, no, changeType); }\r\n        return line\r\n    }\r\n\r\n    // The document is represented as a BTree consisting of leaves, with\r\n    // chunk of lines in them, and branches, with up to ten leaves or\r\n    // other branch nodes below them. The top node is always a branch\r\n    // node, and is the document object itself (meaning it has\r\n    // additional methods and properties).\r\n    //\r\n    // All nodes have parent links. The tree is used both to go from\r\n    // line numbers to line objects, and to go from objects to numbers.\r\n    // It also indexes by height, and is used to convert between height\r\n    // and line object, and to find the total height of the document.\r\n    //\r\n    // See also http://marijnhaverbeke.nl/blog/codemirror-line-tree.html\r\n\r\n    function LeafChunk(lines) {\r\n        this.lines = lines;\r\n        this.parent = null;\r\n        var height = 0;\r\n        for (var i = 0; i < lines.length; ++i) {\r\n            lines[i].parent = this;\r\n            height += lines[i].height;\r\n        }\r\n        this.height = height;\r\n    }\r\n\r\n    LeafChunk.prototype = {\r\n        chunkSize: function() { return this.lines.length },\r\n\r\n        // Remove the n lines at offset \'at\'.\r\n        removeInner: function(at, n) {\r\n            for (var i = at, e = at + n; i < e; ++i) {\r\n                var line = this.lines[i];\r\n                this.height -= line.height;\r\n                cleanUpLine(line);\r\n                signalLater(line, "delete");\r\n            }\r\n            this.lines.splice(at, n);\r\n        },\r\n\r\n        // Helper used to collapse a small branch into a single leaf.\r\n        collapse: function(lines) {\r\n            lines.push.apply(lines, this.lines);\r\n        },\r\n\r\n        // Insert the given array of lines at offset \'at\', count them as\r\n        // having the given height.\r\n        insertInner: function(at, lines, height) {\r\n            this.height += height;\r\n            this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));\r\n            for (var i = 0; i < lines.length; ++i) { lines[i].parent = this; }\r\n        },\r\n\r\n        // Used to iterate over a part of the tree.\r\n        iterN: function(at, n, op) {\r\n            for (var e = at + n; at < e; ++at)\r\n            { if (op(this.lines[at])) { return true } }\r\n        }\r\n    };\r\n\r\n    function BranchChunk(children) {\r\n        this.children = children;\r\n        var size = 0, height = 0;\r\n        for (var i = 0; i < children.length; ++i) {\r\n            var ch = children[i];\r\n            size += ch.chunkSize(); height += ch.height;\r\n            ch.parent = this;\r\n        }\r\n        this.size = size;\r\n        this.height = height;\r\n        this.parent = null;\r\n    }\r\n\r\n    BranchChunk.prototype = {\r\n        chunkSize: function() { return this.size },\r\n\r\n        removeInner: function(at, n) {\r\n            this.size -= n;\r\n            for (var i = 0; i < this.children.length; ++i) {\r\n                var child = this.children[i], sz = child.chunkSize();\r\n                if (at < sz) {\r\n                    var rm = Math.min(n, sz - at), oldHeight = child.height;\r\n                    child.removeInner(at, rm);\r\n                    this.height -= oldHeight - child.height;\r\n                    if (sz == rm) { this.children.splice(i--, 1); child.parent = null; }\r\n                    if ((n -= rm) == 0) { break }\r\n                    at = 0;\r\n                } else { at -= sz; }\r\n            }\r\n            // If the result is smaller than 25 lines, ensure that it is a\r\n            // single leaf node.\r\n            if (this.size - n < 25 &&\r\n                (this.children.length > 1 || !(this.children[0] instanceof LeafChunk))) {\r\n                var lines = [];\r\n                this.collapse(lines);\r\n                this.children = [new LeafChunk(lines)];\r\n                this.children[0].parent = this;\r\n            }\r\n        },\r\n\r\n        collapse: function(lines) {\r\n            for (var i = 0; i < this.children.length; ++i) { this.children[i].collapse(lines); }\r\n        },\r\n\r\n        insertInner: function(at, lines, height) {\r\n            this.size += lines.length;\r\n            this.height += height;\r\n            for (var i = 0; i < this.children.length; ++i) {\r\n                var child = this.children[i], sz = child.chunkSize();\r\n                if (at <= sz) {\r\n                    child.insertInner(at, lines, height);\r\n                    if (child.lines && child.lines.length > 50) {\r\n                        // To avoid memory thrashing when child.lines is huge (e.g. first view of a large file), it\'s never spliced.\r\n                        // Instead, small slices are taken. They\'re taken in order because sequential memory accesses are fastest.\r\n                        var remaining = child.lines.length % 25 + 25;\r\n                        for (var pos = remaining; pos < child.lines.length;) {\r\n                            var leaf = new LeafChunk(child.lines.slice(pos, pos += 25));\r\n                            child.height -= leaf.height;\r\n                            this.children.splice(++i, 0, leaf);\r\n                            leaf.parent = this;\r\n                        }\r\n                        child.lines = child.lines.slice(0, remaining);\r\n                        this.maybeSpill();\r\n                    }\r\n                    break\r\n                }\r\n                at -= sz;\r\n            }\r\n        },\r\n\r\n        // When a node has grown, check whether it should be split.\r\n        maybeSpill: function() {\r\n            if (this.children.length <= 10) { return }\r\n            var me = this;\r\n            do {\r\n                var spilled = me.children.splice(me.children.length - 5, 5);\r\n                var sibling = new BranchChunk(spilled);\r\n                if (!me.parent) { // Become the parent node\r\n                    var copy = new BranchChunk(me.children);\r\n                    copy.parent = me;\r\n                    me.children = [copy, sibling];\r\n                    me = copy;\r\n                } else {\r\n                    me.size -= sibling.size;\r\n                    me.height -= sibling.height;\r\n                    var myIndex = indexOf(me.parent.children, me);\r\n                    me.parent.children.splice(myIndex + 1, 0, sibling);\r\n                }\r\n                sibling.parent = me.parent;\r\n            } while (me.children.length > 10)\r\n            me.parent.maybeSpill();\r\n        },\r\n\r\n        iterN: function(at, n, op) {\r\n            for (var i = 0; i < this.children.length; ++i) {\r\n                var child = this.children[i], sz = child.chunkSize();\r\n                if (at < sz) {\r\n                    var used = Math.min(n, sz - at);\r\n                    if (child.iterN(at, used, op)) { return true }\r\n                    if ((n -= used) == 0) { break }\r\n                    at = 0;\r\n                } else { at -= sz; }\r\n            }\r\n        }\r\n    };\r\n\r\n    // Line widgets are block elements displayed above or below a line.\r\n\r\n    var LineWidget = function(doc, node, options) {\r\n        if (options) { for (var opt in options) { if (options.hasOwnProperty(opt))\r\n        { this[opt] = options[opt]; } } }\r\n        this.doc = doc;\r\n        this.node = node;\r\n    };\r\n\r\n    LineWidget.prototype.clear = function () {\r\n        var cm = this.doc.cm, ws = this.line.widgets, line = this.line, no = lineNo(line);\r\n        if (no == null || !ws) { return }\r\n        for (var i = 0; i < ws.length; ++i) { if (ws[i] == this) { ws.splice(i--, 1); } }\r\n        if (!ws.length) { line.widgets = null; }\r\n        var height = widgetHeight(this);\r\n        updateLineHeight(line, Math.max(0, line.height - height));\r\n        if (cm) {\r\n            runInOp(cm, function () {\r\n                adjustScrollWhenAboveVisible(cm, line, -height);\r\n                regLineChange(cm, no, "widget");\r\n            });\r\n            signalLater(cm, "lineWidgetCleared", cm, this, no);\r\n        }\r\n    };\r\n\r\n    LineWidget.prototype.changed = function () {\r\n        var this$1 = this;\r\n\r\n        var oldH = this.height, cm = this.doc.cm, line = this.line;\r\n        this.height = null;\r\n        var diff = widgetHeight(this) - oldH;\r\n        if (!diff) { return }\r\n        if (!lineIsHidden(this.doc, line)) { updateLineHeight(line, line.height + diff); }\r\n        if (cm) {\r\n            runInOp(cm, function () {\r\n                cm.curOp.forceUpdate = true;\r\n                adjustScrollWhenAboveVisible(cm, line, diff);\r\n                signalLater(cm, "lineWidgetChanged", cm, this$1, lineNo(line));\r\n            });\r\n        }\r\n    };\r\n    eventMixin(LineWidget);\r\n\r\n    function adjustScrollWhenAboveVisible(cm, line, diff) {\r\n        if (heightAtLine(line) < ((cm.curOp && cm.curOp.scrollTop) || cm.doc.scrollTop))\r\n        { addToScrollTop(cm, diff); }\r\n    }\r\n\r\n    function addLineWidget(doc, handle, node, options) {\r\n        var widget = new LineWidget(doc, node, options);\r\n        var cm = doc.cm;\r\n        if (cm && widget.noHScroll) { cm.display.alignWidgets = true; }\r\n        changeLine(doc, handle, "widget", function (line) {\r\n            var widgets = line.widgets || (line.widgets = []);\r\n            if (widget.insertAt == null) { widgets.push(widget); }\r\n            else { widgets.splice(Math.min(widgets.length - 1, Math.max(0, widget.insertAt)), 0, widget); }\r\n            widget.line = line;\r\n            if (cm && !lineIsHidden(doc, line)) {\r\n                var aboveVisible = heightAtLine(line) < doc.scrollTop;\r\n                updateLineHeight(line, line.height + widgetHeight(widget));\r\n                if (aboveVisible) { addToScrollTop(cm, widget.height); }\r\n                cm.curOp.forceUpdate = true;\r\n            }\r\n            return true\r\n        });\r\n        if (cm) { signalLater(cm, "lineWidgetAdded", cm, widget, typeof handle == "number" ? handle : lineNo(handle)); }\r\n        return widget\r\n    }\r\n\r\n    // TEXTMARKERS\r\n\r\n    // Created with markText and setBookmark methods. A TextMarker is a\r\n    // handle that can be used to clear or find a marked position in the\r\n    // document. Line objects hold arrays (markedSpans) containing\r\n    // {from, to, marker} object pointing to such marker objects, and\r\n    // indicating that such a marker is present on that line. Multiple\r\n    // lines may point to the same marker when it spans across lines.\r\n    // The spans will have null for their from/to properties when the\r\n    // marker continues beyond the start/end of the line. Markers have\r\n    // links back to the lines they currently touch.\r\n\r\n    // Collapsed markers have unique ids, in order to be able to order\r\n    // them, which is needed for uniquely determining an outer marker\r\n    // when they overlap (they may nest, but not partially overlap).\r\n    var nextMarkerId = 0;\r\n\r\n    var TextMarker = function(doc, type) {\r\n        this.lines = [];\r\n        this.type = type;\r\n        this.doc = doc;\r\n        this.id = ++nextMarkerId;\r\n    };\r\n\r\n    // Clear the marker.\r\n    TextMarker.prototype.clear = function () {\r\n        if (this.explicitlyCleared) { return }\r\n        var cm = this.doc.cm, withOp = cm && !cm.curOp;\r\n        if (withOp) { startOperation(cm); }\r\n        if (hasHandler(this, "clear")) {\r\n            var found = this.find();\r\n            if (found) { signalLater(this, "clear", found.from, found.to); }\r\n        }\r\n        var min = null, max = null;\r\n        for (var i = 0; i < this.lines.length; ++i) {\r\n            var line = this.lines[i];\r\n            var span = getMarkedSpanFor(line.markedSpans, this);\r\n            if (cm && !this.collapsed) { regLineChange(cm, lineNo(line), "text"); }\r\n            else if (cm) {\r\n                if (span.to != null) { max = lineNo(line); }\r\n                if (span.from != null) { min = lineNo(line); }\r\n            }\r\n            line.markedSpans = removeMarkedSpan(line.markedSpans, span);\r\n            if (span.from == null && this.collapsed && !lineIsHidden(this.doc, line) && cm)\r\n            { updateLineHeight(line, textHeight(cm.display)); }\r\n        }\r\n        if (cm && this.collapsed && !cm.options.lineWrapping) { for (var i$1 = 0; i$1 < this.lines.length; ++i$1) {\r\n            var visual = visualLine(this.lines[i$1]), len = lineLength(visual);\r\n            if (len > cm.display.maxLineLength) {\r\n                cm.display.maxLine = visual;\r\n                cm.display.maxLineLength = len;\r\n                cm.display.maxLineChanged = true;\r\n            }\r\n        } }\r\n\r\n        if (min != null && cm && this.collapsed) { regChange(cm, min, max + 1); }\r\n        this.lines.length = 0;\r\n        this.explicitlyCleared = true;\r\n        if (this.atomic && this.doc.cantEdit) {\r\n            this.doc.cantEdit = false;\r\n            if (cm) { reCheckSelection(cm.doc); }\r\n        }\r\n        if (cm) { signalLater(cm, "markerCleared", cm, this, min, max); }\r\n        if (withOp) { endOperation(cm); }\r\n        if (this.parent) { this.parent.clear(); }\r\n    };\r\n\r\n    // Find the position of the marker in the document. Returns a {from,\r\n    // to} object by default. Side can be passed to get a specific side\r\n    // -- 0 (both), -1 (left), or 1 (right). When lineObj is true, the\r\n    // Pos objects returned contain a line object, rather than a line\r\n    // number (used to prevent looking up the same line twice).\r\n    TextMarker.prototype.find = function (side, lineObj) {\r\n        if (side == null && this.type == "bookmark") { side = 1; }\r\n        var from, to;\r\n        for (var i = 0; i < this.lines.length; ++i) {\r\n            var line = this.lines[i];\r\n            var span = getMarkedSpanFor(line.markedSpans, this);\r\n            if (span.from != null) {\r\n                from = Pos(lineObj ? line : lineNo(line), span.from);\r\n                if (side == -1) { return from }\r\n            }\r\n            if (span.to != null) {\r\n                to = Pos(lineObj ? line : lineNo(line), span.to);\r\n                if (side == 1) { return to }\r\n            }\r\n        }\r\n        return from && {from: from, to: to}\r\n    };\r\n\r\n    // Signals that the marker\'s widget changed, and surrounding layout\r\n    // should be recomputed.\r\n    TextMarker.prototype.changed = function () {\r\n        var this$1 = this;\r\n\r\n        var pos = this.find(-1, true), widget = this, cm = this.doc.cm;\r\n        if (!pos || !cm) { return }\r\n        runInOp(cm, function () {\r\n            var line = pos.line, lineN = lineNo(pos.line);\r\n            var view = findViewForLine(cm, lineN);\r\n            if (view) {\r\n                clearLineMeasurementCacheFor(view);\r\n                cm.curOp.selectionChanged = cm.curOp.forceUpdate = true;\r\n            }\r\n            cm.curOp.updateMaxLine = true;\r\n            if (!lineIsHidden(widget.doc, line) && widget.height != null) {\r\n                var oldHeight = widget.height;\r\n                widget.height = null;\r\n                var dHeight = widgetHeight(widget) - oldHeight;\r\n                if (dHeight)\r\n                { updateLineHeight(line, line.height + dHeight); }\r\n            }\r\n            signalLater(cm, "markerChanged", cm, this$1);\r\n        });\r\n    };\r\n\r\n    TextMarker.prototype.attachLine = function (line) {\r\n        if (!this.lines.length && this.doc.cm) {\r\n            var op = this.doc.cm.curOp;\r\n            if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)\r\n            { (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this); }\r\n        }\r\n        this.lines.push(line);\r\n    };\r\n\r\n    TextMarker.prototype.detachLine = function (line) {\r\n        this.lines.splice(indexOf(this.lines, line), 1);\r\n        if (!this.lines.length && this.doc.cm) {\r\n            var op = this.doc.cm.curOp\r\n            ;(op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);\r\n        }\r\n    };\r\n    eventMixin(TextMarker);\r\n\r\n    // Create a marker, wire it up to the right lines, and\r\n    function markText(doc, from, to, options, type) {\r\n        // Shared markers (across linked documents) are handled separately\r\n        // (markTextShared will call out to this again, once per\r\n        // document).\r\n        if (options && options.shared) { return markTextShared(doc, from, to, options, type) }\r\n        // Ensure we are in an operation.\r\n        if (doc.cm && !doc.cm.curOp) { return operation(doc.cm, markText)(doc, from, to, options, type) }\r\n\r\n        var marker = new TextMarker(doc, type), diff = cmp(from, to);\r\n        if (options) { copyObj(options, marker, false); }\r\n        // Don\'t connect empty markers unless clearWhenEmpty is false\r\n        if (diff > 0 || diff == 0 && marker.clearWhenEmpty !== false)\r\n        { return marker }\r\n        if (marker.replacedWith) {\r\n            // Showing up as a widget implies collapsed (widget replaces text)\r\n            marker.collapsed = true;\r\n            marker.widgetNode = eltP("span", [marker.replacedWith], "CodeMirror-widget");\r\n            if (!options.handleMouseEvents) { marker.widgetNode.setAttribute("cm-ignore-events", "true"); }\r\n            if (options.insertLeft) { marker.widgetNode.insertLeft = true; }\r\n        }\r\n        if (marker.collapsed) {\r\n            if (conflictingCollapsedRange(doc, from.line, from, to, marker) ||\r\n                from.line != to.line && conflictingCollapsedRange(doc, to.line, from, to, marker))\r\n            { throw new Error("Inserting collapsed marker partially overlapping an existing one") }\r\n            seeCollapsedSpans();\r\n        }\r\n\r\n        if (marker.addToHistory)\r\n        { addChangeToHistory(doc, {from: from, to: to, origin: "markText"}, doc.sel, NaN); }\r\n\r\n        var curLine = from.line, cm = doc.cm, updateMaxLine;\r\n        doc.iter(curLine, to.line + 1, function (line) {\r\n            if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(line) == cm.display.maxLine)\r\n            { updateMaxLine = true; }\r\n            if (marker.collapsed && curLine != from.line) { updateLineHeight(line, 0); }\r\n            addMarkedSpan(line, new MarkedSpan(marker,\r\n                curLine == from.line ? from.ch : null,\r\n                curLine == to.line ? to.ch : null));\r\n            ++curLine;\r\n        });\r\n        // lineIsHidden depends on the presence of the spans, so needs a second pass\r\n        if (marker.collapsed) { doc.iter(from.line, to.line + 1, function (line) {\r\n            if (lineIsHidden(doc, line)) { updateLineHeight(line, 0); }\r\n        }); }\r\n\r\n        if (marker.clearOnEnter) { on(marker, "beforeCursorEnter", function () { return marker.clear(); }); }\r\n\r\n        if (marker.readOnly) {\r\n            seeReadOnlySpans();\r\n            if (doc.history.done.length || doc.history.undone.length)\r\n            { doc.clearHistory(); }\r\n        }\r\n        if (marker.collapsed) {\r\n            marker.id = ++nextMarkerId;\r\n            marker.atomic = true;\r\n        }\r\n        if (cm) {\r\n            // Sync editor state\r\n            if (updateMaxLine) { cm.curOp.updateMaxLine = true; }\r\n            if (marker.collapsed)\r\n            { regChange(cm, from.line, to.line + 1); }\r\n            else if (marker.className || marker.startStyle || marker.endStyle || marker.css ||\r\n                marker.attributes || marker.title)\r\n            { for (var i = from.line; i <= to.line; i++) { regLineChange(cm, i, "text"); } }\r\n            if (marker.atomic) { reCheckSelection(cm.doc); }\r\n            signalLater(cm, "markerAdded", cm, marker);\r\n        }\r\n        return marker\r\n    }\r\n\r\n    // SHARED TEXTMARKERS\r\n\r\n    // A shared marker spans multiple linked documents. It is\r\n    // implemented as a meta-marker-object controlling multiple normal\r\n    // markers.\r\n    var SharedTextMarker = function(markers, primary) {\r\n        this.markers = markers;\r\n        this.primary = primary;\r\n        for (var i = 0; i < markers.length; ++i)\r\n        { markers[i].parent = this; }\r\n    };\r\n\r\n    SharedTextMarker.prototype.clear = function () {\r\n        if (this.explicitlyCleared) { return }\r\n        this.explicitlyCleared = true;\r\n        for (var i = 0; i < this.markers.length; ++i)\r\n        { this.markers[i].clear(); }\r\n        signalLater(this, "clear");\r\n    };\r\n\r\n    SharedTextMarker.prototype.find = function (side, lineObj) {\r\n        return this.primary.find(side, lineObj)\r\n    };\r\n    eventMixin(SharedTextMarker);\r\n\r\n    function markTextShared(doc, from, to, options, type) {\r\n        options = copyObj(options);\r\n        options.shared = false;\r\n        var markers = [markText(doc, from, to, options, type)], primary = markers[0];\r\n        var widget = options.widgetNode;\r\n        linkedDocs(doc, function (doc) {\r\n            if (widget) { options.widgetNode = widget.cloneNode(true); }\r\n            markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));\r\n            for (var i = 0; i < doc.linked.length; ++i)\r\n            { if (doc.linked[i].isParent) { return } }\r\n            primary = lst(markers);\r\n        });\r\n        return new SharedTextMarker(markers, primary)\r\n    }\r\n\r\n    function findSharedMarkers(doc) {\r\n        return doc.findMarks(Pos(doc.first, 0), doc.clipPos(Pos(doc.lastLine())), function (m) { return m.parent; })\r\n    }\r\n\r\n    function copySharedMarkers(doc, markers) {\r\n        for (var i = 0; i < markers.length; i++) {\r\n            var marker = markers[i], pos = marker.find();\r\n            var mFrom = doc.clipPos(pos.from), mTo = doc.clipPos(pos.to);\r\n            if (cmp(mFrom, mTo)) {\r\n                var subMark = markText(doc, mFrom, mTo, marker.primary, marker.primary.type);\r\n                marker.markers.push(subMark);\r\n                subMark.parent = marker;\r\n            }\r\n        }\r\n    }\r\n\r\n    function detachSharedMarkers(markers) {\r\n        var loop = function ( i ) {\r\n            var marker = markers[i], linked = [marker.primary.doc];\r\n            linkedDocs(marker.primary.doc, function (d) { return linked.push(d); });\r\n            for (var j = 0; j < marker.markers.length; j++) {\r\n                var subMarker = marker.markers[j];\r\n                if (indexOf(linked, subMarker.doc) == -1) {\r\n                    subMarker.parent = null;\r\n                    marker.markers.splice(j--, 1);\r\n                }\r\n            }\r\n        };\r\n\r\n        for (var i = 0; i < markers.length; i++) loop( i );\r\n    }\r\n\r\n    var nextDocId = 0;\r\n    var Doc = function(text, mode, firstLine, lineSep, direction) {\r\n        if (!(this instanceof Doc)) { return new Doc(text, mode, firstLine, lineSep, direction) }\r\n        if (firstLine == null) { firstLine = 0; }\r\n\r\n        BranchChunk.call(this, [new LeafChunk([new Line("", null)])]);\r\n        this.first = firstLine;\r\n        this.scrollTop = this.scrollLeft = 0;\r\n        this.cantEdit = false;\r\n        this.cleanGeneration = 1;\r\n        this.modeFrontier = this.highlightFrontier = firstLine;\r\n        var start = Pos(firstLine, 0);\r\n        this.sel = simpleSelection(start);\r\n        this.history = new History(null);\r\n        this.id = ++nextDocId;\r\n        this.modeOption = mode;\r\n        this.lineSep = lineSep;\r\n        this.direction = (direction == "rtl") ? "rtl" : "ltr";\r\n        this.extend = false;\r\n\r\n        if (typeof text == "string") { text = this.splitLines(text); }\r\n        updateDoc(this, {from: start, to: start, text: text});\r\n        setSelection(this, simpleSelection(start), sel_dontScroll);\r\n    };\r\n\r\n    Doc.prototype = createObj(BranchChunk.prototype, {\r\n        constructor: Doc,\r\n        // Iterate over the document. Supports two forms -- with only one\r\n        // argument, it calls that for each line in the document. With\r\n        // three, it iterates over the range given by the first two (with\r\n        // the second being non-inclusive).\r\n        iter: function(from, to, op) {\r\n            if (op) { this.iterN(from - this.first, to - from, op); }\r\n            else { this.iterN(this.first, this.first + this.size, from); }\r\n        },\r\n\r\n        // Non-public interface for adding and removing lines.\r\n        insert: function(at, lines) {\r\n            var height = 0;\r\n            for (var i = 0; i < lines.length; ++i) { height += lines[i].height; }\r\n            this.insertInner(at - this.first, lines, height);\r\n        },\r\n        remove: function(at, n) { this.removeInner(at - this.first, n); },\r\n\r\n        // From here, the methods are part of the public interface. Most\r\n        // are also available from CodeMirror (editor) instances.\r\n\r\n        getValue: function(lineSep, lineFilter) {\r\n            var lines = getLines(this, this.first, this.first + this.size, lineFilter);\r\n            if (lineSep === false) { return lines }\r\n            return lines.join(lineSep || this.lineSeparator())\r\n        },\r\n        setValue: docMethodOp(function(code) {\r\n            var top = Pos(this.first, 0), last = this.first + this.size - 1;\r\n            makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),\r\n                text: this.splitLines(code), origin: "setValue", full: true}, true);\r\n            if (this.cm) { scrollToCoords(this.cm, 0, 0); }\r\n            setSelection(this, simpleSelection(top), sel_dontScroll);\r\n        }),\r\n        replaceRange: function(code, from, to, origin) {\r\n            from = clipPos(this, from);\r\n            to = to ? clipPos(this, to) : from;\r\n            replaceRange(this, code, from, to, origin);\r\n        },\r\n        getRange: function(from, to, lineSep) {\r\n            var lines = getBetween(this, clipPos(this, from), clipPos(this, to));\r\n            if (lineSep === false) { return lines }\r\n            return lines.join(lineSep || this.lineSeparator())\r\n        },\r\n\r\n        getLine: function(line) {var l = this.getLineHandle(line); return l && l.text},\r\n\r\n        getLineHandle: function(line) {if (isLine(this, line)) { return getLine(this, line) }},\r\n        getLineNumber: function(line) {return lineNo(line)},\r\n\r\n        getLineHandleVisualStart: function(line) {\r\n            if (typeof line == "number") { line = getLine(this, line); }\r\n            return visualLine(line)\r\n        },\r\n\r\n        lineCount: function() {return this.size},\r\n        firstLine: function() {return this.first},\r\n        lastLine: function() {return this.first + this.size - 1},\r\n\r\n        clipPos: function(pos) {return clipPos(this, pos)},\r\n\r\n        getCursor: function(start) {\r\n            var range$$1 = this.sel.primary(), pos;\r\n            if (start == null || start == "head") { pos = range$$1.head; }\r\n            else if (start == "anchor") { pos = range$$1.anchor; }\r\n            else if (start == "end" || start == "to" || start === false) { pos = range$$1.to(); }\r\n            else { pos = range$$1.from(); }\r\n            return pos\r\n        },\r\n        listSelections: function() { return this.sel.ranges },\r\n        somethingSelected: function() {return this.sel.somethingSelected()},\r\n\r\n        setCursor: docMethodOp(function(line, ch, options) {\r\n            setSimpleSelection(this, clipPos(this, typeof line == "number" ? Pos(line, ch || 0) : line), null, options);\r\n        }),\r\n        setSelection: docMethodOp(function(anchor, head, options) {\r\n            setSimpleSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), options);\r\n        }),\r\n        extendSelection: docMethodOp(function(head, other, options) {\r\n            extendSelection(this, clipPos(this, head), other && clipPos(this, other), options);\r\n        }),\r\n        extendSelections: docMethodOp(function(heads, options) {\r\n            extendSelections(this, clipPosArray(this, heads), options);\r\n        }),\r\n        extendSelectionsBy: docMethodOp(function(f, options) {\r\n            var heads = map(this.sel.ranges, f);\r\n            extendSelections(this, clipPosArray(this, heads), options);\r\n        }),\r\n        setSelections: docMethodOp(function(ranges, primary, options) {\r\n            if (!ranges.length) { return }\r\n            var out = [];\r\n            for (var i = 0; i < ranges.length; i++)\r\n            { out[i] = new Range(clipPos(this, ranges[i].anchor),\r\n                clipPos(this, ranges[i].head)); }\r\n            if (primary == null) { primary = Math.min(ranges.length - 1, this.sel.primIndex); }\r\n            setSelection(this, normalizeSelection(this.cm, out, primary), options);\r\n        }),\r\n        addSelection: docMethodOp(function(anchor, head, options) {\r\n            var ranges = this.sel.ranges.slice(0);\r\n            ranges.push(new Range(clipPos(this, anchor), clipPos(this, head || anchor)));\r\n            setSelection(this, normalizeSelection(this.cm, ranges, ranges.length - 1), options);\r\n        }),\r\n\r\n        getSelection: function(lineSep) {\r\n            var ranges = this.sel.ranges, lines;\r\n            for (var i = 0; i < ranges.length; i++) {\r\n                var sel = getBetween(this, ranges[i].from(), ranges[i].to());\r\n                lines = lines ? lines.concat(sel) : sel;\r\n            }\r\n            if (lineSep === false) { return lines }\r\n            else { return lines.join(lineSep || this.lineSeparator()) }\r\n        },\r\n        getSelections: function(lineSep) {\r\n            var parts = [], ranges = this.sel.ranges;\r\n            for (var i = 0; i < ranges.length; i++) {\r\n                var sel = getBetween(this, ranges[i].from(), ranges[i].to());\r\n                if (lineSep !== false) { sel = sel.join(lineSep || this.lineSeparator()); }\r\n                parts[i] = sel;\r\n            }\r\n            return parts\r\n        },\r\n        replaceSelection: function(code, collapse, origin) {\r\n            var dup = [];\r\n            for (var i = 0; i < this.sel.ranges.length; i++)\r\n            { dup[i] = code; }\r\n            this.replaceSelections(dup, collapse, origin || "+input");\r\n        },\r\n        replaceSelections: docMethodOp(function(code, collapse, origin) {\r\n            var changes = [], sel = this.sel;\r\n            for (var i = 0; i < sel.ranges.length; i++) {\r\n                var range$$1 = sel.ranges[i];\r\n                changes[i] = {from: range$$1.from(), to: range$$1.to(), text: this.splitLines(code[i]), origin: origin};\r\n            }\r\n            var newSel = collapse && collapse != "end" && computeReplacedSel(this, changes, collapse);\r\n            for (var i$1 = changes.length - 1; i$1 >= 0; i$1--)\r\n            { makeChange(this, changes[i$1]); }\r\n            if (newSel) { setSelectionReplaceHistory(this, newSel); }\r\n            else if (this.cm) { ensureCursorVisible(this.cm); }\r\n        }),\r\n        undo: docMethodOp(function() {makeChangeFromHistory(this, "undo");}),\r\n        redo: docMethodOp(function() {makeChangeFromHistory(this, "redo");}),\r\n        undoSelection: docMethodOp(function() {makeChangeFromHistory(this, "undo", true);}),\r\n        redoSelection: docMethodOp(function() {makeChangeFromHistory(this, "redo", true);}),\r\n\r\n        setExtending: function(val) {this.extend = val;},\r\n        getExtending: function() {return this.extend},\r\n\r\n        historySize: function() {\r\n            var hist = this.history, done = 0, undone = 0;\r\n            for (var i = 0; i < hist.done.length; i++) { if (!hist.done[i].ranges) { ++done; } }\r\n            for (var i$1 = 0; i$1 < hist.undone.length; i$1++) { if (!hist.undone[i$1].ranges) { ++undone; } }\r\n            return {undo: done, redo: undone}\r\n        },\r\n        clearHistory: function() {this.history = new History(this.history.maxGeneration);},\r\n\r\n        markClean: function() {\r\n            this.cleanGeneration = this.changeGeneration(true);\r\n        },\r\n        changeGeneration: function(forceSplit) {\r\n            if (forceSplit)\r\n            { this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null; }\r\n            return this.history.generation\r\n        },\r\n        isClean: function (gen) {\r\n            return this.history.generation == (gen || this.cleanGeneration)\r\n        },\r\n\r\n        getHistory: function() {\r\n            return {done: copyHistoryArray(this.history.done),\r\n                undone: copyHistoryArray(this.history.undone)}\r\n        },\r\n        setHistory: function(histData) {\r\n            var hist = this.history = new History(this.history.maxGeneration);\r\n            hist.done = copyHistoryArray(histData.done.slice(0), null, true);\r\n            hist.undone = copyHistoryArray(histData.undone.slice(0), null, true);\r\n        },\r\n\r\n        setGutterMarker: docMethodOp(function(line, gutterID, value) {\r\n            return changeLine(this, line, "gutter", function (line) {\r\n                var markers = line.gutterMarkers || (line.gutterMarkers = {});\r\n                markers[gutterID] = value;\r\n                if (!value && isEmpty(markers)) { line.gutterMarkers = null; }\r\n                return true\r\n            })\r\n        }),\r\n\r\n        clearGutter: docMethodOp(function(gutterID) {\r\n            var this$1 = this;\r\n\r\n            this.iter(function (line) {\r\n                if (line.gutterMarkers && line.gutterMarkers[gutterID]) {\r\n                    changeLine(this$1, line, "gutter", function () {\r\n                        line.gutterMarkers[gutterID] = null;\r\n                        if (isEmpty(line.gutterMarkers)) { line.gutterMarkers = null; }\r\n                        return true\r\n                    });\r\n                }\r\n            });\r\n        }),\r\n\r\n        lineInfo: function(line) {\r\n            var n;\r\n            if (typeof line == "number") {\r\n                if (!isLine(this, line)) { return null }\r\n                n = line;\r\n                line = getLine(this, line);\r\n                if (!line) { return null }\r\n            } else {\r\n                n = lineNo(line);\r\n                if (n == null) { return null }\r\n            }\r\n            return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,\r\n                textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,\r\n                widgets: line.widgets}\r\n        },\r\n\r\n        addLineClass: docMethodOp(function(handle, where, cls) {\r\n            return changeLine(this, handle, where == "gutter" ? "gutter" : "class", function (line) {\r\n                var prop = where == "text" ? "textClass"\r\n                    : where == "background" ? "bgClass"\r\n                        : where == "gutter" ? "gutterClass" : "wrapClass";\r\n                if (!line[prop]) { line[prop] = cls; }\r\n                else if (classTest(cls).test(line[prop])) { return false }\r\n                else { line[prop] += " " + cls; }\r\n                return true\r\n            })\r\n        }),\r\n        removeLineClass: docMethodOp(function(handle, where, cls) {\r\n            return changeLine(this, handle, where == "gutter" ? "gutter" : "class", function (line) {\r\n                var prop = where == "text" ? "textClass"\r\n                    : where == "background" ? "bgClass"\r\n                        : where == "gutter" ? "gutterClass" : "wrapClass";\r\n                var cur = line[prop];\r\n                if (!cur) { return false }\r\n                else if (cls == null) { line[prop] = null; }\r\n                else {\r\n                    var found = cur.match(classTest(cls));\r\n                    if (!found) { return false }\r\n                    var end = found.index + found[0].length;\r\n                    line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? "" : " ") + cur.slice(end) || null;\r\n                }\r\n                return true\r\n            })\r\n        }),\r\n\r\n        addLineWidget: docMethodOp(function(handle, node, options) {\r\n            return addLineWidget(this, handle, node, options)\r\n        }),\r\n        removeLineWidget: function(widget) { widget.clear(); },\r\n\r\n        markText: function(from, to, options) {\r\n            return markText(this, clipPos(this, from), clipPos(this, to), options, options && options.type || "range")\r\n        },\r\n        setBookmark: function(pos, options) {\r\n            var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),\r\n                insertLeft: options && options.insertLeft,\r\n                clearWhenEmpty: false, shared: options && options.shared,\r\n                handleMouseEvents: options && options.handleMouseEvents};\r\n            pos = clipPos(this, pos);\r\n            return markText(this, pos, pos, realOpts, "bookmark")\r\n        },\r\n        findMarksAt: function(pos) {\r\n            pos = clipPos(this, pos);\r\n            var markers = [], spans = getLine(this, pos.line).markedSpans;\r\n            if (spans) { for (var i = 0; i < spans.length; ++i) {\r\n                var span = spans[i];\r\n                if ((span.from == null || span.from <= pos.ch) &&\r\n                    (span.to == null || span.to >= pos.ch))\r\n                { markers.push(span.marker.parent || span.marker); }\r\n            } }\r\n            return markers\r\n        },\r\n        findMarks: function(from, to, filter) {\r\n            from = clipPos(this, from); to = clipPos(this, to);\r\n            var found = [], lineNo$$1 = from.line;\r\n            this.iter(from.line, to.line + 1, function (line) {\r\n                var spans = line.markedSpans;\r\n                if (spans) { for (var i = 0; i < spans.length; i++) {\r\n                    var span = spans[i];\r\n                    if (!(span.to != null && lineNo$$1 == from.line && from.ch >= span.to ||\r\n                        span.from == null && lineNo$$1 != from.line ||\r\n                        span.from != null && lineNo$$1 == to.line && span.from >= to.ch) &&\r\n                        (!filter || filter(span.marker)))\r\n                    { found.push(span.marker.parent || span.marker); }\r\n                } }\r\n                ++lineNo$$1;\r\n            });\r\n            return found\r\n        },\r\n        getAllMarks: function() {\r\n            var markers = [];\r\n            this.iter(function (line) {\r\n                var sps = line.markedSpans;\r\n                if (sps) { for (var i = 0; i < sps.length; ++i)\r\n                { if (sps[i].from != null) { markers.push(sps[i].marker); } } }\r\n            });\r\n            return markers\r\n        },\r\n\r\n        posFromIndex: function(off) {\r\n            var ch, lineNo$$1 = this.first, sepSize = this.lineSeparator().length;\r\n            this.iter(function (line) {\r\n                var sz = line.text.length + sepSize;\r\n                if (sz > off) { ch = off; return true }\r\n                off -= sz;\r\n                ++lineNo$$1;\r\n            });\r\n            return clipPos(this, Pos(lineNo$$1, ch))\r\n        },\r\n        indexFromPos: function (coords) {\r\n            coords = clipPos(this, coords);\r\n            var index = coords.ch;\r\n            if (coords.line < this.first || coords.ch < 0) { return 0 }\r\n            var sepSize = this.lineSeparator().length;\r\n            this.iter(this.first, coords.line, function (line) { // iter aborts when callback returns a truthy value\r\n                index += line.text.length + sepSize;\r\n            });\r\n            return index\r\n        },\r\n\r\n        copy: function(copyHistory) {\r\n            var doc = new Doc(getLines(this, this.first, this.first + this.size),\r\n                this.modeOption, this.first, this.lineSep, this.direction);\r\n            doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;\r\n            doc.sel = this.sel;\r\n            doc.extend = false;\r\n            if (copyHistory) {\r\n                doc.history.undoDepth = this.history.undoDepth;\r\n                doc.setHistory(this.getHistory());\r\n            }\r\n            return doc\r\n        },\r\n\r\n        linkedDoc: function(options) {\r\n            if (!options) { options = {}; }\r\n            var from = this.first, to = this.first + this.size;\r\n            if (options.from != null && options.from > from) { from = options.from; }\r\n            if (options.to != null && options.to < to) { to = options.to; }\r\n            var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from, this.lineSep, this.direction);\r\n            if (options.sharedHist) { copy.history = this.history\r\n            ; }(this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});\r\n            copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];\r\n            copySharedMarkers(copy, findSharedMarkers(this));\r\n            return copy\r\n        },\r\n        unlinkDoc: function(other) {\r\n            if (other instanceof CodeMirror) { other = other.doc; }\r\n            if (this.linked) { for (var i = 0; i < this.linked.length; ++i) {\r\n                var link = this.linked[i];\r\n                if (link.doc != other) { continue }\r\n                this.linked.splice(i, 1);\r\n                other.unlinkDoc(this);\r\n                detachSharedMarkers(findSharedMarkers(this));\r\n                break\r\n            } }\r\n            // If the histories were shared, split them again\r\n            if (other.history == this.history) {\r\n                var splitIds = [other.id];\r\n                linkedDocs(other, function (doc) { return splitIds.push(doc.id); }, true);\r\n                other.history = new History(null);\r\n                other.history.done = copyHistoryArray(this.history.done, splitIds);\r\n                other.history.undone = copyHistoryArray(this.history.undone, splitIds);\r\n            }\r\n        },\r\n        iterLinkedDocs: function(f) {linkedDocs(this, f);},\r\n\r\n        getMode: function() {return this.mode},\r\n        getEditor: function() {return this.cm},\r\n\r\n        splitLines: function(str) {\r\n            if (this.lineSep) { return str.split(this.lineSep) }\r\n            return splitLinesAuto(str)\r\n        },\r\n        lineSeparator: function() { return this.lineSep || "\\n" },\r\n\r\n        setDirection: docMethodOp(function (dir) {\r\n            if (dir != "rtl") { dir = "ltr"; }\r\n            if (dir == this.direction) { return }\r\n            this.direction = dir;\r\n            this.iter(function (line) { return line.order = null; });\r\n            if (this.cm) { directionChanged(this.cm); }\r\n        })\r\n    });\r\n\r\n    // Public alias.\r\n    Doc.prototype.eachLine = Doc.prototype.iter;\r\n\r\n    // Kludge to work around strange IE behavior where it\'ll sometimes\r\n    // re-fire a series of drag-related events right after the drop (#1551)\r\n    var lastDrop = 0;\r\n\r\n    function onDrop(e) {\r\n        var cm = this;\r\n        clearDragCursor(cm);\r\n        if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e))\r\n        { return }\r\n        e_preventDefault(e);\r\n        if (ie) { lastDrop = +new Date; }\r\n        var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;\r\n        if (!pos || cm.isReadOnly()) { return }\r\n        // Might be a file drop, in which case we simply extract the text\r\n        // and insert it.\r\n        if (files && files.length && window.FileReader && window.File) {\r\n            var n = files.length, text = Array(n), read = 0;\r\n            var loadFile = function (file, i) {\r\n                if (cm.options.allowDropFileTypes &&\r\n                    indexOf(cm.options.allowDropFileTypes, file.type) == -1)\r\n                { return }\r\n\r\n                var reader = new FileReader;\r\n                reader.onload = operation(cm, function () {\r\n                    var content = reader.result;\r\n                    if (/[\\x00-\\x08\\x0e-\\x1f]{2}/.test(content)) { content = ""; }\r\n                    text[i] = content;\r\n                    if (++read == n) {\r\n                        pos = clipPos(cm.doc, pos);\r\n                        var change = {from: pos, to: pos,\r\n                            text: cm.doc.splitLines(text.join(cm.doc.lineSeparator())),\r\n                            origin: "paste"};\r\n                        makeChange(cm.doc, change);\r\n                        setSelectionReplaceHistory(cm.doc, simpleSelection(pos, changeEnd(change)));\r\n                    }\r\n                });\r\n                reader.readAsText(file);\r\n            };\r\n            for (var i = 0; i < n; ++i) { loadFile(files[i], i); }\r\n        } else { // Normal drop\r\n            // Don\'t do a replace if the drop happened inside of the selected text.\r\n            if (cm.state.draggingText && cm.doc.sel.contains(pos) > -1) {\r\n                cm.state.draggingText(e);\r\n                // Ensure the editor is re-focused\r\n                setTimeout(function () { return cm.display.input.focus(); }, 20);\r\n                return\r\n            }\r\n            try {\r\n                var text$1 = e.dataTransfer.getData("Text");\r\n                if (text$1) {\r\n                    var selected;\r\n                    if (cm.state.draggingText && !cm.state.draggingText.copy)\r\n                    { selected = cm.listSelections(); }\r\n                    setSelectionNoUndo(cm.doc, simpleSelection(pos, pos));\r\n                    if (selected) { for (var i$1 = 0; i$1 < selected.length; ++i$1)\r\n                    { replaceRange(cm.doc, "", selected[i$1].anchor, selected[i$1].head, "drag"); } }\r\n                    cm.replaceSelection(text$1, "around", "paste");\r\n                    cm.display.input.focus();\r\n                }\r\n            }\r\n            catch(e){}\r\n        }\r\n    }\r\n\r\n    function onDragStart(cm, e) {\r\n        if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return }\r\n        if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) { return }\r\n\r\n        e.dataTransfer.setData("Text", cm.getSelection());\r\n        e.dataTransfer.effectAllowed = "copyMove";\r\n\r\n        // Use dummy image instead of default browsers image.\r\n        // Recent Safari (~6.0.2) have a tendency to segfault when this happens, so we don\'t do it there.\r\n        if (e.dataTransfer.setDragImage && !safari) {\r\n            var img = elt("img", null, null, "position: fixed; left: 0; top: 0;");\r\n            img.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";\r\n            if (presto) {\r\n                img.width = img.height = 1;\r\n                cm.display.wrapper.appendChild(img);\r\n                // Force a relayout, or Opera won\'t use our image for some obscure reason\r\n                img._top = img.offsetTop;\r\n            }\r\n            e.dataTransfer.setDragImage(img, 0, 0);\r\n            if (presto) { img.parentNode.removeChild(img); }\r\n        }\r\n    }\r\n\r\n    function onDragOver(cm, e) {\r\n        var pos = posFromMouse(cm, e);\r\n        if (!pos) { return }\r\n        var frag = document.createDocumentFragment();\r\n        drawSelectionCursor(cm, pos, frag);\r\n        if (!cm.display.dragCursor) {\r\n            cm.display.dragCursor = elt("div", null, "CodeMirror-cursors CodeMirror-dragcursors");\r\n            cm.display.lineSpace.insertBefore(cm.display.dragCursor, cm.display.cursorDiv);\r\n        }\r\n        removeChildrenAndAdd(cm.display.dragCursor, frag);\r\n    }\r\n\r\n    function clearDragCursor(cm) {\r\n        if (cm.display.dragCursor) {\r\n            cm.display.lineSpace.removeChild(cm.display.dragCursor);\r\n            cm.display.dragCursor = null;\r\n        }\r\n    }\r\n\r\n    // These must be handled carefully, because naively registering a\r\n    // handler for each editor will cause the editors to never be\r\n    // garbage collected.\r\n\r\n    function forEachCodeMirror(f) {\r\n        if (!document.getElementsByClassName) { return }\r\n        var byClass = document.getElementsByClassName("CodeMirror"), editors = [];\r\n        for (var i = 0; i < byClass.length; i++) {\r\n            var cm = byClass[i].CodeMirror;\r\n            if (cm) { editors.push(cm); }\r\n        }\r\n        if (editors.length) { editors[0].operation(function () {\r\n            for (var i = 0; i < editors.length; i++) { f(editors[i]); }\r\n        }); }\r\n    }\r\n\r\n    var globalsRegistered = false;\r\n    function ensureGlobalHandlers() {\r\n        if (globalsRegistered) { return }\r\n        registerGlobalHandlers();\r\n        globalsRegistered = true;\r\n    }\r\n    function registerGlobalHandlers() {\r\n        // When the window resizes, we need to refresh active editors.\r\n        var resizeTimer;\r\n        on(window, "resize", function () {\r\n            if (resizeTimer == null) { resizeTimer = setTimeout(function () {\r\n                resizeTimer = null;\r\n                forEachCodeMirror(onResize);\r\n            }, 100); }\r\n        });\r\n        // When the window loses focus, we want to show the editor as blurred\r\n        on(window, "blur", function () { return forEachCodeMirror(onBlur); });\r\n    }\r\n    // Called when the window resizes\r\n    function onResize(cm) {\r\n        var d = cm.display;\r\n        // Might be a text scaling operation, clear size caches.\r\n        d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\r\n        d.scrollbarsClipped = false;\r\n        cm.setSize();\r\n    }\r\n\r\n    var keyNames = {\r\n        3: "Pause", 8: "Backspace", 9: "Tab", 13: "Enter", 16: "Shift", 17: "Ctrl", 18: "Alt",\r\n        19: "Pause", 20: "CapsLock", 27: "Esc", 32: "Space", 33: "PageUp", 34: "PageDown", 35: "End",\r\n        36: "Home", 37: "Left", 38: "Up", 39: "Right", 40: "Down", 44: "PrintScrn", 45: "Insert",\r\n        46: "Delete", 59: ";", 61: "=", 91: "Mod", 92: "Mod", 93: "Mod",\r\n        106: "*", 107: "=", 109: "-", 110: ".", 111: "/", 127: "Delete", 145: "ScrollLock",\r\n        173: "-", 186: ";", 187: "=", 188: ",", 189: "-", 190: ".", 191: "/", 192: "`", 219: "[", 220: "\\\\",\r\n        221: "]", 222: "\'", 63232: "Up", 63233: "Down", 63234: "Left", 63235: "Right", 63272: "Delete",\r\n        63273: "Home", 63275: "End", 63276: "PageUp", 63277: "PageDown", 63302: "Insert"\r\n    };\r\n\r\n    // Number keys\r\n    for (var i = 0; i < 10; i++) { keyNames[i + 48] = keyNames[i + 96] = String(i); }\r\n    // Alphabetic keys\r\n    for (var i$1 = 65; i$1 <= 90; i$1++) { keyNames[i$1] = String.fromCharCode(i$1); }\r\n    // Function keys\r\n    for (var i$2 = 1; i$2 <= 12; i$2++) { keyNames[i$2 + 111] = keyNames[i$2 + 63235] = "F" + i$2; }\r\n\r\n    var keyMap = {};\r\n\r\n    keyMap.basic = {\r\n        "Left": "goCharLeft", "Right": "goCharRight", "Up": "goLineUp", "Down": "goLineDown",\r\n        "End": "goLineEnd", "Home": "goLineStartSmart", "PageUp": "goPageUp", "PageDown": "goPageDown",\r\n        "Delete": "delCharAfter", "Backspace": "delCharBefore", "Shift-Backspace": "delCharBefore",\r\n        "Tab": "defaultTab", "Shift-Tab": "indentAuto",\r\n        "Enter": "newlineAndIndent", "Insert": "toggleOverwrite",\r\n        "Esc": "singleSelection"\r\n    };\r\n    // Note that the save and find-related commands aren\'t defined by\r\n    // default. User code or addons can define them. Unknown commands\r\n    // are simply ignored.\r\n    keyMap.pcDefault = {\r\n        "Ctrl-A": "selectAll", "Ctrl-D": "deleteLine", "Ctrl-Z": "undo", "Shift-Ctrl-Z": "redo", "Ctrl-Y": "redo",\r\n        "Ctrl-Home": "goDocStart", "Ctrl-End": "goDocEnd", "Ctrl-Up": "goLineUp", "Ctrl-Down": "goLineDown",\r\n        "Ctrl-Left": "goGroupLeft", "Ctrl-Right": "goGroupRight", "Alt-Left": "goLineStart", "Alt-Right": "goLineEnd",\r\n        "Ctrl-Backspace": "delGroupBefore", "Ctrl-Delete": "delGroupAfter", "Ctrl-S": "save", "Ctrl-F": "find",\r\n        "Ctrl-G": "findNext", "Shift-Ctrl-G": "findPrev", "Shift-Ctrl-F": "replace", "Shift-Ctrl-R": "replaceAll",\r\n        "Ctrl-[": "indentLess", "Ctrl-]": "indentMore",\r\n        "Ctrl-U": "undoSelection", "Shift-Ctrl-U": "redoSelection", "Alt-U": "redoSelection",\r\n        "fallthrough": "basic"\r\n    };\r\n    // Very basic readline/emacs-style bindings, which are standard on Mac.\r\n    keyMap.emacsy = {\r\n        "Ctrl-F": "goCharRight", "Ctrl-B": "goCharLeft", "Ctrl-P": "goLineUp", "Ctrl-N": "goLineDown",\r\n        "Alt-F": "goWordRight", "Alt-B": "goWordLeft", "Ctrl-A": "goLineStart", "Ctrl-E": "goLineEnd",\r\n        "Ctrl-V": "goPageDown", "Shift-Ctrl-V": "goPageUp", "Ctrl-D": "delCharAfter", "Ctrl-H": "delCharBefore",\r\n        "Alt-D": "delWordAfter", "Alt-Backspace": "delWordBefore", "Ctrl-K": "killLine", "Ctrl-T": "transposeChars",\r\n        "Ctrl-O": "openLine"\r\n    };\r\n    keyMap.macDefault = {\r\n        "Cmd-A": "selectAll", "Cmd-D": "deleteLine", "Cmd-Z": "undo", "Shift-Cmd-Z": "redo", "Cmd-Y": "redo",\r\n        "Cmd-Home": "goDocStart", "Cmd-Up": "goDocStart", "Cmd-End": "goDocEnd", "Cmd-Down": "goDocEnd", "Alt-Left": "goGroupLeft",\r\n        "Alt-Right": "goGroupRight", "Cmd-Left": "goLineLeft", "Cmd-Right": "goLineRight", "Alt-Backspace": "delGroupBefore",\r\n        "Ctrl-Alt-Backspace": "delGroupAfter", "Alt-Delete": "delGroupAfter", "Cmd-S": "save", "Cmd-F": "find",\r\n        "Cmd-G": "findNext", "Shift-Cmd-G": "findPrev", "Cmd-Alt-F": "replace", "Shift-Cmd-Alt-F": "replaceAll",\r\n        "Cmd-[": "indentLess", "Cmd-]": "indentMore", "Cmd-Backspace": "delWrappedLineLeft", "Cmd-Delete": "delWrappedLineRight",\r\n        "Cmd-U": "undoSelection", "Shift-Cmd-U": "redoSelection", "Ctrl-Up": "goDocStart", "Ctrl-Down": "goDocEnd",\r\n        "fallthrough": ["basic", "emacsy"]\r\n    };\r\n    keyMap["default"] = mac ? keyMap.macDefault : keyMap.pcDefault;\r\n\r\n    // KEYMAP DISPATCH\r\n\r\n    function normalizeKeyName(name) {\r\n        var parts = name.split(/-(?!$)/);\r\n        name = parts[parts.length - 1];\r\n        var alt, ctrl, shift, cmd;\r\n        for (var i = 0; i < parts.length - 1; i++) {\r\n            var mod = parts[i];\r\n            if (/^(cmd|meta|m)$/i.test(mod)) { cmd = true; }\r\n            else if (/^a(lt)?$/i.test(mod)) { alt = true; }\r\n            else if (/^(c|ctrl|control)$/i.test(mod)) { ctrl = true; }\r\n            else if (/^s(hift)?$/i.test(mod)) { shift = true; }\r\n            else { throw new Error("Unrecognized modifier name: " + mod) }\r\n        }\r\n        if (alt) { name = "Alt-" + name; }\r\n        if (ctrl) { name = "Ctrl-" + name; }\r\n        if (cmd) { name = "Cmd-" + name; }\r\n        if (shift) { name = "Shift-" + name; }\r\n        return name\r\n    }\r\n\r\n    // This is a kludge to keep keymaps mostly working as raw objects\r\n    // (backwards compatibility) while at the same time support features\r\n    // like normalization and multi-stroke key bindings. It compiles a\r\n    // new normalized keymap, and then updates the old object to reflect\r\n    // this.\r\n    function normalizeKeyMap(keymap) {\r\n        var copy = {};\r\n        for (var keyname in keymap) { if (keymap.hasOwnProperty(keyname)) {\r\n            var value = keymap[keyname];\r\n            if (/^(name|fallthrough|(de|at)tach)$/.test(keyname)) { continue }\r\n            if (value == "...") { delete keymap[keyname]; continue }\r\n\r\n            var keys = map(keyname.split(" "), normalizeKeyName);\r\n            for (var i = 0; i < keys.length; i++) {\r\n                var val = (void 0), name = (void 0);\r\n                if (i == keys.length - 1) {\r\n                    name = keys.join(" ");\r\n                    val = value;\r\n                } else {\r\n                    name = keys.slice(0, i + 1).join(" ");\r\n                    val = "...";\r\n                }\r\n                var prev = copy[name];\r\n                if (!prev) { copy[name] = val; }\r\n                else if (prev != val) { throw new Error("Inconsistent bindings for " + name) }\r\n            }\r\n            delete keymap[keyname];\r\n        } }\r\n        for (var prop in copy) { keymap[prop] = copy[prop]; }\r\n        return keymap\r\n    }\r\n\r\n    function lookupKey(key, map$$1, handle, context) {\r\n        map$$1 = getKeyMap(map$$1);\r\n        var found = map$$1.call ? map$$1.call(key, context) : map$$1[key];\r\n        if (found === false) { return "nothing" }\r\n        if (found === "...") { return "multi" }\r\n        if (found != null && handle(found)) { return "handled" }\r\n\r\n        if (map$$1.fallthrough) {\r\n            if (Object.prototype.toString.call(map$$1.fallthrough) != "[object Array]")\r\n            { return lookupKey(key, map$$1.fallthrough, handle, context) }\r\n            for (var i = 0; i < map$$1.fallthrough.length; i++) {\r\n                var result = lookupKey(key, map$$1.fallthrough[i], handle, context);\r\n                if (result) { return result }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Modifier key presses don\'t count as \'real\' key presses for the\r\n    // purpose of keymap fallthrough.\r\n    function isModifierKey(value) {\r\n        var name = typeof value == "string" ? value : keyNames[value.keyCode];\r\n        return name == "Ctrl" || name == "Alt" || name == "Shift" || name == "Mod"\r\n    }\r\n\r\n    function addModifierNames(name, event, noShift) {\r\n        var base = name;\r\n        if (event.altKey && base != "Alt") { name = "Alt-" + name; }\r\n        if ((flipCtrlCmd ? event.metaKey : event.ctrlKey) && base != "Ctrl") { name = "Ctrl-" + name; }\r\n        if ((flipCtrlCmd ? event.ctrlKey : event.metaKey) && base != "Cmd") { name = "Cmd-" + name; }\r\n        if (!noShift && event.shiftKey && base != "Shift") { name = "Shift-" + name; }\r\n        return name\r\n    }\r\n\r\n    // Look up the name of a key as indicated by an event object.\r\n    function keyName(event, noShift) {\r\n        if (presto && event.keyCode == 34 && event["char"]) { return false }\r\n        var name = keyNames[event.keyCode];\r\n        if (name == null || event.altGraphKey) { return false }\r\n        // Ctrl-ScrollLock has keyCode 3, same as Ctrl-Pause,\r\n        // so we\'ll use event.code when available (Chrome 48+, FF 38+, Safari 10.1+)\r\n        if (event.keyCode == 3 && event.code) { name = event.code; }\r\n        return addModifierNames(name, event, noShift)\r\n    }\r\n\r\n    function getKeyMap(val) {\r\n        return typeof val == "string" ? keyMap[val] : val\r\n    }\r\n\r\n    // Helper for deleting text near the selection(s), used to implement\r\n    // backspace, delete, and similar functionality.\r\n    function deleteNearSelection(cm, compute) {\r\n        var ranges = cm.doc.sel.ranges, kill = [];\r\n        // Build up a set of ranges to kill first, merging overlapping\r\n        // ranges.\r\n        for (var i = 0; i < ranges.length; i++) {\r\n            var toKill = compute(ranges[i]);\r\n            while (kill.length && cmp(toKill.from, lst(kill).to) <= 0) {\r\n                var replaced = kill.pop();\r\n                if (cmp(replaced.from, toKill.from) < 0) {\r\n                    toKill.from = replaced.from;\r\n                    break\r\n                }\r\n            }\r\n            kill.push(toKill);\r\n        }\r\n        // Next, remove those actual ranges.\r\n        runInOp(cm, function () {\r\n            for (var i = kill.length - 1; i >= 0; i--)\r\n            { replaceRange(cm.doc, "", kill[i].from, kill[i].to, "+delete"); }\r\n            ensureCursorVisible(cm);\r\n        });\r\n    }\r\n\r\n    function moveCharLogically(line, ch, dir) {\r\n        var target = skipExtendingChars(line.text, ch + dir, dir);\r\n        return target < 0 || target > line.text.length ? null : target\r\n    }\r\n\r\n    function moveLogically(line, start, dir) {\r\n        var ch = moveCharLogically(line, start.ch, dir);\r\n        return ch == null ? null : new Pos(start.line, ch, dir < 0 ? "after" : "before")\r\n    }\r\n\r\n    function endOfLine(visually, cm, lineObj, lineNo, dir) {\r\n        if (visually) {\r\n            var order = getOrder(lineObj, cm.doc.direction);\r\n            if (order) {\r\n                var part = dir < 0 ? lst(order) : order[0];\r\n                var moveInStorageOrder = (dir < 0) == (part.level == 1);\r\n                var sticky = moveInStorageOrder ? "after" : "before";\r\n                var ch;\r\n                // With a wrapped rtl chunk (possibly spanning multiple bidi parts),\r\n                // it could be that the last bidi part is not on the last visual line,\r\n                // since visual lines contain content order-consecutive chunks.\r\n                // Thus, in rtl, we are looking for the first (content-order) character\r\n                // in the rtl chunk that is on the last line (that is, the same line\r\n                // as the last (content-order) character).\r\n                if (part.level > 0 || cm.doc.direction == "rtl") {\r\n                    var prep = prepareMeasureForLine(cm, lineObj);\r\n                    ch = dir < 0 ? lineObj.text.length - 1 : 0;\r\n                    var targetTop = measureCharPrepared(cm, prep, ch).top;\r\n                    ch = findFirst(function (ch) { return measureCharPrepared(cm, prep, ch).top == targetTop; }, (dir < 0) == (part.level == 1) ? part.from : part.to - 1, ch);\r\n                    if (sticky == "before") { ch = moveCharLogically(lineObj, ch, 1); }\r\n                } else { ch = dir < 0 ? part.to : part.from; }\r\n                return new Pos(lineNo, ch, sticky)\r\n            }\r\n        }\r\n        return new Pos(lineNo, dir < 0 ? lineObj.text.length : 0, dir < 0 ? "before" : "after")\r\n    }\r\n\r\n    function moveVisually(cm, line, start, dir) {\r\n        var bidi = getOrder(line, cm.doc.direction);\r\n        if (!bidi) { return moveLogically(line, start, dir) }\r\n        if (start.ch >= line.text.length) {\r\n            start.ch = line.text.length;\r\n            start.sticky = "before";\r\n        } else if (start.ch <= 0) {\r\n            start.ch = 0;\r\n            start.sticky = "after";\r\n        }\r\n        var partPos = getBidiPartAt(bidi, start.ch, start.sticky), part = bidi[partPos];\r\n        if (cm.doc.direction == "ltr" && part.level % 2 == 0 && (dir > 0 ? part.to > start.ch : part.from < start.ch)) {\r\n            // Case 1: We move within an ltr part in an ltr editor. Even with wrapped lines,\r\n            // nothing interesting happens.\r\n            return moveLogically(line, start, dir)\r\n        }\r\n\r\n        var mv = function (pos, dir) { return moveCharLogically(line, pos instanceof Pos ? pos.ch : pos, dir); };\r\n        var prep;\r\n        var getWrappedLineExtent = function (ch) {\r\n            if (!cm.options.lineWrapping) { return {begin: 0, end: line.text.length} }\r\n            prep = prep || prepareMeasureForLine(cm, line);\r\n            return wrappedLineExtentChar(cm, line, prep, ch)\r\n        };\r\n        var wrappedLineExtent = getWrappedLineExtent(start.sticky == "before" ? mv(start, -1) : start.ch);\r\n\r\n        if (cm.doc.direction == "rtl" || part.level == 1) {\r\n            var moveInStorageOrder = (part.level == 1) == (dir < 0);\r\n            var ch = mv(start, moveInStorageOrder ? 1 : -1);\r\n            if (ch != null && (!moveInStorageOrder ? ch >= part.from && ch >= wrappedLineExtent.begin : ch <= part.to && ch <= wrappedLineExtent.end)) {\r\n                // Case 2: We move within an rtl part or in an rtl editor on the same visual line\r\n                var sticky = moveInStorageOrder ? "before" : "after";\r\n                return new Pos(start.line, ch, sticky)\r\n            }\r\n        }\r\n\r\n        // Case 3: Could not move within this bidi part in this visual line, so leave\r\n        // the current bidi part\r\n\r\n        var searchInVisualLine = function (partPos, dir, wrappedLineExtent) {\r\n            var getRes = function (ch, moveInStorageOrder) { return moveInStorageOrder\r\n                ? new Pos(start.line, mv(ch, 1), "before")\r\n                : new Pos(start.line, ch, "after"); };\r\n\r\n            for (; partPos >= 0 && partPos < bidi.length; partPos += dir) {\r\n                var part = bidi[partPos];\r\n                var moveInStorageOrder = (dir > 0) == (part.level != 1);\r\n                var ch = moveInStorageOrder ? wrappedLineExtent.begin : mv(wrappedLineExtent.end, -1);\r\n                if (part.from <= ch && ch < part.to) { return getRes(ch, moveInStorageOrder) }\r\n                ch = moveInStorageOrder ? part.from : mv(part.to, -1);\r\n                if (wrappedLineExtent.begin <= ch && ch < wrappedLineExtent.end) { return getRes(ch, moveInStorageOrder) }\r\n            }\r\n        };\r\n\r\n        // Case 3a: Look for other bidi parts on the same visual line\r\n        var res = searchInVisualLine(partPos + dir, dir, wrappedLineExtent);\r\n        if (res) { return res }\r\n\r\n        // Case 3b: Look for other bidi parts on the next visual line\r\n        var nextCh = dir > 0 ? wrappedLineExtent.end : mv(wrappedLineExtent.begin, -1);\r\n        if (nextCh != null && !(dir > 0 && nextCh == line.text.length)) {\r\n            res = searchInVisualLine(dir > 0 ? 0 : bidi.length - 1, dir, getWrappedLineExtent(nextCh));\r\n            if (res) { return res }\r\n        }\r\n\r\n        // Case 4: Nowhere to move\r\n        return null\r\n    }\r\n\r\n    // Commands are parameter-less actions that can be performed on an\r\n    // editor, mostly used for keybindings.\r\n    var commands = {\r\n        selectAll: selectAll,\r\n        singleSelection: function (cm) { return cm.setSelection(cm.getCursor("anchor"), cm.getCursor("head"), sel_dontScroll); },\r\n        killLine: function (cm) { return deleteNearSelection(cm, function (range) {\r\n            if (range.empty()) {\r\n                var len = getLine(cm.doc, range.head.line).text.length;\r\n                if (range.head.ch == len && range.head.line < cm.lastLine())\r\n                { return {from: range.head, to: Pos(range.head.line + 1, 0)} }\r\n                else\r\n                { return {from: range.head, to: Pos(range.head.line, len)} }\r\n            } else {\r\n                return {from: range.from(), to: range.to()}\r\n            }\r\n        }); },\r\n        deleteLine: function (cm) { return deleteNearSelection(cm, function (range) { return ({\r\n            from: Pos(range.from().line, 0),\r\n            to: clipPos(cm.doc, Pos(range.to().line + 1, 0))\r\n        }); }); },\r\n        delLineLeft: function (cm) { return deleteNearSelection(cm, function (range) { return ({\r\n            from: Pos(range.from().line, 0), to: range.from()\r\n        }); }); },\r\n        delWrappedLineLeft: function (cm) { return deleteNearSelection(cm, function (range) {\r\n            var top = cm.charCoords(range.head, "div").top + 5;\r\n            var leftPos = cm.coordsChar({left: 0, top: top}, "div");\r\n            return {from: leftPos, to: range.from()}\r\n        }); },\r\n        delWrappedLineRight: function (cm) { return deleteNearSelection(cm, function (range) {\r\n            var top = cm.charCoords(range.head, "div").top + 5;\r\n            var rightPos = cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, "div");\r\n            return {from: range.from(), to: rightPos }\r\n        }); },\r\n        undo: function (cm) { return cm.undo(); },\r\n        redo: function (cm) { return cm.redo(); },\r\n        undoSelection: function (cm) { return cm.undoSelection(); },\r\n        redoSelection: function (cm) { return cm.redoSelection(); },\r\n        goDocStart: function (cm) { return cm.extendSelection(Pos(cm.firstLine(), 0)); },\r\n        goDocEnd: function (cm) { return cm.extendSelection(Pos(cm.lastLine())); },\r\n        goLineStart: function (cm) { return cm.extendSelectionsBy(function (range) { return lineStart(cm, range.head.line); },\r\n            {origin: "+move", bias: 1}\r\n        ); },\r\n        goLineStartSmart: function (cm) { return cm.extendSelectionsBy(function (range) { return lineStartSmart(cm, range.head); },\r\n            {origin: "+move", bias: 1}\r\n        ); },\r\n        goLineEnd: function (cm) { return cm.extendSelectionsBy(function (range) { return lineEnd(cm, range.head.line); },\r\n            {origin: "+move", bias: -1}\r\n        ); },\r\n        goLineRight: function (cm) { return cm.extendSelectionsBy(function (range) {\r\n            var top = cm.cursorCoords(range.head, "div").top + 5;\r\n            return cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, "div")\r\n        }, sel_move); },\r\n        goLineLeft: function (cm) { return cm.extendSelectionsBy(function (range) {\r\n            var top = cm.cursorCoords(range.head, "div").top + 5;\r\n            return cm.coordsChar({left: 0, top: top}, "div")\r\n        }, sel_move); },\r\n        goLineLeftSmart: function (cm) { return cm.extendSelectionsBy(function (range) {\r\n            var top = cm.cursorCoords(range.head, "div").top + 5;\r\n            var pos = cm.coordsChar({left: 0, top: top}, "div");\r\n            if (pos.ch < cm.getLine(pos.line).search(/\\S/)) { return lineStartSmart(cm, range.head) }\r\n            return pos\r\n        }, sel_move); },\r\n        goLineUp: function (cm) { return cm.moveV(-1, "line"); },\r\n        goLineDown: function (cm) { return cm.moveV(1, "line"); },\r\n        goPageUp: function (cm) { return cm.moveV(-1, "page"); },\r\n        goPageDown: function (cm) { return cm.moveV(1, "page"); },\r\n        goCharLeft: function (cm) { return cm.moveH(-1, "char"); },\r\n        goCharRight: function (cm) { return cm.moveH(1, "char"); },\r\n        goColumnLeft: function (cm) { return cm.moveH(-1, "column"); },\r\n        goColumnRight: function (cm) { return cm.moveH(1, "column"); },\r\n        goWordLeft: function (cm) { return cm.moveH(-1, "word"); },\r\n        goGroupRight: function (cm) { return cm.moveH(1, "group"); },\r\n        goGroupLeft: function (cm) { return cm.moveH(-1, "group"); },\r\n        goWordRight: function (cm) { return cm.moveH(1, "word"); },\r\n        delCharBefore: function (cm) { return cm.deleteH(-1, "char"); },\r\n        delCharAfter: function (cm) { return cm.deleteH(1, "char"); },\r\n        delWordBefore: function (cm) { return cm.deleteH(-1, "word"); },\r\n        delWordAfter: function (cm) { return cm.deleteH(1, "word"); },\r\n        delGroupBefore: function (cm) { return cm.deleteH(-1, "group"); },\r\n        delGroupAfter: function (cm) { return cm.deleteH(1, "group"); },\r\n        indentAuto: function (cm) { return cm.indentSelection("smart"); },\r\n        indentMore: function (cm) { return cm.indentSelection("add"); },\r\n        indentLess: function (cm) { return cm.indentSelection("subtract"); },\r\n        insertTab: function (cm) { return cm.replaceSelection("\\t"); },\r\n        insertSoftTab: function (cm) {\r\n            var spaces = [], ranges = cm.listSelections(), tabSize = cm.options.tabSize;\r\n            for (var i = 0; i < ranges.length; i++) {\r\n                var pos = ranges[i].from();\r\n                var col = countColumn(cm.getLine(pos.line), pos.ch, tabSize);\r\n                spaces.push(spaceStr(tabSize - col % tabSize));\r\n            }\r\n            cm.replaceSelections(spaces);\r\n        },\r\n        defaultTab: function (cm) {\r\n            if (cm.somethingSelected()) { cm.indentSelection("add"); }\r\n            else { cm.execCommand("insertTab"); }\r\n        },\r\n        // Swap the two chars left and right of each selection\'s head.\r\n        // Move cursor behind the two swapped characters afterwards.\r\n        //\r\n        // Doesn\'t consider line feeds a character.\r\n        // Doesn\'t scan more than one line above to find a character.\r\n        // Doesn\'t do anything on an empty line.\r\n        // Doesn\'t do anything with non-empty selections.\r\n        transposeChars: function (cm) { return runInOp(cm, function () {\r\n            var ranges = cm.listSelections(), newSel = [];\r\n            for (var i = 0; i < ranges.length; i++) {\r\n                if (!ranges[i].empty()) { continue }\r\n                var cur = ranges[i].head, line = getLine(cm.doc, cur.line).text;\r\n                if (line) {\r\n                    if (cur.ch == line.length) { cur = new Pos(cur.line, cur.ch - 1); }\r\n                    if (cur.ch > 0) {\r\n                        cur = new Pos(cur.line, cur.ch + 1);\r\n                        cm.replaceRange(line.charAt(cur.ch - 1) + line.charAt(cur.ch - 2),\r\n                            Pos(cur.line, cur.ch - 2), cur, "+transpose");\r\n                    } else if (cur.line > cm.doc.first) {\r\n                        var prev = getLine(cm.doc, cur.line - 1).text;\r\n                        if (prev) {\r\n                            cur = new Pos(cur.line, 1);\r\n                            cm.replaceRange(line.charAt(0) + cm.doc.lineSeparator() +\r\n                                prev.charAt(prev.length - 1),\r\n                                Pos(cur.line - 1, prev.length - 1), cur, "+transpose");\r\n                        }\r\n                    }\r\n                }\r\n                newSel.push(new Range(cur, cur));\r\n            }\r\n            cm.setSelections(newSel);\r\n        }); },\r\n        newlineAndIndent: function (cm) { return runInOp(cm, function () {\r\n            var sels = cm.listSelections();\r\n            for (var i = sels.length - 1; i >= 0; i--)\r\n            { cm.replaceRange(cm.doc.lineSeparator(), sels[i].anchor, sels[i].head, "+input"); }\r\n            sels = cm.listSelections();\r\n            for (var i$1 = 0; i$1 < sels.length; i$1++)\r\n            { cm.indentLine(sels[i$1].from().line, null, true); }\r\n            ensureCursorVisible(cm);\r\n        }); },\r\n        openLine: function (cm) { return cm.replaceSelection("\\n", "start"); },\r\n        toggleOverwrite: function (cm) { return cm.toggleOverwrite(); }\r\n    };\r\n\r\n\r\n    function lineStart(cm, lineN) {\r\n        var line = getLine(cm.doc, lineN);\r\n        var visual = visualLine(line);\r\n        if (visual != line) { lineN = lineNo(visual); }\r\n        return endOfLine(true, cm, visual, lineN, 1)\r\n    }\r\n    function lineEnd(cm, lineN) {\r\n        var line = getLine(cm.doc, lineN);\r\n        var visual = visualLineEnd(line);\r\n        if (visual != line) { lineN = lineNo(visual); }\r\n        return endOfLine(true, cm, line, lineN, -1)\r\n    }\r\n    function lineStartSmart(cm, pos) {\r\n        var start = lineStart(cm, pos.line);\r\n        var line = getLine(cm.doc, start.line);\r\n        var order = getOrder(line, cm.doc.direction);\r\n        if (!order || order[0].level == 0) {\r\n            var firstNonWS = Math.max(0, line.text.search(/\\S/));\r\n            var inWS = pos.line == start.line && pos.ch <= firstNonWS && pos.ch;\r\n            return Pos(start.line, inWS ? 0 : firstNonWS, start.sticky)\r\n        }\r\n        return start\r\n    }\r\n\r\n    // Run a handler that was bound to a key.\r\n    function doHandleBinding(cm, bound, dropShift) {\r\n        if (typeof bound == "string") {\r\n            bound = commands[bound];\r\n            if (!bound) { return false }\r\n        }\r\n        // Ensure previous input has been read, so that the handler sees a\r\n        // consistent view of the document\r\n        cm.display.input.ensurePolled();\r\n        var prevShift = cm.display.shift, done = false;\r\n        try {\r\n            if (cm.isReadOnly()) { cm.state.suppressEdits = true; }\r\n            if (dropShift) { cm.display.shift = false; }\r\n            done = bound(cm) != Pass;\r\n        } finally {\r\n            cm.display.shift = prevShift;\r\n            cm.state.suppressEdits = false;\r\n        }\r\n        return done\r\n    }\r\n\r\n    function lookupKeyForEditor(cm, name, handle) {\r\n        for (var i = 0; i < cm.state.keyMaps.length; i++) {\r\n            var result = lookupKey(name, cm.state.keyMaps[i], handle, cm);\r\n            if (result) { return result }\r\n        }\r\n        return (cm.options.extraKeys && lookupKey(name, cm.options.extraKeys, handle, cm))\r\n            || lookupKey(name, cm.options.keyMap, handle, cm)\r\n    }\r\n\r\n    // Note that, despite the name, this function is also used to check\r\n    // for bound mouse clicks.\r\n\r\n    var stopSeq = new Delayed;\r\n\r\n    function dispatchKey(cm, name, e, handle) {\r\n        var seq = cm.state.keySeq;\r\n        if (seq) {\r\n            if (isModifierKey(name)) { return "handled" }\r\n            if (/\\\'$/.test(name))\r\n            { cm.state.keySeq = null; }\r\n            else\r\n            { stopSeq.set(50, function () {\r\n                if (cm.state.keySeq == seq) {\r\n                    cm.state.keySeq = null;\r\n                    cm.display.input.reset();\r\n                }\r\n            }); }\r\n            if (dispatchKeyInner(cm, seq + " " + name, e, handle)) { return true }\r\n        }\r\n        return dispatchKeyInner(cm, name, e, handle)\r\n    }\r\n\r\n    function dispatchKeyInner(cm, name, e, handle) {\r\n        var result = lookupKeyForEditor(cm, name, handle);\r\n\r\n        if (result == "multi")\r\n        { cm.state.keySeq = name; }\r\n        if (result == "handled")\r\n        { signalLater(cm, "keyHandled", cm, name, e); }\r\n\r\n        if (result == "handled" || result == "multi") {\r\n            e_preventDefault(e);\r\n            restartBlink(cm);\r\n        }\r\n\r\n        return !!result\r\n    }\r\n\r\n    // Handle a key from the keydown event.\r\n    function handleKeyBinding(cm, e) {\r\n        var name = keyName(e, true);\r\n        if (!name) { return false }\r\n\r\n        if (e.shiftKey && !cm.state.keySeq) {\r\n            // First try to resolve full name (including \'Shift-\'). Failing\r\n            // that, see if there is a cursor-motion command (starting with\r\n            // \'go\') bound to the keyname without \'Shift-\'.\r\n            return dispatchKey(cm, "Shift-" + name, e, function (b) { return doHandleBinding(cm, b, true); })\r\n                || dispatchKey(cm, name, e, function (b) {\r\n                    if (typeof b == "string" ? /^go[A-Z]/.test(b) : b.motion)\r\n                    { return doHandleBinding(cm, b) }\r\n                })\r\n        } else {\r\n            return dispatchKey(cm, name, e, function (b) { return doHandleBinding(cm, b); })\r\n        }\r\n    }\r\n\r\n    // Handle a key from the keypress event\r\n    function handleCharBinding(cm, e, ch) {\r\n        return dispatchKey(cm, "\'" + ch + "\'", e, function (b) { return doHandleBinding(cm, b, true); })\r\n    }\r\n\r\n    var lastStoppedKey = null;\r\n    function onKeyDown(e) {\r\n        var cm = this;\r\n        cm.curOp.focus = activeElt();\r\n        if (signalDOMEvent(cm, e)) { return }\r\n        // IE does strange things with escape.\r\n        if (ie && ie_version < 11 && e.keyCode == 27) { e.returnValue = false; }\r\n        var code = e.keyCode;\r\n        cm.display.shift = code == 16 || e.shiftKey;\r\n        var handled = handleKeyBinding(cm, e);\r\n        if (presto) {\r\n            lastStoppedKey = handled ? code : null;\r\n            // Opera has no cut event... we try to at least catch the key combo\r\n            if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))\r\n            { cm.replaceSelection("", null, "cut"); }\r\n        }\r\n\r\n        // Turn mouse into crosshair when Alt is held on Mac.\r\n        if (code == 18 && !/\\bCodeMirror-crosshair\\b/.test(cm.display.lineDiv.className))\r\n        { showCrossHair(cm); }\r\n    }\r\n\r\n    function showCrossHair(cm) {\r\n        var lineDiv = cm.display.lineDiv;\r\n        addClass(lineDiv, "CodeMirror-crosshair");\r\n\r\n        function up(e) {\r\n            if (e.keyCode == 18 || !e.altKey) {\r\n                rmClass(lineDiv, "CodeMirror-crosshair");\r\n                off(document, "keyup", up);\r\n                off(document, "mouseover", up);\r\n            }\r\n        }\r\n        on(document, "keyup", up);\r\n        on(document, "mouseover", up);\r\n    }\r\n\r\n    function onKeyUp(e) {\r\n        if (e.keyCode == 16) { this.doc.sel.shift = false; }\r\n        signalDOMEvent(this, e);\r\n    }\r\n\r\n    function onKeyPress(e) {\r\n        var cm = this;\r\n        if (eventInWidget(cm.display, e) || signalDOMEvent(cm, e) || e.ctrlKey && !e.altKey || mac && e.metaKey) { return }\r\n        var keyCode = e.keyCode, charCode = e.charCode;\r\n        if (presto && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return}\r\n        if ((presto && (!e.which || e.which < 10)) && handleKeyBinding(cm, e)) { return }\r\n        var ch = String.fromCharCode(charCode == null ? keyCode : charCode);\r\n        // Some browsers fire keypress events for backspace\r\n        if (ch == "\\x08") { return }\r\n        if (handleCharBinding(cm, e, ch)) { return }\r\n        cm.display.input.onKeyPress(e);\r\n    }\r\n\r\n    var DOUBLECLICK_DELAY = 400;\r\n\r\n    var PastClick = function(time, pos, button) {\r\n        this.time = time;\r\n        this.pos = pos;\r\n        this.button = button;\r\n    };\r\n\r\n    PastClick.prototype.compare = function (time, pos, button) {\r\n        return this.time + DOUBLECLICK_DELAY > time &&\r\n            cmp(pos, this.pos) == 0 && button == this.button\r\n    };\r\n\r\n    var lastClick, lastDoubleClick;\r\n    function clickRepeat(pos, button) {\r\n        var now = +new Date;\r\n        if (lastDoubleClick && lastDoubleClick.compare(now, pos, button)) {\r\n            lastClick = lastDoubleClick = null;\r\n            return "triple"\r\n        } else if (lastClick && lastClick.compare(now, pos, button)) {\r\n            lastDoubleClick = new PastClick(now, pos, button);\r\n            lastClick = null;\r\n            return "double"\r\n        } else {\r\n            lastClick = new PastClick(now, pos, button);\r\n            lastDoubleClick = null;\r\n            return "single"\r\n        }\r\n    }\r\n\r\n    // A mouse down can be a single click, double click, triple click,\r\n    // start of selection drag, start of text drag, new cursor\r\n    // (ctrl-click), rectangle drag (alt-drag), or xwin\r\n    // middle-click-paste. Or it might be a click on something we should\r\n    // not interfere with, such as a scrollbar or widget.\r\n    function onMouseDown(e) {\r\n        var cm = this, display = cm.display;\r\n        if (signalDOMEvent(cm, e) || display.activeTouch && display.input.supportsTouch()) { return }\r\n        display.input.ensurePolled();\r\n        display.shift = e.shiftKey;\r\n\r\n        if (eventInWidget(display, e)) {\r\n            if (!webkit) {\r\n                // Briefly turn off draggability, to allow widgets to do\r\n                // normal dragging things.\r\n                display.scroller.draggable = false;\r\n                setTimeout(function () { return display.scroller.draggable = true; }, 100);\r\n            }\r\n            return\r\n        }\r\n        if (clickInGutter(cm, e)) { return }\r\n        var pos = posFromMouse(cm, e), button = e_button(e), repeat = pos ? clickRepeat(pos, button) : "single";\r\n        window.focus();\r\n\r\n        // #3261: make sure, that we\'re not starting a second selection\r\n        if (button == 1 && cm.state.selectingText)\r\n        { cm.state.selectingText(e); }\r\n\r\n        if (pos && handleMappedButton(cm, button, pos, repeat, e)) { return }\r\n\r\n        if (button == 1) {\r\n            if (pos) { leftButtonDown(cm, pos, repeat, e); }\r\n            else if (e_target(e) == display.scroller) { e_preventDefault(e); }\r\n        } else if (button == 2) {\r\n            if (pos) { extendSelection(cm.doc, pos); }\r\n            setTimeout(function () { return display.input.focus(); }, 20);\r\n        } else if (button == 3) {\r\n            if (captureRightClick) { cm.display.input.onContextMenu(e); }\r\n            else { delayBlurEvent(cm); }\r\n        }\r\n    }\r\n\r\n    function handleMappedButton(cm, button, pos, repeat, event) {\r\n        var name = "Click";\r\n        if (repeat == "double") { name = "Double" + name; }\r\n        else if (repeat == "triple") { name = "Triple" + name; }\r\n        name = (button == 1 ? "Left" : button == 2 ? "Middle" : "Right") + name;\r\n\r\n        return dispatchKey(cm,  addModifierNames(name, event), event, function (bound) {\r\n            if (typeof bound == "string") { bound = commands[bound]; }\r\n            if (!bound) { return false }\r\n            var done = false;\r\n            try {\r\n                if (cm.isReadOnly()) { cm.state.suppressEdits = true; }\r\n                done = bound(cm, pos) != Pass;\r\n            } finally {\r\n                cm.state.suppressEdits = false;\r\n            }\r\n            return done\r\n        })\r\n    }\r\n\r\n    function configureMouse(cm, repeat, event) {\r\n        var option = cm.getOption("configureMouse");\r\n        var value = option ? option(cm, repeat, event) : {};\r\n        if (value.unit == null) {\r\n            var rect = chromeOS ? event.shiftKey && event.metaKey : event.altKey;\r\n            value.unit = rect ? "rectangle" : repeat == "single" ? "char" : repeat == "double" ? "word" : "line";\r\n        }\r\n        if (value.extend == null || cm.doc.extend) { value.extend = cm.doc.extend || event.shiftKey; }\r\n        if (value.addNew == null) { value.addNew = mac ? event.metaKey : event.ctrlKey; }\r\n        if (value.moveOnDrag == null) { value.moveOnDrag = !(mac ? event.altKey : event.ctrlKey); }\r\n        return value\r\n    }\r\n\r\n    function leftButtonDown(cm, pos, repeat, event) {\r\n        if (ie) { setTimeout(bind(ensureFocus, cm), 0); }\r\n        else { cm.curOp.focus = activeElt(); }\r\n\r\n        var behavior = configureMouse(cm, repeat, event);\r\n\r\n        var sel = cm.doc.sel, contained;\r\n        if (cm.options.dragDrop && dragAndDrop && !cm.isReadOnly() &&\r\n            repeat == "single" && (contained = sel.contains(pos)) > -1 &&\r\n            (cmp((contained = sel.ranges[contained]).from(), pos) < 0 || pos.xRel > 0) &&\r\n            (cmp(contained.to(), pos) > 0 || pos.xRel < 0))\r\n        { leftButtonStartDrag(cm, event, pos, behavior); }\r\n        else\r\n        { leftButtonSelect(cm, event, pos, behavior); }\r\n    }\r\n\r\n    // Start a text drag. When it ends, see if any dragging actually\r\n    // happen, and treat as a click if it didn\'t.\r\n    function leftButtonStartDrag(cm, event, pos, behavior) {\r\n        var display = cm.display, moved = false;\r\n        var dragEnd = operation(cm, function (e) {\r\n            if (webkit) { display.scroller.draggable = false; }\r\n            cm.state.draggingText = false;\r\n            off(display.wrapper.ownerDocument, "mouseup", dragEnd);\r\n            off(display.wrapper.ownerDocument, "mousemove", mouseMove);\r\n            off(display.scroller, "dragstart", dragStart);\r\n            off(display.scroller, "drop", dragEnd);\r\n            if (!moved) {\r\n                e_preventDefault(e);\r\n                if (!behavior.addNew)\r\n                { extendSelection(cm.doc, pos, null, null, behavior.extend); }\r\n                // Work around unexplainable focus problem in IE9 (#2127) and Chrome (#3081)\r\n                if (webkit || ie && ie_version == 9)\r\n                { setTimeout(function () {display.wrapper.ownerDocument.body.focus(); display.input.focus();}, 20); }\r\n                else\r\n                { display.input.focus(); }\r\n            }\r\n        });\r\n        var mouseMove = function(e2) {\r\n            moved = moved || Math.abs(event.clientX - e2.clientX) + Math.abs(event.clientY - e2.clientY) >= 10;\r\n        };\r\n        var dragStart = function () { return moved = true; };\r\n        // Let the drag handler handle this.\r\n        if (webkit) { display.scroller.draggable = true; }\r\n        cm.state.draggingText = dragEnd;\r\n        dragEnd.copy = !behavior.moveOnDrag;\r\n        // IE\'s approach to draggable\r\n        if (display.scroller.dragDrop) { display.scroller.dragDrop(); }\r\n        on(display.wrapper.ownerDocument, "mouseup", dragEnd);\r\n        on(display.wrapper.ownerDocument, "mousemove", mouseMove);\r\n        on(display.scroller, "dragstart", dragStart);\r\n        on(display.scroller, "drop", dragEnd);\r\n\r\n        delayBlurEvent(cm);\r\n        setTimeout(function () { return display.input.focus(); }, 20);\r\n    }\r\n\r\n    function rangeForUnit(cm, pos, unit) {\r\n        if (unit == "char") { return new Range(pos, pos) }\r\n        if (unit == "word") { return cm.findWordAt(pos) }\r\n        if (unit == "line") { return new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0))) }\r\n        var result = unit(cm, pos);\r\n        return new Range(result.from, result.to)\r\n    }\r\n\r\n    // Normal selection, as opposed to text dragging.\r\n    function leftButtonSelect(cm, event, start, behavior) {\r\n        var display = cm.display, doc = cm.doc;\r\n        e_preventDefault(event);\r\n\r\n        var ourRange, ourIndex, startSel = doc.sel, ranges = startSel.ranges;\r\n        if (behavior.addNew && !behavior.extend) {\r\n            ourIndex = doc.sel.contains(start);\r\n            if (ourIndex > -1)\r\n            { ourRange = ranges[ourIndex]; }\r\n            else\r\n            { ourRange = new Range(start, start); }\r\n        } else {\r\n            ourRange = doc.sel.primary();\r\n            ourIndex = doc.sel.primIndex;\r\n        }\r\n\r\n        if (behavior.unit == "rectangle") {\r\n            if (!behavior.addNew) { ourRange = new Range(start, start); }\r\n            start = posFromMouse(cm, event, true, true);\r\n            ourIndex = -1;\r\n        } else {\r\n            var range$$1 = rangeForUnit(cm, start, behavior.unit);\r\n            if (behavior.extend)\r\n            { ourRange = extendRange(ourRange, range$$1.anchor, range$$1.head, behavior.extend); }\r\n            else\r\n            { ourRange = range$$1; }\r\n        }\r\n\r\n        if (!behavior.addNew) {\r\n            ourIndex = 0;\r\n            setSelection(doc, new Selection([ourRange], 0), sel_mouse);\r\n            startSel = doc.sel;\r\n        } else if (ourIndex == -1) {\r\n            ourIndex = ranges.length;\r\n            setSelection(doc, normalizeSelection(cm, ranges.concat([ourRange]), ourIndex),\r\n                {scroll: false, origin: "*mouse"});\r\n        } else if (ranges.length > 1 && ranges[ourIndex].empty() && behavior.unit == "char" && !behavior.extend) {\r\n            setSelection(doc, normalizeSelection(cm, ranges.slice(0, ourIndex).concat(ranges.slice(ourIndex + 1)), 0),\r\n                {scroll: false, origin: "*mouse"});\r\n            startSel = doc.sel;\r\n        } else {\r\n            replaceOneSelection(doc, ourIndex, ourRange, sel_mouse);\r\n        }\r\n\r\n        var lastPos = start;\r\n        function extendTo(pos) {\r\n            if (cmp(lastPos, pos) == 0) { return }\r\n            lastPos = pos;\r\n\r\n            if (behavior.unit == "rectangle") {\r\n                var ranges = [], tabSize = cm.options.tabSize;\r\n                var startCol = countColumn(getLine(doc, start.line).text, start.ch, tabSize);\r\n                var posCol = countColumn(getLine(doc, pos.line).text, pos.ch, tabSize);\r\n                var left = Math.min(startCol, posCol), right = Math.max(startCol, posCol);\r\n                for (var line = Math.min(start.line, pos.line), end = Math.min(cm.lastLine(), Math.max(start.line, pos.line));\r\n                     line <= end; line++) {\r\n                    var text = getLine(doc, line).text, leftPos = findColumn(text, left, tabSize);\r\n                    if (left == right)\r\n                    { ranges.push(new Range(Pos(line, leftPos), Pos(line, leftPos))); }\r\n                    else if (text.length > leftPos)\r\n                    { ranges.push(new Range(Pos(line, leftPos), Pos(line, findColumn(text, right, tabSize)))); }\r\n                }\r\n                if (!ranges.length) { ranges.push(new Range(start, start)); }\r\n                setSelection(doc, normalizeSelection(cm, startSel.ranges.slice(0, ourIndex).concat(ranges), ourIndex),\r\n                    {origin: "*mouse", scroll: false});\r\n                cm.scrollIntoView(pos);\r\n            } else {\r\n                var oldRange = ourRange;\r\n                var range$$1 = rangeForUnit(cm, pos, behavior.unit);\r\n                var anchor = oldRange.anchor, head;\r\n                if (cmp(range$$1.anchor, anchor) > 0) {\r\n                    head = range$$1.head;\r\n                    anchor = minPos(oldRange.from(), range$$1.anchor);\r\n                } else {\r\n                    head = range$$1.anchor;\r\n                    anchor = maxPos(oldRange.to(), range$$1.head);\r\n                }\r\n                var ranges$1 = startSel.ranges.slice(0);\r\n                ranges$1[ourIndex] = bidiSimplify(cm, new Range(clipPos(doc, anchor), head));\r\n                setSelection(doc, normalizeSelection(cm, ranges$1, ourIndex), sel_mouse);\r\n            }\r\n        }\r\n\r\n        var editorSize = display.wrapper.getBoundingClientRect();\r\n        // Used to ensure timeout re-tries don\'t fire when another extend\r\n        // happened in the meantime (clearTimeout isn\'t reliable -- at\r\n        // least on Chrome, the timeouts still happen even when cleared,\r\n        // if the clear happens after their scheduled firing time).\r\n        var counter = 0;\r\n\r\n        function extend(e) {\r\n            var curCount = ++counter;\r\n            var cur = posFromMouse(cm, e, true, behavior.unit == "rectangle");\r\n            if (!cur) { return }\r\n            if (cmp(cur, lastPos) != 0) {\r\n                cm.curOp.focus = activeElt();\r\n                extendTo(cur);\r\n                var visible = visibleLines(display, doc);\r\n                if (cur.line >= visible.to || cur.line < visible.from)\r\n                { setTimeout(operation(cm, function () {if (counter == curCount) { extend(e); }}), 150); }\r\n            } else {\r\n                var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;\r\n                if (outside) { setTimeout(operation(cm, function () {\r\n                    if (counter != curCount) { return }\r\n                    display.scroller.scrollTop += outside;\r\n                    extend(e);\r\n                }), 50); }\r\n            }\r\n        }\r\n\r\n        function done(e) {\r\n            cm.state.selectingText = false;\r\n            counter = Infinity;\r\n            e_preventDefault(e);\r\n            display.input.focus();\r\n            off(display.wrapper.ownerDocument, "mousemove", move);\r\n            off(display.wrapper.ownerDocument, "mouseup", up);\r\n            doc.history.lastSelOrigin = null;\r\n        }\r\n\r\n        var move = operation(cm, function (e) {\r\n            if (e.buttons === 0 || !e_button(e)) { done(e); }\r\n            else { extend(e); }\r\n        });\r\n        var up = operation(cm, done);\r\n        cm.state.selectingText = up;\r\n        on(display.wrapper.ownerDocument, "mousemove", move);\r\n        on(display.wrapper.ownerDocument, "mouseup", up);\r\n    }\r\n\r\n    // Used when mouse-selecting to adjust the anchor to the proper side\r\n    // of a bidi jump depending on the visual position of the head.\r\n    function bidiSimplify(cm, range$$1) {\r\n        var anchor = range$$1.anchor;\r\n        var head = range$$1.head;\r\n        var anchorLine = getLine(cm.doc, anchor.line);\r\n        if (cmp(anchor, head) == 0 && anchor.sticky == head.sticky) { return range$$1 }\r\n        var order = getOrder(anchorLine);\r\n        if (!order) { return range$$1 }\r\n        var index = getBidiPartAt(order, anchor.ch, anchor.sticky), part = order[index];\r\n        if (part.from != anchor.ch && part.to != anchor.ch) { return range$$1 }\r\n        var boundary = index + ((part.from == anchor.ch) == (part.level != 1) ? 0 : 1);\r\n        if (boundary == 0 || boundary == order.length) { return range$$1 }\r\n\r\n        // Compute the relative visual position of the head compared to the\r\n        // anchor (<0 is to the left, >0 to the right)\r\n        var leftSide;\r\n        if (head.line != anchor.line) {\r\n            leftSide = (head.line - anchor.line) * (cm.doc.direction == "ltr" ? 1 : -1) > 0;\r\n        } else {\r\n            var headIndex = getBidiPartAt(order, head.ch, head.sticky);\r\n            var dir = headIndex - index || (head.ch - anchor.ch) * (part.level == 1 ? -1 : 1);\r\n            if (headIndex == boundary - 1 || headIndex == boundary)\r\n            { leftSide = dir < 0; }\r\n            else\r\n            { leftSide = dir > 0; }\r\n        }\r\n\r\n        var usePart = order[boundary + (leftSide ? -1 : 0)];\r\n        var from = leftSide == (usePart.level == 1);\r\n        var ch = from ? usePart.from : usePart.to, sticky = from ? "after" : "before";\r\n        return anchor.ch == ch && anchor.sticky == sticky ? range$$1 : new Range(new Pos(anchor.line, ch, sticky), head)\r\n    }\r\n\r\n\r\n    // Determines whether an event happened in the gutter, and fires the\r\n    // handlers for the corresponding event.\r\n    function gutterEvent(cm, e, type, prevent) {\r\n        var mX, mY;\r\n        if (e.touches) {\r\n            mX = e.touches[0].clientX;\r\n            mY = e.touches[0].clientY;\r\n        } else {\r\n            try { mX = e.clientX; mY = e.clientY; }\r\n            catch(e) { return false }\r\n        }\r\n        if (mX >= Math.floor(cm.display.gutters.getBoundingClientRect().right)) { return false }\r\n        if (prevent) { e_preventDefault(e); }\r\n\r\n        var display = cm.display;\r\n        var lineBox = display.lineDiv.getBoundingClientRect();\r\n\r\n        if (mY > lineBox.bottom || !hasHandler(cm, type)) { return e_defaultPrevented(e) }\r\n        mY -= lineBox.top - display.viewOffset;\r\n\r\n        for (var i = 0; i < cm.options.gutters.length; ++i) {\r\n            var g = display.gutters.childNodes[i];\r\n            if (g && g.getBoundingClientRect().right >= mX) {\r\n                var line = lineAtHeight(cm.doc, mY);\r\n                var gutter = cm.options.gutters[i];\r\n                signal(cm, type, cm, line, gutter, e);\r\n                return e_defaultPrevented(e)\r\n            }\r\n        }\r\n    }\r\n\r\n    function clickInGutter(cm, e) {\r\n        return gutterEvent(cm, e, "gutterClick", true)\r\n    }\r\n\r\n    // CONTEXT MENU HANDLING\r\n\r\n    // To make the context menu work, we need to briefly unhide the\r\n    // textarea (making it as unobtrusive as possible) to let the\r\n    // right-click take effect on it.\r\n    function onContextMenu(cm, e) {\r\n        if (eventInWidget(cm.display, e) || contextMenuInGutter(cm, e)) { return }\r\n        if (signalDOMEvent(cm, e, "contextmenu")) { return }\r\n        if (!captureRightClick) { cm.display.input.onContextMenu(e); }\r\n    }\r\n\r\n    function contextMenuInGutter(cm, e) {\r\n        if (!hasHandler(cm, "gutterContextMenu")) { return false }\r\n        return gutterEvent(cm, e, "gutterContextMenu", false)\r\n    }\r\n\r\n    function themeChanged(cm) {\r\n        cm.display.wrapper.className = cm.display.wrapper.className.replace(/\\s*cm-s-\\S+/g, "") +\r\n            cm.options.theme.replace(/(^|\\s)\\s*/g, " cm-s-");\r\n        clearCaches(cm);\r\n    }\r\n\r\n    var Init = {toString: function(){return "CodeMirror.Init"}};\r\n\r\n    var defaults = {};\r\n    var optionHandlers = {};\r\n\r\n    function defineOptions(CodeMirror) {\r\n        var optionHandlers = CodeMirror.optionHandlers;\r\n\r\n        function option(name, deflt, handle, notOnInit) {\r\n            CodeMirror.defaults[name] = deflt;\r\n            if (handle) { optionHandlers[name] =\r\n                notOnInit ? function (cm, val, old) {if (old != Init) { handle(cm, val, old); }} : handle; }\r\n        }\r\n\r\n        CodeMirror.defineOption = option;\r\n\r\n        // Passed to option handlers when there is no old value.\r\n        CodeMirror.Init = Init;\r\n\r\n        // These two are, on init, called from the constructor because they\r\n        // have to be initialized before the editor can start at all.\r\n        option("value", "", function (cm, val) { return cm.setValue(val); }, true);\r\n        option("mode", null, function (cm, val) {\r\n            cm.doc.modeOption = val;\r\n            loadMode(cm);\r\n        }, true);\r\n\r\n        option("indentUnit", 2, loadMode, true);\r\n        option("indentWithTabs", false);\r\n        option("smartIndent", true);\r\n        option("tabSize", 4, function (cm) {\r\n            resetModeState(cm);\r\n            clearCaches(cm);\r\n            regChange(cm);\r\n        }, true);\r\n\r\n        option("lineSeparator", null, function (cm, val) {\r\n            cm.doc.lineSep = val;\r\n            if (!val) { return }\r\n            var newBreaks = [], lineNo = cm.doc.first;\r\n            cm.doc.iter(function (line) {\r\n                for (var pos = 0;;) {\r\n                    var found = line.text.indexOf(val, pos);\r\n                    if (found == -1) { break }\r\n                    pos = found + val.length;\r\n                    newBreaks.push(Pos(lineNo, found));\r\n                }\r\n                lineNo++;\r\n            });\r\n            for (var i = newBreaks.length - 1; i >= 0; i--)\r\n            { replaceRange(cm.doc, val, newBreaks[i], Pos(newBreaks[i].line, newBreaks[i].ch + val.length)); }\r\n        });\r\n        option("specialChars", /[\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u061c\\u200b-\\u200f\\u2028\\u2029\\ufeff]/g, function (cm, val, old) {\r\n            cm.state.specialChars = new RegExp(val.source + (val.test("\\t") ? "" : "|\\t"), "g");\r\n            if (old != Init) { cm.refresh(); }\r\n        });\r\n        option("specialCharPlaceholder", defaultSpecialCharPlaceholder, function (cm) { return cm.refresh(); }, true);\r\n        option("electricChars", true);\r\n        option("inputStyle", mobile ? "contenteditable" : "textarea", function () {\r\n            throw new Error("inputStyle can not (yet) be changed in a running editor") // FIXME\r\n        }, true);\r\n        option("spellcheck", false, function (cm, val) { return cm.getInputField().spellcheck = val; }, true);\r\n        option("rtlMoveVisually", !windows);\r\n        option("wholeLineUpdateBefore", true);\r\n\r\n        option("theme", "default", function (cm) {\r\n            themeChanged(cm);\r\n            guttersChanged(cm);\r\n        }, true);\r\n        option("keyMap", "default", function (cm, val, old) {\r\n            var next = getKeyMap(val);\r\n            var prev = old != Init && getKeyMap(old);\r\n            if (prev && prev.detach) { prev.detach(cm, next); }\r\n            if (next.attach) { next.attach(cm, prev || null); }\r\n        });\r\n        option("extraKeys", null);\r\n        option("configureMouse", null);\r\n\r\n        option("lineWrapping", false, wrappingChanged, true);\r\n        option("gutters", [], function (cm) {\r\n            setGuttersForLineNumbers(cm.options);\r\n            guttersChanged(cm);\r\n        }, true);\r\n        option("fixedGutter", true, function (cm, val) {\r\n            cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + "px" : "0";\r\n            cm.refresh();\r\n        }, true);\r\n        option("coverGutterNextToScrollbar", false, function (cm) { return updateScrollbars(cm); }, true);\r\n        option("scrollbarStyle", "native", function (cm) {\r\n            initScrollbars(cm);\r\n            updateScrollbars(cm);\r\n            cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);\r\n            cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft);\r\n        }, true);\r\n        option("lineNumbers", false, function (cm) {\r\n            setGuttersForLineNumbers(cm.options);\r\n            guttersChanged(cm);\r\n        }, true);\r\n        option("firstLineNumber", 1, guttersChanged, true);\r\n        option("lineNumberFormatter", function (integer) { return integer; }, guttersChanged, true);\r\n        option("showCursorWhenSelecting", false, updateSelection, true);\r\n\r\n        option("resetSelectionOnContextMenu", true);\r\n        option("lineWiseCopyCut", true);\r\n        option("pasteLinesPerSelection", true);\r\n        option("selectionsMayTouch", false);\r\n\r\n        option("readOnly", false, function (cm, val) {\r\n            if (val == "nocursor") {\r\n                onBlur(cm);\r\n                cm.display.input.blur();\r\n            }\r\n            cm.display.input.readOnlyChanged(val);\r\n        });\r\n        option("disableInput", false, function (cm, val) {if (!val) { cm.display.input.reset(); }}, true);\r\n        option("dragDrop", true, dragDropChanged);\r\n        option("allowDropFileTypes", null);\r\n\r\n        option("cursorBlinkRate", 530);\r\n        option("cursorScrollMargin", 0);\r\n        option("cursorHeight", 1, updateSelection, true);\r\n        option("singleCursorHeightPerLine", true, updateSelection, true);\r\n        option("workTime", 100);\r\n        option("workDelay", 100);\r\n        option("flattenSpans", true, resetModeState, true);\r\n        option("addModeClass", false, resetModeState, true);\r\n        option("pollInterval", 100);\r\n        option("undoDepth", 200, function (cm, val) { return cm.doc.history.undoDepth = val; });\r\n        option("historyEventDelay", 1250);\r\n        option("viewportMargin", 10, function (cm) { return cm.refresh(); }, true);\r\n        option("maxHighlightLength", 10000, resetModeState, true);\r\n        option("moveInputWithCursor", true, function (cm, val) {\r\n            if (!val) { cm.display.input.resetPosition(); }\r\n        });\r\n\r\n        option("tabindex", null, function (cm, val) { return cm.display.input.getField().tabIndex = val || ""; });\r\n        option("autofocus", null);\r\n        option("direction", "ltr", function (cm, val) { return cm.doc.setDirection(val); }, true);\r\n        option("phrases", null);\r\n    }\r\n\r\n    function guttersChanged(cm) {\r\n        updateGutters(cm);\r\n        regChange(cm);\r\n        alignHorizontally(cm);\r\n    }\r\n\r\n    function dragDropChanged(cm, value, old) {\r\n        var wasOn = old && old != Init;\r\n        if (!value != !wasOn) {\r\n            var funcs = cm.display.dragFunctions;\r\n            var toggle = value ? on : off;\r\n            toggle(cm.display.scroller, "dragstart", funcs.start);\r\n            toggle(cm.display.scroller, "dragenter", funcs.enter);\r\n            toggle(cm.display.scroller, "dragover", funcs.over);\r\n            toggle(cm.display.scroller, "dragleave", funcs.leave);\r\n            toggle(cm.display.scroller, "drop", funcs.drop);\r\n        }\r\n    }\r\n\r\n    function wrappingChanged(cm) {\r\n        if (cm.options.lineWrapping) {\r\n            addClass(cm.display.wrapper, "CodeMirror-wrap");\r\n            cm.display.sizer.style.minWidth = "";\r\n            cm.display.sizerWidth = null;\r\n        } else {\r\n            rmClass(cm.display.wrapper, "CodeMirror-wrap");\r\n            findMaxLine(cm);\r\n        }\r\n        estimateLineHeights(cm);\r\n        regChange(cm);\r\n        clearCaches(cm);\r\n        setTimeout(function () { return updateScrollbars(cm); }, 100);\r\n    }\r\n\r\n    // A CodeMirror instance represents an editor. This is the object\r\n    // that user code is usually dealing with.\r\n\r\n    function CodeMirror(place, options) {\r\n        var this$1 = this;\r\n\r\n        if (!(this instanceof CodeMirror)) { return new CodeMirror(place, options) }\r\n\r\n        this.options = options = options ? copyObj(options) : {};\r\n        // Determine effective options based on given values and defaults.\r\n        copyObj(defaults, options, false);\r\n        setGuttersForLineNumbers(options);\r\n\r\n        var doc = options.value;\r\n        if (typeof doc == "string") { doc = new Doc(doc, options.mode, null, options.lineSeparator, options.direction); }\r\n        else if (options.mode) { doc.modeOption = options.mode; }\r\n        this.doc = doc;\r\n\r\n        var input = new CodeMirror.inputStyles[options.inputStyle](this);\r\n        var display = this.display = new Display(place, doc, input);\r\n        display.wrapper.CodeMirror = this;\r\n        updateGutters(this);\r\n        themeChanged(this);\r\n        if (options.lineWrapping)\r\n        { this.display.wrapper.className += " CodeMirror-wrap"; }\r\n        initScrollbars(this);\r\n\r\n        this.state = {\r\n            keyMaps: [],  // stores maps added by addKeyMap\r\n            overlays: [], // highlighting overlays, as added by addOverlay\r\n            modeGen: 0,   // bumped when mode/overlay changes, used to invalidate highlighting info\r\n            overwrite: false,\r\n            delayingBlurEvent: false,\r\n            focused: false,\r\n            suppressEdits: false, // used to disable editing during key handlers when in readOnly mode\r\n            pasteIncoming: false, cutIncoming: false, // help recognize paste/cut edits in input.poll\r\n            selectingText: false,\r\n            draggingText: false,\r\n            highlight: new Delayed(), // stores highlight worker timeout\r\n            keySeq: null,  // Unfinished key sequence\r\n            specialChars: null\r\n        };\r\n\r\n        if (options.autofocus && !mobile) { display.input.focus(); }\r\n\r\n        // Override magic textarea content restore that IE sometimes does\r\n        // on our hidden textarea on reload\r\n        if (ie && ie_version < 11) { setTimeout(function () { return this$1.display.input.reset(true); }, 20); }\r\n\r\n        registerEventHandlers(this);\r\n        ensureGlobalHandlers();\r\n\r\n        startOperation(this);\r\n        this.curOp.forceUpdate = true;\r\n        attachDoc(this, doc);\r\n\r\n        if ((options.autofocus && !mobile) || this.hasFocus())\r\n        { setTimeout(bind(onFocus, this), 20); }\r\n        else\r\n        { onBlur(this); }\r\n\r\n        for (var opt in optionHandlers) { if (optionHandlers.hasOwnProperty(opt))\r\n        { optionHandlers[opt](this, options[opt], Init); } }\r\n        maybeUpdateLineNumberWidth(this);\r\n        if (options.finishInit) { options.finishInit(this); }\r\n        for (var i = 0; i < initHooks.length; ++i) { initHooks[i](this); }\r\n        endOperation(this);\r\n        // Suppress optimizelegibility in Webkit, since it breaks text\r\n        // measuring on line wrapping boundaries.\r\n        if (webkit && options.lineWrapping &&\r\n            getComputedStyle(display.lineDiv).textRendering == "optimizelegibility")\r\n        { display.lineDiv.style.textRendering = "auto"; }\r\n    }\r\n\r\n    // The default configuration options.\r\n    CodeMirror.defaults = defaults;\r\n    // Functions to run when options are changed.\r\n    CodeMirror.optionHandlers = optionHandlers;\r\n\r\n    // Attach the necessary event handlers when initializing the editor\r\n    function registerEventHandlers(cm) {\r\n        var d = cm.display;\r\n        on(d.scroller, "mousedown", operation(cm, onMouseDown));\r\n        // Older IE\'s will not fire a second mousedown for a double click\r\n        if (ie && ie_version < 11)\r\n        { on(d.scroller, "dblclick", operation(cm, function (e) {\r\n            if (signalDOMEvent(cm, e)) { return }\r\n            var pos = posFromMouse(cm, e);\r\n            if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) { return }\r\n            e_preventDefault(e);\r\n            var word = cm.findWordAt(pos);\r\n            extendSelection(cm.doc, word.anchor, word.head);\r\n        })); }\r\n        else\r\n        { on(d.scroller, "dblclick", function (e) { return signalDOMEvent(cm, e) || e_preventDefault(e); }); }\r\n        // Some browsers fire contextmenu *after* opening the menu, at\r\n        // which point we can\'t mess with it anymore. Context menu is\r\n        // handled in onMouseDown for these browsers.\r\n        on(d.scroller, "contextmenu", function (e) { return onContextMenu(cm, e); });\r\n\r\n        // Used to suppress mouse event handling when a touch happens\r\n        var touchFinished, prevTouch = {end: 0};\r\n        function finishTouch() {\r\n            if (d.activeTouch) {\r\n                touchFinished = setTimeout(function () { return d.activeTouch = null; }, 1000);\r\n                prevTouch = d.activeTouch;\r\n                prevTouch.end = +new Date;\r\n            }\r\n        }\r\n        function isMouseLikeTouchEvent(e) {\r\n            if (e.touches.length != 1) { return false }\r\n            var touch = e.touches[0];\r\n            return touch.radiusX <= 1 && touch.radiusY <= 1\r\n        }\r\n        function farAway(touch, other) {\r\n            if (other.left == null) { return true }\r\n            var dx = other.left - touch.left, dy = other.top - touch.top;\r\n            return dx * dx + dy * dy > 20 * 20\r\n        }\r\n        on(d.scroller, "touchstart", function (e) {\r\n            if (!signalDOMEvent(cm, e) && !isMouseLikeTouchEvent(e) && !clickInGutter(cm, e)) {\r\n                d.input.ensurePolled();\r\n                clearTimeout(touchFinished);\r\n                var now = +new Date;\r\n                d.activeTouch = {start: now, moved: false,\r\n                    prev: now - prevTouch.end <= 300 ? prevTouch : null};\r\n                if (e.touches.length == 1) {\r\n                    d.activeTouch.left = e.touches[0].pageX;\r\n                    d.activeTouch.top = e.touches[0].pageY;\r\n                }\r\n            }\r\n        });\r\n        on(d.scroller, "touchmove", function () {\r\n            if (d.activeTouch) { d.activeTouch.moved = true; }\r\n        });\r\n        on(d.scroller, "touchend", function (e) {\r\n            var touch = d.activeTouch;\r\n            if (touch && !eventInWidget(d, e) && touch.left != null &&\r\n                !touch.moved && new Date - touch.start < 300) {\r\n                var pos = cm.coordsChar(d.activeTouch, "page"), range;\r\n                if (!touch.prev || farAway(touch, touch.prev)) // Single tap\r\n                { range = new Range(pos, pos); }\r\n                else if (!touch.prev.prev || farAway(touch, touch.prev.prev)) // Double tap\r\n                { range = cm.findWordAt(pos); }\r\n                else // Triple tap\r\n                { range = new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0))); }\r\n                cm.setSelection(range.anchor, range.head);\r\n                cm.focus();\r\n                e_preventDefault(e);\r\n            }\r\n            finishTouch();\r\n        });\r\n        on(d.scroller, "touchcancel", finishTouch);\r\n\r\n        // Sync scrolling between fake scrollbars and real scrollable\r\n        // area, ensure viewport is updated when scrolling.\r\n        on(d.scroller, "scroll", function () {\r\n            if (d.scroller.clientHeight) {\r\n                updateScrollTop(cm, d.scroller.scrollTop);\r\n                setScrollLeft(cm, d.scroller.scrollLeft, true);\r\n                signal(cm, "scroll", cm);\r\n            }\r\n        });\r\n\r\n        // Listen to wheel events in order to try and update the viewport on time.\r\n        on(d.scroller, "mousewheel", function (e) { return onScrollWheel(cm, e); });\r\n        on(d.scroller, "DOMMouseScroll", function (e) { return onScrollWheel(cm, e); });\r\n\r\n        // Prevent wrapper from ever scrolling\r\n        on(d.wrapper, "scroll", function () { return d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });\r\n\r\n        d.dragFunctions = {\r\n            enter: function (e) {if (!signalDOMEvent(cm, e)) { e_stop(e); }},\r\n            over: function (e) {if (!signalDOMEvent(cm, e)) { onDragOver(cm, e); e_stop(e); }},\r\n            start: function (e) { return onDragStart(cm, e); },\r\n            drop: operation(cm, onDrop),\r\n            leave: function (e) {if (!signalDOMEvent(cm, e)) { clearDragCursor(cm); }}\r\n        };\r\n\r\n        var inp = d.input.getField();\r\n        on(inp, "keyup", function (e) { return onKeyUp.call(cm, e); });\r\n        on(inp, "keydown", operation(cm, onKeyDown));\r\n        on(inp, "keypress", operation(cm, onKeyPress));\r\n        on(inp, "focus", function (e) { return onFocus(cm, e); });\r\n        on(inp, "blur", function (e) { return onBlur(cm, e); });\r\n    }\r\n\r\n    var initHooks = [];\r\n    CodeMirror.defineInitHook = function (f) { return initHooks.push(f); };\r\n\r\n    // Indent the given line. The how parameter can be "smart",\r\n    // "add"/null, "subtract", or "prev". When aggressive is false\r\n    // (typically set to true for forced single-line indents), empty\r\n    // lines are not indented, and places where the mode returns Pass\r\n    // are left alone.\r\n    function indentLine(cm, n, how, aggressive) {\r\n        var doc = cm.doc, state;\r\n        if (how == null) { how = "add"; }\r\n        if (how == "smart") {\r\n            // Fall back to "prev" when the mode doesn\'t have an indentation\r\n            // method.\r\n            if (!doc.mode.indent) { how = "prev"; }\r\n            else { state = getContextBefore(cm, n).state; }\r\n        }\r\n\r\n        var tabSize = cm.options.tabSize;\r\n        var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);\r\n        if (line.stateAfter) { line.stateAfter = null; }\r\n        var curSpaceString = line.text.match(/^\\s*/)[0], indentation;\r\n        if (!aggressive && !/\\S/.test(line.text)) {\r\n            indentation = 0;\r\n            how = "not";\r\n        } else if (how == "smart") {\r\n            indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);\r\n            if (indentation == Pass || indentation > 150) {\r\n                if (!aggressive) { return }\r\n                how = "prev";\r\n            }\r\n        }\r\n        if (how == "prev") {\r\n            if (n > doc.first) { indentation = countColumn(getLine(doc, n-1).text, null, tabSize); }\r\n            else { indentation = 0; }\r\n        } else if (how == "add") {\r\n            indentation = curSpace + cm.options.indentUnit;\r\n        } else if (how == "subtract") {\r\n            indentation = curSpace - cm.options.indentUnit;\r\n        } else if (typeof how == "number") {\r\n            indentation = curSpace + how;\r\n        }\r\n        indentation = Math.max(0, indentation);\r\n\r\n        var indentString = "", pos = 0;\r\n        if (cm.options.indentWithTabs)\r\n        { for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += "\\t";} }\r\n        if (pos < indentation) { indentString += spaceStr(indentation - pos); }\r\n\r\n        if (indentString != curSpaceString) {\r\n            replaceRange(doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), "+input");\r\n            line.stateAfter = null;\r\n            return true\r\n        } else {\r\n            // Ensure that, if the cursor was in the whitespace at the start\r\n            // of the line, it is moved to the end of that space.\r\n            for (var i$1 = 0; i$1 < doc.sel.ranges.length; i$1++) {\r\n                var range = doc.sel.ranges[i$1];\r\n                if (range.head.line == n && range.head.ch < curSpaceString.length) {\r\n                    var pos$1 = Pos(n, curSpaceString.length);\r\n                    replaceOneSelection(doc, i$1, new Range(pos$1, pos$1));\r\n                    break\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // This will be set to a {lineWise: bool, text: [string]} object, so\r\n    // that, when pasting, we know what kind of selections the copied\r\n    // text was made out of.\r\n    var lastCopied = null;\r\n\r\n    function setLastCopied(newLastCopied) {\r\n        lastCopied = newLastCopied;\r\n    }\r\n\r\n    function applyTextInput(cm, inserted, deleted, sel, origin) {\r\n        var doc = cm.doc;\r\n        cm.display.shift = false;\r\n        if (!sel) { sel = doc.sel; }\r\n\r\n        var paste = cm.state.pasteIncoming || origin == "paste";\r\n        var textLines = splitLinesAuto(inserted), multiPaste = null;\r\n        // When pasting N lines into N selections, insert one line per selection\r\n        if (paste && sel.ranges.length > 1) {\r\n            if (lastCopied && lastCopied.text.join("\\n") == inserted) {\r\n                if (sel.ranges.length % lastCopied.text.length == 0) {\r\n                    multiPaste = [];\r\n                    for (var i = 0; i < lastCopied.text.length; i++)\r\n                    { multiPaste.push(doc.splitLines(lastCopied.text[i])); }\r\n                }\r\n            } else if (textLines.length == sel.ranges.length && cm.options.pasteLinesPerSelection) {\r\n                multiPaste = map(textLines, function (l) { return [l]; });\r\n            }\r\n        }\r\n\r\n        var updateInput = cm.curOp.updateInput;\r\n        // Normal behavior is to insert the new text into every selection\r\n        for (var i$1 = sel.ranges.length - 1; i$1 >= 0; i$1--) {\r\n            var range$$1 = sel.ranges[i$1];\r\n            var from = range$$1.from(), to = range$$1.to();\r\n            if (range$$1.empty()) {\r\n                if (deleted && deleted > 0) // Handle deletion\r\n                { from = Pos(from.line, from.ch - deleted); }\r\n                else if (cm.state.overwrite && !paste) // Handle overwrite\r\n                { to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + lst(textLines).length)); }\r\n                else if (paste && lastCopied && lastCopied.lineWise && lastCopied.text.join("\\n") == inserted)\r\n                { from = to = Pos(from.line, 0); }\r\n            }\r\n            var changeEvent = {from: from, to: to, text: multiPaste ? multiPaste[i$1 % multiPaste.length] : textLines,\r\n                origin: origin || (paste ? "paste" : cm.state.cutIncoming ? "cut" : "+input")};\r\n            makeChange(cm.doc, changeEvent);\r\n            signalLater(cm, "inputRead", cm, changeEvent);\r\n        }\r\n        if (inserted && !paste)\r\n        { triggerElectric(cm, inserted); }\r\n\r\n        ensureCursorVisible(cm);\r\n        if (cm.curOp.updateInput < 2) { cm.curOp.updateInput = updateInput; }\r\n        cm.curOp.typing = true;\r\n        cm.state.pasteIncoming = cm.state.cutIncoming = false;\r\n    }\r\n\r\n    function handlePaste(e, cm) {\r\n        var pasted = e.clipboardData && e.clipboardData.getData("Text");\r\n        if (pasted) {\r\n            e.preventDefault();\r\n            if (!cm.isReadOnly() && !cm.options.disableInput)\r\n            { runInOp(cm, function () { return applyTextInput(cm, pasted, 0, null, "paste"); }); }\r\n            return true\r\n        }\r\n    }\r\n\r\n    function triggerElectric(cm, inserted) {\r\n        // When an \'electric\' character is inserted, immediately trigger a reindent\r\n        if (!cm.options.electricChars || !cm.options.smartIndent) { return }\r\n        var sel = cm.doc.sel;\r\n\r\n        for (var i = sel.ranges.length - 1; i >= 0; i--) {\r\n            var range$$1 = sel.ranges[i];\r\n            if (range$$1.head.ch > 100 || (i && sel.ranges[i - 1].head.line == range$$1.head.line)) { continue }\r\n            var mode = cm.getModeAt(range$$1.head);\r\n            var indented = false;\r\n            if (mode.electricChars) {\r\n                for (var j = 0; j < mode.electricChars.length; j++)\r\n                { if (inserted.indexOf(mode.electricChars.charAt(j)) > -1) {\r\n                    indented = indentLine(cm, range$$1.head.line, "smart");\r\n                    break\r\n                } }\r\n            } else if (mode.electricInput) {\r\n                if (mode.electricInput.test(getLine(cm.doc, range$$1.head.line).text.slice(0, range$$1.head.ch)))\r\n                { indented = indentLine(cm, range$$1.head.line, "smart"); }\r\n            }\r\n            if (indented) { signalLater(cm, "electricInput", cm, range$$1.head.line); }\r\n        }\r\n    }\r\n\r\n    function copyableRanges(cm) {\r\n        var text = [], ranges = [];\r\n        for (var i = 0; i < cm.doc.sel.ranges.length; i++) {\r\n            var line = cm.doc.sel.ranges[i].head.line;\r\n            var lineRange = {anchor: Pos(line, 0), head: Pos(line + 1, 0)};\r\n            ranges.push(lineRange);\r\n            text.push(cm.getRange(lineRange.anchor, lineRange.head));\r\n        }\r\n        return {text: text, ranges: ranges}\r\n    }\r\n\r\n    function disableBrowserMagic(field, spellcheck) {\r\n        field.setAttribute("autocorrect", "off");\r\n        field.setAttribute("autocapitalize", "off");\r\n        field.setAttribute("spellcheck", !!spellcheck);\r\n    }\r\n\r\n    function hiddenTextarea() {\r\n        var te = elt("textarea", null, null, "position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none");\r\n        var div = elt("div", [te], null, "overflow: hidden; position: relative; width: 3px; height: 0px;");\r\n        // The textarea is kept positioned near the cursor to prevent the\r\n        // fact that it\'ll be scrolled into view on input from scrolling\r\n        // our fake cursor out of view. On webkit, when wrap=off, paste is\r\n        // very slow. So make the area wide instead.\r\n        if (webkit) { te.style.width = "1000px"; }\r\n        else { te.setAttribute("wrap", "off"); }\r\n        // If border: 0; -- iOS fails to open keyboard (issue #1287)\r\n        if (ios) { te.style.border = "1px solid black"; }\r\n        disableBrowserMagic(te);\r\n        return div\r\n    }\r\n\r\n    // The publicly visible API. Note that methodOp(f) means\r\n    // \'wrap f in an operation, performed on its `this` parameter\'.\r\n\r\n    // This is not the complete set of editor methods. Most of the\r\n    // methods defined on the Doc type are also injected into\r\n    // CodeMirror.prototype, for backwards compatibility and\r\n    // convenience.\r\n\r\n    function addEditorMethods(CodeMirror) {\r\n        var optionHandlers = CodeMirror.optionHandlers;\r\n\r\n        var helpers = CodeMirror.helpers = {};\r\n\r\n        CodeMirror.prototype = {\r\n            constructor: CodeMirror,\r\n            focus: function(){window.focus(); this.display.input.focus();},\r\n\r\n            setOption: function(option, value) {\r\n                var options = this.options, old = options[option];\r\n                if (options[option] == value && option != "mode") { return }\r\n                options[option] = value;\r\n                if (optionHandlers.hasOwnProperty(option))\r\n                { operation(this, optionHandlers[option])(this, value, old); }\r\n                signal(this, "optionChange", this, option);\r\n            },\r\n\r\n            getOption: function(option) {return this.options[option]},\r\n            getDoc: function() {return this.doc},\r\n\r\n            addKeyMap: function(map$$1, bottom) {\r\n                this.state.keyMaps[bottom ? "push" : "unshift"](getKeyMap(map$$1));\r\n            },\r\n            removeKeyMap: function(map$$1) {\r\n                var maps = this.state.keyMaps;\r\n                for (var i = 0; i < maps.length; ++i)\r\n                { if (maps[i] == map$$1 || maps[i].name == map$$1) {\r\n                    maps.splice(i, 1);\r\n                    return true\r\n                } }\r\n            },\r\n\r\n            addOverlay: methodOp(function(spec, options) {\r\n                var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);\r\n                if (mode.startState) { throw new Error("Overlays may not be stateful.") }\r\n                insertSorted(this.state.overlays,\r\n                    {mode: mode, modeSpec: spec, opaque: options && options.opaque,\r\n                        priority: (options && options.priority) || 0},\r\n                    function (overlay) { return overlay.priority; });\r\n                this.state.modeGen++;\r\n                regChange(this);\r\n            }),\r\n            removeOverlay: methodOp(function(spec) {\r\n                var overlays = this.state.overlays;\r\n                for (var i = 0; i < overlays.length; ++i) {\r\n                    var cur = overlays[i].modeSpec;\r\n                    if (cur == spec || typeof spec == "string" && cur.name == spec) {\r\n                        overlays.splice(i, 1);\r\n                        this.state.modeGen++;\r\n                        regChange(this);\r\n                        return\r\n                    }\r\n                }\r\n            }),\r\n\r\n            indentLine: methodOp(function(n, dir, aggressive) {\r\n                if (typeof dir != "string" && typeof dir != "number") {\r\n                    if (dir == null) { dir = this.options.smartIndent ? "smart" : "prev"; }\r\n                    else { dir = dir ? "add" : "subtract"; }\r\n                }\r\n                if (isLine(this.doc, n)) { indentLine(this, n, dir, aggressive); }\r\n            }),\r\n            indentSelection: methodOp(function(how) {\r\n                var ranges = this.doc.sel.ranges, end = -1;\r\n                for (var i = 0; i < ranges.length; i++) {\r\n                    var range$$1 = ranges[i];\r\n                    if (!range$$1.empty()) {\r\n                        var from = range$$1.from(), to = range$$1.to();\r\n                        var start = Math.max(end, from.line);\r\n                        end = Math.min(this.lastLine(), to.line - (to.ch ? 0 : 1)) + 1;\r\n                        for (var j = start; j < end; ++j)\r\n                        { indentLine(this, j, how); }\r\n                        var newRanges = this.doc.sel.ranges;\r\n                        if (from.ch == 0 && ranges.length == newRanges.length && newRanges[i].from().ch > 0)\r\n                        { replaceOneSelection(this.doc, i, new Range(from, newRanges[i].to()), sel_dontScroll); }\r\n                    } else if (range$$1.head.line > end) {\r\n                        indentLine(this, range$$1.head.line, how, true);\r\n                        end = range$$1.head.line;\r\n                        if (i == this.doc.sel.primIndex) { ensureCursorVisible(this); }\r\n                    }\r\n                }\r\n            }),\r\n\r\n            // Fetch the parser token for a given character. Useful for hacks\r\n            // that want to inspect the mode state (say, for completion).\r\n            getTokenAt: function(pos, precise) {\r\n                return takeToken(this, pos, precise)\r\n            },\r\n\r\n            getLineTokens: function(line, precise) {\r\n                return takeToken(this, Pos(line), precise, true)\r\n            },\r\n\r\n            getTokenTypeAt: function(pos) {\r\n                pos = clipPos(this.doc, pos);\r\n                var styles = getLineStyles(this, getLine(this.doc, pos.line));\r\n                var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;\r\n                var type;\r\n                if (ch == 0) { type = styles[2]; }\r\n                else { for (;;) {\r\n                    var mid = (before + after) >> 1;\r\n                    if ((mid ? styles[mid * 2 - 1] : 0) >= ch) { after = mid; }\r\n                    else if (styles[mid * 2 + 1] < ch) { before = mid + 1; }\r\n                    else { type = styles[mid * 2 + 2]; break }\r\n                } }\r\n                var cut = type ? type.indexOf("overlay ") : -1;\r\n                return cut < 0 ? type : cut == 0 ? null : type.slice(0, cut - 1)\r\n            },\r\n\r\n            getModeAt: function(pos) {\r\n                var mode = this.doc.mode;\r\n                if (!mode.innerMode) { return mode }\r\n                return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode\r\n            },\r\n\r\n            getHelper: function(pos, type) {\r\n                return this.getHelpers(pos, type)[0]\r\n            },\r\n\r\n            getHelpers: function(pos, type) {\r\n                var found = [];\r\n                if (!helpers.hasOwnProperty(type)) { return found }\r\n                var help = helpers[type], mode = this.getModeAt(pos);\r\n                if (typeof mode[type] == "string") {\r\n                    if (help[mode[type]]) { found.push(help[mode[type]]); }\r\n                } else if (mode[type]) {\r\n                    for (var i = 0; i < mode[type].length; i++) {\r\n                        var val = help[mode[type][i]];\r\n                        if (val) { found.push(val); }\r\n                    }\r\n                } else if (mode.helperType && help[mode.helperType]) {\r\n                    found.push(help[mode.helperType]);\r\n                } else if (help[mode.name]) {\r\n                    found.push(help[mode.name]);\r\n                }\r\n                for (var i$1 = 0; i$1 < help._global.length; i$1++) {\r\n                    var cur = help._global[i$1];\r\n                    if (cur.pred(mode, this) && indexOf(found, cur.val) == -1)\r\n                    { found.push(cur.val); }\r\n                }\r\n                return found\r\n            },\r\n\r\n            getStateAfter: function(line, precise) {\r\n                var doc = this.doc;\r\n                line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);\r\n                return getContextBefore(this, line + 1, precise).state\r\n            },\r\n\r\n            cursorCoords: function(start, mode) {\r\n                var pos, range$$1 = this.doc.sel.primary();\r\n                if (start == null) { pos = range$$1.head; }\r\n                else if (typeof start == "object") { pos = clipPos(this.doc, start); }\r\n                else { pos = start ? range$$1.from() : range$$1.to(); }\r\n                return cursorCoords(this, pos, mode || "page")\r\n            },\r\n\r\n            charCoords: function(pos, mode) {\r\n                return charCoords(this, clipPos(this.doc, pos), mode || "page")\r\n            },\r\n\r\n            coordsChar: function(coords, mode) {\r\n                coords = fromCoordSystem(this, coords, mode || "page");\r\n                return coordsChar(this, coords.left, coords.top)\r\n            },\r\n\r\n            lineAtHeight: function(height, mode) {\r\n                height = fromCoordSystem(this, {top: height, left: 0}, mode || "page").top;\r\n                return lineAtHeight(this.doc, height + this.display.viewOffset)\r\n            },\r\n            heightAtLine: function(line, mode, includeWidgets) {\r\n                var end = false, lineObj;\r\n                if (typeof line == "number") {\r\n                    var last = this.doc.first + this.doc.size - 1;\r\n                    if (line < this.doc.first) { line = this.doc.first; }\r\n                    else if (line > last) { line = last; end = true; }\r\n                    lineObj = getLine(this.doc, line);\r\n                } else {\r\n                    lineObj = line;\r\n                }\r\n                return intoCoordSystem(this, lineObj, {top: 0, left: 0}, mode || "page", includeWidgets || end).top +\r\n                    (end ? this.doc.height - heightAtLine(lineObj) : 0)\r\n            },\r\n\r\n            defaultTextHeight: function() { return textHeight(this.display) },\r\n            defaultCharWidth: function() { return charWidth(this.display) },\r\n\r\n            getViewport: function() { return {from: this.display.viewFrom, to: this.display.viewTo}},\r\n\r\n            addWidget: function(pos, node, scroll, vert, horiz) {\r\n                var display = this.display;\r\n                pos = cursorCoords(this, clipPos(this.doc, pos));\r\n                var top = pos.bottom, left = pos.left;\r\n                node.style.position = "absolute";\r\n                node.setAttribute("cm-ignore-events", "true");\r\n                this.display.input.setUneditable(node);\r\n                display.sizer.appendChild(node);\r\n                if (vert == "over") {\r\n                    top = pos.top;\r\n                } else if (vert == "above" || vert == "near") {\r\n                    var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),\r\n                        hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);\r\n                    // Default to positioning above (if specified and possible); otherwise default to positioning below\r\n                    if ((vert == \'above\' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)\r\n                    { top = pos.top - node.offsetHeight; }\r\n                    else if (pos.bottom + node.offsetHeight <= vspace)\r\n                    { top = pos.bottom; }\r\n                    if (left + node.offsetWidth > hspace)\r\n                    { left = hspace - node.offsetWidth; }\r\n                }\r\n                node.style.top = top + "px";\r\n                node.style.left = node.style.right = "";\r\n                if (horiz == "right") {\r\n                    left = display.sizer.clientWidth - node.offsetWidth;\r\n                    node.style.right = "0px";\r\n                } else {\r\n                    if (horiz == "left") { left = 0; }\r\n                    else if (horiz == "middle") { left = (display.sizer.clientWidth - node.offsetWidth) / 2; }\r\n                    node.style.left = left + "px";\r\n                }\r\n                if (scroll)\r\n                { scrollIntoView(this, {left: left, top: top, right: left + node.offsetWidth, bottom: top + node.offsetHeight}); }\r\n            },\r\n\r\n            triggerOnKeyDown: methodOp(onKeyDown),\r\n            triggerOnKeyPress: methodOp(onKeyPress),\r\n            triggerOnKeyUp: onKeyUp,\r\n            triggerOnMouseDown: methodOp(onMouseDown),\r\n\r\n            execCommand: function(cmd) {\r\n                if (commands.hasOwnProperty(cmd))\r\n                { return commands[cmd].call(null, this) }\r\n            },\r\n\r\n            triggerElectric: methodOp(function(text) { triggerElectric(this, text); }),\r\n\r\n            findPosH: function(from, amount, unit, visually) {\r\n                var dir = 1;\r\n                if (amount < 0) { dir = -1; amount = -amount; }\r\n                var cur = clipPos(this.doc, from);\r\n                for (var i = 0; i < amount; ++i) {\r\n                    cur = findPosH(this.doc, cur, dir, unit, visually);\r\n                    if (cur.hitSide) { break }\r\n                }\r\n                return cur\r\n            },\r\n\r\n            moveH: methodOp(function(dir, unit) {\r\n                var this$1 = this;\r\n\r\n                this.extendSelectionsBy(function (range$$1) {\r\n                    if (this$1.display.shift || this$1.doc.extend || range$$1.empty())\r\n                    { return findPosH(this$1.doc, range$$1.head, dir, unit, this$1.options.rtlMoveVisually) }\r\n                    else\r\n                    { return dir < 0 ? range$$1.from() : range$$1.to() }\r\n                }, sel_move);\r\n            }),\r\n\r\n            deleteH: methodOp(function(dir, unit) {\r\n                var sel = this.doc.sel, doc = this.doc;\r\n                if (sel.somethingSelected())\r\n                { doc.replaceSelection("", null, "+delete"); }\r\n                else\r\n                { deleteNearSelection(this, function (range$$1) {\r\n                    var other = findPosH(doc, range$$1.head, dir, unit, false);\r\n                    return dir < 0 ? {from: other, to: range$$1.head} : {from: range$$1.head, to: other}\r\n                }); }\r\n            }),\r\n\r\n            findPosV: function(from, amount, unit, goalColumn) {\r\n                var dir = 1, x = goalColumn;\r\n                if (amount < 0) { dir = -1; amount = -amount; }\r\n                var cur = clipPos(this.doc, from);\r\n                for (var i = 0; i < amount; ++i) {\r\n                    var coords = cursorCoords(this, cur, "div");\r\n                    if (x == null) { x = coords.left; }\r\n                    else { coords.left = x; }\r\n                    cur = findPosV(this, coords, dir, unit);\r\n                    if (cur.hitSide) { break }\r\n                }\r\n                return cur\r\n            },\r\n\r\n            moveV: methodOp(function(dir, unit) {\r\n                var this$1 = this;\r\n\r\n                var doc = this.doc, goals = [];\r\n                var collapse = !this.display.shift && !doc.extend && doc.sel.somethingSelected();\r\n                doc.extendSelectionsBy(function (range$$1) {\r\n                    if (collapse)\r\n                    { return dir < 0 ? range$$1.from() : range$$1.to() }\r\n                    var headPos = cursorCoords(this$1, range$$1.head, "div");\r\n                    if (range$$1.goalColumn != null) { headPos.left = range$$1.goalColumn; }\r\n                    goals.push(headPos.left);\r\n                    var pos = findPosV(this$1, headPos, dir, unit);\r\n                    if (unit == "page" && range$$1 == doc.sel.primary())\r\n                    { addToScrollTop(this$1, charCoords(this$1, pos, "div").top - headPos.top); }\r\n                    return pos\r\n                }, sel_move);\r\n                if (goals.length) { for (var i = 0; i < doc.sel.ranges.length; i++)\r\n                { doc.sel.ranges[i].goalColumn = goals[i]; } }\r\n            }),\r\n\r\n            // Find the word at the given position (as returned by coordsChar).\r\n            findWordAt: function(pos) {\r\n                var doc = this.doc, line = getLine(doc, pos.line).text;\r\n                var start = pos.ch, end = pos.ch;\r\n                if (line) {\r\n                    var helper = this.getHelper(pos, "wordChars");\r\n                    if ((pos.sticky == "before" || end == line.length) && start) { --start; } else { ++end; }\r\n                    var startChar = line.charAt(start);\r\n                    var check = isWordChar(startChar, helper)\r\n                        ? function (ch) { return isWordChar(ch, helper); }\r\n                        : /\\s/.test(startChar) ? function (ch) { return /\\s/.test(ch); }\r\n                            : function (ch) { return (!/\\s/.test(ch) && !isWordChar(ch)); };\r\n                    while (start > 0 && check(line.charAt(start - 1))) { --start; }\r\n                    while (end < line.length && check(line.charAt(end))) { ++end; }\r\n                }\r\n                return new Range(Pos(pos.line, start), Pos(pos.line, end))\r\n            },\r\n\r\n            toggleOverwrite: function(value) {\r\n                if (value != null && value == this.state.overwrite) { return }\r\n                if (this.state.overwrite = !this.state.overwrite)\r\n                { addClass(this.display.cursorDiv, "CodeMirror-overwrite"); }\r\n                else\r\n                { rmClass(this.display.cursorDiv, "CodeMirror-overwrite"); }\r\n\r\n                signal(this, "overwriteToggle", this, this.state.overwrite);\r\n            },\r\n            hasFocus: function() { return this.display.input.getField() == activeElt() },\r\n            isReadOnly: function() { return !!(this.options.readOnly || this.doc.cantEdit) },\r\n\r\n            scrollTo: methodOp(function (x, y) { scrollToCoords(this, x, y); }),\r\n            getScrollInfo: function() {\r\n                var scroller = this.display.scroller;\r\n                return {left: scroller.scrollLeft, top: scroller.scrollTop,\r\n                    height: scroller.scrollHeight - scrollGap(this) - this.display.barHeight,\r\n                    width: scroller.scrollWidth - scrollGap(this) - this.display.barWidth,\r\n                    clientHeight: displayHeight(this), clientWidth: displayWidth(this)}\r\n            },\r\n\r\n            scrollIntoView: methodOp(function(range$$1, margin) {\r\n                if (range$$1 == null) {\r\n                    range$$1 = {from: this.doc.sel.primary().head, to: null};\r\n                    if (margin == null) { margin = this.options.cursorScrollMargin; }\r\n                } else if (typeof range$$1 == "number") {\r\n                    range$$1 = {from: Pos(range$$1, 0), to: null};\r\n                } else if (range$$1.from == null) {\r\n                    range$$1 = {from: range$$1, to: null};\r\n                }\r\n                if (!range$$1.to) { range$$1.to = range$$1.from; }\r\n                range$$1.margin = margin || 0;\r\n\r\n                if (range$$1.from.line != null) {\r\n                    scrollToRange(this, range$$1);\r\n                } else {\r\n                    scrollToCoordsRange(this, range$$1.from, range$$1.to, range$$1.margin);\r\n                }\r\n            }),\r\n\r\n            setSize: methodOp(function(width, height) {\r\n                var this$1 = this;\r\n\r\n                var interpret = function (val) { return typeof val == "number" || /^\\d+$/.test(String(val)) ? val + "px" : val; };\r\n                if (width != null) { this.display.wrapper.style.width = interpret(width); }\r\n                if (height != null) { this.display.wrapper.style.height = interpret(height); }\r\n                if (this.options.lineWrapping) { clearLineMeasurementCache(this); }\r\n                var lineNo$$1 = this.display.viewFrom;\r\n                this.doc.iter(lineNo$$1, this.display.viewTo, function (line) {\r\n                    if (line.widgets) { for (var i = 0; i < line.widgets.length; i++)\r\n                    { if (line.widgets[i].noHScroll) { regLineChange(this$1, lineNo$$1, "widget"); break } } }\r\n                    ++lineNo$$1;\r\n                });\r\n                this.curOp.forceUpdate = true;\r\n                signal(this, "refresh", this);\r\n            }),\r\n\r\n            operation: function(f){return runInOp(this, f)},\r\n            startOperation: function(){return startOperation(this)},\r\n            endOperation: function(){return endOperation(this)},\r\n\r\n            refresh: methodOp(function() {\r\n                var oldHeight = this.display.cachedTextHeight;\r\n                regChange(this);\r\n                this.curOp.forceUpdate = true;\r\n                clearCaches(this);\r\n                scrollToCoords(this, this.doc.scrollLeft, this.doc.scrollTop);\r\n                updateGutterSpace(this);\r\n                if (oldHeight == null || Math.abs(oldHeight - textHeight(this.display)) > .5)\r\n                { estimateLineHeights(this); }\r\n                signal(this, "refresh", this);\r\n            }),\r\n\r\n            swapDoc: methodOp(function(doc) {\r\n                var old = this.doc;\r\n                old.cm = null;\r\n                attachDoc(this, doc);\r\n                clearCaches(this);\r\n                this.display.input.reset();\r\n                scrollToCoords(this, doc.scrollLeft, doc.scrollTop);\r\n                this.curOp.forceScroll = true;\r\n                signalLater(this, "swapDoc", this, old);\r\n                return old\r\n            }),\r\n\r\n            phrase: function(phraseText) {\r\n                var phrases = this.options.phrases;\r\n                return phrases && Object.prototype.hasOwnProperty.call(phrases, phraseText) ? phrases[phraseText] : phraseText\r\n            },\r\n\r\n            getInputField: function(){return this.display.input.getField()},\r\n            getWrapperElement: function(){return this.display.wrapper},\r\n            getScrollerElement: function(){return this.display.scroller},\r\n            getGutterElement: function(){return this.display.gutters}\r\n        };\r\n        eventMixin(CodeMirror);\r\n\r\n        CodeMirror.registerHelper = function(type, name, value) {\r\n            if (!helpers.hasOwnProperty(type)) { helpers[type] = CodeMirror[type] = {_global: []}; }\r\n            helpers[type][name] = value;\r\n        };\r\n        CodeMirror.registerGlobalHelper = function(type, name, predicate, value) {\r\n            CodeMirror.registerHelper(type, name, value);\r\n            helpers[type]._global.push({pred: predicate, val: value});\r\n        };\r\n    }\r\n\r\n    // Used for horizontal relative motion. Dir is -1 or 1 (left or\r\n    // right), unit can be "char", "column" (like char, but doesn\'t\r\n    // cross line boundaries), "word" (across next word), or "group" (to\r\n    // the start of next group of word or non-word-non-whitespace\r\n    // chars). The visually param controls whether, in right-to-left\r\n    // text, direction 1 means to move towards the next index in the\r\n    // string, or towards the character to the right of the current\r\n    // position. The resulting position will have a hitSide=true\r\n    // property if it reached the end of the document.\r\n    function findPosH(doc, pos, dir, unit, visually) {\r\n        var oldPos = pos;\r\n        var origDir = dir;\r\n        var lineObj = getLine(doc, pos.line);\r\n        function findNextLine() {\r\n            var l = pos.line + dir;\r\n            if (l < doc.first || l >= doc.first + doc.size) { return false }\r\n            pos = new Pos(l, pos.ch, pos.sticky);\r\n            return lineObj = getLine(doc, l)\r\n        }\r\n        function moveOnce(boundToLine) {\r\n            var next;\r\n            if (visually) {\r\n                next = moveVisually(doc.cm, lineObj, pos, dir);\r\n            } else {\r\n                next = moveLogically(lineObj, pos, dir);\r\n            }\r\n            if (next == null) {\r\n                if (!boundToLine && findNextLine())\r\n                { pos = endOfLine(visually, doc.cm, lineObj, pos.line, dir); }\r\n                else\r\n                { return false }\r\n            } else {\r\n                pos = next;\r\n            }\r\n            return true\r\n        }\r\n\r\n        if (unit == "char") {\r\n            moveOnce();\r\n        } else if (unit == "column") {\r\n            moveOnce(true);\r\n        } else if (unit == "word" || unit == "group") {\r\n            var sawType = null, group = unit == "group";\r\n            var helper = doc.cm && doc.cm.getHelper(pos, "wordChars");\r\n            for (var first = true;; first = false) {\r\n                if (dir < 0 && !moveOnce(!first)) { break }\r\n                var cur = lineObj.text.charAt(pos.ch) || "\\n";\r\n                var type = isWordChar(cur, helper) ? "w"\r\n                    : group && cur == "\\n" ? "n"\r\n                        : !group || /\\s/.test(cur) ? null\r\n                            : "p";\r\n                if (group && !first && !type) { type = "s"; }\r\n                if (sawType && sawType != type) {\r\n                    if (dir < 0) {dir = 1; moveOnce(); pos.sticky = "after";}\r\n                    break\r\n                }\r\n\r\n                if (type) { sawType = type; }\r\n                if (dir > 0 && !moveOnce(!first)) { break }\r\n            }\r\n        }\r\n        var result = skipAtomic(doc, pos, oldPos, origDir, true);\r\n        if (equalCursorPos(oldPos, result)) { result.hitSide = true; }\r\n        return result\r\n    }\r\n\r\n    // For relative vertical movement. Dir may be -1 or 1. Unit can be\r\n    // "page" or "line". The resulting position will have a hitSide=true\r\n    // property if it reached the end of the document.\r\n    function findPosV(cm, pos, dir, unit) {\r\n        var doc = cm.doc, x = pos.left, y;\r\n        if (unit == "page") {\r\n            var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);\r\n            var moveAmount = Math.max(pageSize - .5 * textHeight(cm.display), 3);\r\n            y = (dir > 0 ? pos.bottom : pos.top) + dir * moveAmount;\r\n\r\n        } else if (unit == "line") {\r\n            y = dir > 0 ? pos.bottom + 3 : pos.top - 3;\r\n        }\r\n        var target;\r\n        for (;;) {\r\n            target = coordsChar(cm, x, y);\r\n            if (!target.outside) { break }\r\n            if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break }\r\n            y += dir * 5;\r\n        }\r\n        return target\r\n    }\r\n\r\n    // CONTENTEDITABLE INPUT STYLE\r\n\r\n    var ContentEditableInput = function(cm) {\r\n        this.cm = cm;\r\n        this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null;\r\n        this.polling = new Delayed();\r\n        this.composing = null;\r\n        this.gracePeriod = false;\r\n        this.readDOMTimeout = null;\r\n    };\r\n\r\n    ContentEditableInput.prototype.init = function (display) {\r\n        var this$1 = this;\r\n\r\n        var input = this, cm = input.cm;\r\n        var div = input.div = display.lineDiv;\r\n        disableBrowserMagic(div, cm.options.spellcheck);\r\n\r\n        on(div, "paste", function (e) {\r\n            if (signalDOMEvent(cm, e) || handlePaste(e, cm)) { return }\r\n            // IE doesn\'t fire input events, so we schedule a read for the pasted content in this way\r\n            if (ie_version <= 11) { setTimeout(operation(cm, function () { return this$1.updateFromDOM(); }), 20); }\r\n        });\r\n\r\n        on(div, "compositionstart", function (e) {\r\n            this$1.composing = {data: e.data, done: false};\r\n        });\r\n        on(div, "compositionupdate", function (e) {\r\n            if (!this$1.composing) { this$1.composing = {data: e.data, done: false}; }\r\n        });\r\n        on(div, "compositionend", function (e) {\r\n            if (this$1.composing) {\r\n                if (e.data != this$1.composing.data) { this$1.readFromDOMSoon(); }\r\n                this$1.composing.done = true;\r\n            }\r\n        });\r\n\r\n        on(div, "touchstart", function () { return input.forceCompositionEnd(); });\r\n\r\n        on(div, "input", function () {\r\n            if (!this$1.composing) { this$1.readFromDOMSoon(); }\r\n        });\r\n\r\n        function onCopyCut(e) {\r\n            if (signalDOMEvent(cm, e)) { return }\r\n            if (cm.somethingSelected()) {\r\n                setLastCopied({lineWise: false, text: cm.getSelections()});\r\n                if (e.type == "cut") { cm.replaceSelection("", null, "cut"); }\r\n            } else if (!cm.options.lineWiseCopyCut) {\r\n                return\r\n            } else {\r\n                var ranges = copyableRanges(cm);\r\n                setLastCopied({lineWise: true, text: ranges.text});\r\n                if (e.type == "cut") {\r\n                    cm.operation(function () {\r\n                        cm.setSelections(ranges.ranges, 0, sel_dontScroll);\r\n                        cm.replaceSelection("", null, "cut");\r\n                    });\r\n                }\r\n            }\r\n            if (e.clipboardData) {\r\n                e.clipboardData.clearData();\r\n                var content = lastCopied.text.join("\\n");\r\n                // iOS exposes the clipboard API, but seems to discard content inserted into it\r\n                e.clipboardData.setData("Text", content);\r\n                if (e.clipboardData.getData("Text") == content) {\r\n                    e.preventDefault();\r\n                    return\r\n                }\r\n            }\r\n            // Old-fashioned briefly-focus-a-textarea hack\r\n            var kludge = hiddenTextarea(), te = kludge.firstChild;\r\n            cm.display.lineSpace.insertBefore(kludge, cm.display.lineSpace.firstChild);\r\n            te.value = lastCopied.text.join("\\n");\r\n            var hadFocus = document.activeElement;\r\n            selectInput(te);\r\n            setTimeout(function () {\r\n                cm.display.lineSpace.removeChild(kludge);\r\n                hadFocus.focus();\r\n                if (hadFocus == div) { input.showPrimarySelection(); }\r\n            }, 50);\r\n        }\r\n        on(div, "copy", onCopyCut);\r\n        on(div, "cut", onCopyCut);\r\n    };\r\n\r\n    ContentEditableInput.prototype.prepareSelection = function () {\r\n        var result = prepareSelection(this.cm, false);\r\n        result.focus = this.cm.state.focused;\r\n        return result\r\n    };\r\n\r\n    ContentEditableInput.prototype.showSelection = function (info, takeFocus) {\r\n        if (!info || !this.cm.display.view.length) { return }\r\n        if (info.focus || takeFocus) { this.showPrimarySelection(); }\r\n        this.showMultipleSelections(info);\r\n    };\r\n\r\n    ContentEditableInput.prototype.getSelection = function () {\r\n        return this.cm.display.wrapper.ownerDocument.getSelection()\r\n    };\r\n\r\n    ContentEditableInput.prototype.showPrimarySelection = function () {\r\n        var sel = this.getSelection(), cm = this.cm, prim = cm.doc.sel.primary();\r\n        var from = prim.from(), to = prim.to();\r\n\r\n        if (cm.display.viewTo == cm.display.viewFrom || from.line >= cm.display.viewTo || to.line < cm.display.viewFrom) {\r\n            sel.removeAllRanges();\r\n            return\r\n        }\r\n\r\n        var curAnchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);\r\n        var curFocus = domToPos(cm, sel.focusNode, sel.focusOffset);\r\n        if (curAnchor && !curAnchor.bad && curFocus && !curFocus.bad &&\r\n            cmp(minPos(curAnchor, curFocus), from) == 0 &&\r\n            cmp(maxPos(curAnchor, curFocus), to) == 0)\r\n        { return }\r\n\r\n        var view = cm.display.view;\r\n        var start = (from.line >= cm.display.viewFrom && posToDOM(cm, from)) ||\r\n            {node: view[0].measure.map[2], offset: 0};\r\n        var end = to.line < cm.display.viewTo && posToDOM(cm, to);\r\n        if (!end) {\r\n            var measure = view[view.length - 1].measure;\r\n            var map$$1 = measure.maps ? measure.maps[measure.maps.length - 1] : measure.map;\r\n            end = {node: map$$1[map$$1.length - 1], offset: map$$1[map$$1.length - 2] - map$$1[map$$1.length - 3]};\r\n        }\r\n\r\n        if (!start || !end) {\r\n            sel.removeAllRanges();\r\n            return\r\n        }\r\n\r\n        var old = sel.rangeCount && sel.getRangeAt(0), rng;\r\n        try { rng = range(start.node, start.offset, end.offset, end.node); }\r\n        catch(e) {} // Our model of the DOM might be outdated, in which case the range we try to set can be impossible\r\n        if (rng) {\r\n            if (!gecko && cm.state.focused) {\r\n                sel.collapse(start.node, start.offset);\r\n                if (!rng.collapsed) {\r\n                    sel.removeAllRanges();\r\n                    sel.addRange(rng);\r\n                }\r\n            } else {\r\n                sel.removeAllRanges();\r\n                sel.addRange(rng);\r\n            }\r\n            if (old && sel.anchorNode == null) { sel.addRange(old); }\r\n            else if (gecko) { this.startGracePeriod(); }\r\n        }\r\n        this.rememberSelection();\r\n    };\r\n\r\n    ContentEditableInput.prototype.startGracePeriod = function () {\r\n        var this$1 = this;\r\n\r\n        clearTimeout(this.gracePeriod);\r\n        this.gracePeriod = setTimeout(function () {\r\n            this$1.gracePeriod = false;\r\n            if (this$1.selectionChanged())\r\n            { this$1.cm.operation(function () { return this$1.cm.curOp.selectionChanged = true; }); }\r\n        }, 20);\r\n    };\r\n\r\n    ContentEditableInput.prototype.showMultipleSelections = function (info) {\r\n        removeChildrenAndAdd(this.cm.display.cursorDiv, info.cursors);\r\n        removeChildrenAndAdd(this.cm.display.selectionDiv, info.selection);\r\n    };\r\n\r\n    ContentEditableInput.prototype.rememberSelection = function () {\r\n        var sel = this.getSelection();\r\n        this.lastAnchorNode = sel.anchorNode; this.lastAnchorOffset = sel.anchorOffset;\r\n        this.lastFocusNode = sel.focusNode; this.lastFocusOffset = sel.focusOffset;\r\n    };\r\n\r\n    ContentEditableInput.prototype.selectionInEditor = function () {\r\n        var sel = this.getSelection();\r\n        if (!sel.rangeCount) { return false }\r\n        var node = sel.getRangeAt(0).commonAncestorContainer;\r\n        return contains(this.div, node)\r\n    };\r\n\r\n    ContentEditableInput.prototype.focus = function () {\r\n        if (this.cm.options.readOnly != "nocursor") {\r\n            if (!this.selectionInEditor())\r\n            { this.showSelection(this.prepareSelection(), true); }\r\n            this.div.focus();\r\n        }\r\n    };\r\n    ContentEditableInput.prototype.blur = function () { this.div.blur(); };\r\n    ContentEditableInput.prototype.getField = function () { return this.div };\r\n\r\n    ContentEditableInput.prototype.supportsTouch = function () { return true };\r\n\r\n    ContentEditableInput.prototype.receivedFocus = function () {\r\n        var input = this;\r\n        if (this.selectionInEditor())\r\n        { this.pollSelection(); }\r\n        else\r\n        { runInOp(this.cm, function () { return input.cm.curOp.selectionChanged = true; }); }\r\n\r\n        function poll() {\r\n            if (input.cm.state.focused) {\r\n                input.pollSelection();\r\n                input.polling.set(input.cm.options.pollInterval, poll);\r\n            }\r\n        }\r\n        this.polling.set(this.cm.options.pollInterval, poll);\r\n    };\r\n\r\n    ContentEditableInput.prototype.selectionChanged = function () {\r\n        var sel = this.getSelection();\r\n        return sel.anchorNode != this.lastAnchorNode || sel.anchorOffset != this.lastAnchorOffset ||\r\n            sel.focusNode != this.lastFocusNode || sel.focusOffset != this.lastFocusOffset\r\n    };\r\n\r\n    ContentEditableInput.prototype.pollSelection = function () {\r\n        if (this.readDOMTimeout != null || this.gracePeriod || !this.selectionChanged()) { return }\r\n        var sel = this.getSelection(), cm = this.cm;\r\n        // On Android Chrome (version 56, at least), backspacing into an\r\n        // uneditable block element will put the cursor in that element,\r\n        // and then, because it\'s not editable, hide the virtual keyboard.\r\n        // Because Android doesn\'t allow us to actually detect backspace\r\n        // presses in a sane way, this code checks for when that happens\r\n        // and simulates a backspace press in this case.\r\n        if (android && chrome && this.cm.options.gutters.length && isInGutter(sel.anchorNode)) {\r\n            this.cm.triggerOnKeyDown({type: "keydown", keyCode: 8, preventDefault: Math.abs});\r\n            this.blur();\r\n            this.focus();\r\n            return\r\n        }\r\n        if (this.composing) { return }\r\n        this.rememberSelection();\r\n        var anchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);\r\n        var head = domToPos(cm, sel.focusNode, sel.focusOffset);\r\n        if (anchor && head) { runInOp(cm, function () {\r\n            setSelection(cm.doc, simpleSelection(anchor, head), sel_dontScroll);\r\n            if (anchor.bad || head.bad) { cm.curOp.selectionChanged = true; }\r\n        }); }\r\n    };\r\n\r\n    ContentEditableInput.prototype.pollContent = function () {\r\n        if (this.readDOMTimeout != null) {\r\n            clearTimeout(this.readDOMTimeout);\r\n            this.readDOMTimeout = null;\r\n        }\r\n\r\n        var cm = this.cm, display = cm.display, sel = cm.doc.sel.primary();\r\n        var from = sel.from(), to = sel.to();\r\n        if (from.ch == 0 && from.line > cm.firstLine())\r\n        { from = Pos(from.line - 1, getLine(cm.doc, from.line - 1).length); }\r\n        if (to.ch == getLine(cm.doc, to.line).text.length && to.line < cm.lastLine())\r\n        { to = Pos(to.line + 1, 0); }\r\n        if (from.line < display.viewFrom || to.line > display.viewTo - 1) { return false }\r\n\r\n        var fromIndex, fromLine, fromNode;\r\n        if (from.line == display.viewFrom || (fromIndex = findViewIndex(cm, from.line)) == 0) {\r\n            fromLine = lineNo(display.view[0].line);\r\n            fromNode = display.view[0].node;\r\n        } else {\r\n            fromLine = lineNo(display.view[fromIndex].line);\r\n            fromNode = display.view[fromIndex - 1].node.nextSibling;\r\n        }\r\n        var toIndex = findViewIndex(cm, to.line);\r\n        var toLine, toNode;\r\n        if (toIndex == display.view.length - 1) {\r\n            toLine = display.viewTo - 1;\r\n            toNode = display.lineDiv.lastChild;\r\n        } else {\r\n            toLine = lineNo(display.view[toIndex + 1].line) - 1;\r\n            toNode = display.view[toIndex + 1].node.previousSibling;\r\n        }\r\n\r\n        if (!fromNode) { return false }\r\n        var newText = cm.doc.splitLines(domTextBetween(cm, fromNode, toNode, fromLine, toLine));\r\n        var oldText = getBetween(cm.doc, Pos(fromLine, 0), Pos(toLine, getLine(cm.doc, toLine).text.length));\r\n        while (newText.length > 1 && oldText.length > 1) {\r\n            if (lst(newText) == lst(oldText)) { newText.pop(); oldText.pop(); toLine--; }\r\n            else if (newText[0] == oldText[0]) { newText.shift(); oldText.shift(); fromLine++; }\r\n            else { break }\r\n        }\r\n\r\n        var cutFront = 0, cutEnd = 0;\r\n        var newTop = newText[0], oldTop = oldText[0], maxCutFront = Math.min(newTop.length, oldTop.length);\r\n        while (cutFront < maxCutFront && newTop.charCodeAt(cutFront) == oldTop.charCodeAt(cutFront))\r\n        { ++cutFront; }\r\n        var newBot = lst(newText), oldBot = lst(oldText);\r\n        var maxCutEnd = Math.min(newBot.length - (newText.length == 1 ? cutFront : 0),\r\n            oldBot.length - (oldText.length == 1 ? cutFront : 0));\r\n        while (cutEnd < maxCutEnd &&\r\n        newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1))\r\n        { ++cutEnd; }\r\n        // Try to move start of change to start of selection if ambiguous\r\n        if (newText.length == 1 && oldText.length == 1 && fromLine == from.line) {\r\n            while (cutFront && cutFront > from.ch &&\r\n            newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1)) {\r\n                cutFront--;\r\n                cutEnd++;\r\n            }\r\n        }\r\n\r\n        newText[newText.length - 1] = newBot.slice(0, newBot.length - cutEnd).replace(/^\\u200b+/, "");\r\n        newText[0] = newText[0].slice(cutFront).replace(/\\u200b+$/, "");\r\n\r\n        var chFrom = Pos(fromLine, cutFront);\r\n        var chTo = Pos(toLine, oldText.length ? lst(oldText).length - cutEnd : 0);\r\n        if (newText.length > 1 || newText[0] || cmp(chFrom, chTo)) {\r\n            replaceRange(cm.doc, newText, chFrom, chTo, "+input");\r\n            return true\r\n        }\r\n    };\r\n\r\n    ContentEditableInput.prototype.ensurePolled = function () {\r\n        this.forceCompositionEnd();\r\n    };\r\n    ContentEditableInput.prototype.reset = function () {\r\n        this.forceCompositionEnd();\r\n    };\r\n    ContentEditableInput.prototype.forceCompositionEnd = function () {\r\n        if (!this.composing) { return }\r\n        clearTimeout(this.readDOMTimeout);\r\n        this.composing = null;\r\n        this.updateFromDOM();\r\n        this.div.blur();\r\n        this.div.focus();\r\n    };\r\n    ContentEditableInput.prototype.readFromDOMSoon = function () {\r\n        var this$1 = this;\r\n\r\n        if (this.readDOMTimeout != null) { return }\r\n        this.readDOMTimeout = setTimeout(function () {\r\n            this$1.readDOMTimeout = null;\r\n            if (this$1.composing) {\r\n                if (this$1.composing.done) { this$1.composing = null; }\r\n                else { return }\r\n            }\r\n            this$1.updateFromDOM();\r\n        }, 80);\r\n    };\r\n\r\n    ContentEditableInput.prototype.updateFromDOM = function () {\r\n        var this$1 = this;\r\n\r\n        if (this.cm.isReadOnly() || !this.pollContent())\r\n        { runInOp(this.cm, function () { return regChange(this$1.cm); }); }\r\n    };\r\n\r\n    ContentEditableInput.prototype.setUneditable = function (node) {\r\n        node.contentEditable = "false";\r\n    };\r\n\r\n    ContentEditableInput.prototype.onKeyPress = function (e) {\r\n        if (e.charCode == 0 || this.composing) { return }\r\n        e.preventDefault();\r\n        if (!this.cm.isReadOnly())\r\n        { operation(this.cm, applyTextInput)(this.cm, String.fromCharCode(e.charCode == null ? e.keyCode : e.charCode), 0); }\r\n    };\r\n\r\n    ContentEditableInput.prototype.readOnlyChanged = function (val) {\r\n        this.div.contentEditable = String(val != "nocursor");\r\n    };\r\n\r\n    ContentEditableInput.prototype.onContextMenu = function () {};\r\n    ContentEditableInput.prototype.resetPosition = function () {};\r\n\r\n    ContentEditableInput.prototype.needsContentAttribute = true;\r\n\r\n    function posToDOM(cm, pos) {\r\n        var view = findViewForLine(cm, pos.line);\r\n        if (!view || view.hidden) { return null }\r\n        var line = getLine(cm.doc, pos.line);\r\n        var info = mapFromLineView(view, line, pos.line);\r\n\r\n        var order = getOrder(line, cm.doc.direction), side = "left";\r\n        if (order) {\r\n            var partPos = getBidiPartAt(order, pos.ch);\r\n            side = partPos % 2 ? "right" : "left";\r\n        }\r\n        var result = nodeAndOffsetInLineMap(info.map, pos.ch, side);\r\n        result.offset = result.collapse == "right" ? result.end : result.start;\r\n        return result\r\n    }\r\n\r\n    function isInGutter(node) {\r\n        for (var scan = node; scan; scan = scan.parentNode)\r\n        { if (/CodeMirror-gutter-wrapper/.test(scan.className)) { return true } }\r\n        return false\r\n    }\r\n\r\n    function badPos(pos, bad) { if (bad) { pos.bad = true; } return pos }\r\n\r\n    function domTextBetween(cm, from, to, fromLine, toLine) {\r\n        var text = "", closing = false, lineSep = cm.doc.lineSeparator(), extraLinebreak = false;\r\n        function recognizeMarker(id) { return function (marker) { return marker.id == id; } }\r\n        function close() {\r\n            if (closing) {\r\n                text += lineSep;\r\n                if (extraLinebreak) { text += lineSep; }\r\n                closing = extraLinebreak = false;\r\n            }\r\n        }\r\n        function addText(str) {\r\n            if (str) {\r\n                close();\r\n                text += str;\r\n            }\r\n        }\r\n        function walk(node) {\r\n            if (node.nodeType == 1) {\r\n                var cmText = node.getAttribute("cm-text");\r\n                if (cmText) {\r\n                    addText(cmText);\r\n                    return\r\n                }\r\n                var markerID = node.getAttribute("cm-marker"), range$$1;\r\n                if (markerID) {\r\n                    var found = cm.findMarks(Pos(fromLine, 0), Pos(toLine + 1, 0), recognizeMarker(+markerID));\r\n                    if (found.length && (range$$1 = found[0].find(0)))\r\n                    { addText(getBetween(cm.doc, range$$1.from, range$$1.to).join(lineSep)); }\r\n                    return\r\n                }\r\n                if (node.getAttribute("contenteditable") == "false") { return }\r\n                var isBlock = /^(pre|div|p|li|table|br)$/i.test(node.nodeName);\r\n                if (!/^br$/i.test(node.nodeName) && node.textContent.length == 0) { return }\r\n\r\n                if (isBlock) { close(); }\r\n                for (var i = 0; i < node.childNodes.length; i++)\r\n                { walk(node.childNodes[i]); }\r\n\r\n                if (/^(pre|p)$/i.test(node.nodeName)) { extraLinebreak = true; }\r\n                if (isBlock) { closing = true; }\r\n            } else if (node.nodeType == 3) {\r\n                addText(node.nodeValue.replace(/\\u200b/g, "").replace(/\\u00a0/g, " "));\r\n            }\r\n        }\r\n        for (;;) {\r\n            walk(from);\r\n            if (from == to) { break }\r\n            from = from.nextSibling;\r\n            extraLinebreak = false;\r\n        }\r\n        return text\r\n    }\r\n\r\n    function domToPos(cm, node, offset) {\r\n        var lineNode;\r\n        if (node == cm.display.lineDiv) {\r\n            lineNode = cm.display.lineDiv.childNodes[offset];\r\n            if (!lineNode) { return badPos(cm.clipPos(Pos(cm.display.viewTo - 1)), true) }\r\n            node = null; offset = 0;\r\n        } else {\r\n            for (lineNode = node;; lineNode = lineNode.parentNode) {\r\n                if (!lineNode || lineNode == cm.display.lineDiv) { return null }\r\n                if (lineNode.parentNode && lineNode.parentNode == cm.display.lineDiv) { break }\r\n            }\r\n        }\r\n        for (var i = 0; i < cm.display.view.length; i++) {\r\n            var lineView = cm.display.view[i];\r\n            if (lineView.node == lineNode)\r\n            { return locateNodeInLineView(lineView, node, offset) }\r\n        }\r\n    }\r\n\r\n    function locateNodeInLineView(lineView, node, offset) {\r\n        var wrapper = lineView.text.firstChild, bad = false;\r\n        if (!node || !contains(wrapper, node)) { return badPos(Pos(lineNo(lineView.line), 0), true) }\r\n        if (node == wrapper) {\r\n            bad = true;\r\n            node = wrapper.childNodes[offset];\r\n            offset = 0;\r\n            if (!node) {\r\n                var line = lineView.rest ? lst(lineView.rest) : lineView.line;\r\n                return badPos(Pos(lineNo(line), line.text.length), bad)\r\n            }\r\n        }\r\n\r\n        var textNode = node.nodeType == 3 ? node : null, topNode = node;\r\n        if (!textNode && node.childNodes.length == 1 && node.firstChild.nodeType == 3) {\r\n            textNode = node.firstChild;\r\n            if (offset) { offset = textNode.nodeValue.length; }\r\n        }\r\n        while (topNode.parentNode != wrapper) { topNode = topNode.parentNode; }\r\n        var measure = lineView.measure, maps = measure.maps;\r\n\r\n        function find(textNode, topNode, offset) {\r\n            for (var i = -1; i < (maps ? maps.length : 0); i++) {\r\n                var map$$1 = i < 0 ? measure.map : maps[i];\r\n                for (var j = 0; j < map$$1.length; j += 3) {\r\n                    var curNode = map$$1[j + 2];\r\n                    if (curNode == textNode || curNode == topNode) {\r\n                        var line = lineNo(i < 0 ? lineView.line : lineView.rest[i]);\r\n                        var ch = map$$1[j] + offset;\r\n                        if (offset < 0 || curNode != textNode) { ch = map$$1[j + (offset ? 1 : 0)]; }\r\n                        return Pos(line, ch)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        var found = find(textNode, topNode, offset);\r\n        if (found) { return badPos(found, bad) }\r\n\r\n        // FIXME this is all really shaky. might handle the few cases it needs to handle, but likely to cause problems\r\n        for (var after = topNode.nextSibling, dist = textNode ? textNode.nodeValue.length - offset : 0; after; after = after.nextSibling) {\r\n            found = find(after, after.firstChild, 0);\r\n            if (found)\r\n            { return badPos(Pos(found.line, found.ch - dist), bad) }\r\n            else\r\n            { dist += after.textContent.length; }\r\n        }\r\n        for (var before = topNode.previousSibling, dist$1 = offset; before; before = before.previousSibling) {\r\n            found = find(before, before.firstChild, -1);\r\n            if (found)\r\n            { return badPos(Pos(found.line, found.ch + dist$1), bad) }\r\n            else\r\n            { dist$1 += before.textContent.length; }\r\n        }\r\n    }\r\n\r\n    // TEXTAREA INPUT STYLE\r\n\r\n    var TextareaInput = function(cm) {\r\n        this.cm = cm;\r\n        // See input.poll and input.reset\r\n        this.prevInput = "";\r\n\r\n        // Flag that indicates whether we expect input to appear real soon\r\n        // now (after some event like \'keypress\' or \'input\') and are\r\n        // polling intensively.\r\n        this.pollingFast = false;\r\n        // Self-resetting timeout for the poller\r\n        this.polling = new Delayed();\r\n        // Used to work around IE issue with selection being forgotten when focus moves away from textarea\r\n        this.hasSelection = false;\r\n        this.composing = null;\r\n    };\r\n\r\n    TextareaInput.prototype.init = function (display) {\r\n        var this$1 = this;\r\n\r\n        var input = this, cm = this.cm;\r\n        this.createField(display);\r\n        var te = this.textarea;\r\n\r\n        display.wrapper.insertBefore(this.wrapper, display.wrapper.firstChild);\r\n\r\n        // Needed to hide big blue blinking cursor on Mobile Safari (doesn\'t seem to work in iOS 8 anymore)\r\n        if (ios) { te.style.width = "0px"; }\r\n\r\n        on(te, "input", function () {\r\n            if (ie && ie_version >= 9 && this$1.hasSelection) { this$1.hasSelection = null; }\r\n            input.poll();\r\n        });\r\n\r\n        on(te, "paste", function (e) {\r\n            if (signalDOMEvent(cm, e) || handlePaste(e, cm)) { return }\r\n\r\n            cm.state.pasteIncoming = true;\r\n            input.fastPoll();\r\n        });\r\n\r\n        function prepareCopyCut(e) {\r\n            if (signalDOMEvent(cm, e)) { return }\r\n            if (cm.somethingSelected()) {\r\n                setLastCopied({lineWise: false, text: cm.getSelections()});\r\n            } else if (!cm.options.lineWiseCopyCut) {\r\n                return\r\n            } else {\r\n                var ranges = copyableRanges(cm);\r\n                setLastCopied({lineWise: true, text: ranges.text});\r\n                if (e.type == "cut") {\r\n                    cm.setSelections(ranges.ranges, null, sel_dontScroll);\r\n                } else {\r\n                    input.prevInput = "";\r\n                    te.value = ranges.text.join("\\n");\r\n                    selectInput(te);\r\n                }\r\n            }\r\n            if (e.type == "cut") { cm.state.cutIncoming = true; }\r\n        }\r\n        on(te, "cut", prepareCopyCut);\r\n        on(te, "copy", prepareCopyCut);\r\n\r\n        on(display.scroller, "paste", function (e) {\r\n            if (eventInWidget(display, e) || signalDOMEvent(cm, e)) { return }\r\n            cm.state.pasteIncoming = true;\r\n            input.focus();\r\n        });\r\n\r\n        // Prevent normal selection in the editor (we handle our own)\r\n        on(display.lineSpace, "selectstart", function (e) {\r\n            if (!eventInWidget(display, e)) { e_preventDefault(e); }\r\n        });\r\n\r\n        on(te, "compositionstart", function () {\r\n            var start = cm.getCursor("from");\r\n            if (input.composing) { input.composing.range.clear(); }\r\n            input.composing = {\r\n                start: start,\r\n                range: cm.markText(start, cm.getCursor("to"), {className: "CodeMirror-composing"})\r\n            };\r\n        });\r\n        on(te, "compositionend", function () {\r\n            if (input.composing) {\r\n                input.poll();\r\n                input.composing.range.clear();\r\n                input.composing = null;\r\n            }\r\n        });\r\n    };\r\n\r\n    TextareaInput.prototype.createField = function (_display) {\r\n        // Wraps and hides input textarea\r\n        this.wrapper = hiddenTextarea();\r\n        // The semihidden textarea that is focused when the editor is\r\n        // focused, and receives input.\r\n        this.textarea = this.wrapper.firstChild;\r\n    };\r\n\r\n    TextareaInput.prototype.prepareSelection = function () {\r\n        // Redraw the selection and/or cursor\r\n        var cm = this.cm, display = cm.display, doc = cm.doc;\r\n        var result = prepareSelection(cm);\r\n\r\n        // Move the hidden textarea near the cursor to prevent scrolling artifacts\r\n        if (cm.options.moveInputWithCursor) {\r\n            var headPos = cursorCoords(cm, doc.sel.primary().head, "div");\r\n            var wrapOff = display.wrapper.getBoundingClientRect(), lineOff = display.lineDiv.getBoundingClientRect();\r\n            result.teTop = Math.max(0, Math.min(display.wrapper.clientHeight - 10,\r\n                headPos.top + lineOff.top - wrapOff.top));\r\n            result.teLeft = Math.max(0, Math.min(display.wrapper.clientWidth - 10,\r\n                headPos.left + lineOff.left - wrapOff.left));\r\n        }\r\n\r\n        return result\r\n    };\r\n\r\n    TextareaInput.prototype.showSelection = function (drawn) {\r\n        var cm = this.cm, display = cm.display;\r\n        removeChildrenAndAdd(display.cursorDiv, drawn.cursors);\r\n        removeChildrenAndAdd(display.selectionDiv, drawn.selection);\r\n        if (drawn.teTop != null) {\r\n            this.wrapper.style.top = drawn.teTop + "px";\r\n            this.wrapper.style.left = drawn.teLeft + "px";\r\n        }\r\n    };\r\n\r\n    // Reset the input to correspond to the selection (or to be empty,\r\n    // when not typing and nothing is selected)\r\n    TextareaInput.prototype.reset = function (typing) {\r\n        if (this.contextMenuPending || this.composing) { return }\r\n        var cm = this.cm;\r\n        if (cm.somethingSelected()) {\r\n            this.prevInput = "";\r\n            var content = cm.getSelection();\r\n            this.textarea.value = content;\r\n            if (cm.state.focused) { selectInput(this.textarea); }\r\n            if (ie && ie_version >= 9) { this.hasSelection = content; }\r\n        } else if (!typing) {\r\n            this.prevInput = this.textarea.value = "";\r\n            if (ie && ie_version >= 9) { this.hasSelection = null; }\r\n        }\r\n    };\r\n\r\n    TextareaInput.prototype.getField = function () { return this.textarea };\r\n\r\n    TextareaInput.prototype.supportsTouch = function () { return false };\r\n\r\n    TextareaInput.prototype.focus = function () {\r\n        if (this.cm.options.readOnly != "nocursor" && (!mobile || activeElt() != this.textarea)) {\r\n            try { this.textarea.focus(); }\r\n            catch (e) {} // IE8 will throw if the textarea is display: none or not in DOM\r\n        }\r\n    };\r\n\r\n    TextareaInput.prototype.blur = function () { this.textarea.blur(); };\r\n\r\n    TextareaInput.prototype.resetPosition = function () {\r\n        this.wrapper.style.top = this.wrapper.style.left = 0;\r\n    };\r\n\r\n    TextareaInput.prototype.receivedFocus = function () { this.slowPoll(); };\r\n\r\n    // Poll for input changes, using the normal rate of polling. This\r\n    // runs as long as the editor is focused.\r\n    TextareaInput.prototype.slowPoll = function () {\r\n        var this$1 = this;\r\n\r\n        if (this.pollingFast) { return }\r\n        this.polling.set(this.cm.options.pollInterval, function () {\r\n            this$1.poll();\r\n            if (this$1.cm.state.focused) { this$1.slowPoll(); }\r\n        });\r\n    };\r\n\r\n    // When an event has just come in that is likely to add or change\r\n    // something in the input textarea, we poll faster, to ensure that\r\n    // the change appears on the screen quickly.\r\n    TextareaInput.prototype.fastPoll = function () {\r\n        var missed = false, input = this;\r\n        input.pollingFast = true;\r\n        function p() {\r\n            var changed = input.poll();\r\n            if (!changed && !missed) {missed = true; input.polling.set(60, p);}\r\n            else {input.pollingFast = false; input.slowPoll();}\r\n        }\r\n        input.polling.set(20, p);\r\n    };\r\n\r\n    // Read input from the textarea, and update the document to match.\r\n    // When something is selected, it is present in the textarea, and\r\n    // selected (unless it is huge, in which case a placeholder is\r\n    // used). When nothing is selected, the cursor sits after previously\r\n    // seen text (can be empty), which is stored in prevInput (we must\r\n    // not reset the textarea when typing, because that breaks IME).\r\n    TextareaInput.prototype.poll = function () {\r\n        var this$1 = this;\r\n\r\n        var cm = this.cm, input = this.textarea, prevInput = this.prevInput;\r\n        // Since this is called a *lot*, try to bail out as cheaply as\r\n        // possible when it is clear that nothing happened. hasSelection\r\n        // will be the case when there is a lot of text in the textarea,\r\n        // in which case reading its value would be expensive.\r\n        if (this.contextMenuPending || !cm.state.focused ||\r\n            (hasSelection(input) && !prevInput && !this.composing) ||\r\n            cm.isReadOnly() || cm.options.disableInput || cm.state.keySeq)\r\n        { return false }\r\n\r\n        var text = input.value;\r\n        // If nothing changed, bail.\r\n        if (text == prevInput && !cm.somethingSelected()) { return false }\r\n        // Work around nonsensical selection resetting in IE9/10, and\r\n        // inexplicable appearance of private area unicode characters on\r\n        // some key combos in Mac (#2689).\r\n        if (ie && ie_version >= 9 && this.hasSelection === text ||\r\n            mac && /[\\uf700-\\uf7ff]/.test(text)) {\r\n            cm.display.input.reset();\r\n            return false\r\n        }\r\n\r\n        if (cm.doc.sel == cm.display.selForContextMenu) {\r\n            var first = text.charCodeAt(0);\r\n            if (first == 0x200b && !prevInput) { prevInput = "\\u200b"; }\r\n            if (first == 0x21da) { this.reset(); return this.cm.execCommand("undo") }\r\n        }\r\n        // Find the part of the input that is actually new\r\n        var same = 0, l = Math.min(prevInput.length, text.length);\r\n        while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) { ++same; }\r\n\r\n        runInOp(cm, function () {\r\n            applyTextInput(cm, text.slice(same), prevInput.length - same,\r\n                null, this$1.composing ? "*compose" : null);\r\n\r\n            // Don\'t leave long text in the textarea, since it makes further polling slow\r\n            if (text.length > 1000 || text.indexOf("\\n") > -1) { input.value = this$1.prevInput = ""; }\r\n            else { this$1.prevInput = text; }\r\n\r\n            if (this$1.composing) {\r\n                this$1.composing.range.clear();\r\n                this$1.composing.range = cm.markText(this$1.composing.start, cm.getCursor("to"),\r\n                    {className: "CodeMirror-composing"});\r\n            }\r\n        });\r\n        return true\r\n    };\r\n\r\n    TextareaInput.prototype.ensurePolled = function () {\r\n        if (this.pollingFast && this.poll()) { this.pollingFast = false; }\r\n    };\r\n\r\n    TextareaInput.prototype.onKeyPress = function () {\r\n        if (ie && ie_version >= 9) { this.hasSelection = null; }\r\n        this.fastPoll();\r\n    };\r\n\r\n    TextareaInput.prototype.onContextMenu = function (e) {\r\n        var input = this, cm = input.cm, display = cm.display, te = input.textarea;\r\n        if (input.contextMenuPending) { input.contextMenuPending(); }\r\n        var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;\r\n        if (!pos || presto) { return } // Opera is difficult.\r\n\r\n        // Reset the current text selection only if the click is done outside of the selection\r\n        // and \'resetSelectionOnContextMenu\' option is true.\r\n        var reset = cm.options.resetSelectionOnContextMenu;\r\n        if (reset && cm.doc.sel.contains(pos) == -1)\r\n        { operation(cm, setSelection)(cm.doc, simpleSelection(pos), sel_dontScroll); }\r\n\r\n        var oldCSS = te.style.cssText, oldWrapperCSS = input.wrapper.style.cssText;\r\n        var wrapperBox = input.wrapper.offsetParent.getBoundingClientRect();\r\n        input.wrapper.style.cssText = "position: static";\r\n        te.style.cssText = "position: absolute; width: 30px; height: 30px;\\n      top: " + (e.clientY - wrapperBox.top - 5) + "px; left: " + (e.clientX - wrapperBox.left - 5) + "px;\\n      z-index: 1000; background: " + (ie ? "rgba(255, 255, 255, .05)" : "transparent") + ";\\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";\r\n        var oldScrollY;\r\n        if (webkit) { oldScrollY = window.scrollY; } // Work around Chrome issue (#2712)\r\n        display.input.focus();\r\n        if (webkit) { window.scrollTo(null, oldScrollY); }\r\n        display.input.reset();\r\n        // Adds "Select all" to context menu in FF\r\n        if (!cm.somethingSelected()) { te.value = input.prevInput = " "; }\r\n        input.contextMenuPending = rehide;\r\n        display.selForContextMenu = cm.doc.sel;\r\n        clearTimeout(display.detectingSelectAll);\r\n\r\n        // Select-all will be greyed out if there\'s nothing to select, so\r\n        // this adds a zero-width space so that we can later check whether\r\n        // it got selected.\r\n        function prepareSelectAllHack() {\r\n            if (te.selectionStart != null) {\r\n                var selected = cm.somethingSelected();\r\n                var extval = "\\u200b" + (selected ? te.value : "");\r\n                te.value = "\\u21da"; // Used to catch context-menu undo\r\n                te.value = extval;\r\n                input.prevInput = selected ? "" : "\\u200b";\r\n                te.selectionStart = 1; te.selectionEnd = extval.length;\r\n                // Re-set this, in case some other handler touched the\r\n                // selection in the meantime.\r\n                display.selForContextMenu = cm.doc.sel;\r\n            }\r\n        }\r\n        function rehide() {\r\n            if (input.contextMenuPending != rehide) { return }\r\n            input.contextMenuPending = false;\r\n            input.wrapper.style.cssText = oldWrapperCSS;\r\n            te.style.cssText = oldCSS;\r\n            if (ie && ie_version < 9) { display.scrollbars.setScrollTop(display.scroller.scrollTop = scrollPos); }\r\n\r\n            // Try to detect the user choosing select-all\r\n            if (te.selectionStart != null) {\r\n                if (!ie || (ie && ie_version < 9)) { prepareSelectAllHack(); }\r\n                var i = 0, poll = function () {\r\n                    if (display.selForContextMenu == cm.doc.sel && te.selectionStart == 0 &&\r\n                        te.selectionEnd > 0 && input.prevInput == "\\u200b") {\r\n                        operation(cm, selectAll)(cm);\r\n                    } else if (i++ < 10) {\r\n                        display.detectingSelectAll = setTimeout(poll, 500);\r\n                    } else {\r\n                        display.selForContextMenu = null;\r\n                        display.input.reset();\r\n                    }\r\n                };\r\n                display.detectingSelectAll = setTimeout(poll, 200);\r\n            }\r\n        }\r\n\r\n        if (ie && ie_version >= 9) { prepareSelectAllHack(); }\r\n        if (captureRightClick) {\r\n            e_stop(e);\r\n            var mouseup = function () {\r\n                off(window, "mouseup", mouseup);\r\n                setTimeout(rehide, 20);\r\n            };\r\n            on(window, "mouseup", mouseup);\r\n        } else {\r\n            setTimeout(rehide, 50);\r\n        }\r\n    };\r\n\r\n    TextareaInput.prototype.readOnlyChanged = function (val) {\r\n        if (!val) { this.reset(); }\r\n        this.textarea.disabled = val == "nocursor";\r\n    };\r\n\r\n    TextareaInput.prototype.setUneditable = function () {};\r\n\r\n    TextareaInput.prototype.needsContentAttribute = false;\r\n\r\n    function fromTextArea(textarea, options) {\r\n        options = options ? copyObj(options) : {};\r\n        options.value = textarea.value;\r\n        if (!options.tabindex && textarea.tabIndex)\r\n        { options.tabindex = textarea.tabIndex; }\r\n        if (!options.placeholder && textarea.placeholder)\r\n        { options.placeholder = textarea.placeholder; }\r\n        // Set autofocus to true if this textarea is focused, or if it has\r\n        // autofocus and no other element is focused.\r\n        if (options.autofocus == null) {\r\n            var hasFocus = activeElt();\r\n            options.autofocus = hasFocus == textarea ||\r\n                textarea.getAttribute("autofocus") != null && hasFocus == document.body;\r\n        }\r\n\r\n        function save() {textarea.value = cm.getValue();}\r\n\r\n        var realSubmit;\r\n        if (textarea.form) {\r\n            on(textarea.form, "submit", save);\r\n            // Deplorable hack to make the submit method do the right thing.\r\n            if (!options.leaveSubmitMethodAlone) {\r\n                var form = textarea.form;\r\n                realSubmit = form.submit;\r\n                try {\r\n                    var wrappedSubmit = form.submit = function () {\r\n                        save();\r\n                        form.submit = realSubmit;\r\n                        form.submit();\r\n                        form.submit = wrappedSubmit;\r\n                    };\r\n                } catch(e) {}\r\n            }\r\n        }\r\n\r\n        options.finishInit = function (cm) {\r\n            cm.save = save;\r\n            cm.getTextArea = function () { return textarea; };\r\n            cm.toTextArea = function () {\r\n                cm.toTextArea = isNaN; // Prevent this from being ran twice\r\n                save();\r\n                textarea.parentNode.removeChild(cm.getWrapperElement());\r\n                textarea.style.display = "";\r\n                if (textarea.form) {\r\n                    off(textarea.form, "submit", save);\r\n                    if (typeof textarea.form.submit == "function")\r\n                    { textarea.form.submit = realSubmit; }\r\n                }\r\n            };\r\n        };\r\n\r\n        textarea.style.display = "none";\r\n        var cm = CodeMirror(function (node) { return textarea.parentNode.insertBefore(node, textarea.nextSibling); },\r\n            options);\r\n        return cm\r\n    }\r\n\r\n    function addLegacyProps(CodeMirror) {\r\n        CodeMirror.off = off;\r\n        CodeMirror.on = on;\r\n        CodeMirror.wheelEventPixels = wheelEventPixels;\r\n        CodeMirror.Doc = Doc;\r\n        CodeMirror.splitLines = splitLinesAuto;\r\n        CodeMirror.countColumn = countColumn;\r\n        CodeMirror.findColumn = findColumn;\r\n        CodeMirror.isWordChar = isWordCharBasic;\r\n        CodeMirror.Pass = Pass;\r\n        CodeMirror.signal = signal;\r\n        CodeMirror.Line = Line;\r\n        CodeMirror.changeEnd = changeEnd;\r\n        CodeMirror.scrollbarModel = scrollbarModel;\r\n        CodeMirror.Pos = Pos;\r\n        CodeMirror.cmpPos = cmp;\r\n        CodeMirror.modes = modes;\r\n        CodeMirror.mimeModes = mimeModes;\r\n        CodeMirror.resolveMode = resolveMode;\r\n        CodeMirror.getMode = getMode;\r\n        CodeMirror.modeExtensions = modeExtensions;\r\n        CodeMirror.extendMode = extendMode;\r\n        CodeMirror.copyState = copyState;\r\n        CodeMirror.startState = startState;\r\n        CodeMirror.innerMode = innerMode;\r\n        CodeMirror.commands = commands;\r\n        CodeMirror.keyMap = keyMap;\r\n        CodeMirror.keyName = keyName;\r\n        CodeMirror.isModifierKey = isModifierKey;\r\n        CodeMirror.lookupKey = lookupKey;\r\n        CodeMirror.normalizeKeyMap = normalizeKeyMap;\r\n        CodeMirror.StringStream = StringStream;\r\n        CodeMirror.SharedTextMarker = SharedTextMarker;\r\n        CodeMirror.TextMarker = TextMarker;\r\n        CodeMirror.LineWidget = LineWidget;\r\n        CodeMirror.e_preventDefault = e_preventDefault;\r\n        CodeMirror.e_stopPropagation = e_stopPropagation;\r\n        CodeMirror.e_stop = e_stop;\r\n        CodeMirror.addClass = addClass;\r\n        CodeMirror.contains = contains;\r\n        CodeMirror.rmClass = rmClass;\r\n        CodeMirror.keyNames = keyNames;\r\n    }\r\n\r\n    // EDITOR CONSTRUCTOR\r\n\r\n    defineOptions(CodeMirror);\r\n\r\n    addEditorMethods(CodeMirror);\r\n\r\n    // Set up methods on CodeMirror\'s prototype to redirect to the editor\'s document.\r\n    var dontDelegate = "iter insert remove copy getEditor constructor".split(" ");\r\n    for (var prop in Doc.prototype) { if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)\r\n    { CodeMirror.prototype[prop] = (function(method) {\r\n        return function() {return method.apply(this.doc, arguments)}\r\n    })(Doc.prototype[prop]); } }\r\n\r\n    eventMixin(Doc);\r\n    CodeMirror.inputStyles = {"textarea": TextareaInput, "contenteditable": ContentEditableInput};\r\n\r\n    // Extra arguments are stored as the mode\'s dependencies, which is\r\n    // used by (legacy) mechanisms like loadmode.js to automatically\r\n    // load a mode. (Preferred mechanism is the require/define calls.)\r\n    CodeMirror.defineMode = function(name/*, mode, …*/) {\r\n        if (!CodeMirror.defaults.mode && name != "null") { CodeMirror.defaults.mode = name; }\r\n        defineMode.apply(this, arguments);\r\n    };\r\n\r\n    CodeMirror.defineMIME = defineMIME;\r\n\r\n    // Minimal default mode.\r\n    CodeMirror.defineMode("null", function () { return ({token: function (stream) { return stream.skipToEnd(); }}); });\r\n    CodeMirror.defineMIME("text/plain", "null");\r\n\r\n    // EXTENSIONS\r\n\r\n    CodeMirror.defineExtension = function (name, func) {\r\n        CodeMirror.prototype[name] = func;\r\n    };\r\n    CodeMirror.defineDocExtension = function (name, func) {\r\n        Doc.prototype[name] = func;\r\n    };\r\n\r\n    CodeMirror.fromTextArea = fromTextArea;\r\n\r\n    addLegacyProps(CodeMirror);\r\n\r\n    CodeMirror.version = "5.42.2";\r\n\r\n    return CodeMirror;\r\n\r\n})));'},function(e,t,n){"use strict";n=n(209)(Object.keys,Object);e.exports=n},function(e,t,n){"use strict";n=n(19)(n(10),"DataView");e.exports=n},function(e,t,n){"use strict";var r=n(30),i=n(394),o=n(11),a=n(211),s=/^\[object .+?Constructor\]$/,n=Function.prototype,l=Object.prototype,n=n.toString,l=l.hasOwnProperty,c=RegExp("^"+n.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(r(e)?c:s).test(a(e))}},function(e,t,n){"use strict";var n=n(25),r=Object.prototype,a=r.hasOwnProperty,s=r.toString,l=n?n.toStringTag:undefined;e.exports=function(e){var t=a.call(e,l),n=e[l];try{e[l]=undefined;var r=!0}catch(o){}var i=s.call(e);return r&&(t?e[l]=n:delete e[l]),i}},function(e,t,n){"use strict";var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t,n){"use strict";var n=n(395),r=(n=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!r&&r in e}},function(e,t,n){"use strict";n=n(10)["__core-js_shared__"];e.exports=n},function(e,t,n){"use strict";e.exports=function(e,t){return null==e?undefined:e[t]}},function(e,t,n){"use strict";n=n(19)(n(10),"Promise");e.exports=n},function(e,t,n){"use strict";n=n(19)(n(10),"WeakMap");e.exports=n},function(e,t,n){"use strict";var r=n(20),i=n(12);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},function(e,t,n){"use strict";e.exports=function(){return!1}},function(e,t,n){"use strict";var r=n(20),i=n(75),o=n(12),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!a[r(e)]}},function(e,t,n){"use strict";var r=n(403),i=n(433),o=n(222);e.exports=function(t){var n=i(t);return 1==n.length&&n[0][2]?o(n[0][0],n[0][1]):function(e){return e===t||r(e,t,n)}}},function(e,t,n){"use strict";var p=n(77),f=n(213);e.exports=function(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var l=(s=n[i])[0],c=e[l],u=s[1];if(a&&s[2]){if(c===undefined&&!(l in e))return!1}else{var h,d=new p;if(!((h=r?r(c,u,l,e,t,d):h)===undefined?f(u,c,3,r,d):h))return!1}}return!0}},function(e,t,n){"use strict";e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){"use strict";var r=n(52),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__;return!((e=r(t,e))<0)&&(e==t.length-1?t.pop():i.call(t,e,1),--this.size,!0)}},function(e,t,n){"use strict";var r=n(52);e.exports=function(e){var t=this.__data__;return(e=r(t,e))<0?undefined:t[e][1]}},function(e,t,n){"use strict";var r=n(52);e.exports=function(e){return-1<r(this.__data__,e)}},function(e,t,n){"use strict";var i=n(52);e.exports=function(e,t){var n=this.__data__,r=i(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}},function(e,t,n){"use strict";var r=n(51);e.exports=function(){this.__data__=new r,this.size=0}},function(e,t,n){"use strict";e.exports=function(e){var t=this.__data__,e=t["delete"](e);return this.size=t.size,e}},function(e,t,n){"use strict";e.exports=function(e){return this.__data__.get(e)}},function(e,t,n){"use strict";e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){"use strict";var i=n(51),o=n(74),a=n(78);e.exports=function(e,t){var n=this.__data__;if(n instanceof i){var r=n.__data__;if(!o||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new a(r)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){"use strict";var r=n(415),i=n(51),o=n(74);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},function(e,t,n){"use strict";var r=n(416),i=n(417),o=n(418),a=n(419),n=n(420);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype["delete"]=i,s.prototype.get=o,s.prototype.has=a,s.prototype.set=n,e.exports=s},function(e,t,n){"use strict";var r=n(53);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t,n){"use strict";e.exports=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e}},function(e,t,n){"use strict";var r=n(53),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t,n=this.__data__;return r?"__lodash_hash_undefined__"===(t=n[e])?undefined:t:i.call(n,e)?n[e]:undefined}},function(e,t,n){"use strict";var r=n(53),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?t[e]!==undefined:i.call(t,e)}},function(e,t,n){"use strict";var r=n(53);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&t===undefined?"__lodash_hash_undefined__":t,this}},function(e,t,n){"use strict";var r=n(54);e.exports=function(e){return e=r(this,e)["delete"](e),this.size-=e?1:0,e}},function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){var t=r(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){"use strict";var r=n(54);e.exports=function(e){return r(this,e).get(e)}},function(e,t,n){"use strict";var r=n(54);e.exports=function(e){return r(this,e).has(e)}},function(e,t,n){"use strict";var i=n(54);e.exports=function(e,t){var n=i(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}},function(e,t,n){"use strict";var h=n(77),d=n(214),p=n(429),f=n(431),m=n(24),g=n(0),b=n(49),y=n(76),v="[object Arguments]",_="[object Array]",I="[object Object]",x=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,r,i,o){var a=g(e),s=g(t),l=a?_:m(e),s=s?_:m(t),c=(l=l==v?I:l)==I,u=(s=s==v?I:s)==I;if((s=l==s)&&b(e)){if(!b(t))return!1;c=!(a=!0)}if(s&&!c)return o=o||new h,a||y(e)?d(e,t,n,r,i,o):p(e,t,l,n,r,i,o);if(!(1&n)){a=c&&x.call(e,"__wrapped__"),l=u&&x.call(t,"__wrapped__");if(a||l)return i(a?e.value():e,l?t.value():t,n,r,o=o||new h)}return s&&(o=o||new h,f(e,t,n,r,i,o))}},function(e,t,n){"use strict";e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t,n){"use strict";e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){"use strict";var r=n(25),c=n(216),u=n(33),h=n(214),d=n(430),p=n(81),n=r?r.prototype:undefined,f=n?n.valueOf:undefined;e.exports=function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return e.byteLength==t.byteLength&&o(new c(e),new c(t))?!0:!1;case"[object Boolean]":case"[object Date]":case"[object Number]":return u(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=d;case"[object Set]":s=s||p;if(e.size!=t.size&&!(1&r))return!1;var l=a.get(e);if(l)return l==t;r|=2,a.set(e,t);l=h(s(e),s(t),r,i,o,a);return a["delete"](e),l;case"[object Symbol]":if(f)return f.call(e)==f.call(t)}return!1}},function(e,t,n){"use strict";e.exports=function(e){var n=-1,r=Array(e.size);return e.forEach(function(e,t){r[++n]=[t,e]}),r}},function(e,t,n){"use strict";var y=n(217),v=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,r,i,o){var a=1&n,s=y(e),l=s.length;if(l!=y(t).length&&!a)return!1;for(var c=l;c--;){var u=s[c];if(!(a?u in t:v.call(t,u)))return!1}var h=o.get(e),d=o.get(t);if(h&&d)return h==t&&d==e;for(var p=!0,f=(o.set(e,t),o.set(t,e),a);++c<l;){var m,g=e[u=s[c]],b=t[u];if(!((m=r?a?r(b,g,u,t,e,o):r(g,b,u,e,t,o):m)===undefined?g===b||i(g,b,n,r,o):m)){p=!1;break}f=f||"constructor"==u}return p&&!f&&(h=e.constructor)!=(d=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof h&&h instanceof h&&"function"==typeof d&&d instanceof d)&&(p=!1),o["delete"](e),o["delete"](t),p}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){"use strict";var o=n(221),a=n(5);e.exports=function(e){for(var t=a(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,o(i)]}return t}},function(e,t,n){"use strict";var i=n(213),o=n(85),a=n(439),s=n(87),l=n(221),c=n(222),u=n(34);e.exports=function(n,r){return s(n)&&l(r)?c(u(n),r):function(e){var t=o(e,n);return t===undefined&&t===r?a(e,n):i(r,t,3)}}},function(e,t,n){"use strict";var n=n(436),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,n=n(function(e){var i=[];return 46===e.charCodeAt(0)&&i.push(""),e.replace(r,function(e,t,n,r){i.push(n?r.replace(o,"$1"):t||e)}),i});e.exports=n},function(e,t,n){"use strict";var r=n(437);e.exports=function(e){var t=(e=r(e,function(e){return 500===t.size&&t.clear(),e})).cache;return e}},function(e,t,n){"use strict";var a=n(78);function s(r,i){if("function"!=typeof r||null!=i&&"function"!=typeof i)throw new TypeError("Expected a function");var o;return(o=function o(){var e=arguments,t=i?i.apply(this,e):e[0],n=o.cache;return n.has(t)?n.get(t):(e=r.apply(this,e),o.cache=n.set(t,e)||n,e)}).cache=new(s.Cache||a),o}s.Cache=a,e.exports=s},function(e,t,n){"use strict";var r=n(25),i=n(32),o=n(0),a=n(57),n=r?r.prototype:undefined,s=n?n.toString:undefined;e.exports=function l(e){var t;return"string"==typeof e?e:o(e)?i(e,l)+"":a(e)?s?s.call(e):"":"0"==(t=e+"")&&1/e==-1/0?"-0":t}},function(e,t,n){"use strict";var r=n(440),i=n(224);e.exports=function(e,t){return null!=e&&i(e,t,r)}},function(e,t,n){"use strict";e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,n){"use strict";var r=n(225),i=n(442),o=n(87),a=n(34);e.exports=function(e){return o(e)?r(a(e)):i(e)}},function(e,t,n){"use strict";var r=n(86);e.exports=function(t){return function(e){return r(e,t)}}},function(e,t,n){"use strict";var a=n(21),s=n(8);e.exports=function(e,r){var i=-1,o=s(e)?Array(e.length):[];return a(e,function(e,t,n){o[++i]=r(e,t,n)}),o}},function(e,t,n){"use strict";var r=n(445),i=n(5);e.exports=function(e,t){return e&&r(e,t,i)}},function(e,t,n){"use strict";n=n(446)();e.exports=n},function(e,t,n){"use strict";e.exports=function(l){return function(e,t,n){for(var r=-1,i=Object(e),o=n(e),a=o.length;a--;){var s=o[l?a:++r];if(!1===t(i[s],s,i))break}return e}}},function(e,t,n){"use strict";var s=n(8);e.exports=function(o,a){return function(e,t){if(null!=e){if(!s(e))return o(e,t);for(var n=e.length,r=a?n:-1,i=Object(e);(a?r--:++r<n)&&!1!==t(i[r],r,i););}return e}}},function(e,t,n){"use strict";var r=n(35);e.exports=function(e){return"function"==typeof e?e:r}},function(e,t,n){"use strict";var r=n(32);e.exports=function(t,e){return r(e,function(e){return t[e]})}},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty;e.exports=function(e,t){return null!=e&&r.call(e,t)}},function(e,t,n){"use strict";var p=n(77),f=n(226),m=n(58),g=n(452),b=n(453),y=n(456),v=n(457),_=n(458),I=n(459),x=n(217),E=n(230),S=n(24),T=n(460),C=n(461),w=n(466),B=n(0),R=n(49),N=n(468),A=n(11),O=n(470),L=n(5),k=n(59),P="[object Arguments]",z="[object Function]",M="[object Object]",F={};F[P]=F["[object Array]"]=F["[object ArrayBuffer]"]=F["[object DataView]"]=F["[object Boolean]"]=F["[object Date]"]=F["[object Float32Array]"]=F["[object Float64Array]"]=F["[object Int8Array]"]=F["[object Int16Array]"]=F["[object Int32Array]"]=F["[object Map]"]=F["[object Number]"]=F[M]=F["[object RegExp]"]=F["[object Set]"]=F["[object String]"]=F["[object Symbol]"]=F["[object Uint8Array]"]=F["[object Uint8ClampedArray]"]=F["[object Uint16Array]"]=F["[object Uint32Array]"]=!0,F["[object Error]"]=F[z]=F["[object WeakMap]"]=!1,e.exports=function D(n,r,i,e,t,o){var a,s=1&r,l=2&r,c=4&r;if((a=i?t?i(n,e,t,o):i(n):a)===undefined){if(!A(n))return n;if(e=B(n)){if(a=T(n),!s)return v(n,a)}else{var u=S(n),h=u==z||"[object GeneratorFunction]"==u;if(R(n))return y(n,s);if(u==M||u==P||h&&!t){if(a=l||h?{}:w(n),!s)return l?I(n,b(a,n)):_(n,g(a,n))}else{if(!F[u])return t?n:{};a=C(n,u,s)}}if(h=(o=o||new p).get(n))return h;o.set(n,a),O(n)?n.forEach(function(e){a.add(D(e,r,i,e,n,o))}):N(n)&&n.forEach(function(e,t){a.set(t,D(e,r,i,t,n,o))});var d=e?undefined:(c?l?E:x:l?k:L)(n);f(d||n,function(e,t){d&&(e=n[t=e]),m(a,t,D(e,r,i,t,n,o))})}return a}},function(e,t,n){"use strict";var r=n(36),i=n(5);e.exports=function(e,t){return e&&r(t,i(t),e)}},function(e,t,n){"use strict";var r=n(36),i=n(59);e.exports=function(e,t){return e&&r(t,i(t),e)}},function(e,t,n){"use strict";var i=n(11),o=n(29),a=n(455),s=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return a(e);var t,n=o(e),r=[];for(t in e)("constructor"!=t||!n&&s.call(e,t))&&r.push(t);return r}},function(e,t,n){"use strict";e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},function(e,a,s){"use strict";!function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=s(10),r="object"==t(a)&&a&&!a.nodeType&&a,i=r&&"object"==t(e)&&e&&!e.nodeType&&e,i=i&&i.exports===r?n.Buffer:undefined,o=i?i.allocUnsafe:undefined;e.exports=function(e,t){return t?e.slice():(t=e.length,t=o?o(t):new e.constructor(t),e.copy(t),t)}}.call(this,s(44)(e))},function(e,t,n){"use strict";e.exports=function(e,t){var n=-1,r=e.length;for(t=t||Array(r);++n<r;)t[n]=e[n];return t}},function(e,t,n){"use strict";var r=n(36),i=n(83);e.exports=function(e,t){return r(e,i(e),t)}},function(e,t,n){"use strict";var r=n(36),i=n(228);e.exports=function(e,t){return r(e,i(e),t)}},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&r.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},function(e,t,n){"use strict";var i=n(89),o=n(462),a=n(463),s=n(464),l=n(465);e.exports=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return i(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return o(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return l(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return a(e);case"[object Set]":return new r;case"[object Symbol]":return s(e)}}},function(e,t,n){"use strict";var r=n(89);e.exports=function(e,t){return t=t?r(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength)}},function(e,t,n){"use strict";var r=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,r.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,n){"use strict";var n=n(25),n=n?n.prototype:undefined,r=n?n.valueOf:undefined;e.exports=function(e){return r?Object(r.call(e)):{}}},function(e,t,n){"use strict";var r=n(89);e.exports=function(e,t){return t=t?r(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.length)}},function(e,t,n){"use strict";var r=n(467),i=n(229),o=n(29);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:r(i(e))}},function(e,t,n){"use strict";var r=n(11),i=Object.create;function o(){}e.exports=function(e){if(!r(e))return{};if(i)return i(e);o.prototype=e;e=new o;return o.prototype=undefined,e}},function(e,t,n){"use strict";var r=n(469),i=n(31),n=n(50),n=n&&n.isMap,n=n?i(n):r;e.exports=n},function(e,t,n){"use strict";var r=n(24),i=n(12);e.exports=function(e){return i(e)&&"[object Map]"==r(e)}},function(e,t,n){"use strict";var r=n(471),i=n(31),n=n(50),n=n&&n.isSet,n=n?i(n):r;e.exports=n},function(e,t,n){"use strict";var r=n(24),i=n(12);e.exports=function(e){return i(e)&&"[object Set]"==r(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRINT_WARNING=t.PRINT_ERROR=void 0,t.PRINT_ERROR=function(e){console&&console.error&&console.error("Error: ".concat(e))},t.PRINT_WARNING=function(e){console&&console.warn&&console.warn("Warning: ".concat(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timer=void 0,t.timer=function(e){var t=(new Date).getTime(),e=e();return{time:(new Date).getTime()-t,value:e}}},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){function t(){}t.prototype=e;var n=new t;function r(){i(n.bar)}return r(),r(),e}Object.defineProperty(t,"__esModule",{value:!0}),t.toFastProperties=void 0,t.toFastProperties=r},function(e,t,n){"use strict";function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||r({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var i,o,a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=function(e){return e&&e.__esModule?e:{"default":e}},l=(Object.defineProperty(t,"__esModule",{value:!0}),t.buildInProdFollowPrefix=t.buildBetweenProdsFollowPrefix=t.computeAllProdsFollows=t.ResyncFollowsWalker=void 0,n(90)),c=n(234),u=s(n(3)),h=s(n(60)),d=n(237),p=n(2),f=(o=l.RestWalker,a(m,o),m.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},m.prototype.walkTerminal=function(e,t,n){},m.prototype.walkProdRef=function(e,t,n){e=g(e.referencedRule,e.idx)+this.topProd.name,n=t.concat(n),t=new p.Alternative({definition:n}),n=(0,c.first)(t);this.follows[e]=n},m);function m(e){var t=o.call(this)||this;return t.topProd=e,t.follows={},t}function g(e,t){return e.name+t+d.IN}t.ResyncFollowsWalker=f,t.computeAllProdsFollows=function(e){var t={};return(0,u["default"])(e,function(e){e=new f(e).startWalking();(0,h["default"])(t,e)}),t},t.buildBetweenProdsFollowPrefix=g,t.buildInProdFollowPrefix=function(e){return e.terminalType.name+e.idx+d.IN}},function(e,t,n){"use strict";var r=n(477);e.exports=function(e){return e?(e=r(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},function(e,t,n){"use strict";var r=n(478),i=n(11),o=n(57),a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,l=/^0o[0-7]+$/i,c=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(i(e)&&(t="function"==typeof e.valueOf?e.valueOf():e,e=i(t)?t+"":t),"string"!=typeof e)return 0===e?e:+e;e=r(e);var t=s.test(e);return t||l.test(e)?c(e.slice(2),t?2:8):a.test(e)?NaN:+e}},function(e,t,n){"use strict";var r=n(479),i=/^\s+/;e.exports=function(e){return e&&e.slice(0,r(e)+1).replace(i,"")}},function(e,t,n){"use strict";var r=/\s/;e.exports=function(e){for(var t=e.length;t--&&r.test(e.charAt(t)););return t}},function(e,t,n){"use strict";var r=n(20),i=n(12);e.exports=function(e){return i(e)&&"[object RegExp]"==r(e)}},function(e,t,n){"use strict";var l=n(86),c=n(482),u=n(56);e.exports=function(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var a=t[r],s=l(e,a);n(s,a)&&c(o,u(a,e),s)}return o}},function(e,t,n){"use strict";var h=n(58),d=n(56),p=n(55),f=n(11),m=n(34);e.exports=function(e,t,n,r){if(f(e))for(var i=-1,o=(t=d(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var l,c=m(t[i]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;i!=a&&(l=s[c],(u=r?r(l,c,s):undefined)===undefined&&(u=f(l)?l:p(t[i+1])?[]:{})),h(s,c,u),s=s[c]}return e}},function(e,t,n){"use strict";var r=n(94),l=n(61);e.exports=function(s){return r(function(e,t){var n=-1,r=t.length,i=1<r?t[r-1]:undefined,o=2<r?t[2]:undefined,i=3<s.length&&"function"==typeof i?(r--,i):undefined;for(o&&l(t[0],t[1],o)&&(i=r<3?undefined:i,r=1),e=Object(e);++n<r;){var a=t[n];a&&s(e,a,n,i)}return e})}},function(e,t,n){"use strict";var l=n(485),c=Math.max;e.exports=function(o,a,s){return a=c(a===undefined?o.length-1:a,0),function(){for(var e=arguments,t=-1,n=c(e.length-a,0),r=Array(n);++t<n;)r[t]=e[a+t];for(var t=-1,i=Array(a+1);++t<a;)i[t]=e[t];return i[a]=s(r),l(o,this,i)}}},function(e,t,n){"use strict";e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t,n){"use strict";var r=n(487),n=n(489)(r);e.exports=n},function(e,t,n){"use strict";var r=n(488),i=n(227),n=n(35);e.exports=i?function(e,t){return i(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:n},function(e,t,n){"use strict";e.exports=function(e){return function(){return e}}},function(e,t,n){"use strict";var o=Date.now;e.exports=function(n){var r=0,i=0;return function(){var e=o(),t=16-(e-i);if(i=e,0<t){if(800<=++r)return arguments[0]}else r=0;return n.apply(undefined,arguments)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GAstVisitor=void 0;var r=n(93);function i(){}i.prototype.visit=function(e){var t=e;switch(t.constructor){case r.NonTerminal:return this.visitNonTerminal(t);case r.Alternative:return this.visitAlternative(t);case r.Option:return this.visitOption(t);case r.RepetitionMandatory:return this.visitRepetitionMandatory(t);case r.RepetitionMandatoryWithSeparator:return this.visitRepetitionMandatoryWithSeparator(t);case r.RepetitionWithSeparator:return this.visitRepetitionWithSeparator(t);case r.Repetition:return this.visitRepetition(t);case r.Alternation:return this.visitAlternation(t);case r.Terminal:return this.visitTerminal(t);case r.Rule:return this.visitRule(t);default:throw Error("non exhaustive match")}},i.prototype.visitNonTerminal=function(e){},i.prototype.visitAlternative=function(e){},i.prototype.visitOption=function(e){},i.prototype.visitRepetition=function(e){},i.prototype.visitRepetitionMandatory=function(e){},i.prototype.visitRepetitionMandatoryWithSeparator=function(e){},i.prototype.visitRepetitionWithSeparator=function(e){},i.prototype.visitAlternation=function(e){},i.prototype.visitTerminal=function(e){},i.prototype.visitRule=function(e){},t.GAstVisitor=i},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.getProductionDslName=t.isBranchingProd=t.isOptionalProd=t.isSequenceProd=void 0,r(n(95))),o=r(n(62)),a=r(n(18)),s=n(93);t.isSequenceProd=function(e){return e instanceof s.Alternative||e instanceof s.Option||e instanceof s.Repetition||e instanceof s.RepetitionMandatory||e instanceof s.RepetitionMandatoryWithSeparator||e instanceof s.RepetitionWithSeparator||e instanceof s.Terminal||e instanceof s.Rule},t.isOptionalProd=function l(e,t){return void 0===t&&(t=[]),e instanceof s.Option||e instanceof s.Repetition||e instanceof s.RepetitionWithSeparator||(e instanceof s.Alternation?(0,i["default"])(e.definition,function(e){return l(e,t)}):!(e instanceof s.NonTerminal&&(0,a["default"])(t,e))&&e instanceof s.AbstractProduction&&(e instanceof s.NonTerminal&&t.push(e),(0,o["default"])(e.definition,function(e){return l(e,t)})))},t.isBranchingProd=function(e){return e instanceof s.Alternation},t.getProductionDslName=function(e){if(e instanceof s.NonTerminal)return"SUBRULE";if(e instanceof s.Option)return"OPTION";if(e instanceof s.Alternation)return"OR";if(e instanceof s.RepetitionMandatory)return"AT_LEAST_ONE";if(e instanceof s.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(e instanceof s.RepetitionWithSeparator)return"MANY_SEP";if(e instanceof s.Repetition)return"MANY";if(e instanceof s.Terminal)return"CONSUME";throw Error("non exhaustive match")}},function(e,t,n){"use strict";var o=n(21);e.exports=function(e,r){var i;return o(e,function(e,t,n){return!(i=r(e,t,n))}),!!i}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}},function(e,t,n){"use strict";var o=n(21);e.exports=function(e,r){var i=!0;return o(e,function(e,t,n){return i=!!r(e,t,n)}),i}},function(e,t,n){"use strict";e.exports=function(e){return e!=e}},function(e,t,n){"use strict";e.exports=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}},function(e,t,n){"use strict";var r=n(25),i=n(48),o=n(0),a=r?r.isConcatSpreadable:undefined;e.exports=function(e){return o(e)||i(e)||!!(a&&e&&e[a])}},function(e,t,n){"use strict";var p=n(79),f=n(235),m=n(236),g=n(80),b=n(499),y=n(81);e.exports=function(e,t,n){var r=-1,i=f,o=e.length,a=!0,s=[],l=s;if(n)a=!1,i=m;else if(200<=o){var c=t?null:b(e);if(c)return y(c);a=!1,i=g,l=new p}else l=t?[]:s;e:for(;++r<o;){var u=e[r],h=t?t(u):u,u=n||0!==u?u:0;if(a&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue e;t&&l.push(h),s.push(u)}else i(l,h,n)||(l!==s&&l.push(h),s.push(u))}return s}},function(e,t,n){"use strict";var r=n(212),i=n(99),n=n(81),n=r&&1/n(new r([,-0]))[1]==1/0?function(e){return new r(e)}:i;e.exports=n},function(e,t,n){"use strict";e.exports=function(e){return e&&e.length?e[0]:undefined}},function(e,t,n){"use strict";e.exports=function(t){if("function"!=typeof t)throw new TypeError("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}},function(e,t,n){"use strict";var p=n(79),f=n(235),m=n(236),g=n(32),b=n(31),y=n(80);e.exports=function(e,t,n,r){var i=-1,o=f,a=!0,s=e.length,l=[],c=t.length;if(s){n&&(t=g(t,b(n))),r?(o=m,a=!1):200<=t.length&&(o=y,a=!1,t=new p(t));e:for(;++i<s;){var u=e[i],h=null==n?u:n(u),u=r||0!==u?u:0;if(a&&h==h){for(var d=c;d--;)if(t[d]===h)continue e;l.push(u)}else o(t,h,r)||l.push(u)}}return l}},function(e,t,n){"use strict";var r=n(8),i=n(12);e.exports=function(e){return i(e)&&r(e)}},function(e,t,n){"use strict";var i=n(96),o=n(38),a=Math.max;e.exports=function(e,t,n){var r=null==e?0:e.length;return r?((n=null==n?0:o(n))<0&&(n=a(r+n,0)),i(e,t,n)):-1}},function(e,t,n){"use strict";var a=n(13),s=n(8),l=n(5);e.exports=function(o){return function(e,t,n){var r,i=Object(e),n=(s(e)||(r=a(t,3),e=l(e),t=function t(e){return r(i[e],e,i)}),o(e,t,n));return-1<n?i[r?e[n]:n]:undefined}}},function(e,t,n){"use strict";e.exports=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}},function(e,t,n){"use strict";e.exports=function(e,r,i,o,t){return t(e,function(e,t,n){i=o?(o=!1,e):r(i,e,t,n)}),i}},function(e,i,t){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r=function(e,t){return(r=Object.setPrototypeOf||n({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var r,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(i,"__esModule",{value:!0}),i.canMatchCharCode=i.firstCharOptimizedIndices=i.getOptimizedStartCodesIndices=i.failedOptimizationPrefixMsg=void 0,t(100)),l=a(t(0)),c=a(t(62)),u=a(t(3)),h=a(t(103)),d=a(t(15)),p=a(t(18)),f=t(37),m=t(105),g=t(238),b="Complement Sets are not supported for first char optimization";function y(e,a,s){switch(e.type){case"Disjunction":for(var t=0;t<e.value.length;t++)y(e.value[t],a,s);break;case"Alternative":for(var n=e.value,t=0;t<n.length;t++){var r=n[t];switch(r.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var i=r;switch(i.type){case"Character":v(i.value,a,s);break;case"Set":if(!0===i.complement)throw Error(b);(0,u["default"])(i.value,function(e){if("number"==typeof e)v(e,a,s);else{var t=e;if(!0===s)for(var n=t.from;n<=t.to;n++)v(n,a,s);else{for(n=t.from;n<=t.to&&n<g.minOptimizationVal;n++)v(n,a,s);if(t.to>=g.minOptimizationVal)for(var e=t.from>=g.minOptimizationVal?t.from:g.minOptimizationVal,r=t.to,e=(0,g.charCodeToOptimizedIndex)(e),i=(0,g.charCodeToOptimizedIndex)(r),o=e;o<=i;o++)a[o]=o}}});break;case"Group":y(i.value,a,s);break;default:throw Error("Non Exhaustive Match")}r=i.quantifier!==undefined&&0===i.quantifier.atLeast;if("Group"===i.type&&!1===I(i)||"Group"!==i.type&&!1==r)break}break;default:throw Error("non exhaustive match!")}return(0,d["default"])(a)}function v(e,t,n){var r,i=(0,g.charCodeToOptimizedIndex)(e);t[i]=i,!0===n&&(i=e,n=t,(e=(i=String.fromCharCode(i)).toUpperCase())!==i?(r=(0,g.charCodeToOptimizedIndex)(e.charCodeAt(0)),n[r]=r):(e=i.toLowerCase())!==i&&(r=(0,g.charCodeToOptimizedIndex)(e.charCodeAt(0)),n[r]=r))}function _(e,n){return(0,h["default"])(e.value,function(e){var t;return"number"==typeof e?(0,p["default"])(n,e):(t=e,(0,h["default"])(n,function(e){return t.from<=e&&e<=t.to})!==undefined)})}function I(e){var t=e.quantifier;return!(!t||0!==t.atLeast)||!!e.value&&((0,l["default"])(e.value)?(0,c["default"])(e.value,I):I(e.value))}i.failedOptimizationPrefixMsg='Unable to use "first char" lexer optimizations:\n',i.getOptimizedStartCodesIndices=function(e,t){void 0===t&&(t=!1);try{var n=(0,m.getRegExpAst)(e);return y(n.value,{},n.flags.ignoreCase)}catch(r){r.message===b?t&&(0,f.PRINT_WARNING)("".concat(i.failedOptimizationPrefixMsg)+"\tUnable to optimize: < ".concat(e.toString()," >\n")+"\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details."):(n=t?"\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.":"",(0,f.PRINT_ERROR)("".concat(i.failedOptimizationPrefixMsg,"\n")+"\tFailed parsing: < ".concat(e.toString()," >\n")+"\tUsing the regexp-to-ast library version: ".concat(s.VERSION,"\n")+"\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+n))}return[]},i.firstCharOptimizedIndices=y;x=s.BaseRegExpVisitor,o(S,x),S.prototype.visitChildren=function(e){if(!0!==this.found){switch(e.type){case"Lookahead":return void this.visitLookahead(e);case"NegativeLookahead":return void this.visitNegativeLookahead(e)}x.prototype.visitChildren.call(this,e)}},S.prototype.visitCharacter=function(e){(0,p["default"])(this.targetCharCodes,e.value)&&(this.found=!0)},S.prototype.visitSet=function(e){e.complement?_(e,this.targetCharCodes)===undefined&&(this.found=!0):_(e,this.targetCharCodes)!==undefined&&(this.found=!0)};var x,E=S;function S(e){var t=x.call(this)||this;return t.targetCharCodes=e,t.found=!1,t}i.canMatchCharCode=function(t,e){var n,r;return e instanceof RegExp?(n=(0,m.getRegExpAst)(e),(r=new E(t)).visit(n),r.found):(0,h["default"])(e,function(e){return(0,p["default"])(t,e.charCodeAt(0))})!==undefined}},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.validateGrammar=t.resolveGrammar=void 0,r(n(3))),o=r(n(241)),a=n(510),s=n(243),l=n(65);t.resolveGrammar=function(e){var t=(0,o["default"])(e,{errMsgProvider:l.defaultGrammarResolverErrorProvider}),n={};return(0,i["default"])(e.rules,function(e){n[e.name]=e}),(0,a.resolveGrammar)(n,t.errMsgProvider)},t.validateGrammar=function(e){return e=(0,o["default"])(e,{errMsgProvider:l.defaultGrammarValidatorErrorProvider}),(0,s.validateGrammar)(e.rules,e.maxLookahead,e.tokenTypes,e.errMsgProvider,e.grammarName)}},function(e,t,n){"use strict";function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||r({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var i,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.GastRefResolverVisitor=t.resolveGrammar=void 0,n(6)),l=a(n(3)),c=a(n(15)),a=n(2);t.resolveGrammar=function(e,t){return(e=new h(e,t)).resolveRefs(),e.errors};u=a.GAstVisitor,o(d,u),d.prototype.resolveRefs=function(){var t=this;(0,l["default"])((0,c["default"])(this.nameToTopRule),function(e){(t.currTopLevel=e).accept(t)})},d.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule[e.nonTerminalName];t?e.referencedRule=t:(t=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e),this.errors.push({message:t,type:s.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName}))};var u,h=d;function d(e,t){var n=u.call(this)||this;return n.nameToTopRule=e,n.errMsgProvider=t,n.errors=[],n}t.GastRefResolverVisitor=h},function(e,t,n){"use strict";var a=n(512),s=n(513),l=n(13),c=n(0);e.exports=function(i,o){return function(e,t){var n=c(e)?a:s,r=o?o():{};return n(e,i,l(t,2),r)}}},function(e,t,n){"use strict";e.exports=function(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(r,a,n(a),e)}return r}},function(e,t,n){"use strict";var a=n(21);e.exports=function(e,r,i,o){return a(e,function(e,t,n){r(o,e,i(e),n)}),o}},function(e,t,n){"use strict";var r=n(97),i=n(4);e.exports=function(e,t){return r(i(e,t),1)}},function(e,t,n){"use strict";function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||r({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var i,o,a=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=function(e){return e&&e.__esModule?e:{"default":e}},l=(Object.defineProperty(t,"__esModule",{value:!0}),t.collectMethods=t.LooksAhead=void 0,n(66)),c=s(n(3)),u=s(n(7)),h=n(6),d=n(108),s=n(2),p=n(2);function f(){}function m(){var e=null!==o&&o.apply(this,arguments)||this;return e.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},e}f.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=((0,u["default"])(e,"dynamicTokensEnabled")?e:h.DEFAULT_PARSER_CONFIG).dynamicTokensEnabled,this.maxLookahead=((0,u["default"])(e,"maxLookahead")?e:h.DEFAULT_PARSER_CONFIG).maxLookahead,this.lookAheadFuncsCache=new Map},f.prototype.preComputeLookaheadFunctions=function(e){var s=this;(0,c["default"])(e,function(a){s.TRACE_INIT("".concat(a.name," Rule Lookahead"),function(){var e=b(a),t=e.alternation,n=e.repetition,r=e.option,i=e.repetitionMandatory,o=e.repetitionMandatoryWithSeparator,e=e.repetitionWithSeparator;(0,c["default"])(t,function(n){var e=0===n.idx?"":n.idx;s.TRACE_INIT("".concat((0,p.getProductionDslName)(n)).concat(e),function(){var e=(0,l.buildLookaheadFuncForOr)(n.idx,a,n.maxLookahead||s.maxLookahead,n.hasPredicates,s.dynamicTokensEnabled,s.lookAheadBuilderForAlternatives),t=(0,d.getKeyForAutomaticLookahead)(s.fullRuleNameToShort[a.name],d.OR_IDX,n.idx);s.setLaFuncCache(t,e)})}),(0,c["default"])(n,function(e){s.computeLookaheadFunc(a,e.idx,d.MANY_IDX,l.PROD_TYPE.REPETITION,e.maxLookahead,(0,p.getProductionDslName)(e))}),(0,c["default"])(r,function(e){s.computeLookaheadFunc(a,e.idx,d.OPTION_IDX,l.PROD_TYPE.OPTION,e.maxLookahead,(0,p.getProductionDslName)(e))}),(0,c["default"])(i,function(e){s.computeLookaheadFunc(a,e.idx,d.AT_LEAST_ONE_IDX,l.PROD_TYPE.REPETITION_MANDATORY,e.maxLookahead,(0,p.getProductionDslName)(e))}),(0,c["default"])(o,function(e){s.computeLookaheadFunc(a,e.idx,d.AT_LEAST_ONE_SEP_IDX,l.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,e.maxLookahead,(0,p.getProductionDslName)(e))}),(0,c["default"])(e,function(e){s.computeLookaheadFunc(a,e.idx,d.MANY_SEP_IDX,l.PROD_TYPE.REPETITION_WITH_SEPARATOR,e.maxLookahead,(0,p.getProductionDslName)(e))})})})},f.prototype.computeLookaheadFunc=function(n,r,i,o,a,e){var s=this;this.TRACE_INIT("".concat(e).concat(0===r?"":r),function(){var e=(0,l.buildLookaheadFuncForOptionalProd)(r,n,a||s.maxLookahead,s.dynamicTokensEnabled,o,s.lookAheadBuilderForOptional),t=(0,d.getKeyForAutomaticLookahead)(s.fullRuleNameToShort[n.name],i,r);s.setLaFuncCache(t,e)})},f.prototype.lookAheadBuilderForOptional=function(e,t,n){return(0,l.buildSingleAlternativeLookaheadFunction)(e,t,n)},f.prototype.lookAheadBuilderForAlternatives=function(e,t,n,r){return(0,l.buildAlternativesLookAheadFunc)(e,t,n,r)},f.prototype.getKeyForAutomaticLookahead=function(e,t){var n=this.getLastExplicitRuleShortName();return(0,d.getKeyForAutomaticLookahead)(n,e,t)},f.prototype.getLaFuncFromCache=function(e){return this.lookAheadFuncsCache.get(e)},f.prototype.setLaFuncCache=function(e,t){this.lookAheadFuncsCache.set(e,t)},t.LooksAhead=f,o=s.GAstVisitor,a(m,o),m.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},m.prototype.visitOption=function(e){this.dslMethods.option.push(e)},m.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},m.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},m.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},m.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},m.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)};var g=new m;function b(e){g.reset(),e.accept(g);e=g.dslMethods;return g.reset(),e}t.collectMethods=b},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.TreeBuilder=void 0,n(517)),o=r(n(99)),a=r(n(7)),s=r(n(5)),l=r(n(22)),c=n(518),u=n(6);function h(){}h.prototype.initTreeBuilder=function(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=((0,a["default"])(e,"nodeLocationTracking")?e:u.DEFAULT_PARSER_CONFIG).nodeLocationTracking,this.outputCst)if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=i.setNodeLocationFull,this.setNodeLocationFromNode=i.setNodeLocationFull,this.cstPostRule=o["default"],this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=o["default"],this.setNodeLocationFromNode=o["default"],this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=i.setNodeLocationOnlyOffset,this.setNodeLocationFromNode=i.setNodeLocationOnlyOffset,this.cstPostRule=o["default"],this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=o["default"],this.setNodeLocationFromNode=o["default"],this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else{if(!/none/i.test(this.nodeLocationTracking))throw Error('Invalid <nodeLocationTracking> config option: "'.concat(e.nodeLocationTracking,'"'));this.setNodeLocationFromToken=o["default"],this.setNodeLocationFromNode=o["default"],this.cstPostRule=o["default"],this.setInitialNodeLocation=o["default"]}else this.cstInvocationStateUpdate=o["default"],this.cstFinallyStateUpdate=o["default"],this.cstPostTerminal=o["default"],this.cstPostNonTerminal=o["default"],this.cstPostRule=o["default"]},h.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(e){e.location={startOffset:NaN,endOffset:NaN}},h.prototype.setInitialNodeLocationOnlyOffsetRegular=function(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},h.prototype.setInitialNodeLocationFullRecovery=function(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},h.prototype.setInitialNodeLocationFullRegular=function(e){var t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},h.prototype.cstInvocationStateUpdate=function(e){e={name:e,children:Object.create(null)};this.setInitialNodeLocation(e),this.CST_STACK.push(e)},h.prototype.cstFinallyStateUpdate=function(){this.CST_STACK.pop()},h.prototype.cstPostRuleFull=function(e){var t=this.LA(0),e=e.location;e.startOffset<=t.startOffset==!0?(e.endOffset=t.endOffset,e.endLine=t.endLine,e.endColumn=t.endColumn):(e.startOffset=NaN,e.startLine=NaN,e.startColumn=NaN)},h.prototype.cstPostRuleOnlyOffset=function(e){var t=this.LA(0),e=e.location;e.startOffset<=t.startOffset==!0?e.endOffset=t.endOffset:e.startOffset=NaN},h.prototype.cstPostTerminal=function(e,t){var n=this.CST_STACK[this.CST_STACK.length-1];(0,i.addTerminalToCst)(n,t,e),this.setNodeLocationFromToken(n.location,t)},h.prototype.cstPostNonTerminal=function(e,t){var n=this.CST_STACK[this.CST_STACK.length-1];(0,i.addNoneTerminalToCst)(n,t,e),this.setNodeLocationFromNode(n.location,e.location)},h.prototype.getBaseCstVisitorConstructor=function(){var e;return(0,l["default"])(this.baseCstVisitorConstructor)?(e=(0,c.createBaseSemanticVisitorConstructor)(this.className,(0,s["default"])(this.gastProductionsCache)),this.baseCstVisitorConstructor=e):this.baseCstVisitorConstructor},h.prototype.getBaseCstVisitorConstructorWithDefaults=function(){var e;return(0,l["default"])(this.baseCstVisitorWithDefaultsConstructor)?(e=(0,c.createBaseVisitorConstructorWithDefaults)(this.className,(0,s["default"])(this.gastProductionsCache),this.getBaseCstVisitorConstructor()),this.baseCstVisitorWithDefaultsConstructor=e):this.baseCstVisitorWithDefaultsConstructor},h.prototype.getLastExplicitRuleShortName=function(){var e=this.RULE_STACK;return e[e.length-1]},h.prototype.getPreviousExplicitRuleShortName=function(){var e=this.RULE_STACK;return e[e.length-2]},h.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},t.TreeBuilder=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addNoneTerminalToCst=t.addTerminalToCst=t.setNodeLocationFull=t.setNodeLocationOnlyOffset=void 0,t.setNodeLocationOnlyOffset=function(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset==!0&&(e.endOffset=t.endOffset)},t.setNodeLocationFull=function(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset==!0&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)},t.addTerminalToCst=function(e,t,n){e.children[n]===undefined?e.children[n]=[t]:e.children[n].push(t)},t.addNoneTerminalToCst=function(e,t,n){e.children[t]===undefined?e.children[t]=[n]:e.children[t].push(n)}},function(e,t,n){"use strict";var r,i=function(e){return e&&e.__esModule?e:{"default":e}},o=(Object.defineProperty(t,"__esModule",{value:!0}),t.validateMissingCstMethods=t.validateVisitor=t.CstVisitorDefinitionError=t.createBaseVisitorConstructorWithDefaults=t.createBaseSemanticVisitorConstructor=t.defaultVisit=void 0,i(n(9))),a=i(n(64)),s=i(n(0)),l=i(n(4)),c=i(n(3)),u=i(n(104)),h=i(n(5)),d=i(n(30)),p=i(n(22)),f=n(519);function m(e,t){for(var n=(0,h["default"])(e),r=n.length,i=0;i<r;i++)for(var o=e[n[i]],a=o.length,s=0;s<a;s++){var l=o[s];l.tokenTypeIdx===undefined&&this[l.name](l.children,t)}}function g(e,t){return b(e,t)}function b(t,e){e=(0,u["default"])(e,function(e){return!1===(0,d["default"])(t[e])}),e=(0,l["default"])(e,function(e){return{msg:"Missing visitor method: <".concat(e,"> on ").concat(t.constructor.name," CST Visitor."),type:r.MISSING_METHOD,methodName:e}});return(0,a["default"])(e)}t.defaultVisit=m,t.createBaseSemanticVisitorConstructor=function(e,t){var n=function n(){};return(0,f.defineNameProp)(n,e+"BaseSemantics"),n.prototype={visit:function(e,t){return(0,s["default"])(e)&&(e=e[0]),(0,p["default"])(e)?undefined:this[e.name](e.children,t)},validateVisitor:function(){var e=g(this,t);if(!(0,o["default"])(e))throw e=(0,l["default"])(e,function(e){return e.msg}),Error("Errors Detected in CST Visitor <".concat(this.constructor.name,">:\n\t")+"".concat(e.join("\n\n").replace(/\n/g,"\n\t")))}},(n.prototype.constructor=n)._RULE_NAMES=t,n},t.createBaseVisitorConstructorWithDefaults=function(e,t,n){var r=function r(){},i=((0,f.defineNameProp)(r,e+"BaseSemanticsWithDefaults"),Object.create(n.prototype));return(0,c["default"])(t,function(e){i[e]=m}),r.prototype=i,r.prototype.constructor=r},(i=r=t.CstVisitorDefinitionError||(t.CstVisitorDefinitionError={}))[i.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",i[i.MISSING_METHOD=1]="MISSING_METHOD",t.validateVisitor=g,t.validateMissingCstMethods=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineNameProp=void 0;t.defineNameProp=function(e,t){Object.defineProperty(e,"name",{enumerable:!1,configurable:!0,writable:!1,value:t})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LexerAdapter=void 0;var r=n(6);function i(){}i.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(i.prototype,"input",{get:function(){return this.tokVector},set:function(e){if(!0!==this.selfAnalysisDone)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!1,configurable:!0}),i.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):r.END_OF_FILE},i.prototype.LA=function(e){e=this.currIdx+e;return e<0||this.tokVectorLength<=e?r.END_OF_FILE:this.tokVector[e]},i.prototype.consumeToken=function(){this.currIdx++},i.prototype.exportLexerState=function(){return this.currIdx},i.prototype.importLexerState=function(e){this.currIdx=e},i.prototype.resetLexerState=function(){this.currIdx=-1},i.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},i.prototype.getLexerPosition=function(){return this.exportLexerState()},t.LexerAdapter=i},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.RecognizerApi=void 0,r(n(15))),o=r(n(18)),a=n(41),s=n(6),l=n(65),c=n(243),u=n(2);function h(){}h.prototype.ACTION=function(e){return e.call(this)},h.prototype.consume=function(e,t,n){return this.consumeInternal(t,e,n)},h.prototype.subrule=function(e,t,n){return this.subruleInternal(t,e,n)},h.prototype.option=function(e,t){return this.optionInternal(t,e)},h.prototype.or=function(e,t){return this.orInternal(t,e)},h.prototype.many=function(e,t){return this.manyInternal(e,t)},h.prototype.atLeastOne=function(e,t){return this.atLeastOneInternal(e,t)},h.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},h.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},h.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},h.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},h.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},h.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},h.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},h.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},h.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},h.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},h.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},h.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},h.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},h.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},h.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},h.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},h.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},h.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},h.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},h.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},h.prototype.OPTION=function(e){return this.optionInternal(e,0)},h.prototype.OPTION1=function(e){return this.optionInternal(e,1)},h.prototype.OPTION2=function(e){return this.optionInternal(e,2)},h.prototype.OPTION3=function(e){return this.optionInternal(e,3)},h.prototype.OPTION4=function(e){return this.optionInternal(e,4)},h.prototype.OPTION5=function(e){return this.optionInternal(e,5)},h.prototype.OPTION6=function(e){return this.optionInternal(e,6)},h.prototype.OPTION7=function(e){return this.optionInternal(e,7)},h.prototype.OPTION8=function(e){return this.optionInternal(e,8)},h.prototype.OPTION9=function(e){return this.optionInternal(e,9)},h.prototype.OR=function(e){return this.orInternal(e,0)},h.prototype.OR1=function(e){return this.orInternal(e,1)},h.prototype.OR2=function(e){return this.orInternal(e,2)},h.prototype.OR3=function(e){return this.orInternal(e,3)},h.prototype.OR4=function(e){return this.orInternal(e,4)},h.prototype.OR5=function(e){return this.orInternal(e,5)},h.prototype.OR6=function(e){return this.orInternal(e,6)},h.prototype.OR7=function(e){return this.orInternal(e,7)},h.prototype.OR8=function(e){return this.orInternal(e,8)},h.prototype.OR9=function(e){return this.orInternal(e,9)},h.prototype.MANY=function(e){this.manyInternal(0,e)},h.prototype.MANY1=function(e){this.manyInternal(1,e)},h.prototype.MANY2=function(e){this.manyInternal(2,e)},h.prototype.MANY3=function(e){this.manyInternal(3,e)},h.prototype.MANY4=function(e){this.manyInternal(4,e)},h.prototype.MANY5=function(e){this.manyInternal(5,e)},h.prototype.MANY6=function(e){this.manyInternal(6,e)},h.prototype.MANY7=function(e){this.manyInternal(7,e)},h.prototype.MANY8=function(e){this.manyInternal(8,e)},h.prototype.MANY9=function(e){this.manyInternal(9,e)},h.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},h.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},h.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},h.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},h.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},h.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},h.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},h.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},h.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},h.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},h.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},h.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},h.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},h.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},h.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},h.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},h.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},h.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},h.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},h.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},h.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},h.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},h.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},h.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},h.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},h.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},h.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},h.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},h.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},h.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},h.prototype.RULE=function(e,t,n){void 0===n&&(n=s.DEFAULT_RULE_CONFIG),(0,o["default"])(this.definedRulesNames,e)&&(r={message:l.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:s.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e},this.definitionErrors.push(r)),this.definedRulesNames.push(e);var r=this.defineRule(e,t,n);return this[e]=r},h.prototype.OVERRIDE_RULE=function(e,t,n){void 0===n&&(n=s.DEFAULT_RULE_CONFIG);var r=(0,c.validateRuleIsOverridden)(e,this.definedRulesNames,this.className),r=(this.definitionErrors=this.definitionErrors.concat(r),this.defineRule(e,t,n));return this[e]=r},h.prototype.BACKTRACK=function(n,r){return function(){this.isBackTrackingStack.push(1);var e=this.saveRecogState();try{return n.apply(this,r),!0}catch(t){if((0,a.isRecognitionException)(t))return!1;throw t}finally{this.reloadRecogState(e),this.isBackTrackingStack.pop()}}},h.prototype.getGAstProductions=function(){return this.gastProductionsCache},h.prototype.getSerializedGastProductions=function(){return(0,u.serializeGrammar)((0,i["default"])(this.gastProductionsCache))},t.RecognizerApi=h},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.RecognizerEngine=void 0,r(n(9))),o=r(n(0)),a=r(n(16)),s=r(n(62)),l=r(n(98)),c=r(n(11)),u=r(n(7)),h=r(n(15)),d=r(n(23)),p=r(n(17)),f=n(108),m=n(41),g=n(66),b=n(67),y=n(6),v=n(245),_=n(26),I=n(27);function x(){}x.prototype.initRecognizerEngine=function(e,t){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=I.tokenStructuredMatcherNoCategories,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},(0,u["default"])(t,"serializedGrammar"))throw Error("The Parser's configuration can no longer contain a <serializedGrammar> property.\n\tSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0\n\tFor Further details.");if((0,o["default"])(e)){if((0,i["default"])(e))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if((0,o["default"])(e))this.tokensMap=(0,d["default"])(e,function(e,t){return e[t.name]=t,e},{});else if((0,u["default"])(e,"modes")&&(0,s["default"])((0,a["default"])((0,h["default"])(e.modes)),I.isTokenType)){t=(0,a["default"])((0,h["default"])(e.modes)),t=(0,l["default"])(t);this.tokensMap=(0,d["default"])(t,function(e,t){return e[t.name]=t,e},{})}else{if(!(0,c["default"])(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=(0,p["default"])(e)}this.tokensMap.EOF=_.EOF;t=(0,u["default"])(e,"modes")?(0,a["default"])((0,h["default"])(e.modes)):(0,h["default"])(e),e=(0,s["default"])(t,function(e){return(0,i["default"])(e.categoryMatches)});this.tokenMatcher=e?I.tokenStructuredMatcherNoCategories:I.tokenStructuredMatcher,(0,I.augmentTokenTypes)((0,h["default"])(this.tokensMap))},x.prototype.defineRule=function(i,o,e){if(this.selfAnalysisDone)throw Error("Grammar rule <".concat(i,"> may not be defined after the 'performSelfAnalysis' method has been called'\n")+"Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var a,s=((0,u["default"])(e,"resyncEnabled")?e:y.DEFAULT_RULE_CONFIG).resyncEnabled,l=((0,u["default"])(e,"recoveryValueFunc")?e:y.DEFAULT_RULE_CONFIG).recoveryValueFunc,c=this.ruleShortNameIdx<<f.BITS_FOR_METHOD_TYPE+f.BITS_FOR_OCCURRENCE_IDX;return this.ruleShortNameIdx++,this.shortRuleNameToFull[c]=i,this.fullRuleNameToShort[i]=c,a=!0===this.outputCst?function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{this.ruleInvocationStateUpdate(c,i,this.subruleIdx),o.apply(this,e);var n=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(n),n}catch(r){return this.invokeRuleCatch(r,s,l)}finally{this.ruleFinallyStateUpdate()}}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return this.ruleInvocationStateUpdate(c,i,this.subruleIdx),o.apply(this,e)}catch(n){return this.invokeRuleCatch(n,s,l)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:i,originalGrammarAction:o})},x.prototype.invokeRuleCatch=function(e,t,n){var r=1===this.RULE_STACK.length,t=t&&!this.isBackTracking()&&this.recoveryEnabled;if((0,m.isRecognitionException)(e)){var i=e;if(t){var o,t=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(t))return i.resyncedTokens=this.reSyncTo(t),this.outputCst?((o=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,o):n();this.outputCst&&((o=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,i.partialCstResult=o)}else if(r)return this.moveToTerminatedState(),n();throw i}throw e},x.prototype.optionInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.OPTION_IDX,t);return this.optionInternalLogic(e,t,n)},x.prototype.optionInternalLogic=function(e,t,n){var r,i,o,a=this,s=this.getLaFuncFromCache(n);return"function"!=typeof e?(r=e.DEF,(i=e.GATE)!==undefined&&(o=s,s=function s(){return i.call(a)&&o.call(a)})):r=e,!0===s.call(this)?r.call(this):undefined},x.prototype.atLeastOneInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.AT_LEAST_ONE_IDX,e);return this.atLeastOneInternalLogic(e,t,n)},x.prototype.atLeastOneInternalLogic=function(e,t,n){var r,i,o,a=this,s=this.getLaFuncFromCache(n);if("function"!=typeof t?(r=t.DEF,(i=t.GATE)!==undefined&&(o=s,s=function s(){return i.call(a)&&o.call(a)})):r=t,!0!==s.call(this))throw this.raiseEarlyExitException(e,g.PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);for(var l=this.doSingleRepetition(r);!0===s.call(this)&&!0===l;)l=this.doSingleRepetition(r);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],s,f.AT_LEAST_ONE_IDX,e,b.NextTerminalAfterAtLeastOneWalker)},x.prototype.atLeastOneSepFirstInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,n)},x.prototype.atLeastOneSepFirstInternalLogic=function(e,t,n){var r=this,i=t.DEF,o=t.SEP;if(!0!==this.getLaFuncFromCache(n).call(this))throw this.raiseEarlyExitException(e,g.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);i.call(this);for(var a=function a(){return r.tokenMatcher(r.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,o,a,i,b.NextTerminalAfterAtLeastOneSepWalker],a,f.AT_LEAST_ONE_SEP_IDX,e,b.NextTerminalAfterAtLeastOneSepWalker)},x.prototype.manyInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.MANY_IDX,e);return this.manyInternalLogic(e,t,n)},x.prototype.manyInternalLogic=function(e,t,n){for(var r,i,o,a=this,s=this.getLaFuncFromCache(n),l=("function"!=typeof t?(r=t.DEF,(i=t.GATE)!==undefined&&(o=s,s=function s(){return i.call(a)&&o.call(a)})):r=t,!0);!0===s.call(this)&&!0===l;)l=this.doSingleRepetition(r);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],s,f.MANY_IDX,e,b.NextTerminalAfterManyWalker,l)},x.prototype.manySepFirstInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,n)},x.prototype.manySepFirstInternalLogic=function(e,t,n){var r=this,i=t.DEF,o=t.SEP;if(!0===this.getLaFuncFromCache(n).call(this)){i.call(this);for(var a=function a(){return r.tokenMatcher(r.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,o,a,i,b.NextTerminalAfterManySepWalker],a,f.MANY_SEP_IDX,e,b.NextTerminalAfterManySepWalker)}},x.prototype.repetitionSepSecondInternal=function(e,t,n,r,i){for(;n();)this.CONSUME(t),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,n,r,i],n,f.AT_LEAST_ONE_SEP_IDX,e,i)},x.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),t<this.getLexerPosition()},x.prototype.orInternal=function(e,t){var n=this.getKeyForAutomaticLookahead(f.OR_IDX,t),r=(0,o["default"])(e)?e:e.DEF,n=this.getLaFuncFromCache(n).call(this,r);if(n!==undefined)return r[n].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)},x.prototype.ruleFinallyStateUpdate=function(){var e,t;this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!1===this.isAtEndOfInput()&&(e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new m.NotAllInputParsedException(t,e)))},x.prototype.subruleInternal=function(e,t,n){var r;try{var i=n!==undefined?n.ARGS:undefined;return this.subruleIdx=t,r=e.apply(this,i),this.cstPostNonTerminal(r,n!==undefined&&n.LABEL!==undefined?n.LABEL:e.ruleName),r}catch(o){throw this.subruleInternalError(o,n,e.ruleName)}},x.prototype.subruleInternalError=function(e,t,n){throw(0,m.isRecognitionException)(e)&&e.partialCstResult!==undefined&&(this.cstPostNonTerminal(e.partialCstResult,t!==undefined&&t.LABEL!==undefined?t.LABEL:n),delete e.partialCstResult),e},x.prototype.consumeInternal=function(e,t,n){var r;try{var i=this.LA(1);!0===this.tokenMatcher(i,e)?(this.consumeToken(),r=i):this.consumeInternalError(e,i,n)}catch(o){r=this.consumeInternalRecovery(e,t,o)}return this.cstPostTerminal(n!==undefined&&n.LABEL!==undefined?n.LABEL:e.name,r),r},x.prototype.consumeInternalError=function(e,t,n){var r=this.LA(0),n=n!==undefined&&n.ERR_MSG?n.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:r,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new m.MismatchedTokenException(n,t,r))},x.prototype.consumeInternalRecovery=function(e,t,n){if(!this.recoveryEnabled||"MismatchedTokenException"!==n.name||this.isBackTracking())throw n;t=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,t)}catch(r){throw r.name===v.IN_RULE_RECOVERY_EXCEPTION?n:r}},x.prototype.saveRecogState=function(){var e=this.errors,t=(0,p["default"])(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK}},x.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},x.prototype.ruleInvocationStateUpdate=function(e,t,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t)},x.prototype.isBackTracking=function(){return 0!==this.isBackTrackingStack.length},x.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]},x.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull[e]},x.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),_.EOF)},x.prototype.reset=function(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},t.RecognizerEngine=x},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorHandler=void 0,n(41)),i=r(n(7)),o=r(n(17)),l=n(66),a=n(6);function c(){}c.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=((0,i["default"])(e,"errorMessageProvider")?e:a.DEFAULT_PARSER_CONFIG).errorMessageProvider},c.prototype.SAVE_ERROR=function(e){if((0,s.isRecognitionException)(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:(0,o["default"])(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(c.prototype,"errors",{get:function(){return(0,o["default"])(this._errors)},set:function(e){this._errors=e},enumerable:!1,configurable:!0}),c.prototype.raiseEarlyExitException=function(e,t,n){for(var r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],e=(0,l.getLookaheadPathsForOptionalProd)(e,i,t,this.maxLookahead)[0],o=[],a=1;a<=this.maxLookahead;a++)o.push(this.LA(a));i=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:e,actual:o,previous:this.LA(0),customUserDescription:n,ruleName:r});throw this.SAVE_ERROR(new s.EarlyExitException(i,this.LA(1),this.LA(0)))},c.prototype.raiseNoAltException=function(e,t){for(var n=this.getCurrRuleFullName(),n=this.getGAstProductions()[n],e=(0,l.getLookaheadPathsForOr)(e,n,this.maxLookahead),r=[],i=1;i<=this.maxLookahead;i++)r.push(this.LA(i));n=this.LA(0),e=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:e,actual:r,previous:n,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new s.NoViableAltException(e,this.LA(1),n))},t.ErrorHandler=c},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.ContentAssist=void 0,n(67)),o=r(n(40)),a=r(n(22));function s(){}s.prototype.initContentAssist=function(){},s.prototype.computeContentAssist=function(e,t){var n=this.gastProductionsCache[e];if((0,a["default"])(n))throw Error("Rule ->".concat(e,"<- does not exist in this grammar."));return(0,i.nextPossibleTokensAfter)([n],t,this.tokenMatcher,this.maxLookahead)},s.prototype.getNextPossibleTokenTypes=function(e){var t=(0,o["default"])(e.ruleStack),t=this.getGAstProductions()[t];return new i.NextAfterTokenWalker(t,e).startWalking()},t.ContentAssist=s},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.GastRecorder=void 0,r(n(106))),l=r(n(0)),c=r(n(95)),u=r(n(3)),h=r(n(30)),d=r(n(7)),p=n(2),r=n(63),i=n(27),o=n(26),a=n(6),n=n(108),f={description:"This Object indicates the Parser is during Recording Phase"},m=(Object.freeze(f),Math.pow(2,n.BITS_FOR_OCCURRENCE_IDX)-1),n=(0,o.createToken)({name:"RECORDING_PHASE_TOKEN",pattern:r.Lexer.NA}),g=((0,i.augmentTokenTypes)([n]),(0,o.createTokenInstance)(n,"This IToken indicates the Parser is in Recording Phase\n\tSee: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",-1,-1,-1,-1,-1,-1)),b=(Object.freeze(g),{name:"This CSTNode indicates the Parser is in Recording Phase\n\tSee: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",children:{}});function y(){}function v(e,t,n,r){void 0===r&&(r=!1),I(n);var i=(0,s["default"])(this.recordingProdStack),o=(0,h["default"])(t)?t:t.DEF,n=new e({definition:[],idx:n});return r&&(n.separator=t.SEP),(0,d["default"])(t,"MAX_LOOKAHEAD")&&(n.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(n),o.call(this),i.definition.push(n),this.recordingProdStack.pop(),f}function _(e){return 0===e?"":"".concat(e)}function I(e){if(e<0||m<e)throw(e=new Error("Invalid DSL Method idx value: <".concat(e,">\n\t")+"Idx value must be a none negative value smaller than ".concat(m+1))).KNOWN_RECORDER_ERROR=!0,e}y.prototype.initGastRecorder=function(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1},y.prototype.enableRecording=function(){var r=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",function(){for(var t=function t(n){var e=0<n?n:"";r["CONSUME".concat(e)]=function(e,t){return this.consumeInternalRecord(e,n,t)},r["SUBRULE".concat(e)]=function(e,t){return this.subruleInternalRecord(e,n,t)},r["OPTION".concat(e)]=function(e){return this.optionInternalRecord(e,n)},r["OR".concat(e)]=function(e){return this.orInternalRecord(e,n)},r["MANY".concat(e)]=function(e){this.manyInternalRecord(n,e)},r["MANY_SEP".concat(e)]=function(e){this.manySepFirstInternalRecord(n,e)},r["AT_LEAST_ONE".concat(e)]=function(e){this.atLeastOneInternalRecord(n,e)},r["AT_LEAST_ONE_SEP".concat(e)]=function(e){this.atLeastOneSepFirstInternalRecord(n,e)}},e=0;e<10;e++)t(e);r.consume=function(e,t,n){return this.consumeInternalRecord(t,e,n)},r.subrule=function(e,t,n){return this.subruleInternalRecord(t,e,n)},r.option=function(e,t){return this.optionInternalRecord(t,e)},r.or=function(e,t){return this.orInternalRecord(t,e)},r.many=function(e,t){this.manyInternalRecord(e,t)},r.atLeastOne=function(e,t){this.atLeastOneInternalRecord(e,t)},r.ACTION=r.ACTION_RECORD,r.BACKTRACK=r.BACKTRACK_RECORD,r.LA=r.LA_RECORD})},y.prototype.disableRecording=function(){var r=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",function(){for(var e=r,t=0;t<10;t++){var n=0<t?t:"";delete e["CONSUME".concat(n)],delete e["SUBRULE".concat(n)],delete e["OPTION".concat(n)],delete e["OR".concat(n)],delete e["MANY".concat(n)],delete e["MANY_SEP".concat(n)],delete e["AT_LEAST_ONE".concat(n)],delete e["AT_LEAST_ONE_SEP".concat(n)]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})},y.prototype.ACTION_RECORD=function(e){},y.prototype.BACKTRACK_RECORD=function(e,t){return function(){return!0}},y.prototype.LA_RECORD=function(e){return a.END_OF_FILE},y.prototype.topLevelRuleRecord=function(e,t){try{var n=new p.Rule({definition:[],name:e});return n.name=e,this.recordingProdStack.push(n),t.call(this),this.recordingProdStack.pop(),n}catch(r){if(!0!==r.KNOWN_RECORDER_ERROR)try{r.message=r.message+'\n\t This error was thrown during the "grammar recording phase" For more info see:\n\thttps://chevrotain.io/docs/guide/internals.html#grammar-recording'}catch(i){}throw r}},y.prototype.optionInternalRecord=function(e,t){return v.call(this,p.Option,e,t)},y.prototype.atLeastOneInternalRecord=function(e,t){v.call(this,p.RepetitionMandatory,t,e)},y.prototype.atLeastOneSepFirstInternalRecord=function(e,t){v.call(this,p.RepetitionMandatoryWithSeparator,t,e,!0)},y.prototype.manyInternalRecord=function(e,t){v.call(this,p.Repetition,t,e)},y.prototype.manySepFirstInternalRecord=function(e,t){v.call(this,p.RepetitionWithSeparator,t,e,!0)},y.prototype.orInternalRecord=function(e,t){return function(e,t){var n=this,r=(I(t),(0,s["default"])(this.recordingProdStack)),i=!1===(0,l["default"])(e),o=!1==i?e:e.DEF,a=new p.Alternation({definition:[],idx:t,ignoreAmbiguities:i&&!0===e.IGNORE_AMBIGUITIES});(0,d["default"])(e,"MAX_LOOKAHEAD")&&(a.maxLookahead=e.MAX_LOOKAHEAD);t=(0,c["default"])(o,function(e){return(0,h["default"])(e.GATE)});return a.hasPredicates=t,r.definition.push(a),(0,u["default"])(o,function(e){var t=new p.Alternative({definition:[]});a.definition.push(t),(0,d["default"])(e,"IGNORE_AMBIGUITIES")?t.ignoreAmbiguities=e.IGNORE_AMBIGUITIES:(0,d["default"])(e,"GATE")&&(t.ignoreAmbiguities=!0),n.recordingProdStack.push(t),e.ALT.call(n),n.recordingProdStack.pop()}),f}.call(this,e,t)},y.prototype.subruleInternalRecord=function(e,t,n){var r,i;if(I(t),e&&!1!==(0,d["default"])(e,"ruleName"))return r=(0,s["default"])(this.recordingProdStack),i=e.ruleName,i=new p.NonTerminal({idx:t,nonTerminalName:i,label:null==n?void 0:n.LABEL,referencedRule:undefined}),r.definition.push(i),this.outputCst?b:f;throw(n=new Error("<SUBRULE".concat(_(t),"> argument is invalid")+" expecting a Parser method reference but got: <".concat(JSON.stringify(e),">")+"\n inside top level rule: <".concat(this.recordingProdStack[0].name,">"))).KNOWN_RECORDER_ERROR=!0,n},y.prototype.consumeInternalRecord=function(e,t,n){var r;if(I(t),(0,i.hasShortKeyProperty)(e))return r=(0,s["default"])(this.recordingProdStack),n=new p.Terminal({idx:t,terminalType:e,label:null==n?void 0:n.LABEL}),r.definition.push(n),g;throw(n=new Error("<CONSUME".concat(_(t),"> argument is invalid")+" expecting a TokenType reference but got: <".concat(JSON.stringify(e),">")+"\n inside top level rule: <".concat(this.recordingProdStack[0].name,">"))).KNOWN_RECORDER_ERROR=!0,n},t.GastRecorder=y},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceTracer=void 0,r(n(7))),a=n(37),o=n(6);function s(){}s.prototype.initPerformanceTracer=function(e){var t;(0,i["default"])(e,"traceInitPerf")?(e=e.traceInitPerf,this.traceInitMaxIdent=(t="number"==typeof e)?e:Infinity,this.traceInitPerf=t?0<e:e):(this.traceInitMaxIdent=0,this.traceInitPerf=o.DEFAULT_PARSER_CONFIG.traceInitPerf),this.traceInitIndent=-1},s.prototype.TRACE_INIT=function(e,t){var n,r,i,o;return!0===this.traceInitPerf?(this.traceInitIndent++,n=new Array(this.traceInitIndent+1).join("\t"),this.traceInitIndent<this.traceInitMaxIdent&&console.log("".concat(n,"--\x3e <").concat(e,">")),r=(i=(0,a.timer)(t)).time,i=i.value,o=10<r?console.warn:console.log,this.traceInitIndent<this.traceInitMaxIdent&&o("".concat(n,"<-- <").concat(e,"> time: ").concat(r,"ms")),this.traceInitIndent--,i):t()},t.PerformanceTracer=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixins=void 0,t.applyMixins=function(i,e){e.forEach(function(n){var r=n.prototype;Object.getOwnPropertyNames(r).forEach(function(e){var t;"constructor"!==e&&((t=Object.getOwnPropertyDescriptor(r,e))&&(t.get||t.set)?Object.defineProperty(i.prototype,e,t):i.prototype[e]=n.prototype[e])})})}},function(e,t,n){"use strict";var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.generateCstDts=void 0,n(529)),o=n(530),a={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};t.generateCstDts=function(e,t){return t=r(r({},a),t),e=(0,i.buildModel)(e),(0,o.genDts)(e,t)}},function(e,t,n){"use strict";function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}i=function(e,t){return(i=Object.setPrototypeOf||r({},[])instanceof Array&&function(e,t){for(var n=e,r=t,i=Object.getOwnPropertyNames(r),o=0;o<i.length;o++){var a=i[o],s=Object.getOwnPropertyDescriptor(r,a);s&&s.configurable&&n[a]===undefined&&Object.defineProperty(n,a,s)}}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var i,o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=function(e){return e&&e.__esModule?e:{"default":e}},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.buildModel=void 0,n(2)),l=a(n(4)),c=a(n(16)),u=a(n(15)),h=a(n(95)),d=a(n(244)),p=a(n(60));t.buildModel=function(e){var t=new m,e=(0,u["default"])(e);return(0,l["default"])(e,function(e){return t.visitRule(e)})};f=s.GAstVisitor,o(g,f),g.prototype.visitRule=function(e){var t=this.visitEach(e.definition),t=(0,d["default"])(t,function(e){return e.propertyName}),t=(0,l["default"])(t,function(e,t){var n=!(0,h["default"])(e,function(e){return!e.canBeNull}),r=e[0].type;return{name:t,type:r=1<e.length?(0,l["default"])(e,function(e){return e.type}):r,optional:n}});return{name:e.name,properties:t}},g.prototype.visitAlternative=function(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})},g.prototype.visitOption=function(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})},g.prototype.visitRepetition=function(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})},g.prototype.visitRepetitionMandatory=function(e){return this.visitEach(e.definition)},g.prototype.visitRepetitionMandatoryWithSeparator=function(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:b(e.separator)})},g.prototype.visitRepetitionWithSeparator=function(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:b(e.separator)})},g.prototype.visitAlternation=function(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})},g.prototype.visitTerminal=function(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:b(e)}]},g.prototype.visitNonTerminal=function(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:b(e)}]},g.prototype.visitEachAndOverrideWith=function(e,t){return(0,l["default"])(this.visitEach(e),function(e){return(0,p["default"])({},e,t)})},g.prototype.visitEach=function(e){var t=this;return(0,c["default"])((0,l["default"])(e,function(e){return t.visit(e)}))};var f,m=g;function g(){return null!==f&&f.apply(this,arguments)||this}function b(e){return e instanceof s.NonTerminal?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{"default":e}},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.genDts=void 0,r(n(16))),o=r(n(0)),a=r(n(4)),s=r(n(23)),l=r(n(98)),c=r(n(531));function u(e){return"token"===e.kind?"IToken":h(e.name)}function h(e){return(0,c["default"])(e)+"CstNode"}function d(e){return(0,c["default"])(e)+"CstChildren"}t.genDts=function(e,t){var n=[];return n=(n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";')).concat((0,i["default"])((0,a["default"])(e,function(e){return t=function(e){var t=h(e.name),n=d(e.name);return"export interface ".concat(t,' extends CstNode {\n  name: "').concat(e.name,'";\n  children: ').concat(n,";\n}")}(e=e),e=function(e){var t=d(e.name);return"export type ".concat(t," = {\n  ").concat((0,a["default"])(e.properties,function(e){return t=function(e){{var t;return(0,o["default"])(e)?(t=(0,l["default"])((0,a["default"])(e,u)),"("+(0,s["default"])(t,function(e,t){return e+" | "+t})+")"):u(e)}}((e=e).type),"".concat(e.name).concat(e.optional?"?":"",": ").concat(t,"[];");var t}).join("\n  "),"\n};")}(e),[t,e];var t}))),(n=t.includeVisitorInterface?n.concat((t=t.visitorInterfaceName,e=e,"export interface ".concat(t,"<IN, OUT> extends ICstVisitor<IN, OUT> {\n  ").concat((0,a["default"])(e,function(e){return t=d((e=e).name),"".concat(e.name,"(children: ").concat(t,", param?: IN): OUT;");var t}).join("\n  "),"\n}"))):n).join("\n\n")+"\n"}},function(e,t,n){"use strict";n=n(532)("toUpperCase");e.exports=n},function(e,t,n){"use strict";var i=n(533),o=n(109),a=n(534),s=n(223);e.exports=function(r){return function(e){e=s(e);var t=o(e)?a(e):undefined,n=t?t[0]:e.charAt(0),t=t?i(t,1).join(""):e.slice(1);return n[r]()+t}}},function(e,t,n){"use strict";var i=n(92);e.exports=function(e,t,n){var r=e.length;return n=n===undefined?r:n,!t&&r<=n?e:i(e,t,n)}},function(e,t,n){"use strict";var r=n(535),i=n(109),o=n(536);e.exports=function(e){return(i(e)?o:r)(e)}},function(e,t,n){"use strict";e.exports=function(e){return e.split("")}},function(e,t,n){"use strict";var r="\\ud800-\\udfff",i="["+r+"]",o="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",a="\\ud83c[\\udffb-\\udfff]",r="[^"+r+"]",s="(?:\\ud83c[\\udde6-\\uddff]){2}",l="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",u="[\\ufe0e\\ufe0f]?",u=u+c+("(?:\\u200d(?:"+[r,s,l].join("|")+")"+u+c+")*"),c="(?:"+[r+o+"?",o,s,l,i].join("|")+")",h=RegExp(a+"(?="+a+")|"+c+u,"g");e.exports=function(e){return e.match(h)||[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSyntaxDiagramsCode=void 0;var r=n(208);t.createSyntaxDiagramsCode=function(e,t){var n=void 0===(n=(t=void 0===t?{}:t).resourceBase)?"https://unpkg.com/chevrotain@".concat(r.VERSION,"/diagrams/"):n,t=void 0===(t=t.css)?"https://unpkg.com/chevrotain@".concat(r.VERSION,"/diagrams/diagrams.css"):t;return'\n\x3c!-- This is a generated file --\x3e\n<!DOCTYPE html>\n<meta charset="utf-8">\n<style>\n  body {\n    background-color: hsl(30, 20%, 95%)\n  }\n</style>\n\n'+"\n<link rel='stylesheet' href='".concat(t,"'>\n")+"\n<script src='".concat(n,"vendor/railroad-diagrams.js'><\/script>\n<script src='").concat(n,"src/diagrams_builder.js'><\/script>\n<script src='").concat(n,"src/diagrams_behavior.js'><\/script>\n<script src='").concat(n,"src/main.js'><\/script>\n")+'\n<div id="diagrams" align="center"></div>    \n'+"\n<script>\n    window.serializedGrammar = ".concat(JSON.stringify(e,null,"  "),";\n<\/script>\n")+'\n<script>\n    var diagramsDiv = document.getElementById("diagrams");\n    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);\n<\/script>\n'}},function(e,t,n){"use strict";var r=n(73),i=n(24),o=n(8),a=n(39),s=n(539);e.exports=function(e){var t;return null==e?0:o(e)?a(e)?s(e):e.length:"[object Map]"==(t=i(e))||"[object Set]"==t?e.size:r(e).length}},function(e,t,n){"use strict";var r=n(540),i=n(109),o=n(541);e.exports=function(e){return(i(e)?o:r)(e)}},function(e,t,n){"use strict";n=n(225)("length");e.exports=n},function(e,t,n){"use strict";var r="\\ud800-\\udfff",i="["+r+"]",o="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",a="\\ud83c[\\udffb-\\udfff]",r="[^"+r+"]",s="(?:\\ud83c[\\udde6-\\uddff]){2}",l="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",u="[\\ufe0e\\ufe0f]?",u=u+c+("(?:\\u200d(?:"+[r,s,l].join("|")+")"+u+c+")*"),c="(?:"+[r+o+"?",o,s,l,i].join("|")+")",h=RegExp(a+"(?="+a+")|"+c+u,"g");e.exports=function(e){for(var t=h.lastIndex=0;h.test(e);)++t;return t}},function(e,t){e.exports='// Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the "License");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n// http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an "AS IS" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n// ┌────────────────────────────────────────────────────────────┐ \\\\\r\n// │ Eve 0.4.2 - JavaScript Events Library                      │ \\\\\r\n// ├────────────────────────────────────────────────────────────┤ \\\\\r\n// │ Author Dmitry Baranovskiy (http://dmitry.baranovskiy.com/) │ \\\\\r\n// └────────────────────────────────────────────────────────────┘ \\\\\r\n(function (glob, factory) {\r\n    if (typeof define === "function" && define.amd) {\r\n        define("eve", function() {\r\n            return factory();\r\n        });\r\n    } else if (typeof exports === "object") {\r\n        module.exports = factory();\r\n    } else {\r\n        glob.eve = factory();\r\n    }\r\n}(this, function(){\r\n    var version = "0.4.2",\r\n        has = "hasOwnProperty",\r\n        separator = /[\\.\\/]/,\r\n        wildcard = "*",\r\n        fun = function () {},\r\n        numsort = function (a, b) {\r\n            return a - b;\r\n        },\r\n        current_event,\r\n        stop,\r\n        events = {n: {}},\r\n    /*\\\r\n     * eve\r\n     [ method ]\r\n\r\n     * Fires event with given `name`, given scope and other parameters.\r\n\r\n     > Arguments\r\n\r\n     - name (string) name of the *event*, dot (`.`) or slash (`/`) separated\r\n     - scope (object) context for the event handlers\r\n     - varargs (...) the rest of arguments will be sent to event handlers\r\n\r\n     = (object) array of returned values from the listeners\r\n     \\*/\r\n        eve = function (name, scope) {\r\n            name = String(name);\r\n            var e = events,\r\n                oldstop = stop,\r\n                args = Array.prototype.slice.call(arguments, 2),\r\n                listeners = eve.listeners(name),\r\n                z = 0,\r\n                f = false,\r\n                l,\r\n                indexed = [],\r\n                queue = {},\r\n                out = [],\r\n                ce = current_event,\r\n                errors = [];\r\n            current_event = name;\r\n            stop = 0;\r\n            for (var i = 0, ii = listeners.length; i < ii; i++) if ("zIndex" in listeners[i]) {\r\n                indexed.push(listeners[i].zIndex);\r\n                if (listeners[i].zIndex < 0) {\r\n                    queue[listeners[i].zIndex] = listeners[i];\r\n                }\r\n            }\r\n            indexed.sort(numsort);\r\n            while (indexed[z] < 0) {\r\n                l = queue[indexed[z++]];\r\n                out.push(l.apply(scope, args));\r\n                if (stop) {\r\n                    stop = oldstop;\r\n                    return out;\r\n                }\r\n            }\r\n            for (i = 0; i < ii; i++) {\r\n                l = listeners[i];\r\n                if ("zIndex" in l) {\r\n                    if (l.zIndex == indexed[z]) {\r\n                        out.push(l.apply(scope, args));\r\n                        if (stop) {\r\n                            break;\r\n                        }\r\n                        do {\r\n                            z++;\r\n                            l = queue[indexed[z]];\r\n                            l && out.push(l.apply(scope, args));\r\n                            if (stop) {\r\n                                break;\r\n                            }\r\n                        } while (l)\r\n                    } else {\r\n                        queue[l.zIndex] = l;\r\n                    }\r\n                } else {\r\n                    out.push(l.apply(scope, args));\r\n                    if (stop) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            stop = oldstop;\r\n            current_event = ce;\r\n            return out.length ? out : null;\r\n        };\r\n    // Undocumented. Debug only.\r\n    eve._events = events;\r\n    /*\\\r\n     * eve.listeners\r\n     [ method ]\r\n\r\n     * Internal method which gives you array of all event handlers that will be triggered by the given `name`.\r\n\r\n     > Arguments\r\n\r\n     - name (string) name of the event, dot (`.`) or slash (`/`) separated\r\n\r\n     = (array) array of event handlers\r\n     \\*/\r\n    eve.listeners = function (name) {\r\n        var names = name.split(separator),\r\n            e = events,\r\n            item,\r\n            items,\r\n            k,\r\n            i,\r\n            ii,\r\n            j,\r\n            jj,\r\n            nes,\r\n            es = [e],\r\n            out = [];\r\n        for (i = 0, ii = names.length; i < ii; i++) {\r\n            nes = [];\r\n            for (j = 0, jj = es.length; j < jj; j++) {\r\n                e = es[j].n;\r\n                items = [e[names[i]], e[wildcard]];\r\n                k = 2;\r\n                while (k--) {\r\n                    item = items[k];\r\n                    if (item) {\r\n                        nes.push(item);\r\n                        out = out.concat(item.f || []);\r\n                    }\r\n                }\r\n            }\r\n            es = nes;\r\n        }\r\n        return out;\r\n    };\r\n\r\n    /*\\\r\n     * eve.on\r\n     [ method ]\r\n     **\r\n     * Binds given event handler with a given name. You can use wildcards “`*`” for the names:\r\n     | eve.on("*.under.*", f);\r\n     | eve("mouse.under.floor"); // triggers f\r\n     * Use @eve to trigger the listener.\r\n     **\r\n     > Arguments\r\n     **\r\n     - name (string) name of the event, dot (`.`) or slash (`/`) separated, with optional wildcards\r\n     - f (function) event handler function\r\n     **\r\n     = (function) returned function accepts a single numeric parameter that represents z-index of the handler. It is an optional feature and only used when you need to ensure that some subset of handlers will be invoked in a given order, despite of the order of assignment.\r\n     > Example:\r\n     | eve.on("mouse", eatIt)(2);\r\n     | eve.on("mouse", scream);\r\n     | eve.on("mouse", catchIt)(1);\r\n     * This will ensure that `catchIt()` function will be called before `eatIt()`.\r\n     *\r\n     * If you want to put your handler before non-indexed handlers, specify a negative value.\r\n     * Note: I assume most of the time you don’t need to worry about z-index, but it’s nice to have this feature “just in case”.\r\n     \\*/\r\n    eve.on = function (name, f) {\r\n        name = String(name);\r\n        if (typeof f != "function") {\r\n            return function () {};\r\n        }\r\n        var names = name.split(separator),\r\n            e = events;\r\n        for (var i = 0, ii = names.length; i < ii; i++) {\r\n            e = e.n;\r\n            e = e.hasOwnProperty(names[i]) && e[names[i]] || (e[names[i]] = {n: {}});\r\n        }\r\n        e.f = e.f || [];\r\n        for (i = 0, ii = e.f.length; i < ii; i++) if (e.f[i] == f) {\r\n            return fun;\r\n        }\r\n        e.f.push(f);\r\n        return function (zIndex) {\r\n            if (+zIndex == +zIndex) {\r\n                f.zIndex = +zIndex;\r\n            }\r\n        };\r\n    };\r\n    /*\\\r\n     * eve.f\r\n     [ method ]\r\n     **\r\n     * Returns function that will fire given event with optional arguments.\r\n     * Arguments that will be passed to the result function will be also\r\n     * concated to the list of final arguments.\r\n     | el.onclick = eve.f("click", 1, 2);\r\n     | eve.on("click", function (a, b, c) {\r\n     |     console.log(a, b, c); // 1, 2, [event object]\r\n     | });\r\n     > Arguments\r\n     - event (string) event name\r\n     - varargs (…) and any other arguments\r\n     = (function) possible event handler function\r\n     \\*/\r\n    eve.f = function (event) {\r\n        var attrs = [].slice.call(arguments, 1);\r\n        return function () {\r\n            eve.apply(null, [event, null].concat(attrs).concat([].slice.call(arguments, 0)));\r\n        };\r\n    };\r\n    /*\\\r\n     * eve.stop\r\n     [ method ]\r\n     **\r\n     * Is used inside an event handler to stop the event, preventing any subsequent listeners from firing.\r\n     \\*/\r\n    eve.stop = function () {\r\n        stop = 1;\r\n    };\r\n    /*\\\r\n     * eve.nt\r\n     [ method ]\r\n     **\r\n     * Could be used inside event handler to figure out actual name of the event.\r\n     **\r\n     > Arguments\r\n     **\r\n     - subname (string) #optional subname of the event\r\n     **\r\n     = (string) name of the event, if `subname` is not specified\r\n     * or\r\n     = (boolean) `true`, if current event’s name contains `subname`\r\n     \\*/\r\n    eve.nt = function (subname) {\r\n        if (subname) {\r\n            return new RegExp("(?:\\\\.|\\\\/|^)" + subname + "(?:\\\\.|\\\\/|$)").test(current_event);\r\n        }\r\n        return current_event;\r\n    };\r\n    /*\\\r\n     * eve.nts\r\n     [ method ]\r\n     **\r\n     * Could be used inside event handler to figure out actual name of the event.\r\n     **\r\n     **\r\n     = (array) names of the event\r\n     \\*/\r\n    eve.nts = function () {\r\n        return current_event.split(separator);\r\n    };\r\n    /*\\\r\n     * eve.off\r\n     [ method ]\r\n     **\r\n     * Removes given function from the list of event listeners assigned to given name.\r\n     * If no arguments specified all the events will be cleared.\r\n     **\r\n     > Arguments\r\n     **\r\n     - name (string) name of the event, dot (`.`) or slash (`/`) separated, with optional wildcards\r\n     - f (function) event handler function\r\n     \\*/\r\n    /*\\\r\n     * eve.unbind\r\n     [ method ]\r\n     **\r\n     * See @eve.off\r\n     \\*/\r\n    eve.off = eve.unbind = function (name, f) {\r\n        if (!name) {\r\n            eve._events = events = {n: {}};\r\n            return;\r\n        }\r\n        var names = name.split(separator),\r\n            e,\r\n            key,\r\n            splice,\r\n            i, ii, j, jj,\r\n            cur = [events];\r\n        for (i = 0, ii = names.length; i < ii; i++) {\r\n            for (j = 0; j < cur.length; j += splice.length - 2) {\r\n                splice = [j, 1];\r\n                e = cur[j].n;\r\n                if (names[i] != wildcard) {\r\n                    if (e[names[i]]) {\r\n                        splice.push(e[names[i]]);\r\n                    }\r\n                } else {\r\n                    for (key in e) if (e[has](key)) {\r\n                        splice.push(e[key]);\r\n                    }\r\n                }\r\n                cur.splice.apply(cur, splice);\r\n            }\r\n        }\r\n        for (i = 0, ii = cur.length; i < ii; i++) {\r\n            e = cur[i];\r\n            while (e.n) {\r\n                if (f) {\r\n                    if (e.f) {\r\n                        for (j = 0, jj = e.f.length; j < jj; j++) if (e.f[j] == f) {\r\n                            e.f.splice(j, 1);\r\n                            break;\r\n                        }\r\n                        !e.f.length && delete e.f;\r\n                    }\r\n                    for (key in e.n) if (e.n[has](key) && e.n[key].f) {\r\n                        var funcs = e.n[key].f;\r\n                        for (j = 0, jj = funcs.length; j < jj; j++) if (funcs[j] == f) {\r\n                            funcs.splice(j, 1);\r\n                            break;\r\n                        }\r\n                        !funcs.length && delete e.n[key].f;\r\n                    }\r\n                } else {\r\n                    delete e.f;\r\n                    for (key in e.n) if (e.n[has](key) && e.n[key].f) {\r\n                        delete e.n[key].f;\r\n                    }\r\n                }\r\n                e = e.n;\r\n            }\r\n        }\r\n    };\r\n    /*\\\r\n     * eve.once\r\n     [ method ]\r\n     **\r\n     * Binds given event handler with a given name to only run once then unbind itself.\r\n     | eve.once("login", f);\r\n     | eve("login"); // triggers f\r\n     | eve("login"); // no listeners\r\n     * Use @eve to trigger the listener.\r\n     **\r\n     > Arguments\r\n     **\r\n     - name (string) name of the event, dot (`.`) or slash (`/`) separated, with optional wildcards\r\n     - f (function) event handler function\r\n     **\r\n     = (function) same return function as @eve.on\r\n     \\*/\r\n    eve.once = function (name, f) {\r\n        var f2 = function () {\r\n            eve.unbind(name, f2);\r\n            return f.apply(this, arguments);\r\n        };\r\n        return eve.on(name, f2);\r\n    };\r\n    /*\\\r\n     * eve.version\r\n     [ property (string) ]\r\n     **\r\n     * Current version of the library.\r\n     \\*/\r\n    eve.version = version;\r\n    eve.toString = function () {\r\n        return "You are running Eve " + version;\r\n    };\r\n\r\n    return eve;\r\n}));\r\n\r\n// ┌────────────────────────────────────────────────────────────────────┐ \\\\\r\n// │ Raphaël 2.1.4 - JavaScript Vector Library                      │ \\\\\r\n// ├────────────────────────────────────────────────────────────────────┤ \\\\\r\n// │ Core Module                                                        │ \\\\\r\n// ├────────────────────────────────────────────────────────────────────┤ \\\\\r\n// │ Licensed under the MIT (http://raphaeljs.com/license.html) license.│ \\\\\r\n// └────────────────────────────────────────────────────────────────────┘ \\\\\r\n\r\n(function (glob, factory) {\r\n    if (typeof define === "function" && define.amd) {\r\n        define("raphael.core", ["eve"], function(eve) {\r\n            return factory(eve);\r\n        });\r\n    } else if (typeof exports === "object") {\r\n        module.exports = factory(require("eve"));\r\n    } else {\r\n        glob.Raphael = factory(glob.eve);\r\n    }\r\n}(this, function (eve) {\r\n    /*\\\r\n     * Raphael\r\n     [ method ]\r\n     **\r\n     * Creates a canvas object on which to draw.\r\n     * You must do this first, as all future calls to drawing methods\r\n     * from this instance will be bound to this canvas.\r\n     > Parameters\r\n     **\r\n     - container (HTMLElement|string) DOM element or its ID which is going to be a parent for drawing surface\r\n     - width (number)\r\n     - height (number)\r\n     - callback (function) #optional callback function which is going to be executed in the context of newly created paper\r\n     * or\r\n     - x (number)\r\n     - y (number)\r\n     - width (number)\r\n     - height (number)\r\n     - callback (function) #optional callback function which is going to be executed in the context of newly created paper\r\n     * or\r\n     - all (array) (first 3 or 4 elements in the array are equal to [containerID, width, height] or [x, y, width, height]. The rest are element descriptions in format {type: type, <attributes>}). See @Paper.add.\r\n     - callback (function) #optional callback function which is going to be executed in the context of newly created paper\r\n     * or\r\n     - onReadyCallback (function) function that is going to be called on DOM ready event. You can also subscribe to this event via Eve’s “DOMLoad” event. In this case method returns `undefined`.\r\n     = (object) @Paper\r\n     > Usage\r\n     | // Each of the following examples create a canvas\r\n     | // that is 320px wide by 200px high.\r\n     | // Canvas is created at the viewport’s 10,50 coordinate.\r\n     | var paper = Raphael(10, 50, 320, 200);\r\n     | // Canvas is created at the top left corner of the #notepad element\r\n     | // (or its top right corner in dir="rtl" elements)\r\n     | var paper = Raphael(document.getElementById("notepad"), 320, 200);\r\n     | // Same as above\r\n     | var paper = Raphael("notepad", 320, 200);\r\n     | // Image dump\r\n     | var set = Raphael(["notepad", 320, 200, {\r\n     |     type: "rect",\r\n     |     x: 10,\r\n     |     y: 10,\r\n     |     width: 25,\r\n     |     height: 25,\r\n     |     stroke: "#f00"\r\n     | }, {\r\n     |     type: "text",\r\n     |     x: 30,\r\n     |     y: 40,\r\n     |     text: "Dump"\r\n     | }]);\r\n     \\*/\r\n    function R(first) {\r\n        if (R.is(first, "function")) {\r\n            return loaded ? first() : eve.on("raphael.DOMload", first);\r\n        } else if (R.is(first, array)) {\r\n            return R._engine.create[apply](R, first.splice(0, 3 + R.is(first[0], nu))).add(first);\r\n        } else {\r\n            var args = Array.prototype.slice.call(arguments, 0);\r\n            if (R.is(args[args.length - 1], "function")) {\r\n                var f = args.pop();\r\n                return loaded ? f.call(R._engine.create[apply](R, args)) : eve.on("raphael.DOMload", function () {\r\n                    f.call(R._engine.create[apply](R, args));\r\n                });\r\n            } else {\r\n                return R._engine.create[apply](R, arguments);\r\n            }\r\n        }\r\n    }\r\n    R.version = "2.1.4";\r\n    R.eve = eve;\r\n    var loaded,\r\n        separator = /[, ]+/,\r\n        elements = {circle: 1, rect: 1, path: 1, ellipse: 1, text: 1, image: 1},\r\n        formatrg = /\\{(\\d+)\\}/g,\r\n        proto = "prototype",\r\n        has = "hasOwnProperty",\r\n        g = {\r\n            doc: document,\r\n            win: window\r\n        },\r\n        oldRaphael = {\r\n            was: Object.prototype[has].call(g.win, "Raphael"),\r\n            is: g.win.Raphael\r\n        },\r\n        Paper = function () {\r\n            /*\\\r\n             * Paper.ca\r\n             [ property (object) ]\r\n             **\r\n             * Shortcut for @Paper.customAttributes\r\n             \\*/\r\n            /*\\\r\n             * Paper.customAttributes\r\n             [ property (object) ]\r\n             **\r\n             * If you have a set of attributes that you would like to represent\r\n             * as a function of some number you can do it easily with custom attributes:\r\n             > Usage\r\n             | paper.customAttributes.hue = function (num) {\r\n             |     num = num % 1;\r\n             |     return {fill: "hsb(" + num + ", 0.75, 1)"};\r\n             | };\r\n             | // Custom attribute “hue” will change fill\r\n             | // to be given hue with fixed saturation and brightness.\r\n             | // Now you can use it like this:\r\n             | var c = paper.circle(10, 10, 10).attr({hue: .45});\r\n             | // or even like this:\r\n             | c.animate({hue: 1}, 1e3);\r\n             |\r\n             | // You could also create custom attribute\r\n             | // with multiple parameters:\r\n             | paper.customAttributes.hsb = function (h, s, b) {\r\n             |     return {fill: "hsb(" + [h, s, b].join(",") + ")"};\r\n             | };\r\n             | c.attr({hsb: "0.5 .8 1"});\r\n             | c.animate({hsb: [1, 0, 0.5]}, 1e3);\r\n             \\*/\r\n            this.ca = this.customAttributes = {};\r\n        },\r\n        paperproto,\r\n        appendChild = "appendChild",\r\n        apply = "apply",\r\n        concat = "concat",\r\n        supportsTouch = (\'ontouchstart\' in g.win) || g.win.DocumentTouch && g.doc instanceof DocumentTouch, //taken from Modernizr touch test\r\n        E = "",\r\n        S = " ",\r\n        Str = String,\r\n        split = "split",\r\n        events = "click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[split](S),\r\n        touchMap = {\r\n            mousedown: "touchstart",\r\n            mousemove: "touchmove",\r\n            mouseup: "touchend"\r\n        },\r\n        lowerCase = Str.prototype.toLowerCase,\r\n        math = Math,\r\n        mmax = math.max,\r\n        mmin = math.min,\r\n        abs = math.abs,\r\n        pow = math.pow,\r\n        PI = math.PI,\r\n        nu = "number",\r\n        string = "string",\r\n        array = "array",\r\n        toString = "toString",\r\n        fillString = "fill",\r\n        objectToString = Object.prototype.toString,\r\n        paper = {},\r\n        push = "push",\r\n        ISURL = R._ISURL = /^url\\([\'"]?(.+?)[\'"]?\\)$/i,\r\n        colourRegExp = /^\\s*((#[a-f\\d]{6})|(#[a-f\\d]{3})|rgba?\\(\\s*([\\d\\.]+%?\\s*,\\s*[\\d\\.]+%?\\s*,\\s*[\\d\\.]+%?(?:\\s*,\\s*[\\d\\.]+%?)?)\\s*\\)|hsba?\\(\\s*([\\d\\.]+(?:deg|\\xb0|%)?\\s*,\\s*[\\d\\.]+%?\\s*,\\s*[\\d\\.]+(?:%?\\s*,\\s*[\\d\\.]+)?)%?\\s*\\)|hsla?\\(\\s*([\\d\\.]+(?:deg|\\xb0|%)?\\s*,\\s*[\\d\\.]+%?\\s*,\\s*[\\d\\.]+(?:%?\\s*,\\s*[\\d\\.]+)?)%?\\s*\\))\\s*$/i,\r\n        isnan = {"NaN": 1, "Infinity": 1, "-Infinity": 1},\r\n        bezierrg = /^(?:cubic-)?bezier\\(([^,]+),([^,]+),([^,]+),([^\\)]+)\\)/,\r\n        round = math.round,\r\n        setAttribute = "setAttribute",\r\n        toFloat = parseFloat,\r\n        toInt = parseInt,\r\n        upperCase = Str.prototype.toUpperCase,\r\n        availableAttrs = R._availableAttrs = {\r\n            "arrow-end": "none",\r\n            "arrow-start": "none",\r\n            blur: 0,\r\n            "clip-rect": "0 0 1e9 1e9",\r\n            cursor: "default",\r\n            cx: 0,\r\n            cy: 0,\r\n            fill: "#fff",\r\n            "fill-opacity": 1,\r\n            font: \'10px "Arial"\',\r\n            "font-family": \'"Arial"\',\r\n            "font-size": "10",\r\n            "font-style": "normal",\r\n            "font-weight": 400,\r\n            gradient: 0,\r\n            height: 0,\r\n            href: "http://raphaeljs.com/",\r\n            "letter-spacing": 0,\r\n            opacity: 1,\r\n            path: "M0,0",\r\n            r: 0,\r\n            rx: 0,\r\n            ry: 0,\r\n            src: "",\r\n            stroke: "#000",\r\n            "stroke-dasharray": "",\r\n            "stroke-linecap": "butt",\r\n            "stroke-linejoin": "butt",\r\n            "stroke-miterlimit": 0,\r\n            "stroke-opacity": 1,\r\n            "stroke-width": 1,\r\n            target: "_blank",\r\n            "text-anchor": "middle",\r\n            title: "Raphael",\r\n            transform: "",\r\n            width: 0,\r\n            x: 0,\r\n            y: 0\r\n        },\r\n        availableAnimAttrs = R._availableAnimAttrs = {\r\n            blur: nu,\r\n            "clip-rect": "csv",\r\n            cx: nu,\r\n            cy: nu,\r\n            fill: "colour",\r\n            "fill-opacity": nu,\r\n            "font-size": nu,\r\n            height: nu,\r\n            opacity: nu,\r\n            path: "path",\r\n            r: nu,\r\n            rx: nu,\r\n            ry: nu,\r\n            stroke: "colour",\r\n            "stroke-opacity": nu,\r\n            "stroke-width": nu,\r\n            transform: "transform",\r\n            width: nu,\r\n            x: nu,\r\n            y: nu\r\n        },\r\n        whitespace = /[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]/g,\r\n        commaSpaces = /[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*,[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*/,\r\n        hsrg = {hs: 1, rg: 1},\r\n        p2s = /,?([achlmqrstvxz]),?/gi,\r\n        pathCommand = /([achlmrqstvz])[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029,]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*,?[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*)+)/ig,\r\n        tCommand = /([rstm])[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029,]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*,?[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*)+)/ig,\r\n        pathValues = /(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*,?[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*/ig,\r\n        radial_gradient = R._radial_gradient = /^r(?:\\(([^,]+?)[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*,[\\x09\\x0a\\x0b\\x0c\\x0d\\x20\\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\\u2029]*([^\\)]+?)\\))?/,\r\n        eldata = {},\r\n        sortByKey = function (a, b) {\r\n            return a.key - b.key;\r\n        },\r\n        sortByNumber = function (a, b) {\r\n            return toFloat(a) - toFloat(b);\r\n        },\r\n        fun = function () {},\r\n        pipe = function (x) {\r\n            return x;\r\n        },\r\n        rectPath = R._rectPath = function (x, y, w, h, r) {\r\n            if (r) {\r\n                return [["M", x + r, y], ["l", w - r * 2, 0], ["a", r, r, 0, 0, 1, r, r], ["l", 0, h - r * 2], ["a", r, r, 0, 0, 1, -r, r], ["l", r * 2 - w, 0], ["a", r, r, 0, 0, 1, -r, -r], ["l", 0, r * 2 - h], ["a", r, r, 0, 0, 1, r, -r], ["z"]];\r\n            }\r\n            return [["M", x, y], ["l", w, 0], ["l", 0, h], ["l", -w, 0], ["z"]];\r\n        },\r\n        ellipsePath = function (x, y, rx, ry) {\r\n            if (ry == null) {\r\n                ry = rx;\r\n            }\r\n            return [["M", x, y], ["m", 0, -ry], ["a", rx, ry, 0, 1, 1, 0, 2 * ry], ["a", rx, ry, 0, 1, 1, 0, -2 * ry], ["z"]];\r\n        },\r\n        getPath = R._getPath = {\r\n            path: function (el) {\r\n                return el.attr("path");\r\n            },\r\n            circle: function (el) {\r\n                var a = el.attrs;\r\n                return ellipsePath(a.cx, a.cy, a.r);\r\n            },\r\n            ellipse: function (el) {\r\n                var a = el.attrs;\r\n                return ellipsePath(a.cx, a.cy, a.rx, a.ry);\r\n            },\r\n            rect: function (el) {\r\n                var a = el.attrs;\r\n                return rectPath(a.x, a.y, a.width, a.height, a.r);\r\n            },\r\n            image: function (el) {\r\n                var a = el.attrs;\r\n                return rectPath(a.x, a.y, a.width, a.height);\r\n            },\r\n            text: function (el) {\r\n                var bbox = el._getBBox();\r\n                return rectPath(bbox.x, bbox.y, bbox.width, bbox.height);\r\n            },\r\n            set : function(el) {\r\n                var bbox = el._getBBox();\r\n                return rectPath(bbox.x, bbox.y, bbox.width, bbox.height);\r\n            }\r\n        },\r\n    /*\\\r\n     * Raphael.mapPath\r\n     [ method ]\r\n     **\r\n     * Transform the path string with given matrix.\r\n     > Parameters\r\n     - path (string) path string\r\n     - matrix (object) see @Matrix\r\n     = (string) transformed path string\r\n     \\*/\r\n        mapPath = R.mapPath = function (path, matrix) {\r\n            if (!matrix) {\r\n                return path;\r\n            }\r\n            var x, y, i, j, ii, jj, pathi;\r\n            path = path2curve(path);\r\n            for (i = 0, ii = path.length; i < ii; i++) {\r\n                pathi = path[i];\r\n                for (j = 1, jj = pathi.length; j < jj; j += 2) {\r\n                    x = matrix.x(pathi[j], pathi[j + 1]);\r\n                    y = matrix.y(pathi[j], pathi[j + 1]);\r\n                    pathi[j] = x;\r\n                    pathi[j + 1] = y;\r\n                }\r\n            }\r\n            return path;\r\n        };\r\n\r\n    R._g = g;\r\n    /*\\\r\n     * Raphael.type\r\n     [ property (string) ]\r\n     **\r\n     * Can be “SVG”, “VML” or empty, depending on browser support.\r\n     \\*/\r\n    R.type = (g.win.SVGAngle || g.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1") ? "SVG" : "VML");\r\n    if (R.type == "VML") {\r\n        var d = g.doc.createElement("div"),\r\n            b;\r\n        d.innerHTML = \'<v:shape adj="1"/>\';\r\n        b = d.firstChild;\r\n        b.style.behavior = "url(#default#VML)";\r\n        if (!(b && typeof b.adj == "object")) {\r\n            return (R.type = E);\r\n        }\r\n        d = null;\r\n    }\r\n    /*\\\r\n     * Raphael.svg\r\n     [ property (boolean) ]\r\n     **\r\n     * `true` if browser supports SVG.\r\n     \\*/\r\n    /*\\\r\n     * Raphael.vml\r\n     [ property (boolean) ]\r\n     **\r\n     * `true` if browser supports VML.\r\n     \\*/\r\n    R.svg = !(R.vml = R.type == "VML");\r\n    R._Paper = Paper;\r\n    /*\\\r\n     * Raphael.fn\r\n     [ property (object) ]\r\n     **\r\n     * You can add your own method to the canvas. For example if you want to draw a pie chart,\r\n     * you can create your own pie chart function and ship it as a Raphaël plugin. To do this\r\n     * you need to extend the `Raphael.fn` object. You should modify the `fn` object before a\r\n     * Raphaël instance is created, otherwise it will take no effect. Please note that the\r\n     * ability for namespaced plugins was removed in Raphael 2.0. It is up to the plugin to\r\n     * ensure any namespacing ensures proper context.\r\n     > Usage\r\n     | Raphael.fn.arrow = function (x1, y1, x2, y2, size) {\r\n     |     return this.path( ... );\r\n     | };\r\n     | // or create namespace\r\n     | Raphael.fn.mystuff = {\r\n     |     arrow: function () {…},\r\n     |     star: function () {…},\r\n     |     // etc…\r\n     | };\r\n     | var paper = Raphael(10, 10, 630, 480);\r\n     | // then use it\r\n     | paper.arrow(10, 10, 30, 30, 5).attr({fill: "#f00"});\r\n     | paper.mystuff.arrow();\r\n     | paper.mystuff.star();\r\n     \\*/\r\n    R.fn = paperproto = Paper.prototype = R.prototype;\r\n    R._id = 0;\r\n    R._oid = 0;\r\n    /*\\\r\n     * Raphael.is\r\n     [ method ]\r\n     **\r\n     * Handful of replacements for `typeof` operator.\r\n     > Parameters\r\n     - o (…) any object or primitive\r\n     - type (string) name of the type, i.e. “string”, “function”, “number”, etc.\r\n     = (boolean) is given value is of given type\r\n     \\*/\r\n    R.is = function (o, type) {\r\n        type = lowerCase.call(type);\r\n        if (type == "finite") {\r\n            return !isnan[has](+o);\r\n        }\r\n        if (type == "array") {\r\n            return o instanceof Array;\r\n        }\r\n        return  (type == "null" && o === null) ||\r\n            (type == typeof o && o !== null) ||\r\n            (type == "object" && o === Object(o)) ||\r\n            (type == "array" && Array.isArray && Array.isArray(o)) ||\r\n            objectToString.call(o).slice(8, -1).toLowerCase() == type;\r\n    };\r\n\r\n    function clone(obj) {\r\n        if (typeof obj == "function" || Object(obj) !== obj) {\r\n            return obj;\r\n        }\r\n        var res = new obj.constructor;\r\n        for (var key in obj) if (obj[has](key)) {\r\n            res[key] = clone(obj[key]);\r\n        }\r\n        return res;\r\n    }\r\n\r\n    /*\\\r\n     * Raphael.angle\r\n     [ method ]\r\n     **\r\n     * Returns angle between two or three points\r\n     > Parameters\r\n     - x1 (number) x coord of first point\r\n     - y1 (number) y coord of first point\r\n     - x2 (number) x coord of second point\r\n     - y2 (number) y coord of second point\r\n     - x3 (number) #optional x coord of third point\r\n     - y3 (number) #optional y coord of third point\r\n     = (number) angle in degrees.\r\n     \\*/\r\n    R.angle = function (x1, y1, x2, y2, x3, y3) {\r\n        if (x3 == null) {\r\n            var x = x1 - x2,\r\n                y = y1 - y2;\r\n            if (!x && !y) {\r\n                return 0;\r\n            }\r\n            return (180 + math.atan2(-y, -x) * 180 / PI + 360) % 360;\r\n        } else {\r\n            return R.angle(x1, y1, x3, y3) - R.angle(x2, y2, x3, y3);\r\n        }\r\n    };\r\n    /*\\\r\n     * Raphael.rad\r\n     [ method ]\r\n     **\r\n     * Transform angle to radians\r\n     > Parameters\r\n     - deg (number) angle in degrees\r\n     = (number) angle in radians.\r\n     \\*/\r\n    R.rad = function (deg) {\r\n        return deg % 360 * PI / 180;\r\n    };\r\n    /*\\\r\n     * Raphael.deg\r\n     [ method ]\r\n     **\r\n     * Transform angle to degrees\r\n     > Parameters\r\n     - rad (number) angle in radians\r\n     = (number) angle in degrees.\r\n     \\*/\r\n    R.deg = function (rad) {\r\n        return Math.round ((rad * 180 / PI% 360)* 1000) / 1000;\r\n    };\r\n    /*\\\r\n     * Raphael.snapTo\r\n     [ method ]\r\n     **\r\n     * Snaps given value to given grid.\r\n     > Parameters\r\n     - values (array|number) given array of values or step of the grid\r\n     - value (number) value to adjust\r\n     - tolerance (number) #optional tolerance for snapping. Default is `10`.\r\n     = (number) adjusted value.\r\n     \\*/\r\n    R.snapTo = function (values, value, tolerance) {\r\n        tolerance = R.is(tolerance, "finite") ? tolerance : 10;\r\n        if (R.is(values, array)) {\r\n            var i = values.length;\r\n            while (i--) if (abs(values[i] - value) <= tolerance) {\r\n                return values[i];\r\n            }\r\n        } else {\r\n            values = +values;\r\n            var rem = value % values;\r\n            if (rem < tolerance) {\r\n                return value - rem;\r\n            }\r\n            if (rem > values - tolerance) {\r\n                return value - rem + values;\r\n            }\r\n        }\r\n        return value;\r\n    };\r\n\r\n    /*\\\r\n     * Raphael.createUUID\r\n     [ method ]\r\n     **\r\n     * Returns RFC4122, version 4 ID\r\n     \\*/\r\n    var createUUID = R.createUUID = (function (uuidRegEx, uuidReplacer) {\r\n        return function () {\r\n            return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(uuidRegEx, uuidReplacer).toUpperCase();\r\n        };\r\n    })(/[xy]/g, function (c) {\r\n        var r = math.random() * 16 | 0,\r\n            v = c == "x" ? r : (r & 3 | 8);\r\n        return v.toString(16);\r\n    });\r\n\r\n    /*\\\r\n     * Raphael.setWindow\r\n     [ method ]\r\n     **\r\n     * Used when you need to draw in `&lt;iframe>`. Switched window to the iframe one.\r\n     > Parameters\r\n     - newwin (window) new window object\r\n     \\*/\r\n    R.setWindow = function (newwin) {\r\n        eve("raphael.setWindow", R, g.win, newwin);\r\n        g.win = newwin;\r\n        g.doc = g.win.document;\r\n        if (R._engine.initWin) {\r\n            R._engine.initWin(g.win);\r\n        }\r\n    };\r\n    var toHex = function (color) {\r\n            if (R.vml) {\r\n                // http://dean.edwards.name/weblog/2009/10/convert-any-colour-value-to-hex-in-msie/\r\n                var trim = /^\\s+|\\s+$/g;\r\n                var bod;\r\n                try {\r\n                    var docum = new ActiveXObject("htmlfile");\r\n                    docum.write("<body>");\r\n                    docum.close();\r\n                    bod = docum.body;\r\n                } catch(e) {\r\n                    bod = createPopup().document.body;\r\n                }\r\n                var range = bod.createTextRange();\r\n                toHex = cacher(function (color) {\r\n                    try {\r\n                        bod.style.color = Str(color).replace(trim, E);\r\n                        var value = range.queryCommandValue("ForeColor");\r\n                        value = ((value & 255) << 16) | (value & 65280) | ((value & 16711680) >>> 16);\r\n                        return "#" + ("000000" + value.toString(16)).slice(-6);\r\n                    } catch(e) {\r\n                        return "none";\r\n                    }\r\n                });\r\n            } else {\r\n                var i = g.doc.createElement("i");\r\n                i.title = "Rapha\\xebl Colour Picker";\r\n                i.style.display = "none";\r\n                g.doc.body.appendChild(i);\r\n                toHex = cacher(function (color) {\r\n                    i.style.color = color;\r\n                    return g.doc.defaultView.getComputedStyle(i, E).getPropertyValue("color");\r\n                });\r\n            }\r\n            return toHex(color);\r\n        },\r\n        hsbtoString = function () {\r\n            return "hsb(" + [this.h, this.s, this.b] + ")";\r\n        },\r\n        hsltoString = function () {\r\n            return "hsl(" + [this.h, this.s, this.l] + ")";\r\n        },\r\n        rgbtoString = function () {\r\n            return this.hex;\r\n        },\r\n        prepareRGB = function (r, g, b) {\r\n            if (g == null && R.is(r, "object") && "r" in r && "g" in r && "b" in r) {\r\n                b = r.b;\r\n                g = r.g;\r\n                r = r.r;\r\n            }\r\n            if (g == null && R.is(r, string)) {\r\n                var clr = R.getRGB(r);\r\n                r = clr.r;\r\n                g = clr.g;\r\n                b = clr.b;\r\n            }\r\n            if (r > 1 || g > 1 || b > 1) {\r\n                r /= 255;\r\n                g /= 255;\r\n                b /= 255;\r\n            }\r\n\r\n            return [r, g, b];\r\n        },\r\n        packageRGB = function (r, g, b, o) {\r\n            r *= 255;\r\n            g *= 255;\r\n            b *= 255;\r\n            var rgb = {\r\n                r: r,\r\n                g: g,\r\n                b: b,\r\n                hex: R.rgb(r, g, b),\r\n                toString: rgbtoString\r\n            };\r\n            R.is(o, "finite") && (rgb.opacity = o);\r\n            return rgb;\r\n        };\r\n\r\n    /*\\\r\n     * Raphael.color\r\n     [ method ]\r\n     **\r\n     * Parses the color string and returns object with all values for the given color.\r\n     > Parameters\r\n     - clr (string) color string in one of the supported formats (see @Raphael.getRGB)\r\n     = (object) Combined RGB & HSB object in format:\r\n     o {\r\n     o     r (number) red,\r\n     o     g (number) green,\r\n     o     b (number) blue,\r\n     o     hex (string) color in HTML/CSS format: #••••••,\r\n     o     error (boolean) `true` if string can’t be parsed,\r\n     o     h (number) hue,\r\n     o     s (number) saturation,\r\n     o     v (number) value (brightness),\r\n     o     l (number) lightness\r\n     o }\r\n     \\*/\r\n    R.color = function (clr) {\r\n        var rgb;\r\n        if (R.is(clr, "object") && "h" in clr && "s" in clr && "b" in clr) {\r\n            rgb = R.hsb2rgb(clr);\r\n            clr.r = rgb.r;\r\n            clr.g = rgb.g;\r\n            clr.b = rgb.b;\r\n            clr.hex = rgb.hex;\r\n        } else if (R.is(clr, "object") && "h" in clr && "s" in clr && "l" in clr) {\r\n            rgb = R.hsl2rgb(clr);\r\n            clr.r = rgb.r;\r\n            clr.g = rgb.g;\r\n            clr.b = rgb.b;\r\n            clr.hex = rgb.hex;\r\n        } else {\r\n            if (R.is(clr, "string")) {\r\n                clr = R.getRGB(clr);\r\n            }\r\n            if (R.is(clr, "object") && "r" in clr && "g" in clr && "b" in clr) {\r\n                rgb = R.rgb2hsl(clr);\r\n                clr.h = rgb.h;\r\n                clr.s = rgb.s;\r\n                clr.l = rgb.l;\r\n                rgb = R.rgb2hsb(clr);\r\n                clr.v = rgb.b;\r\n            } else {\r\n                clr = {hex: "none"};\r\n                clr.r = clr.g = clr.b = clr.h = clr.s = clr.v = clr.l = -1;\r\n            }\r\n        }\r\n        clr.toString = rgbtoString;\r\n        return clr;\r\n    };\r\n    /*\\\r\n     * Raphael.hsb2rgb\r\n     [ method ]\r\n     **\r\n     * Converts HSB values to RGB object.\r\n     > Parameters\r\n     - h (number) hue\r\n     - s (number) saturation\r\n     - v (number) value or brightness\r\n     = (object) RGB object in format:\r\n     o {\r\n     o     r (number) red,\r\n     o     g (number) green,\r\n     o     b (number) blue,\r\n     o     hex (string) color in HTML/CSS format: #••••••\r\n     o }\r\n     \\*/\r\n    R.hsb2rgb = function (h, s, v, o) {\r\n        if (this.is(h, "object") && "h" in h && "s" in h && "b" in h) {\r\n            v = h.b;\r\n            s = h.s;\r\n            o = h.o;\r\n            h = h.h;\r\n        }\r\n        h *= 360;\r\n        var R, G, B, X, C;\r\n        h = (h % 360) / 60;\r\n        C = v * s;\r\n        X = C * (1 - abs(h % 2 - 1));\r\n        R = G = B = v - C;\r\n\r\n        h = ~~h;\r\n        R += [C, X, 0, 0, X, C][h];\r\n        G += [X, C, C, X, 0, 0][h];\r\n        B += [0, 0, X, C, C, X][h];\r\n        return packageRGB(R, G, B, o);\r\n    };\r\n    /*\\\r\n     * Raphael.hsl2rgb\r\n     [ method ]\r\n     **\r\n     * Converts HSL values to RGB object.\r\n     > Parameters\r\n     - h (number) hue\r\n     - s (number) saturation\r\n     - l (number) luminosity\r\n     = (object) RGB object in format:\r\n     o {\r\n     o     r (number) red,\r\n     o     g (number) green,\r\n     o     b (number) blue,\r\n     o     hex (string) color in HTML/CSS format: #••••••\r\n     o }\r\n     \\*/\r\n    R.hsl2rgb = function (h, s, l, o) {\r\n        if (this.is(h, "object") && "h" in h && "s" in h && "l" in h) {\r\n            l = h.l;\r\n            s = h.s;\r\n            h = h.h;\r\n        }\r\n        if (h > 1 || s > 1 || l > 1) {\r\n            h /= 360;\r\n            s /= 100;\r\n            l /= 100;\r\n        }\r\n        h *= 360;\r\n        var R, G, B, X, C;\r\n        h = (h % 360) / 60;\r\n        C = 2 * s * (l < .5 ? l : 1 - l);\r\n        X = C * (1 - abs(h % 2 - 1));\r\n        R = G = B = l - C / 2;\r\n\r\n        h = ~~h;\r\n        R += [C, X, 0, 0, X, C][h];\r\n        G += [X, C, C, X, 0, 0][h];\r\n        B += [0, 0, X, C, C, X][h];\r\n        return packageRGB(R, G, B, o);\r\n    };\r\n    /*\\\r\n     * Raphael.rgb2hsb\r\n     [ method ]\r\n     **\r\n     * Converts RGB values to HSB object.\r\n     > Parameters\r\n     - r (number) red\r\n     - g (number) green\r\n     - b (number) blue\r\n     = (object) HSB object in format:\r\n     o {\r\n     o     h (number) hue\r\n     o     s (number) saturation\r\n     o     b (number) brightness\r\n     o }\r\n     \\*/\r\n    R.rgb2hsb = function (r, g, b) {\r\n        b = prepareRGB(r, g, b);\r\n        r = b[0];\r\n        g = b[1];\r\n        b = b[2];\r\n\r\n        var H, S, V, C;\r\n        V = mmax(r, g, b);\r\n        C = V - mmin(r, g, b);\r\n        H = (C == 0 ? null :\r\n                V == r ? (g - b) / C :\r\n                    V == g ? (b - r) / C + 2 :\r\n                    (r - g) / C + 4\r\n        );\r\n        H = ((H + 360) % 6) * 60 / 360;\r\n        S = C == 0 ? 0 : C / V;\r\n        return {h: H, s: S, b: V, toString: hsbtoString};\r\n    };\r\n    /*\\\r\n     * Raphael.rgb2hsl\r\n     [ method ]\r\n     **\r\n     * Converts RGB values to HSL object.\r\n     > Parameters\r\n     - r (number) red\r\n     - g (number) green\r\n     - b (number) blue\r\n     = (object) HSL object in format:\r\n     o {\r\n     o     h (number) hue\r\n     o     s (number) saturation\r\n     o     l (number) luminosity\r\n     o }\r\n     \\*/\r\n    R.rgb2hsl = function (r, g, b) {\r\n        b = prepareRGB(r, g, b);\r\n        r = b[0];\r\n        g = b[1];\r\n        b = b[2];\r\n\r\n        var H, S, L, M, m, C;\r\n        M = mmax(r, g, b);\r\n        m = mmin(r, g, b);\r\n        C = M - m;\r\n        H = (C == 0 ? null :\r\n            M == r ? (g - b) / C :\r\n                M == g ? (b - r) / C + 2 :\r\n                (r - g) / C + 4);\r\n        H = ((H + 360) % 6) * 60 / 360;\r\n        L = (M + m) / 2;\r\n        S = (C == 0 ? 0 :\r\n            L < .5 ? C / (2 * L) :\r\n            C / (2 - 2 * L));\r\n        return {h: H, s: S, l: L, toString: hsltoString};\r\n    };\r\n    R._path2string = function () {\r\n        return this.join(",").replace(p2s, "$1");\r\n    };\r\n    function repush(array, item) {\r\n        for (var i = 0, ii = array.length; i < ii; i++) if (array[i] === item) {\r\n            return array.push(array.splice(i, 1)[0]);\r\n        }\r\n    }\r\n    function cacher(f, scope, postprocessor) {\r\n        function newf() {\r\n            var arg = Array.prototype.slice.call(arguments, 0),\r\n                args = arg.join("\\u2400"),\r\n                cache = newf.cache = newf.cache || {},\r\n                count = newf.count = newf.count || [];\r\n            if (cache[has](args)) {\r\n                repush(count, args);\r\n                return postprocessor ? postprocessor(cache[args]) : cache[args];\r\n            }\r\n            count.length >= 1e3 && delete cache[count.shift()];\r\n            count.push(args);\r\n            cache[args] = f[apply](scope, arg);\r\n            return postprocessor ? postprocessor(cache[args]) : cache[args];\r\n        }\r\n        return newf;\r\n    }\r\n\r\n    var preload = R._preload = function (src, f) {\r\n        var img = g.doc.createElement("img");\r\n        img.style.cssText = "position:absolute;left:-9999em;top:-9999em";\r\n        img.onload = function () {\r\n            f.call(this);\r\n            this.onload = null;\r\n            g.doc.body.removeChild(this);\r\n        };\r\n        img.onerror = function () {\r\n            g.doc.body.removeChild(this);\r\n        };\r\n        g.doc.body.appendChild(img);\r\n        img.src = src;\r\n    };\r\n\r\n    function clrToString() {\r\n        return this.hex;\r\n    }\r\n\r\n    /*\\\r\n     * Raphael.getRGB\r\n     [ method ]\r\n     **\r\n     * Parses colour string as RGB object\r\n     > Parameters\r\n     - colour (string) colour string in one of formats:\r\n     # <ul>\r\n     #     <li>Colour name (“<code>red</code>”, “<code>green</code>”, “<code>cornflowerblue</code>”, etc)</li>\r\n     #     <li>#••• — shortened HTML colour: (“<code>#000</code>”, “<code>#fc0</code>”, etc)</li>\r\n     #     <li>#•••••• — full length HTML colour: (“<code>#000000</code>”, “<code>#bd2300</code>”)</li>\r\n     #     <li>rgb(•••, •••, •••) — red, green and blue channels’ values: (“<code>rgb(200,&nbsp;100,&nbsp;0)</code>”)</li>\r\n     #     <li>rgb(•••%, •••%, •••%) — same as above, but in %: (“<code>rgb(100%,&nbsp;175%,&nbsp;0%)</code>”)</li>\r\n     #     <li>hsb(•••, •••, •••) — hue, saturation and brightness values: (“<code>hsb(0.5,&nbsp;0.25,&nbsp;1)</code>”)</li>\r\n     #     <li>hsb(•••%, •••%, •••%) — same as above, but in %</li>\r\n     #     <li>hsl(•••, •••, •••) — same as hsb</li>\r\n     #     <li>hsl(•••%, •••%, •••%) — same as hsb</li>\r\n     # </ul>\r\n     = (object) RGB object in format:\r\n     o {\r\n     o     r (number) red,\r\n     o     g (number) green,\r\n     o     b (number) blue\r\n     o     hex (string) color in HTML/CSS format: #••••••,\r\n     o     error (boolean) true if string can’t be parsed\r\n     o }\r\n     \\*/\r\n    R.getRGB = cacher(function (colour) {\r\n        if (!colour || !!((colour = Str(colour)).indexOf("-") + 1)) {\r\n            return {r: -1, g: -1, b: -1, hex: "none", error: 1, toString: clrToString};\r\n        }\r\n        if (colour == "none") {\r\n            return {r: -1, g: -1, b: -1, hex: "none", toString: clrToString};\r\n        }\r\n        !(hsrg[has](colour.toLowerCase().substring(0, 2)) || colour.charAt() == "#") && (colour = toHex(colour));\r\n        var res,\r\n            red,\r\n            green,\r\n            blue,\r\n            opacity,\r\n            t,\r\n            values,\r\n            rgb = colour.match(colourRegExp);\r\n        if (rgb) {\r\n            if (rgb[2]) {\r\n                blue = toInt(rgb[2].substring(5), 16);\r\n                green = toInt(rgb[2].substring(3, 5), 16);\r\n                red = toInt(rgb[2].substring(1, 3), 16);\r\n            }\r\n            if (rgb[3]) {\r\n                blue = toInt((t = rgb[3].charAt(3)) + t, 16);\r\n                green = toInt((t = rgb[3].charAt(2)) + t, 16);\r\n                red = toInt((t = rgb[3].charAt(1)) + t, 16);\r\n            }\r\n            if (rgb[4]) {\r\n                values = rgb[4][split](commaSpaces);\r\n                red = toFloat(values[0]);\r\n                values[0].slice(-1) == "%" && (red *= 2.55);\r\n                green = toFloat(values[1]);\r\n                values[1].slice(-1) == "%" && (green *= 2.55);\r\n                blue = toFloat(values[2]);\r\n                values[2].slice(-1) == "%" && (blue *= 2.55);\r\n                rgb[1].toLowerCase().slice(0, 4) == "rgba" && (opacity = toFloat(values[3]));\r\n                values[3] && values[3].slice(-1) == "%" && (opacity /= 100);\r\n            }\r\n            if (rgb[5]) {\r\n                values = rgb[5][split](commaSpaces);\r\n                red = toFloat(values[0]);\r\n                values[0].slice(-1) == "%" && (red *= 2.55);\r\n                green = toFloat(values[1]);\r\n                values[1].slice(-1) == "%" && (green *= 2.55);\r\n                blue = toFloat(values[2]);\r\n                values[2].slice(-1) == "%" && (blue *= 2.55);\r\n                (values[0].slice(-3) == "deg" || values[0].slice(-1) == "\\xb0") && (red /= 360);\r\n                rgb[1].toLowerCase().slice(0, 4) == "hsba" && (opacity = toFloat(values[3]));\r\n                values[3] && values[3].slice(-1) == "%" && (opacity /= 100);\r\n                return R.hsb2rgb(red, green, blue, opacity);\r\n            }\r\n            if (rgb[6]) {\r\n                values = rgb[6][split](commaSpaces);\r\n                red = toFloat(values[0]);\r\n                values[0].slice(-1) == "%" && (red *= 2.55);\r\n                green = toFloat(values[1]);\r\n                values[1].slice(-1) == "%" && (green *= 2.55);\r\n                blue = toFloat(values[2]);\r\n                values[2].slice(-1) == "%" && (blue *= 2.55);\r\n                (values[0].slice(-3) == "deg" || values[0].slice(-1) == "\\xb0") && (red /= 360);\r\n                rgb[1].toLowerCase().slice(0, 4) == "hsla" && (opacity = toFloat(values[3]));\r\n                values[3] && values[3].slice(-1) == "%" && (opacity /= 100);\r\n                return R.hsl2rgb(red, green, blue, opacity);\r\n            }\r\n            rgb = {r: red, g: green, b: blue, toString: clrToString};\r\n            rgb.hex = "#" + (16777216 | blue | (green << 8) | (red << 16)).toString(16).slice(1);\r\n            R.is(opacity, "finite") && (rgb.opacity = opacity);\r\n            return rgb;\r\n        }\r\n        return {r: -1, g: -1, b: -1, hex: "none", error: 1, toString: clrToString};\r\n    }, R);\r\n    /*\\\r\n     * Raphael.hsb\r\n     [ method ]\r\n     **\r\n     * Converts HSB values to hex representation of the colour.\r\n     > Parameters\r\n     - h (number) hue\r\n     - s (number) saturation\r\n     - b (number) value or brightness\r\n     = (string) hex representation of the colour.\r\n     \\*/\r\n    R.hsb = cacher(function (h, s, b) {\r\n        return R.hsb2rgb(h, s, b).hex;\r\n    });\r\n    /*\\\r\n     * Raphael.hsl\r\n     [ method ]\r\n     **\r\n     * Converts HSL values to hex representation of the colour.\r\n     > Parameters\r\n     - h (number) hue\r\n     - s (number) saturation\r\n     - l (number) luminosity\r\n     = (string) hex representation of the colour.\r\n     \\*/\r\n    R.hsl = cacher(function (h, s, l) {\r\n        return R.hsl2rgb(h, s, l).hex;\r\n    });\r\n    /*\\\r\n     * Raphael.rgb\r\n     [ method ]\r\n     **\r\n     * Converts RGB values to hex representation of the colour.\r\n     > Parameters\r\n     - r (number) red\r\n     - g (number) green\r\n     - b (number) blue\r\n     = (string) hex representation of the colour.\r\n     \\*/\r\n    R.rgb = cacher(function (r, g, b) {\r\n        function round(x) { return (x + 0.5) | 0; }\r\n        return "#" + (16777216 | round(b) | (round(g) << 8) | (round(r) << 16)).toString(16).slice(1);\r\n    });\r\n    /*\\\r\n     * Raphael.getColor\r\n     [ method ]\r\n     **\r\n     * On each call returns next colour in the spectrum. To reset it back to red call @Raphael.getColor.reset\r\n     > Parameters\r\n     - value (number) #optional brightness, default is `0.75`\r\n     = (string) hex representation of the colour.\r\n     \\*/\r\n    R.getColor = function (value) {\r\n        var start = this.getColor.start = this.getColor.start || {h: 0, s: 1, b: value || .75},\r\n            rgb = this.hsb2rgb(start.h, start.s, start.b);\r\n        start.h += .075;\r\n        if (start.h > 1) {\r\n            start.h = 0;\r\n            start.s -= .2;\r\n            start.s <= 0 && (this.getColor.start = {h: 0, s: 1, b: start.b});\r\n        }\r\n        return rgb.hex;\r\n    };\r\n    /*\\\r\n     * Raphael.getColor.reset\r\n     [ method ]\r\n     **\r\n     * Resets spectrum position for @Raphael.getColor back to red.\r\n     \\*/\r\n    R.getColor.reset = function () {\r\n        delete this.start;\r\n    };\r\n\r\n    // http://schepers.cc/getting-to-the-point\r\n    function catmullRom2bezier(crp, z) {\r\n        var d = [];\r\n        for (var i = 0, iLen = crp.length; iLen - 2 * !z > i; i += 2) {\r\n            var p = [\r\n                {x: +crp[i - 2], y: +crp[i - 1]},\r\n                {x: +crp[i],     y: +crp[i + 1]},\r\n                {x: +crp[i + 2], y: +crp[i + 3]},\r\n                {x: +crp[i + 4], y: +crp[i + 5]}\r\n            ];\r\n            if (z) {\r\n                if (!i) {\r\n                    p[0] = {x: +crp[iLen - 2], y: +crp[iLen - 1]};\r\n                } else if (iLen - 4 == i) {\r\n                    p[3] = {x: +crp[0], y: +crp[1]};\r\n                } else if (iLen - 2 == i) {\r\n                    p[2] = {x: +crp[0], y: +crp[1]};\r\n                    p[3] = {x: +crp[2], y: +crp[3]};\r\n                }\r\n            } else {\r\n                if (iLen - 4 == i) {\r\n                    p[3] = p[2];\r\n                } else if (!i) {\r\n                    p[0] = {x: +crp[i], y: +crp[i + 1]};\r\n                }\r\n            }\r\n            d.push(["C",\r\n                (-p[0].x + 6 * p[1].x + p[2].x) / 6,\r\n                (-p[0].y + 6 * p[1].y + p[2].y) / 6,\r\n                (p[1].x + 6 * p[2].x - p[3].x) / 6,\r\n                (p[1].y + 6*p[2].y - p[3].y) / 6,\r\n                p[2].x,\r\n                p[2].y\r\n            ]);\r\n        }\r\n\r\n        return d;\r\n    }\r\n    /*\\\r\n     * Raphael.parsePathString\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Parses given path string into an array of arrays of path segments.\r\n     > Parameters\r\n     - pathString (string|array) path string or array of segments (in the last case it will be returned straight away)\r\n     = (array) array of segments.\r\n     \\*/\r\n    R.parsePathString = function (pathString) {\r\n        if (!pathString) {\r\n            return null;\r\n        }\r\n        var pth = paths(pathString);\r\n        if (pth.arr) {\r\n            return pathClone(pth.arr);\r\n        }\r\n\r\n        var paramCounts = {a: 7, c: 6, h: 1, l: 2, m: 2, r: 4, q: 4, s: 4, t: 2, v: 1, z: 0},\r\n            data = [];\r\n        if (R.is(pathString, array) && R.is(pathString[0], array)) { // rough assumption\r\n            data = pathClone(pathString);\r\n        }\r\n        if (!data.length) {\r\n            Str(pathString).replace(pathCommand, function (a, b, c) {\r\n                var params = [],\r\n                    name = b.toLowerCase();\r\n                c.replace(pathValues, function (a, b) {\r\n                    b && params.push(+b);\r\n                });\r\n                if (name == "m" && params.length > 2) {\r\n                    data.push([b][concat](params.splice(0, 2)));\r\n                    name = "l";\r\n                    b = b == "m" ? "l" : "L";\r\n                }\r\n                if (name == "r") {\r\n                    data.push([b][concat](params));\r\n                } else while (params.length >= paramCounts[name]) {\r\n                    data.push([b][concat](params.splice(0, paramCounts[name])));\r\n                    if (!paramCounts[name]) {\r\n                        break;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        data.toString = R._path2string;\r\n        pth.arr = pathClone(data);\r\n        return data;\r\n    };\r\n    /*\\\r\n     * Raphael.parseTransformString\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Parses given path string into an array of transformations.\r\n     > Parameters\r\n     - TString (string|array) transform string or array of transformations (in the last case it will be returned straight away)\r\n     = (array) array of transformations.\r\n     \\*/\r\n    R.parseTransformString = cacher(function (TString) {\r\n        if (!TString) {\r\n            return null;\r\n        }\r\n        var paramCounts = {r: 3, s: 4, t: 2, m: 6},\r\n            data = [];\r\n        if (R.is(TString, array) && R.is(TString[0], array)) { // rough assumption\r\n            data = pathClone(TString);\r\n        }\r\n        if (!data.length) {\r\n            Str(TString).replace(tCommand, function (a, b, c) {\r\n                var params = [],\r\n                    name = lowerCase.call(b);\r\n                c.replace(pathValues, function (a, b) {\r\n                    b && params.push(+b);\r\n                });\r\n                data.push([b][concat](params));\r\n            });\r\n        }\r\n        data.toString = R._path2string;\r\n        return data;\r\n    });\r\n    // PATHS\r\n    var paths = function (ps) {\r\n        var p = paths.ps = paths.ps || {};\r\n        if (p[ps]) {\r\n            p[ps].sleep = 100;\r\n        } else {\r\n            p[ps] = {\r\n                sleep: 100\r\n            };\r\n        }\r\n        setTimeout(function () {\r\n            for (var key in p) if (p[has](key) && key != ps) {\r\n                p[key].sleep--;\r\n                !p[key].sleep && delete p[key];\r\n            }\r\n        });\r\n        return p[ps];\r\n    };\r\n    /*\\\r\n     * Raphael.findDotsAtSegment\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Find dot coordinates on the given cubic bezier curve at the given t.\r\n     > Parameters\r\n     - p1x (number) x of the first point of the curve\r\n     - p1y (number) y of the first point of the curve\r\n     - c1x (number) x of the first anchor of the curve\r\n     - c1y (number) y of the first anchor of the curve\r\n     - c2x (number) x of the second anchor of the curve\r\n     - c2y (number) y of the second anchor of the curve\r\n     - p2x (number) x of the second point of the curve\r\n     - p2y (number) y of the second point of the curve\r\n     - t (number) position on the curve (0..1)\r\n     = (object) point information in format:\r\n     o {\r\n     o     x: (number) x coordinate of the point\r\n     o     y: (number) y coordinate of the point\r\n     o     m: {\r\n     o         x: (number) x coordinate of the left anchor\r\n     o         y: (number) y coordinate of the left anchor\r\n     o     }\r\n     o     n: {\r\n     o         x: (number) x coordinate of the right anchor\r\n     o         y: (number) y coordinate of the right anchor\r\n     o     }\r\n     o     start: {\r\n     o         x: (number) x coordinate of the start of the curve\r\n     o         y: (number) y coordinate of the start of the curve\r\n     o     }\r\n     o     end: {\r\n     o         x: (number) x coordinate of the end of the curve\r\n     o         y: (number) y coordinate of the end of the curve\r\n     o     }\r\n     o     alpha: (number) angle of the curve derivative at the point\r\n     o }\r\n     \\*/\r\n    R.findDotsAtSegment = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {\r\n        var t1 = 1 - t,\r\n            t13 = pow(t1, 3),\r\n            t12 = pow(t1, 2),\r\n            t2 = t * t,\r\n            t3 = t2 * t,\r\n            x = t13 * p1x + t12 * 3 * t * c1x + t1 * 3 * t * t * c2x + t3 * p2x,\r\n            y = t13 * p1y + t12 * 3 * t * c1y + t1 * 3 * t * t * c2y + t3 * p2y,\r\n            mx = p1x + 2 * t * (c1x - p1x) + t2 * (c2x - 2 * c1x + p1x),\r\n            my = p1y + 2 * t * (c1y - p1y) + t2 * (c2y - 2 * c1y + p1y),\r\n            nx = c1x + 2 * t * (c2x - c1x) + t2 * (p2x - 2 * c2x + c1x),\r\n            ny = c1y + 2 * t * (c2y - c1y) + t2 * (p2y - 2 * c2y + c1y),\r\n            ax = t1 * p1x + t * c1x,\r\n            ay = t1 * p1y + t * c1y,\r\n            cx = t1 * c2x + t * p2x,\r\n            cy = t1 * c2y + t * p2y,\r\n            alpha = (90 - math.atan2(mx - nx, my - ny) * 180 / PI);\r\n        (mx > nx || my < ny) && (alpha += 180);\r\n        return {\r\n            x: x,\r\n            y: y,\r\n            m: {x: mx, y: my},\r\n            n: {x: nx, y: ny},\r\n            start: {x: ax, y: ay},\r\n            end: {x: cx, y: cy},\r\n            alpha: alpha\r\n        };\r\n    };\r\n    /*\\\r\n     * Raphael.bezierBBox\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Return bounding box of a given cubic bezier curve\r\n     > Parameters\r\n     - p1x (number) x of the first point of the curve\r\n     - p1y (number) y of the first point of the curve\r\n     - c1x (number) x of the first anchor of the curve\r\n     - c1y (number) y of the first anchor of the curve\r\n     - c2x (number) x of the second anchor of the curve\r\n     - c2y (number) y of the second anchor of the curve\r\n     - p2x (number) x of the second point of the curve\r\n     - p2y (number) y of the second point of the curve\r\n     * or\r\n     - bez (array) array of six points for bezier curve\r\n     = (object) point information in format:\r\n     o {\r\n     o     min: {\r\n     o         x: (number) x coordinate of the left point\r\n     o         y: (number) y coordinate of the top point\r\n     o     }\r\n     o     max: {\r\n     o         x: (number) x coordinate of the right point\r\n     o         y: (number) y coordinate of the bottom point\r\n     o     }\r\n     o }\r\n     \\*/\r\n    R.bezierBBox = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y) {\r\n        if (!R.is(p1x, "array")) {\r\n            p1x = [p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y];\r\n        }\r\n        var bbox = curveDim.apply(null, p1x);\r\n        return {\r\n            x: bbox.min.x,\r\n            y: bbox.min.y,\r\n            x2: bbox.max.x,\r\n            y2: bbox.max.y,\r\n            width: bbox.max.x - bbox.min.x,\r\n            height: bbox.max.y - bbox.min.y\r\n        };\r\n    };\r\n    /*\\\r\n     * Raphael.isPointInsideBBox\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Returns `true` if given point is inside bounding boxes.\r\n     > Parameters\r\n     - bbox (string) bounding box\r\n     - x (string) x coordinate of the point\r\n     - y (string) y coordinate of the point\r\n     = (boolean) `true` if point inside\r\n     \\*/\r\n    R.isPointInsideBBox = function (bbox, x, y) {\r\n        return x >= bbox.x && x <= bbox.x2 && y >= bbox.y && y <= bbox.y2;\r\n    };\r\n    /*\\\r\n     * Raphael.isBBoxIntersect\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Returns `true` if two bounding boxes intersect\r\n     > Parameters\r\n     - bbox1 (string) first bounding box\r\n     - bbox2 (string) second bounding box\r\n     = (boolean) `true` if they intersect\r\n     \\*/\r\n    R.isBBoxIntersect = function (bbox1, bbox2) {\r\n        var i = R.isPointInsideBBox;\r\n        return i(bbox2, bbox1.x, bbox1.y)\r\n            || i(bbox2, bbox1.x2, bbox1.y)\r\n            || i(bbox2, bbox1.x, bbox1.y2)\r\n            || i(bbox2, bbox1.x2, bbox1.y2)\r\n            || i(bbox1, bbox2.x, bbox2.y)\r\n            || i(bbox1, bbox2.x2, bbox2.y)\r\n            || i(bbox1, bbox2.x, bbox2.y2)\r\n            || i(bbox1, bbox2.x2, bbox2.y2)\r\n            || (bbox1.x < bbox2.x2 && bbox1.x > bbox2.x || bbox2.x < bbox1.x2 && bbox2.x > bbox1.x)\r\n            && (bbox1.y < bbox2.y2 && bbox1.y > bbox2.y || bbox2.y < bbox1.y2 && bbox2.y > bbox1.y);\r\n    };\r\n    function base3(t, p1, p2, p3, p4) {\r\n        var t1 = -3 * p1 + 9 * p2 - 9 * p3 + 3 * p4,\r\n            t2 = t * t1 + 6 * p1 - 12 * p2 + 6 * p3;\r\n        return t * t2 - 3 * p1 + 3 * p2;\r\n    }\r\n    function bezlen(x1, y1, x2, y2, x3, y3, x4, y4, z) {\r\n        if (z == null) {\r\n            z = 1;\r\n        }\r\n        z = z > 1 ? 1 : z < 0 ? 0 : z;\r\n        var z2 = z / 2,\r\n            n = 12,\r\n            Tvalues = [-0.1252,0.1252,-0.3678,0.3678,-0.5873,0.5873,-0.7699,0.7699,-0.9041,0.9041,-0.9816,0.9816],\r\n            Cvalues = [0.2491,0.2491,0.2335,0.2335,0.2032,0.2032,0.1601,0.1601,0.1069,0.1069,0.0472,0.0472],\r\n            sum = 0;\r\n        for (var i = 0; i < n; i++) {\r\n            var ct = z2 * Tvalues[i] + z2,\r\n                xbase = base3(ct, x1, x2, x3, x4),\r\n                ybase = base3(ct, y1, y2, y3, y4),\r\n                comb = xbase * xbase + ybase * ybase;\r\n            sum += Cvalues[i] * math.sqrt(comb);\r\n        }\r\n        return z2 * sum;\r\n    }\r\n    function getTatLen(x1, y1, x2, y2, x3, y3, x4, y4, ll) {\r\n        if (ll < 0 || bezlen(x1, y1, x2, y2, x3, y3, x4, y4) < ll) {\r\n            return;\r\n        }\r\n        var t = 1,\r\n            step = t / 2,\r\n            t2 = t - step,\r\n            l,\r\n            e = .01;\r\n        l = bezlen(x1, y1, x2, y2, x3, y3, x4, y4, t2);\r\n        while (abs(l - ll) > e) {\r\n            step /= 2;\r\n            t2 += (l < ll ? 1 : -1) * step;\r\n            l = bezlen(x1, y1, x2, y2, x3, y3, x4, y4, t2);\r\n        }\r\n        return t2;\r\n    }\r\n    function intersect(x1, y1, x2, y2, x3, y3, x4, y4) {\r\n        if (\r\n            mmax(x1, x2) < mmin(x3, x4) ||\r\n            mmin(x1, x2) > mmax(x3, x4) ||\r\n            mmax(y1, y2) < mmin(y3, y4) ||\r\n            mmin(y1, y2) > mmax(y3, y4)\r\n        ) {\r\n            return;\r\n        }\r\n        var nx = (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\r\n            ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\r\n            denominator = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\r\n\r\n        if (!denominator) {\r\n            return;\r\n        }\r\n        var px = nx / denominator,\r\n            py = ny / denominator,\r\n            px2 = +px.toFixed(2),\r\n            py2 = +py.toFixed(2);\r\n        if (\r\n            px2 < +mmin(x1, x2).toFixed(2) ||\r\n            px2 > +mmax(x1, x2).toFixed(2) ||\r\n            px2 < +mmin(x3, x4).toFixed(2) ||\r\n            px2 > +mmax(x3, x4).toFixed(2) ||\r\n            py2 < +mmin(y1, y2).toFixed(2) ||\r\n            py2 > +mmax(y1, y2).toFixed(2) ||\r\n            py2 < +mmin(y3, y4).toFixed(2) ||\r\n            py2 > +mmax(y3, y4).toFixed(2)\r\n        ) {\r\n            return;\r\n        }\r\n        return {x: px, y: py};\r\n    }\r\n    function inter(bez1, bez2) {\r\n        return interHelper(bez1, bez2);\r\n    }\r\n    function interCount(bez1, bez2) {\r\n        return interHelper(bez1, bez2, 1);\r\n    }\r\n    function interHelper(bez1, bez2, justCount) {\r\n        var bbox1 = R.bezierBBox(bez1),\r\n            bbox2 = R.bezierBBox(bez2);\r\n        if (!R.isBBoxIntersect(bbox1, bbox2)) {\r\n            return justCount ? 0 : [];\r\n        }\r\n        var l1 = bezlen.apply(0, bez1),\r\n            l2 = bezlen.apply(0, bez2),\r\n            n1 = mmax(~~(l1 / 5), 1),\r\n            n2 = mmax(~~(l2 / 5), 1),\r\n            dots1 = [],\r\n            dots2 = [],\r\n            xy = {},\r\n            res = justCount ? 0 : [];\r\n        for (var i = 0; i < n1 + 1; i++) {\r\n            var p = R.findDotsAtSegment.apply(R, bez1.concat(i / n1));\r\n            dots1.push({x: p.x, y: p.y, t: i / n1});\r\n        }\r\n        for (i = 0; i < n2 + 1; i++) {\r\n            p = R.findDotsAtSegment.apply(R, bez2.concat(i / n2));\r\n            dots2.push({x: p.x, y: p.y, t: i / n2});\r\n        }\r\n        for (i = 0; i < n1; i++) {\r\n            for (var j = 0; j < n2; j++) {\r\n                var di = dots1[i],\r\n                    di1 = dots1[i + 1],\r\n                    dj = dots2[j],\r\n                    dj1 = dots2[j + 1],\r\n                    ci = abs(di1.x - di.x) < .001 ? "y" : "x",\r\n                    cj = abs(dj1.x - dj.x) < .001 ? "y" : "x",\r\n                    is = intersect(di.x, di.y, di1.x, di1.y, dj.x, dj.y, dj1.x, dj1.y);\r\n                if (is) {\r\n                    if (xy[is.x.toFixed(4)] == is.y.toFixed(4)) {\r\n                        continue;\r\n                    }\r\n                    xy[is.x.toFixed(4)] = is.y.toFixed(4);\r\n                    var t1 = di.t + abs((is[ci] - di[ci]) / (di1[ci] - di[ci])) * (di1.t - di.t),\r\n                        t2 = dj.t + abs((is[cj] - dj[cj]) / (dj1[cj] - dj[cj])) * (dj1.t - dj.t);\r\n                    if (t1 >= 0 && t1 <= 1.001 && t2 >= 0 && t2 <= 1.001) {\r\n                        if (justCount) {\r\n                            res++;\r\n                        } else {\r\n                            res.push({\r\n                                x: is.x,\r\n                                y: is.y,\r\n                                t1: mmin(t1, 1),\r\n                                t2: mmin(t2, 1)\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n    /*\\\r\n     * Raphael.pathIntersection\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Finds intersections of two paths\r\n     > Parameters\r\n     - path1 (string) path string\r\n     - path2 (string) path string\r\n     = (array) dots of intersection\r\n     o [\r\n     o     {\r\n     o         x: (number) x coordinate of the point\r\n     o         y: (number) y coordinate of the point\r\n     o         t1: (number) t value for segment of path1\r\n     o         t2: (number) t value for segment of path2\r\n     o         segment1: (number) order number for segment of path1\r\n     o         segment2: (number) order number for segment of path2\r\n     o         bez1: (array) eight coordinates representing beziér curve for the segment of path1\r\n     o         bez2: (array) eight coordinates representing beziér curve for the segment of path2\r\n     o     }\r\n     o ]\r\n     \\*/\r\n    R.pathIntersection = function (path1, path2) {\r\n        return interPathHelper(path1, path2);\r\n    };\r\n    R.pathIntersectionNumber = function (path1, path2) {\r\n        return interPathHelper(path1, path2, 1);\r\n    };\r\n    function interPathHelper(path1, path2, justCount) {\r\n        path1 = R._path2curve(path1);\r\n        path2 = R._path2curve(path2);\r\n        var x1, y1, x2, y2, x1m, y1m, x2m, y2m, bez1, bez2,\r\n            res = justCount ? 0 : [];\r\n        for (var i = 0, ii = path1.length; i < ii; i++) {\r\n            var pi = path1[i];\r\n            if (pi[0] == "M") {\r\n                x1 = x1m = pi[1];\r\n                y1 = y1m = pi[2];\r\n            } else {\r\n                if (pi[0] == "C") {\r\n                    bez1 = [x1, y1].concat(pi.slice(1));\r\n                    x1 = bez1[6];\r\n                    y1 = bez1[7];\r\n                } else {\r\n                    bez1 = [x1, y1, x1, y1, x1m, y1m, x1m, y1m];\r\n                    x1 = x1m;\r\n                    y1 = y1m;\r\n                }\r\n                for (var j = 0, jj = path2.length; j < jj; j++) {\r\n                    var pj = path2[j];\r\n                    if (pj[0] == "M") {\r\n                        x2 = x2m = pj[1];\r\n                        y2 = y2m = pj[2];\r\n                    } else {\r\n                        if (pj[0] == "C") {\r\n                            bez2 = [x2, y2].concat(pj.slice(1));\r\n                            x2 = bez2[6];\r\n                            y2 = bez2[7];\r\n                        } else {\r\n                            bez2 = [x2, y2, x2, y2, x2m, y2m, x2m, y2m];\r\n                            x2 = x2m;\r\n                            y2 = y2m;\r\n                        }\r\n                        var intr = interHelper(bez1, bez2, justCount);\r\n                        if (justCount) {\r\n                            res += intr;\r\n                        } else {\r\n                            for (var k = 0, kk = intr.length; k < kk; k++) {\r\n                                intr[k].segment1 = i;\r\n                                intr[k].segment2 = j;\r\n                                intr[k].bez1 = bez1;\r\n                                intr[k].bez2 = bez2;\r\n                            }\r\n                            res = res.concat(intr);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n    /*\\\r\n     * Raphael.isPointInsidePath\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Returns `true` if given point is inside a given closed path.\r\n     > Parameters\r\n     - path (string) path string\r\n     - x (number) x of the point\r\n     - y (number) y of the point\r\n     = (boolean) true, if point is inside the path\r\n     \\*/\r\n    R.isPointInsidePath = function (path, x, y) {\r\n        var bbox = R.pathBBox(path);\r\n        return R.isPointInsideBBox(bbox, x, y) &&\r\n            interPathHelper(path, [["M", x, y], ["H", bbox.x2 + 10]], 1) % 2 == 1;\r\n    };\r\n    R._removedFactory = function (methodname) {\r\n        return function () {\r\n            eve("raphael.log", null, "Rapha\\xebl: you are calling to method \\u201c" + methodname + "\\u201d of removed object", methodname);\r\n        };\r\n    };\r\n    /*\\\r\n     * Raphael.pathBBox\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Return bounding box of a given path\r\n     > Parameters\r\n     - path (string) path string\r\n     = (object) bounding box\r\n     o {\r\n     o     x: (number) x coordinate of the left top point of the box\r\n     o     y: (number) y coordinate of the left top point of the box\r\n     o     x2: (number) x coordinate of the right bottom point of the box\r\n     o     y2: (number) y coordinate of the right bottom point of the box\r\n     o     width: (number) width of the box\r\n     o     height: (number) height of the box\r\n     o     cx: (number) x coordinate of the center of the box\r\n     o     cy: (number) y coordinate of the center of the box\r\n     o }\r\n     \\*/\r\n    var pathDimensions = R.pathBBox = function (path) {\r\n            var pth = paths(path);\r\n            if (pth.bbox) {\r\n                return clone(pth.bbox);\r\n            }\r\n            if (!path) {\r\n                return {x: 0, y: 0, width: 0, height: 0, x2: 0, y2: 0};\r\n            }\r\n            path = path2curve(path);\r\n            var x = 0,\r\n                y = 0,\r\n                X = [],\r\n                Y = [],\r\n                p;\r\n            for (var i = 0, ii = path.length; i < ii; i++) {\r\n                p = path[i];\r\n                if (p[0] == "M") {\r\n                    x = p[1];\r\n                    y = p[2];\r\n                    X.push(x);\r\n                    Y.push(y);\r\n                } else {\r\n                    var dim = curveDim(x, y, p[1], p[2], p[3], p[4], p[5], p[6]);\r\n                    X = X[concat](dim.min.x, dim.max.x);\r\n                    Y = Y[concat](dim.min.y, dim.max.y);\r\n                    x = p[5];\r\n                    y = p[6];\r\n                }\r\n            }\r\n            var xmin = mmin[apply](0, X),\r\n                ymin = mmin[apply](0, Y),\r\n                xmax = mmax[apply](0, X),\r\n                ymax = mmax[apply](0, Y),\r\n                width = xmax - xmin,\r\n                height = ymax - ymin,\r\n                bb = {\r\n                    x: xmin,\r\n                    y: ymin,\r\n                    x2: xmax,\r\n                    y2: ymax,\r\n                    width: width,\r\n                    height: height,\r\n                    cx: xmin + width / 2,\r\n                    cy: ymin + height / 2\r\n                };\r\n            pth.bbox = clone(bb);\r\n            return bb;\r\n        },\r\n        pathClone = function (pathArray) {\r\n            var res = clone(pathArray);\r\n            res.toString = R._path2string;\r\n            return res;\r\n        },\r\n        pathToRelative = R._pathToRelative = function (pathArray) {\r\n            var pth = paths(pathArray);\r\n            if (pth.rel) {\r\n                return pathClone(pth.rel);\r\n            }\r\n            if (!R.is(pathArray, array) || !R.is(pathArray && pathArray[0], array)) { // rough assumption\r\n                pathArray = R.parsePathString(pathArray);\r\n            }\r\n            var res = [],\r\n                x = 0,\r\n                y = 0,\r\n                mx = 0,\r\n                my = 0,\r\n                start = 0;\r\n            if (pathArray[0][0] == "M") {\r\n                x = pathArray[0][1];\r\n                y = pathArray[0][2];\r\n                mx = x;\r\n                my = y;\r\n                start++;\r\n                res.push(["M", x, y]);\r\n            }\r\n            for (var i = start, ii = pathArray.length; i < ii; i++) {\r\n                var r = res[i] = [],\r\n                    pa = pathArray[i];\r\n                if (pa[0] != lowerCase.call(pa[0])) {\r\n                    r[0] = lowerCase.call(pa[0]);\r\n                    switch (r[0]) {\r\n                        case "a":\r\n                            r[1] = pa[1];\r\n                            r[2] = pa[2];\r\n                            r[3] = pa[3];\r\n                            r[4] = pa[4];\r\n                            r[5] = pa[5];\r\n                            r[6] = +(pa[6] - x).toFixed(3);\r\n                            r[7] = +(pa[7] - y).toFixed(3);\r\n                            break;\r\n                        case "v":\r\n                            r[1] = +(pa[1] - y).toFixed(3);\r\n                            break;\r\n                        case "m":\r\n                            mx = pa[1];\r\n                            my = pa[2];\r\n                        default:\r\n                            for (var j = 1, jj = pa.length; j < jj; j++) {\r\n                                r[j] = +(pa[j] - ((j % 2) ? x : y)).toFixed(3);\r\n                            }\r\n                    }\r\n                } else {\r\n                    r = res[i] = [];\r\n                    if (pa[0] == "m") {\r\n                        mx = pa[1] + x;\r\n                        my = pa[2] + y;\r\n                    }\r\n                    for (var k = 0, kk = pa.length; k < kk; k++) {\r\n                        res[i][k] = pa[k];\r\n                    }\r\n                }\r\n                var len = res[i].length;\r\n                switch (res[i][0]) {\r\n                    case "z":\r\n                        x = mx;\r\n                        y = my;\r\n                        break;\r\n                    case "h":\r\n                        x += +res[i][len - 1];\r\n                        break;\r\n                    case "v":\r\n                        y += +res[i][len - 1];\r\n                        break;\r\n                    default:\r\n                        x += +res[i][len - 2];\r\n                        y += +res[i][len - 1];\r\n                }\r\n            }\r\n            res.toString = R._path2string;\r\n            pth.rel = pathClone(res);\r\n            return res;\r\n        },\r\n        pathToAbsolute = R._pathToAbsolute = function (pathArray) {\r\n            var pth = paths(pathArray);\r\n            if (pth.abs) {\r\n                return pathClone(pth.abs);\r\n            }\r\n            if (!R.is(pathArray, array) || !R.is(pathArray && pathArray[0], array)) { // rough assumption\r\n                pathArray = R.parsePathString(pathArray);\r\n            }\r\n            if (!pathArray || !pathArray.length) {\r\n                return [["M", 0, 0]];\r\n            }\r\n            var res = [],\r\n                x = 0,\r\n                y = 0,\r\n                mx = 0,\r\n                my = 0,\r\n                start = 0;\r\n            if (pathArray[0][0] == "M") {\r\n                x = +pathArray[0][1];\r\n                y = +pathArray[0][2];\r\n                mx = x;\r\n                my = y;\r\n                start++;\r\n                res[0] = ["M", x, y];\r\n            }\r\n            var crz = pathArray.length == 3 && pathArray[0][0] == "M" && pathArray[1][0].toUpperCase() == "R" && pathArray[2][0].toUpperCase() == "Z";\r\n            for (var r, pa, i = start, ii = pathArray.length; i < ii; i++) {\r\n                res.push(r = []);\r\n                pa = pathArray[i];\r\n                if (pa[0] != upperCase.call(pa[0])) {\r\n                    r[0] = upperCase.call(pa[0]);\r\n                    switch (r[0]) {\r\n                        case "A":\r\n                            r[1] = pa[1];\r\n                            r[2] = pa[2];\r\n                            r[3] = pa[3];\r\n                            r[4] = pa[4];\r\n                            r[5] = pa[5];\r\n                            r[6] = +(pa[6] + x);\r\n                            r[7] = +(pa[7] + y);\r\n                            break;\r\n                        case "V":\r\n                            r[1] = +pa[1] + y;\r\n                            break;\r\n                        case "H":\r\n                            r[1] = +pa[1] + x;\r\n                            break;\r\n                        case "R":\r\n                            var dots = [x, y][concat](pa.slice(1));\r\n                            for (var j = 2, jj = dots.length; j < jj; j++) {\r\n                                dots[j] = +dots[j] + x;\r\n                                dots[++j] = +dots[j] + y;\r\n                            }\r\n                            res.pop();\r\n                            res = res[concat](catmullRom2bezier(dots, crz));\r\n                            break;\r\n                        case "M":\r\n                            mx = +pa[1] + x;\r\n                            my = +pa[2] + y;\r\n                        default:\r\n                            for (j = 1, jj = pa.length; j < jj; j++) {\r\n                                r[j] = +pa[j] + ((j % 2) ? x : y);\r\n                            }\r\n                    }\r\n                } else if (pa[0] == "R") {\r\n                    dots = [x, y][concat](pa.slice(1));\r\n                    res.pop();\r\n                    res = res[concat](catmullRom2bezier(dots, crz));\r\n                    r = ["R"][concat](pa.slice(-2));\r\n                } else {\r\n                    for (var k = 0, kk = pa.length; k < kk; k++) {\r\n                        r[k] = pa[k];\r\n                    }\r\n                }\r\n                switch (r[0]) {\r\n                    case "Z":\r\n                        x = mx;\r\n                        y = my;\r\n                        break;\r\n                    case "H":\r\n                        x = r[1];\r\n                        break;\r\n                    case "V":\r\n                        y = r[1];\r\n                        break;\r\n                    case "M":\r\n                        mx = r[r.length - 2];\r\n                        my = r[r.length - 1];\r\n                    default:\r\n                        x = r[r.length - 2];\r\n                        y = r[r.length - 1];\r\n                }\r\n            }\r\n            res.toString = R._path2string;\r\n            pth.abs = pathClone(res);\r\n            return res;\r\n        },\r\n        l2c = function (x1, y1, x2, y2) {\r\n            return [x1, y1, x2, y2, x2, y2];\r\n        },\r\n        q2c = function (x1, y1, ax, ay, x2, y2) {\r\n            var _13 = 1 / 3,\r\n                _23 = 2 / 3;\r\n            return [\r\n                _13 * x1 + _23 * ax,\r\n                _13 * y1 + _23 * ay,\r\n                _13 * x2 + _23 * ax,\r\n                _13 * y2 + _23 * ay,\r\n                x2,\r\n                y2\r\n            ];\r\n        },\r\n        a2c = function (x1, y1, rx, ry, angle, large_arc_flag, sweep_flag, x2, y2, recursive) {\r\n            // for more information of where this math came from visit:\r\n            // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\r\n            var _120 = PI * 120 / 180,\r\n                rad = PI / 180 * (+angle || 0),\r\n                res = [],\r\n                xy,\r\n                rotate = cacher(function (x, y, rad) {\r\n                    var X = x * math.cos(rad) - y * math.sin(rad),\r\n                        Y = x * math.sin(rad) + y * math.cos(rad);\r\n                    return {x: X, y: Y};\r\n                });\r\n            if (!recursive) {\r\n                xy = rotate(x1, y1, -rad);\r\n                x1 = xy.x;\r\n                y1 = xy.y;\r\n                xy = rotate(x2, y2, -rad);\r\n                x2 = xy.x;\r\n                y2 = xy.y;\r\n                var cos = math.cos(PI / 180 * angle),\r\n                    sin = math.sin(PI / 180 * angle),\r\n                    x = (x1 - x2) / 2,\r\n                    y = (y1 - y2) / 2;\r\n                var h = (x * x) / (rx * rx) + (y * y) / (ry * ry);\r\n                if (h > 1) {\r\n                    h = math.sqrt(h);\r\n                    rx = h * rx;\r\n                    ry = h * ry;\r\n                }\r\n                var rx2 = rx * rx,\r\n                    ry2 = ry * ry,\r\n                    k = (large_arc_flag == sweep_flag ? -1 : 1) *\r\n                        math.sqrt(abs((rx2 * ry2 - rx2 * y * y - ry2 * x * x) / (rx2 * y * y + ry2 * x * x))),\r\n                    cx = k * rx * y / ry + (x1 + x2) / 2,\r\n                    cy = k * -ry * x / rx + (y1 + y2) / 2,\r\n                    f1 = math.asin(((y1 - cy) / ry).toFixed(9)),\r\n                    f2 = math.asin(((y2 - cy) / ry).toFixed(9));\r\n\r\n                f1 = x1 < cx ? PI - f1 : f1;\r\n                f2 = x2 < cx ? PI - f2 : f2;\r\n                f1 < 0 && (f1 = PI * 2 + f1);\r\n                f2 < 0 && (f2 = PI * 2 + f2);\r\n                if (sweep_flag && f1 > f2) {\r\n                    f1 = f1 - PI * 2;\r\n                }\r\n                if (!sweep_flag && f2 > f1) {\r\n                    f2 = f2 - PI * 2;\r\n                }\r\n            } else {\r\n                f1 = recursive[0];\r\n                f2 = recursive[1];\r\n                cx = recursive[2];\r\n                cy = recursive[3];\r\n            }\r\n            var df = f2 - f1;\r\n            if (abs(df) > _120) {\r\n                var f2old = f2,\r\n                    x2old = x2,\r\n                    y2old = y2;\r\n                f2 = f1 + _120 * (sweep_flag && f2 > f1 ? 1 : -1);\r\n                x2 = cx + rx * math.cos(f2);\r\n                y2 = cy + ry * math.sin(f2);\r\n                res = a2c(x2, y2, rx, ry, angle, 0, sweep_flag, x2old, y2old, [f2, f2old, cx, cy]);\r\n            }\r\n            df = f2 - f1;\r\n            var c1 = math.cos(f1),\r\n                s1 = math.sin(f1),\r\n                c2 = math.cos(f2),\r\n                s2 = math.sin(f2),\r\n                t = math.tan(df / 4),\r\n                hx = 4 / 3 * rx * t,\r\n                hy = 4 / 3 * ry * t,\r\n                m1 = [x1, y1],\r\n                m2 = [x1 + hx * s1, y1 - hy * c1],\r\n                m3 = [x2 + hx * s2, y2 - hy * c2],\r\n                m4 = [x2, y2];\r\n            m2[0] = 2 * m1[0] - m2[0];\r\n            m2[1] = 2 * m1[1] - m2[1];\r\n            if (recursive) {\r\n                return [m2, m3, m4][concat](res);\r\n            } else {\r\n                res = [m2, m3, m4][concat](res).join()[split](",");\r\n                var newres = [];\r\n                for (var i = 0, ii = res.length; i < ii; i++) {\r\n                    newres[i] = i % 2 ? rotate(res[i - 1], res[i], rad).y : rotate(res[i], res[i + 1], rad).x;\r\n                }\r\n                return newres;\r\n            }\r\n        },\r\n        findDotAtSegment = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {\r\n            var t1 = 1 - t;\r\n            return {\r\n                x: pow(t1, 3) * p1x + pow(t1, 2) * 3 * t * c1x + t1 * 3 * t * t * c2x + pow(t, 3) * p2x,\r\n                y: pow(t1, 3) * p1y + pow(t1, 2) * 3 * t * c1y + t1 * 3 * t * t * c2y + pow(t, 3) * p2y\r\n            };\r\n        },\r\n        curveDim = cacher(function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y) {\r\n            var a = (c2x - 2 * c1x + p1x) - (p2x - 2 * c2x + c1x),\r\n                b = 2 * (c1x - p1x) - 2 * (c2x - c1x),\r\n                c = p1x - c1x,\r\n                t1 = (-b + math.sqrt(b * b - 4 * a * c)) / 2 / a,\r\n                t2 = (-b - math.sqrt(b * b - 4 * a * c)) / 2 / a,\r\n                y = [p1y, p2y],\r\n                x = [p1x, p2x],\r\n                dot;\r\n            abs(t1) > "1e12" && (t1 = .5);\r\n            abs(t2) > "1e12" && (t2 = .5);\r\n            if (t1 > 0 && t1 < 1) {\r\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t1);\r\n                x.push(dot.x);\r\n                y.push(dot.y);\r\n            }\r\n            if (t2 > 0 && t2 < 1) {\r\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t2);\r\n                x.push(dot.x);\r\n                y.push(dot.y);\r\n            }\r\n            a = (c2y - 2 * c1y + p1y) - (p2y - 2 * c2y + c1y);\r\n            b = 2 * (c1y - p1y) - 2 * (c2y - c1y);\r\n            c = p1y - c1y;\r\n            t1 = (-b + math.sqrt(b * b - 4 * a * c)) / 2 / a;\r\n            t2 = (-b - math.sqrt(b * b - 4 * a * c)) / 2 / a;\r\n            abs(t1) > "1e12" && (t1 = .5);\r\n            abs(t2) > "1e12" && (t2 = .5);\r\n            if (t1 > 0 && t1 < 1) {\r\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t1);\r\n                x.push(dot.x);\r\n                y.push(dot.y);\r\n            }\r\n            if (t2 > 0 && t2 < 1) {\r\n                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t2);\r\n                x.push(dot.x);\r\n                y.push(dot.y);\r\n            }\r\n            return {\r\n                min: {x: mmin[apply](0, x), y: mmin[apply](0, y)},\r\n                max: {x: mmax[apply](0, x), y: mmax[apply](0, y)}\r\n            };\r\n        }),\r\n        path2curve = R._path2curve = cacher(function (path, path2) {\r\n            var pth = !path2 && paths(path);\r\n            if (!path2 && pth.curve) {\r\n                return pathClone(pth.curve);\r\n            }\r\n            var p = pathToAbsolute(path),\r\n                p2 = path2 && pathToAbsolute(path2),\r\n                attrs = {x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null},\r\n                attrs2 = {x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null},\r\n                processPath = function (path, d, pcom) {\r\n                    var nx, ny, tq = {T:1, Q:1};\r\n                    if (!path) {\r\n                        return ["C", d.x, d.y, d.x, d.y, d.x, d.y];\r\n                    }\r\n                    !(path[0] in tq) && (d.qx = d.qy = null);\r\n                    switch (path[0]) {\r\n                        case "M":\r\n                            d.X = path[1];\r\n                            d.Y = path[2];\r\n                            break;\r\n                        case "A":\r\n                            path = ["C"][concat](a2c[apply](0, [d.x, d.y][concat](path.slice(1))));\r\n                            break;\r\n                        case "S":\r\n                            if (pcom == "C" || pcom == "S") { // In "S" case we have to take into account, if the previous command is C/S.\r\n                                nx = d.x * 2 - d.bx;          // And reflect the previous\r\n                                ny = d.y * 2 - d.by;          // command\'s control point relative to the current point.\r\n                            }\r\n                            else {                            // or some else or nothing\r\n                                nx = d.x;\r\n                                ny = d.y;\r\n                            }\r\n                            path = ["C", nx, ny][concat](path.slice(1));\r\n                            break;\r\n                        case "T":\r\n                            if (pcom == "Q" || pcom == "T") { // In "T" case we have to take into account, if the previous command is Q/T.\r\n                                d.qx = d.x * 2 - d.qx;        // And make a reflection similar\r\n                                d.qy = d.y * 2 - d.qy;        // to case "S".\r\n                            }\r\n                            else {                            // or something else or nothing\r\n                                d.qx = d.x;\r\n                                d.qy = d.y;\r\n                            }\r\n                            path = ["C"][concat](q2c(d.x, d.y, d.qx, d.qy, path[1], path[2]));\r\n                            break;\r\n                        case "Q":\r\n                            d.qx = path[1];\r\n                            d.qy = path[2];\r\n                            path = ["C"][concat](q2c(d.x, d.y, path[1], path[2], path[3], path[4]));\r\n                            break;\r\n                        case "L":\r\n                            path = ["C"][concat](l2c(d.x, d.y, path[1], path[2]));\r\n                            break;\r\n                        case "H":\r\n                            path = ["C"][concat](l2c(d.x, d.y, path[1], d.y));\r\n                            break;\r\n                        case "V":\r\n                            path = ["C"][concat](l2c(d.x, d.y, d.x, path[1]));\r\n                            break;\r\n                        case "Z":\r\n                            path = ["C"][concat](l2c(d.x, d.y, d.X, d.Y));\r\n                            break;\r\n                    }\r\n                    return path;\r\n                },\r\n                fixArc = function (pp, i) {\r\n                    if (pp[i].length > 7) {\r\n                        pp[i].shift();\r\n                        var pi = pp[i];\r\n                        while (pi.length) {\r\n                            pcoms1[i]="A"; // if created multiple C:s, their original seg is saved\r\n                            p2 && (pcoms2[i]="A"); // the same as above\r\n                            pp.splice(i++, 0, ["C"][concat](pi.splice(0, 6)));\r\n                        }\r\n                        pp.splice(i, 1);\r\n                        ii = mmax(p.length, p2 && p2.length || 0);\r\n                    }\r\n                },\r\n                fixM = function (path1, path2, a1, a2, i) {\r\n                    if (path1 && path2 && path1[i][0] == "M" && path2[i][0] != "M") {\r\n                        path2.splice(i, 0, ["M", a2.x, a2.y]);\r\n                        a1.bx = 0;\r\n                        a1.by = 0;\r\n                        a1.x = path1[i][1];\r\n                        a1.y = path1[i][2];\r\n                        ii = mmax(p.length, p2 && p2.length || 0);\r\n                    }\r\n                },\r\n                pcoms1 = [], // path commands of original path p\r\n                pcoms2 = [], // path commands of original path p2\r\n                pfirst = "", // temporary holder for original path command\r\n                pcom = ""; // holder for previous path command of original path\r\n            for (var i = 0, ii = mmax(p.length, p2 && p2.length || 0); i < ii; i++) {\r\n                p[i] && (pfirst = p[i][0]); // save current path command\r\n\r\n                if (pfirst != "C") // C is not saved yet, because it may be result of conversion\r\n                {\r\n                    pcoms1[i] = pfirst; // Save current path command\r\n                    i && ( pcom = pcoms1[i-1]); // Get previous path command pcom\r\n                }\r\n                p[i] = processPath(p[i], attrs, pcom); // Previous path command is inputted to processPath\r\n\r\n                if (pcoms1[i] != "A" && pfirst == "C") pcoms1[i] = "C"; // A is the only command\r\n                // which may produce multiple C:s\r\n                // so we have to make sure that C is also C in original path\r\n\r\n                fixArc(p, i); // fixArc adds also the right amount of A:s to pcoms1\r\n\r\n                if (p2) { // the same procedures is done to p2\r\n                    p2[i] && (pfirst = p2[i][0]);\r\n                    if (pfirst != "C")\r\n                    {\r\n                        pcoms2[i] = pfirst;\r\n                        i && (pcom = pcoms2[i-1]);\r\n                    }\r\n                    p2[i] = processPath(p2[i], attrs2, pcom);\r\n\r\n                    if (pcoms2[i]!="A" && pfirst=="C") pcoms2[i]="C";\r\n\r\n                    fixArc(p2, i);\r\n                }\r\n                fixM(p, p2, attrs, attrs2, i);\r\n                fixM(p2, p, attrs2, attrs, i);\r\n                var seg = p[i],\r\n                    seg2 = p2 && p2[i],\r\n                    seglen = seg.length,\r\n                    seg2len = p2 && seg2.length;\r\n                attrs.x = seg[seglen - 2];\r\n                attrs.y = seg[seglen - 1];\r\n                attrs.bx = toFloat(seg[seglen - 4]) || attrs.x;\r\n                attrs.by = toFloat(seg[seglen - 3]) || attrs.y;\r\n                attrs2.bx = p2 && (toFloat(seg2[seg2len - 4]) || attrs2.x);\r\n                attrs2.by = p2 && (toFloat(seg2[seg2len - 3]) || attrs2.y);\r\n                attrs2.x = p2 && seg2[seg2len - 2];\r\n                attrs2.y = p2 && seg2[seg2len - 1];\r\n            }\r\n            if (!p2) {\r\n                pth.curve = pathClone(p);\r\n            }\r\n            return p2 ? [p, p2] : p;\r\n        }, null, pathClone),\r\n        parseDots = R._parseDots = cacher(function (gradient) {\r\n            var dots = [];\r\n            for (var i = 0, ii = gradient.length; i < ii; i++) {\r\n                var dot = {},\r\n                    par = gradient[i].match(/^([^:]*):?([\\d\\.]*)/);\r\n                dot.color = R.getRGB(par[1]);\r\n                if (dot.color.error) {\r\n                    return null;\r\n                }\r\n                dot.opacity = dot.color.opacity;\r\n                dot.color = dot.color.hex;\r\n                par[2] && (dot.offset = par[2] + "%");\r\n                dots.push(dot);\r\n            }\r\n            for (i = 1, ii = dots.length - 1; i < ii; i++) {\r\n                if (!dots[i].offset) {\r\n                    var start = toFloat(dots[i - 1].offset || 0),\r\n                        end = 0;\r\n                    for (var j = i + 1; j < ii; j++) {\r\n                        if (dots[j].offset) {\r\n                            end = dots[j].offset;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (!end) {\r\n                        end = 100;\r\n                        j = ii;\r\n                    }\r\n                    end = toFloat(end);\r\n                    var d = (end - start) / (j - i + 1);\r\n                    for (; i < j; i++) {\r\n                        start += d;\r\n                        dots[i].offset = start + "%";\r\n                    }\r\n                }\r\n            }\r\n            return dots;\r\n        }),\r\n        tear = R._tear = function (el, paper) {\r\n            el == paper.top && (paper.top = el.prev);\r\n            el == paper.bottom && (paper.bottom = el.next);\r\n            el.next && (el.next.prev = el.prev);\r\n            el.prev && (el.prev.next = el.next);\r\n        },\r\n        tofront = R._tofront = function (el, paper) {\r\n            if (paper.top === el) {\r\n                return;\r\n            }\r\n            tear(el, paper);\r\n            el.next = null;\r\n            el.prev = paper.top;\r\n            paper.top.next = el;\r\n            paper.top = el;\r\n        },\r\n        toback = R._toback = function (el, paper) {\r\n            if (paper.bottom === el) {\r\n                return;\r\n            }\r\n            tear(el, paper);\r\n            el.next = paper.bottom;\r\n            el.prev = null;\r\n            paper.bottom.prev = el;\r\n            paper.bottom = el;\r\n        },\r\n        insertafter = R._insertafter = function (el, el2, paper) {\r\n            tear(el, paper);\r\n            el2 == paper.top && (paper.top = el);\r\n            el2.next && (el2.next.prev = el);\r\n            el.next = el2.next;\r\n            el.prev = el2;\r\n            el2.next = el;\r\n        },\r\n        insertbefore = R._insertbefore = function (el, el2, paper) {\r\n            tear(el, paper);\r\n            el2 == paper.bottom && (paper.bottom = el);\r\n            el2.prev && (el2.prev.next = el);\r\n            el.prev = el2.prev;\r\n            el2.prev = el;\r\n            el.next = el2;\r\n        },\r\n    /*\\\r\n     * Raphael.toMatrix\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Returns matrix of transformations applied to a given path\r\n     > Parameters\r\n     - path (string) path string\r\n     - transform (string|array) transformation string\r\n     = (object) @Matrix\r\n     \\*/\r\n        toMatrix = R.toMatrix = function (path, transform) {\r\n            var bb = pathDimensions(path),\r\n                el = {\r\n                    _: {\r\n                        transform: E\r\n                    },\r\n                    getBBox: function () {\r\n                        return bb;\r\n                    }\r\n                };\r\n            extractTransform(el, transform);\r\n            return el.matrix;\r\n        },\r\n    /*\\\r\n     * Raphael.transformPath\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Returns path transformed by a given transformation\r\n     > Parameters\r\n     - path (string) path string\r\n     - transform (string|array) transformation string\r\n     = (string) path\r\n     \\*/\r\n        transformPath = R.transformPath = function (path, transform) {\r\n            return mapPath(path, toMatrix(path, transform));\r\n        },\r\n        extractTransform = R._extractTransform = function (el, tstr) {\r\n            if (tstr == null) {\r\n                return el._.transform;\r\n            }\r\n            tstr = Str(tstr).replace(/\\.{3}|\\u2026/g, el._.transform || E);\r\n            var tdata = R.parseTransformString(tstr),\r\n                deg = 0,\r\n                dx = 0,\r\n                dy = 0,\r\n                sx = 1,\r\n                sy = 1,\r\n                _ = el._,\r\n                m = new Matrix;\r\n            _.transform = tdata || [];\r\n            if (tdata) {\r\n                for (var i = 0, ii = tdata.length; i < ii; i++) {\r\n                    var t = tdata[i],\r\n                        tlen = t.length,\r\n                        command = Str(t[0]).toLowerCase(),\r\n                        absolute = t[0] != command,\r\n                        inver = absolute ? m.invert() : 0,\r\n                        x1,\r\n                        y1,\r\n                        x2,\r\n                        y2,\r\n                        bb;\r\n                    if (command == "t" && tlen == 3) {\r\n                        if (absolute) {\r\n                            x1 = inver.x(0, 0);\r\n                            y1 = inver.y(0, 0);\r\n                            x2 = inver.x(t[1], t[2]);\r\n                            y2 = inver.y(t[1], t[2]);\r\n                            m.translate(x2 - x1, y2 - y1);\r\n                        } else {\r\n                            m.translate(t[1], t[2]);\r\n                        }\r\n                    } else if (command == "r") {\r\n                        if (tlen == 2) {\r\n                            bb = bb || el.getBBox(1);\r\n                            m.rotate(t[1], bb.x + bb.width / 2, bb.y + bb.height / 2);\r\n                            deg += t[1];\r\n                        } else if (tlen == 4) {\r\n                            if (absolute) {\r\n                                x2 = inver.x(t[2], t[3]);\r\n                                y2 = inver.y(t[2], t[3]);\r\n                                m.rotate(t[1], x2, y2);\r\n                            } else {\r\n                                m.rotate(t[1], t[2], t[3]);\r\n                            }\r\n                            deg += t[1];\r\n                        }\r\n                    } else if (command == "s") {\r\n                        if (tlen == 2 || tlen == 3) {\r\n                            bb = bb || el.getBBox(1);\r\n                            m.scale(t[1], t[tlen - 1], bb.x + bb.width / 2, bb.y + bb.height / 2);\r\n                            sx *= t[1];\r\n                            sy *= t[tlen - 1];\r\n                        } else if (tlen == 5) {\r\n                            if (absolute) {\r\n                                x2 = inver.x(t[3], t[4]);\r\n                                y2 = inver.y(t[3], t[4]);\r\n                                m.scale(t[1], t[2], x2, y2);\r\n                            } else {\r\n                                m.scale(t[1], t[2], t[3], t[4]);\r\n                            }\r\n                            sx *= t[1];\r\n                            sy *= t[2];\r\n                        }\r\n                    } else if (command == "m" && tlen == 7) {\r\n                        m.add(t[1], t[2], t[3], t[4], t[5], t[6]);\r\n                    }\r\n                    _.dirtyT = 1;\r\n                    el.matrix = m;\r\n                }\r\n            }\r\n\r\n            /*\\\r\n             * Element.matrix\r\n             [ property (object) ]\r\n             **\r\n             * Keeps @Matrix object, which represents element transformation\r\n             \\*/\r\n            el.matrix = m;\r\n\r\n            _.sx = sx;\r\n            _.sy = sy;\r\n            _.deg = deg;\r\n            _.dx = dx = m.e;\r\n            _.dy = dy = m.f;\r\n\r\n            if (sx == 1 && sy == 1 && !deg && _.bbox) {\r\n                _.bbox.x += +dx;\r\n                _.bbox.y += +dy;\r\n            } else {\r\n                _.dirtyT = 1;\r\n            }\r\n        },\r\n        getEmpty = function (item) {\r\n            var l = item[0];\r\n            switch (l.toLowerCase()) {\r\n                case "t": return [l, 0, 0];\r\n                case "m": return [l, 1, 0, 0, 1, 0, 0];\r\n                case "r": if (item.length == 4) {\r\n                    return [l, 0, item[2], item[3]];\r\n                } else {\r\n                    return [l, 0];\r\n                }\r\n                case "s": if (item.length == 5) {\r\n                    return [l, 1, 1, item[3], item[4]];\r\n                } else if (item.length == 3) {\r\n                    return [l, 1, 1];\r\n                } else {\r\n                    return [l, 1];\r\n                }\r\n            }\r\n        },\r\n        equaliseTransform = R._equaliseTransform = function (t1, t2) {\r\n            t2 = Str(t2).replace(/\\.{3}|\\u2026/g, t1);\r\n            t1 = R.parseTransformString(t1) || [];\r\n            t2 = R.parseTransformString(t2) || [];\r\n            var maxlength = mmax(t1.length, t2.length),\r\n                from = [],\r\n                to = [],\r\n                i = 0, j, jj,\r\n                tt1, tt2;\r\n            for (; i < maxlength; i++) {\r\n                tt1 = t1[i] || getEmpty(t2[i]);\r\n                tt2 = t2[i] || getEmpty(tt1);\r\n                if ((tt1[0] != tt2[0]) ||\r\n                    (tt1[0].toLowerCase() == "r" && (tt1[2] != tt2[2] || tt1[3] != tt2[3])) ||\r\n                    (tt1[0].toLowerCase() == "s" && (tt1[3] != tt2[3] || tt1[4] != tt2[4]))\r\n                ) {\r\n                    return;\r\n                }\r\n                from[i] = [];\r\n                to[i] = [];\r\n                for (j = 0, jj = mmax(tt1.length, tt2.length); j < jj; j++) {\r\n                    j in tt1 && (from[i][j] = tt1[j]);\r\n                    j in tt2 && (to[i][j] = tt2[j]);\r\n                }\r\n            }\r\n            return {\r\n                from: from,\r\n                to: to\r\n            };\r\n        };\r\n    R._getContainer = function (x, y, w, h) {\r\n        var container;\r\n        container = h == null && !R.is(x, "object") ? g.doc.getElementById(x) : x;\r\n        if (container == null) {\r\n            return;\r\n        }\r\n        if (container.tagName) {\r\n            if (y == null) {\r\n                return {\r\n                    container: container,\r\n                    width: container.style.pixelWidth || container.offsetWidth,\r\n                    height: container.style.pixelHeight || container.offsetHeight\r\n                };\r\n            } else {\r\n                return {\r\n                    container: container,\r\n                    width: y,\r\n                    height: w\r\n                };\r\n            }\r\n        }\r\n        return {\r\n            container: 1,\r\n            x: x,\r\n            y: y,\r\n            width: w,\r\n            height: h\r\n        };\r\n    };\r\n    /*\\\r\n     * Raphael.pathToRelative\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Converts path to relative form\r\n     > Parameters\r\n     - pathString (string|array) path string or array of segments\r\n     = (array) array of segments.\r\n     \\*/\r\n    R.pathToRelative = pathToRelative;\r\n    R._engine = {};\r\n    /*\\\r\n     * Raphael.path2curve\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Converts path to a new path where all segments are cubic bezier curves.\r\n     > Parameters\r\n     - pathString (string|array) path string or array of segments\r\n     = (array) array of segments.\r\n     \\*/\r\n    R.path2curve = path2curve;\r\n    /*\\\r\n     * Raphael.matrix\r\n     [ method ]\r\n     **\r\n     * Utility method\r\n     **\r\n     * Returns matrix based on given parameters.\r\n     > Parameters\r\n     - a (number)\r\n     - b (number)\r\n     - c (number)\r\n     - d (number)\r\n     - e (number)\r\n     - f (number)\r\n     = (object) @Matrix\r\n     \\*/\r\n    R.matrix = function (a, b, c, d, e, f) {\r\n        return new Matrix(a, b, c, d, e, f);\r\n    };\r\n    function Matrix(a, b, c, d, e, f) {\r\n        if (a != null) {\r\n            this.a = +a;\r\n            this.b = +b;\r\n            this.c = +c;\r\n            this.d = +d;\r\n            this.e = +e;\r\n            this.f = +f;\r\n        } else {\r\n            this.a = 1;\r\n            this.b = 0;\r\n            this.c = 0;\r\n            this.d = 1;\r\n            this.e = 0;\r\n            this.f = 0;\r\n        }\r\n    }\r\n    (function (matrixproto) {\r\n        /*\\\r\n         * Matrix.add\r\n         [ method ]\r\n         **\r\n         * Adds given matrix to existing one.\r\n         > Parameters\r\n         - a (number)\r\n         - b (number)\r\n         - c (number)\r\n         - d (number)\r\n         - e (number)\r\n         - f (number)\r\n         or\r\n         - matrix (object) @Matrix\r\n         \\*/\r\n        matrixproto.add = function (a, b, c, d, e, f) {\r\n            var out = [[], [], []],\r\n                m = [[this.a, this.c, this.e], [this.b, this.d, this.f], [0, 0, 1]],\r\n                matrix = [[a, c, e], [b, d, f], [0, 0, 1]],\r\n                x, y, z, res;\r\n\r\n            if (a && a instanceof Matrix) {\r\n                matrix = [[a.a, a.c, a.e], [a.b, a.d, a.f], [0, 0, 1]];\r\n            }\r\n\r\n            for (x = 0; x < 3; x++) {\r\n                for (y = 0; y < 3; y++) {\r\n                    res = 0;\r\n                    for (z = 0; z < 3; z++) {\r\n                        res += m[x][z] * matrix[z][y];\r\n                    }\r\n                    out[x][y] = res;\r\n                }\r\n            }\r\n            this.a = out[0][0];\r\n            this.b = out[1][0];\r\n            this.c = out[0][1];\r\n            this.d = out[1][1];\r\n            this.e = out[0][2];\r\n            this.f = out[1][2];\r\n        };\r\n        /*\\\r\n         * Matrix.invert\r\n         [ method ]\r\n         **\r\n         * Returns inverted version of the matrix\r\n         = (object) @Matrix\r\n         \\*/\r\n        matrixproto.invert = function () {\r\n            var me = this,\r\n                x = me.a * me.d - me.b * me.c;\r\n            return new Matrix(me.d / x, -me.b / x, -me.c / x, me.a / x, (me.c * me.f - me.d * me.e) / x, (me.b * me.e - me.a * me.f) / x);\r\n        };\r\n        /*\\\r\n         * Matrix.clone\r\n         [ method ]\r\n         **\r\n         * Returns copy of the matrix\r\n         = (object) @Matrix\r\n         \\*/\r\n        matrixproto.clone = function () {\r\n            return new Matrix(this.a, this.b, this.c, this.d, this.e, this.f);\r\n        };\r\n        /*\\\r\n         * Matrix.translate\r\n         [ method ]\r\n         **\r\n         * Translate the matrix\r\n         > Parameters\r\n         - x (number)\r\n         - y (number)\r\n         \\*/\r\n        matrixproto.translate = function (x, y) {\r\n            this.add(1, 0, 0, 1, x, y);\r\n        };\r\n        /*\\\r\n         * Matrix.scale\r\n         [ method ]\r\n         **\r\n         * Scales the matrix\r\n         > Parameters\r\n         - x (number)\r\n         - y (number) #optional\r\n         - cx (number) #optional\r\n         - cy (number) #optional\r\n         \\*/\r\n        matrixproto.scale = function (x, y, cx, cy) {\r\n            y == null && (y = x);\r\n            (cx || cy) && this.add(1, 0, 0, 1, cx, cy);\r\n            this.add(x, 0, 0, y, 0, 0);\r\n            (cx || cy) && this.add(1, 0, 0, 1, -cx, -cy);\r\n        };\r\n        /*\\\r\n         * Matrix.rotate\r\n         [ method ]\r\n         **\r\n         * Rotates the matrix\r\n         > Parameters\r\n         - a (number)\r\n         - x (number)\r\n         - y (number)\r\n         \\*/\r\n        matrixproto.rotate = function (a, x, y) {\r\n            a = R.rad(a);\r\n            x = x || 0;\r\n            y = y || 0;\r\n            var cos = +math.cos(a).toFixed(9),\r\n                sin = +math.sin(a).toFixed(9);\r\n            this.add(cos, sin, -sin, cos, x, y);\r\n            this.add(1, 0, 0, 1, -x, -y);\r\n        };\r\n        /*\\\r\n         * Matrix.x\r\n         [ method ]\r\n         **\r\n         * Return x coordinate for given point after transformation described by the matrix. See also @Matrix.y\r\n         > Parameters\r\n         - x (number)\r\n         - y (number)\r\n         = (number) x\r\n         \\*/\r\n        matrixproto.x = function (x, y) {\r\n            return x * this.a + y * this.c + this.e;\r\n        };\r\n        /*\\\r\n         * Matrix.y\r\n         [ method ]\r\n         **\r\n         * Return y coordinate for given point after transformation described by the matrix. See also @Matrix.x\r\n         > Parameters\r\n         - x (number)\r\n         - y (number)\r\n         = (number) y\r\n         \\*/\r\n        matrixproto.y = function (x, y) {\r\n            return x * this.b + y * this.d + this.f;\r\n        };\r\n        matrixproto.get = function (i) {\r\n            return +this[Str.fromCharCode(97 + i)].toFixed(4);\r\n        };\r\n        matrixproto.toString = function () {\r\n            return R.svg ?\r\n            "matrix(" + [this.get(0), this.get(1), this.get(2), this.get(3), this.get(4), this.get(5)].join() + ")" :\r\n                [this.get(0), this.get(2), this.get(1), this.get(3), 0, 0].join();\r\n        };\r\n        matrixproto.toFilter = function () {\r\n            return "progid:DXImageTransform.Microsoft.Matrix(M11=" + this.get(0) +\r\n                ", M12=" + this.get(2) + ", M21=" + this.get(1) + ", M22=" + this.get(3) +\r\n                ", Dx=" + this.get(4) + ", Dy=" + this.get(5) + ", sizingmethod=\'auto expand\')";\r\n        };\r\n        matrixproto.offset = function () {\r\n            return [this.e.toFixed(4), this.f.toFixed(4)];\r\n        };\r\n        function norm(a) {\r\n            return a[0] * a[0] + a[1] * a[1];\r\n        }\r\n        function normalize(a) {\r\n            var mag = math.sqrt(norm(a));\r\n            a[0] && (a[0] /= mag);\r\n            a[1] && (a[1] /= mag);\r\n        }\r\n        /*\\\r\n         * Matrix.split\r\n         [ method ]\r\n         **\r\n         * Splits matrix into primitive transformations\r\n         = (object) in format:\r\n         o dx (number) translation by x\r\n         o dy (number) translation by y\r\n         o scalex (number) scale by x\r\n         o scaley (number) scale by y\r\n         o shear (number) shear\r\n         o rotate (number) rotation in deg\r\n         o isSimple (boolean) could it be represented via simple transformations\r\n         \\*/\r\n        matrixproto.split = function () {\r\n            var out = {};\r\n            // translation\r\n            out.dx = this.e;\r\n            out.dy = this.f;\r\n\r\n            // scale and shear\r\n            var row = [[this.a, this.c], [this.b, this.d]];\r\n            out.scalex = math.sqrt(norm(row[0]));\r\n            normalize(row[0]);\r\n\r\n            out.shear = row[0][0] * row[1][0] + row[0][1] * row[1][1];\r\n            row[1] = [row[1][0] - row[0][0] * out.shear, row[1][1] - row[0][1] * out.shear];\r\n\r\n            out.scaley = math.sqrt(norm(row[1]));\r\n            normalize(row[1]);\r\n            out.shear /= out.scaley;\r\n\r\n            // rotation\r\n            var sin = -row[0][1],\r\n                cos = row[1][1];\r\n            if (cos < 0) {\r\n                out.rotate = R.deg(math.acos(cos));\r\n                if (sin < 0) {\r\n                    out.rotate = 360 - out.rotate;\r\n                }\r\n            } else {\r\n                out.rotate = R.deg(math.asin(sin));\r\n            }\r\n\r\n            out.isSimple = !+out.shear.toFixed(9) && (out.scalex.toFixed(9) == out.scaley.toFixed(9) || !out.rotate);\r\n            out.isSuperSimple = !+out.shear.toFixed(9) && out.scalex.toFixed(9) == out.scaley.toFixed(9) && !out.rotate;\r\n            out.noRotation = !+out.shear.toFixed(9) && !out.rotate;\r\n            return out;\r\n        };\r\n        /*\\\r\n         * Matrix.toTransformString\r\n         [ method ]\r\n         **\r\n         * Return transform string that represents given matrix\r\n         = (string) transform string\r\n         \\*/\r\n        matrixproto.toTransformString = function (shorter) {\r\n            var s = shorter || this[split]();\r\n            if (s.isSimple) {\r\n                s.scalex = +s.scalex.toFixed(4);\r\n                s.scaley = +s.scaley.toFixed(4);\r\n                s.rotate = +s.rotate.toFixed(4);\r\n                return  (s.dx || s.dy ? "t" + [s.dx, s.dy] : E) +\r\n                    (s.scalex != 1 || s.scaley != 1 ? "s" + [s.scalex, s.scaley, 0, 0] : E) +\r\n                    (s.rotate ? "r" + [s.rotate, 0, 0] : E);\r\n            } else {\r\n                return "m" + [this.get(0), this.get(1), this.get(2), this.get(3), this.get(4), this.get(5)];\r\n            }\r\n        };\r\n    })(Matrix.prototype);\r\n\r\n    var preventDefault = function () {\r\n            this.returnValue = false;\r\n        },\r\n        preventTouch = function () {\r\n            return this.originalEvent.preventDefault();\r\n        },\r\n        stopPropagation = function () {\r\n            this.cancelBubble = true;\r\n        },\r\n        stopTouch = function () {\r\n            return this.originalEvent.stopPropagation();\r\n        },\r\n        getEventPosition = function (e) {\r\n            var scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,\r\n                scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft;\r\n\r\n            return {\r\n                x: e.clientX + scrollX,\r\n                y: e.clientY + scrollY\r\n            };\r\n        },\r\n        addEvent = (function () {\r\n            if (g.doc.addEventListener) {\r\n                return function (obj, type, fn, element) {\r\n                    var f = function (e) {\r\n                        var pos = getEventPosition(e);\r\n                        return fn.call(element, e, pos.x, pos.y);\r\n                    };\r\n                    obj.addEventListener(type, f, false);\r\n\r\n                    if (supportsTouch && touchMap[type]) {\r\n                        var _f = function (e) {\r\n                            var pos = getEventPosition(e),\r\n                                olde = e;\r\n\r\n                            for (var i = 0, ii = e.targetTouches && e.targetTouches.length; i < ii; i++) {\r\n                                if (e.targetTouches[i].target == obj) {\r\n                                    e = e.targetTouches[i];\r\n                                    e.originalEvent = olde;\r\n                                    e.preventDefault = preventTouch;\r\n                                    e.stopPropagation = stopTouch;\r\n                                    break;\r\n                                }\r\n                            }\r\n\r\n                            return fn.call(element, e, pos.x, pos.y);\r\n                        };\r\n                        obj.addEventListener(touchMap[type], _f, false);\r\n                    }\r\n\r\n                    return function () {\r\n                        obj.removeEventListener(type, f, false);\r\n\r\n                        if (supportsTouch && touchMap[type])\r\n                            obj.removeEventListener(touchMap[type], _f, false);\r\n\r\n                        return true;\r\n                    };\r\n                };\r\n            } else if (g.doc.attachEvent) {\r\n                return function (obj, type, fn, element) {\r\n                    var f = function (e) {\r\n                        e = e || g.win.event;\r\n                        var scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,\r\n                            scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft,\r\n                            x = e.clientX + scrollX,\r\n                            y = e.clientY + scrollY;\r\n                        e.preventDefault = e.preventDefault || preventDefault;\r\n                        e.stopPropagation = e.stopPropagation || stopPropagation;\r\n                        return fn.call(element, e, x, y);\r\n                    };\r\n                    obj.attachEvent("on" + type, f);\r\n                    var detacher = function () {\r\n                        obj.detachEvent("on" + type, f);\r\n                        return true;\r\n                    };\r\n                    return detacher;\r\n                };\r\n            }\r\n        })(),\r\n        drag = [],\r\n        dragMove = function (e) {\r\n            var x = e.clientX,\r\n                y = e.clientY,\r\n                scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,\r\n                scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft,\r\n                dragi,\r\n                j = drag.length;\r\n            while (j--) {\r\n                dragi = drag[j];\r\n                if (supportsTouch && e.touches) {\r\n                    var i = e.touches.length,\r\n                        touch;\r\n                    while (i--) {\r\n                        touch = e.touches[i];\r\n                        if (touch.identifier == dragi.el._drag.id) {\r\n                            x = touch.clientX;\r\n                            y = touch.clientY;\r\n                            (e.originalEvent ? e.originalEvent : e).preventDefault();\r\n                            break;\r\n                        }\r\n                    }\r\n                } else {\r\n                    e.preventDefault();\r\n                }\r\n                var node = dragi.el.node,\r\n                    o,\r\n                    next = node.nextSibling,\r\n                    parent = node.parentNode,\r\n                    display = node.style.display;\r\n                g.win.opera && parent.removeChild(node);\r\n                node.style.display = "none";\r\n                o = dragi.el.paper.getElementByPoint(x, y);\r\n                node.style.display = display;\r\n                g.win.opera && (next ? parent.insertBefore(node, next) : parent.appendChild(node));\r\n                o && eve("raphael.drag.over." + dragi.el.id, dragi.el, o);\r\n                x += scrollX;\r\n                y += scrollY;\r\n                eve("raphael.drag.move." + dragi.el.id, dragi.move_scope || dragi.el, x - dragi.el._drag.x, y - dragi.el._drag.y, x, y, e);\r\n            }\r\n        },\r\n        dragUp = function (e) {\r\n            R.unmousemove(dragMove).unmouseup(dragUp);\r\n            var i = drag.length,\r\n                dragi;\r\n            while (i--) {\r\n                dragi = drag[i];\r\n                dragi.el._drag = {};\r\n                eve("raphael.drag.end." + dragi.el.id, dragi.end_scope || dragi.start_scope || dragi.move_scope || dragi.el, e);\r\n            }\r\n            drag = [];\r\n        },\r\n    /*\\\r\n     * Raphael.el\r\n     [ property (object) ]\r\n     **\r\n     * You can add your own method to elements. This is usefull when you want to hack default functionality or\r\n     * want to wrap some common transformation or attributes in one method. In difference to canvas methods,\r\n     * you can redefine element method at any time. Expending element methods wouldn’t affect set.\r\n     > Usage\r\n     | Raphael.el.red = function () {\r\n     |     this.attr({fill: "#f00"});\r\n     | };\r\n     | // then use it\r\n     | paper.circle(100, 100, 20).red();\r\n     \\*/\r\n        elproto = R.el = {};\r\n    /*\\\r\n     * Element.click\r\n     [ method ]\r\n     **\r\n     * Adds event handler for click for the element.\r\n     > Parameters\r\n     - handler (function) handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    /*\\\r\n     * Element.unclick\r\n     [ method ]\r\n     **\r\n     * Removes event handler for click for the element.\r\n     > Parameters\r\n     - handler (function) #optional handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n\r\n    /*\\\r\n     * Element.dblclick\r\n     [ method ]\r\n     **\r\n     * Adds event handler for double click for the element.\r\n     > Parameters\r\n     - handler (function) handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    /*\\\r\n     * Element.undblclick\r\n     [ method ]\r\n     **\r\n     * Removes event handler for double click for the element.\r\n     > Parameters\r\n     - handler (function) #optional handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n\r\n    /*\\\r\n     * Element.mousedown\r\n     [ method ]\r\n     **\r\n     * Adds event handler for mousedown for the element.\r\n     > Parameters\r\n     - handler (function) handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    /*\\\r\n     * Element.unmousedown\r\n     [ method ]\r\n     **\r\n     * Removes event handler for mousedown for the element.\r\n     > Parameters\r\n     - handler (function) #optional handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n\r\n    /*\\\r\n     * Element.mousemove\r\n     [ method ]\r\n     **\r\n     * Adds event handler for mousemove for the element.\r\n     > Parameters\r\n     - handler (function) handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    /*\\\r\n     * Element.unmousemove\r\n     [ method ]\r\n     **\r\n     * Removes event handler for mousemove for the element.\r\n     > Parameters\r\n     - handler (function) #optional handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n\r\n    /*\\\r\n     * Element.mouseout\r\n     [ method ]\r\n     **\r\n     * Adds event handler for mouseout for the element.\r\n     > Parameters\r\n     - handler (function) handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    /*\\\r\n     * Element.unmouseout\r\n     [ method ]\r\n     **\r\n     * Removes event handler for mouseout for the element.\r\n     > Parameters\r\n     - handler (function) #optional handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n\r\n    /*\\\r\n     * Element.mouseover\r\n     [ method ]\r\n     **\r\n     * Adds event handler for mouseover for the element.\r\n     > Parameters\r\n     - handler (function) handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    /*\\\r\n     * Element.unmouseover\r\n     [ method ]\r\n     **\r\n     * Removes event handler for mouseover for the element.\r\n     > Parameters\r\n     - handler (function) #optional handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n\r\n    /*\\\r\n     * Element.mouseup\r\n     [ method ]\r\n     **\r\n     * Adds event handler for mouseup for the element.\r\n     > Parameters\r\n     - handler (function) handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    /*\\\r\n     * Element.unmouseup\r\n     [ method ]\r\n     **\r\n     * Removes event handler for mouseup for the element.\r\n     > Parameters\r\n     - handler (function) #optional handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n\r\n    /*\\\r\n     * Element.touchstart\r\n     [ method ]\r\n     **\r\n     * Adds event handler for touchstart for the element.\r\n     > Parameters\r\n     - handler (function) handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    /*\\\r\n     * Element.untouchstart\r\n     [ method ]\r\n     **\r\n     * Removes event handler for touchstart for the element.\r\n     > Parameters\r\n     - handler (function) #optional handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n\r\n    /*\\\r\n     * Element.touchmove\r\n     [ method ]\r\n     **\r\n     * Adds event handler for touchmove for the element.\r\n     > Parameters\r\n     - handler (function) handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    /*\\\r\n     * Element.untouchmove\r\n     [ method ]\r\n     **\r\n     * Removes event handler for touchmove for the element.\r\n     > Parameters\r\n     - handler (function) #optional handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n\r\n    /*\\\r\n     * Element.touchend\r\n     [ method ]\r\n     **\r\n     * Adds event handler for touchend for the element.\r\n     > Parameters\r\n     - handler (function) handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    /*\\\r\n     * Element.untouchend\r\n     [ method ]\r\n     **\r\n     * Removes event handler for touchend for the element.\r\n     > Parameters\r\n     - handler (function) #optional handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n\r\n    /*\\\r\n     * Element.touchcancel\r\n     [ method ]\r\n     **\r\n     * Adds event handler for touchcancel for the element.\r\n     > Parameters\r\n     - handler (function) handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    /*\\\r\n     * Element.untouchcancel\r\n     [ method ]\r\n     **\r\n     * Removes event handler for touchcancel for the element.\r\n     > Parameters\r\n     - handler (function) #optional handler for the event\r\n     = (object) @Element\r\n     \\*/\r\n    for (var i = events.length; i--;) {\r\n        (function (eventName) {\r\n            R[eventName] = elproto[eventName] = function (fn, scope) {\r\n                if (R.is(fn, "function")) {\r\n                    this.events = this.events || [];\r\n                    this.events.push({name: eventName, f: fn, unbind: addEvent(this.shape || this.node || g.doc, eventName, fn, scope || this)});\r\n                }\r\n                return this;\r\n            };\r\n            R["un" + eventName] = elproto["un" + eventName] = function (fn) {\r\n                var events = this.events || [],\r\n                    l = events.length;\r\n                while (l--){\r\n                    if (events[l].name == eventName && (R.is(fn, "undefined") || events[l].f == fn)) {\r\n                        events[l].unbind();\r\n                        events.splice(l, 1);\r\n                        !events.length && delete this.events;\r\n                    }\r\n                }\r\n                return this;\r\n            };\r\n        })(events[i]);\r\n    }\r\n\r\n    /*\\\r\n     * Element.data\r\n     [ method ]\r\n     **\r\n     * Adds or retrieves given value asociated with given key.\r\n     **\r\n     * See also @Element.removeData\r\n     > Parameters\r\n     - key (string) key to store data\r\n     - value (any) #optional value to store\r\n     = (object) @Element\r\n     * or, if value is not specified:\r\n     = (any) value\r\n     * or, if key and value are not specified:\r\n     = (object) Key/value pairs for all the data associated with the element.\r\n     > Usage\r\n     | for (var i = 0, i < 5, i++) {\r\n     |     paper.circle(10 + 15 * i, 10, 10)\r\n     |          .attr({fill: "#000"})\r\n     |          .data("i", i)\r\n     |          .click(function () {\r\n     |             alert(this.data("i"));\r\n     |          });\r\n     | }\r\n     \\*/\r\n    elproto.data = function (key, value) {\r\n        var data = eldata[this.id] = eldata[this.id] || {};\r\n        if (arguments.length == 0) {\r\n            return data;\r\n        }\r\n        if (arguments.length == 1) {\r\n            if (R.is(key, "object")) {\r\n                for (var i in key) if (key[has](i)) {\r\n                    this.data(i, key[i]);\r\n                }\r\n                return this;\r\n            }\r\n            eve("raphael.data.get." + this.id, this, data[key], key);\r\n            return data[key];\r\n        }\r\n        data[key] = value;\r\n        eve("raphael.data.set." + this.id, this, value, key);\r\n        return this;\r\n    };\r\n\r\n    elproto.datum = function(){\r\n        return arguments.length == 0 ? this._bindData : ((this._bindData = arguments[0]), this);\r\n    };\r\n\r\n    /*\\\r\n     * Element.removeData\r\n     [ method ]\r\n     **\r\n     * Removes value associated with an element by given key.\r\n     * If key is not provided, removes all the data of the element.\r\n     > Parameters\r\n     - key (string) #optional key\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.removeData = function (key) {\r\n        if (key == null) {\r\n            eldata[this.id] = {};\r\n        } else {\r\n            eldata[this.id] && delete eldata[this.id][key];\r\n        }\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.getData\r\n     [ method ]\r\n     **\r\n     * Retrieves the element data\r\n     = (object) data\r\n     \\*/\r\n    elproto.getData = function () {\r\n        return clone(eldata[this.id] || {});\r\n    };\r\n    /*\\\r\n     * Element.hover\r\n     [ method ]\r\n     **\r\n     * Adds event handlers for hover for the element.\r\n     > Parameters\r\n     - f_in (function) handler for hover in\r\n     - f_out (function) handler for hover out\r\n     - icontext (object) #optional context for hover in handler\r\n     - ocontext (object) #optional context for hover out handler\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.hover = function (f_in, f_out, scope_in, scope_out) {\r\n        return this.mouseover(f_in, scope_in).mouseout(f_out, scope_out || scope_in);\r\n    };\r\n    /*\\\r\n     * Element.unhover\r\n     [ method ]\r\n     **\r\n     * Removes event handlers for hover for the element.\r\n     > Parameters\r\n     - f_in (function) handler for hover in\r\n     - f_out (function) handler for hover out\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.unhover = function (f_in, f_out) {\r\n        return this.unmouseover(f_in).unmouseout(f_out);\r\n    };\r\n    var draggable = [];\r\n    /*\\\r\n     * Element.drag\r\n     [ method ]\r\n     **\r\n     * Adds event handlers for drag of the element.\r\n     > Parameters\r\n     - onmove (function) handler for moving\r\n     - onstart (function) handler for drag start\r\n     - onend (function) handler for drag end\r\n     - mcontext (object) #optional context for moving handler\r\n     - scontext (object) #optional context for drag start handler\r\n     - econtext (object) #optional context for drag end handler\r\n     * Additionaly following `drag` events will be triggered: `drag.start.<id>` on start,\r\n     * `drag.end.<id>` on end and `drag.move.<id>` on every move. When element will be dragged over another element\r\n     * `drag.over.<id>` will be fired as well.\r\n     *\r\n     * Start event and start handler will be called in specified context or in context of the element with following parameters:\r\n     o x (number) x position of the mouse\r\n     o y (number) y position of the mouse\r\n     o event (object) DOM event object\r\n     * Move event and move handler will be called in specified context or in context of the element with following parameters:\r\n     o dx (number) shift by x from the start point\r\n     o dy (number) shift by y from the start point\r\n     o x (number) x position of the mouse\r\n     o y (number) y position of the mouse\r\n     o event (object) DOM event object\r\n     * End event and end handler will be called in specified context or in context of the element with following parameters:\r\n     o event (object) DOM event object\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.drag = function (onmove, onstart, onend, move_scope, start_scope, end_scope) {\r\n        function start(e) {\r\n            (e.originalEvent || e).preventDefault();\r\n            var x = e.clientX,\r\n                y = e.clientY,\r\n                scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,\r\n                scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft;\r\n            this._drag.id = e.identifier;\r\n            if (supportsTouch && e.touches) {\r\n                var i = e.touches.length, touch;\r\n                while (i--) {\r\n                    touch = e.touches[i];\r\n                    this._drag.id = touch.identifier;\r\n                    if (touch.identifier == this._drag.id) {\r\n                        x = touch.clientX;\r\n                        y = touch.clientY;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            this._drag.x = x + scrollX;\r\n            this._drag.y = y + scrollY;\r\n            !drag.length && R.mousemove(dragMove).mouseup(dragUp);\r\n            drag.push({el: this, move_scope: move_scope, start_scope: start_scope, end_scope: end_scope});\r\n            onstart && eve.on("raphael.drag.start." + this.id, onstart);\r\n            onmove && eve.on("raphael.drag.move." + this.id, onmove);\r\n            onend && eve.on("raphael.drag.end." + this.id, onend);\r\n            eve("raphael.drag.start." + this.id, start_scope || move_scope || this, e.clientX + scrollX, e.clientY + scrollY, e);\r\n        }\r\n        this._drag = {};\r\n        draggable.push({el: this, start: start});\r\n        this.mousedown(start);\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.onDragOver\r\n     [ method ]\r\n     **\r\n     * Shortcut for assigning event handler for `drag.over.<id>` event, where id is id of the element (see @Element.id).\r\n     > Parameters\r\n     - f (function) handler for event, first argument would be the element you are dragging over\r\n     \\*/\r\n    elproto.onDragOver = function (f) {\r\n        f ? eve.on("raphael.drag.over." + this.id, f) : eve.unbind("raphael.drag.over." + this.id);\r\n    };\r\n    /*\\\r\n     * Element.undrag\r\n     [ method ]\r\n     **\r\n     * Removes all drag event handlers from given element.\r\n     \\*/\r\n    elproto.undrag = function () {\r\n        var i = draggable.length;\r\n        while (i--) if (draggable[i].el == this) {\r\n            this.unmousedown(draggable[i].start);\r\n            draggable.splice(i, 1);\r\n            eve.unbind("raphael.drag.*." + this.id);\r\n        }\r\n        !draggable.length && R.unmousemove(dragMove).unmouseup(dragUp);\r\n        drag = [];\r\n    };\r\n    /*\\\r\n     * Paper.circle\r\n     [ method ]\r\n     **\r\n     * Draws a circle.\r\n     **\r\n     > Parameters\r\n     **\r\n     - x (number) x coordinate of the centre\r\n     - y (number) y coordinate of the centre\r\n     - r (number) radius\r\n     = (object) Raphaël element object with type “circle”\r\n     **\r\n     > Usage\r\n     | var c = paper.circle(50, 50, 40);\r\n     \\*/\r\n    paperproto.circle = function (x, y, r) {\r\n        var out = R._engine.circle(this, x || 0, y || 0, r || 0);\r\n        this.__set__ && this.__set__.push(out);\r\n        return out;\r\n    };\r\n    /*\\\r\n     * Paper.rect\r\n     [ method ]\r\n     *\r\n     * Draws a rectangle.\r\n     **\r\n     > Parameters\r\n     **\r\n     - x (number) x coordinate of the top left corner\r\n     - y (number) y coordinate of the top left corner\r\n     - width (number) width\r\n     - height (number) height\r\n     - r (number) #optional radius for rounded corners, default is 0\r\n     = (object) Raphaël element object with type “rect”\r\n     **\r\n     > Usage\r\n     | // regular rectangle\r\n     | var c = paper.rect(10, 10, 50, 50);\r\n     | // rectangle with rounded corners\r\n     | var c = paper.rect(40, 40, 50, 50, 10);\r\n     \\*/\r\n    paperproto.rect = function (x, y, w, h, r) {\r\n        var out = R._engine.rect(this, x || 0, y || 0, w || 0, h || 0, r || 0);\r\n        this.__set__ && this.__set__.push(out);\r\n        return out;\r\n    };\r\n    /*\\\r\n     * Paper.ellipse\r\n     [ method ]\r\n     **\r\n     * Draws an ellipse.\r\n     **\r\n     > Parameters\r\n     **\r\n     - x (number) x coordinate of the centre\r\n     - y (number) y coordinate of the centre\r\n     - rx (number) horizontal radius\r\n     - ry (number) vertical radius\r\n     = (object) Raphaël element object with type “ellipse”\r\n     **\r\n     > Usage\r\n     | var c = paper.ellipse(50, 50, 40, 20);\r\n     \\*/\r\n    paperproto.ellipse = function (x, y, rx, ry) {\r\n        var out = R._engine.ellipse(this, x || 0, y || 0, rx || 0, ry || 0);\r\n        this.__set__ && this.__set__.push(out);\r\n        return out;\r\n    };\r\n    /*\\\r\n     * Paper.path\r\n     [ method ]\r\n     **\r\n     * Creates a path element by given path data string.\r\n     > Parameters\r\n     - pathString (string) #optional path string in SVG format.\r\n     * Path string consists of one-letter commands, followed by comma seprarated arguments in numercal form. Example:\r\n     | "M10,20L30,40"\r\n     * Here we can see two commands: “M”, with arguments `(10, 20)` and “L” with arguments `(30, 40)`. Upper case letter mean command is absolute, lower case—relative.\r\n     *\r\n     # <p>Here is short list of commands available, for more details see <a href="http://www.w3.org/TR/SVG/paths.html#PathData" title="Details of a path\'s data attribute\'s format are described in the SVG specification.">SVG path string format</a>.</p>\r\n     # <table><thead><tr><th>Command</th><th>Name</th><th>Parameters</th></tr></thead><tbody>\r\n     # <tr><td>M</td><td>moveto</td><td>(x y)+</td></tr>\r\n     # <tr><td>Z</td><td>closepath</td><td>(none)</td></tr>\r\n     # <tr><td>L</td><td>lineto</td><td>(x y)+</td></tr>\r\n     # <tr><td>H</td><td>horizontal lineto</td><td>x+</td></tr>\r\n     # <tr><td>V</td><td>vertical lineto</td><td>y+</td></tr>\r\n     # <tr><td>C</td><td>curveto</td><td>(x1 y1 x2 y2 x y)+</td></tr>\r\n     # <tr><td>S</td><td>smooth curveto</td><td>(x2 y2 x y)+</td></tr>\r\n     # <tr><td>Q</td><td>quadratic Bézier curveto</td><td>(x1 y1 x y)+</td></tr>\r\n     # <tr><td>T</td><td>smooth quadratic Bézier curveto</td><td>(x y)+</td></tr>\r\n     # <tr><td>A</td><td>elliptical arc</td><td>(rx ry x-axis-rotation large-arc-flag sweep-flag x y)+</td></tr>\r\n     # <tr><td>R</td><td><a href="http://en.wikipedia.org/wiki/Catmull–Rom_spline#Catmull.E2.80.93Rom_spline">Catmull-Rom curveto</a>*</td><td>x1 y1 (x y)+</td></tr></tbody></table>\r\n     * * “Catmull-Rom curveto” is a not standard SVG command and added in 2.0 to make life easier.\r\n     * Note: there is a special case when path consist of just three commands: “M10,10R…z”. In this case path will smoothly connects to its beginning.\r\n     > Usage\r\n     | var c = paper.path("M10 10L90 90");\r\n     | // draw a diagonal line:\r\n     | // move to 10,10, line to 90,90\r\n     * For example of path strings, check out these icons: http://raphaeljs.com/icons/\r\n     \\*/\r\n    paperproto.path = function (pathString) {\r\n        pathString && !R.is(pathString, string) && !R.is(pathString[0], array) && (pathString += E);\r\n        var out = R._engine.path(R.format[apply](R, arguments), this);\r\n        this.__set__ && this.__set__.push(out);\r\n        return out;\r\n    };\r\n    /*\\\r\n     * Paper.image\r\n     [ method ]\r\n     **\r\n     * Embeds an image into the surface.\r\n     **\r\n     > Parameters\r\n     **\r\n     - src (string) URI of the source image\r\n     - x (number) x coordinate position\r\n     - y (number) y coordinate position\r\n     - width (number) width of the image\r\n     - height (number) height of the image\r\n     = (object) Raphaël element object with type “image”\r\n     **\r\n     > Usage\r\n     | var c = paper.image("apple.png", 10, 10, 80, 80);\r\n     \\*/\r\n    paperproto.image = function (src, x, y, w, h) {\r\n        var out = R._engine.image(this, src || "about:blank", x || 0, y || 0, w || 0, h || 0);\r\n        this.__set__ && this.__set__.push(out);\r\n        return out;\r\n    };\r\n    /*\\\r\n     * Paper.text\r\n     [ method ]\r\n     **\r\n     * Draws a text string. If you need line breaks, put “\\n” in the string.\r\n     **\r\n     > Parameters\r\n     **\r\n     - x (number) x coordinate position\r\n     - y (number) y coordinate position\r\n     - text (string) The text string to draw\r\n     = (object) Raphaël element object with type “text”\r\n     **\r\n     > Usage\r\n     | var t = paper.text(50, 50, "Raphaël\\nkicks\\nbutt!");\r\n     \\*/\r\n    paperproto.text = function (x, y, text) {\r\n        var out = R._engine.text(this, x || 0, y || 0, Str(text));\r\n        this.__set__ && this.__set__.push(out);\r\n        return out;\r\n    };\r\n    /*\\\r\n     * Paper.set\r\n     [ method ]\r\n     **\r\n     * Creates array-like object to keep and operate several elements at once.\r\n     * Warning: it doesn’t create any elements for itself in the page, it just groups existing elements.\r\n     * Sets act as pseudo elements — all methods available to an element can be used on a set.\r\n     = (object) array-like object that represents set of elements\r\n     **\r\n     > Usage\r\n     | var st = paper.set();\r\n     | st.push(\r\n     |     paper.circle(10, 10, 5),\r\n     |     paper.circle(30, 10, 5)\r\n     | );\r\n     | st.attr({fill: "red"}); // changes the fill of both circles\r\n     \\*/\r\n    paperproto.set = function (itemsArray) {\r\n        !R.is(itemsArray, "array") && (itemsArray = Array.prototype.splice.call(arguments, 0, arguments.length));\r\n        var out = new Set(itemsArray);\r\n        this.__set__ && this.__set__.push(out);\r\n        out["paper"] = this;\r\n        out["type"] = "set";\r\n        return out;\r\n    };\r\n    /*\\\r\n     * Paper.setStart\r\n     [ method ]\r\n     **\r\n     * Creates @Paper.set. All elements that will be created after calling this method and before calling\r\n     * @Paper.setFinish will be added to the set.\r\n     **\r\n     > Usage\r\n     | paper.setStart();\r\n     | paper.circle(10, 10, 5),\r\n     | paper.circle(30, 10, 5)\r\n     | var st = paper.setFinish();\r\n     | st.attr({fill: "red"}); // changes the fill of both circles\r\n     \\*/\r\n    paperproto.setStart = function (set) {\r\n        this.__set__ = set || this.set();\r\n    };\r\n    /*\\\r\n     * Paper.setFinish\r\n     [ method ]\r\n     **\r\n     * See @Paper.setStart. This method finishes catching and returns resulting set.\r\n     **\r\n     = (object) set\r\n     \\*/\r\n    paperproto.setFinish = function (set) {\r\n        var out = this.__set__;\r\n        delete this.__set__;\r\n        return out;\r\n    };\r\n    /*\\\r\n     * Paper.getSize\r\n     [ method ]\r\n     **\r\n     * Obtains current paper actual size.\r\n     **\r\n     = (object)\r\n     \\*/\r\n    paperproto.getSize = function () {\r\n        var container = this.canvas.parentNode;\r\n        return {\r\n            width: container.offsetWidth,\r\n            height: container.offsetHeight\r\n        };\r\n    };\r\n    /*\\\r\n     * Paper.setSize\r\n     [ method ]\r\n     **\r\n     * If you need to change dimensions of the canvas call this method\r\n     **\r\n     > Parameters\r\n     **\r\n     - width (number) new width of the canvas\r\n     - height (number) new height of the canvas\r\n     \\*/\r\n    paperproto.setSize = function (width, height) {\r\n        return R._engine.setSize.call(this, width, height);\r\n    };\r\n    /*\\\r\n     * Paper.setViewBox\r\n     [ method ]\r\n     **\r\n     * Sets the view box of the paper. Practically it gives you ability to zoom and pan whole paper surface by\r\n     * specifying new boundaries.\r\n     **\r\n     > Parameters\r\n     **\r\n     - x (number) new x position, default is `0`\r\n     - y (number) new y position, default is `0`\r\n     - w (number) new width of the canvas\r\n     - h (number) new height of the canvas\r\n     - fit (boolean) `true` if you want graphics to fit into new boundary box\r\n     \\*/\r\n    paperproto.setViewBox = function (x, y, w, h, fit) {\r\n        return R._engine.setViewBox.call(this, x, y, w, h, fit);\r\n    };\r\n    /*\\\r\n     * Paper.top\r\n     [ property ]\r\n     **\r\n     * Points to the topmost element on the paper\r\n     \\*/\r\n    /*\\\r\n     * Paper.bottom\r\n     [ property ]\r\n     **\r\n     * Points to the bottom element on the paper\r\n     \\*/\r\n    paperproto.top = paperproto.bottom = null;\r\n    /*\\\r\n     * Paper.raphael\r\n     [ property ]\r\n     **\r\n     * Points to the @Raphael object/function\r\n     \\*/\r\n    paperproto.raphael = R;\r\n    var getOffset = function (elem) {\r\n        var box = elem.getBoundingClientRect(),\r\n            doc = elem.ownerDocument,\r\n            body = doc.body,\r\n            docElem = doc.documentElement,\r\n            clientTop = docElem.clientTop || body.clientTop || 0, clientLeft = docElem.clientLeft || body.clientLeft || 0,\r\n            top  = box.top  + (g.win.pageYOffset || docElem.scrollTop || body.scrollTop ) - clientTop,\r\n            left = box.left + (g.win.pageXOffset || docElem.scrollLeft || body.scrollLeft) - clientLeft;\r\n        return {\r\n            y: top,\r\n            x: left\r\n        };\r\n    };\r\n    /*\\\r\n     * Paper.getElementByPoint\r\n     [ method ]\r\n     **\r\n     * Returns you topmost element under given point.\r\n     **\r\n     = (object) Raphaël element object\r\n     > Parameters\r\n     **\r\n     - x (number) x coordinate from the top left corner of the window\r\n     - y (number) y coordinate from the top left corner of the window\r\n     > Usage\r\n     | paper.getElementByPoint(mouseX, mouseY).attr({stroke: "#f00"});\r\n     \\*/\r\n    paperproto.getElementByPoint = function (x, y) {\r\n        var paper = this,\r\n            svg = paper.canvas,\r\n            target = g.doc.elementFromPoint(x, y);\r\n        if (g.win.opera && target.tagName == "svg") {\r\n            var so = getOffset(svg),\r\n                sr = svg.createSVGRect();\r\n            sr.x = x - so.x;\r\n            sr.y = y - so.y;\r\n            sr.width = sr.height = 1;\r\n            var hits = svg.getIntersectionList(sr, null);\r\n            if (hits.length) {\r\n                target = hits[hits.length - 1];\r\n            }\r\n        }\r\n        if (!target) {\r\n            return null;\r\n        }\r\n        while (target.parentNode && target != svg.parentNode && !target.raphael) {\r\n            target = target.parentNode;\r\n        }\r\n        target == paper.canvas.parentNode && (target = svg);\r\n        target = target && target.raphael ? paper.getById(target.raphaelid) : null;\r\n        return target;\r\n    };\r\n\r\n    /*\\\r\n     * Paper.getElementsByBBox\r\n     [ method ]\r\n     **\r\n     * Returns set of elements that have an intersecting bounding box\r\n     **\r\n     > Parameters\r\n     **\r\n     - bbox (object) bbox to check with\r\n     = (object) @Set\r\n     \\*/\r\n    paperproto.getElementsByBBox = function (bbox) {\r\n        var set = this.set();\r\n        this.forEach(function (el) {\r\n            if (R.isBBoxIntersect(el.getBBox(), bbox)) {\r\n                set.push(el);\r\n            }\r\n        });\r\n        return set;\r\n    };\r\n\r\n    /*\\\r\n     * Paper.getById\r\n     [ method ]\r\n     **\r\n     * Returns you element by its internal ID.\r\n     **\r\n     > Parameters\r\n     **\r\n     - id (number) id\r\n     = (object) Raphaël element object\r\n     \\*/\r\n    paperproto.getById = function (id) {\r\n        var bot = this.bottom;\r\n        while (bot) {\r\n            if (bot.id == id) {\r\n                return bot;\r\n            }\r\n            bot = bot.next;\r\n        }\r\n        return null;\r\n    };\r\n    /*\\\r\n     * Paper.forEach\r\n     [ method ]\r\n     **\r\n     * Executes given function for each element on the paper\r\n     *\r\n     * If callback function returns `false` it will stop loop running.\r\n     **\r\n     > Parameters\r\n     **\r\n     - callback (function) function to run\r\n     - thisArg (object) context object for the callback\r\n     = (object) Paper object\r\n     > Usage\r\n     | paper.forEach(function (el) {\r\n     |     el.attr({ stroke: "blue" });\r\n     | });\r\n     \\*/\r\n    paperproto.forEach = function (callback, thisArg) {\r\n        var bot = this.bottom;\r\n        while (bot) {\r\n            if (callback.call(thisArg, bot) === false) {\r\n                return this;\r\n            }\r\n            bot = bot.next;\r\n        }\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Paper.getElementsByPoint\r\n     [ method ]\r\n     **\r\n     * Returns set of elements that have common point inside\r\n     **\r\n     > Parameters\r\n     **\r\n     - x (number) x coordinate of the point\r\n     - y (number) y coordinate of the point\r\n     = (object) @Set\r\n     \\*/\r\n    paperproto.getElementsByPoint = function (x, y) {\r\n        var set = this.set();\r\n        this.forEach(function (el) {\r\n            if (el.isPointInside(x, y)) {\r\n                set.push(el);\r\n            }\r\n        });\r\n        return set;\r\n    };\r\n    function x_y() {\r\n        return this.x + S + this.y;\r\n    }\r\n    function x_y_w_h() {\r\n        return this.x + S + this.y + S + this.width + " \\xd7 " + this.height;\r\n    }\r\n    /*\\\r\n     * Element.isPointInside\r\n     [ method ]\r\n     **\r\n     * Determine if given point is inside this element’s shape\r\n     **\r\n     > Parameters\r\n     **\r\n     - x (number) x coordinate of the point\r\n     - y (number) y coordinate of the point\r\n     = (boolean) `true` if point inside the shape\r\n     \\*/\r\n    elproto.isPointInside = function (x, y) {\r\n        var rp = this.realPath = getPath[this.type](this);\r\n        if (this.attr(\'transform\') && this.attr(\'transform\').length) {\r\n            rp = R.transformPath(rp, this.attr(\'transform\'));\r\n        }\r\n        return R.isPointInsidePath(rp, x, y);\r\n    };\r\n    /*\\\r\n     * Element.getBBox\r\n     [ method ]\r\n     **\r\n     * Return bounding box for a given element\r\n     **\r\n     > Parameters\r\n     **\r\n     - isWithoutTransform (boolean) flag, `true` if you want to have bounding box before transformations. Default is `false`.\r\n     = (object) Bounding box object:\r\n     o {\r\n     o     x: (number) top left corner x\r\n     o     y: (number) top left corner y\r\n     o     x2: (number) bottom right corner x\r\n     o     y2: (number) bottom right corner y\r\n     o     width: (number) width\r\n     o     height: (number) height\r\n     o }\r\n     \\*/\r\n    elproto.getBBox = function (isWithoutTransform) {\r\n        if (this.removed) {\r\n            return {};\r\n        }\r\n        var _ = this._;\r\n        if (isWithoutTransform) {\r\n            if (_.dirty || !_.bboxwt) {\r\n                this.realPath = getPath[this.type](this);\r\n                _.bboxwt = pathDimensions(this.realPath);\r\n                _.bboxwt.toString = x_y_w_h;\r\n                _.dirty = 0;\r\n            }\r\n            return _.bboxwt;\r\n        }\r\n        if (_.dirty || _.dirtyT || !_.bbox) {\r\n            if (_.dirty || !this.realPath) {\r\n                _.bboxwt = 0;\r\n                this.realPath = getPath[this.type](this);\r\n            }\r\n            _.bbox = pathDimensions(mapPath(this.realPath, this.matrix));\r\n            _.bbox.toString = x_y_w_h;\r\n            _.dirty = _.dirtyT = 0;\r\n        }\r\n        return _.bbox;\r\n    };\r\n    /*\\\r\n     * Element.clone\r\n     [ method ]\r\n     **\r\n     = (object) clone of a given element\r\n     **\r\n     \\*/\r\n    elproto.clone = function () {\r\n        if (this.removed) {\r\n            return null;\r\n        }\r\n        var out = this.paper[this.type]().attr(this.attr());\r\n        this.__set__ && this.__set__.push(out);\r\n        return out;\r\n    };\r\n    /*\\\r\n     * Element.glow\r\n     [ method ]\r\n     **\r\n     * Return set of elements that create glow-like effect around given element. See @Paper.set.\r\n     *\r\n     * Note: Glow is not connected to the element. If you change element attributes it won’t adjust itself.\r\n     **\r\n     > Parameters\r\n     **\r\n     - glow (object) #optional parameters object with all properties optional:\r\n     o {\r\n     o     width (number) size of the glow, default is `10`\r\n     o     fill (boolean) will it be filled, default is `false`\r\n     o     opacity (number) opacity, default is `0.5`\r\n     o     offsetx (number) horizontal offset, default is `0`\r\n     o     offsety (number) vertical offset, default is `0`\r\n     o     color (string) glow colour, default is `black`\r\n     o }\r\n     = (object) @Paper.set of elements that represents glow\r\n     \\*/\r\n    elproto.glow = function (glow) {\r\n        if (this.type == "text") {\r\n            return null;\r\n        }\r\n        glow = glow || {};\r\n        var s = {\r\n                width: (glow.width || 10) + (+this.attr("stroke-width") || 1),\r\n                fill: glow.fill || false,\r\n                opacity: glow.opacity == null ? .5 : glow.opacity,\r\n                offsetx: glow.offsetx || 0,\r\n                offsety: glow.offsety || 0,\r\n                color: glow.color || "#000"\r\n            },\r\n            c = s.width / 2,\r\n            r = this.paper,\r\n            out = r.set(),\r\n            path = this.realPath || getPath[this.type](this);\r\n        path = this.matrix ? mapPath(path, this.matrix) : path;\r\n        for (var i = 1; i < c + 1; i++) {\r\n            out.push(r.path(path).attr({\r\n                stroke: s.color,\r\n                fill: s.fill ? s.color : "none",\r\n                "stroke-linejoin": "round",\r\n                "stroke-linecap": "round",\r\n                "stroke-width": +(s.width / c * i).toFixed(3),\r\n                opacity: +(s.opacity / c).toFixed(3)\r\n            }));\r\n        }\r\n        return out.insertBefore(this).translate(s.offsetx, s.offsety);\r\n    };\r\n    var curveslengths = {},\r\n        getPointAtSegmentLength = function (p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, length) {\r\n            if (length == null) {\r\n                return bezlen(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y);\r\n            } else {\r\n                return R.findDotsAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, getTatLen(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, length));\r\n            }\r\n        },\r\n        getLengthFactory = function (istotal, subpath) {\r\n            return function (path, length, onlystart) {\r\n                path = path2curve(path);\r\n                var x, y, p, l, sp = "", subpaths = {}, point,\r\n                    len = 0;\r\n                for (var i = 0, ii = path.length; i < ii; i++) {\r\n                    p = path[i];\r\n                    if (p[0] == "M") {\r\n                        x = +p[1];\r\n                        y = +p[2];\r\n                    } else {\r\n                        l = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6]);\r\n                        if (len + l > length) {\r\n                            if (subpath && !subpaths.start) {\r\n                                point = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6], length - len);\r\n                                sp += ["C" + point.start.x, point.start.y, point.m.x, point.m.y, point.x, point.y];\r\n                                if (onlystart) {return sp;}\r\n                                subpaths.start = sp;\r\n                                sp = ["M" + point.x, point.y + "C" + point.n.x, point.n.y, point.end.x, point.end.y, p[5], p[6]].join();\r\n                                len += l;\r\n                                x = +p[5];\r\n                                y = +p[6];\r\n                                continue;\r\n                            }\r\n                            if (!istotal && !subpath) {\r\n                                point = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6], length - len);\r\n                                return {x: point.x, y: point.y, alpha: point.alpha};\r\n                            }\r\n                        }\r\n                        len += l;\r\n                        x = +p[5];\r\n                        y = +p[6];\r\n                    }\r\n                    sp += p.shift() + p;\r\n                }\r\n                subpaths.end = sp;\r\n                point = istotal ? len : subpath ? subpaths : R.findDotsAtSegment(x, y, p[0], p[1], p[2], p[3], p[4], p[5], 1);\r\n                point.alpha && (point = {x: point.x, y: point.y, alpha: point.alpha});\r\n                return point;\r\n            };\r\n        };\r\n    var getTotalLength = getLengthFactory(1),\r\n        getPointAtLength = getLengthFactory(),\r\n        getSubpathsAtLength = getLengthFactory(0, 1);\r\n    /*\\\r\n     * Raphael.getTotalLength\r\n     [ method ]\r\n     **\r\n     * Returns length of the given path in pixels.\r\n     **\r\n     > Parameters\r\n     **\r\n     - path (string) SVG path string.\r\n     **\r\n     = (number) length.\r\n     \\*/\r\n    R.getTotalLength = getTotalLength;\r\n    /*\\\r\n     * Raphael.getPointAtLength\r\n     [ method ]\r\n     **\r\n     * Return coordinates of the point located at the given length on the given path.\r\n     **\r\n     > Parameters\r\n     **\r\n     - path (string) SVG path string\r\n     - length (number)\r\n     **\r\n     = (object) representation of the point:\r\n     o {\r\n     o     x: (number) x coordinate\r\n     o     y: (number) y coordinate\r\n     o     alpha: (number) angle of derivative\r\n     o }\r\n     \\*/\r\n    R.getPointAtLength = getPointAtLength;\r\n    /*\\\r\n     * Raphael.getSubpath\r\n     [ method ]\r\n     **\r\n     * Return subpath of a given path from given length to given length.\r\n     **\r\n     > Parameters\r\n     **\r\n     - path (string) SVG path string\r\n     - from (number) position of the start of the segment\r\n     - to (number) position of the end of the segment\r\n     **\r\n     = (string) pathstring for the segment\r\n     \\*/\r\n    R.getSubpath = function (path, from, to) {\r\n        if (this.getTotalLength(path) - to < 1e-6) {\r\n            return getSubpathsAtLength(path, from).end;\r\n        }\r\n        var a = getSubpathsAtLength(path, to, 1);\r\n        return from ? getSubpathsAtLength(a, from).end : a;\r\n    };\r\n    /*\\\r\n     * Element.getTotalLength\r\n     [ method ]\r\n     **\r\n     * Returns length of the path in pixels. Only works for element of “path” type.\r\n     = (number) length.\r\n     \\*/\r\n    elproto.getTotalLength = function () {\r\n        var path = this.getPath();\r\n        if (!path) {\r\n            return;\r\n        }\r\n\r\n        if (this.node.getTotalLength) {\r\n            return this.node.getTotalLength();\r\n        }\r\n\r\n        return getTotalLength(path);\r\n    };\r\n    /*\\\r\n     * Element.getPointAtLength\r\n     [ method ]\r\n     **\r\n     * Return coordinates of the point located at the given length on the given path. Only works for element of “path” type.\r\n     **\r\n     > Parameters\r\n     **\r\n     - length (number)\r\n     **\r\n     = (object) representation of the point:\r\n     o {\r\n     o     x: (number) x coordinate\r\n     o     y: (number) y coordinate\r\n     o     alpha: (number) angle of derivative\r\n     o }\r\n     \\*/\r\n    elproto.getPointAtLength = function (length) {\r\n        var path = this.getPath();\r\n        if (!path) {\r\n            return;\r\n        }\r\n\r\n        return getPointAtLength(path, length);\r\n    };\r\n    /*\\\r\n     * Element.getPath\r\n     [ method ]\r\n     **\r\n     * Returns path of the element. Only works for elements of “path” type and simple elements like circle.\r\n     = (object) path\r\n     **\r\n     \\*/\r\n    elproto.getPath = function () {\r\n        var path,\r\n            getPath = R._getPath[this.type];\r\n\r\n        if (this.type == "text" || this.type == "set") {\r\n            return;\r\n        }\r\n\r\n        if (getPath) {\r\n            path = getPath(this);\r\n        }\r\n\r\n        return path;\r\n    };\r\n    /*\\\r\n     * Element.getSubpath\r\n     [ method ]\r\n     **\r\n     * Return subpath of a given element from given length to given length. Only works for element of “path” type.\r\n     **\r\n     > Parameters\r\n     **\r\n     - from (number) position of the start of the segment\r\n     - to (number) position of the end of the segment\r\n     **\r\n     = (string) pathstring for the segment\r\n     \\*/\r\n    elproto.getSubpath = function (from, to) {\r\n        var path = this.getPath();\r\n        if (!path) {\r\n            return;\r\n        }\r\n\r\n        return R.getSubpath(path, from, to);\r\n    };\r\n    /*\\\r\n     * Raphael.easing_formulas\r\n     [ property ]\r\n     **\r\n     * Object that contains easing formulas for animation. You could extend it with your own. By default it has following list of easing:\r\n     # <ul>\r\n     #     <li>“linear”</li>\r\n     #     <li>“&lt;” or “easeIn” or “ease-in”</li>\r\n     #     <li>“>” or “easeOut” or “ease-out”</li>\r\n     #     <li>“&lt;>” or “easeInOut” or “ease-in-out”</li>\r\n     #     <li>“backIn” or “back-in”</li>\r\n     #     <li>“backOut” or “back-out”</li>\r\n     #     <li>“elastic”</li>\r\n     #     <li>“bounce”</li>\r\n     # </ul>\r\n     # <p>See also <a href="http://raphaeljs.com/easing.html">Easing demo</a>.</p>\r\n     \\*/\r\n    var ef = R.easing_formulas = {\r\n        linear: function (n) {\r\n            return n;\r\n        },\r\n        "<": function (n) {\r\n            return pow(n, 1.7);\r\n        },\r\n        ">": function (n) {\r\n            return pow(n, .48);\r\n        },\r\n        "<>": function (n) {\r\n            var q = .48 - n / 1.04,\r\n                Q = math.sqrt(.1734 + q * q),\r\n                x = Q - q,\r\n                X = pow(abs(x), 1 / 3) * (x < 0 ? -1 : 1),\r\n                y = -Q - q,\r\n                Y = pow(abs(y), 1 / 3) * (y < 0 ? -1 : 1),\r\n                t = X + Y + .5;\r\n            return (1 - t) * 3 * t * t + t * t * t;\r\n        },\r\n        backIn: function (n) {\r\n            var s = 1.70158;\r\n            return n * n * ((s + 1) * n - s);\r\n        },\r\n        backOut: function (n) {\r\n            n = n - 1;\r\n            var s = 1.70158;\r\n            return n * n * ((s + 1) * n + s) + 1;\r\n        },\r\n        elastic: function (n) {\r\n            if (n == !!n) {\r\n                return n;\r\n            }\r\n            return pow(2, -10 * n) * math.sin((n - .075) * (2 * PI) / .3) + 1;\r\n        },\r\n        bounce: function (n) {\r\n            var s = 7.5625,\r\n                p = 2.75,\r\n                l;\r\n            if (n < (1 / p)) {\r\n                l = s * n * n;\r\n            } else {\r\n                if (n < (2 / p)) {\r\n                    n -= (1.5 / p);\r\n                    l = s * n * n + .75;\r\n                } else {\r\n                    if (n < (2.5 / p)) {\r\n                        n -= (2.25 / p);\r\n                        l = s * n * n + .9375;\r\n                    } else {\r\n                        n -= (2.625 / p);\r\n                        l = s * n * n + .984375;\r\n                    }\r\n                }\r\n            }\r\n            return l;\r\n        }\r\n    };\r\n    ef.easeIn = ef["ease-in"] = ef["<"];\r\n    ef.easeOut = ef["ease-out"] = ef[">"];\r\n    ef.easeInOut = ef["ease-in-out"] = ef["<>"];\r\n    ef["back-in"] = ef.backIn;\r\n    ef["back-out"] = ef.backOut;\r\n\r\n    var animationElements = [],\r\n        requestAnimFrame = window.requestAnimationFrame       ||\r\n            window.webkitRequestAnimationFrame ||\r\n            window.mozRequestAnimationFrame    ||\r\n            window.oRequestAnimationFrame      ||\r\n            window.msRequestAnimationFrame     ||\r\n            function (callback) {\r\n                setTimeout(callback, 16);\r\n            },\r\n        animation = function () {\r\n            var Now = +new Date,\r\n                l = 0;\r\n            for (; l < animationElements.length; l++) {\r\n                var e = animationElements[l];\r\n                if (e.el.removed || e.paused) {\r\n                    continue;\r\n                }\r\n                var time = Now - e.start,\r\n                    ms = e.ms,\r\n                    easing = e.easing,\r\n                    from = e.from,\r\n                    diff = e.diff,\r\n                    to = e.to,\r\n                    t = e.t,\r\n                    that = e.el,\r\n                    set = {},\r\n                    now,\r\n                    init = {},\r\n                    key;\r\n                if (e.initstatus) {\r\n                    time = (e.initstatus * e.anim.top - e.prev) / (e.percent - e.prev) * ms;\r\n                    e.status = e.initstatus;\r\n                    delete e.initstatus;\r\n                    e.stop && animationElements.splice(l--, 1);\r\n                } else {\r\n                    e.status = (e.prev + (e.percent - e.prev) * (time / ms)) / e.anim.top;\r\n                }\r\n                if (time < 0) {\r\n                    continue;\r\n                }\r\n                if (time < ms) {\r\n                    var pos = easing(time / ms);\r\n                    for (var attr in from) if (from[has](attr)) {\r\n                        switch (availableAnimAttrs[attr]) {\r\n                            case nu:\r\n                                now = +from[attr] + pos * ms * diff[attr];\r\n                                break;\r\n                            case "colour":\r\n                                now = "rgb(" + [\r\n                                        upto255(round(from[attr].r + pos * ms * diff[attr].r)),\r\n                                        upto255(round(from[attr].g + pos * ms * diff[attr].g)),\r\n                                        upto255(round(from[attr].b + pos * ms * diff[attr].b))\r\n                                    ].join(",") + ")";\r\n                                break;\r\n                            case "path":\r\n                                now = [];\r\n                                for (var i = 0, ii = from[attr].length; i < ii; i++) {\r\n                                    now[i] = [from[attr][i][0]];\r\n                                    for (var j = 1, jj = from[attr][i].length; j < jj; j++) {\r\n                                        now[i][j] = +from[attr][i][j] + pos * ms * diff[attr][i][j];\r\n                                    }\r\n                                    now[i] = now[i].join(S);\r\n                                }\r\n                                now = now.join(S);\r\n                                break;\r\n                            case "transform":\r\n                                if (diff[attr].real) {\r\n                                    now = [];\r\n                                    for (i = 0, ii = from[attr].length; i < ii; i++) {\r\n                                        now[i] = [from[attr][i][0]];\r\n                                        for (j = 1, jj = from[attr][i].length; j < jj; j++) {\r\n                                            now[i][j] = from[attr][i][j] + pos * ms * diff[attr][i][j];\r\n                                        }\r\n                                    }\r\n                                } else {\r\n                                    var get = function (i) {\r\n                                        return +from[attr][i] + pos * ms * diff[attr][i];\r\n                                    };\r\n                                    // now = [["r", get(2), 0, 0], ["t", get(3), get(4)], ["s", get(0), get(1), 0, 0]];\r\n                                    now = [["m", get(0), get(1), get(2), get(3), get(4), get(5)]];\r\n                                }\r\n                                break;\r\n                            case "csv":\r\n                                if (attr == "clip-rect") {\r\n                                    now = [];\r\n                                    i = 4;\r\n                                    while (i--) {\r\n                                        now[i] = +from[attr][i] + pos * ms * diff[attr][i];\r\n                                    }\r\n                                }\r\n                                break;\r\n                            default:\r\n                                var from2 = [][concat](from[attr]);\r\n                                now = [];\r\n                                i = that.paper.customAttributes[attr].length;\r\n                                while (i--) {\r\n                                    now[i] = +from2[i] + pos * ms * diff[attr][i];\r\n                                }\r\n                                break;\r\n                        }\r\n                        set[attr] = now;\r\n                    }\r\n                    that.attr(set);\r\n                    (function (id, that, anim) {\r\n                        setTimeout(function () {\r\n                            eve("raphael.anim.frame." + id, that, anim);\r\n                        });\r\n                    })(that.id, that, e.anim);\r\n                } else {\r\n                    (function(f, el, a) {\r\n                        setTimeout(function() {\r\n                            eve("raphael.anim.frame." + el.id, el, a);\r\n                            eve("raphael.anim.finish." + el.id, el, a);\r\n                            R.is(f, "function") && f.call(el);\r\n                        });\r\n                    })(e.callback, that, e.anim);\r\n                    that.attr(to);\r\n                    animationElements.splice(l--, 1);\r\n                    if (e.repeat > 1 && !e.next) {\r\n                        for (key in to) if (to[has](key)) {\r\n                            init[key] = e.totalOrigin[key];\r\n                        }\r\n                        e.el.attr(init);\r\n                        runAnimation(e.anim, e.el, e.anim.percents[0], null, e.totalOrigin, e.repeat - 1);\r\n                    }\r\n                    if (e.next && !e.stop) {\r\n                        runAnimation(e.anim, e.el, e.next, null, e.totalOrigin, e.repeat);\r\n                    }\r\n                }\r\n            }\r\n            animationElements.length && requestAnimFrame(animation);\r\n        },\r\n        upto255 = function (color) {\r\n            return color > 255 ? 255 : color < 0 ? 0 : color;\r\n        };\r\n    /*\\\r\n     * Element.animateWith\r\n     [ method ]\r\n     **\r\n     * Acts similar to @Element.animate, but ensure that given animation runs in sync with another given element.\r\n     **\r\n     > Parameters\r\n     **\r\n     - el (object) element to sync with\r\n     - anim (object) animation to sync with\r\n     - params (object) #optional final attributes for the element, see also @Element.attr\r\n     - ms (number) #optional number of milliseconds for animation to run\r\n     - easing (string) #optional easing type. Accept on of @Raphael.easing_formulas or CSS format: `cubic&#x2010;bezier(XX,&#160;XX,&#160;XX,&#160;XX)`\r\n     - callback (function) #optional callback function. Will be called at the end of animation.\r\n     * or\r\n     - element (object) element to sync with\r\n     - anim (object) animation to sync with\r\n     - animation (object) #optional animation object, see @Raphael.animation\r\n     **\r\n     = (object) original element\r\n     \\*/\r\n    elproto.animateWith = function (el, anim, params, ms, easing, callback) {\r\n        var element = this;\r\n        if (element.removed) {\r\n            callback && callback.call(element);\r\n            return element;\r\n        }\r\n        var a = params instanceof Animation ? params : R.animation(params, ms, easing, callback),\r\n            x, y;\r\n        runAnimation(a, element, a.percents[0], null, element.attr());\r\n        for (var i = 0, ii = animationElements.length; i < ii; i++) {\r\n            if (animationElements[i].anim == anim && animationElements[i].el == el) {\r\n                animationElements[ii - 1].start = animationElements[i].start;\r\n                break;\r\n            }\r\n        }\r\n        return element;\r\n        //\r\n        //\r\n        // var a = params ? R.animation(params, ms, easing, callback) : anim,\r\n        //     status = element.status(anim);\r\n        // return this.animate(a).status(a, status * anim.ms / a.ms);\r\n    };\r\n    function CubicBezierAtTime(t, p1x, p1y, p2x, p2y, duration) {\r\n        var cx = 3 * p1x,\r\n            bx = 3 * (p2x - p1x) - cx,\r\n            ax = 1 - cx - bx,\r\n            cy = 3 * p1y,\r\n            by = 3 * (p2y - p1y) - cy,\r\n            ay = 1 - cy - by;\r\n        function sampleCurveX(t) {\r\n            return ((ax * t + bx) * t + cx) * t;\r\n        }\r\n        function solve(x, epsilon) {\r\n            var t = solveCurveX(x, epsilon);\r\n            return ((ay * t + by) * t + cy) * t;\r\n        }\r\n        function solveCurveX(x, epsilon) {\r\n            var t0, t1, t2, x2, d2, i;\r\n            for(t2 = x, i = 0; i < 8; i++) {\r\n                x2 = sampleCurveX(t2) - x;\r\n                if (abs(x2) < epsilon) {\r\n                    return t2;\r\n                }\r\n                d2 = (3 * ax * t2 + 2 * bx) * t2 + cx;\r\n                if (abs(d2) < 1e-6) {\r\n                    break;\r\n                }\r\n                t2 = t2 - x2 / d2;\r\n            }\r\n            t0 = 0;\r\n            t1 = 1;\r\n            t2 = x;\r\n            if (t2 < t0) {\r\n                return t0;\r\n            }\r\n            if (t2 > t1) {\r\n                return t1;\r\n            }\r\n            while (t0 < t1) {\r\n                x2 = sampleCurveX(t2);\r\n                if (abs(x2 - x) < epsilon) {\r\n                    return t2;\r\n                }\r\n                if (x > x2) {\r\n                    t0 = t2;\r\n                } else {\r\n                    t1 = t2;\r\n                }\r\n                t2 = (t1 - t0) / 2 + t0;\r\n            }\r\n            return t2;\r\n        }\r\n        return solve(t, 1 / (200 * duration));\r\n    }\r\n    elproto.onAnimation = function (f) {\r\n        f ? eve.on("raphael.anim.frame." + this.id, f) : eve.unbind("raphael.anim.frame." + this.id);\r\n        return this;\r\n    };\r\n    function Animation(anim, ms) {\r\n        var percents = [],\r\n            newAnim = {};\r\n        this.ms = ms;\r\n        this.times = 1;\r\n        if (anim) {\r\n            for (var attr in anim) if (anim[has](attr)) {\r\n                newAnim[toFloat(attr)] = anim[attr];\r\n                percents.push(toFloat(attr));\r\n            }\r\n            percents.sort(sortByNumber);\r\n        }\r\n        this.anim = newAnim;\r\n        this.top = percents[percents.length - 1];\r\n        this.percents = percents;\r\n    }\r\n    /*\\\r\n     * Animation.delay\r\n     [ method ]\r\n     **\r\n     * Creates a copy of existing animation object with given delay.\r\n     **\r\n     > Parameters\r\n     **\r\n     - delay (number) number of ms to pass between animation start and actual animation\r\n     **\r\n     = (object) new altered Animation object\r\n     | var anim = Raphael.animation({cx: 10, cy: 20}, 2e3);\r\n     | circle1.animate(anim); // run the given animation immediately\r\n     | circle2.animate(anim.delay(500)); // run the given animation after 500 ms\r\n     \\*/\r\n    Animation.prototype.delay = function (delay) {\r\n        var a = new Animation(this.anim, this.ms);\r\n        a.times = this.times;\r\n        a.del = +delay || 0;\r\n        return a;\r\n    };\r\n    /*\\\r\n     * Animation.repeat\r\n     [ method ]\r\n     **\r\n     * Creates a copy of existing animation object with given repetition.\r\n     **\r\n     > Parameters\r\n     **\r\n     - repeat (number) number iterations of animation. For infinite animation pass `Infinity`\r\n     **\r\n     = (object) new altered Animation object\r\n     \\*/\r\n    Animation.prototype.repeat = function (times) {\r\n        var a = new Animation(this.anim, this.ms);\r\n        a.del = this.del;\r\n        a.times = math.floor(mmax(times, 0)) || 1;\r\n        return a;\r\n    };\r\n    function runAnimation(anim, element, percent, status, totalOrigin, times) {\r\n        percent = toFloat(percent);\r\n        var params,\r\n            isInAnim,\r\n            isInAnimSet,\r\n            percents = [],\r\n            next,\r\n            prev,\r\n            timestamp,\r\n            ms = anim.ms,\r\n            from = {},\r\n            to = {},\r\n            diff = {};\r\n        if (status) {\r\n            for (i = 0, ii = animationElements.length; i < ii; i++) {\r\n                var e = animationElements[i];\r\n                if (e.el.id == element.id && e.anim == anim) {\r\n                    if (e.percent != percent) {\r\n                        animationElements.splice(i, 1);\r\n                        isInAnimSet = 1;\r\n                    } else {\r\n                        isInAnim = e;\r\n                    }\r\n                    element.attr(e.totalOrigin);\r\n                    break;\r\n                }\r\n            }\r\n        } else {\r\n            status = +to; // NaN\r\n        }\r\n        for (var i = 0, ii = anim.percents.length; i < ii; i++) {\r\n            if (anim.percents[i] == percent || anim.percents[i] > status * anim.top) {\r\n                percent = anim.percents[i];\r\n                prev = anim.percents[i - 1] || 0;\r\n                ms = ms / anim.top * (percent - prev);\r\n                next = anim.percents[i + 1];\r\n                params = anim.anim[percent];\r\n                break;\r\n            } else if (status) {\r\n                element.attr(anim.anim[anim.percents[i]]);\r\n            }\r\n        }\r\n        if (!params) {\r\n            return;\r\n        }\r\n        if (!isInAnim) {\r\n            for (var attr in params) if (params[has](attr)) {\r\n                if (availableAnimAttrs[has](attr) || element.paper.customAttributes[has](attr)) {\r\n                    from[attr] = element.attr(attr);\r\n                    (from[attr] == null) && (from[attr] = availableAttrs[attr]);\r\n                    to[attr] = params[attr];\r\n                    switch (availableAnimAttrs[attr]) {\r\n                        case nu:\r\n                            diff[attr] = (to[attr] - from[attr]) / ms;\r\n                            break;\r\n                        case "colour":\r\n                            from[attr] = R.getRGB(from[attr]);\r\n                            var toColour = R.getRGB(to[attr]);\r\n                            diff[attr] = {\r\n                                r: (toColour.r - from[attr].r) / ms,\r\n                                g: (toColour.g - from[attr].g) / ms,\r\n                                b: (toColour.b - from[attr].b) / ms\r\n                            };\r\n                            break;\r\n                        case "path":\r\n                            var pathes = path2curve(from[attr], to[attr]),\r\n                                toPath = pathes[1];\r\n                            from[attr] = pathes[0];\r\n                            diff[attr] = [];\r\n                            for (i = 0, ii = from[attr].length; i < ii; i++) {\r\n                                diff[attr][i] = [0];\r\n                                for (var j = 1, jj = from[attr][i].length; j < jj; j++) {\r\n                                    diff[attr][i][j] = (toPath[i][j] - from[attr][i][j]) / ms;\r\n                                }\r\n                            }\r\n                            break;\r\n                        case "transform":\r\n                            var _ = element._,\r\n                                eq = equaliseTransform(_[attr], to[attr]);\r\n                            if (eq) {\r\n                                from[attr] = eq.from;\r\n                                to[attr] = eq.to;\r\n                                diff[attr] = [];\r\n                                diff[attr].real = true;\r\n                                for (i = 0, ii = from[attr].length; i < ii; i++) {\r\n                                    diff[attr][i] = [from[attr][i][0]];\r\n                                    for (j = 1, jj = from[attr][i].length; j < jj; j++) {\r\n                                        diff[attr][i][j] = (to[attr][i][j] - from[attr][i][j]) / ms;\r\n                                    }\r\n                                }\r\n                            } else {\r\n                                var m = (element.matrix || new Matrix),\r\n                                    to2 = {\r\n                                        _: {transform: _.transform},\r\n                                        getBBox: function () {\r\n                                            return element.getBBox(1);\r\n                                        }\r\n                                    };\r\n                                from[attr] = [\r\n                                    m.a,\r\n                                    m.b,\r\n                                    m.c,\r\n                                    m.d,\r\n                                    m.e,\r\n                                    m.f\r\n                                ];\r\n                                extractTransform(to2, to[attr]);\r\n                                to[attr] = to2._.transform;\r\n                                diff[attr] = [\r\n                                    (to2.matrix.a - m.a) / ms,\r\n                                    (to2.matrix.b - m.b) / ms,\r\n                                    (to2.matrix.c - m.c) / ms,\r\n                                    (to2.matrix.d - m.d) / ms,\r\n                                    (to2.matrix.e - m.e) / ms,\r\n                                    (to2.matrix.f - m.f) / ms\r\n                                ];\r\n                                // from[attr] = [_.sx, _.sy, _.deg, _.dx, _.dy];\r\n                                // var to2 = {_:{}, getBBox: function () { return element.getBBox(); }};\r\n                                // extractTransform(to2, to[attr]);\r\n                                // diff[attr] = [\r\n                                //     (to2._.sx - _.sx) / ms,\r\n                                //     (to2._.sy - _.sy) / ms,\r\n                                //     (to2._.deg - _.deg) / ms,\r\n                                //     (to2._.dx - _.dx) / ms,\r\n                                //     (to2._.dy - _.dy) / ms\r\n                                // ];\r\n                            }\r\n                            break;\r\n                        case "csv":\r\n                            var values = Str(params[attr])[split](separator),\r\n                                from2 = Str(from[attr])[split](separator);\r\n                            if (attr == "clip-rect") {\r\n                                from[attr] = from2;\r\n                                diff[attr] = [];\r\n                                i = from2.length;\r\n                                while (i--) {\r\n                                    diff[attr][i] = (values[i] - from[attr][i]) / ms;\r\n                                }\r\n                            }\r\n                            to[attr] = values;\r\n                            break;\r\n                        default:\r\n                            values = [][concat](params[attr]);\r\n                            from2 = [][concat](from[attr]);\r\n                            diff[attr] = [];\r\n                            i = element.paper.customAttributes[attr].length;\r\n                            while (i--) {\r\n                                diff[attr][i] = ((values[i] || 0) - (from2[i] || 0)) / ms;\r\n                            }\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n            var easing = params.easing,\r\n                easyeasy = R.easing_formulas[easing];\r\n            if (!easyeasy) {\r\n                easyeasy = Str(easing).match(bezierrg);\r\n                if (easyeasy && easyeasy.length == 5) {\r\n                    var curve = easyeasy;\r\n                    easyeasy = function (t) {\r\n                        return CubicBezierAtTime(t, +curve[1], +curve[2], +curve[3], +curve[4], ms);\r\n                    };\r\n                } else {\r\n                    easyeasy = pipe;\r\n                }\r\n            }\r\n            timestamp = params.start || anim.start || +new Date;\r\n            e = {\r\n                anim: anim,\r\n                percent: percent,\r\n                timestamp: timestamp,\r\n                start: timestamp + (anim.del || 0),\r\n                status: 0,\r\n                initstatus: status || 0,\r\n                stop: false,\r\n                ms: ms,\r\n                easing: easyeasy,\r\n                from: from,\r\n                diff: diff,\r\n                to: to,\r\n                el: element,\r\n                callback: params.callback,\r\n                prev: prev,\r\n                next: next,\r\n                repeat: times || anim.times,\r\n                origin: element.attr(),\r\n                totalOrigin: totalOrigin\r\n            };\r\n            animationElements.push(e);\r\n            if (status && !isInAnim && !isInAnimSet) {\r\n                e.stop = true;\r\n                e.start = new Date - ms * status;\r\n                if (animationElements.length == 1) {\r\n                    return animation();\r\n                }\r\n            }\r\n            if (isInAnimSet) {\r\n                e.start = new Date - e.ms * status;\r\n            }\r\n            animationElements.length == 1 && requestAnimFrame(animation);\r\n        } else {\r\n            isInAnim.initstatus = status;\r\n            isInAnim.start = new Date - isInAnim.ms * status;\r\n        }\r\n        eve("raphael.anim.start." + element.id, element, anim);\r\n    }\r\n    /*\\\r\n     * Raphael.animation\r\n     [ method ]\r\n     **\r\n     * Creates an animation object that can be passed to the @Element.animate or @Element.animateWith methods.\r\n     * See also @Animation.delay and @Animation.repeat methods.\r\n     **\r\n     > Parameters\r\n     **\r\n     - params (object) final attributes for the element, see also @Element.attr\r\n     - ms (number) number of milliseconds for animation to run\r\n     - easing (string) #optional easing type. Accept one of @Raphael.easing_formulas or CSS format: `cubic&#x2010;bezier(XX,&#160;XX,&#160;XX,&#160;XX)`\r\n     - callback (function) #optional callback function. Will be called at the end of animation.\r\n     **\r\n     = (object) @Animation\r\n     \\*/\r\n    R.animation = function (params, ms, easing, callback) {\r\n        if (params instanceof Animation) {\r\n            return params;\r\n        }\r\n        if (R.is(easing, "function") || !easing) {\r\n            callback = callback || easing || null;\r\n            easing = null;\r\n        }\r\n        params = Object(params);\r\n        ms = +ms || 0;\r\n        var p = {},\r\n            json,\r\n            attr;\r\n        for (attr in params) if (params[has](attr) && toFloat(attr) != attr && toFloat(attr) + "%" != attr) {\r\n            json = true;\r\n            p[attr] = params[attr];\r\n        }\r\n        if (!json) {\r\n            // if percent-like syntax is used and end-of-all animation callback used\r\n            if(callback){\r\n                // find the last one\r\n                var lastKey = 0;\r\n                for(var i in params){\r\n                    var percent = toInt(i);\r\n                    if(params[has](i) && percent > lastKey){\r\n                        lastKey = percent;\r\n                    }\r\n                }\r\n                lastKey += \'%\';\r\n                // if already defined callback in the last keyframe, skip\r\n                !params[lastKey].callback && (params[lastKey].callback = callback);\r\n            }\r\n            return new Animation(params, ms);\r\n        } else {\r\n            easing && (p.easing = easing);\r\n            callback && (p.callback = callback);\r\n            return new Animation({100: p}, ms);\r\n        }\r\n    };\r\n    /*\\\r\n     * Element.animate\r\n     [ method ]\r\n     **\r\n     * Creates and starts animation for given element.\r\n     **\r\n     > Parameters\r\n     **\r\n     - params (object) final attributes for the element, see also @Element.attr\r\n     - ms (number) number of milliseconds for animation to run\r\n     - easing (string) #optional easing type. Accept one of @Raphael.easing_formulas or CSS format: `cubic&#x2010;bezier(XX,&#160;XX,&#160;XX,&#160;XX)`\r\n     - callback (function) #optional callback function. Will be called at the end of animation.\r\n     * or\r\n     - animation (object) animation object, see @Raphael.animation\r\n     **\r\n     = (object) original element\r\n     \\*/\r\n    elproto.animate = function (params, ms, easing, callback) {\r\n        var element = this;\r\n        if (element.removed) {\r\n            callback && callback.call(element);\r\n            return element;\r\n        }\r\n        var anim = params instanceof Animation ? params : R.animation(params, ms, easing, callback);\r\n        runAnimation(anim, element, anim.percents[0], null, element.attr());\r\n        return element;\r\n    };\r\n    /*\\\r\n     * Element.setTime\r\n     [ method ]\r\n     **\r\n     * Sets the status of animation of the element in milliseconds. Similar to @Element.status method.\r\n     **\r\n     > Parameters\r\n     **\r\n     - anim (object) animation object\r\n     - value (number) number of milliseconds from the beginning of the animation\r\n     **\r\n     = (object) original element if `value` is specified\r\n     * Note, that during animation following events are triggered:\r\n     *\r\n     * On each animation frame event `anim.frame.<id>`, on start `anim.start.<id>` and on end `anim.finish.<id>`.\r\n     \\*/\r\n    elproto.setTime = function (anim, value) {\r\n        if (anim && value != null) {\r\n            this.status(anim, mmin(value, anim.ms) / anim.ms);\r\n        }\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.status\r\n     [ method ]\r\n     **\r\n     * Gets or sets the status of animation of the element.\r\n     **\r\n     > Parameters\r\n     **\r\n     - anim (object) #optional animation object\r\n     - value (number) #optional 0 – 1. If specified, method works like a setter and sets the status of a given animation to the value. This will cause animation to jump to the given position.\r\n     **\r\n     = (number) status\r\n     * or\r\n     = (array) status if `anim` is not specified. Array of objects in format:\r\n     o {\r\n     o     anim: (object) animation object\r\n     o     status: (number) status\r\n     o }\r\n     * or\r\n     = (object) original element if `value` is specified\r\n     \\*/\r\n    elproto.status = function (anim, value) {\r\n        var out = [],\r\n            i = 0,\r\n            len,\r\n            e;\r\n        if (value != null) {\r\n            runAnimation(anim, this, -1, mmin(value, 1));\r\n            return this;\r\n        } else {\r\n            len = animationElements.length;\r\n            for (; i < len; i++) {\r\n                e = animationElements[i];\r\n                if (e.el.id == this.id && (!anim || e.anim == anim)) {\r\n                    if (anim) {\r\n                        return e.status;\r\n                    }\r\n                    out.push({\r\n                        anim: e.anim,\r\n                        status: e.status\r\n                    });\r\n                }\r\n            }\r\n            if (anim) {\r\n                return 0;\r\n            }\r\n            return out;\r\n        }\r\n    };\r\n    /*\\\r\n     * Element.pause\r\n     [ method ]\r\n     **\r\n     * Stops animation of the element with ability to resume it later on.\r\n     **\r\n     > Parameters\r\n     **\r\n     - anim (object) #optional animation object\r\n     **\r\n     = (object) original element\r\n     \\*/\r\n    elproto.pause = function (anim) {\r\n        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.id == this.id && (!anim || animationElements[i].anim == anim)) {\r\n            if (eve("raphael.anim.pause." + this.id, this, animationElements[i].anim) !== false) {\r\n                animationElements[i].paused = true;\r\n            }\r\n        }\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.resume\r\n     [ method ]\r\n     **\r\n     * Resumes animation if it was paused with @Element.pause method.\r\n     **\r\n     > Parameters\r\n     **\r\n     - anim (object) #optional animation object\r\n     **\r\n     = (object) original element\r\n     \\*/\r\n    elproto.resume = function (anim) {\r\n        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.id == this.id && (!anim || animationElements[i].anim == anim)) {\r\n            var e = animationElements[i];\r\n            if (eve("raphael.anim.resume." + this.id, this, e.anim) !== false) {\r\n                delete e.paused;\r\n                this.status(e.anim, e.status);\r\n            }\r\n        }\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.stop\r\n     [ method ]\r\n     **\r\n     * Stops animation of the element.\r\n     **\r\n     > Parameters\r\n     **\r\n     - anim (object) #optional animation object\r\n     **\r\n     = (object) original element\r\n     \\*/\r\n    elproto.stop = function (anim) {\r\n        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.id == this.id && (!anim || animationElements[i].anim == anim)) {\r\n            if (eve("raphael.anim.stop." + this.id, this, animationElements[i].anim) !== false) {\r\n                animationElements.splice(i--, 1);\r\n            }\r\n        }\r\n        return this;\r\n    };\r\n    function stopAnimation(paper) {\r\n        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.paper == paper) {\r\n            animationElements.splice(i--, 1);\r\n        }\r\n    }\r\n    eve.on("raphael.remove", stopAnimation);\r\n    eve.on("raphael.clear", stopAnimation);\r\n    elproto.toString = function () {\r\n        return "Rapha\\xebl\\u2019s object";\r\n    };\r\n\r\n    // Set\r\n    var Set = function (items) {\r\n            this.items = [];\r\n            this.length = 0;\r\n            this.type = "set";\r\n            if (items) {\r\n                for (var i = 0, ii = items.length; i < ii; i++) {\r\n                    if (items[i] && (items[i].constructor == elproto.constructor || items[i].constructor == Set)) {\r\n                        this[this.items.length] = this.items[this.items.length] = items[i];\r\n                        this.length++;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        setproto = Set.prototype;\r\n    /*\\\r\n     * Set.push\r\n     [ method ]\r\n     **\r\n     * Adds each argument to the current set.\r\n     = (object) original element\r\n     \\*/\r\n    setproto.push = function () {\r\n        var item,\r\n            len;\r\n        for (var i = 0, ii = arguments.length; i < ii; i++) {\r\n            item = arguments[i];\r\n            if (item && (item.constructor == elproto.constructor || item.constructor == Set)) {\r\n                len = this.items.length;\r\n                this[len] = this.items[len] = item;\r\n                this.length++;\r\n            }\r\n        }\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Set.pop\r\n     [ method ]\r\n     **\r\n     * Removes last element and returns it.\r\n     = (object) element\r\n     \\*/\r\n    setproto.pop = function () {\r\n        this.length && delete this[this.length--];\r\n        return this.items.pop();\r\n    };\r\n    /*\\\r\n     * Set.forEach\r\n     [ method ]\r\n     **\r\n     * Executes given function for each element in the set.\r\n     *\r\n     * If function returns `false` it will stop loop running.\r\n     **\r\n     > Parameters\r\n     **\r\n     - callback (function) function to run\r\n     - thisArg (object) context object for the callback\r\n     = (object) Set object\r\n     \\*/\r\n    setproto.forEach = function (callback, thisArg) {\r\n        for (var i = 0, ii = this.items.length; i < ii; i++) {\r\n            if (callback.call(thisArg, this.items[i], i) === false) {\r\n                return this;\r\n            }\r\n        }\r\n        return this;\r\n    };\r\n    for (var method in elproto) if (elproto[has](method)) {\r\n        setproto[method] = (function (methodname) {\r\n            return function () {\r\n                var arg = arguments;\r\n                return this.forEach(function (el) {\r\n                    el[methodname][apply](el, arg);\r\n                });\r\n            };\r\n        })(method);\r\n    }\r\n    setproto.attr = function (name, value) {\r\n        if (name && R.is(name, array) && R.is(name[0], "object")) {\r\n            for (var j = 0, jj = name.length; j < jj; j++) {\r\n                this.items[j].attr(name[j]);\r\n            }\r\n        } else {\r\n            for (var i = 0, ii = this.items.length; i < ii; i++) {\r\n                this.items[i].attr(name, value);\r\n            }\r\n        }\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Set.clear\r\n     [ method ]\r\n     **\r\n     * Removes all elements from the set\r\n     \\*/\r\n    setproto.clear = function () {\r\n        while (this.length) {\r\n            this.pop();\r\n        }\r\n    };\r\n    /*\\\r\n     * Set.splice\r\n     [ method ]\r\n     **\r\n     * Removes given element from the set\r\n     **\r\n     > Parameters\r\n     **\r\n     - index (number) position of the deletion\r\n     - count (number) number of element to remove\r\n     - insertion… (object) #optional elements to insert\r\n     = (object) set elements that were deleted\r\n     \\*/\r\n    setproto.splice = function (index, count, insertion) {\r\n        index = index < 0 ? mmax(this.length + index, 0) : index;\r\n        count = mmax(0, mmin(this.length - index, count));\r\n        var tail = [],\r\n            todel = [],\r\n            args = [],\r\n            i;\r\n        for (i = 2; i < arguments.length; i++) {\r\n            args.push(arguments[i]);\r\n        }\r\n        for (i = 0; i < count; i++) {\r\n            todel.push(this[index + i]);\r\n        }\r\n        for (; i < this.length - index; i++) {\r\n            tail.push(this[index + i]);\r\n        }\r\n        var arglen = args.length;\r\n        for (i = 0; i < arglen + tail.length; i++) {\r\n            this.items[index + i] = this[index + i] = i < arglen ? args[i] : tail[i - arglen];\r\n        }\r\n        i = this.items.length = this.length -= count - arglen;\r\n        while (this[i]) {\r\n            delete this[i++];\r\n        }\r\n        return new Set(todel);\r\n    };\r\n    /*\\\r\n     * Set.exclude\r\n     [ method ]\r\n     **\r\n     * Removes given element from the set\r\n     **\r\n     > Parameters\r\n     **\r\n     - element (object) element to remove\r\n     = (boolean) `true` if object was found & removed from the set\r\n     \\*/\r\n    setproto.exclude = function (el) {\r\n        for (var i = 0, ii = this.length; i < ii; i++) if (this[i] == el) {\r\n            this.splice(i, 1);\r\n            return true;\r\n        }\r\n    };\r\n    setproto.animate = function (params, ms, easing, callback) {\r\n        (R.is(easing, "function") || !easing) && (callback = easing || null);\r\n        var len = this.items.length,\r\n            i = len,\r\n            item,\r\n            set = this,\r\n            collector;\r\n        if (!len) {\r\n            return this;\r\n        }\r\n        callback && (collector = function () {\r\n            !--len && callback.call(set);\r\n        });\r\n        easing = R.is(easing, string) ? easing : collector;\r\n        var anim = R.animation(params, ms, easing, collector);\r\n        item = this.items[--i].animate(anim);\r\n        while (i--) {\r\n            this.items[i] && !this.items[i].removed && this.items[i].animateWith(item, anim, anim);\r\n            (this.items[i] && !this.items[i].removed) || len--;\r\n        }\r\n        return this;\r\n    };\r\n    setproto.insertAfter = function (el) {\r\n        var i = this.items.length;\r\n        while (i--) {\r\n            this.items[i].insertAfter(el);\r\n        }\r\n        return this;\r\n    };\r\n    setproto.getBBox = function () {\r\n        var x = [],\r\n            y = [],\r\n            x2 = [],\r\n            y2 = [];\r\n        for (var i = this.items.length; i--;) if (!this.items[i].removed) {\r\n            var box = this.items[i].getBBox();\r\n            x.push(box.x);\r\n            y.push(box.y);\r\n            x2.push(box.x + box.width);\r\n            y2.push(box.y + box.height);\r\n        }\r\n        x = mmin[apply](0, x);\r\n        y = mmin[apply](0, y);\r\n        x2 = mmax[apply](0, x2);\r\n        y2 = mmax[apply](0, y2);\r\n        return {\r\n            x: x,\r\n            y: y,\r\n            x2: x2,\r\n            y2: y2,\r\n            width: x2 - x,\r\n            height: y2 - y\r\n        };\r\n    };\r\n    setproto.clone = function (s) {\r\n        s = this.paper.set();\r\n        for (var i = 0, ii = this.items.length; i < ii; i++) {\r\n            s.push(this.items[i].clone());\r\n        }\r\n        return s;\r\n    };\r\n    setproto.toString = function () {\r\n        return "Rapha\\xebl\\u2018s set";\r\n    };\r\n\r\n    setproto.glow = function(glowConfig) {\r\n        var ret = this.paper.set();\r\n        this.forEach(function(shape, index){\r\n            var g = shape.glow(glowConfig);\r\n            if(g != null){\r\n                g.forEach(function(shape2, index2){\r\n                    ret.push(shape2);\r\n                });\r\n            }\r\n        });\r\n        return ret;\r\n    };\r\n\r\n\r\n    /*\\\r\n     * Set.isPointInside\r\n     [ method ]\r\n     **\r\n     * Determine if given point is inside this set’s elements\r\n     **\r\n     > Parameters\r\n     **\r\n     - x (number) x coordinate of the point\r\n     - y (number) y coordinate of the point\r\n     = (boolean) `true` if point is inside any of the set\'s elements\r\n     \\*/\r\n    setproto.isPointInside = function (x, y) {\r\n        var isPointInside = false;\r\n        this.forEach(function (el) {\r\n            if (el.isPointInside(x, y)) {\r\n                isPointInside = true;\r\n                return false; // stop loop\r\n            }\r\n        });\r\n        return isPointInside;\r\n    };\r\n\r\n    /*\\\r\n     * Raphael.registerFont\r\n     [ method ]\r\n     **\r\n     * Adds given font to the registered set of font for Raphaël. Should be used as an internal call from within Cufón’s font file.\r\n     * Returns original parameter, so it could be used with chaining.\r\n     # <a href="http://wiki.github.com/sorccu/cufon/about">More about Cufón and how to convert your font form TTF, OTF, etc to JavaScript file.</a>\r\n     **\r\n     > Parameters\r\n     **\r\n     - font (object) the font to register\r\n     = (object) the font you passed in\r\n     > Usage\r\n     | Cufon.registerFont(Raphael.registerFont({…}));\r\n     \\*/\r\n    R.registerFont = function (font) {\r\n        if (!font.face) {\r\n            return font;\r\n        }\r\n        this.fonts = this.fonts || {};\r\n        var fontcopy = {\r\n                w: font.w,\r\n                face: {},\r\n                glyphs: {}\r\n            },\r\n            family = font.face["font-family"];\r\n        for (var prop in font.face) if (font.face[has](prop)) {\r\n            fontcopy.face[prop] = font.face[prop];\r\n        }\r\n        if (this.fonts[family]) {\r\n            this.fonts[family].push(fontcopy);\r\n        } else {\r\n            this.fonts[family] = [fontcopy];\r\n        }\r\n        if (!font.svg) {\r\n            fontcopy.face["units-per-em"] = toInt(font.face["units-per-em"], 10);\r\n            for (var glyph in font.glyphs) if (font.glyphs[has](glyph)) {\r\n                var path = font.glyphs[glyph];\r\n                fontcopy.glyphs[glyph] = {\r\n                    w: path.w,\r\n                    k: {},\r\n                    d: path.d && "M" + path.d.replace(/[mlcxtrv]/g, function (command) {\r\n                        return {l: "L", c: "C", x: "z", t: "m", r: "l", v: "c"}[command] || "M";\r\n                    }) + "z"\r\n                };\r\n                if (path.k) {\r\n                    for (var k in path.k) if (path[has](k)) {\r\n                        fontcopy.glyphs[glyph].k[k] = path.k[k];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return font;\r\n    };\r\n    /*\\\r\n     * Paper.getFont\r\n     [ method ]\r\n     **\r\n     * Finds font object in the registered font by given parameters. You could specify only one word from the font name, like “Myriad” for “Myriad Pro”.\r\n     **\r\n     > Parameters\r\n     **\r\n     - family (string) font family name or any word from it\r\n     - weight (string) #optional font weight\r\n     - style (string) #optional font style\r\n     - stretch (string) #optional font stretch\r\n     = (object) the font object\r\n     > Usage\r\n     | paper.print(100, 100, "Test string", paper.getFont("Times", 800), 30);\r\n     \\*/\r\n    paperproto.getFont = function (family, weight, style, stretch) {\r\n        stretch = stretch || "normal";\r\n        style = style || "normal";\r\n        weight = +weight || {normal: 400, bold: 700, lighter: 300, bolder: 800}[weight] || 400;\r\n        if (!R.fonts) {\r\n            return;\r\n        }\r\n        var font = R.fonts[family];\r\n        if (!font) {\r\n            var name = new RegExp("(^|\\\\s)" + family.replace(/[^\\w\\d\\s+!~.:_-]/g, E) + "(\\\\s|$)", "i");\r\n            for (var fontName in R.fonts) if (R.fonts[has](fontName)) {\r\n                if (name.test(fontName)) {\r\n                    font = R.fonts[fontName];\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        var thefont;\r\n        if (font) {\r\n            for (var i = 0, ii = font.length; i < ii; i++) {\r\n                thefont = font[i];\r\n                if (thefont.face["font-weight"] == weight && (thefont.face["font-style"] == style || !thefont.face["font-style"]) && thefont.face["font-stretch"] == stretch) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return thefont;\r\n    };\r\n    /*\\\r\n     * Paper.print\r\n     [ method ]\r\n     **\r\n     * Creates path that represent given text written using given font at given position with given size.\r\n     * Result of the method is path element that contains whole text as a separate path.\r\n     **\r\n     > Parameters\r\n     **\r\n     - x (number) x position of the text\r\n     - y (number) y position of the text\r\n     - string (string) text to print\r\n     - font (object) font object, see @Paper.getFont\r\n     - size (number) #optional size of the font, default is `16`\r\n     - origin (string) #optional could be `"baseline"` or `"middle"`, default is `"middle"`\r\n     - letter_spacing (number) #optional number in range `-1..1`, default is `0`\r\n     - line_spacing (number) #optional number in range `1..3`, default is `1`\r\n     = (object) resulting path element, which consist of all letters\r\n     > Usage\r\n     | var txt = r.print(10, 50, "print", r.getFont("Museo"), 30).attr({fill: "#fff"});\r\n     \\*/\r\n    paperproto.print = function (x, y, string, font, size, origin, letter_spacing, line_spacing) {\r\n        origin = origin || "middle"; // baseline|middle\r\n        letter_spacing = mmax(mmin(letter_spacing || 0, 1), -1);\r\n        line_spacing = mmax(mmin(line_spacing || 1, 3), 1);\r\n        var letters = Str(string)[split](E),\r\n            shift = 0,\r\n            notfirst = 0,\r\n            path = E,\r\n            scale;\r\n        R.is(font, "string") && (font = this.getFont(font));\r\n        if (font) {\r\n            scale = (size || 16) / font.face["units-per-em"];\r\n            var bb = font.face.bbox[split](separator),\r\n                top = +bb[0],\r\n                lineHeight = bb[3] - bb[1],\r\n                shifty = 0,\r\n                height = +bb[1] + (origin == "baseline" ? lineHeight + (+font.face.descent) : lineHeight / 2);\r\n            for (var i = 0, ii = letters.length; i < ii; i++) {\r\n                if (letters[i] == "\\n") {\r\n                    shift = 0;\r\n                    curr = 0;\r\n                    notfirst = 0;\r\n                    shifty += lineHeight * line_spacing;\r\n                } else {\r\n                    var prev = notfirst && font.glyphs[letters[i - 1]] || {},\r\n                        curr = font.glyphs[letters[i]];\r\n                    shift += notfirst ? (prev.w || font.w) + (prev.k && prev.k[letters[i]] || 0) + (font.w * letter_spacing) : 0;\r\n                    notfirst = 1;\r\n                }\r\n                if (curr && curr.d) {\r\n                    path += R.transformPath(curr.d, ["t", shift * scale, shifty * scale, "s", scale, scale, top, height, "t", (x - top) / scale, (y - height) / scale]);\r\n                }\r\n            }\r\n        }\r\n        return this.path(path).attr({\r\n            fill: "#000",\r\n            stroke: "none"\r\n        });\r\n    };\r\n\r\n    /*\\\r\n     * Paper.add\r\n     [ method ]\r\n     **\r\n     * Imports elements in JSON array in format `{type: type, <attributes>}`\r\n     **\r\n     > Parameters\r\n     **\r\n     - json (array)\r\n     = (object) resulting set of imported elements\r\n     > Usage\r\n     | paper.add([\r\n     |     {\r\n     |         type: "circle",\r\n     |         cx: 10,\r\n     |         cy: 10,\r\n     |         r: 5\r\n     |     },\r\n     |     {\r\n     |         type: "rect",\r\n     |         x: 10,\r\n     |         y: 10,\r\n     |         width: 10,\r\n     |         height: 10,\r\n     |         fill: "#fc0"\r\n     |     }\r\n     | ]);\r\n     \\*/\r\n    paperproto.add = function (json) {\r\n        if (R.is(json, "array")) {\r\n            var res = this.set(),\r\n                i = 0,\r\n                ii = json.length,\r\n                j;\r\n            for (; i < ii; i++) {\r\n                j = json[i] || {};\r\n                elements[has](j.type) && res.push(this[j.type]().attr(j));\r\n            }\r\n        }\r\n        return res;\r\n    };\r\n\r\n    /*\\\r\n     * Raphael.format\r\n     [ method ]\r\n     **\r\n     * Simple format function. Replaces construction of type “`{<number>}`” to the corresponding argument.\r\n     **\r\n     > Parameters\r\n     **\r\n     - token (string) string to format\r\n     - … (string) rest of arguments will be treated as parameters for replacement\r\n     = (string) formated string\r\n     > Usage\r\n     | var x = 10,\r\n     |     y = 20,\r\n     |     width = 40,\r\n     |     height = 50;\r\n     | // this will draw a rectangular shape equivalent to "M10,20h40v50h-40z"\r\n     | paper.path(Raphael.format("M{0},{1}h{2}v{3}h{4}z", x, y, width, height, -width));\r\n     \\*/\r\n    R.format = function (token, params) {\r\n        var args = R.is(params, array) ? [0][concat](params) : arguments;\r\n        token && R.is(token, string) && args.length - 1 && (token = token.replace(formatrg, function (str, i) {\r\n            return args[++i] == null ? E : args[i];\r\n        }));\r\n        return token || E;\r\n    };\r\n    /*\\\r\n     * Raphael.fullfill\r\n     [ method ]\r\n     **\r\n     * A little bit more advanced format function than @Raphael.format. Replaces construction of type “`{<name>}`” to the corresponding argument.\r\n     **\r\n     > Parameters\r\n     **\r\n     - token (string) string to format\r\n     - json (object) object which properties will be used as a replacement\r\n     = (string) formated string\r\n     > Usage\r\n     | // this will draw a rectangular shape equivalent to "M10,20h40v50h-40z"\r\n     | paper.path(Raphael.fullfill("M{x},{y}h{dim.width}v{dim.height}h{dim[\'negative width\']}z", {\r\n     |     x: 10,\r\n     |     y: 20,\r\n     |     dim: {\r\n     |         width: 40,\r\n     |         height: 50,\r\n     |         "negative width": -40\r\n     |     }\r\n     | }));\r\n     \\*/\r\n    R.fullfill = (function () {\r\n        var tokenRegex = /\\{([^\\}]+)\\}/g,\r\n            objNotationRegex = /(?:(?:^|\\.)(.+?)(?=\\[|\\.|$|\\()|\\[(\'|")(.+?)\\2\\])(\\(\\))?/g, // matches .xxxxx or ["xxxxx"] to run over object properties\r\n            replacer = function (all, key, obj) {\r\n                var res = obj;\r\n                key.replace(objNotationRegex, function (all, name, quote, quotedName, isFunc) {\r\n                    name = name || quotedName;\r\n                    if (res) {\r\n                        if (name in res) {\r\n                            res = res[name];\r\n                        }\r\n                        typeof res == "function" && isFunc && (res = res());\r\n                    }\r\n                });\r\n                res = (res == null || res == obj ? all : res) + "";\r\n                return res;\r\n            };\r\n        return function (str, obj) {\r\n            return String(str).replace(tokenRegex, function (all, key) {\r\n                return replacer(all, key, obj);\r\n            });\r\n        };\r\n    })();\r\n    /*\\\r\n     * Raphael.ninja\r\n     [ method ]\r\n     **\r\n     * If you want to leave no trace of Raphaël (Well, Raphaël creates only one global variable `Raphael`, but anyway.) You can use `ninja` method.\r\n     * Beware, that in this case plugins could stop working, because they are depending on global variable existence.\r\n     **\r\n     = (object) Raphael object\r\n     > Usage\r\n     | (function (local_raphael) {\r\n     |     var paper = local_raphael(10, 10, 320, 200);\r\n     |     …\r\n     | })(Raphael.ninja());\r\n     \\*/\r\n    R.ninja = function () {\r\n        oldRaphael.was ? (g.win.Raphael = oldRaphael.is) : delete Raphael;\r\n        return R;\r\n    };\r\n    /*\\\r\n     * Raphael.st\r\n     [ property (object) ]\r\n     **\r\n     * You can add your own method to elements and sets. It is wise to add a set method for each element method\r\n     * you added, so you will be able to call the same method on sets too.\r\n     **\r\n     * See also @Raphael.el.\r\n     > Usage\r\n     | Raphael.el.red = function () {\r\n     |     this.attr({fill: "#f00"});\r\n     | };\r\n     | Raphael.st.red = function () {\r\n     |     this.forEach(function (el) {\r\n     |         el.red();\r\n     |     });\r\n     | };\r\n     | // then use it\r\n     | paper.set(paper.circle(100, 100, 20), paper.circle(110, 100, 20)).red();\r\n     \\*/\r\n    R.st = setproto;\r\n\r\n    eve.on("raphael.DOMload", function () {\r\n        loaded = true;\r\n    });\r\n\r\n    // Firefox <3.6 fix: http://webreflection.blogspot.com/2009/11/195-chars-to-help-lazy-loading.html\r\n    (function (doc, loaded, f) {\r\n        if (doc.readyState == null && doc.addEventListener){\r\n            doc.addEventListener(loaded, f = function () {\r\n                doc.removeEventListener(loaded, f, false);\r\n                doc.readyState = "complete";\r\n            }, false);\r\n            doc.readyState = "loading";\r\n        }\r\n        function isLoaded() {\r\n            (/in/).test(doc.readyState) ? setTimeout(isLoaded, 9) : R.eve("raphael.DOMload");\r\n        }\r\n        isLoaded();\r\n    })(document, "DOMContentLoaded");\r\n\r\n    return R;\r\n}));\r\n\r\n// ┌─────────────────────────────────────────────────────────────────────┐ \\\\\r\n// │ Raphaël 2.1.4 - JavaScript Vector Library                       │ \\\\\r\n// ├─────────────────────────────────────────────────────────────────────┤ \\\\\r\n// │ SVG Module                                                          │ \\\\\r\n// ├─────────────────────────────────────────────────────────────────────┤ \\\\\r\n// │ Copyright (c) 2008-2011 Dmitry Baranovskiy (http://raphaeljs.com)   │ \\\\\r\n// │ Copyright (c) 2008-2011 Sencha Labs (http://sencha.com)             │ \\\\\r\n// │ Licensed under the MIT (http://raphaeljs.com/license.html) license. │ \\\\\r\n// └─────────────────────────────────────────────────────────────────────┘ \\\\\r\n\r\n(function (glob, factory) {\r\n    if (typeof define === "function" && define.amd) {\r\n        define("raphael.svg", ["raphael.core"], function(raphael) {\r\n            return factory(raphael);\r\n        });\r\n    } else if (typeof exports === "object") {\r\n        factory(require("raphael.core"));\r\n    } else {\r\n        factory(glob.Raphael);\r\n    }\r\n}(this, function(R) {\r\n    if (R && !R.svg) {\r\n        return;\r\n    }\r\n\r\n    var has = "hasOwnProperty",\r\n        Str = String,\r\n        toFloat = parseFloat,\r\n        toInt = parseInt,\r\n        math = Math,\r\n        mmax = math.max,\r\n        abs = math.abs,\r\n        pow = math.pow,\r\n        separator = /[, ]+/,\r\n        eve = R.eve,\r\n        E = "",\r\n        S = " ";\r\n    var xlink = "http://www.w3.org/1999/xlink",\r\n        markers = {\r\n            block: "M5,0 0,2.5 5,5z",\r\n            classic: "M5,0 0,2.5 5,5 3.5,3 3.5,2z",\r\n            diamond: "M2.5,0 5,2.5 2.5,5 0,2.5z",\r\n            open: "M6,1 1,3.5 6,6",\r\n            oval: "M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"\r\n        },\r\n        markerCounter = {};\r\n    R.toString = function () {\r\n        return  "Your browser supports SVG.\\nYou are running Rapha\\xebl " + this.version;\r\n    };\r\n    var $ = function (el, attr) {\r\n            if (attr) {\r\n                if (typeof el == "string") {\r\n                    el = $(el);\r\n                }\r\n                for (var key in attr) if (attr[has](key)) {\r\n                    if (key.substring(0, 6) == "xlink:") {\r\n                        el.setAttributeNS(xlink, key.substring(6), Str(attr[key]));\r\n                    } else {\r\n                        el.setAttribute(key, Str(attr[key]));\r\n                    }\r\n                }\r\n            } else {\r\n                el = R._g.doc.createElementNS("http://www.w3.org/2000/svg", el);\r\n                el.style && (el.style.webkitTapHighlightColor = "rgba(0,0,0,0)");\r\n            }\r\n            return el;\r\n        },\r\n        addGradientFill = function (element, gradient) {\r\n            var type = "linear",\r\n                id = element.id + gradient,\r\n                fx = .5, fy = .5,\r\n                o = element.node,\r\n                SVG = element.paper,\r\n                s = o.style,\r\n                el = R._g.doc.getElementById(id);\r\n            if (!el) {\r\n                gradient = Str(gradient).replace(R._radial_gradient, function (all, _fx, _fy) {\r\n                    type = "radial";\r\n                    if (_fx && _fy) {\r\n                        fx = toFloat(_fx);\r\n                        fy = toFloat(_fy);\r\n                        var dir = ((fy > .5) * 2 - 1);\r\n                        pow(fx - .5, 2) + pow(fy - .5, 2) > .25 &&\r\n                        (fy = math.sqrt(.25 - pow(fx - .5, 2)) * dir + .5) &&\r\n                        fy != .5 &&\r\n                        (fy = fy.toFixed(5) - 1e-5 * dir);\r\n                    }\r\n                    return E;\r\n                });\r\n                gradient = gradient.split(/\\s*\\-\\s*/);\r\n                if (type == "linear") {\r\n                    var angle = gradient.shift();\r\n                    angle = -toFloat(angle);\r\n                    if (isNaN(angle)) {\r\n                        return null;\r\n                    }\r\n                    var vector = [0, 0, math.cos(R.rad(angle)), math.sin(R.rad(angle))],\r\n                        max = 1 / (mmax(abs(vector[2]), abs(vector[3])) || 1);\r\n                    vector[2] *= max;\r\n                    vector[3] *= max;\r\n                    if (vector[2] < 0) {\r\n                        vector[0] = -vector[2];\r\n                        vector[2] = 0;\r\n                    }\r\n                    if (vector[3] < 0) {\r\n                        vector[1] = -vector[3];\r\n                        vector[3] = 0;\r\n                    }\r\n                }\r\n                var dots = R._parseDots(gradient);\r\n                if (!dots) {\r\n                    return null;\r\n                }\r\n                id = id.replace(/[\\(\\)\\s,\\xb0#]/g, "_");\r\n\r\n                if (element.gradient && id != element.gradient.id) {\r\n                    SVG.defs.removeChild(element.gradient);\r\n                    delete element.gradient;\r\n                }\r\n\r\n                if (!element.gradient) {\r\n                    el = $(type + "Gradient", {id: id});\r\n                    element.gradient = el;\r\n                    $(el, type == "radial" ? {\r\n                        fx: fx,\r\n                        fy: fy\r\n                    } : {\r\n                        x1: vector[0],\r\n                        y1: vector[1],\r\n                        x2: vector[2],\r\n                        y2: vector[3],\r\n                        gradientTransform: element.matrix.invert()\r\n                    });\r\n                    SVG.defs.appendChild(el);\r\n                    for (var i = 0, ii = dots.length; i < ii; i++) {\r\n                        el.appendChild($("stop", {\r\n                            offset: dots[i].offset ? dots[i].offset : i ? "100%" : "0%",\r\n                            "stop-color": dots[i].color || "#fff",\r\n                            "stop-opacity": isFinite(dots[i].opacity) ? dots[i].opacity : 1\r\n                        }));\r\n                    }\r\n                }\r\n            }\r\n            $(o, {\r\n                fill: "url(\'" + document.location.origin + document.location.pathname + "#" + id + "\')",\r\n                opacity: 1,\r\n                "fill-opacity": 1\r\n            });\r\n            s.fill = E;\r\n            s.opacity = 1;\r\n            s.fillOpacity = 1;\r\n            return 1;\r\n        },\r\n        updatePosition = function (o) {\r\n            var bbox = o.getBBox(1);\r\n            $(o.pattern, {patternTransform: o.matrix.invert() + " translate(" + bbox.x + "," + bbox.y + ")"});\r\n        },\r\n        addArrow = function (o, value, isEnd) {\r\n            if (o.type == "path") {\r\n                var values = Str(value).toLowerCase().split("-"),\r\n                    p = o.paper,\r\n                    se = isEnd ? "end" : "start",\r\n                    node = o.node,\r\n                    attrs = o.attrs,\r\n                    stroke = attrs["stroke-width"],\r\n                    i = values.length,\r\n                    type = "classic",\r\n                    from,\r\n                    to,\r\n                    dx,\r\n                    refX,\r\n                    attr,\r\n                    w = 3,\r\n                    h = 3,\r\n                    t = 5;\r\n                while (i--) {\r\n                    switch (values[i]) {\r\n                        case "block":\r\n                        case "classic":\r\n                        case "oval":\r\n                        case "diamond":\r\n                        case "open":\r\n                        case "none":\r\n                            type = values[i];\r\n                            break;\r\n                        case "wide": h = 5; break;\r\n                        case "narrow": h = 2; break;\r\n                        case "long": w = 5; break;\r\n                        case "short": w = 2; break;\r\n                    }\r\n                }\r\n                if (type == "open") {\r\n                    w += 2;\r\n                    h += 2;\r\n                    t += 2;\r\n                    dx = 1;\r\n                    refX = isEnd ? 4 : 1;\r\n                    attr = {\r\n                        fill: "none",\r\n                        stroke: attrs.stroke\r\n                    };\r\n                } else {\r\n                    refX = dx = w / 2;\r\n                    attr = {\r\n                        fill: attrs.stroke,\r\n                        stroke: "none"\r\n                    };\r\n                }\r\n                if (o._.arrows) {\r\n                    if (isEnd) {\r\n                        o._.arrows.endPath && markerCounter[o._.arrows.endPath]--;\r\n                        o._.arrows.endMarker && markerCounter[o._.arrows.endMarker]--;\r\n                    } else {\r\n                        o._.arrows.startPath && markerCounter[o._.arrows.startPath]--;\r\n                        o._.arrows.startMarker && markerCounter[o._.arrows.startMarker]--;\r\n                    }\r\n                } else {\r\n                    o._.arrows = {};\r\n                }\r\n                if (type != "none") {\r\n                    var pathId = "raphael-marker-" + type,\r\n                        markerId = "raphael-marker-" + se + type + w + h + "-obj" + o.id;\r\n                    if (!R._g.doc.getElementById(pathId)) {\r\n                        p.defs.appendChild($($("path"), {\r\n                            "stroke-linecap": "round",\r\n                            d: markers[type],\r\n                            id: pathId\r\n                        }));\r\n                        markerCounter[pathId] = 1;\r\n                    } else {\r\n                        markerCounter[pathId]++;\r\n                    }\r\n                    var marker = R._g.doc.getElementById(markerId),\r\n                        use;\r\n                    if (!marker) {\r\n                        marker = $($("marker"), {\r\n                            id: markerId,\r\n                            markerHeight: h,\r\n                            markerWidth: w,\r\n                            orient: "auto",\r\n                            refX: refX,\r\n                            refY: h / 2\r\n                        });\r\n                        use = $($("use"), {\r\n                            "xlink:href": "#" + pathId,\r\n                            transform: (isEnd ? "rotate(180 " + w / 2 + " " + h / 2 + ") " : E) + "scale(" + w / t + "," + h / t + ")",\r\n                            "stroke-width": (1 / ((w / t + h / t) / 2)).toFixed(4)\r\n                        });\r\n                        marker.appendChild(use);\r\n                        p.defs.appendChild(marker);\r\n                        markerCounter[markerId] = 1;\r\n                    } else {\r\n                        markerCounter[markerId]++;\r\n                        use = marker.getElementsByTagName("use")[0];\r\n                    }\r\n                    $(use, attr);\r\n                    var delta = dx * (type != "diamond" && type != "oval");\r\n                    if (isEnd) {\r\n                        from = o._.arrows.startdx * stroke || 0;\r\n                        to = R.getTotalLength(attrs.path) - delta * stroke;\r\n                    } else {\r\n                        from = delta * stroke;\r\n                        to = R.getTotalLength(attrs.path) - (o._.arrows.enddx * stroke || 0);\r\n                    }\r\n                    attr = {};\r\n                    attr["marker-" + se] = "url(#" + markerId + ")";\r\n                    if (to || from) {\r\n                        attr.d = R.getSubpath(attrs.path, from, to);\r\n                    }\r\n                    $(node, attr);\r\n                    o._.arrows[se + "Path"] = pathId;\r\n                    o._.arrows[se + "Marker"] = markerId;\r\n                    o._.arrows[se + "dx"] = delta;\r\n                    o._.arrows[se + "Type"] = type;\r\n                    o._.arrows[se + "String"] = value;\r\n                } else {\r\n                    if (isEnd) {\r\n                        from = o._.arrows.startdx * stroke || 0;\r\n                        to = R.getTotalLength(attrs.path) - from;\r\n                    } else {\r\n                        from = 0;\r\n                        to = R.getTotalLength(attrs.path) - (o._.arrows.enddx * stroke || 0);\r\n                    }\r\n                    o._.arrows[se + "Path"] && $(node, {d: R.getSubpath(attrs.path, from, to)});\r\n                    delete o._.arrows[se + "Path"];\r\n                    delete o._.arrows[se + "Marker"];\r\n                    delete o._.arrows[se + "dx"];\r\n                    delete o._.arrows[se + "Type"];\r\n                    delete o._.arrows[se + "String"];\r\n                }\r\n                for (attr in markerCounter) if (markerCounter[has](attr) && !markerCounter[attr]) {\r\n                    var item = R._g.doc.getElementById(attr);\r\n                    item && item.parentNode.removeChild(item);\r\n                }\r\n            }\r\n        },\r\n        dasharray = {\r\n            "-": [3, 1],\r\n            ".": [1, 1],\r\n            "-.": [3, 1, 1, 1],\r\n            "-..": [3, 1, 1, 1, 1, 1],\r\n            ". ": [1, 3],\r\n            "- ": [4, 3],\r\n            "--": [8, 3],\r\n            "- .": [4, 3, 1, 3],\r\n            "--.": [8, 3, 1, 3],\r\n            "--..": [8, 3, 1, 3, 1, 3]\r\n        },\r\n        addDashes = function (o, value, params) {\r\n            value = dasharray[Str(value).toLowerCase()];\r\n            if (value) {\r\n                var width = o.attrs["stroke-width"] || "1",\r\n                    butt = {round: width, square: width, butt: 0}[o.attrs["stroke-linecap"] || params["stroke-linecap"]] || 0,\r\n                    dashes = [],\r\n                    i = value.length;\r\n                while (i--) {\r\n                    dashes[i] = value[i] * width + ((i % 2) ? 1 : -1) * butt;\r\n                }\r\n                $(o.node, {"stroke-dasharray": dashes.join(",")});\r\n            }\r\n            else {\r\n                $(o.node, {"stroke-dasharray": "none"});\r\n            }\r\n        },\r\n        setFillAndStroke = function (o, params) {\r\n            var node = o.node,\r\n                attrs = o.attrs,\r\n                vis = node.style.visibility;\r\n            node.style.visibility = "hidden";\r\n            for (var att in params) {\r\n                if (params[has](att)) {\r\n                    if (!R._availableAttrs[has](att)) {\r\n                        continue;\r\n                    }\r\n                    var value = params[att];\r\n                    attrs[att] = value;\r\n                    switch (att) {\r\n                        case "blur":\r\n                            o.blur(value);\r\n                            break;\r\n                        case "title":\r\n                            var title = node.getElementsByTagName("title");\r\n\r\n                            // Use the existing <title>.\r\n                            if (title.length && (title = title[0])) {\r\n                                title.firstChild.nodeValue = value;\r\n                            } else {\r\n                                title = $("title");\r\n                                var val = R._g.doc.createTextNode(value);\r\n                                title.appendChild(val);\r\n                                node.appendChild(title);\r\n                            }\r\n                            break;\r\n                        case "href":\r\n                        case "target":\r\n                            var pn = node.parentNode;\r\n                            if (pn.tagName.toLowerCase() != "a") {\r\n                                var hl = $("a");\r\n                                pn.insertBefore(hl, node);\r\n                                hl.appendChild(node);\r\n                                pn = hl;\r\n                            }\r\n                            if (att == "target") {\r\n                                pn.setAttributeNS(xlink, "show", value == "blank" ? "new" : value);\r\n                            } else {\r\n                                pn.setAttributeNS(xlink, att, value);\r\n                            }\r\n                            break;\r\n                        case "cursor":\r\n                            node.style.cursor = value;\r\n                            break;\r\n                        case "transform":\r\n                            o.transform(value);\r\n                            break;\r\n                        case "arrow-start":\r\n                            addArrow(o, value);\r\n                            break;\r\n                        case "arrow-end":\r\n                            addArrow(o, value, 1);\r\n                            break;\r\n                        case "clip-rect":\r\n                            var rect = Str(value).split(separator);\r\n                            if (rect.length == 4) {\r\n                                o.clip && o.clip.parentNode.parentNode.removeChild(o.clip.parentNode);\r\n                                var el = $("clipPath"),\r\n                                    rc = $("rect");\r\n                                el.id = R.createUUID();\r\n                                $(rc, {\r\n                                    x: rect[0],\r\n                                    y: rect[1],\r\n                                    width: rect[2],\r\n                                    height: rect[3]\r\n                                });\r\n                                el.appendChild(rc);\r\n                                o.paper.defs.appendChild(el);\r\n                                $(node, {"clip-path": "url(#" + el.id + ")"});\r\n                                o.clip = rc;\r\n                            }\r\n                            if (!value) {\r\n                                var path = node.getAttribute("clip-path");\r\n                                if (path) {\r\n                                    var clip = R._g.doc.getElementById(path.replace(/(^url\\(#|\\)$)/g, E));\r\n                                    clip && clip.parentNode.removeChild(clip);\r\n                                    $(node, {"clip-path": E});\r\n                                    delete o.clip;\r\n                                }\r\n                            }\r\n                            break;\r\n                        case "path":\r\n                            if (o.type == "path") {\r\n                                $(node, {d: value ? attrs.path = R._pathToAbsolute(value) : "M0,0"});\r\n                                o._.dirty = 1;\r\n                                if (o._.arrows) {\r\n                                    "startString" in o._.arrows && addArrow(o, o._.arrows.startString);\r\n                                    "endString" in o._.arrows && addArrow(o, o._.arrows.endString, 1);\r\n                                }\r\n                            }\r\n                            break;\r\n                        case "width":\r\n                            node.setAttribute(att, value);\r\n                            o._.dirty = 1;\r\n                            if (attrs.fx) {\r\n                                att = "x";\r\n                                value = attrs.x;\r\n                            } else {\r\n                                break;\r\n                            }\r\n                        case "x":\r\n                            if (attrs.fx) {\r\n                                value = -attrs.x - (attrs.width || 0);\r\n                            }\r\n                        case "rx":\r\n                            if (att == "rx" && o.type == "rect") {\r\n                                break;\r\n                            }\r\n                        case "cx":\r\n                            node.setAttribute(att, value);\r\n                            o.pattern && updatePosition(o);\r\n                            o._.dirty = 1;\r\n                            break;\r\n                        case "height":\r\n                            node.setAttribute(att, value);\r\n                            o._.dirty = 1;\r\n                            if (attrs.fy) {\r\n                                att = "y";\r\n                                value = attrs.y;\r\n                            } else {\r\n                                break;\r\n                            }\r\n                        case "y":\r\n                            if (attrs.fy) {\r\n                                value = -attrs.y - (attrs.height || 0);\r\n                            }\r\n                        case "ry":\r\n                            if (att == "ry" && o.type == "rect") {\r\n                                break;\r\n                            }\r\n                        case "cy":\r\n                            node.setAttribute(att, value);\r\n                            o.pattern && updatePosition(o);\r\n                            o._.dirty = 1;\r\n                            break;\r\n                        case "r":\r\n                            if (o.type == "rect") {\r\n                                $(node, {rx: value, ry: value});\r\n                            } else {\r\n                                node.setAttribute(att, value);\r\n                            }\r\n                            o._.dirty = 1;\r\n                            break;\r\n                        case "src":\r\n                            if (o.type == "image") {\r\n                                node.setAttributeNS(xlink, "href", value);\r\n                            }\r\n                            break;\r\n                        case "stroke-width":\r\n                            if (o._.sx != 1 || o._.sy != 1) {\r\n                                value /= mmax(abs(o._.sx), abs(o._.sy)) || 1;\r\n                            }\r\n                            node.setAttribute(att, value);\r\n                            if (attrs["stroke-dasharray"]) {\r\n                                addDashes(o, attrs["stroke-dasharray"], params);\r\n                            }\r\n                            if (o._.arrows) {\r\n                                "startString" in o._.arrows && addArrow(o, o._.arrows.startString);\r\n                                "endString" in o._.arrows && addArrow(o, o._.arrows.endString, 1);\r\n                            }\r\n                            break;\r\n                        case "stroke-dasharray":\r\n                            addDashes(o, value, params);\r\n                            break;\r\n                        case "fill":\r\n                            var isURL = Str(value).match(R._ISURL);\r\n                            if (isURL) {\r\n                                el = $("pattern");\r\n                                var ig = $("image");\r\n                                el.id = R.createUUID();\r\n                                $(el, {x: 0, y: 0, patternUnits: "userSpaceOnUse", height: 1, width: 1});\r\n                                $(ig, {x: 0, y: 0, "xlink:href": isURL[1]});\r\n                                el.appendChild(ig);\r\n\r\n                                (function (el) {\r\n                                    R._preload(isURL[1], function () {\r\n                                        var w = this.offsetWidth,\r\n                                            h = this.offsetHeight;\r\n                                        $(el, {width: w, height: h});\r\n                                        $(ig, {width: w, height: h});\r\n                                    });\r\n                                })(el);\r\n                                o.paper.defs.appendChild(el);\r\n                                $(node, {fill: "url(#" + el.id + ")"});\r\n                                o.pattern = el;\r\n                                o.pattern && updatePosition(o);\r\n                                break;\r\n                            }\r\n                            var clr = R.getRGB(value);\r\n                            if (!clr.error) {\r\n                                delete params.gradient;\r\n                                delete attrs.gradient;\r\n                                !R.is(attrs.opacity, "undefined") &&\r\n                                R.is(params.opacity, "undefined") &&\r\n                                $(node, {opacity: attrs.opacity});\r\n                                !R.is(attrs["fill-opacity"], "undefined") &&\r\n                                R.is(params["fill-opacity"], "undefined") &&\r\n                                $(node, {"fill-opacity": attrs["fill-opacity"]});\r\n                            } else if ((o.type == "circle" || o.type == "ellipse" || Str(value).charAt() != "r") && addGradientFill(o, value)) {\r\n                                if ("opacity" in attrs || "fill-opacity" in attrs) {\r\n                                    var gradient = R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\\(#|\\)$/g, E));\r\n                                    if (gradient) {\r\n                                        var stops = gradient.getElementsByTagName("stop");\r\n                                        $(stops[stops.length - 1], {"stop-opacity": ("opacity" in attrs ? attrs.opacity : 1) * ("fill-opacity" in attrs ? attrs["fill-opacity"] : 1)});\r\n                                    }\r\n                                }\r\n                                attrs.gradient = value;\r\n                                attrs.fill = "none";\r\n                                break;\r\n                            }\r\n                            clr[has]("opacity") && $(node, {"fill-opacity": clr.opacity > 1 ? clr.opacity / 100 : clr.opacity});\r\n                        case "stroke":\r\n                            clr = R.getRGB(value);\r\n                            node.setAttribute(att, clr.hex);\r\n                            att == "stroke" && clr[has]("opacity") && $(node, {"stroke-opacity": clr.opacity > 1 ? clr.opacity / 100 : clr.opacity});\r\n                            if (att == "stroke" && o._.arrows) {\r\n                                "startString" in o._.arrows && addArrow(o, o._.arrows.startString);\r\n                                "endString" in o._.arrows && addArrow(o, o._.arrows.endString, 1);\r\n                            }\r\n                            break;\r\n                        case "gradient":\r\n                            (o.type == "circle" || o.type == "ellipse" || Str(value).charAt() != "r") && addGradientFill(o, value);\r\n                            break;\r\n                        case "opacity":\r\n                            if (attrs.gradient && !attrs[has]("stroke-opacity")) {\r\n                                $(node, {"stroke-opacity": value > 1 ? value / 100 : value});\r\n                            }\r\n                        // fall\r\n                        case "fill-opacity":\r\n                            if (attrs.gradient) {\r\n                                gradient = R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\\(#|\\)$/g, E));\r\n                                if (gradient) {\r\n                                    stops = gradient.getElementsByTagName("stop");\r\n                                    $(stops[stops.length - 1], {"stop-opacity": value});\r\n                                }\r\n                                break;\r\n                            }\r\n                        default:\r\n                            att == "font-size" && (value = toInt(value, 10) + "px");\r\n                            var cssrule = att.replace(/(\\-.)/g, function (w) {\r\n                                return w.substring(1).toUpperCase();\r\n                            });\r\n                            node.style[cssrule] = value;\r\n                            o._.dirty = 1;\r\n                            node.setAttribute(att, value);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            tuneText(o, params);\r\n            node.style.visibility = vis;\r\n        },\r\n        leading = 1.2,\r\n        tuneText = function (el, params) {\r\n            if (el.type != "text" || !(params[has]("text") || params[has]("font") || params[has]("font-size") || params[has]("x") || params[has]("y"))) {\r\n                return;\r\n            }\r\n            var a = el.attrs,\r\n                node = el.node,\r\n                fontSize = node.firstChild ? toInt(R._g.doc.defaultView.getComputedStyle(node.firstChild, E).getPropertyValue("font-size"), 10) : 10;\r\n\r\n            if (params[has]("text")) {\r\n                a.text = params.text;\r\n                while (node.firstChild) {\r\n                    node.removeChild(node.firstChild);\r\n                }\r\n                var texts = Str(params.text).split("\\n"),\r\n                    tspans = [],\r\n                    tspan;\r\n                for (var i = 0, ii = texts.length; i < ii; i++) {\r\n                    tspan = $("tspan");\r\n                    i && $(tspan, {dy: fontSize * leading, x: a.x});\r\n                    tspan.appendChild(R._g.doc.createTextNode(texts[i]));\r\n                    node.appendChild(tspan);\r\n                    tspans[i] = tspan;\r\n                }\r\n            } else {\r\n                tspans = node.getElementsByTagName("tspan");\r\n                for (i = 0, ii = tspans.length; i < ii; i++) if (i) {\r\n                    $(tspans[i], {dy: fontSize * leading, x: a.x});\r\n                } else {\r\n                    $(tspans[0], {dy: 0});\r\n                }\r\n            }\r\n            $(node, {x: a.x, y: a.y});\r\n            el._.dirty = 1;\r\n            var bb = el._getBBox(),\r\n                dif = a.y - (bb.y + bb.height / 2);\r\n            dif && R.is(dif, "finite") && $(tspans[0], {dy: dif});\r\n        },\r\n        getRealNode = function (node) {\r\n            if (node.parentNode && node.parentNode.tagName.toLowerCase() === "a") {\r\n                return node.parentNode;\r\n            } else {\r\n                return node;\r\n            }\r\n        },\r\n        Element = function (node, svg) {\r\n            var X = 0,\r\n                Y = 0;\r\n            /*\\\r\n             * Element.node\r\n             [ property (object) ]\r\n             **\r\n             * Gives you a reference to the DOM object, so you can assign event handlers or just mess around.\r\n             **\r\n             * Note: Don’t mess with it.\r\n             > Usage\r\n             | // draw a circle at coordinate 10,10 with radius of 10\r\n             | var c = paper.circle(10, 10, 10);\r\n             | c.node.onclick = function () {\r\n             |     c.attr("fill", "red");\r\n             | };\r\n             \\*/\r\n            this[0] = this.node = node;\r\n            /*\\\r\n             * Element.raphael\r\n             [ property (object) ]\r\n             **\r\n             * Internal reference to @Raphael object. In case it is not available.\r\n             > Usage\r\n             | Raphael.el.red = function () {\r\n             |     var hsb = this.paper.raphael.rgb2hsb(this.attr("fill"));\r\n             |     hsb.h = 1;\r\n             |     this.attr({fill: this.paper.raphael.hsb2rgb(hsb).hex});\r\n             | }\r\n             \\*/\r\n            node.raphael = true;\r\n            /*\\\r\n             * Element.id\r\n             [ property (number) ]\r\n             **\r\n             * Unique id of the element. Especially useful when you want to listen to events of the element,\r\n             * because all events are fired in format `<module>.<action>.<id>`. Also useful for @Paper.getById method.\r\n             \\*/\r\n            this.id = R._oid++;\r\n            node.raphaelid = this.id;\r\n            this.matrix = R.matrix();\r\n            this.realPath = null;\r\n            /*\\\r\n             * Element.paper\r\n             [ property (object) ]\r\n             **\r\n             * Internal reference to “paper” where object drawn. Mainly for use in plugins and element extensions.\r\n             > Usage\r\n             | Raphael.el.cross = function () {\r\n             |     this.attr({fill: "red"});\r\n             |     this.paper.path("M10,10L50,50M50,10L10,50")\r\n             |         .attr({stroke: "red"});\r\n             | }\r\n             \\*/\r\n            this.paper = svg;\r\n            this.attrs = this.attrs || {};\r\n            this._ = {\r\n                transform: [],\r\n                sx: 1,\r\n                sy: 1,\r\n                deg: 0,\r\n                dx: 0,\r\n                dy: 0,\r\n                dirty: 1\r\n            };\r\n            !svg.bottom && (svg.bottom = this);\r\n            /*\\\r\n             * Element.prev\r\n             [ property (object) ]\r\n             **\r\n             * Reference to the previous element in the hierarchy.\r\n             \\*/\r\n            this.prev = svg.top;\r\n            svg.top && (svg.top.next = this);\r\n            svg.top = this;\r\n            /*\\\r\n             * Element.next\r\n             [ property (object) ]\r\n             **\r\n             * Reference to the next element in the hierarchy.\r\n             \\*/\r\n            this.next = null;\r\n        },\r\n        elproto = R.el;\r\n\r\n    Element.prototype = elproto;\r\n    elproto.constructor = Element;\r\n\r\n    R._engine.path = function (pathString, SVG) {\r\n        var el = $("path");\r\n        SVG.canvas && SVG.canvas.appendChild(el);\r\n        var p = new Element(el, SVG);\r\n        p.type = "path";\r\n        setFillAndStroke(p, {\r\n            fill: "none",\r\n            stroke: "#000",\r\n            path: pathString\r\n        });\r\n        return p;\r\n    };\r\n    /*\\\r\n     * Element.rotate\r\n     [ method ]\r\n     **\r\n     * Deprecated! Use @Element.transform instead.\r\n     * Adds rotation by given angle around given point to the list of\r\n     * transformations of the element.\r\n     > Parameters\r\n     - deg (number) angle in degrees\r\n     - cx (number) #optional x coordinate of the centre of rotation\r\n     - cy (number) #optional y coordinate of the centre of rotation\r\n     * If cx & cy aren’t specified centre of the shape is used as a point of rotation.\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.rotate = function (deg, cx, cy) {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        deg = Str(deg).split(separator);\r\n        if (deg.length - 1) {\r\n            cx = toFloat(deg[1]);\r\n            cy = toFloat(deg[2]);\r\n        }\r\n        deg = toFloat(deg[0]);\r\n        (cy == null) && (cx = cy);\r\n        if (cx == null || cy == null) {\r\n            var bbox = this.getBBox(1);\r\n            cx = bbox.x + bbox.width / 2;\r\n            cy = bbox.y + bbox.height / 2;\r\n        }\r\n        this.transform(this._.transform.concat([["r", deg, cx, cy]]));\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.scale\r\n     [ method ]\r\n     **\r\n     * Deprecated! Use @Element.transform instead.\r\n     * Adds scale by given amount relative to given point to the list of\r\n     * transformations of the element.\r\n     > Parameters\r\n     - sx (number) horisontal scale amount\r\n     - sy (number) vertical scale amount\r\n     - cx (number) #optional x coordinate of the centre of scale\r\n     - cy (number) #optional y coordinate of the centre of scale\r\n     * If cx & cy aren’t specified centre of the shape is used instead.\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.scale = function (sx, sy, cx, cy) {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        sx = Str(sx).split(separator);\r\n        if (sx.length - 1) {\r\n            sy = toFloat(sx[1]);\r\n            cx = toFloat(sx[2]);\r\n            cy = toFloat(sx[3]);\r\n        }\r\n        sx = toFloat(sx[0]);\r\n        (sy == null) && (sy = sx);\r\n        (cy == null) && (cx = cy);\r\n        if (cx == null || cy == null) {\r\n            var bbox = this.getBBox(1);\r\n        }\r\n        cx = cx == null ? bbox.x + bbox.width / 2 : cx;\r\n        cy = cy == null ? bbox.y + bbox.height / 2 : cy;\r\n        this.transform(this._.transform.concat([["s", sx, sy, cx, cy]]));\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.translate\r\n     [ method ]\r\n     **\r\n     * Deprecated! Use @Element.transform instead.\r\n     * Adds translation by given amount to the list of transformations of the element.\r\n     > Parameters\r\n     - dx (number) horisontal shift\r\n     - dy (number) vertical shift\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.translate = function (dx, dy) {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        dx = Str(dx).split(separator);\r\n        if (dx.length - 1) {\r\n            dy = toFloat(dx[1]);\r\n        }\r\n        dx = toFloat(dx[0]) || 0;\r\n        dy = +dy || 0;\r\n        this.transform(this._.transform.concat([["t", dx, dy]]));\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.transform\r\n     [ method ]\r\n     **\r\n     * Adds transformation to the element which is separate to other attributes,\r\n     * i.e. translation doesn’t change `x` or `y` of the rectange. The format\r\n     * of transformation string is similar to the path string syntax:\r\n     | "t100,100r30,100,100s2,2,100,100r45s1.5"\r\n     * Each letter is a command. There are four commands: `t` is for translate, `r` is for rotate, `s` is for\r\n     * scale and `m` is for matrix.\r\n     *\r\n     * There are also alternative “absolute” translation, rotation and scale: `T`, `R` and `S`. They will not take previous transformation into account. For example, `...T100,0` will always move element 100 px horisontally, while `...t100,0` could move it vertically if there is `r90` before. Just compare results of `r90t100,0` and `r90T100,0`.\r\n     *\r\n     * So, the example line above could be read like “translate by 100, 100; rotate 30° around 100, 100; scale twice around 100, 100;\r\n     * rotate 45° around centre; scale 1.5 times relative to centre”. As you can see rotate and scale commands have origin\r\n     * coordinates as optional parameters, the default is the centre point of the element.\r\n     * Matrix accepts six parameters.\r\n     > Usage\r\n     | var el = paper.rect(10, 20, 300, 200);\r\n     | // translate 100, 100, rotate 45°, translate -100, 0\r\n     | el.transform("t100,100r45t-100,0");\r\n     | // if you want you can append or prepend transformations\r\n     | el.transform("...t50,50");\r\n     | el.transform("s2...");\r\n     | // or even wrap\r\n     | el.transform("t50,50...t-50-50");\r\n     | // to reset transformation call method with empty string\r\n     | el.transform("");\r\n     | // to get current value call it without parameters\r\n     | console.log(el.transform());\r\n     > Parameters\r\n     - tstr (string) #optional transformation string\r\n     * If tstr isn’t specified\r\n     = (string) current transformation string\r\n     * else\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.transform = function (tstr) {\r\n        var _ = this._;\r\n        if (tstr == null) {\r\n            return _.transform;\r\n        }\r\n        R._extractTransform(this, tstr);\r\n\r\n        this.clip && $(this.clip, {transform: this.matrix.invert()});\r\n        this.pattern && updatePosition(this);\r\n        this.node && $(this.node, {transform: this.matrix});\r\n\r\n        if (_.sx != 1 || _.sy != 1) {\r\n            var sw = this.attrs[has]("stroke-width") ? this.attrs["stroke-width"] : 1;\r\n            this.attr({"stroke-width": sw});\r\n        }\r\n\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.hide\r\n     [ method ]\r\n     **\r\n     * Makes element invisible. See @Element.show.\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.hide = function () {\r\n        if(!this.removed) this.node.style.display = "none";\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.show\r\n     [ method ]\r\n     **\r\n     * Makes element visible. See @Element.hide.\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.show = function () {\r\n        if(!this.removed) this.node.style.display = "";\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.remove\r\n     [ method ]\r\n     **\r\n     * Removes element from the paper.\r\n     \\*/\r\n    elproto.remove = function () {\r\n        var node = getRealNode(this.node);\r\n        if (this.removed || !node.parentNode) {\r\n            return;\r\n        }\r\n        var paper = this.paper;\r\n        paper.__set__ && paper.__set__.exclude(this);\r\n        eve.unbind("raphael.*.*." + this.id);\r\n        if (this.gradient) {\r\n            paper.defs.removeChild(this.gradient);\r\n        }\r\n        R._tear(this, paper);\r\n\r\n        node.parentNode.removeChild(node);\r\n\r\n        // Remove custom data for element\r\n        this.removeData();\r\n\r\n        for (var i in this) {\r\n            this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;\r\n        }\r\n        this.removed = true;\r\n    };\r\n    elproto._getBBox = function () {\r\n        if (this.node.style.display == "none") {\r\n            this.show();\r\n            var hide = true;\r\n        }\r\n        var canvasHidden = false,\r\n            containerStyle;\r\n        if (this.paper.canvas.parentElement) {\r\n            containerStyle = this.paper.canvas.parentElement.style;\r\n        } //IE10+ can\'t find parentElement\r\n        else if (this.paper.canvas.parentNode) {\r\n            containerStyle = this.paper.canvas.parentNode.style;\r\n        }\r\n\r\n        if(containerStyle && containerStyle.display == "none") {\r\n            canvasHidden = true;\r\n            containerStyle.display = "";\r\n        }\r\n        var bbox = {};\r\n        try {\r\n            bbox = this.node.getBBox();\r\n        } catch(e) {\r\n            // Firefox 3.0.x, 25.0.1 (probably more versions affected) play badly here - possible fix\r\n            bbox = {\r\n                x: this.node.clientLeft,\r\n                y: this.node.clientTop,\r\n                width: this.node.clientWidth,\r\n                height: this.node.clientHeight\r\n            }\r\n        } finally {\r\n            bbox = bbox || {};\r\n            if(canvasHidden){\r\n                containerStyle.display = "none";\r\n            }\r\n        }\r\n        hide && this.hide();\r\n        return bbox;\r\n    };\r\n    /*\\\r\n     * Element.attr\r\n     [ method ]\r\n     **\r\n     * Sets the attributes of the element.\r\n     > Parameters\r\n     - attrName (string) attribute’s name\r\n     - value (string) value\r\n     * or\r\n     - params (object) object of name/value pairs\r\n     * or\r\n     - attrName (string) attribute’s name\r\n     * or\r\n     - attrNames (array) in this case method returns array of current values for given attribute names\r\n     = (object) @Element if attrsName & value or params are passed in.\r\n     = (...) value of the attribute if only attrsName is passed in.\r\n     = (array) array of values of the attribute if attrsNames is passed in.\r\n     = (object) object of attributes if nothing is passed in.\r\n     > Possible parameters\r\n     # <p>Please refer to the <a href="http://www.w3.org/TR/SVG/" title="The W3C Recommendation for the SVG language describes these properties in detail.">SVG specification</a> for an explanation of these parameters.</p>\r\n     o arrow-end (string) arrowhead on the end of the path. The format for string is `<type>[-<width>[-<length>]]`. Possible types: `classic`, `block`, `open`, `oval`, `diamond`, `none`, width: `wide`, `narrow`, `medium`, length: `long`, `short`, `midium`.\r\n     o clip-rect (string) comma or space separated values: x, y, width and height\r\n     o cursor (string) CSS type of the cursor\r\n     o cx (number) the x-axis coordinate of the center of the circle, or ellipse\r\n     o cy (number) the y-axis coordinate of the center of the circle, or ellipse\r\n     o fill (string) colour, gradient or image\r\n     o fill-opacity (number)\r\n     o font (string)\r\n     o font-family (string)\r\n     o font-size (number) font size in pixels\r\n     o font-weight (string)\r\n     o height (number)\r\n     o href (string) URL, if specified element behaves as hyperlink\r\n     o opacity (number)\r\n     o path (string) SVG path string format\r\n     o r (number) radius of the circle, ellipse or rounded corner on the rect\r\n     o rx (number) horisontal radius of the ellipse\r\n     o ry (number) vertical radius of the ellipse\r\n     o src (string) image URL, only works for @Element.image element\r\n     o stroke (string) stroke colour\r\n     o stroke-dasharray (string) [“”, “none”, “`-`”, “`.`”, “`-.`”, “`-..`”, “`. `”, “`- `”, “`--`”, “`- .`”, “`--.`”, “`--..`”]\r\n     o stroke-linecap (string) [“`butt`”, “`square`”, “`round`”]\r\n     o stroke-linejoin (string) [“`bevel`”, “`round`”, “`miter`”]\r\n     o stroke-miterlimit (number)\r\n     o stroke-opacity (number)\r\n     o stroke-width (number) stroke width in pixels, default is \'1\'\r\n     o target (string) used with href\r\n     o text (string) contents of the text element. Use `\\n` for multiline text\r\n     o text-anchor (string) [“`start`”, “`middle`”, “`end`”], default is “`middle`”\r\n     o title (string) will create tooltip with a given text\r\n     o transform (string) see @Element.transform\r\n     o width (number)\r\n     o x (number)\r\n     o y (number)\r\n     > Gradients\r\n     * Linear gradient format: “`‹angle›-‹colour›[-‹colour›[:‹offset›]]*-‹colour›`”, example: “`90-#fff-#000`” – 90°\r\n     * gradient from white to black or “`0-#fff-#f00:20-#000`” – 0° gradient from white via red (at 20%) to black.\r\n     *\r\n     * radial gradient: “`r[(‹fx›, ‹fy›)]‹colour›[-‹colour›[:‹offset›]]*-‹colour›`”, example: “`r#fff-#000`” –\r\n     * gradient from white to black or “`r(0.25, 0.75)#fff-#000`” – gradient from white to black with focus point\r\n     * at 0.25, 0.75. Focus point coordinates are in 0..1 range. Radial gradients can only be applied to circles and ellipses.\r\n     > Path String\r\n     # <p>Please refer to <a href="http://www.w3.org/TR/SVG/paths.html#PathData" title="Details of a path’s data attribute’s format are described in the SVG specification.">SVG documentation regarding path string</a>. Raphaël fully supports it.</p>\r\n     > Colour Parsing\r\n     # <ul>\r\n     #     <li>Colour name (“<code>red</code>”, “<code>green</code>”, “<code>cornflowerblue</code>”, etc)</li>\r\n     #     <li>#••• — shortened HTML colour: (“<code>#000</code>”, “<code>#fc0</code>”, etc)</li>\r\n     #     <li>#•••••• — full length HTML colour: (“<code>#000000</code>”, “<code>#bd2300</code>”)</li>\r\n     #     <li>rgb(•••, •••, •••) — red, green and blue channels’ values: (“<code>rgb(200,&nbsp;100,&nbsp;0)</code>”)</li>\r\n     #     <li>rgb(•••%, •••%, •••%) — same as above, but in %: (“<code>rgb(100%,&nbsp;175%,&nbsp;0%)</code>”)</li>\r\n     #     <li>rgba(•••, •••, •••, •••) — red, green and blue channels’ values: (“<code>rgba(200,&nbsp;100,&nbsp;0, .5)</code>”)</li>\r\n     #     <li>rgba(•••%, •••%, •••%, •••%) — same as above, but in %: (“<code>rgba(100%,&nbsp;175%,&nbsp;0%, 50%)</code>”)</li>\r\n     #     <li>hsb(•••, •••, •••) — hue, saturation and brightness values: (“<code>hsb(0.5,&nbsp;0.25,&nbsp;1)</code>”)</li>\r\n     #     <li>hsb(•••%, •••%, •••%) — same as above, but in %</li>\r\n     #     <li>hsba(•••, •••, •••, •••) — same as above, but with opacity</li>\r\n     #     <li>hsl(•••, •••, •••) — almost the same as hsb, see <a href="http://en.wikipedia.org/wiki/HSL_and_HSV" title="HSL and HSV - Wikipedia, the free encyclopedia">Wikipedia page</a></li>\r\n     #     <li>hsl(•••%, •••%, •••%) — same as above, but in %</li>\r\n     #     <li>hsla(•••, •••, •••, •••) — same as above, but with opacity</li>\r\n     #     <li>Optionally for hsb and hsl you could specify hue as a degree: “<code>hsl(240deg,&nbsp;1,&nbsp;.5)</code>” or, if you want to go fancy, “<code>hsl(240°,&nbsp;1,&nbsp;.5)</code>”</li>\r\n     # </ul>\r\n     \\*/\r\n    elproto.attr = function (name, value) {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        if (name == null) {\r\n            var res = {};\r\n            for (var a in this.attrs) if (this.attrs[has](a)) {\r\n                res[a] = this.attrs[a];\r\n            }\r\n            res.gradient && res.fill == "none" && (res.fill = res.gradient) && delete res.gradient;\r\n            res.transform = this._.transform;\r\n            return res;\r\n        }\r\n        if (value == null && R.is(name, "string")) {\r\n            if (name == "fill" && this.attrs.fill == "none" && this.attrs.gradient) {\r\n                return this.attrs.gradient;\r\n            }\r\n            if (name == "transform") {\r\n                return this._.transform;\r\n            }\r\n            var names = name.split(separator),\r\n                out = {};\r\n            for (var i = 0, ii = names.length; i < ii; i++) {\r\n                name = names[i];\r\n                if (name in this.attrs) {\r\n                    out[name] = this.attrs[name];\r\n                } else if (R.is(this.paper.customAttributes[name], "function")) {\r\n                    out[name] = this.paper.customAttributes[name].def;\r\n                } else {\r\n                    out[name] = R._availableAttrs[name];\r\n                }\r\n            }\r\n            return ii - 1 ? out : out[names[0]];\r\n        }\r\n        if (value == null && R.is(name, "array")) {\r\n            out = {};\r\n            for (i = 0, ii = name.length; i < ii; i++) {\r\n                out[name[i]] = this.attr(name[i]);\r\n            }\r\n            return out;\r\n        }\r\n        if (value != null) {\r\n            var params = {};\r\n            params[name] = value;\r\n        } else if (name != null && R.is(name, "object")) {\r\n            params = name;\r\n        }\r\n        for (var key in params) {\r\n            eve("raphael.attr." + key + "." + this.id, this, params[key]);\r\n        }\r\n        for (key in this.paper.customAttributes) if (this.paper.customAttributes[has](key) && params[has](key) && R.is(this.paper.customAttributes[key], "function")) {\r\n            var par = this.paper.customAttributes[key].apply(this, [].concat(params[key]));\r\n            this.attrs[key] = params[key];\r\n            for (var subkey in par) if (par[has](subkey)) {\r\n                params[subkey] = par[subkey];\r\n            }\r\n        }\r\n        setFillAndStroke(this, params);\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.toFront\r\n     [ method ]\r\n     **\r\n     * Moves the element so it is the closest to the viewer’s eyes, on top of other elements.\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.toFront = function () {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        var node = getRealNode(this.node);\r\n        node.parentNode.appendChild(node);\r\n        var svg = this.paper;\r\n        svg.top != this && R._tofront(this, svg);\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.toBack\r\n     [ method ]\r\n     **\r\n     * Moves the element so it is the furthest from the viewer’s eyes, behind other elements.\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.toBack = function () {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        var node = getRealNode(this.node);\r\n        var parentNode = node.parentNode;\r\n        parentNode.insertBefore(node, parentNode.firstChild);\r\n        R._toback(this, this.paper);\r\n        var svg = this.paper;\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.insertAfter\r\n     [ method ]\r\n     **\r\n     * Inserts current object after the given one.\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.insertAfter = function (element) {\r\n        if (this.removed || !element) {\r\n            return this;\r\n        }\r\n\r\n        var node = getRealNode(this.node);\r\n        var afterNode = getRealNode(element.node || element[element.length - 1].node);\r\n        if (afterNode.nextSibling) {\r\n            afterNode.parentNode.insertBefore(node, afterNode.nextSibling);\r\n        } else {\r\n            afterNode.parentNode.appendChild(node);\r\n        }\r\n        R._insertafter(this, element, this.paper);\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Element.insertBefore\r\n     [ method ]\r\n     **\r\n     * Inserts current object before the given one.\r\n     = (object) @Element\r\n     \\*/\r\n    elproto.insertBefore = function (element) {\r\n        if (this.removed || !element) {\r\n            return this;\r\n        }\r\n\r\n        var node = getRealNode(this.node);\r\n        var beforeNode = getRealNode(element.node || element[0].node);\r\n        beforeNode.parentNode.insertBefore(node, beforeNode);\r\n        R._insertbefore(this, element, this.paper);\r\n        return this;\r\n    };\r\n    elproto.blur = function (size) {\r\n        // Experimental. No Safari support. Use it on your own risk.\r\n        var t = this;\r\n        if (+size !== 0) {\r\n            var fltr = $("filter"),\r\n                blur = $("feGaussianBlur");\r\n            t.attrs.blur = size;\r\n            fltr.id = R.createUUID();\r\n            $(blur, {stdDeviation: +size || 1.5});\r\n            fltr.appendChild(blur);\r\n            t.paper.defs.appendChild(fltr);\r\n            t._blur = fltr;\r\n            $(t.node, {filter: "url(#" + fltr.id + ")"});\r\n        } else {\r\n            if (t._blur) {\r\n                t._blur.parentNode.removeChild(t._blur);\r\n                delete t._blur;\r\n                delete t.attrs.blur;\r\n            }\r\n            t.node.removeAttribute("filter");\r\n        }\r\n        return t;\r\n    };\r\n    R._engine.circle = function (svg, x, y, r) {\r\n        var el = $("circle");\r\n        svg.canvas && svg.canvas.appendChild(el);\r\n        var res = new Element(el, svg);\r\n        res.attrs = {cx: x, cy: y, r: r, fill: "none", stroke: "#000"};\r\n        res.type = "circle";\r\n        $(el, res.attrs);\r\n        return res;\r\n    };\r\n    R._engine.rect = function (svg, x, y, w, h, r) {\r\n        var el = $("rect");\r\n        svg.canvas && svg.canvas.appendChild(el);\r\n        var res = new Element(el, svg);\r\n        res.attrs = {x: x, y: y, width: w, height: h, rx: r || 0, ry: r || 0, fill: "none", stroke: "#000"};\r\n        res.type = "rect";\r\n        $(el, res.attrs);\r\n        return res;\r\n    };\r\n    R._engine.ellipse = function (svg, x, y, rx, ry) {\r\n        var el = $("ellipse");\r\n        svg.canvas && svg.canvas.appendChild(el);\r\n        var res = new Element(el, svg);\r\n        res.attrs = {cx: x, cy: y, rx: rx, ry: ry, fill: "none", stroke: "#000"};\r\n        res.type = "ellipse";\r\n        $(el, res.attrs);\r\n        return res;\r\n    };\r\n    R._engine.image = function (svg, src, x, y, w, h) {\r\n        var el = $("image");\r\n        $(el, {x: x, y: y, width: w, height: h, preserveAspectRatio: "none"});\r\n        el.setAttributeNS(xlink, "href", src);\r\n        svg.canvas && svg.canvas.appendChild(el);\r\n        var res = new Element(el, svg);\r\n        res.attrs = {x: x, y: y, width: w, height: h, src: src};\r\n        res.type = "image";\r\n        return res;\r\n    };\r\n    R._engine.text = function (svg, x, y, text) {\r\n        var el = $("text");\r\n        svg.canvas && svg.canvas.appendChild(el);\r\n        var res = new Element(el, svg);\r\n        res.attrs = {\r\n            x: x,\r\n            y: y,\r\n            "text-anchor": "middle",\r\n            text: text,\r\n            "font-family": R._availableAttrs["font-family"],\r\n            "font-size": R._availableAttrs["font-size"],\r\n            stroke: "none",\r\n            fill: "#000"\r\n        };\r\n        res.type = "text";\r\n        setFillAndStroke(res, res.attrs);\r\n        return res;\r\n    };\r\n    R._engine.setSize = function (width, height) {\r\n        this.width = width || this.width;\r\n        this.height = height || this.height;\r\n        this.canvas.setAttribute("width", this.width);\r\n        this.canvas.setAttribute("height", this.height);\r\n        if (this._viewBox) {\r\n            this.setViewBox.apply(this, this._viewBox);\r\n        }\r\n        return this;\r\n    };\r\n    R._engine.create = function () {\r\n        var con = R._getContainer.apply(0, arguments),\r\n            container = con && con.container,\r\n            x = con.x,\r\n            y = con.y,\r\n            width = con.width,\r\n            height = con.height;\r\n        if (!container) {\r\n            throw new Error("SVG container not found.");\r\n        }\r\n        var cnvs = $("svg"),\r\n            css = "overflow:hidden;",\r\n            isFloating;\r\n        x = x || 0;\r\n        y = y || 0;\r\n        width = width || 512;\r\n        height = height || 342;\r\n        $(cnvs, {\r\n            height: height,\r\n            version: 1.1,\r\n            width: width,\r\n            xmlns: "http://www.w3.org/2000/svg",\r\n            "xmlns:xlink": "http://www.w3.org/1999/xlink"\r\n        });\r\n        if (container == 1) {\r\n            cnvs.style.cssText = css + "position:absolute;left:" + x + "px;top:" + y + "px";\r\n            R._g.doc.body.appendChild(cnvs);\r\n            isFloating = 1;\r\n        } else {\r\n            cnvs.style.cssText = css + "position:relative";\r\n            if (container.firstChild) {\r\n                container.insertBefore(cnvs, container.firstChild);\r\n            } else {\r\n                container.appendChild(cnvs);\r\n            }\r\n        }\r\n        container = new R._Paper;\r\n        container.width = width;\r\n        container.height = height;\r\n        container.canvas = cnvs;\r\n        container.clear();\r\n        container._left = container._top = 0;\r\n        isFloating && (container.renderfix = function () {});\r\n        container.renderfix();\r\n        return container;\r\n    };\r\n    R._engine.setViewBox = function (x, y, w, h, fit) {\r\n        eve("raphael.setViewBox", this, this._viewBox, [x, y, w, h, fit]);\r\n        var paperSize = this.getSize(),\r\n            size = mmax(w / paperSize.width, h / paperSize.height),\r\n            top = this.top,\r\n            aspectRatio = fit ? "xMidYMid meet" : "xMinYMin",\r\n            vb,\r\n            sw;\r\n        if (x == null) {\r\n            if (this._vbSize) {\r\n                size = 1;\r\n            }\r\n            delete this._vbSize;\r\n            vb = "0 0 " + this.width + S + this.height;\r\n        } else {\r\n            this._vbSize = size;\r\n            vb = x + S + y + S + w + S + h;\r\n        }\r\n        $(this.canvas, {\r\n            viewBox: vb,\r\n            preserveAspectRatio: aspectRatio\r\n        });\r\n        while (size && top) {\r\n            sw = "stroke-width" in top.attrs ? top.attrs["stroke-width"] : 1;\r\n            top.attr({"stroke-width": sw});\r\n            top._.dirty = 1;\r\n            top._.dirtyT = 1;\r\n            top = top.prev;\r\n        }\r\n        this._viewBox = [x, y, w, h, !!fit];\r\n        return this;\r\n    };\r\n    /*\\\r\n     * Paper.renderfix\r\n     [ method ]\r\n     **\r\n     * Fixes the issue of Firefox and IE9 regarding subpixel rendering. If paper is dependant\r\n     * on other elements after reflow it could shift half pixel which cause for lines to lost their crispness.\r\n     * This method fixes the issue.\r\n     **\r\n     Special thanks to Mariusz Nowak (http://www.medikoo.com/) for this method.\r\n     \\*/\r\n    R.prototype.renderfix = function () {\r\n        var cnvs = this.canvas,\r\n            s = cnvs.style,\r\n            pos;\r\n        try {\r\n            pos = cnvs.getScreenCTM() || cnvs.createSVGMatrix();\r\n        } catch (e) {\r\n            pos = cnvs.createSVGMatrix();\r\n        }\r\n        var left = -pos.e % 1,\r\n            top = -pos.f % 1;\r\n        if (left || top) {\r\n            if (left) {\r\n                this._left = (this._left + left) % 1;\r\n                s.left = this._left + "px";\r\n            }\r\n            if (top) {\r\n                this._top = (this._top + top) % 1;\r\n                s.top = this._top + "px";\r\n            }\r\n        }\r\n    };\r\n    /*\\\r\n     * Paper.clear\r\n     [ method ]\r\n     **\r\n     * Clears the paper, i.e. removes all the elements.\r\n     \\*/\r\n    R.prototype.clear = function () {\r\n        R.eve("raphael.clear", this);\r\n        var c = this.canvas;\r\n        while (c.firstChild) {\r\n            c.removeChild(c.firstChild);\r\n        }\r\n        this.bottom = this.top = null;\r\n        (this.desc = $("desc")).appendChild(R._g.doc.createTextNode("Created with Rapha\\xebl " + R.version));\r\n        c.appendChild(this.desc);\r\n        c.appendChild(this.defs = $("defs"));\r\n    };\r\n    /*\\\r\n     * Paper.remove\r\n     [ method ]\r\n     **\r\n     * Removes the paper from the DOM.\r\n     \\*/\r\n    R.prototype.remove = function () {\r\n        eve("raphael.remove", this);\r\n        this.canvas.parentNode && this.canvas.parentNode.removeChild(this.canvas);\r\n        for (var i in this) {\r\n            this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;\r\n        }\r\n    };\r\n    var setproto = R.st;\r\n    for (var method in elproto) if (elproto[has](method) && !setproto[has](method)) {\r\n        setproto[method] = (function (methodname) {\r\n            return function () {\r\n                var arg = arguments;\r\n                return this.forEach(function (el) {\r\n                    el[methodname].apply(el, arg);\r\n                });\r\n            };\r\n        })(method);\r\n    }\r\n}));\r\n\r\n// ┌─────────────────────────────────────────────────────────────────────┐ \\\\\r\n// │ Raphaël 2.1.4 - JavaScript Vector Library                       │ \\\\\r\n// ├─────────────────────────────────────────────────────────────────────┤ \\\\\r\n// │ VML Module                                                          │ \\\\\r\n// ├─────────────────────────────────────────────────────────────────────┤ \\\\\r\n// │ Copyright (c) 2008-2011 Dmitry Baranovskiy (http://raphaeljs.com)   │ \\\\\r\n// │ Copyright (c) 2008-2011 Sencha Labs (http://sencha.com)             │ \\\\\r\n// │ Licensed under the MIT (http://raphaeljs.com/license.html) license. │ \\\\\r\n// └─────────────────────────────────────────────────────────────────────┘ \\\\\r\n\r\n(function (glob, factory) {\r\n    if (typeof define === "function" && define.amd) {\r\n        define("raphael.vml", ["raphael.core"], function(raphael) {\r\n            return factory(raphael);\r\n        });\r\n    } else if (typeof exports === "object") {\r\n        factory(require("raphael"));\r\n    } else {\r\n        factory(glob.Raphael);\r\n    }\r\n}(this, function(R) {\r\n    if (R && !R.vml) {\r\n        return;\r\n    }\r\n\r\n    var has = "hasOwnProperty",\r\n        Str = String,\r\n        toFloat = parseFloat,\r\n        math = Math,\r\n        round = math.round,\r\n        mmax = math.max,\r\n        mmin = math.min,\r\n        abs = math.abs,\r\n        fillString = "fill",\r\n        separator = /[, ]+/,\r\n        eve = R.eve,\r\n        ms = " progid:DXImageTransform.Microsoft",\r\n        S = " ",\r\n        E = "",\r\n        map = {M: "m", L: "l", C: "c", Z: "x", m: "t", l: "r", c: "v", z: "x"},\r\n        bites = /([clmz]),?([^clmz]*)/gi,\r\n        blurregexp = / progid:\\S+Blur\\([^\\)]+\\)/g,\r\n        val = /-?[^,\\s-]+/g,\r\n        cssDot = "position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",\r\n        zoom = 21600,\r\n        pathTypes = {path: 1, rect: 1, image: 1},\r\n        ovalTypes = {circle: 1, ellipse: 1},\r\n        path2vml = function (path) {\r\n            var total =  /[ahqstv]/ig,\r\n                command = R._pathToAbsolute;\r\n            Str(path).match(total) && (command = R._path2curve);\r\n            total = /[clmz]/g;\r\n            if (command == R._pathToAbsolute && !Str(path).match(total)) {\r\n                var res = Str(path).replace(bites, function (all, command, args) {\r\n                    var vals = [],\r\n                        isMove = command.toLowerCase() == "m",\r\n                        res = map[command];\r\n                    args.replace(val, function (value) {\r\n                        if (isMove && vals.length == 2) {\r\n                            res += vals + map[command == "m" ? "l" : "L"];\r\n                            vals = [];\r\n                        }\r\n                        vals.push(round(value * zoom));\r\n                    });\r\n                    return res + vals;\r\n                });\r\n                return res;\r\n            }\r\n            var pa = command(path), p, r;\r\n            res = [];\r\n            for (var i = 0, ii = pa.length; i < ii; i++) {\r\n                p = pa[i];\r\n                r = pa[i][0].toLowerCase();\r\n                r == "z" && (r = "x");\r\n                for (var j = 1, jj = p.length; j < jj; j++) {\r\n                    r += round(p[j] * zoom) + (j != jj - 1 ? "," : E);\r\n                }\r\n                res.push(r);\r\n            }\r\n            return res.join(S);\r\n        },\r\n        compensation = function (deg, dx, dy) {\r\n            var m = R.matrix();\r\n            m.rotate(-deg, .5, .5);\r\n            return {\r\n                dx: m.x(dx, dy),\r\n                dy: m.y(dx, dy)\r\n            };\r\n        },\r\n        setCoords = function (p, sx, sy, dx, dy, deg) {\r\n            var _ = p._,\r\n                m = p.matrix,\r\n                fillpos = _.fillpos,\r\n                o = p.node,\r\n                s = o.style,\r\n                y = 1,\r\n                flip = "",\r\n                dxdy,\r\n                kx = zoom / sx,\r\n                ky = zoom / sy;\r\n            s.visibility = "hidden";\r\n            if (!sx || !sy) {\r\n                return;\r\n            }\r\n            o.coordsize = abs(kx) + S + abs(ky);\r\n            s.rotation = deg * (sx * sy < 0 ? -1 : 1);\r\n            if (deg) {\r\n                var c = compensation(deg, dx, dy);\r\n                dx = c.dx;\r\n                dy = c.dy;\r\n            }\r\n            sx < 0 && (flip += "x");\r\n            sy < 0 && (flip += " y") && (y = -1);\r\n            s.flip = flip;\r\n            o.coordorigin = (dx * -kx) + S + (dy * -ky);\r\n            if (fillpos || _.fillsize) {\r\n                var fill = o.getElementsByTagName(fillString);\r\n                fill = fill && fill[0];\r\n                o.removeChild(fill);\r\n                if (fillpos) {\r\n                    c = compensation(deg, m.x(fillpos[0], fillpos[1]), m.y(fillpos[0], fillpos[1]));\r\n                    fill.position = c.dx * y + S + c.dy * y;\r\n                }\r\n                if (_.fillsize) {\r\n                    fill.size = _.fillsize[0] * abs(sx) + S + _.fillsize[1] * abs(sy);\r\n                }\r\n                o.appendChild(fill);\r\n            }\r\n            s.visibility = "visible";\r\n        };\r\n    R.toString = function () {\r\n        return  "Your browser doesn\\u2019t support SVG. Falling down to VML.\\nYou are running Rapha\\xebl " + this.version;\r\n    };\r\n    var addArrow = function (o, value, isEnd) {\r\n            var values = Str(value).toLowerCase().split("-"),\r\n                se = isEnd ? "end" : "start",\r\n                i = values.length,\r\n                type = "classic",\r\n                w = "medium",\r\n                h = "medium";\r\n            while (i--) {\r\n                switch (values[i]) {\r\n                    case "block":\r\n                    case "classic":\r\n                    case "oval":\r\n                    case "diamond":\r\n                    case "open":\r\n                    case "none":\r\n                        type = values[i];\r\n                        break;\r\n                    case "wide":\r\n                    case "narrow": h = values[i]; break;\r\n                    case "long":\r\n                    case "short": w = values[i]; break;\r\n                }\r\n            }\r\n            var stroke = o.node.getElementsByTagName("stroke")[0];\r\n            stroke[se + "arrow"] = type;\r\n            stroke[se + "arrowlength"] = w;\r\n            stroke[se + "arrowwidth"] = h;\r\n        },\r\n        setFillAndStroke = function (o, params) {\r\n            // o.paper.canvas.style.display = "none";\r\n            o.attrs = o.attrs || {};\r\n            var node = o.node,\r\n                a = o.attrs,\r\n                s = node.style,\r\n                xy,\r\n                newpath = pathTypes[o.type] && (params.x != a.x || params.y != a.y || params.width != a.width || params.height != a.height || params.cx != a.cx || params.cy != a.cy || params.rx != a.rx || params.ry != a.ry || params.r != a.r),\r\n                isOval = ovalTypes[o.type] && (a.cx != params.cx || a.cy != params.cy || a.r != params.r || a.rx != params.rx || a.ry != params.ry),\r\n                res = o;\r\n\r\n\r\n            for (var par in params) if (params[has](par)) {\r\n                a[par] = params[par];\r\n            }\r\n            if (newpath) {\r\n                a.path = R._getPath[o.type](o);\r\n                o._.dirty = 1;\r\n            }\r\n            params.href && (node.href = params.href);\r\n            params.title && (node.title = params.title);\r\n            params.target && (node.target = params.target);\r\n            params.cursor && (s.cursor = params.cursor);\r\n            "blur" in params && o.blur(params.blur);\r\n            if (params.path && o.type == "path" || newpath) {\r\n                node.path = path2vml(~Str(a.path).toLowerCase().indexOf("r") ? R._pathToAbsolute(a.path) : a.path);\r\n                o._.dirty = 1;\r\n                if (o.type == "image") {\r\n                    o._.fillpos = [a.x, a.y];\r\n                    o._.fillsize = [a.width, a.height];\r\n                    setCoords(o, 1, 1, 0, 0, 0);\r\n                }\r\n            }\r\n            "transform" in params && o.transform(params.transform);\r\n            if (isOval) {\r\n                var cx = +a.cx,\r\n                    cy = +a.cy,\r\n                    rx = +a.rx || +a.r || 0,\r\n                    ry = +a.ry || +a.r || 0;\r\n                node.path = R.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x", round((cx - rx) * zoom), round((cy - ry) * zoom), round((cx + rx) * zoom), round((cy + ry) * zoom), round(cx * zoom));\r\n                o._.dirty = 1;\r\n            }\r\n            if ("clip-rect" in params) {\r\n                var rect = Str(params["clip-rect"]).split(separator);\r\n                if (rect.length == 4) {\r\n                    rect[2] = +rect[2] + (+rect[0]);\r\n                    rect[3] = +rect[3] + (+rect[1]);\r\n                    var div = node.clipRect || R._g.doc.createElement("div"),\r\n                        dstyle = div.style;\r\n                    dstyle.clip = R.format("rect({1}px {2}px {3}px {0}px)", rect);\r\n                    if (!node.clipRect) {\r\n                        dstyle.position = "absolute";\r\n                        dstyle.top = 0;\r\n                        dstyle.left = 0;\r\n                        dstyle.width = o.paper.width + "px";\r\n                        dstyle.height = o.paper.height + "px";\r\n                        node.parentNode.insertBefore(div, node);\r\n                        div.appendChild(node);\r\n                        node.clipRect = div;\r\n                    }\r\n                }\r\n                if (!params["clip-rect"]) {\r\n                    node.clipRect && (node.clipRect.style.clip = "auto");\r\n                }\r\n            }\r\n            if (o.textpath) {\r\n                var textpathStyle = o.textpath.style;\r\n                params.font && (textpathStyle.font = params.font);\r\n                params["font-family"] && (textpathStyle.fontFamily = \'"\' + params["font-family"].split(",")[0].replace(/^[\'"]+|[\'"]+$/g, E) + \'"\');\r\n                params["font-size"] && (textpathStyle.fontSize = params["font-size"]);\r\n                params["font-weight"] && (textpathStyle.fontWeight = params["font-weight"]);\r\n                params["font-style"] && (textpathStyle.fontStyle = params["font-style"]);\r\n            }\r\n            if ("arrow-start" in params) {\r\n                addArrow(res, params["arrow-start"]);\r\n            }\r\n            if ("arrow-end" in params) {\r\n                addArrow(res, params["arrow-end"], 1);\r\n            }\r\n            if (params.opacity != null ||\r\n                params["stroke-width"] != null ||\r\n                params.fill != null ||\r\n                params.src != null ||\r\n                params.stroke != null ||\r\n                params["stroke-width"] != null ||\r\n                params["stroke-opacity"] != null ||\r\n                params["fill-opacity"] != null ||\r\n                params["stroke-dasharray"] != null ||\r\n                params["stroke-miterlimit"] != null ||\r\n                params["stroke-linejoin"] != null ||\r\n                params["stroke-linecap"] != null) {\r\n                var fill = node.getElementsByTagName(fillString),\r\n                    newfill = false;\r\n                fill = fill && fill[0];\r\n                !fill && (newfill = fill = createNode(fillString));\r\n                if (o.type == "image" && params.src) {\r\n                    fill.src = params.src;\r\n                }\r\n                params.fill && (fill.on = true);\r\n                if (fill.on == null || params.fill == "none" || params.fill === null) {\r\n                    fill.on = false;\r\n                }\r\n                if (fill.on && params.fill) {\r\n                    var isURL = Str(params.fill).match(R._ISURL);\r\n                    if (isURL) {\r\n                        fill.parentNode == node && node.removeChild(fill);\r\n                        fill.rotate = true;\r\n                        fill.src = isURL[1];\r\n                        fill.type = "tile";\r\n                        var bbox = o.getBBox(1);\r\n                        fill.position = bbox.x + S + bbox.y;\r\n                        o._.fillpos = [bbox.x, bbox.y];\r\n\r\n                        R._preload(isURL[1], function () {\r\n                            o._.fillsize = [this.offsetWidth, this.offsetHeight];\r\n                        });\r\n                    } else {\r\n                        fill.color = R.getRGB(params.fill).hex;\r\n                        fill.src = E;\r\n                        fill.type = "solid";\r\n                        if (R.getRGB(params.fill).error && (res.type in {circle: 1, ellipse: 1} || Str(params.fill).charAt() != "r") && addGradientFill(res, params.fill, fill)) {\r\n                            a.fill = "none";\r\n                            a.gradient = params.fill;\r\n                            fill.rotate = false;\r\n                        }\r\n                    }\r\n                }\r\n                if ("fill-opacity" in params || "opacity" in params) {\r\n                    var opacity = ((+a["fill-opacity"] + 1 || 2) - 1) * ((+a.opacity + 1 || 2) - 1) * ((+R.getRGB(params.fill).o + 1 || 2) - 1);\r\n                    opacity = mmin(mmax(opacity, 0), 1);\r\n                    fill.opacity = opacity;\r\n                    if (fill.src) {\r\n                        fill.color = "none";\r\n                    }\r\n                }\r\n                node.appendChild(fill);\r\n                var stroke = (node.getElementsByTagName("stroke") && node.getElementsByTagName("stroke")[0]),\r\n                    newstroke = false;\r\n                !stroke && (newstroke = stroke = createNode("stroke"));\r\n                if ((params.stroke && params.stroke != "none") ||\r\n                    params["stroke-width"] ||\r\n                    params["stroke-opacity"] != null ||\r\n                    params["stroke-dasharray"] ||\r\n                    params["stroke-miterlimit"] ||\r\n                    params["stroke-linejoin"] ||\r\n                    params["stroke-linecap"]) {\r\n                    stroke.on = true;\r\n                }\r\n                (params.stroke == "none" || params.stroke === null || stroke.on == null || params.stroke == 0 || params["stroke-width"] == 0) && (stroke.on = false);\r\n                var strokeColor = R.getRGB(params.stroke);\r\n                stroke.on && params.stroke && (stroke.color = strokeColor.hex);\r\n                opacity = ((+a["stroke-opacity"] + 1 || 2) - 1) * ((+a.opacity + 1 || 2) - 1) * ((+strokeColor.o + 1 || 2) - 1);\r\n                var width = (toFloat(params["stroke-width"]) || 1) * .75;\r\n                opacity = mmin(mmax(opacity, 0), 1);\r\n                params["stroke-width"] == null && (width = a["stroke-width"]);\r\n                params["stroke-width"] && (stroke.weight = width);\r\n                width && width < 1 && (opacity *= width) && (stroke.weight = 1);\r\n                stroke.opacity = opacity;\r\n\r\n                params["stroke-linejoin"] && (stroke.joinstyle = params["stroke-linejoin"] || "miter");\r\n                stroke.miterlimit = params["stroke-miterlimit"] || 8;\r\n                params["stroke-linecap"] && (stroke.endcap = params["stroke-linecap"] == "butt" ? "flat" : params["stroke-linecap"] == "square" ? "square" : "round");\r\n                if ("stroke-dasharray" in params) {\r\n                    var dasharray = {\r\n                        "-": "shortdash",\r\n                        ".": "shortdot",\r\n                        "-.": "shortdashdot",\r\n                        "-..": "shortdashdotdot",\r\n                        ". ": "dot",\r\n                        "- ": "dash",\r\n                        "--": "longdash",\r\n                        "- .": "dashdot",\r\n                        "--.": "longdashdot",\r\n                        "--..": "longdashdotdot"\r\n                    };\r\n                    stroke.dashstyle = dasharray[has](params["stroke-dasharray"]) ? dasharray[params["stroke-dasharray"]] : E;\r\n                }\r\n                newstroke && node.appendChild(stroke);\r\n            }\r\n            if (res.type == "text") {\r\n                res.paper.canvas.style.display = E;\r\n                var span = res.paper.span,\r\n                    m = 100,\r\n                    fontSize = a.font && a.font.match(/\\d+(?:\\.\\d*)?(?=px)/);\r\n                s = span.style;\r\n                a.font && (s.font = a.font);\r\n                a["font-family"] && (s.fontFamily = a["font-family"]);\r\n                a["font-weight"] && (s.fontWeight = a["font-weight"]);\r\n                a["font-style"] && (s.fontStyle = a["font-style"]);\r\n                fontSize = toFloat(a["font-size"] || fontSize && fontSize[0]) || 10;\r\n                s.fontSize = fontSize * m + "px";\r\n                res.textpath.string && (span.innerHTML = Str(res.textpath.string).replace(/</g, "&#60;").replace(/&/g, "&#38;").replace(/\\n/g, "<br>"));\r\n                var brect = span.getBoundingClientRect();\r\n                res.W = a.w = (brect.right - brect.left) / m;\r\n                res.H = a.h = (brect.bottom - brect.top) / m;\r\n                // res.paper.canvas.style.display = "none";\r\n                res.X = a.x;\r\n                res.Y = a.y + res.H / 2;\r\n\r\n                ("x" in params || "y" in params) && (res.path.v = R.format("m{0},{1}l{2},{1}", round(a.x * zoom), round(a.y * zoom), round(a.x * zoom) + 1));\r\n                var dirtyattrs = ["x", "y", "text", "font", "font-family", "font-weight", "font-style", "font-size"];\r\n                for (var d = 0, dd = dirtyattrs.length; d < dd; d++) if (dirtyattrs[d] in params) {\r\n                    res._.dirty = 1;\r\n                    break;\r\n                }\r\n\r\n                // text-anchor emulation\r\n                switch (a["text-anchor"]) {\r\n                    case "start":\r\n                        res.textpath.style["v-text-align"] = "left";\r\n                        res.bbx = res.W / 2;\r\n                        break;\r\n                    case "end":\r\n                        res.textpath.style["v-text-align"] = "right";\r\n                        res.bbx = -res.W / 2;\r\n                        break;\r\n                    default:\r\n                        res.textpath.style["v-text-align"] = "center";\r\n                        res.bbx = 0;\r\n                        break;\r\n                }\r\n                res.textpath.style["v-text-kern"] = true;\r\n            }\r\n            // res.paper.canvas.style.display = E;\r\n        },\r\n        addGradientFill = function (o, gradient, fill) {\r\n            o.attrs = o.attrs || {};\r\n            var attrs = o.attrs,\r\n                pow = Math.pow,\r\n                opacity,\r\n                oindex,\r\n                type = "linear",\r\n                fxfy = ".5 .5";\r\n            o.attrs.gradient = gradient;\r\n            gradient = Str(gradient).replace(R._radial_gradient, function (all, fx, fy) {\r\n                type = "radial";\r\n                if (fx && fy) {\r\n                    fx = toFloat(fx);\r\n                    fy = toFloat(fy);\r\n                    pow(fx - .5, 2) + pow(fy - .5, 2) > .25 && (fy = math.sqrt(.25 - pow(fx - .5, 2)) * ((fy > .5) * 2 - 1) + .5);\r\n                    fxfy = fx + S + fy;\r\n                }\r\n                return E;\r\n            });\r\n            gradient = gradient.split(/\\s*\\-\\s*/);\r\n            if (type == "linear") {\r\n                var angle = gradient.shift();\r\n                angle = -toFloat(angle);\r\n                if (isNaN(angle)) {\r\n                    return null;\r\n                }\r\n            }\r\n            var dots = R._parseDots(gradient);\r\n            if (!dots) {\r\n                return null;\r\n            }\r\n            o = o.shape || o.node;\r\n            if (dots.length) {\r\n                o.removeChild(fill);\r\n                fill.on = true;\r\n                fill.method = "none";\r\n                fill.color = dots[0].color;\r\n                fill.color2 = dots[dots.length - 1].color;\r\n                var clrs = [];\r\n                for (var i = 0, ii = dots.length; i < ii; i++) {\r\n                    dots[i].offset && clrs.push(dots[i].offset + S + dots[i].color);\r\n                }\r\n                fill.colors = clrs.length ? clrs.join() : "0% " + fill.color;\r\n                if (type == "radial") {\r\n                    fill.type = "gradientTitle";\r\n                    fill.focus = "100%";\r\n                    fill.focussize = "0 0";\r\n                    fill.focusposition = fxfy;\r\n                    fill.angle = 0;\r\n                } else {\r\n                    // fill.rotate= true;\r\n                    fill.type = "gradient";\r\n                    fill.angle = (270 - angle) % 360;\r\n                }\r\n                o.appendChild(fill);\r\n            }\r\n            return 1;\r\n        },\r\n        Element = function (node, vml) {\r\n            this[0] = this.node = node;\r\n            node.raphael = true;\r\n            this.id = R._oid++;\r\n            node.raphaelid = this.id;\r\n            this.X = 0;\r\n            this.Y = 0;\r\n            this.attrs = {};\r\n            this.paper = vml;\r\n            this.matrix = R.matrix();\r\n            this._ = {\r\n                transform: [],\r\n                sx: 1,\r\n                sy: 1,\r\n                dx: 0,\r\n                dy: 0,\r\n                deg: 0,\r\n                dirty: 1,\r\n                dirtyT: 1\r\n            };\r\n            !vml.bottom && (vml.bottom = this);\r\n            this.prev = vml.top;\r\n            vml.top && (vml.top.next = this);\r\n            vml.top = this;\r\n            this.next = null;\r\n        };\r\n    var elproto = R.el;\r\n\r\n    Element.prototype = elproto;\r\n    elproto.constructor = Element;\r\n    elproto.transform = function (tstr) {\r\n        if (tstr == null) {\r\n            return this._.transform;\r\n        }\r\n        var vbs = this.paper._viewBoxShift,\r\n            vbt = vbs ? "s" + [vbs.scale, vbs.scale] + "-1-1t" + [vbs.dx, vbs.dy] : E,\r\n            oldt;\r\n        if (vbs) {\r\n            oldt = tstr = Str(tstr).replace(/\\.{3}|\\u2026/g, this._.transform || E);\r\n        }\r\n        R._extractTransform(this, vbt + tstr);\r\n        var matrix = this.matrix.clone(),\r\n            skew = this.skew,\r\n            o = this.node,\r\n            split,\r\n            isGrad = ~Str(this.attrs.fill).indexOf("-"),\r\n            isPatt = !Str(this.attrs.fill).indexOf("url(");\r\n        matrix.translate(1, 1);\r\n        if (isPatt || isGrad || this.type == "image") {\r\n            skew.matrix = "1 0 0 1";\r\n            skew.offset = "0 0";\r\n            split = matrix.split();\r\n            if ((isGrad && split.noRotation) || !split.isSimple) {\r\n                o.style.filter = matrix.toFilter();\r\n                var bb = this.getBBox(),\r\n                    bbt = this.getBBox(1),\r\n                    dx = bb.x - bbt.x,\r\n                    dy = bb.y - bbt.y;\r\n                o.coordorigin = (dx * -zoom) + S + (dy * -zoom);\r\n                setCoords(this, 1, 1, dx, dy, 0);\r\n            } else {\r\n                o.style.filter = E;\r\n                setCoords(this, split.scalex, split.scaley, split.dx, split.dy, split.rotate);\r\n            }\r\n        } else {\r\n            o.style.filter = E;\r\n            skew.matrix = Str(matrix);\r\n            skew.offset = matrix.offset();\r\n        }\r\n        if (oldt !== null) { // empty string value is true as well\r\n            this._.transform = oldt;\r\n            R._extractTransform(this, oldt);\r\n        }\r\n        return this;\r\n    };\r\n    elproto.rotate = function (deg, cx, cy) {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        if (deg == null) {\r\n            return;\r\n        }\r\n        deg = Str(deg).split(separator);\r\n        if (deg.length - 1) {\r\n            cx = toFloat(deg[1]);\r\n            cy = toFloat(deg[2]);\r\n        }\r\n        deg = toFloat(deg[0]);\r\n        (cy == null) && (cx = cy);\r\n        if (cx == null || cy == null) {\r\n            var bbox = this.getBBox(1);\r\n            cx = bbox.x + bbox.width / 2;\r\n            cy = bbox.y + bbox.height / 2;\r\n        }\r\n        this._.dirtyT = 1;\r\n        this.transform(this._.transform.concat([["r", deg, cx, cy]]));\r\n        return this;\r\n    };\r\n    elproto.translate = function (dx, dy) {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        dx = Str(dx).split(separator);\r\n        if (dx.length - 1) {\r\n            dy = toFloat(dx[1]);\r\n        }\r\n        dx = toFloat(dx[0]) || 0;\r\n        dy = +dy || 0;\r\n        if (this._.bbox) {\r\n            this._.bbox.x += dx;\r\n            this._.bbox.y += dy;\r\n        }\r\n        this.transform(this._.transform.concat([["t", dx, dy]]));\r\n        return this;\r\n    };\r\n    elproto.scale = function (sx, sy, cx, cy) {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        sx = Str(sx).split(separator);\r\n        if (sx.length - 1) {\r\n            sy = toFloat(sx[1]);\r\n            cx = toFloat(sx[2]);\r\n            cy = toFloat(sx[3]);\r\n            isNaN(cx) && (cx = null);\r\n            isNaN(cy) && (cy = null);\r\n        }\r\n        sx = toFloat(sx[0]);\r\n        (sy == null) && (sy = sx);\r\n        (cy == null) && (cx = cy);\r\n        if (cx == null || cy == null) {\r\n            var bbox = this.getBBox(1);\r\n        }\r\n        cx = cx == null ? bbox.x + bbox.width / 2 : cx;\r\n        cy = cy == null ? bbox.y + bbox.height / 2 : cy;\r\n\r\n        this.transform(this._.transform.concat([["s", sx, sy, cx, cy]]));\r\n        this._.dirtyT = 1;\r\n        return this;\r\n    };\r\n    elproto.hide = function () {\r\n        !this.removed && (this.node.style.display = "none");\r\n        return this;\r\n    };\r\n    elproto.show = function () {\r\n        !this.removed && (this.node.style.display = E);\r\n        return this;\r\n    };\r\n    // Needed to fix the vml setViewBox issues\r\n    elproto.auxGetBBox = R.el.getBBox;\r\n    elproto.getBBox = function(){\r\n        var b = this.auxGetBBox();\r\n        if (this.paper && this.paper._viewBoxShift)\r\n        {\r\n            var c = {};\r\n            var z = 1/this.paper._viewBoxShift.scale;\r\n            c.x = b.x - this.paper._viewBoxShift.dx;\r\n            c.x *= z;\r\n            c.y = b.y - this.paper._viewBoxShift.dy;\r\n            c.y *= z;\r\n            c.width  = b.width  * z;\r\n            c.height = b.height * z;\r\n            c.x2 = c.x + c.width;\r\n            c.y2 = c.y + c.height;\r\n            return c;\r\n        }\r\n        return b;\r\n    };\r\n    elproto._getBBox = function () {\r\n        if (this.removed) {\r\n            return {};\r\n        }\r\n        return {\r\n            x: this.X + (this.bbx || 0) - this.W / 2,\r\n            y: this.Y - this.H,\r\n            width: this.W,\r\n            height: this.H\r\n        };\r\n    };\r\n    elproto.remove = function () {\r\n        if (this.removed || !this.node.parentNode) {\r\n            return;\r\n        }\r\n        this.paper.__set__ && this.paper.__set__.exclude(this);\r\n        R.eve.unbind("raphael.*.*." + this.id);\r\n        R._tear(this, this.paper);\r\n        this.node.parentNode.removeChild(this.node);\r\n        this.shape && this.shape.parentNode.removeChild(this.shape);\r\n        for (var i in this) {\r\n            this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;\r\n        }\r\n        this.removed = true;\r\n    };\r\n    elproto.attr = function (name, value) {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        if (name == null) {\r\n            var res = {};\r\n            for (var a in this.attrs) if (this.attrs[has](a)) {\r\n                res[a] = this.attrs[a];\r\n            }\r\n            res.gradient && res.fill == "none" && (res.fill = res.gradient) && delete res.gradient;\r\n            res.transform = this._.transform;\r\n            return res;\r\n        }\r\n        if (value == null && R.is(name, "string")) {\r\n            if (name == fillString && this.attrs.fill == "none" && this.attrs.gradient) {\r\n                return this.attrs.gradient;\r\n            }\r\n            var names = name.split(separator),\r\n                out = {};\r\n            for (var i = 0, ii = names.length; i < ii; i++) {\r\n                name = names[i];\r\n                if (name in this.attrs) {\r\n                    out[name] = this.attrs[name];\r\n                } else if (R.is(this.paper.customAttributes[name], "function")) {\r\n                    out[name] = this.paper.customAttributes[name].def;\r\n                } else {\r\n                    out[name] = R._availableAttrs[name];\r\n                }\r\n            }\r\n            return ii - 1 ? out : out[names[0]];\r\n        }\r\n        if (this.attrs && value == null && R.is(name, "array")) {\r\n            out = {};\r\n            for (i = 0, ii = name.length; i < ii; i++) {\r\n                out[name[i]] = this.attr(name[i]);\r\n            }\r\n            return out;\r\n        }\r\n        var params;\r\n        if (value != null) {\r\n            params = {};\r\n            params[name] = value;\r\n        }\r\n        value == null && R.is(name, "object") && (params = name);\r\n        for (var key in params) {\r\n            eve("raphael.attr." + key + "." + this.id, this, params[key]);\r\n        }\r\n        if (params) {\r\n            for (key in this.paper.customAttributes) if (this.paper.customAttributes[has](key) && params[has](key) && R.is(this.paper.customAttributes[key], "function")) {\r\n                var par = this.paper.customAttributes[key].apply(this, [].concat(params[key]));\r\n                this.attrs[key] = params[key];\r\n                for (var subkey in par) if (par[has](subkey)) {\r\n                    params[subkey] = par[subkey];\r\n                }\r\n            }\r\n            // this.paper.canvas.style.display = "none";\r\n            if (params.text && this.type == "text") {\r\n                this.textpath.string = params.text;\r\n            }\r\n            setFillAndStroke(this, params);\r\n            // this.paper.canvas.style.display = E;\r\n        }\r\n        return this;\r\n    };\r\n    elproto.toFront = function () {\r\n        !this.removed && this.node.parentNode.appendChild(this.node);\r\n        this.paper && this.paper.top != this && R._tofront(this, this.paper);\r\n        return this;\r\n    };\r\n    elproto.toBack = function () {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        if (this.node.parentNode.firstChild != this.node) {\r\n            this.node.parentNode.insertBefore(this.node, this.node.parentNode.firstChild);\r\n            R._toback(this, this.paper);\r\n        }\r\n        return this;\r\n    };\r\n    elproto.insertAfter = function (element) {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        if (element.constructor == R.st.constructor) {\r\n            element = element[element.length - 1];\r\n        }\r\n        if (element.node.nextSibling) {\r\n            element.node.parentNode.insertBefore(this.node, element.node.nextSibling);\r\n        } else {\r\n            element.node.parentNode.appendChild(this.node);\r\n        }\r\n        R._insertafter(this, element, this.paper);\r\n        return this;\r\n    };\r\n    elproto.insertBefore = function (element) {\r\n        if (this.removed) {\r\n            return this;\r\n        }\r\n        if (element.constructor == R.st.constructor) {\r\n            element = element[0];\r\n        }\r\n        element.node.parentNode.insertBefore(this.node, element.node);\r\n        R._insertbefore(this, element, this.paper);\r\n        return this;\r\n    };\r\n    elproto.blur = function (size) {\r\n        var s = this.node.runtimeStyle,\r\n            f = s.filter;\r\n        f = f.replace(blurregexp, E);\r\n        if (+size !== 0) {\r\n            this.attrs.blur = size;\r\n            s.filter = f + S + ms + ".Blur(pixelradius=" + (+size || 1.5) + ")";\r\n            s.margin = R.format("-{0}px 0 0 -{0}px", round(+size || 1.5));\r\n        } else {\r\n            s.filter = f;\r\n            s.margin = 0;\r\n            delete this.attrs.blur;\r\n        }\r\n        return this;\r\n    };\r\n\r\n    R._engine.path = function (pathString, vml) {\r\n        var el = createNode("shape");\r\n        el.style.cssText = cssDot;\r\n        el.coordsize = zoom + S + zoom;\r\n        el.coordorigin = vml.coordorigin;\r\n        var p = new Element(el, vml),\r\n            attr = {fill: "none", stroke: "#000"};\r\n        pathString && (attr.path = pathString);\r\n        p.type = "path";\r\n        p.path = [];\r\n        p.Path = E;\r\n        setFillAndStroke(p, attr);\r\n        vml.canvas.appendChild(el);\r\n        var skew = createNode("skew");\r\n        skew.on = true;\r\n        el.appendChild(skew);\r\n        p.skew = skew;\r\n        p.transform(E);\r\n        return p;\r\n    };\r\n    R._engine.rect = function (vml, x, y, w, h, r) {\r\n        var path = R._rectPath(x, y, w, h, r),\r\n            res = vml.path(path),\r\n            a = res.attrs;\r\n        res.X = a.x = x;\r\n        res.Y = a.y = y;\r\n        res.W = a.width = w;\r\n        res.H = a.height = h;\r\n        a.r = r;\r\n        a.path = path;\r\n        res.type = "rect";\r\n        return res;\r\n    };\r\n    R._engine.ellipse = function (vml, x, y, rx, ry) {\r\n        var res = vml.path(),\r\n            a = res.attrs;\r\n        res.X = x - rx;\r\n        res.Y = y - ry;\r\n        res.W = rx * 2;\r\n        res.H = ry * 2;\r\n        res.type = "ellipse";\r\n        setFillAndStroke(res, {\r\n            cx: x,\r\n            cy: y,\r\n            rx: rx,\r\n            ry: ry\r\n        });\r\n        return res;\r\n    };\r\n    R._engine.circle = function (vml, x, y, r) {\r\n        var res = vml.path(),\r\n            a = res.attrs;\r\n        res.X = x - r;\r\n        res.Y = y - r;\r\n        res.W = res.H = r * 2;\r\n        res.type = "circle";\r\n        setFillAndStroke(res, {\r\n            cx: x,\r\n            cy: y,\r\n            r: r\r\n        });\r\n        return res;\r\n    };\r\n    R._engine.image = function (vml, src, x, y, w, h) {\r\n        var path = R._rectPath(x, y, w, h),\r\n            res = vml.path(path).attr({stroke: "none"}),\r\n            a = res.attrs,\r\n            node = res.node,\r\n            fill = node.getElementsByTagName(fillString)[0];\r\n        a.src = src;\r\n        res.X = a.x = x;\r\n        res.Y = a.y = y;\r\n        res.W = a.width = w;\r\n        res.H = a.height = h;\r\n        a.path = path;\r\n        res.type = "image";\r\n        fill.parentNode == node && node.removeChild(fill);\r\n        fill.rotate = true;\r\n        fill.src = src;\r\n        fill.type = "tile";\r\n        res._.fillpos = [x, y];\r\n        res._.fillsize = [w, h];\r\n        node.appendChild(fill);\r\n        setCoords(res, 1, 1, 0, 0, 0);\r\n        return res;\r\n    };\r\n    R._engine.text = function (vml, x, y, text) {\r\n        var el = createNode("shape"),\r\n            path = createNode("path"),\r\n            o = createNode("textpath");\r\n        x = x || 0;\r\n        y = y || 0;\r\n        text = text || "";\r\n        path.v = R.format("m{0},{1}l{2},{1}", round(x * zoom), round(y * zoom), round(x * zoom) + 1);\r\n        path.textpathok = true;\r\n        o.string = Str(text);\r\n        o.on = true;\r\n        el.style.cssText = cssDot;\r\n        el.coordsize = zoom + S + zoom;\r\n        el.coordorigin = "0 0";\r\n        var p = new Element(el, vml),\r\n            attr = {\r\n                fill: "#000",\r\n                stroke: "none",\r\n                font: R._availableAttrs.font,\r\n                text: text\r\n            };\r\n        p.shape = el;\r\n        p.path = path;\r\n        p.textpath = o;\r\n        p.type = "text";\r\n        p.attrs.text = Str(text);\r\n        p.attrs.x = x;\r\n        p.attrs.y = y;\r\n        p.attrs.w = 1;\r\n        p.attrs.h = 1;\r\n        setFillAndStroke(p, attr);\r\n        el.appendChild(o);\r\n        el.appendChild(path);\r\n        vml.canvas.appendChild(el);\r\n        var skew = createNode("skew");\r\n        skew.on = true;\r\n        el.appendChild(skew);\r\n        p.skew = skew;\r\n        p.transform(E);\r\n        return p;\r\n    };\r\n    R._engine.setSize = function (width, height) {\r\n        var cs = this.canvas.style;\r\n        this.width = width;\r\n        this.height = height;\r\n        width == +width && (width += "px");\r\n        height == +height && (height += "px");\r\n        cs.width = width;\r\n        cs.height = height;\r\n        cs.clip = "rect(0 " + width + " " + height + " 0)";\r\n        if (this._viewBox) {\r\n            R._engine.setViewBox.apply(this, this._viewBox);\r\n        }\r\n        return this;\r\n    };\r\n    R._engine.setViewBox = function (x, y, w, h, fit) {\r\n        R.eve("raphael.setViewBox", this, this._viewBox, [x, y, w, h, fit]);\r\n        var paperSize = this.getSize(),\r\n            width = paperSize.width,\r\n            height = paperSize.height,\r\n            H, W;\r\n        if (fit) {\r\n            H = height / h;\r\n            W = width / w;\r\n            if (w * H < width) {\r\n                x -= (width - w * H) / 2 / H;\r\n            }\r\n            if (h * W < height) {\r\n                y -= (height - h * W) / 2 / W;\r\n            }\r\n        }\r\n        this._viewBox = [x, y, w, h, !!fit];\r\n        this._viewBoxShift = {\r\n            dx: -x,\r\n            dy: -y,\r\n            scale: paperSize\r\n        };\r\n        this.forEach(function (el) {\r\n            el.transform("...");\r\n        });\r\n        return this;\r\n    };\r\n    var createNode;\r\n    R._engine.initWin = function (win) {\r\n        var doc = win.document;\r\n        if (doc.styleSheets.length < 31) {\r\n            doc.createStyleSheet().addRule(".rvml", "behavior:url(#default#VML)");\r\n        } else {\r\n            // no more room, add to the existing one\r\n            // http://msdn.microsoft.com/en-us/library/ms531194%28VS.85%29.aspx\r\n            doc.styleSheets[0].addRule(".rvml", "behavior:url(#default#VML)");\r\n        }\r\n        try {\r\n            !doc.namespaces.rvml && doc.namespaces.add("rvml", "urn:schemas-microsoft-com:vml");\r\n            createNode = function (tagName) {\r\n                return doc.createElement(\'<rvml:\' + tagName + \' class="rvml">\');\r\n            };\r\n        } catch (e) {\r\n            createNode = function (tagName) {\r\n                return doc.createElement(\'<\' + tagName + \' xmlns="urn:schemas-microsoft.com:vml" class="rvml">\');\r\n            };\r\n        }\r\n    };\r\n    R._engine.initWin(R._g.win);\r\n    R._engine.create = function () {\r\n        var con = R._getContainer.apply(0, arguments),\r\n            container = con.container,\r\n            height = con.height,\r\n            s,\r\n            width = con.width,\r\n            x = con.x,\r\n            y = con.y;\r\n        if (!container) {\r\n            throw new Error("VML container not found.");\r\n        }\r\n        var res = new R._Paper,\r\n            c = res.canvas = R._g.doc.createElement("div"),\r\n            cs = c.style;\r\n        x = x || 0;\r\n        y = y || 0;\r\n        width = width || 512;\r\n        height = height || 342;\r\n        res.width = width;\r\n        res.height = height;\r\n        width == +width && (width += "px");\r\n        height == +height && (height += "px");\r\n        res.coordsize = zoom * 1e3 + S + zoom * 1e3;\r\n        res.coordorigin = "0 0";\r\n        res.span = R._g.doc.createElement("span");\r\n        res.span.style.cssText = "position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";\r\n        c.appendChild(res.span);\r\n        cs.cssText = R.format("top:0;left:0;display:inline-block;position:absolute;clip:rect(0 {0} {1} 0);", width, height);\r\n        if (container == 1) {\r\n            R._g.doc.body.appendChild(c);\r\n            cs.left = x + "px";\r\n            cs.top = y + "px";\r\n            cs.position = "absolute";\r\n        } else {\r\n            if (container.firstChild) {\r\n                container.insertBefore(c, container.firstChild);\r\n            } else {\r\n                container.appendChild(c);\r\n            }\r\n        }\r\n        res.renderfix = function () {};\r\n        return res;\r\n    };\r\n    R.prototype.clear = function () {\r\n        R.eve("raphael.clear", this);\r\n        this.canvas.innerHTML = E;\r\n        this.span = R._g.doc.createElement("span");\r\n        this.span.style.cssText = "position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";\r\n        this.canvas.appendChild(this.span);\r\n        this.bottom = this.top = null;\r\n    };\r\n    R.prototype.remove = function () {\r\n        R.eve("raphael.remove", this);\r\n        this.canvas.parentNode.removeChild(this.canvas);\r\n        for (var i in this) {\r\n            this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;\r\n        }\r\n        return true;\r\n    };\r\n\r\n    var setproto = R.st;\r\n    for (var method in elproto) if (elproto[has](method) && !setproto[has](method)) {\r\n        setproto[method] = (function (methodname) {\r\n            return function () {\r\n                var arg = arguments;\r\n                return this.forEach(function (el) {\r\n                    el[methodname].apply(el, arg);\r\n                });\r\n            };\r\n        })(method);\r\n    }\r\n}));\r\n\r\n// ┌────────────────────────────────────────────────────────────────────┐ \\\\\r\n// │ Raphaël 2.1.4 - JavaScript Vector Library                      │ \\\\\r\n// ├────────────────────────────────────────────────────────────────────┤ \\\\\r\n// │ Copyright © 2008-2012 Dmitry Baranovskiy (http://raphaeljs.com)    │ \\\\\r\n// │ Copyright © 2008-2012 Sencha Labs (http://sencha.com)              │ \\\\\r\n// ├────────────────────────────────────────────────────────────────────┤ \\\\\r\n// │ Licensed under the MIT (http://raphaeljs.com/license.html) license.│ \\\\\r\n// └────────────────────────────────────────────────────────────────────┘ \\\\\r\n\r\n(function (glob, factory) {\r\n    if (typeof define === "function" && define.amd) {\r\n        define("raphael", ["raphael.core", "raphael.svg", "raphael.vml"], function(Raphael) {\r\n            return factory(Raphael);\r\n        });\r\n    } else if (typeof exports === "object") {\r\n        var raphael = require("raphael.core");\r\n\r\n        require("raphael.svg");\r\n        require("raphael.vml");\r\n\r\n        module.exports = factory(raphael);\r\n    } else {\r\n        //glob.Raphael = factory(glob.Raphael);\r\n    }\r\n}(this, function (Raphael) {\r\n    return Raphael.ninja();\r\n}));'},,,function(e,t,n){n(546),n(113),n(125),n(547),n(548),n(549),n(550),n(551),n(552),n(553),n(554),n(555),n(556),n(557),n(558),n(559),n(560),n(561),n(247),n(114),n(115),n(116),n(117),n(118),n(119),n(120),n(121),n(248),n(249),n(122),n(123),n(124),n(250),n(251),n(387),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(111),n(260),n(70),n(69),n(112),n(43),n(261),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(126),n(127),n(128),n(129),n(130),n(131),n(132),n(133),n(134),n(135),n(136),n(137),n(283),n(284),n(285),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(138),n(139),n(140),n(141),n(142),n(143),n(144),n(145),n(146),n(147),n(148),n(149),n(150),n(151),n(152),n(153),n(154),n(155),n(156),n(157),n(158),n(298),n(299),n(159),n(160),n(161),n(162),n(163),n(164),n(165),n(166),n(167),n(168),n(169),n(170),n(171),n(172),n(173),n(174),n(175),n(176),n(177),n(178),n(179),n(180),n(181),n(182),n(183),n(184),n(185),n(186),n(187),n(188),n(189),n(190),n(191),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(199),n(200),n(201),n(202),n(203),n(71),n(204),n(72),n(42),n(205),n(206),n(562),n(563),n(564),n(565),n(566),n(567),n(568),n(569),n(570),n(571),n(572),n(246),n(301),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(347),n(348),n(349),n(350),n(351),n(352),n(353),n(354),n(355),n(356),n(357),n(358),n(359),n(360),n(361),n(362),n(363),n(364),n(365),n(366),n(367),n(368),n(369),n(370),n(371),n(372),n(373),n(374),n(375),n(376),n(377),n(378),n(379),n(380),n(381),n(382),n(383),n(384),n(385),n(573),n(574),n(575),n(576),e.exports=n(386)},function(e,t){BI.addI18n({"BI-Conf_Formula_Water_Mark":"示例=销售额 / 计划销售额","BI-Conf_Formula_Time_Field":"时间字段","BI-Conf_Formula_Text_Field":"文本字段","BI-Conf_Formula_Logic_Function":"逻辑函数","BI-Conf_Formula_Numberic_Function":"数学和三角函数","BI-Conf_Formula_Numberic_Field":"数值字段","BI-Conf_Formula_Other_Function":"其他函数","BI-Conf_Formula_Array_Function":"数组函数","BI-Conf_Formula_Valid":"公式不合法","BI-Basic_Common_Function":"常用函数","BI-Conf_Formula_Time_Function":"日期函数","BI-Conf_Formula_Text_Function":"文本函数","BI-Formula_Function_Tip1":"• 请从左侧面板中选择字段名和函数","BI-Formula_Function_Tip2":"• 公式编辑举例：IF(<span class='fieldName'>销售额</span>>0,<span class='fieldName'>销售额</span>),0)","BI-Formula_Help_Document":"查看公式使用的帮助文档","BI-Basic_Function":"函数","BI-Basic_Formula_Invalid":"公式不合法","BI-Basic_Formula_Valid":"公式合法","BI-Basic_Add_And_Condition":"添加条件(且)","BI-Basic_Add_Or_Condition":"添加条件(或)","BI-Basic_Add_And_Formula":"添加公式(且)","BI-Basic_Add_Or_Formula":"添加公式(或)","BI-Basic_And_Condition":"且条件","BI-Basic_Or_Condition":"或条件","BI-Basic_Beautify_Level":"优化展示层级","BI-Basic_Default":"默认","BI-Basic_Sim_Hei":"黑体","BI-Basic_Sim_Sun":"宋体","BI-Basic_Fang_Song":"仿宋","BI-Basic_Kai_Ti":"楷体","BI-Basic_Formula_Data_Items":"数据项","BI-Basic_Formula_Vars":"变量","BI-Basic_Formula_Data_Set_Vars":"数据集参数","BI-Basic_Formula_Report_Vars":"报表参数","BI-Basic_Formula_Global_Vars":"全局参数","BI-Basic_Formula_Watermark":"提示:您可以通过输入B1来写入第一行第二列的数据。","BI-Basic_Parameter_Insert":"插入","BI-Basic_Parameter_Delete":"删除","BI-Basic_Parameter_Move_Up":"上移","BI-Basic_Parameter_Move_Down":"下移","BI-Basic_Parameter_Refresh":"刷新","BI-Basic_Parameter_Name":"参数","BI-Basic_Parameter_Value":"值","BI-Basic_Parameter_Please_Set_Parameter_Name":"请先设置参数名","BI-Basic_Parameter_Type_String":"字符串","BI-Basic_Parameter_Type_Int":"整型","BI-Basic_Parameter_Type_Number":"双精度型","BI-Basic_Parameter_Type_Date":"日期","BI-Basic_Parameter_Type_Boolean":"布尔型","BI-Basic_Parameter_Type_Formula":"公式","BI-Basic_Parameter_Delete_Confirm":"你确定决定删除选中的项？","BI-Basic_Parameter_Delete_Alert":"当前列表为空或者你没有选中任何项","BI-Basic_Export_Or_Edit_Keep_Formula":"导出/编辑结果时，保留公式","BI-Basic_Report_Or_Analyze_Keep_Formula":"填报/分析时，保留公式用于计算","BI-Basic_Please_Input_Formula":"请在下面的编辑框里面输入公式:","BI-Basic_Charset":"编码","BI-Basic_Function_Type":"函数类型：","BI-Basic_Function_Name":"函数名：","BI-Basic_Vars":"变量：","BI-Basic_Function_Description":"公式说明：","BI-Basic_Check_Validation":"检查合法性","BI-Expression_syntax_error":"语法错误，缺少标示符","BI-Front-Expression_param_number":"{R1}:不符合(数值)的参数要求","BI-Front-Expression_param_text":"{R1}:不符合(文本)的参数要求","BI-Front-Expression_param_multi_any_type":"{R1}:不符合(任意类型...)的参数要求","BI-Front-Expression_param_two_any":"{R1}:不符合(任意类型,任意类型)的参数要求","BI-Front-Expression_param_two_number":"{R1}:不符合(数值,数值)的参数要求","BI-Front-Expression_param_number_number_default":"{R1}:不符合(数值) 或 (数值,数值)的参数要求","BI-Front-Expression_param_all_number:":"{R1}:不符合(数值...)的参数要求","BI-Front-Expression_param_none":"{R1}:不符合()的参数要求","BI-Front-Expression_param_multi_number_or_text":"{R1}:不符合(数值/文本,数值/文本,数值/文本)的参数要求","BI-Front-Expression_param_date_or_text_number":"{R1}:不符合(日期/文本,数值)的参数要求","BI-Front-Expression_param_two_date_text_and_text":"{R1}:不符合(日期/文本,日期/文本,文本)的参数要求","BI-Front-Expression_param_one_date_or_text":"{R1}:不符合(日期/文本) 的参数要求","BI-Front-Expression_param_date_precision":"{R1}:不符合() 或 (日期/文本)或 (日期/文本,文本)的参数要求","BI-Front-Expression_param_two_dateText_textNumber_default":"{R1}:不符合(日期/文本,日期/文本,文本/数值)的参数要求","BI-Front-Expression_param_to_date":"{R1}:不符合(任意类型) 或 (文本,文本)或(文本,文本,文本)的参数要求","BI-Front-Expression_param_four_number_or_text":"{R1}:不符合(数值/文本,数值/文本,数值/文本,数值/文本)的参数要求","BI-Front-Expression_param_two_any_number_default":"{R1}:不符合(任意类型,任意类型) 或 (任意类型,任意类型,数值) 的参数要求","BI-Front-Expression_param_any_text":"{R1}:不符合 (任意类型,文本) 的参数要求","BI-Front-Expression_param_any_number":"{R1}:不符合(任意类型,数值)的参数要求","BI-Front-Expression_param_any_number_default":"{R1}:不符合(任意类型) 或 (任意类型,数值)的参数要求","BI-Front-Expression_param_one_any_type":"{R1}:不符合(任意类型) 的参数要求","BI-Front-Expression_param_any_number_number":"{R1}:不符合(任意类型,数值,数值)的参数要求","BI-Front-Expression_param_number_bool_default":"{R1}:不符合 (数值)或(数值,布尔)的参数要求","BI-Front-Expression_param_text_text_number_default":"{R1}:不符合(文本,文本) 或 (文本,文本,数值) 的参数要求","BI-Front-Expression_param_three_text_or_text_two_number_text":"{R1}:不符合 (任意类型,任意类型,任意类型) 或 (任意类型,数值,数值,任意类型) 的参数要求","BI-Front-Expression_param_three_any_number_default":" {R1}:不符合(任意类型,任意类型,任意类型,[数值])的参数要求","BI-Front-Expression_logic_if_three_param":"{R1}:不符合(布尔/数值,参数,参数)的参数要求","BI-Front-Expression_nvl_param_same":"{R1}:不符合所有参数为相同类型的要求","BI-Front-Expression_param_numbera_default":"{R1}:不符合() 或 (数值)的参数要求"})},function(e,t){BI.FilterDateItem=BI.inherit(BI.AbstractFilterItem,{_constant:{LEFT_ITEMS_H_GAP:5,CONTAINER_HEIGHT:40,BUTTON_HEIGHT:24,COMBO_WIDTH:128,FIELD_NAME_BUTTON_WIDTH:90,TEXT_BUTTON_H_GAP:0,INPUT_WIDTH:230,TIME_INTERVAL_HEIGHT:24},props:{baseCls:"bi-date-item bi-filter-item bi-border-left bi-border-bottom",afterValueChange:BI.emptyFn,onDelete:BI.emptyFn,text:"",filterType:"",filterValue:""},render:function(){var t=this,e=this.options;return this._refreshFilterWidget(e.filterType,e.filterValue),[{type:"bi.vertical",items:[{lgap:10,el:{type:"bi.left",items:[{type:"bi.vertical_adapt",height:this._constant.CONTAINER_HEIGHT,items:[{rgap:2*this._constant.LEFT_ITEMS_H_GAP,el:{type:"bi.text_button",text:e.text,title:e.text,height:this._constant.BUTTON_HEIGHT,textAlign:"left",hgap:this._constant.TEXT_BUTTON_H_GAP,listeners:[{eventName:"__EVENT_CHANGE__",action:function(){t.fireEvent("__EVENT_CHANGE__",BI.Events.CLICK,"",t)}}]}}]},{type:"bi.vertical_adapt",height:this._constant.CONTAINER_HEIGHT,items:[{rgap:2*this._constant.LEFT_ITEMS_H_GAP,el:{type:"bi.text_value_down_list_combo",width:this._constant.COMBO_WIDTH,height:this._constant.BUTTON_HEIGHT,items:[[{text:"类型1",value:1},{text:"类型2",value:2}],[{text:"类型3",value:3}]],listeners:[{eventName:"EVENT_CHANGE",action:function(){var e=this.getValue()[0];t._refreshFilterWidget(e),t.filterWidgetContainer.populate([t.filterWidget]),t._setNodeData({filterType:e}),t.options.afterValueChange()}}],ref:function(e){t.filterType=e}}}]},{type:"bi.vertical_adapt",height:this._constant.CONTAINER_HEIGHT,items:[{rgap:2*this._constant.LEFT_ITEMS_H_GAP+30,el:{type:"bi.button_group",items:[this.filterWidget],layouts:[{type:"bi.left"}],ref:function(e){t.filterWidgetContainer=e}}}]}]}}]},{type:"bi.absolute",items:[{el:{type:"bi.icon_button",cls:"delete-font delete-button",listeners:[{eventName:"__EVENT_CHANGE__",action:function(){t.fireEvent("__EVENT_CHANGE__",BI.Events.DESTROY,e.id,t),e.onDelete(e.id)}}]},top:12,right:10}]}]},_refreshFilterWidget:function(e,t){switch(e){case 1:this._createTimeRange(t);break;case 2:this._createDate(t);break;default:this._createDateN(t)}},_createDateN:function(e){var t=this;this.filterWidget=BI.createWidget({type:"bi.sign_editor",height:this._constant.BUTTON_HEIGHT-2,listeners:[{eventName:"EVENT_CHANGE",action:function(){var e=this.getValue();t._setNodeData({filterValue:e}),t.options.afterValueChange()}}]}),BI.isNotNull(e)&&this.filterWidget.setValue(e)},_createTimeRange:function(e){var t=this;this.filterWidget=BI.createWidget({type:"bi.time_interval",width:280,height:this._constant.TIME_INTERVAL_HEIGHT,listeners:[{eventName:"EVENT_CHANGE",action:function(){var e=this.getValue();t._setNodeData({filterValue:e}),t.options.afterValueChange()}}]}),BI.isNotNull(e)&&this.filterWidget.setValue(e)},_createDate:function(e){var t=this;this.filterWidget=BI.createWidget({type:"bi.dynamic_date_combo",width:130,height:this._constant.TIME_INTERVAL_HEIGHT,listeners:[{eventName:"EVENT_CONFIRM",action:function(){var e=this.getValue();t._setNodeData({filterValue:e}),t.options.afterValueChange()}}]}),BI.isNotNull(e)&&this.filterWidget.setValue(e)},_setNodeData:function(e){var t=this.options;t.node.set("data",BI.extend(t.node.get("data"),e))},populate:function(e,t,n){this.filterType.setValue(n.filterType),this._refreshFilterWidget(n.filterType,n.filterValue)},getValue:function(){return{}}}),BI.shortcut("bi.filter.date.item",BI.FilterDateItem)},function(e,t){var n,r,i,o,a;n=10,r=40,i=2,o=24,a=500,BI.NoTypeItem=BI.inherit(BI.AbstractFilterItem,{props:{baseCls:"bi-no-type-item bi-filter-item bi-border-left bi-border-bottom",afterValueChange:BI.emptyFn,onDelete:BI.emptyFn},render:function(){var e=this,t=this.options;return{type:"bi.button_group",ref:function(){e.group=this},items:[{type:"bi.left_right_vertical_adapt",cls:"item-no-type",height:r,items:{left:[this._buildConditionsNoType()],right:[{type:"bi.icon_button",cls:"delete-font delete-button",listeners:[{eventName:"__EVENT_CHANGE__",action:function(){e.fireEvent("__EVENT_CHANGE__",BI.Events.DESTROY,t.id,e),t.onDelete(t.id)}}]}]},lhgap:n,rhgap:10}],layouts:[{type:"bi.vertical",scrolly:!1}]}},_buildConditionsNoType:function(){var t=this;return{type:"bi.combo",isNeedAdjustHeight:!0,adjustLength:i,el:{type:"bi.button",level:"common",height:o,text:"请选择"},popup:{el:{type:"bi.vertical",items:[{type:"bi.button_group",items:[{type:"bi.single_select_item",text:"字段1",value:1},{type:"bi.single_select_item",text:"字段2",value:2},{type:"bi.single_select_item",text:"字段3",value:3}],layouts:[{type:"bi.vertical"}],ref:function(){t.list=this},listeners:[{eventName:"EVENT_CHANGE",action:function(e){t._onTypeSelected(e)}}]}]},minHeight:200,minWidth:150,maxHeight:a}}},createFilterItemByFieldType:function(e){var t,n,r;switch(e){case 1:t=1,n="bi.filter.string.item",r="字段1";break;case 2:t=2,n="bi.filter.number.item",r="字段2";break;case 3:t=3,n="bi.filter.date.item",r="字段3";break;default:n="bi.no.type.item"}return{type:n,filterType:t,text:r}},_onTypeSelected:function(e){var t=this,n=this.options,e=this.createFilterItemByFieldType(e);this.group.populate([BI.extend(e,{id:n.id,node:n.node,cls:"no-type-container",afterValueChange:n.afterValueChange,listeners:[{eventName:"__EVENT_CHANGE__",action:function(){t.fireEvent("__EVENT_CHANGE__",arguments)}}],ref:function(){t.typeSelectedItem=this}})]),n.node.set("data",BI.extend(n.node.get("data"),{value:e.filterType,filterType:e.filterType,text:e.text})),n.afterValueChange()},getValue:function(){return{}}}),BI.shortcut("bi.no.type.item",BI.NoTypeItem)},function(e,t){BI.FilterNumberItem=BI.inherit(BI.AbstractFilterItem,{_constant:{LEFT_ITEMS_H_GAP:5,CONTAINER_HEIGHT:40,BUTTON_HEIGHT:24,COMBO_WIDTH:128,FIELD_NAME_BUTTON_WIDTH:90,TEXT_BUTTON_H_GAP:0,INPUT_WIDTH:200},props:{baseCls:"bi-filter-item bi-number-item bi-border-left bi-border-bottom",afterValueChange:BI.emptyFn,onDelete:BI.emptyFn,text:"",filterType:"",filterValue:""},render:function(){var t=this,e=this.options;return this._refreshFilterWidget(e.filterType,e.filterValue),[{type:"bi.vertical",items:[{lgap:10,el:{type:"bi.left",rgap:2*this._constant.LEFT_ITEMS_H_GAP,items:[{type:"bi.vertical_adapt",height:this._constant.CONTAINER_HEIGHT,items:[{type:"bi.text_button",text:e.text,title:e.text,height:this._constant.BUTTON_HEIGHT,textAlign:"left",hgap:this._constant.TEXT_BUTTON_H_GAP,listeners:[{eventName:"__EVENT_CHANGE__",action:function(){t.fireEvent("__EVENT_CHANGE__",BI.Events.CLICK,"",t)}}]}]},{type:"bi.vertical_adapt",height:this._constant.CONTAINER_HEIGHT,items:[{rgap:2*this._constant.LEFT_ITEMS_H_GAP,el:{type:"bi.text_value_down_list_combo",text:"请选择",width:this._constant.COMBO_WIDTH,height:this._constant.BUTTON_HEIGHT,items:[[{text:"类型1",value:1},{text:"类型2",value:2}],[{text:"类型3",value:3}]],listeners:[{eventName:"EVENT_CHANGE",action:function(){var e=this.getValue()[0];t._refreshFilterWidget(e),t.filterWidgetContainer.populate([t.filterWidget]),t._setNodeData({filterType:e}),t.options.afterValueChange()}}],value:e.filterType,ref:function(e){t.filterType=e}}},{el:{type:"bi.button_group",items:[this.filterWidget],layouts:[{type:"bi.left"}],ref:function(e){t.filterWidgetContainer=e}},rgap:30}]}]}}]},{type:"bi.absolute",items:[{el:{type:"bi.icon_button",cls:"delete-font delete-button",$testId:"bi-dimension-number-filter-item-delete",listeners:[{eventName:"__EVENT_CHANGE__",action:function(){t.fireEvent("__EVENT_CHANGE__",BI.Events.DESTROY,e.id,t),e.onDelete(e.id)}}]},top:12,right:10}]}]},_refreshFilterWidget:function(e,t){switch(e){case 1:this._createNumberIntervalFilter(t);break;case 2:this._createNumberInput(t);break;case 3:this._createNFilter(t);break;default:this.filterWidget=BI.createWidget()}},_createNFilter:function(e){var t=this;this.filterWidget=BI.createWidget({type:"bi.label",height:this._constant.BUTTON_HEIGHT-2,text:"空",listeners:[{eventName:"EVENT_CHANGE",action:function(){var e=this.getValue();t._setNodeData({filterValue:e}),t.options.afterValueChange()}}]}),BI.isNotNull(e)&&this.filterWidget.setValue(e)},_createNumberIntervalFilter:function(e){var t=this;this.filterWidget=BI.createWidget({type:"bi.number_interval",width:this._constant.INPUT_WIDTH,height:this._constant.BUTTON_HEIGHT,listeners:[{eventName:"EVENT_CHANGE",action:function(){var e=this.getValue();t._setNodeData({filterValue:e}),t.options.afterValueChange()}}]}),BI.isNotNull(e)&&this.filterWidget.setValue(e)},_createNumberInput:function(e){var t=this;this.filterWidget=BI.createWidget({type:"bi.sign_editor",cls:"bi-border",validationChecker:function(e){return BI.isNumeric(e)},title:function(){return t.filterWidget&&t.filterWidget.getValue()},allowBlank:!0,height:this._constant.BUTTON_HEIGHT-2,width:this._constant.INPUT_WIDTH-2,listeners:[{eventName:"EVENT_CHANGE",action:function(){var e=this.getValue();t._setNodeData({filterValue:e}),t.options.afterValueChange()}}]}),BI.isNotNull(e)&&this.filterWidget.setValue(e)},_setNodeData:function(e){var t=this.options;t.node.set("data",BI.extend(t.node.get("data"),e))},populate:function(e,t,n){this.filterType.setValue(n.filterType),this._refreshFilterWidget(n.filterType,n.filterValue)},getValue:function(){return{}}}),BI.shortcut("bi.filter.number.item",BI.FilterNumberItem)},function(e,t){BI.FilterStringItem=BI.inherit(BI.AbstractFilterItem,{_constant:{LEFT_ITEMS_H_GAP:5,CONTAINER_HEIGHT:40,BUTTON_HEIGHT:24,COMBO_WIDTH:128,FIELD_NAME_BUTTON_WIDTH:90,TEXT_BUTTON_H_GAP:0,INPUT_WIDTH:200},props:{extraCls:"bi-filter-item bi-string-item bi-border-left bi-border-bottom",afterValueChange:BI.emptyFn,onDelete:BI.emptyFn,text:"",filterType:"",filterValue:""},render:function(){var t=this,e=this.options;return this._refreshFilterWidget(e.filterType,e.filterValue),[{type:"bi.vertical",items:[{lgap:10,el:{type:"bi.left",rgap:2*this._constant.LEFT_ITEMS_H_GAP,items:[{type:"bi.vertical_adapt",height:this._constant.CONTAINER_HEIGHT,items:[{type:"bi.text_button",text:e.text,title:e.text,height:this._constant.BUTTON_HEIGHT,textAlign:"left",hgap:this._constant.TEXT_BUTTON_H_GAP,listeners:[{eventName:"__EVENT_CHANGE__",action:function(){t.fireEvent("__EVENT_CHANGE__",BI.Events.CLICK,"",t)}}]}]},{type:"bi.vertical_adapt",height:this._constant.CONTAINER_HEIGHT,items:[{rgap:2*this._constant.LEFT_ITEMS_H_GAP,el:{type:"bi.text_value_down_list_combo",text:"请选择",width:this._constant.COMBO_WIDTH,height:this._constant.BUTTON_HEIGHT,items:[[{text:"类型1",value:1},{text:"类型2",value:2}],[{text:"类型3",value:3}]],listeners:[{eventName:"EVENT_CHANGE",action:function(){var e=this.getValue()[0];t._refreshFilterWidget(e),t.filterWidgetContainer.populate([t.filterWidget]),t._setNodeData({filterType:e}),t.options.afterValueChange()}}],value:e.filterType,ref:function(e){t.filterType=e}}},{el:{type:"bi.button_group",items:[this.filterWidget],layouts:[{type:"bi.left"}],ref:function(e){t.filterWidgetContainer=e}},ragp:30}]}]}}]},{type:"bi.absolute",items:[{el:{type:"bi.icon_button",cls:"delete-font delete-button",listeners:[{eventName:"__EVENT_CHANGE__",action:function(){t.fireEvent("__EVENT_CHANGE__",BI.Events.DESTROY,e.id,t),e.onDelete(e.id)}}]},top:12,right:10}]}]},_refreshFilterWidget:function(e,t){switch(e){case 1:this._createStringBelongCombo(t);break;case 2:this._createStringInput(t);break;case 3:this._createNInput(t);break;default:this.filterWidget=BI.createWidget()}},_createStringBelongCombo:function(e){this.options;var t=this;this.filterWidget=BI.createWidget({type:"bi.value_chooser_combo",itemsCreator:function(e,t){t(BI.map(BI.range(1,500),function(e){return{text:"选项"+e,value:"选项"+e,title:"选项"+e}}))},value:e,listeners:[{eventName:BI.ValueChooserCombo.EVENT_CONFIRM,action:function(){var e=this.getValue();t._setNodeData({filterValue:e}),t.options.afterValueChange()}}]}),BI.isNotNull(e)&&this.filterWidget.setValue(e)},_createStringInput:function(e){var t=this;this.filterWidget=BI.createWidget({type:"bi.sign_editor",cls:"condition-operator-input bi-border",allowBlank:!0,height:this._constant.BUTTON_HEIGHT-2,width:this._constant.INPUT_WIDTH-2,title:function(){return t.filterWidget&&t.filterWidget.getValue()},listeners:[{eventName:"EVENT_CHANGE",action:function(){var e=this.getValue();t._setNodeData({filterValue:e}),t.options.afterValueChange()}}]}),BI.isNotNull(e)&&this.filterWidget.setValue(e)},_createNInput:function(e){this.filterWidget=BI.createWidget({type:"bi.label",height:this._constant.BUTTON_HEIGHT-2,text:"空"}),BI.isNotNull(e)&&this.filterWidget.setValue(e)},_setNodeData:function(e){var t=this.options;t.node.set("data",BI.extend(t.node.get("data"),e))},getValue:function(){return{}}}),BI.shortcut("bi.filter.string.item",BI.FilterStringItem)},function(e,t){BI.Helper=BI.inherit(BI.Tip,{_defaultConfig:function(){return BI.extend(BI.Helper.superclass._defaultConfig.apply(this,arguments),{extraCls:"bi-helper cursor-drag",text:"",value:"",textAlign:"center"})},_init:function(){BI.Helper.superclass._init.apply(this,arguments),this.populate()},modifyContent:function(e){this.empty(),BI.createWidget({type:"bi.left",element:this,hgap:-5,cls:"dragging-modify",items:[e]})},populate:function(){var e=this.options;this.element.data({helperWidget:this}),this.empty(),BI.createWidget({element:this,type:"bi.label",textAlign:e.textAlign,textHeight:20,hgap:5,text:e.text,value:e.value}),this.element.removeClass("dragging-modify")}}),BI.shortcut("bi.helper",BI.Helper)},function(e,t){BICst=window.BICst||{},BI.isNull(BICst.ErrorCode)&&(BICst.ErrorCode={FORMULA_ERROR:{}}),BICst.FORMULA_STATE={VALID:"valid",INVALID:"invalid",AGG_INVALID:"aggInvalid",FIELD_MISS:"field_miss",NOT_SUPPORT_STRING_OR_DATE:"no_string_or_date",DETAIL_FILTER_NOT_SUPPORT:"detail filter not support"},BICst.FORMULA_WIDGET_FIELD_TYPE={DATE:1,STRING:2,NUMBER:3},BICst.FIELD_STATE={NORMAL:0,FIELD_MISS:1,AGG_IN_DETAIL:2},BICst.AGG_FUNC=["SUM_AGG","AVG_AGG","MEDIAN_AGG","MAX_AGG","MIN_AGG","STDEV_AGG","VAR_AGG","COUNT_AGG","COUNTD_AGG"],BICst.TABLE_CAL_FUNC=["SAM_PERIOD","PREVIOUS_PERIOD","PERIOD_ANLS","RANK_ANLS","TOTAL","ACC_SUM"],BICst.FUNCTION={},BICst.FUNCTION.TEXT=1,BICst.FUNCTION.MATH=2,BICst.FUNCTION.DATE=3,BICst.FUNCTION.ARRAY=4,BICst.FUNCTION.LOGIC=5,BICst.FUNCTION.OTHER=6,BICst.FUNCTION.AGG=7,BICst.FUNCTION.COMMON=8,BICst.FUNCTION.TABLE_CAL=9,BICst.FUNCTION.FIXED_CAL=10,BICst.FUNCTION.ANALYSIS=11,BICst.COLUMN={},BICst.COLUMN.NONE=0,BICst.COLUMN.STRING=16,BICst.COLUMN.NUMBER=32,BICst.COLUMN.DATE=48,BICst.COLUMN.COUNTER=64,BICst.COLUMN.ROW=80,BICst.COLUMN.TARGET_NAME=96,BICst.COLUMN.CALCULATE=97,BICst.COLUMN.TRANSFORM_FROM_NUMBER=98,BICst.COLUMN.TRANSFORM_FROM_CALC=99,BICst.FORMULA_GENERATE_TYPE={},BICst.FORMULA_GENERATE_TYPE.AUTO=0,BICst.FORMULA_GENERATE_TYPE.STRING=1,BICst.FORMULA_GENERATE_TYPE.NUMBER=2,BICst.FORMULA_GENERATE_TYPE.DATE=3,BI.FormulaOriginCollections=BI.FormulaCollections=["ABS","ACC_SUM","ADD2ARRAY","AND","ARRAY","AVERAGE","AVG_AGG","CEILING","CNMONEY","CONCATENATE","COUNT","COUNTD_AGG","COUNT_AGG","DATE","DATE.CN","DATEDELTA","DATEDIF","DATEINMONTH","DATEINQUARTER","DATEINWEEK","DATEINYEAR","DATESUBDATE","DAY","DAYS360","DAYSOFMONTH","DAYSOFQUARTER","DAYSOFYEAR","DAYVALUE","DECIMAL","ENDWITH","ENMONEY","ENNUMBER","EVAL","EVEN","EXACT","EXP","FACT","FILENAME","FILESIZE","FILETYPE","FIND","FLOOR","FORMAT","GREPARRAY","HOUR","IF","INARRAY","INDEX","INDEXOF","INDEXOFARRAY","INT","ISNULL","JOINARRAY","LEFT","LEN","LET","LN","LOG","LOG10","LOWER","LUNAR","MAPARRAY","MAX","MAX_AGG","MEDIAN","MEDIAN_AGG","MID","MIN","MINUTE","MIN_AGG","MOD","MONTH","MONTHDELTA","NOW","NUMTO","OR","PERIOD_ANLS","PREVIOUS_PERIOD","PROMOTION","RAND","RANDBETWEEN","RANGE","RANK","RANK_ANLS","REMOVEARRAY","REPEAT","REPLACE","REVERSEARRAY","RIGHT","ROUND","ROUND5","ROUNDDOWN","ROUNDUP","SAME_PERIOD","SECOND","SEQ","SIGN","SLICEARRAY","SORTARRAY","SPLIT","SQRT","STDEV","STDEV_AGG","SUBSTITUTE","SUM","SUMSQ","SUM_AGG","SWITCH","TIME","TODATE","TODAY","TODOUBLE","TOINTEGER","TOTAL","TREELAYER","TRIM","TRUNC","UNIQUEARRAY","UPPER","UUID","VAR_AGG","WEBIMAGE","WEEK","WEEKDATE","WEEKDAY","WEIGHTEDAVERAGE","YEAR","YEARDELTA","abs","acc_sum","add2array","and","array","average","avg_agg","ceiling","cnmoney","concatenate","count","count_agg","countd_agg","date","datedelta","datedif","dateinmonth","dateinquarter","dateinweek","dateinyear","datesubdate","day","days360","daysofmonth","daysofquarter","daysofyear","dayvalue","decimal","endwith","enmoney","ennumber","eval","even","exact","exp","fact","filename","filesize","filetype","find","floor","format","greparray","hour","if","inarray","index","indexof","indexofarray","int","isnull","joinarray","left","len","let","ln","log","log10","lower","lunar","maparray","max","max_agg","median","median_agg","mid","min","min_agg","minute","mod","month","monthdelta","now","numto","or","period_anls","previous_period","promotion","rand","randbetween","range","rank","rank_anls","removearray","repeat","replace","reversearray","right","round","round5","rounddown","roundup","same_period","second","seq","sign","slicearray","sortarray","split","sqrt","stdev","stdev_agg","substitute","sum","sum_agg","sumsq","switch","time","todate","today","todouble","tointeger","total","treelayer","trim","trunc","uniquearray","upper","uuid","var_agg","webimage","week","weekdate","weekday","weightedaverage","year","yeardelta"],BI.FormulaJSONs=[{def:"ABS(number): 返回指定数字的绝对值。绝对值是指没有正负符号的数值。Number:需要求出绝对值的任意实数。示例:ABS(-1.5)等于1.5。ABS(0)等于0。ABS(2.5)等于2.5。",name:"ABS",type:"MATH"},{def:"ABS(number): 返回指定数字的绝对值。绝对值是指没有正负符号的数值。Number:需要求出绝对值的任意实数。示例:ABS(-1.5)等于1.5。ABS(0)等于0。ABS(2.5)等于2.5。",name:"ABS",type:"COMMON"},{def:'ACC_SUM(X_AGG(array),range)根据横纵轴或行列维度添加的字段对指标进行跨行累计的计算。\n"第一个参数为用户计算的指标，该指标必须为聚合函数或聚合指标；第二个参数range为用户设置计算的范围，0为对所有行进行累计，1为对组内所有行进行累计.\n "示例：acc_sum(sum_agg(array),0)用户横轴轴拖拽销售日期（年分组），则该指标计算结果为，根据销售日期（年）对销量进行分组汇总，然后根据对所有行从上到下进行累加，获得每年的累计销量。',name:"ACC_SUM",type:"TABLE_CAL"},{def:'ADDARRAY(array, insertArray, start):在数组第start个位置插入insertArray中的所有元素，再返回该数组。示例：ADDARRAY([3, 4, 1, 5, 7], [23, 43, 22], 3)返回[3, 4, 23, 43, 22, 1, 5, 7].ADDARRAY([3, 4, 1, 5, 7], "测试", 3)返回[3, 4, "测试", 1, 5, 7].注意：如果start为小于1的数或者不写start参数，则默认从数组的第一位开始插入数组元素。',name:"ADD2ARRAY",type:"ARRAY"},{def:"AND(logical1,logical2,⋯): 当所有参数的值为真时，返回TRUE；当任意参数的值为假时，返回FALSE。Logical1,logical2,⋯:指1到30个需要检验TRUE或FALSE的条件值。备注:    参数必须是逻辑值，或是含有逻辑值的数组或引用。    如果数组或引用中含有文本或空的单元格，则忽略其值。    如果在指定的单元格区域中没有逻辑值，AND函数将返回错误信息*NAME?。示例:AND(1+7=8,5+7=12)等于TRUE。AND(1+7=8,5+7=11)等于FALSE。如果单元格A1到A4的值分别为TRUE、TRUE、FALSE和TRUE，则:AND(A1:A4)等于FALSE。如果单元格A5的值在0~50之间，则: AND(0<A5,A5<50)等于TRUE。",name:"AND",type:"LOGIC"},{def:'ARRAY(arg1,arg2...):返回一个由arg1,arg2,...组成的数组.arg1,arg2,...:字符串或者数字.示例:ARRAY("hello") = ["hello"].ARRAY("hello","world") = ["hello","world"].ARRAY("hello",98) = ["hello",98].ARRAY(67,98) = [67,98].',name:"ARRAY",type:"ARRAY"},{def:"AVERAGE(number1,number2,⋯,countstring): 返回指定数据的平均值。Number1,number2⋯:用于计算平均值的参数; countString:文字、逻辑值是否参与计数。备注:    参数必须是数字，或是含有数字的名称，数组或引用。    如果数组或引用参数中含有文字，逻辑值，默认参与计数，countString为false则不参与计数；    空单元格始终不参与计数，但是，单元格中的零值参与。示例:如果A1:A6被命名为“ages”，分别等于10，23，文字，29，33及25，则:AVERAGE(A1:A6)等于20。AVERAGE(A1:A6, false)等于24。AVERAGE(ages)等于20。如果还有一个年龄为27的，求所有年龄的平均值为: AVERAGE(A1:A6,27)等于21。",name:"AVERAGE",type:"MATH"},{def:"AVG_AGG(array): 根据当前分析维度，动态返回指标字段的汇总平均值，生成结果为一动态数据列，行数与当前分析维度行数一致。\n array必须为非聚合函数公式返回的结果，可以是某指标字段、维度或指标字段与普通公式的计算结果。 \n 示例：用户横轴为维度字段'日'时，纵轴的计算字段AVG_AGG(销量)返回的值为每日的平均销量；当用户横轴为维度字段'月'时，AVG_AGG(销量)返回的值为每月的平均销量。",name:"AVG_AGG",type:"AGG"},{def:"CEILING(number): 将参数number沿绝对值增大的方向，舍入为最接近的整数Number:指待舍入的数值。CEILING(-2.5)等于-3。CEILING(0.5)等于1。",name:"CEILING",type:"MATH"},{def:'CNMONEY(number,unit)返回人民币大写。number:需要转换的数值型的数。unit:单位，"s","b","q","w","sw","bw","qw","y","sy","by","qy","wy"分别代表“拾”，“佰”，“仟”，“万”，“拾万”，“佰万”，“仟万”，“亿”，“拾亿”，“佰亿”，“仟亿”，“万亿”。备注:    单位可以为空，如果为空，则直接将number转换为人民币大写，否则先将number与单位的进制相乘，然后再将相乘的结果转换为人民币大写。示例:CNMONEY(1200)等于壹仟贰佰圆整。CNMONEY(12.5,"w")等于壹拾贰万伍仟圆整。CNMONEY(56.3478,"bw")等于伍仟陆佰叁拾肆万柒仟捌佰圆整。CNMONEY(3.4567,"y")等于叁亿肆仟伍佰陆拾柒万圆整。',name:"CNMONEY",type:"TEXT"},{def:'CONCATENATE(text1,text2,...): 将数个字符串合并成一个字符串。Text1,text2,...:需要合并成单个文本的文本项，可以是字符，数字或是单元格引用。示例:CONCATENATE("Average ","Price")等于“Average Price”。CONCATENATE("1","2")等于12。',name:"CONCATENATE",type:"TEXT"},{def:"COUNT(value1,value2,⋯): 计算数组或数据区域中所含项的个数。Value1,value2,⋯:可包含任何类型数据的参数。",name:"COUNT",type:"MATH"},{def:"COUNTD_AGG(array): 根据当前分析维度，动态返回某字段的去重计数，生成结果为一动态数据列，行数与当前分析维度行数一致。\n \"array必须为非聚合函数公式返回的结果，可以是某指标字段、维度或指标字段与普通公式的计算结果。\n \"示例：用户横轴为维度字段'日'时，纵轴的计算字段COUNTD_AGG(销量)返回的值为每日的销量的去重个数；当用户横轴为维度字段'月'时，COUNTD_AGG(销量)返回的值为每月的销量的去重个数。\"",name:"COUNTD_AGG",type:"AGG"},{def:"COUNT_AGG(array): 根据当前分析维度，动态返回某字段的计数，生成结果为一动态数据列，行数与当前分析维度行数一致。\n array必须为非聚合函数公式返回的结果，可以是某指标字段、维度或指标字段与普通公式的计算结果。\n 示例：用户横轴为维度字段'日'时，纵轴的计算字段COUNT_AGG(销量)返回的值为每日的销量的个数；当用户横轴为维度字段'月'时，COUNT_AGG(销量)返回的值为每月的销量的个数。",name:"COUNT_AGG",type:"AGG"},{def:"DATE(year,month,day): 返回一个表示某一特定日期的系列数。Year:代表年，可为一到四位数。Month:代表月份。若1 month 12，则函数把参数值作为月。若month>12，则函数从年的一月份开始往上累加。例如: DATE(2000,25,2)等于2002年1月2日的系列数。Day:代表日。若日期小于等于某指定月的天数，则函数将此参数值作为日。若日期大于某指定月的天数，则函数从指定月份的第一天开始往上累加。若日期大于两个或多个月的总天数，则函数把减去两个月或多个月的余数加到第三或第四个月上，依此类推。例如:DATE(2000,3,35)等于2000年4月4日的系列数。备注:   若需要处理公式中日期的一部分，如年或月等，则可用此公式。   若年，月和日是函数而不是函数中的常量，则此公式最能体现其作用。示例:DATE(1978, 9, 19) 等于1978-09-19.DATE(1211, 12, 1) 等于1211-12-01.   ",name:"DATE",type:"DATETIME"},{def:"DATE.CN(year,month,day): 返回一个表示某一农历日期的系列数。Year:代表年，可为一到四位数。Month:代表月份。若1 month 12，则函数把参数值作为月。若month>12，则函数从年的一月份开始往上累加。例如: DATE(2000,25,2)等于2002年1月2日的系列数。Day:代表日。若日期小于等于某指定月的天数，则函数将此参数值作为日。若日期大于某指定月的天数，则函数从指定月份的第一天开始往上累加。若日期大于两个或多个月的总天数，则函数把减去两个月或多个月的余数加到第三或第四个月上，依此类推。例如:DATE(2000,3,35)等于2000年4月4日的系列数。备注:   若需要处理公式中日期的一部分，如年或月等，则可用此公式。   若年，月和日是函数而不是函数中的常量，则此公式最能体现其作用。示例:DATE(1978, 9, 19) 等于1978-09-19.DATE(1211, 12, 1) 等于1211-12-01.   ",name:"DATE.CN",type:"DATETIME"},{def:'DATEDELTA(date, deltadays):返回一个日期??date后deltadays的日期。deltaDays可以为正值，负值，零。示例：DATEDELTA("2008-08-08",  -10)等于2008-07-29。DATEDELTA("2008-08-08",   10)等于2008-08-18。',name:"DATEDELTA",type:"DATETIME"},{def:'DATEDIF(start_date,end_date,unit):返回两个指定日期间的天数、月数或年数。Start_date:代表所指定时间段的初始日期。End_date:代表所指定时间段的终止日期。Unit:函数返回信息的类型。若unit=“Y”，则DATEDIF返回指定时间段的年差数。若unit=“M”，则DATEDIF返回指定时间段的月差数。若unit=“D”，则DATEDIF返回指定时间段的日差数。若unit=“MD”，则DATEDIF忽略年和月，返回指定时间段的日差数。若unit=“YM”，则DATEDIF忽略年和日，返回指定时间段的月差数。若unit=“YD”，则DATEDIF忽略年，返回指定时间段的日差数。示例:DATEDIF("2001/2/28","2004/3/20","Y")等于3，即在2001年2月28日与2004年3月20日之间有3个整年。DATEDIF("2001/2/28","2004/3/20","M")等于37，即在2001年2月28日与2004年3月20日之间有36个整月。DATEDIF("2001/2/28","2004/3/20","D")等于1116，即在2001年2月28日与2004年3月20日之间有1116个整天。DATEDIF("2001/2/28","2004/3/20","MD")等于8，即忽略月和年后，2001年2月28日与2004年3月20日的差为8天。DATEDIF("2001/1/28","2004/3/20","YM")等于2，即忽略日和年后，2001年1月28日与2004年3月20日的差为2个月。DATEDIF("2001/2/28","2004/3/20","YD")等于21，即忽略年后，2001年2月28日与2004年3月20日的差为21天。',name:"DATEDIF",type:"DATETIME"},{def:'DATEINMONTH(date, number):函数返回在某一个月当中第几天的日期。示例：DATEINMONTH("2008-08-08", 20) 等于2008-08-20。DATEINMONTH("2008-08-08", -1) 等于2008-08-31。',name:"DATEINMONTH",type:"DATETIME"},{def:'DATEINQUARTER(date, number): 函数返回在某一个季度当中第几天的日期。示例：DATEINQUARTER("2009-05-05", 20)等于 2009-04-20。',name:"DATEINQUARTER",type:"DATETIME"},{def:'DATEINWEEK(date, number):函数返回在某一个星期当中第几天的日期。示例：dateInWeek("2008-08-28", 2)等于2008-08-26。dateInWeek("2008-08-28", -1)等于2008-08-31。如果最后一个参数为-1，返回该日期所在星期的最后一天',name:"DATEINWEEK",type:"DATETIME"},{def:'DATEINYEAR(date, number):函数返回在一年当中第几天的日期。示例：DATEINYEAR(2008,100)等于2008-04-09，等价于DATEINYEAR("2008-08-08",100)，也返回2008-04-09.DATEINYEAR(2008,-1)等于2008-12-31，等价于DATEINYEAR("2008-08-08",-1)，也返回2008-12-31.',name:"DATEINYEAR",type:"DATETIME"},{def:'DATESUBDATE(date1, date2, op):返回两个日期之间的时间差。op表示返回的时间单位："s"，以秒为单位。"m"，以分钟为单位。"h"，以小时为单位。"d"，以天为单位。"w"，以周为单位。示例：DATESUBDATE("2008-08-08", "2008-06-06","h")等于1512。',name:"DATESUBDATE",type:"DATETIME"},{def:'DAY:(serial_number)返回日期中的日。DAY是介于1和31之间的一个数。Serial_number:含有所求的年的日期.备注:FineReport将日期保存为系列数，一个系列数代表一个与之匹配的日期，以方便用户对日期进行数值式计算。在1900年日期系统中，FineReport电子表格将1900年1月1日保存为系列数2，将1900年1月2日保存为系列数3，将1900年1月3日保存为系列数4⋯⋯依此类推。如在1900年日期系统，1998年1月1日存为系列数35796。示例:DAY("2000/1/1")等于1。DAY("2006/05/05")等于5。DAY("1997/04/20")等于20。DAY("2000-1-1", "yyyy-MM-dd")等于1。DAY("2006-05-05", "yyyy-MM-dd")等于5。DAY("1997-04-20", "yyyy-MM-dd")等于20。DAY(35796)等于1。',name:"DAY",type:"DATETIME"},{def:'DAYS360(start_date,end_date,method):按照一年 360 天的算法（每个月以 30 天计，一年共计 12 个月），返回两日期间相差的天数，这在会计计算中将会用到。如果财务系统是基于一年 12 个月，每月 30 天，可用此函数帮助计算支付款项。Start_date 和 end_date :是用于计算期间天数的起止日期。Method : 它指定了在计算中是采用欧洲方法还是美国方法。Method 定义 :FALSE或忽略    美国方法 (NASD)。如果起始日期是一个月的 31 号，则等于同月的 30 号。如果终止日期是一个月的31号，并且起始日期早于 30 号，则终止日期等于下一个月的 1 号，否则，终止日期等于本月的 30 号。TRUE           欧洲方法。无论是起始日期还是终止日期为一个月的 31 号，都将等于本月的 30 号。备注:FineReport将日期保存为系列数，一个系列数代表一个与之匹配的日期，以方便用户对日期进行数值式计算。在1900年日期系统中，FineReport电子表格将1900年1月1日保存为系列数2，将1900年1月2日保存为系列数3，将1900年1月3日保存为系列数4⋯⋯依此类推。如在1900年日期系统，1998年1月1日存为系列数35796。示例:DAYS360("1998/1/30", "1998/2/1") 等于 1',name:"DAYS360",type:"DATETIME"},{def:'DAYSOFMONTH(date):返回从1900年1月后某年某月包含的天数。示例：DAYSOFMONTH("1900-02-01")等于28。DAYSOFMONTH("2008/04/04")等于30。',name:"DAYSOFMONTH",type:"DATETIME"},{def:'DAYSOFQUARTER(date): 返回从1900年1月后某年某季度的天数。示例：DAYSOFQUARTER("2009-02-01")等于90。DAYSOFQUARTER("2009/05/05")等于91。',name:"DAYSOFQUARTER",type:"DATETIME"},{def:'DAYSOFYEAR(year):返回某年包含的天数。示例：DAYSOFYEAR(2008)等于365，等价于DAYSOFYEAR("2008-01-01")。',name:"DAYSOFYEAR",type:"DATETIME"},{def:'DAYVALUE(date):返回1900年至 date日期所经历的天数。示例：DAYVALUE("2008/08/08")等于39668。',name:"DAYVALUE",type:"DATETIME"},{def:"DECIMAL(number): 返回number的大数类型，常用于精确计算。",name:"DECIMAL",type:"MATH"},{def:'ENDWITH(str1，str2):判断字符串str1是否以str2结束。备注:    str1和str2都是大小写敏感的。示例:ENDWITH("FineReport","Report")等于true。ENDWITH("FineReport","Fine")等于false。ENDWITH("FineReport","report")等于false。',name:"ENDWITH",type:"TEXT"},{def:"ENMONEY(value):将给定的BigDemical类型的数字转换成英文金额字符串。示例：ENMONEY(23.49)等于TWENTY THREE AND CENTS FORTY NINE",name:"ENMONEY",type:"TEXT"},{def:"EENNUMBER(value)：将给定的BigDecimal类型的数字（100以内）取整后转化成英文金额的字符串。示例：ENNUMBER(23.49)等于TWENTY THREE。注：若出现结果为空，需要将数字强制转换为BigDecimal类型，例如：ENNUMBER(TOBIGDECIMAL(80))",name:"ENNUMBER",type:"TEXT"},{def:'EVAL(exp)返回表达式exp计算后的结果。exp:一个表达式形式字符串。备注:    只要EVAL中的参数exp最终可以转化成一表达式形式的字符串，比如"sum(2,4)","2+7"等等，那么它就可以被计算。EVAL("2+5")等于7。EVAL("count(2,3)")等于2。EVAL("sum"+"(2,3,5)")等于10。EVAL(IF(true, "sum", "count") + "(1,2,3,4)")等于10。EVAL(IF(false, "sum", "count") + "(1,2,3,4)")等于4。',name:"EVAL",type:"OTHER"},{def:"EVEN(number):返回沿绝对值增大方向取整后最接近的偶数。使用该函数可以处理那些成对出现的对象。number:所要取整的数值。不论正负号如何，数值都朝着远离 0 的方向舍入。如果 number 恰好是偶数，则不须进行任何舍入处理。示例:EVEN(1.5) 等于 2EVEN(3) 等于 4EVEN(2) 等于 2EVEN(-1) 等于 -2",name:"EVEN",type:"MATH"},{def:'EXACT(text1,text2): 检测两组文本是否相同。如果完全相同，EXACT函数返回TRUE；否则，返回FALSE。EXACT函数可以区分大小写，但忽略格式的不同。同时也可以利用EXACT函数来检测输入文档的文字。Text1:需要比较的第一组文本。Text2:需要比较的第二组文本。示例:EXACT("Spreadsheet","Spreadsheet")等于TRUE。EXACT("Spreadsheet","S preadsheet")等于FALSE。EXACT("Spreadsheet","spreadsheet")等于FALSE。',name:"EXACT",type:"TEXT"},{def:"EXP(number): 返回e的n次幂。常数e为自然对数的底数，等于2.71828182845904。Number:为任意实数，作为常数e的指数。备注:    如果要返回其他常数作为底数的幂，可以使用指数运算符（^）。例如: 在4^2中，4是底数，而2是指数。    EXP函数与LN函数互为反函数。示例:EXP(0)等于1。EXP(3)等于20.08553692。EXP(LN(2))等于2。",name:"EXP",type:"MATH"},{def:"FACT(number):返回数的阶乘，一个数的阶乘等于 1*2*3*...*该数。number:要计算其阶乘的非负数。如果输入的 number 不是整数，则截尾取整。示例:FACT(1) 等于 1FACT(1.9) 等于 FACT(1) 等于 1FACT(0) 等于 1FACT(5) 等于 1*2*3*4*5 等于 120",name:"FACT",type:"MATH"},{def:"filename(file)获取文件的文件名。当file为单文件时，返回文件名字符串，当file为多文件时，返回文件名的字符串数组。如果file不为文件类型，则返回错误信息。示例：假设文件控件在B2单元格，而B2单元格依次上传了三个不同类型文件{A.doc, C.xls ,B.cpt }，则filename(B2)返回值为[“A.doc”, “C.xls”, “B.cpt”]。",name:"FILENAME",type:"OTHER"},{def:"filesize(file)获取文件的大小，单位为Kb。当file为单文件时，返回文件大小，当file为多文件时，返回文件大小的数组。如果file不为文件类型，则返回错误信息。示例：假设文件控件在B2单元格，而B2单元格依次上传了两个大小分别为100字节和10240字节的文件，则filename(B2)返回值为[0.098, 10.0]。",name:"FILESIZE",type:"OTHER"},{def:"filetype(file)获取文件的类型。当file为单文件时，返回文件类型字符串，当file为多文件时，返回文件类型的字符串数组。如果file不为文件类型，则返回错误信息。示例：假设文件控件在B2单元格，而B2单元格依次上传了三个不同类型文件{A.doc, C.xls ,B.txt }，则filetype(B2)返回值为[“doc”, “xls”, “txt”]。",name:"FILETYPE",type:"OTHER"},{def:'FIND(find_text,within_text,start_num):从指定的索引(start_num)处开始，返回第一次出现的指定子字符串(find_text)在此字符串(within_text)中的索引。Find_text:需要查找的文本或包含文本的单元格引用。Within_text:包含需要查找文本的文本或单元格引用。Start_num:指定进行查找字符的索引位置。within_text里的索引从1开始。如果省略start_num，则假设值为1。备注:    如果find_text不在within_text中，FIND函数返回值为0。    如果start_num不大于0，FIND函数返回错误信息*VALUE!。    如果start_num大于within_text的长度，FIND函数返回值为0。    如果find_text是空白文本，FIND函数将在搜索串中匹配第一个字符（即编号为start_num或1的字符）。示例:FIND("I","Information")等于1。FIND("i","Information")等于9。FIND("o","Information",2)等于4。FIND("o","Information",12)等于0。FIND("o","Information",-1)等于*VALUE!。',name:"FIND",type:"TEXT"},{def:"FLOOR(number): 将参数number沿绝对值减小的方向去尾舍入。Number:待舍入的数值。示例:FLOOR(-2.5)等于-2。FLOOR(2.5)等于2。",name:"FLOOR",type:"MATH"},{def:'FORMAT(object,format) : 返回object的format格式。object 需要被格式化对象，可以是String，数字，Object(常用的有Date, Time)。format 格式化的样式。示例FORMAT(1234.5, "#,##0.00") => 1234.50FORMAT(1234.5, "#,##0") => 1234FORMAT(1234.5, "¥#,##0.00") => ¥1234.50FORMAT(1.5, "0%") => 150%FORMAT(1.5, "0.000%") => 150.000%FORMAT(6789, "##0.0E0") => 6.789E3FORMAT(6789, "0.00E00") => 6.79E03FORMAT(date(2007,1,1), "EEEEE, MMMMM dd, yyyy") => 星期一，一月 01，2007FORMAT(date(2007,1,13), "MM/dd/yyyy") => 01/13/2007FORMAT(date(2007,1,13), "M-d-yy") => 1-13-07FORMAT(time(16,23,56), "h:mm:ss a") => 4:23:56 下午',name:"FORMAT",type:"TEXT"},{def:"GREPARRAY(array，fn):函数(返回true或者false)是条件，过滤此数组，最后形成一个新数组。示例：GREPARRAY([3,4,2,3,6,8,7], item != 3)等于[4,2,6,8,7].",name:"GREPARRAY",type:"ARRAY"},{def:'HOUR(serial_number):返回某一指定时间的小时数。函数指定HOUR为0（0:00）到23（23:00)之间的一个整数。Serial_number:包含所求小时的时间。示例:HOUR("11:32:40")等于11。HOUR("11:32:40", "HH:mm:ss")等于11。',name:"HOUR",type:"DATETIME"},{def:'IF(boolean,number1/string1,number2/string2):判断函数,boolean为true时返回第二个参数,为false时返回第三个。boolean: 用于判断的布尔值,true或者false。number1/string1: 第一个参数，如果boolean为ture,返回这个值。number2/string2: 第二个参数，如果boolean为false,返回这个值。示例:IF(true,2,8)等于2IF(false,"first","second")等于secondIF(true,"first",7)等于first',name:"IF",type:"LOGIC"},{def:'IF(boolean,number1/string1,number2/string2):判断函数,boolean为true时返回第二个参数,为false时返回第三个。boolean: 用于判断的布尔值,true或者false。number1/string1: 第一个参数，如果boolean为ture,返回这个值。number2/string2: 第二个参数，如果boolean为false,返回这个值。示例:IF(true,2,8)等于2IF(false,"first","second")等于secondIF(true,"first",7)等于first',name:"IF",type:"COMMON"},{def:'INARRAY(co, array):返回co在数组array中的位置，如果co不在array中，则返回0.示例：String[] arr = {"a","b","c","d"}那么INARRAY("b", arr)等于2.',name:"INARRAY",type:"ARRAY"},{def:'INDEX(key,val1,val2,...):返回key在val1,val2,...所组成的序列中的位置,不存在于序列中则返回参数的个数.备注:    key和valn可以是任意类型示例:INDEX(2,2)等于1。INDEX(2,1,2)等于2。INDEX(2,4,5,6)等于4。INDEX("b","b","o","y")等于1。',name:"INDEX",type:"OTHER"},{def:'INDEXOF(str1，index):返回字符串str1在index位置上的字符。备注:    index是从0开始计数的。示例:INDEXOF("FineReport",0)等于\'F\'。INDEXOF("FineReport",2)等于\'n\'。INDEXOF("FineReport",9)等于\'t\'。INDEXOF(array, index):返回数组在index位置上的元素。备注：    index是从1开始计数的。示例：String[] array = {"a", "b", "c"}INDEXOF(array, 1)等于"a".',name:"INDEXOF",type:"TEXT"},{def:'INDEXOFARRAY(array, index):返回数组array的第index个元素。示例：INDEXOFARRAY(["第一个", "第二个", "第三个"], 2)返回"第二个"。',name:"INDEXOFARRAY",type:"ARRAY"},{def:"INT(number): 返回数字下舍入（数值减小的方向）后最接近的整数值。Number:需要下舍入为整数的实数。示例:INT(4.8)等于4。INT(-4.8)等于-5。INT(4.3)等于4。INT(-4.3)等于-5。公式INT(A1)将返回A1单元格中的一个正实数的整数数部分。",name:"INT",type:"MATH"},{def:"INT(number): 返回数字下舍入（数值减小的方向）后最接近的整数值。Number:需要下舍入为整数的实数。示例:INT(4.8)等于4。INT(-4.8)等于-5。INT(4.3)等于4。INT(-4.3)等于-5。公式INT(A1)将返回A1单元格中的一个正实数的整数数部分。",name:"INT",type:"COMMON"},{def:"ISNULL(object):判断对象中所有的值是否全部都是NULL或者为空字符串。",name:"ISNULL",type:"OTHER"},{def:'JOINARRAY(array,sepa):返回一个由sepa作为分隔符的字符串.array:[arg1,arg2...]格式的数组;sepa:分隔符。示例:JOINARRAY([1,2],";") = [1;2].JOINARRAY([hello,world],"-") = [hello-world].',name:"JOINARRAY",type:"ARRAY"},{def:'LEFT(text,num_chars): 根据指定的字符数返回文本串中的第一个或前几个字符。Text:包含需要选取字符的文本串或单元格引用。Num_chars:指定返回的字符串长度。备注:    Num_chars的值必须等于或大于0。    如果num_chars大于整个文本的长度，LEFT函数将返回所有的文本。    如果省略num_chars，则默认值为1。示例:LEFT("Fine software",8)等于“Fine sof”。LEFT("Fine software")等于“F”。如果单元格A3中含有“China”，则LEFT(A3,2)等于“Ch”。',name:"LEFT",type:"TEXT"},{def:"LEN(args): 返回文本串中的字符数或者数组的长度。需要注意的是：参数args为文本串时，空格也计为字符。参数args为数组时，直接返回数组长度。示例:LEN(\"Evermore software\")等于17。LEN(\" \")等于1。LEN(['a','b'])等于2。",name:"LEN",type:"TEXT"},{def:"LET(变量名,变量值,变量名,变量值,..., 表达式):局部变量赋值函数,参数的个数N必须为奇数, 最后一个是表达式，前面是N-1(偶数)为局部变量赋值对。变量名: 必须是合法的变量名，以字母开头，可以包括字母，数字和下划线表达式: 根据前面的N-1个参数赋值后计算出来的结果，这些变量赋值只在这个表达式内部有效示例:LET(a, 5,b, 6, a+b)等于11",name:"LET",type:"OTHER"},{def:"LN(number):返回一个数的自然对数。自然对数以常数项 e（2.71828182845904）为底。number:是用于计算其自然对数的正实数。示例:LN(86) 等于 4.45437LN(2.7182818) 等于 1LN(EXP(3)) 等于 3EXP(LN(4)) 等于 4",name:"LN",type:"MATH"},{def:"LOG(number,base): 按指定的任意底数，返回数值的对数。Number:需要求对数的正实数。Base:对数的底数。如果省略底数，默认值为10。示例:LOG(16,2)等于4。LOG(10)等于1。LOG(24,3)等于2.892789261。",name:"LOG",type:"MATH"},{def:"LOG10(number):返回以 10 为底的对数。number: 用于常用对数计算的正实数。示例:LOG10(86) 等于 1.934498451LOG10(10) 等于 1LOG10(1E5) 等于 5",name:"LOG10",type:"MATH"},{def:'LOWER(text): 将所有的大写字母转化为小写字母。Text:需要转化为小写字母的文本串。LOWER函数不转化文本串中非字母的字符。示例:LOWER("A.M.10:30")等于“a.m.10:30”。LOWER("China")等于“china”。',name:"LOWER",type:"TEXT"},{def:"LUNAR(year,day,month): 返回当前日期对应的农历时间。year,month,day:分别对应年月日。示例:如果需要查询2011年7月21日对应的农历时间，则只需输入LUNAR(2011,7,21)结果将显示为：辛卯年六月廿一同样，如输入LUNAR(2001,7,21)，则显示：辛巳年六月初一 。本公式支持的时间段为1900-2100年。",name:"LUNAR",type:"DATETIME"},{def:"MAPARRAY(array, fn):把一个数组中的项目转换到另一个数组中。array (Array): 要转换的数组 fn (Function): 处理数组项目的函数 示例：MAPARRAY([3,4,2,3,6,8,7], item != 3)等于[false,true,true,false,true,true,true].",name:"MAPARRAY",type:"ARRAY"},{def:"MAX(number1,number2,⋯): 返回参数列表中的最大值。Number1,number2,⋯:1到30个需要找出最大值的参数。备注:    参数可以是数字、空白单元格、逻辑值或数字的文本表达式。    如果数组或引用参数中包含可解析文本值，逻辑值，零值或空白单元格，这些值都将参与计算，而不可解析的文本值忽略不计。    如果参数中没有任何数字，MAX将返回0。示例:MAX(0.1,0,1.2)等于1.2。",name:"MAX",type:"MATH"},{def:"MAX_AGG(array): 根据当前分析维度，动态返回指标字段的最大值，生成结果为一动态数据列，行数与当前分析维度行数一致。\n \"array必须为非聚合函数公式返回的结果，可以是某指标字段、维度或指标字段与普通公式的计算结果。\n \"示例：用户横轴为维度字段'日'时，纵轴的计算字段MAX_AGG(销量)返回的值为每日的最大值销量；当用户横轴为维度字段'月'时，MAX_AGG(销量)返回的值为每月的最大值销量。",name:"MAX_AGG",type:"AGG"},{def:"MEDIAN(array1): 返回数据系列的中值(与Excel的同名函数作用相同)。示例:MEDIAN([1,2,3])=2。",name:"MEDIAN",type:"OTHER"},{def:"MEDIAN_AGG(array): 根据当前分析维度，动态返回指标字段的中位数，生成结果为一动态数据列，行数与当前分析维度行数一致。\n \"array必须为非聚合函数公式返回的结果，可以是某指标字段、维度或指标字段与普通公式的计算结果。\n \"示例：用户横轴为维度字段'日'时，纵轴的计算字段MEDIAN_AGG(销量)返回的值为每日的中位数销量；当用户横轴为维度字段'月'时，MEDIAN_AGG(销量)返回的值为每月的中位数销量。",name:"MEDIAN_AGG",type:"AGG"},{def:'MID(text,start_num,num_chars): 返回文本串中从指定位置开始的一定数目的字符，该数目由用户指定。Text:包含要提取字符的文本串。Start_num:文本中需要提取字符的起始位置。文本中第一个字符的start_num为1，依此类推。Num_chars:返回字符的长度。备注:    如果start_num大于文本长度，MID函数返回“”（空文本）。    如果start_num小于文本长度，并且start_num加上num_chars大于文本长度，MID函数将从start_num指定的起始字符直至文本末的所有字符。    如果start_num小于1，MID函数返回错误信息*VALUE!。    如果num_chars是负数，MID函数返回错误信息*VALUE!。示例:MID("Finemore software",10,8)返回“software”。MID("Finemore software",30,5)返回“”（空文本）。MID("Finemore software",0,8)返回*VALUE!。MID("Finemore software",5,-1)返回*VALUE!。',name:"MID",type:"TEXT"},{def:"MIN(number1,number2,⋯): 返回参数列表中的最小值。Number1,number2,⋯:1到30个需要找出最小值的参数。备注:    若参数中没有数字，函数MIN将返回0。    参数应为数字、空白单元格、逻辑值或是表示数值的文本串。如果参数是错误值时，MIN将返回错误信息。    如果数组或引用参数中包含可解析文本值，逻辑值，零值或空白单元格，这些值都将参与计算，而不可解析的文本值忽略不计。示例:如果B1:B4包含3，6，9，12，则:MIN(B1:B4)等于3。MIN(B1:B4,0)等于0。",name:"MIN",type:"MATH"},{def:'MINUTE(serial_number):返回某一指定时间的分钟数，其值是介于0与59之间的一个整数。serial_number:包含所求分钟数的时间。示例:MINUTE("15:36:25")等于36。MINUTE("15:36:25", "HH:mm:ss")等于36。',name:"MINUTE",type:"DATETIME"},{def:"MIN_AGG(array): 根据当前分析维度，动态返回指标字段的最小值，生成结果为一动态数据列，行数与当前分析维度行数一致。\n \"array必须为非聚合函数公式返回的结果，可以是某指标字段、维度或指标字段与普通公式的计算结果。\n \"示例：用户横轴为维度字段'日'时，纵轴的计算字段MIN_AGG(销量)返回的值为每日的最小值销量；当用户横轴为维度字段'月'时，MIN_AGG(销量)返回的值为每月的最小值销量。",name:"MIN_AGG",type:"AGG"},{def:"MOD(number,divisor):返回两数相除的余数。结果的正负号与除数相同。number:为被除数。divisor:为除数。示例:MOD(3, 2) 等于 1MOD(-3, 2) 等于 1MOD(3, -2) 等于 -1MOD(-3, -2) 等于 -1",name:"MOD",type:"MATH"},{def:'MONTH:(serial_number)返回日期中的月。月是介于1和12之间的一个数。Serial_number:含有所求的月的日期.备注:FineReport将日期保存为系列数，一个系列数代表一个与之匹配的日期，以方便用户对日期进行数值式计算。在1900年日期系统中，FineReport电子表格将1900年1月1日保存为系列数2，将1900年1月2日保存为系列数3，将1900年1月3日保存为系列数4⋯⋯依此类推。如在1900年日期系统，1998年1月1日存为系列数35796。示例:MONTH("2000/1/1")等于1。MONTH("2006/05/05")等于5。MONTH("1997/04/20")等于4。MONTH("2000-1-1", "yyyy-MM-dd")等于1。MONTH("2006-05-05", "yyyy-MM-dd")等于5。MONTH("1997-04-20", "yyyy-MM-dd")等于4。MONTH(35796)等于1。',name:"MONTH",type:"DATETIME"},{def:'MONTHDELTA(date,delta):返回指定日期date后delta个月的日期。示例：MONTHDELTA("2008-08-08", 4)等于2008-12-08。',name:"MONTHDELTA",type:"DATETIME"},{def:"NOW():获取当前时间。示例：如果系统时间是2012年5月12日 15点18分38秒则NOW()等于2012-05-12 15:18:36。",name:"NOW",type:"DATETIME"},{def:"NUMTO(number,bool)或NUMTO(number):返回number的中文表示。其中bool用于选择中文表示的方式，当没有bool时采用默认方式显示。示例：NUMTO(2345,true)等于二三四五。示例：NUMTO(2345,false)等于二千三百四十五。示例：NUMTO(2345)等于二千三百四十五。",name:"NUMTO",type:"TEXT"},{def:"OR(logical1,logical2,⋯): 当所有参数的值为假时，返回FALSE；当任意参数的值为真时，返回TRUE。Logical1,logical2,⋯:指1到30个需要检验TRUE或FALSE的条件值。备注:    参数必须是逻辑值，或是含有逻辑值的数组或引用。    如果数组或引用中含有文本或空的单元格，则忽略其值。    如果在指定的单元格区域中没有逻辑值，AND函数将返回错误信息*NAME?。示例:OR(1+7=9,5+7=11)等于FALSE。OR(1+7=8,5+7=11)等于TRUE。",name:"OR",type:"LOGIC"},{def:'PERIOD_ANLS(X_AGG(array)，datepart)根据横纵轴或行列维度添加的日期字段进行同期值的计算。\n "第一个参数为用于计算的指标，该指标必须为聚合函数或聚合指标；第二个参数用于配置计算同期时计算某日的年同期或者某日的月同期。横轴周拖拽的字段不满足函数的计算要求时，该指标会标红。\n "示例：period_anls(sum(amount),"Y") 用户横纵轴拖拽的销售日期（年月日分组），则该指标计算结果为，根据年月日对销量进行分组汇总，然后计算出该日数据上年年末的销量；如果参数2为“M”，则计算结果为该日销量上月月末的销量。',name:"PERIOD_ANLS",type:"TABLE_CAL"},{def:"PREVIOUS_PERIOD(x_agg(array))根据横纵轴或行列维度添加的日期字段进行环期值的计算。参数为用于计算的指标，该指标必须为聚合函数或聚合指标。横轴周拖拽的字段不满足函数的计算要求时，该指标会标红。",name:"PREVIOUS_PERIOD",type:"TABLE_CAL"},{def:"PROMOTION(value1,value2):返回value2在value1上提升的比例。示例：PROMOTION(12, 14)等于0.166666666，即提升了16.6666666%.PROMOTION(-12, 14)等于2.166666666，即提升了216.6666666%.",name:"PROMOTION",type:"MATH"},{def:"RAND(): 返回均匀分布的随机数。每计算一次工作表，函数都会返回一个新的随机数值。备注:    要生成一个位于a和b之间的随机数，可以使用以下的公式: C=RAND()*(b-a)+a。    如果要使一个随机产生的数值不随单元格的重计算而改变，可以在编辑框中输入=RAND()并保持编辑状态，然后按F9，将公式永久性地改为随机数。示例:假如需要生成一个大于等于0，小于60的随机数，使用公式: =RAND()*60。假如需要生成一个大于等于0，小于19的随机数，使用公式: =RAND()*19。假如需要生成一个大于等于0，小于50的随机数，使用公式: =RAND()*50。",name:"RAND",type:"MATH"},{def:"RANDBETWEEN(value1,value2):返回value1和value2之间的一个随机整数。示例：RANDBETWEEN(12.333, 13.233)只会返回13。RANDBETWEEN(11.2, 13.3)有可能返回12或者13。",name:"RANDBETWEEN",type:"MATH"},{def:"RANGE(from，to，step)函数表示从整数from开始，以step为每一步的大小，直到整数to的一个数字序列。例如：RANGE(1,5,1)表示从1开始，直到5(包括5)，每一步大小为1，那么它返回一个数字序列为[1,2,3,4,5]。RANGE(-1,6,2)表示从-1开始，直到6(包括6)，每一步大小为2，那么它返回一个数字序列为[-1,1,3,5]。备注：RANGE函数有三种参数形式：1 RANGE(to)，默认的from为1，step为1，例如：  RANGE(4)返回[1,2,3,4]。  RANGE(-5)返回[]。2 RANGE(from,to)，默认的step为1，例如:  RANGE(-1,3)返回[-1,0,1,2,3]。  RANGE(0,5)返回[0,1,2,3,4,5]。3 RANGE(from,to,step)，三个参数的情况参照上面的注释，例如：  RANGE(6,-1,-2)返回[6,4,2,0]。  RANGE(4,1,1)返回[]。",name:"RANGE",type:"ARRAY"},{def:'RANK(number,ref,order): 返回一个数在一个数组中的秩。(如果把这个数组排序，该数的秩即为它在数组中的序号。)Number 所求秩的数。(可以是Boolean型，true=1，false=0)Ref    可以是数组，引用，或一系列数，非实数的值被忽略处理(接受Boolean型，true=1，false=0)。Order  指定求秩的参数，非零为升序，零为降序备注1.  RANK对重复的数返回相同的秩，但重复的数影响后面的数的秩，比如，在一组升序排列的整数中，如果5出现了2次，并且秩为3，那么6的秩为5 (没有数的秩是4).示例A1:A5 = 6, 4.5, 4.5, 2, 4RANK(A1,A1:A5,1) 即 6 的秩为 5.RANK(3,1,2,"go",3,4,1) = 3, "go"被忽略。',name:"RANK",type:"OTHER"},{def:'RANK_ANLS(X_AGG(array),range,order)根据横纵轴或行列维度添加的字段对指标进行跨行排名的计算。\n "第一个参数为用户计算的指标，该指标必须为聚合函数或聚合指标；第二个参数range为用户设置计算的范围，0为对所有行进行排名，1为对组内所有行进行排名；第三个参数order为排名的计算规则，"asc"为升序排名，"desc"为降序排名。\n "示例：rank_anls(sum(amount),0,"asc")用户横轴轴拖拽省份，则该指标计算结果为，根据省份对销量进行分组汇总，然后计算每个省份的销量在所有省份中的升序排名情况。',name:"RANK_ANLS",type:"TABLE_CAL"},{def:"REMOVEARRAY(array, start, deleteCount):从数组array中删除从第start个元素开始的deleteCount个数组元素，并返回删除后的数组。示例：REMOVEARRAY([3, 4, 4, 2, 6, 7, 87], 4, 2)返回[3, 4, 4, 7, 87].",name:"REMOVEARRAY",type:"ARRAY"},{def:'REPEAT(text,number_times): 根据指定的次数重复显示文本。REPEAT函数可用来显示同一字符串，并对单元格进行填充。Text:需要重复显示的文本或包含文本的单元格引用。Number_times:指定文本重复的次数，且为正数。如果number_times为0，REPEAT函数将返回“”（空文本）。如果number_times不是整数，将被取整。REPEAT函数的最终结果通常不大于32767个字符。备注:    该函数可被用于在工作表中创建简单的直方图。示例:REPEAT("$",4)等于“$$$$”。如果单元格B10的内容为“你好”，REPEAT(B10,3)等于“你好你好你好”。',name:"REPEAT",type:"TEXT"},{def:'REPLACE(text, texttoreplace, replacetext):根据指定字符串，用其他文本来代替原始文本中的内容。text：需要被替换部分字符的文本或单元格引用。texttoreplace：指定的字符串或正则表达式。replacetext:需要替换部分旧文本的文本。示例：REPLACE("abcd", "a", "re")等于"rebcd"。REPLACE("a**d", "**d", "rose")等于"arose"。REPLACE(old_text,start_num,num_chars,new_text): 根据指定的字符数，用其他文本串来替换某个文本串中的部分内容。Old_text:需要被替换部分字符的文本或单元格引用。Start_num:需要用new_text来替换old_text中字符的起始位置。Num_chars:需要用new_text来替换old_text中字符的个数。New_text:需要替换部分旧文本的文本。示例:REPLACE("0123456789",5,4,"*")等于“0123*89”。REPLACE("1980",3,2,"99")等于“1999”。',name:"REPLACE",type:"TEXT"},{def:'REVERSEARRAY(array):返回数组array的倒序数组。示例：REVERSEARRAY(["第一个", "第二个", "第三个"])返回["第三个", "第二个", "第一个"].',name:"REVERSEARRAY",type:"ARRAY"},{def:'RIGHT(text,num_chars): 根据指定的字符数从右开始返回文本串中的最后一个或几个字符。Text:包含需要提取字符的文本串或单元格引用。Num_chars:指定RIGHT函数从文本串中提取的字符数。Num_chars不能小于0。如果num_chars大于文本串长度，RIGHT函数将返回整个文本。如果不指定num_chars，则默认值为1。示例:RIGHT("It is interesting",6)等于“esting”。RIGHT("Share Holder")等于“r”。RIGHT("Huge sale",4)等于“sale”。',name:"RIGHT",type:"TEXT"},{def:"ROUND(number,num_digits):返回某个数字按指定位数舍入后的数字。number:需要进行舍入的数字。num_digits:指定的位数，按此位数进行舍入。如果 num_digits 大于 0，则舍入到指定的小数位。如果 num_digits 等于 0，则舍入到最接近的整数。如果 num_digits 小于 0，则在小数点左侧进行舍入。示例:ROUND(2.15, 1) 等于 2.2ROUND(2.149, 1) 等于 2.1ROUND(-1.475, 2) 等于 -1.48ROUND(21.5, -1) 等于 20因浮点数存在精度计算丢失问题, 导致计算结果里可能带上9999, 0000这些, 因此加入第三个参数来控制是否需要去除9999. true表示需要过滤9999, 0000这些数据.",name:"ROUND",type:"MATH"},{def:"ROUND(number,num_digits):返回某个数字按指定位数舍入后的数字。number:需要进行舍入的数字。num_digits:指定的位数，按此位数进行舍入。如果 num_digits 大于 0，则舍入到指定的小数位。如果 num_digits 等于 0，则舍入到最接近的整数。如果 num_digits 小于 0，则在小数点左侧进行舍入。示例:ROUND(2.15, 1) 等于 2.2ROUND(2.149, 1) 等于 2.1ROUND(-1.475, 2) 等于 -1.48ROUND(21.5, -1) 等于 20因浮点数存在精度计算丢失问题, 导致计算结果里可能带上9999, 0000这些, 因此加入第三个参数来控制是否需要去除9999. true表示需要过滤9999, 0000这些数据.",name:"ROUND",type:"COMMON"},{def:"ROUND5(number,num_digits):这个是四舍五入，奇进偶不进。number:需要进行舍入的数字。num_digits:指定的位数，按此位数进行舍入。如果 num_digits 大于 0，则舍入到指定的小数位。如果 num_digits 等于 0，则舍入到最接近的整数。如果 num_digits 小于 0，则在小数点左侧进行舍入。示例:ROUND5(2.125, 2) 等于 2.12ROUND5(2.135, 2) 等于 2.14",name:"ROUND5",type:"MATH"},{def:"ROUNDDOWN(number,num_digits):靠近零值，向下（绝对值减小的方向）舍入数字。number:为需要向下舍入的任意实数。num_digits:舍入后的数字的位数。函数 ROUNDDOWN 和函数 ROUND 功能相似，不同之处在于函数 ROUNDDOWN 总是向下舍入数字。示例:ROUNDDOWN(3.2, 0) 等于 3ROUNDDOWN(76.9,0) 等于 76ROUNDDOWN(3.14159, 3) 等于 3.141ROUNDDOWN(-3.14159, 1) 等于 -3.1ROUNDDOWN(31415.92654, -2) 等于 31,400",name:"ROUNDDOWN",type:"MATH"},{def:"ROUNDUP(number,num_digits):远离零值，向上（绝对值增大的方向）舍入数字。number:为需要向上舍入的任意实数。num_digits:舍入后的数字的位数。函数 ROUNDUP 和函数 ROUND 功能相似，不同之处在于函数 ROUNDUP 总是向上舍入数字。示例:ROUNDUP(3.2,0) 等于 4ROUNDUP(76.9,0) 等于 77ROUNDUP(3.14159, 3) 等于 3.142ROUNDUP(-3.14159, 1) 等于 -3.2ROUNDUP(31415.92654, -2) 等于 31,500",name:"ROUNDUP",type:"MATH"},{def:'SAME_PERIOD(X_AGG(array)，datepart)根据横纵轴或行列维度添加的日期字段进行同期值的计算。\n "第一个参数为用于计算的指标，该指标必须为聚合函数或聚合指标；第二个参数用于配置计算同期时计算某日的年同期或者某日的月同期。横轴周拖拽的字段不满足函数的计算要求时，该指标会标红。\n "示例：SAME_PERIOD(SUM_AGG(amount),"Y") 用户横纵轴拖拽的销售日期（年月日分组），则该指标计算结果为，根据年月日对销量进行分组汇总，然后计算出该日数据上年同日的销量；如果参数2为“M”，则计算结果为该日销量上月同日的销量。',name:"SAME_PERIOD",type:"TABLE_CAL"},{def:'SECOND(serial_number):返回某一指定时间的秒数，其值是介于0与59之间的一个整数。Serial_number:包含所求秒数的时间。示例:SECOND("15:36:25")等于25。SECOND("15:36:25", "HH:mm:ss")等于25。',name:"SECOND",type:"DATETIME"},{def:"SEQ(): 返回数值，在整个报表执行过程中，返回该函数被第几次执行了。示例:SEQ()在第一次执行时，结果为1。SEQ()在第二次执行时，结果为2。",name:"SEQ",type:"OTHER"},{def:"SIGN(number):返回数字的符号。当数字为正数时返回 1，为零时返回 0，为负数时返回 -1。Number:为任意实数。示例:SIGN(10) 等于 1SIGN(4-4) 等于 0SIGN(-0.00001) 等于 -1",name:"SIGN",type:"MATH"},{def:"SLICEARRAY(array, start, end):返回数组从第start个到第end个元素(包括第end个元素)。示例：SLICEARRAY([3, 4, 4, 5, 1, 5, 7], 3, 6)返回[4, 5, 1, 5].当不使用end参数时，返回从start开始到数组结束之间的元素。SLICEARRAY([3, 4, 4, 5, 1, 5, 7], 3)返回[4, 5, 1, 5, 7].",name:"SLICEARRAY",type:"ARRAY"},{def:"SORTARRAY(array):返回数组array排过序的数组。示例：SORTARRAY([3, 4, 4, 5, 1, 5, 7])返回[1, 3, 4, 4, 5, 5, 7].注意：数组array的元素类型必须一样，并且要可比较。",name:"SORTARRAY",type:"ARRAY"},{def:'SPLIT(String1,String2)：返回由String2分割String1组成的字符串数组。String1：以双引号表示的字符串。String2：以双引号表示的分隔符。例如逗号","示例:SPLIT("hello,world,yes",",") = ["hello","world","yes"]。SPLIT("this is very good"," ") = ["this","is","very","good"]。备注：如果只有一个参数，则返回一个错误。如果有多个参数，则只有前两个起作用。',name:"SPLIT",type:"TEXT"},{def:"SQRT(number): 返回一个正数的平方根。Number:要求其平方根的任一正数。备注:Number必须是一个正数，否则函数返回错误信息*NUM!。示例:SQRT(64)等于8。SQRT(-64)返回*NUM!。",name:"SQRT",type:"MATH"},{def:"STDEV(array1): 计算数据系列的标准偏差(与Excel的同名函数作用相同)。示例:STDEV([1,2,3])=1。",name:"STDEV",type:"OTHER"},{def:"STDEV_AGG(array): 根据当前分析维度，动态返回指标字段的标准差，生成结果为一动态数据列，行数与当前分析维度行数一致。\n \"array必须为非聚合函数公式返回的结果，可以是某指标字段、维度或指标字段与普通公式的计算结果。\n \"示例：用户横轴为维度字段'日'时，纵轴的计算字段STDEV_AGG(销量)返回的值为每日的销量标准差；当用户横轴为维度字段'月'时，STDEV_AGG(销量)返回的值为每月的销量标准差。",name:"STDEV_AGG",type:"AGG"},{def:'SUBSTITUTE(text,old_text,new_text,instance_num): 用new_text替换文本串中的old_text。Text:需要被替换字符的文本，或含有文本的单元格引用。Old_text:需要被替换的部分文本。New_text:用于替换old_text的文本。Instance_num:指定用new_text来替换第几次出现的old_text。如果指定了instance_num，则只有指定位置上的old_text被替换，否则文字串中出现的所有old_text都被new_text替换。备注:    如果需要替换文本串中的指定文本，则使用SUBSTITUTE函数；如果需要替换文本串中指定位置上的任意文本，则使用REPLACE函数。示例:SUBSTITUTE("data base","base","model")等于“data model”。SUBSTITUTE("July 28, 2000","2","1",1)等于“July 18, 2000”。SUBSTITUTE("July 28, 2000","2","1")等于“July 18, 1000”。SUBSTITUTE("July 28, 2000","2","1",2)等于“July 28, 1000”。 ',name:"SUBSTITUTE",type:"TEXT"},{def:'SUM(number1,number2,⋯): 求一个指定单元格区域中所有数字之和。Number1,number2,⋯:1到30个参数或指定单元格区域中所有数字。备注:    函数将直接键入参数中的数值、逻辑值及文本表达式计算在内。    若参数是数组或引用，则只有数组或单元格引用中的数值进行计算。示例:SUM(70,80)等于150。SUM("70",80,TRUE)等于151，逻辑值“TRUE”作为1来计算；“FALSE”作为0计算；文本“70”作为70来计算。',name:"SUM",type:"MATH"},{def:'SUM(number1,number2,⋯): 求一个指定单元格区域中所有数字之和。Number1,number2,⋯:1到30个参数或指定单元格区域中所有数字。备注:    函数将直接键入参数中的数值、逻辑值及文本表达式计算在内。    若参数是数组或引用，则只有数组或单元格引用中的数值进行计算。示例:SUM(70,80)等于150。SUM("70",80,TRUE)等于151，逻辑值“TRUE”作为1来计算；“FALSE”作为0计算；文本“70”作为70来计算。',name:"SUM",type:"COMMON"},{def:"SUMSQ(number1,number2, ...):返回所有参数的平方和。number1, number2, ...:为 1 到 30 个需要求平方和的参数，也可以使用数组或对数组的引用来代替以逗号分隔的参数。示例:SUMSQ(3, 4) 等于 25",name:"SUMSQ",type:"MATH"},{def:"SUM_AGG(array):根据当前分析维度，动态返回指标字段的汇总求和值，生成结果为一动态数据列，行数与当前分析维度行数一致。\n array必须为非聚合函数公式返回的结果，可以是某指标字段、维度或指标字段与普通公式的计算结果。\n 示例：用户横轴为维度字段'日'时，纵轴的计算字段SUM_AGG(销量)返回的值为每日的汇总销量；当用户横轴为维度字段'月'时，SUM_AGG(销量)返回的值为每月的汇总销量。",name:"SUM_AGG",type:"AGG"},{def:"switch(表达式, 值1, 结果1, 值2, 结果2, ...)如果表达式的结果是值1，整个函数返回结果1如果表达式的结果是值2，整个函数返回结果2如果表达式的结果是值3，整个函数返回结果3等等",name:"SWITCH",type:"LOGIC"},{def:"TIME(hour,minute,second): 返回代表指定时间的小数。介于0:00:00（12:00:00 A.M.）与23:59:59（11:59:59 P.M.）之间的时间可返回0到0.99999999之间的对应数值。Hour:介于0到23之间的数。Minute:介于0到59之间的数。Second:介于0到59之间的数。示例:TIME(14,40,0)等于2:40 PM。TIME(19,43,24)等于7:43 PM。",name:"TIME",type:"DATETIME"},{def:'TODATE()函数可以将各种日期形式的参数转换为日期类型。它有三种参数的形式：1 参数是一个日期型的参数，那么直接将这个参数返回。示例：TODATE(DATE(2007,12,12))返回2007年12月12日组成的日期。2 参数是以从1970年1月1日0时0分0秒开始的毫秒数，返回对应的时间。示例：TODATE(1023542354746)返回2002年6月8日。3 参数是日期格式的文本，那么返回这个文本对应的日期。示例：TODATE("2007/10/15")返回2007年10月5日组成的日期。TODATE("2007-6-8")返回2007年6月8日组成的日期。4 有两个参数，第一个参数是一个日期格式的文本，第二个参数是用来解析日期的格式。示例：TODATE("1/15/07","mm/dd/yy")返回07年1月15日组成的日期。特别的，"yyyyMMdd"是用来解析形如“20081230”之类的日期格式的。比如TODATE("20110830","yyyyMMdd")返回11年08月30日组成的日期5 有三个参数，第一个参数是一个日期格式的文本，第二个参数是用来解析日期的格式，第三个参数为解析日期的语言，如：zh（中文），en（英文）。示例：TODATE("星期三 1/15/07","EEE mm/dd/yy", "zh")返回07年1月15日组成的日期，使用“zh（中文）”才能够正常解析“星期三”这个字符串。',name:"TODATE",type:"DATETIME"},{def:"TODAY():获取当前日期。示例：如果系统日期是2005年9月10日则TODAY()等于2005-9-10。",name:"TODAY",type:"DATETIME"},{def:'TODOUBLE(text): 将文本转换成Double对象。Text:需要转换的文本。示例:TODOUBLE("123.21")等于 new Double(123.21)。',name:"TODOUBLE",type:"TEXT"},{def:'TOINTEGER(text): 将文本转换成Integer对象。Text:需要转换的文本。示例:TOINTEGER("123")等于 new Integer(123)。',name:"TOINTEGER",type:"TEXT"},{def:'TOTAL(X_AGG(array),range,agg)根据横纵轴或行列维度添加的字段对指标进行跨行汇总的计算。\n "第一个参数为用户计算的指标，该指标必须为聚合函数或聚合指标；第二个参数range为用户设置计算的范围，0为对所有行进行汇总，1为对组内所有行进行汇总；第三个参数agg为汇总的计算规则，"sum"为求和；"avg"为求平均，"max"为求最大值，"min"为求最小值示例：total(sum_agg(array),0,"sum")用户横轴轴拖拽省份，则该指标计算结果为，根据省份对销量进行分组汇总，然后计算平均每个省份的销量',name:"TOTAL",type:"TABLE_CAL"},{def:"Fine-Core_Formula_treelayer",name:"TREELAYER",type:"OTHER"},{def:'TRIM(text): 清除文本中所有空格，单词间的单个空格除外，也可用于带有不规则空格的文本。Text:需要清除空格的文本。示例:TRIM(" Monthly Report")等于Monthly Report。',name:"TRIM",type:"TEXT"},{def:"TRUNC(number,num_digits):将数字的小数部分截去，返回整数。number:需要截尾取整的数字。num_digits:用于指定取整精度的数字。示例:TRUNC(8.9) 等于 8TRUNC(-8.9) 等于 -8TRUNC(PI()) 等于 3",name:"TRUNC",type:"MATH"},{def:"UNIQUEARRAY(array):去掉数组array中的重复元素。示例：UNIQUEARRAY([14, 2, 3, 4, 3, 2, 5, 6, 2, 7, 9, 12, 3])返回[14, 2, 3, 4, 5, 6, 7, 9, 12].",name:"UNIQUEARRAY",type:"ARRAY"},{def:'UPPER(text): 将文本中所有的字符转化为大写。Text:需要转化为大写字符的文本，或是包含文本的单元格引用。示例:UPPER("notes")等于“NOTES”。如果单元格E5的值为“Examples”，则UPPER(E5)等于“EXAMPLES”。',name:"UPPER",type:"TEXT"},{def:"UUID():返回随机的UUID。示例:UUID()返回36位随机机器数。       UUID(32)返回32位随机机器数。",name:"UUID",type:"OTHER"},{def:"VAR_AGG(array): 根据当前分析维度，动态返回指标字段的方差，生成结果为一动态数据列，行数与当前分析维度行数一致。\n \"array必须为非聚合函数公式返回的结果，可以是某指标字段、维度或指标字段与普通公式的计算结果。\n \"示例：用户横轴为维度字段'日'时，纵轴的计算字段VAR_AGG(销量)返回的值为每日的销量方差；当用户横轴为维度字段'月'时，VAR_AGG(销量)返回的值为每月的销量方差。",name:"VAR_AGG",type:"AGG"},{def:"WEBIMAGE(path):在web页面上显示指定路径下的图片。",name:"WEBIMAGE",type:"OTHER"},{def:'WEEK(serial_num):返回一个代表一年中的第几周的数字。Serial_num:表示输入的日期。备注:FineReport将日期保存为系列数，一个系列数代表一个与之匹配的日期，以方便用户对日期进行数值式计算。在1900年日期系统中，FineReport电子表格将1900年1月1日保存为系列数2，将1900年1月2日保存为系列数3，将1900年1月3日保存为系列数4⋯⋯依此类推。如在1900年日期系统，1998年1月1日存为系列数35796。示例:WEEK("2010/1/1")等于52。WEEK("2010/1/6")等于1。WEEK(35796)等于1。',name:"WEEK",type:"DATETIME"},{def:"weekdate(year,month,weekOfMonth,dayOfWeek): 返回指定年月的指定周的周几的具体日期。示例：weekdate(2009,10,2,1)返回的是2009年的10月的第二个周的第一天即星期天的日期，返回的是2009-10-04最后一个参数dayOfWeek为-1时，表示这个周的最后一天示例：weekdate(2009,12,1,-1)返回的是2009年的12月的第一个周的最后一天即星期六的日期，返回的是2009-12-05",name:"WEEKDATE",type:"DATETIME"},{def:'WEEKDAY(Serial_number):获取日期并返回星期数。返回值为介于0到6之间的某一整数，分别代表星期中的某一天（从星期日到星期六）。Serial_number:输入的日期备注:FineReport将日期保存为系列数，一个系列数代表一个与之匹配的日期，以方便用户对日期进行数值式计算。在1900年日期系统中，FineReport电子表格将1900年1月1日保存为系列数2，将1900年1月2日保存为系列数3，将1900年1月3日保存为系列数4⋯⋯依此类推。如在1900年日期系统，1998年1月1日存为系列数35796。举例:WEEKDAY("2005/9/10")等于6（星期六）。WEEKDAY("2005/9/11")等于0（星期日）。WEEKDAY(35796)等于4（星期四）。',name:"WEEKDAY",type:"DATETIME"},{def:"WEIGHTEDAVERAGE(A1:A4,B1:B4): 返回指定数据的加权平均值。加权平均数是不同比重数据的平均数，加权平均数就是把原始数据按照合理的比例来计算。A1:A4,B1:B4:用于计算平均值的参数，A1~A4为数据，B1~B4为权值。示例:如果A1:A4为10,9,8,7，B1:B4为0.2,0.1,0.3,0.4则:WEIGHTEDAVERAGE(A1:A4,B1:B4)等于8.1。",name:"WEIGHTEDAVERAGE",type:"MATH"},{def:'YEAR:(serial_number)返回日期中的年。Year是介于1900和9999之间的一个数。Serial_number:含有所求的年的日期.备注:FineReport将日期保存为系列数，一个系列数代表一个与之匹配的日期，以方便用户对日期进行数值式计算。在1900年日期系统中，FineReport电子表格将1900年1月1日保存为系列数2，将1900年1月2日保存为系列数3，将1900年1月3日保存为系列数4⋯⋯依此类推。如在1900年日期系统，1998年1月1日存为系列数35796。示例:YEAR("2000/1/1")等于2000。YEAR("2006/05/05")等于2006。YEAR("1997/04/20")等于1997。YEAR("2000-1-1", "yyyy-MM-dd")等于2000。YEAR("2006-05-05", "yyyy-MM-dd")等于2006。YEAR("1997-04-20", "yyyy-MM-dd")等于1997。YEAR(35796)等于1998。',name:"YEAR",type:"DATETIME"},{def:'YEARDELTA(date, delta):返回指定日期后delta年的日期。示例：YEARDELTA("2008-10-10",10)等于2018-10-10。',name:"YEARDELTA",type:"DATETIME"}]},function(e,t){BI.resourceURL="http://fine-design-storage.oss-cn-shanghai.aliyuncs.com/fineui/2.0/resource/"},function(z,M){function r(e,t){var n,r,i=e.nodeName.toLowerCase();return"area"===i?(n=(r=e.parentNode).name,!(!e.href||!n||"map"!==r.nodeName.toLowerCase())&&(!!(r=s("img[usemap=#"+n+"]")[0])&&o(r))):(/input|select|textarea|button|object/.test(i)?!e.disabled:"a"===i&&e.href||t)&&o(e)}function o(e){return s.expr.filters.visible(e)&&!s(e).parents().addBack().filter(function(){return"hidden"===s.css(this,"visibility")}).length}s=BI.jQuery,n=0,i=/^ui-id-\d+$/,s.ui=s.ui||{},s.extend(s.ui,{version:"1.10.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),s.fn.extend({focus:(e=s.fn.focus,function(t,n){return"number"==typeof t?this.each(function(){var e=this;setTimeout(function(){s(e).focus(),n&&n.call(e)},t)}):e.apply(this,arguments)}),scrollParent:function(){var e=(s.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(s.css(this,"position"))&&/(auto|scroll)/.test(s.css(this,"overflow")+s.css(this,"overflow-y")+s.css(this,"overflow-x"))}):this.parents().filter(function(){return/(auto|scroll)/.test(s.css(this,"overflow")+s.css(this,"overflow-y")+s.css(this,"overflow-x"))})).eq(0);return/fixed/.test(this.css("position"))||!e.length?s(document):e},zIndex:function(e){if(void 0!==e)return this.css("zIndex",e);if(this.length)for(var t,n=s(this[0]);n.length&&n[0]!==document;){if(("absolute"===(t=n.css("position"))||"relative"===t||"fixed"===t)&&(t=parseInt(n.css("zIndex"),10),!isNaN(t)&&0!==t))return t;n=n.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){i.test(this.id)&&s(this).removeAttr("id")})}}),s.extend(s.expr[":"],{data:s.expr.createPseudo?s.expr.createPseudo(function(t){return function(e){return!!s.data(e,t)}}):function(e,t,n){return!!s.data(e,n[3])},focusable:function(e){return r(e,!isNaN(s.attr(e,"tabindex")))},tabbable:function(e){var t=s.attr(e,"tabindex"),n=isNaN(t);return(n||0<=t)&&r(e,!n)}}),s("<a>").outerWidth(1).jquery||s.each(["Width","Height"],function(e,n){var i="Width"===n?["Left","Right"]:["Top","Bottom"],r=n.toLowerCase(),o={innerWidth:s.fn.innerWidth,innerHeight:s.fn.innerHeight,outerWidth:s.fn.outerWidth,outerHeight:s.fn.outerHeight};function a(e,t,n,r){return s.each(i,function(){t-=parseFloat(s.css(e,"padding"+this))||0,n&&(t-=parseFloat(s.css(e,"border"+this+"Width"))||0),r&&(t-=parseFloat(s.css(e,"margin"+this))||0)}),t}s.fn["inner"+n]=function(e){return void 0===e?o["inner"+n].call(this):this.each(function(){s(this).css(r,a(this,e)+"px")})},s.fn["outer"+n]=function(e,t){return"number"!=typeof e?o["outer"+n].call(this,e):this.each(function(){s(this).css(r,a(this,e,!0,t)+"px")})}}),s.fn.addBack||(s.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),s("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(s.fn.removeData=(t=s.fn.removeData,function(e){return arguments.length?t.call(this,s.camelCase(e)):t.call(this)})),s.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),s.support.selectstart="onselectstart"in document.createElement("div"),s.fn.extend({disableSelection:function(){return this.bind((s.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),s.extend(s.ui,{plugin:{add:function(e,t,n){var r,i=s.ui[e].prototype;for(r in n)i.plugins[r]=i.plugins[r]||[],i.plugins[r].push([t,n[r]])},call:function(e,t,n){var r,i=e.plugins[t];if(i&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(e,t){var n;return"hidden"!==s(e).css("overflow")&&(n=!1,0<e[t=t&&"left"===t?"scrollLeft":"scrollTop"]||(e[t]=1,n=0<e[t],e[t]=0,n))}}),c=BI.jQuery,a=0,u=Array.prototype.slice,h=c.cleanData,c.cleanData=function(e){for(var t,n=0;null!=(t=e[n]);n++)try{c(t).triggerHandler("remove")}catch(r){}h(e)},c.widget=function(e,n,t){var r,i,o,a,s={},l=e.split(".")[0];e=e.split(".")[1],r=l+"-"+e,t||(t=n,n=c.Widget),c.expr[":"][r.toLowerCase()]=function(e){return!!c.data(e,r)},c[l]=c[l]||{},i=c[l][e],o=c[l][e]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},c.extend(o,i,{version:t.version,_proto:c.extend({},t),_childConstructors:[]}),(a=new n).options=c.widget.extend({},a.options),c.each(t,function(t,r){var i,o;c.isFunction(r)?s[t]=(i=function(){return n.prototype[t].apply(this,arguments)},o=function(e){return n.prototype[t].apply(this,e)},function(){var e,t=this._super,n=this._superApply;return this._super=i,this._superApply=o,e=r.apply(this,arguments),this._super=t,this._superApply=n,e}):s[t]=r}),o.prototype=c.widget.extend(a,{widgetEventPrefix:i?a.widgetEventPrefix:e},s,{constructor:o,namespace:l,widgetName:e,widgetFullName:r}),i?(c.each(i._childConstructors,function(e,t){var n=t.prototype;c.widget(n.namespace+"."+n.widgetName,o,t._proto)}),delete i._childConstructors):n._childConstructors.push(o),c.widget.bridge(e,o)},c.widget.extend=function(e){for(var t,n,r=u.call(arguments,1),i=0,o=r.length;i<o;i++)for(t in r[i])n=r[i][t],r[i].hasOwnProperty(t)&&n!==l&&(c.isPlainObject(n)?e[t]=c.isPlainObject(e[t])?c.widget.extend({},e[t],n):c.widget.extend({},n):e[t]=n);return e},c.widget.bridge=function(o,t){var a=t.prototype.widgetFullName||o;c.fn[o]=function(n){var e="string"==typeof n,r=u.call(arguments,1),i=this;return n=!e&&r.length?c.widget.extend.apply(null,[n].concat(r)):n,e?this.each(function(){var e,t=c.data(this,a);return t?c.isFunction(t[n])&&"_"!==n.charAt(0)?(e=t[n].apply(t,r))!==t&&e!==l?(i=e&&e.jquery?i.pushStack(e.get()):e,!1):void 0:c.error("no such method '"+n+"' for "+o+" widget instance"):c.error("cannot call methods on "+o+" prior to initialization; attempted to call method '"+n+"'")}):this.each(function(){var e=c.data(this,a);e?e.option(n||{})._init():c.data(this,a,new t(n,this))}),i}},c.Widget=function(){},c.Widget._childConstructors=[],c.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,t){t=c(t||this.defaultElement||this)[0],this.element=c(t),this.uuid=a++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=c.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=c(),this.hoverable=c(),this.focusable=c(),t!==this&&(c.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=c(t.style?t.ownerDocument:t.document||t),this.window=c(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:c.noop,_getCreateEventData:c.noop,_create:c.noop,_init:c.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(c.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:c.noop,widget:function(){return this.element},option:function(e,t){var n,r,i,o=e;if(0===arguments.length)return c.widget.extend({},this.options);if("string"==typeof e)if(o={},e=(n=e.split(".")).shift(),n.length){for(r=o[e]=c.widget.extend({},this.options[e]),i=0;i<n.length-1;i++)r[n[i]]=r[n[i]]||{},r=r[n[i]];if(e=n.pop(),t===l)return r[e]===l?null:r[e];r[e]=t}else{if(t===l)return this.options[e]===l?null:this.options[e];o[e]=t}return this._setOptions(o),this},_setOptions:function(e){for(var t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(i,o,e){var a,s=this;"boolean"!=typeof i&&(e=o,o=i,i=!1),e?(o=a=c(o),this.bindings=this.bindings.add(o)):(e=o,o=this.element,a=this.widget()),c.each(e,function(e,t){function n(){if(i||!0!==s.options.disabled&&!c(this).hasClass("ui-state-disabled"))return("string"==typeof t?s[t]:t).apply(s,arguments)}"string"!=typeof t&&(n.guid=t.guid=t.guid||n.guid||c.guid++);var e=e.match(/^(\w+)\s*(.*)$/),r=e[1]+s.eventNamespace,e=e[2];e?a.delegate(e,r,n):o.bind(r,n)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){var n=this;return setTimeout(function(){return("string"==typeof e?n[e]:e).apply(n,arguments)},t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){c(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){c(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){c(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){c(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,t,n){var r,i,o=this.options[e];if(n=n||{},(t=c.Event(t)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],i=t.originalEvent)for(r in i)r in t||(t[r]=i[r]);return this.element.trigger(t,n),!(c.isFunction(o)&&!1===o.apply(this.element[0],[t].concat(n))||t.isDefaultPrevented())}},c.each({show:"fadeIn",hide:"fadeOut"},function(o,a){c.Widget.prototype["_"+o]=function(t,e,n){var r=(e="string"==typeof e?{effect:e}:e)?!0!==e&&"number"!=typeof e&&e.effect||a:o,i=!c.isEmptyObject(e="number"==typeof(e=e||{})?{duration:e}:e);e.complete=n,e.delay&&t.delay(e.delay),i&&c.effects&&c.effects.effect[r]?t[o](e):r!==o&&t[r]?t[r](e.duration,e.easing,n):t.queue(function(e){c(this)[o](),n&&n.call(t[0]),e()})}}),d=BI.jQuery,p=!1,d(document).mouseup(function(){p=!1}),d.widget("ui.mouse",{version:"1.10.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(e){if(!0===d.data(e.target,t.widgetName+".preventClickEvent"))return d.removeData(e.target,t.widgetName+".preventClickEvent"),e.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&d(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){var t,n,r;if(!p)return this._mouseStarted&&this._mouseUp(e),n=1===(this._mouseDownEvent=e).which,r=!("string"!=typeof(t=this).options.cancel||!e.target.nodeName)&&d(e.target).closest(this.options.cancel).length,n&&!r&&this._mouseCapture(e)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){t.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(e),!this._mouseStarted)?e.preventDefault():(!0===d.data(e.target,this.widgetName+".preventClickEvent")&&d.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return t._mouseMove(e)},this._mouseUpDelegate=function(e){return t._mouseUp(e)},d(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),p=!0)),!0},_mouseMove:function(e){return d.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return d(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&d.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}});var s,e,t,n,i,c,l,a,u,h,d,p,f,m,g,v,b,x=BI.jQuery;x.ui=x.ui||{};var y,E=Math.max,S=Math.abs,T=Math.round,C=/left|center|right/,w=/top|center|bottom/,B=/[\+\-]\d+(\.[\d]+)?%?/,R=/^\w+/,F=/%$/,D=x.fn.position;function H(e,t,n){return[parseFloat(e[0])*(F.test(e[0])?t/100:1),parseFloat(e[1])*(F.test(e[1])?n/100:1)]}function N(e,t){return parseInt(x.css(e,t),10)||0}x.position={scrollbarWidth:function(){var e,t,n;return void 0!==y?y:(n=(t=x("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>")).children()[0],x("body").append(t),e=n.offsetWidth,t.css("overflow","scroll"),e===(n=n.offsetWidth)&&(n=t[0].clientWidth),t.remove(),y=e-n)},getScrollInfo:function(e){var t=e.isWindow?"":e.element.css("overflow-x"),n=e.isWindow?"":e.element.css("overflow-y"),t="scroll"===t||"auto"===t&&e.width<e.element[0].scrollWidth;return{width:"scroll"===n||"auto"===n&&e.height<e.element[0].scrollHeight?x.position.scrollbarWidth():0,height:t?x.position.scrollbarWidth():0}},getWithinInfo:function(e){var e=x(e||window),t=x.isWindow(e[0]);return{element:e,isWindow:t,offset:e.offset()||{left:0,top:0},scrollLeft:e.scrollLeft(),scrollTop:e.scrollTop(),width:t?e.width():e.outerWidth(),height:t?e.height():e.outerHeight()}}},x.fn.position=function(h){if(!h||!h.of)return D.apply(this,arguments);h=x.extend({},h);var d,p,f,m,g,e,b=x(h.of),y=x.position.getWithinInfo(h.within),v=x.position.getScrollInfo(y),_=(h.collision||"flip").split(" "),I={},t=9===(t=(e=b)[0]).nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:x.isWindow(t)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:t.preventDefault?{width:0,height:0,offset:{top:t.pageY,left:t.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()};return b[0].preventDefault&&(h.at="left top"),p=t.width,f=t.height,g=x.extend({},m=t.offset),x.each(["my","at"],function(){var e,t,n=(h[this]||"").split(" ");(n=1===n.length?C.test(n[0])?n.concat(["center"]):w.test(n[0])?["center"].concat(n):["center","center"]:n)[0]=C.test(n[0])?n[0]:"center",n[1]=w.test(n[1])?n[1]:"center",e=B.exec(n[0]),t=B.exec(n[1]),I[this]=[e?e[0]:0,t?t[0]:0],h[this]=[R.exec(n[0])[0],R.exec(n[1])[0]]}),1===_.length&&(_[1]=_[0]),"right"===h.at[0]?g.left+=p:"center"===h.at[0]&&(g.left+=p/2),"bottom"===h.at[1]?g.top+=f:"center"===h.at[1]&&(g.top+=f/2),d=H(I.at,p,f),g.left+=d[0],g.top+=d[1],this.each(function(){var n,e,a=x(this),s=a.outerWidth(),l=a.outerHeight(),t=N(this,"marginLeft"),r=N(this,"marginTop"),i=s+t+N(this,"marginRight")+v.width,o=l+r+N(this,"marginBottom")+v.height,c=x.extend({},g),u=H(I.my,a.outerWidth(),a.outerHeight());"right"===h.my[0]?c.left-=s:"center"===h.my[0]&&(c.left-=s/2),"bottom"===h.my[1]?c.top-=l:"center"===h.my[1]&&(c.top-=l/2),c.left+=u[0],c.top+=u[1],x.support.offsetFractions||(c.left=T(c.left),c.top=T(c.top)),n={marginLeft:t,marginTop:r},x.each(["left","top"],function(e,t){x.ui.position[_[e]]&&x.ui.position[_[e]][t](c,{targetWidth:p,targetHeight:f,elemWidth:s,elemHeight:l,collisionPosition:n,collisionWidth:i,collisionHeight:o,offset:[d[0]+u[0],d[1]+u[1]],my:h.my,at:h.at,within:y,elem:a})}),h.using&&(e=function(e){var t=m.left-c.left,n=t+p-s,r=m.top-c.top,i=r+f-l,o={target:{element:b,left:m.left,top:m.top,width:p,height:f},element:{element:a,left:c.left,top:c.top,width:s,height:l},horizontal:n<0?"left":0<t?"right":"center",vertical:i<0?"top":0<r?"bottom":"middle"};p<s&&S(t+n)<p&&(o.horizontal="center"),f<l&&S(r+i)<f&&(o.vertical="middle"),E(S(t),S(n))>E(S(r),S(i))?o.important="horizontal":o.important="vertical",h.using.call(this,e,o)}),a.offset(x.extend(c,{using:e}))})},x.ui.position={fit:{left:function(e,t){var n,r=t.within,i=r.isWindow?r.scrollLeft:r.offset.left,r=r.width,o=e.left-t.collisionPosition.marginLeft,a=i-o,s=o+t.collisionWidth-r-i;t.collisionWidth>r?0<a&&s<=0?(n=e.left+a+t.collisionWidth-r-i,e.left+=a-n):e.left=!(0<s&&a<=0)&&s<a?i+r-t.collisionWidth:i:0<a?e.left+=a:0<s?e.left-=s:e.left=E(e.left-o,e.left)},top:function(e,t){var n,r=t.within,r=r.isWindow?r.scrollTop:r.offset.top,i=t.within.height,o=e.top-t.collisionPosition.marginTop,a=r-o,s=o+t.collisionHeight-i-r;t.collisionHeight>i?0<a&&s<=0?(n=e.top+a+t.collisionHeight-i-r,e.top+=a-n):e.top=!(0<s&&a<=0)&&s<a?r+i-t.collisionHeight:r:0<a?e.top+=a:0<s?e.top-=s:e.top=E(e.top-o,e.top)}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,i=n.width,n=n.isWindow?n.scrollLeft:n.offset.left,o=e.left-t.collisionPosition.marginLeft,a=o-n,o=o+t.collisionWidth-i-n,s="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,l="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,c=-2*t.offset[0];a<0?((i=e.left+s+l+c+t.collisionWidth-i-r)<0||i<S(a))&&(e.left+=s+l+c):0<o&&(0<(r=e.left-t.collisionPosition.marginLeft+s+l+c-n)||S(r)<o)&&(e.left+=s+l+c)},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,i=n.height,n=n.isWindow?n.scrollTop:n.offset.top,o=e.top-t.collisionPosition.marginTop,a=o-n,o=o+t.collisionHeight-i-n,s="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,l="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,c=-2*t.offset[1];a<0?(i=e.top+s+l+c+t.collisionHeight-i-r,e.top+s+l+c>a&&(i<0||i<S(a))&&(e.top+=s+l+c)):0<o&&(r=e.top-t.collisionPosition.marginTop+s+l+c-n,e.top+s+l+c>o&&(0<r||S(r)<o)&&(e.top+=s+l+c))}},flipfit:{left:function(){x.ui.position.flip.left.apply(this,arguments),x.ui.position.fit.left.apply(this,arguments)},top:function(){x.ui.position.flip.top.apply(this,arguments),x.ui.position.fit.top.apply(this,arguments)}}};var _,I=document.getElementsByTagName("body")[0],A=document.createElement("div"),O=document.createElement(I?"div":"body"),L={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};for(_ in I&&x.extend(L,{position:"absolute",left:"-1000px",top:"-1000px"}),L)O.style[_]=L[_];function V(e,t,n){return t<e&&e<t+n}O.appendChild(A),(I=I||document.documentElement).insertBefore(O,I.firstChild),A.style.cssText="position: absolute; left: 10.7432222px;",A=x(A).offset().left,x.support.offsetFractions=10<A&&A<11,O.innerHTML="",I.removeChild(O),(f=BI.jQuery).widget("ui.resizable",f.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,e=this.options;if(this.element.addClass("ui-resizable"),f.extend(this,{_aspectRatio:!!e.aspectRatio,aspectRatio:e.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:e.helper||e.ghost||e.animate?e.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(/relative/.test(this.element.css("position"))&&f.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"}),this.element.wrap(f('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=e.handles||(f(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor==String){"all"==this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var n=this.handles.split(",");this.handles={};for(var r=0;r<n.length;r++){var i=f.trim(n[r]),o=f('<div class="ui-resizable-handle '+("ui-resizable-"+i)+'"></div>');/sw|se|ne|nw/.test(i)&&o.css({zIndex:++e.zIndex}),"se"==i&&o.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[i]=".ui-resizable-"+i,this.element.append(o)}}this._renderAxis=function(e){for(var t in e=e||this.element,this.handles){var n,r;this.handles[t].constructor==String&&(this.handles[t]=f(this.handles[t],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=f(this.handles[t],this.element),n=0,n=/sw|ne|nw|se|n|s/.test(t)?r.outerHeight():r.outerWidth(),r=["padding",/ne|nw|n/.test(t)?"Top":/se|sw|s/.test(t)?"Bottom":/^e$/.test(t)?"Right":"Left"].join(""),e.css(r,n),this._proportionallyResize()),f(this.handles[t]).length}},this._renderAxis(this.element),this._handles=f(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){var e;t.resizing||(this.className&&(e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),t.axis=e&&e[1]?e[1]:"se")}),e.autoHide&&(this._handles.hide(),f(this.element).addClass("ui-resizable-autohide").hover(function(){f(this).removeClass("ui-resizable-autohide"),t._handles.show()},function(){t.resizing||(f(this).addClass("ui-resizable-autohide"),t._handles.hide())})),this._mouseInit()},destroy:function(){this._mouseDestroy();var e,t=function(e){f(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(t(this.element),(e=this.element).after(this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")})).remove()),this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(e){var t,n=!1;for(t in this.handles)f(this.handles[t])[0]==e.target&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var t=this.options,n=(this.element.position(),this.element),r=(this.resizing=!0,this.documentScroll={top:f(document).scrollTop(),left:f(document).scrollLeft()},this._renderProxy(),m(this.helper.css("left"))),i=m(this.helper.css("top")),r=(t.containment&&(r+=f(t.containment).scrollLeft()||0,i+=f(t.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:i},this.size=this._helper?{width:n.outerWidth(),height:n.outerHeight()}:{width:n.width(),height:n.height()},this.originalSize=this._helper?{width:n.outerWidth(),height:n.outerHeight()}:{width:n.width(),height:n.height()},this.originalPosition={left:r,top:i},this.sizeDiff={width:n.outerWidth()-n.width(),height:n.outerHeight()-n.height()},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof t.aspectRatio?t.aspectRatio:this.originalSize.width/this.originalSize.height||1,f(".ui-resizable-"+this.axis).css("cursor"));return f("body").css("cursor","auto"==r?this.axis+"-resize":r),n.addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var t=this.helper,n=(this.options,this.originalMousePosition),r=this.axis,i=e.pageX-n.left||0,n=e.pageY-n.top||0,r=this._change[r];return r&&(i=r.apply(this,[e,i,n]),f.browser.msie&&f.browser.version,this.sizeDiff,(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._propagate("resize",e),t.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(i),this._trigger("resize",e,this.ui())),!1},_mouseStop:function(e){this.resizing=!1;var t,n,r,i=this.options,o=this;return this._helper&&(n=(t=(n=this._proportionallyResizeElements).length&&/textarea/i.test(n[0].nodeName))&&f.ui.hasScroll(n[0],"left")?0:o.sizeDiff.height,t=t?0:o.sizeDiff.width,t={width:o.size.width-t,height:o.size.height-n},n=parseInt(o.element.css("left"),10)+(o.position.left-o.originalPosition.left)||null,r=parseInt(o.element.css("top"),10)+(o.position.top-o.originalPosition.top)||null,i.animate||this.element.css(f.extend(t,{top:r,left:n})),o.helper.height(o.size.height),o.helper.width(o.size.width),this._helper&&!i.animate&&this._proportionallyResize()),f("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateCache:function(e){this.options;this.offset=this.helper.offset(),g(e.left)&&(this.position.left=e.left),g(e.top)&&(this.position.top=e.top),g(e.height)&&(this.size.height=e.height),g(e.width)&&(this.size.width=e.width)},_updateRatio:function(e,t){this.options;var n=this.position,r=this.size,i=this.axis;return e.height?e.width=r.height*this.aspectRatio:e.width&&(e.height=r.width/this.aspectRatio),"sw"==i&&(e.left=n.left+(r.width-e.width),e.top=null),"nw"==i&&(e.top=n.top+(r.height-e.height),e.left=n.left+(r.width-e.width)),e},_respectSize:function(e,t){this.helper;var n=this.options,t=(this._aspectRatio||t.shiftKey,this.axis),r=g(e.width)&&n.maxWidth&&n.maxWidth<e.width,i=g(e.height)&&n.maxHeight&&n.maxHeight<e.height,o=g(e.width)&&n.minWidth&&n.minWidth>e.width,a=g(e.height)&&n.minHeight&&n.minHeight>e.height,s=(o&&(e.width=n.minWidth),a&&(e.height=n.minHeight),r&&(e.width=n.maxWidth),i&&(e.height=n.maxHeight),this.originalPosition.left+this.originalSize.width),l=this.position.top+this.size.height,c=/sw|nw|w/.test(t),t=/nw|ne|n/.test(t),o=(o&&c&&(e.left=s-n.minWidth),r&&c&&(e.left=s-n.maxWidth),a&&t&&(e.top=l-n.minHeight),i&&t&&(e.top=l-n.maxHeight),!e.width&&!e.height);return o&&!e.left&&e.top?e.top=null:o&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){this.options;if(this._proportionallyResizeElements.length)for(var e=this.helper||this.element,t=0;t<this._proportionallyResizeElements.length;t++){var n,r,i=this._proportionallyResizeElements[t];this.borderDif||(n=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],r=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")],this.borderDif=f.map(n,function(e,t){return(parseInt(e,10)||0)+(parseInt(r[t],10)||0)})),f.browser.msie&&(f(e).is(":hidden")||f(e).parents(":hidden").length)||i.css({height:e.height()-this.borderDif[0]-this.borderDif[2]||0,width:e.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var e,t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||f('<div style="overflow:hidden;"></div>'),e=(t=f.browser.msie&&f.browser.version<7)?1:0,t=t?2:-1,this.helper.addClass(this._helper).css({width:this.element.outerWidth()+t,height:this.element.outerHeight()+t,position:"absolute",left:this.elementOffset.left-e+"px",top:this.elementOffset.top-e+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t,n){return{width:this.originalSize.width+t}},w:function(e,t,n){this.options;var r=this.originalSize;return{left:this.originalPosition.left+t,width:r.width-t}},n:function(e,t,n){this.options;var r=this.originalSize;return{top:this.originalPosition.top+n,height:r.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(e,t,n){return f.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,t,n]))},sw:function(e,t,n){return f.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,t,n]))},ne:function(e,t,n){return f.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,t,n]))},nw:function(e,t,n){return f.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,t,n]))}},_propagate:function(e,t){f.ui.plugin.call(this,e,[t,this.ui()]),"resize"!=e&&this._trigger(e,t,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),f.extend(f.ui.resizable,{version:"1.8.1"}),f.ui.plugin.add("resizable","alsoResize",{start:function(e,t){var n=f(this).data("resizable").options,r=function(e){f(e).each(function(){f(this).data("resizable-alsoresize",{width:parseInt(f(this).width(),10),height:parseInt(f(this).height(),10),left:parseInt(f(this).css("left"),10),top:parseInt(f(this).css("top"),10)})})};"object"!=typeof n.alsoResize||n.alsoResize.parentNode?r(n.alsoResize):n.alsoResize.length?(n.alsoResize=n.alsoResize[0],r(n.alsoResize)):f.each(n.alsoResize,function(e,t){r(e)})},resize:function(e,t){var o=f(this).data("resizable"),n=o.options,r=o.originalSize,i=o.originalPosition,a={height:o.size.height-r.height||0,width:o.size.width-r.width||0,top:o.position.top-i.top||0,left:o.position.left-i.left||0},s=function(e,n){f(e).each(function(){var e=f(this),r=f(this).data("resizable-alsoresize"),i={},t=n&&n.length?n:["width","height","top","left"];f.each(t||["width","height","top","left"],function(e,t){var n=(r[t]||0)+(a[t]||0);n&&0<=n&&(i[t]=n||null)}),/relative/.test(e.css("position"))&&f.browser.opera&&(o._revertToRelativePosition=!0,e.css({position:"absolute",top:"auto",left:"auto"})),e.css(i)})};"object"!=typeof n.alsoResize||n.alsoResize.nodeType?s(n.alsoResize):f.each(n.alsoResize,function(e,t){s(e,t)})},stop:function(e,t){var n=f(this).data("resizable");n._revertToRelativePosition&&f.browser.opera&&(n._revertToRelativePosition=!1,el.css({position:"relative"})),f(this).removeData("resizable-alsoresize-start")}}),f.ui.plugin.add("resizable","animate",{stop:function(t,e){var n=f(this).data("resizable"),r=n.options,i=n._proportionallyResizeElements,o=i.length&&/textarea/i.test(i[0].nodeName),a=o&&f.ui.hasScroll(i[0],"left")?0:n.sizeDiff.height,o=o?0:n.sizeDiff.width,o={width:n.size.width-o,height:n.size.height-a},a=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,s=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(f.extend(o,s&&a?{top:s,left:a}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var e={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};i&&i.length&&f(i[0]).css({width:e.width,height:e.height}),n._updateCache(e),n._propagate("resize",t)}})}}),f.ui.plugin.add("resizable","containment",{start:function(e,t){var n,r,i,o,a=f(this).data("ui-resizable"),s=a.options,l=a.element,s=s.containment,l=s instanceof f?s.get(0):/parent/.test(s)?l.parent().get(0):s;l&&(a.containerElement=f(l),/document/.test(s)||s==document?(a.containerOffset={left:0,top:0},a.containerPosition={left:0,top:0},a.parentData={element:f(document),left:0,top:0,width:f(document).width(),height:f(document).height()||document.body.parentNode.scrollHeight}):(n=f(l),r=[],f(["Top","Right","Left","Bottom"]).each(function(e,t){r[e]=m(n.css("padding"+t))}),a.containerOffset=n.offset(),a.containerPosition=n.position(),a.containerSize={height:n.innerHeight()-r[3],width:n.innerWidth()-r[1]},s=a.containerOffset,o=a.containerSize.height,i=a.containerSize.width,i=f.ui.hasScroll(l,"left")?l.scrollWidth:i,o=f.ui.hasScroll(l)?l.scrollHeight:o,a.parentData={element:l,left:s.left,top:s.top,width:i,height:o}))},resize:function(e,t){var n=f(this).data("resizable"),r=n.options,i=(n.containerSize,n.containerOffset),o=(n.size,n.position),e=n._aspectRatio||e.shiftKey,a={top:0,left:0},s=n.containerElement,s=(s[0]!=document&&/static/.test(s.css("position"))&&(a=i),o.left<(n._helper?i.left:0)&&(n.size.width=n.size.width+(n._helper?n.position.left-i.left:n.position.left-a.left),e&&(n.size.height=n.size.width/r.aspectRatio),n.position.left=r.helper?i.left:0),o.top<(n._helper?i.top:0)&&(n.size.height=n.size.height+(n._helper?n.position.top-i.top:n.position.top),e&&(n.size.width=n.size.height*r.aspectRatio),n.position.top=n._helper?i.top:0),n.offset.left=n.parentData.left+n.position.left,n.offset.top=n.parentData.top+n.position.top,Math.abs((n._helper,n.offset.left-a.left+n.sizeDiff.width))),o=Math.abs((n._helper?n.offset.top-a.top:n.offset.top-i.top)+n.sizeDiff.height),r=n.containerElement.get(0)==n.element.parent().get(0),a=/relative|absolute/.test(n.containerElement.css("position"));r&&a&&(s-=n.parentData.left),s+n.size.width>=n.parentData.width&&(n.size.width=n.parentData.width-s,e&&(n.size.height=n.size.width/n.aspectRatio)),o+n.size.height>=n.parentData.height&&(n.size.height=n.parentData.height-o,e&&(n.size.width=n.size.height*n.aspectRatio))},stop:function(e,t){var n=f(this).data("resizable"),r=n.options,i=(n.position,n.containerOffset),o=n.containerPosition,a=n.containerElement,s=f(n.helper),l=s.offset(),c=s.outerWidth()-n.sizeDiff.width,s=s.outerHeight()-n.sizeDiff.height;n._helper&&!r.animate&&/relative/.test(a.css("position"))&&f(this).css({left:l.left-o.left-i.left,width:c,height:s}),n._helper&&!r.animate&&/static/.test(a.css("position"))&&f(this).css({left:l.left-o.left-i.left,width:c,height:s})}}),f.ui.plugin.add("resizable","ghost",{start:function(e,t){var n=f(this).data("resizable"),r=n.options,i=n.size;n.ghost=n.originalElement.clone(),n.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof r.ghost?r.ghost:""),n.ghost.appendTo(n.helper)},resize:function(e,t){var n=f(this).data("resizable");n.options;n.ghost&&n.ghost.css({position:"relative",height:n.size.height,width:n.size.width})},stop:function(e,t){var n=f(this).data("resizable");n.options;n.ghost&&n.helper&&n.helper.get(0).removeChild(n.ghost.get(0))}}),f.ui.plugin.add("resizable","grid",{resize:function(e,t){var n=f(this).data("resizable"),r=n.options,i=n.size,o=n.originalSize,a=n.originalPosition,s=n.axis,e=(r._aspectRatio||e.shiftKey,r.grid="number"==typeof r.grid?[r.grid,r.grid]:r.grid,Math.round((i.width-o.width)/(r.grid[0]||1))*(r.grid[0]||1)),i=Math.round((i.height-o.height)/(r.grid[1]||1))*(r.grid[1]||1);/^(se|s|e)$/.test(s)?(n.size.width=o.width+e,n.size.height=o.height+i):/^(ne)$/.test(s)?(n.size.width=o.width+e,n.size.height=o.height+i,n.position.top=a.top-i):(/^(sw)$/.test(s)?(n.size.width=o.width+e,n.size.height=o.height+i):(n.size.width=o.width+e,n.size.height=o.height+i,n.position.top=a.top-i),n.position.left=a.left-e)}}),m=function(e){return parseInt(e,10)||0},g=function(e){return!isNaN(parseInt(e,10))},(v=BI.jQuery).widget("ui.draggable",v.ui.mouse,{version:"1.10.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,isChangeTopLeft:!0,distance:10,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var t=this.options;return!(this.helper||t.disabled||0<v(e.target).closest(".ui-resizable-handle").length)&&(this.handle=this._getHandle(e),!!this.handle&&(v(!0===t.iframeFix?"iframe":t.iframeFix).each(function(){v("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e9}).css(v(this).offset()).appendTo("body")}),!0))},_mouseStart:function(e){var t=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),v.ui.ddmanager&&(v.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},v.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,t.cursorAt&&this._adjustOffsetFromHelper(t.cursorAt),t.containment&&this._setContainment(),!1===this._trigger("start",e)?(this._clear(),!1):(this._cacheHelperProportions(),v.ui.ddmanager&&!t.dropBehaviour&&v.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),v.ui.ddmanager&&v.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,t){if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!t){t=this._uiHash();if(!1===this._trigger("drag",e,t))return this._mouseUp({}),!1;this.position=t.position}return this.options.axis&&"y"===this.options.axis||1!=this.options.isChangeTopLeft||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||1!=this.options.isChangeTopLeft||(this.helper[0].style.top=this.position.top+"px"),v.ui.ddmanager&&v.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var t,n=this,r=!1,i=!1;for(v.ui.ddmanager&&!this.options.dropBehaviour&&(i=v.ui.ddmanager.drop(this,e)),this.dropped&&(i=this.dropped,this.dropped=!1),t=this.element[0];t=t&&t.parentNode;)t===document&&(r=!0);return!r&&"original"===this.options.helper||("invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||!0===this.options.revert||v.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?v(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==n._trigger("stop",e)&&n._clear()}):!1!==this._trigger("stop",e)&&this._clear()),!1},_mouseUp:function(e){return v("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),v.ui.ddmanager&&v.ui.ddmanager.dragStop(this,e),v.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!v(e.target).closest(this.element.find(this.options.handle)).length},_createHelper:function(e){var t=this.options,e=v.isFunction(t.helper)?v(t.helper.apply(this.element[0],[e])):"clone"===t.helper?this.element.clone().removeAttr("id"):this.element;return e.parents("body").length||e.appendTo("parent"===t.appendTo?this.element[0].parentNode:t.appendTo),e[0]===this.element[0]||/(fixed|absolute)/.test(e.css("position"))||e.css("position","absolute"),e},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),"left"in(e=v.isArray(e)?{left:+e[0],top:+e[1]||0}:e)&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&v.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),{top:(e=this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&v.ui.ie?{top:0,left:0}:e).top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){var e;return"relative"===this.cssPosition?{top:(e=this.element.position()).top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}:{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,t,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),"document"!==n.containment&&"window"!==n.containment||(this.containment=["document"===n.containment?0:v(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"===n.containment?0:v(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"===n.containment?0:v(window).scrollLeft())+v("document"===n.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"===n.containment?0:v(window).scrollTop())+(v("document"===n.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||n.containment.constructor===Array?n.containment.constructor===Array&&(this.containment=n.containment):(t=(n=v(n.containment))[0])&&(e="hidden"!==v(t).css("overflow"),this.containment=[(parseInt(v(t).css("borderLeftWidth"),10)||0)+(parseInt(v(t).css("paddingLeft"),10)||0),(parseInt(v(t).css("borderTopWidth"),10)||0)+(parseInt(v(t).css("paddingTop"),10)||0),(e?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(v(t).css("borderRightWidth"),10)||0)-(parseInt(v(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(v(t).css("borderBottomWidth"),10)||0)-(parseInt(v(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n)},_convertPositionTo:function(e,t){t=t||this.position;var e="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&v.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(n[0].tagName);return{top:t.top+this.offset.relative.top*e+this.offset.parent.top*e-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():r?0:n.scrollTop())*e,left:t.left+this.offset.relative.left*e+this.offset.parent.left*e-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():r?0:n.scrollLeft())*e}},_generatePosition:function(e){var t,n=this.options,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&v.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName),o=e.pageX,a=e.pageY;return this.originalPosition&&(this.containment&&(t=this.relative_container?(t=this.relative_container.offset(),[this.containment[0]+t.left,this.containment[1]+t.top,this.containment[2]+t.left,this.containment[3]+t.top]):this.containment,e.pageX-this.offset.click.left<t[0]&&(o=t[0]+this.offset.click.left),e.pageY-this.offset.click.top<t[1]&&(a=t[1]+this.offset.click.top),e.pageX-this.offset.click.left>t[2]&&(o=t[2]+this.offset.click.left),e.pageY-this.offset.click.top>t[3]&&(a=t[3]+this.offset.click.top)),n.grid&&(e=n.grid[1]?this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY,a=!t||e-this.offset.click.top>=t[1]||e-this.offset.click.top>t[3]?e:e-this.offset.click.top>=t[1]?e-n.grid[1]:e+n.grid[1],e=n.grid[0]?this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX,o=!t||e-this.offset.click.left>=t[0]||e-this.offset.click.left>t[2]?e:e-this.offset.click.left>=t[0]?e-n.grid[0]:e+n.grid[0])),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,t,n){return n=n||this._uiHash(),v.ui.plugin.call(this,e,[t,n]),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),v.Widget.prototype._trigger.call(this,e,t,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),v.ui.plugin.add("draggable","connectToSortable",{start:function(t,e){var n=v(this).data("ui-draggable"),r=n.options,i=v.extend({},e,{item:n.element});n.sortables=[],v(r.connectToSortable).each(function(){var e=v.data(this,"ui-sortable");e&&!e.options.disabled&&(n.sortables.push({instance:e,shouldRevert:e.options.revert}),e.refreshPositions(),e._trigger("activate",t,i))})},stop:function(e,t){var n=v(this).data("ui-draggable"),r=v.extend({},t,{item:n.element});v.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,r))})},drag:function(n,r){var i=v(this).data("ui-draggable"),o=this;v.each(i.sortables,function(){var e=!1,t=this;this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(e=!0,v.each(i.sortables,function(){return this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,e=this!==t&&this.instance._intersectsWith(this.instance.containerCache)&&v.contains(t.instance.element[0],this.instance.element[0])?!1:e})),e?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=v(o).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return r.helper[0]},n.target=this.instance.currentItem[0],this.instance._mouseCapture(n,!0),this.instance._mouseStart(n,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",n),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(n)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",n,this.instance._uiHash(this.instance)),this.instance._mouseStop(n,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",n),i.dropped=!1)})}}),v.ui.plugin.add("draggable","cursor",{start:function(){var e=v("body"),t=v(this).data("ui-draggable").options;e.css("cursor")&&(t._cursor=e.css("cursor")),e.css("cursor",t.cursor)},stop:function(){var e=v(this).data("ui-draggable").options;e._cursor&&v("body").css("cursor",e._cursor)}}),v.ui.plugin.add("draggable","opacity",{start:function(e,t){var t=v(t.helper),n=v(this).data("ui-draggable").options;t.css("opacity")&&(n._opacity=t.css("opacity")),t.css("opacity",n.opacity)},stop:function(e,t){var n=v(this).data("ui-draggable").options;n._opacity&&v(t.helper).css("opacity",n._opacity)}}),v.ui.plugin.add("draggable","scroll",{start:function(){var e=v(this).data("ui-draggable");e.scrollParent[0]!==document&&"HTML"!==e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var t=v(this).data("ui-draggable"),n=t.options,r=!1;t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName?(n.axis&&"x"===n.axis||(t.overflowOffset.top+t.scrollParent[0].offsetHeight-e.pageY<n.scrollSensitivity?t.scrollParent[0].scrollTop=r=t.scrollParent[0].scrollTop+n.scrollSpeed:e.pageY-t.overflowOffset.top<n.scrollSensitivity&&(t.scrollParent[0].scrollTop=r=t.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(t.overflowOffset.left+t.scrollParent[0].offsetWidth-e.pageX<n.scrollSensitivity?t.scrollParent[0].scrollLeft=r=t.scrollParent[0].scrollLeft+n.scrollSpeed:e.pageX-t.overflowOffset.left<n.scrollSensitivity&&(t.scrollParent[0].scrollLeft=r=t.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-v(document).scrollTop()<n.scrollSensitivity?r=v(document).scrollTop(v(document).scrollTop()-n.scrollSpeed):v(window).height()-(e.pageY-v(document).scrollTop())<n.scrollSensitivity&&(r=v(document).scrollTop(v(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-v(document).scrollLeft()<n.scrollSensitivity?r=v(document).scrollLeft(v(document).scrollLeft()-n.scrollSpeed):v(window).width()-(e.pageX-v(document).scrollLeft())<n.scrollSensitivity&&(r=v(document).scrollLeft(v(document).scrollLeft()+n.scrollSpeed)))),!1!==r&&v.ui.ddmanager&&!n.dropBehaviour&&v.ui.ddmanager.prepareOffsets(t,e)}}),v.ui.plugin.add("draggable","snap",{start:function(){var n=v(this).data("ui-draggable"),e=n.options;n.snapElements=[],v(e.snap.constructor!==String?e.snap.items||":data(ui-draggable)":e.snap).each(function(){var e=v(this),t=e.offset();this!==n.element[0]&&n.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:t.top,left:t.left})})},drag:function(e,t){for(var n,r,i,o,a,s,l,c,u,h=v(this).data("ui-draggable"),d=h.options,p=d.snapTolerance,f=t.offset.left,m=f+h.helperProportions.width,g=t.offset.top,b=g+h.helperProportions.height,y=h.snapElements.length-1;0<=y;y--)s=(a=h.snapElements[y].left)+h.snapElements[y].width,c=(l=h.snapElements[y].top)+h.snapElements[y].height,a-p<f&&f<s+p&&l-p<g&&g<c+p||a-p<f&&f<s+p&&l-p<b&&b<c+p||a-p<m&&m<s+p&&l-p<g&&g<c+p||a-p<m&&m<s+p&&l-p<b&&b<c+p?("inner"!==d.snapMode&&(n=Math.abs(l-b)<=p,r=Math.abs(c-g)<=p,i=Math.abs(a-m)<=p,o=Math.abs(s-f)<=p,n&&(t.position.top=h._convertPositionTo("relative",{top:l-h.helperProportions.height,left:0}).top-h.margins.top),r&&(t.position.top=h._convertPositionTo("relative",{top:c,left:0}).top-h.margins.top),i&&(t.position.left=h._convertPositionTo("relative",{top:0,left:a-h.helperProportions.width}).left-h.margins.left),o&&(t.position.left=h._convertPositionTo("relative",{top:0,left:s}).left-h.margins.left)),u=n||r||i||o,"outer"!==d.snapMode&&(n=Math.abs(l-g)<=p,r=Math.abs(c-b)<=p,i=Math.abs(a-f)<=p,o=Math.abs(s-m)<=p,n&&(t.position.top=h._convertPositionTo("relative",{top:l,left:0}).top-h.margins.top),r&&(t.position.top=h._convertPositionTo("relative",{top:c-h.helperProportions.height,left:0}).top-h.margins.top),i&&(t.position.left=h._convertPositionTo("relative",{top:0,left:a}).left-h.margins.left),o&&(t.position.left=h._convertPositionTo("relative",{top:0,left:s-h.helperProportions.width}).left-h.margins.left)),!h.snapElements[y].snapping&&(n||r||i||o||u)&&h.options.snap.snap&&h.options.snap.snap.call(h.element,e,v.extend(h._uiHash(),{snapItem:h.snapElements[y].item})),h.snapElements[y].snapping=n||r||i||o||u):(h.snapElements[y].snapping&&h.options.snap.release&&h.options.snap.release.call(h.element,e,v.extend(h._uiHash(),{snapItem:h.snapElements[y].item})),h.snapElements[y].snapping=!1)}}),v.ui.plugin.add("draggable","stack",{start:function(){var t,e=this.data("ui-draggable").options,e=v.makeArray(v(e.stack)).sort(function(e,t){return(parseInt(v(e).css("zIndex"),10)||0)-(parseInt(v(t).css("zIndex"),10)||0)});e.length&&(t=parseInt(v(e[0]).css("zIndex"),10)||0,v(e).each(function(e){v(this).css("zIndex",t+e)}),this.css("zIndex",t+e.length))}}),v.ui.plugin.add("draggable","zIndex",{start:function(e,t){var t=v(t.helper),n=v(this).data("ui-draggable").options;t.css("zIndex")&&(n._zIndex=t.css("zIndex")),t.css("zIndex",n.zIndex)},stop:function(e,t){var n=v(this).data("ui-draggable").options;n._zIndex&&v(t.helper).css("zIndex",n._zIndex)}}),(b=BI.jQuery).widget("ui.droppable",{version:"1.10.2",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e=this.options,t=e.accept;this.isover=!1,this.isout=!0,this.accept=b.isFunction(t)?t:function(e){return e.is(t)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},b.ui.ddmanager.droppables[e.scope]=b.ui.ddmanager.droppables[e.scope]||[],b.ui.ddmanager.droppables[e.scope].push(this),e.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var e=0,t=b.ui.ddmanager.droppables[this.options.scope];e<t.length;e++)t[e]===this&&t.splice(e,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,t){"accept"===e&&(this.accept=b.isFunction(t)?t:function(e){return e.is(t)}),b.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var t=b.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),t&&this._trigger("activate",e,this.ui(t))},_deactivate:function(e){var t=b.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),t&&this._trigger("deactivate",e,this.ui(t))},_over:function(e){var t=b.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(t)))},_out:function(e){var t=b.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(t)))},_drop:function(e,t){var n=t||b.ui.ddmanager.current,r=!1;return!(!n||(n.currentItem||n.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=b.data(this,"ui-droppable");if(e.options.greedy&&!e.options.disabled&&e.options.scope===n.options.scope&&e.accept.call(e.element[0],n.currentItem||n.element)&&b.ui.intersect(n,b.extend(e,{offset:e.element.offset()}),e.options.tolerance))return!(r=!0)}),!r&&(!!this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(n)),this.element)))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),b.ui.intersect=function(e,t,n){if(!t.offset)return!1;var r,i=(e.positionAbs||e.position.absolute).left,o=i+e.helperProportions.width,a=(e.positionAbs||e.position.absolute).top,s=a+e.helperProportions.height,l=t.offset.left,c=l+t.proportions.width,u=t.offset.top,h=u+t.proportions.height;switch(n){case"fit":return l<=i&&o<=c&&u<=a&&s<=h;case"intersect":return l<i+e.helperProportions.width/2&&o-e.helperProportions.width/2<c&&u<a+e.helperProportions.height/2&&s-e.helperProportions.height/2<h;case"pointer":return r=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,V((e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,u,t.proportions.height)&&V(r,l,t.proportions.width);case"touch":return(u<=a&&a<=h||u<=s&&s<=h||a<u&&h<s)&&(l<=i&&i<=c||l<=o&&o<=c||i<l&&c<o);default:return!1}},b.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,t){var n,r,i=b.ui.ddmanager.droppables[e.options.scope]||[],o=t?t.type:null,a=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();e:for(n=0;n<i.length;n++)if(!(i[n].options.disabled||e&&!i[n].accept.call(i[n].element[0],e.currentItem||e.element))){for(r=0;r<a.length;r++)if(a[r]===i[n].element[0]){i[n].proportions.height=0;continue e}i[n].visible="none"!==i[n].element.css("display"),i[n].visible&&("mousedown"===o&&i[n]._activate.call(i[n],t),i[n].offset=i[n].element.offset(),i[n].proportions={width:i[n].element[0].offsetWidth,height:i[n].element[0].offsetHeight})}},drop:function(e,t){var n=!1;return b.each((b.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&b.ui.intersect(e,this,this.options.tolerance)&&(n=this._drop.call(this,t)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,t)))}),n},dragStart:function(e,t){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||b.ui.ddmanager.prepareOffsets(e,t)})},drag:function(i,o){i.options.refreshPositions&&b.ui.ddmanager.prepareOffsets(i,o),b.each(b.ui.ddmanager.droppables[i.options.scope]||[],function(){var e,t,n,r;this.options.disabled||this.greedyChild||!this.visible||(r=!(r=b.ui.intersect(i,this,this.options.tolerance))&&this.isover?"isout":r&&!this.isover?"isover":null)&&(this.options.greedy&&(t=this.options.scope,(n=this.element.parents(":data(ui-droppable)").filter(function(){return b.data(this,"ui-droppable").options.scope===t})).length&&((e=b.data(n[0],"ui-droppable")).greedyChild="isover"===r)),e&&"isover"===r&&(e.isover=!1,e.isout=!0,e._out.call(e,o)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,o),e&&"isout"===r&&(e.isout=!1,e.isover=!0,e._over.call(e,o)))})},dragStop:function(e,t){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||b.ui.ddmanager.prepareOffsets(e,t)}};var k=BI.jQuery;function j(e,t){var n,r,i=e.nodeName.toLowerCase();return"area"===i?(n=(r=e.parentNode).name,!(!e.href||!n||"map"!==r.nodeName.toLowerCase())&&(!!(r=k("img[usemap='#"+n+"']")[0])&&W(r))):(/^(input|select|textarea|button|object)$/.test(i)?!e.disabled:"a"===i&&e.href||t)&&W(e)}function W(e){return k.expr.filters.visible(e)&&!k(e).parents().addBack().filter(function(){return"hidden"===k.css(this,"visibility")}).length}k.ui=k.ui||{},k.extend(k.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),k.fn.extend({scrollParent:function(e){var t=this.css("position"),n="absolute"===t,r=e?/(auto|scroll|hidden)/:/(auto|scroll)/,e=this.parents().filter(function(){var e=k(this);return(!n||"static"!==e.css("position"))&&r.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==t&&e.length?e:k(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&k(this).removeAttr("id")})}}),k.extend(k.expr[":"],{data:k.expr.createPseudo?k.expr.createPseudo(function(t){return function(e){return!!k.data(e,t)}}):function(e,t,n){return!!k.data(e,n[3])},focusable:function(e){return j(e,!isNaN(k.attr(e,"tabindex")))},tabbable:function(e){var t=k.attr(e,"tabindex"),n=isNaN(t);return(n||0<=t)&&j(e,!n)}}),k("<a>").outerWidth(1).jquery||k.each(["Width","Height"],function(e,n){var i="Width"===n?["Left","Right"]:["Top","Bottom"],r=n.toLowerCase(),o={innerWidth:k.fn.innerWidth,innerHeight:k.fn.innerHeight,outerWidth:k.fn.outerWidth,outerHeight:k.fn.outerHeight};function a(e,t,n,r){return k.each(i,function(){t-=parseFloat(k.css(e,"padding"+this))||0,n&&(t-=parseFloat(k.css(e,"border"+this+"Width"))||0),r&&(t-=parseFloat(k.css(e,"margin"+this))||0)}),t}k.fn["inner"+n]=function(e){return e===undefined?o["inner"+n].call(this):this.each(function(){k(this).css(r,a(this,e)+"px")})},k.fn["outer"+n]=function(e,t){return"number"!=typeof e?o["outer"+n].call(this,e):this.each(function(){k(this).css(r,a(this,e,!0,t)+"px")})}}),k.fn.addBack||(k.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),k("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(k.fn.removeData=function(t){return function(e){return arguments.length?t.call(this,k.camelCase(e)):t.call(this)}}(k.fn.removeData)),k.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),k.fn.extend({focus:function(e){return function(t,n){return"number"==typeof t?this.each(function(){var e=this;setTimeout(function(){k(e).focus(),n&&n.call(e)},t)}):e.apply(this,arguments)}}(k.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(e){if(e!==undefined)return this.css("zIndex",e);if(this.length)for(var t,n=k(this[0]);n.length&&n[0]!==document;){if(("absolute"===(t=n.css("position"))||"relative"===t||"fixed"===t)&&(t=parseInt(n.css("zIndex"),10),!isNaN(t)&&0!==t))return t;n=n.parent()}return 0}}),k.ui.plugin={add:function(e,t,n){var r,i=k.ui[e].prototype;for(r in n)i.plugins[r]=i.plugins[r]||[],i.plugins[r].push([t,n[r]])},call:function(e,t,n,r){var i,o=e.plugins[t];if(o&&(r||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(i=0;i<o.length;i++)e.options[o[i][0]]&&o[i][1].apply(e.element,n)}};var G=0,U=Array.prototype.slice,P=(k.cleanData=function(o){return function(e){for(var t,n,r=0;null!=(n=e[r]);r++)try{(t=k._data(n,"events"))&&t.remove&&k(n).triggerHandler("remove")}catch(i){}o(e)}}(k.cleanData),k.widget=function(e,n,t){var r,i,o,a,s={},l=e.split(".")[0];return e=e.split(".")[1],r=l+"-"+e,t||(t=n,n=k.Widget),k.expr[":"][r.toLowerCase()]=function(e){return!!k.data(e,r)},k[l]=k[l]||{},i=k[l][e],o=k[l][e]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},k.extend(o,i,{version:t.version,_proto:k.extend({},t),_childConstructors:[]}),(a=new n).options=k.widget.extend({},a.options),k.each(t,function(t,r){var i,o;k.isFunction(r)?s[t]=(i=function(){return n.prototype[t].apply(this,arguments)},o=function(e){return n.prototype[t].apply(this,e)},function(){var e,t=this._super,n=this._superApply;return this._super=i,this._superApply=o,e=r.apply(this,arguments),this._super=t,this._superApply=n,e}):s[t]=r}),o.prototype=k.widget.extend(a,{widgetEventPrefix:i&&a.widgetEventPrefix||e},s,{constructor:o,namespace:l,widgetName:e,widgetFullName:r}),i?(k.each(i._childConstructors,function(e,t){var n=t.prototype;k.widget(n.namespace+"."+n.widgetName,o,t._proto)}),delete i._childConstructors):n._childConstructors.push(o),k.widget.bridge(e,o),o},k.widget.extend=function(e){for(var t,n,r=U.call(arguments,1),i=0,o=r.length;i<o;i++)for(t in r[i])n=r[i][t],r[i].hasOwnProperty(t)&&n!==undefined&&(k.isPlainObject(n)?e[t]=k.isPlainObject(e[t])?k.widget.extend({},e[t],n):k.widget.extend({},n):e[t]=n);return e},k.widget.bridge=function(o,t){var a=t.prototype.widgetFullName||o;k.fn[o]=function(n){var e="string"==typeof n,r=U.call(arguments,1),i=this;return e?this.each(function(){var e,t=k.data(this,a);return"instance"===n?(i=t,!1):t?k.isFunction(t[n])&&"_"!==n.charAt(0)?(e=t[n].apply(t,r))!==t&&e!==undefined?(i=e&&e.jquery?i.pushStack(e.get()):e,!1):void 0:k.error("no such method '"+n+"' for "+o+" widget instance"):k.error("cannot call methods on "+o+" prior to initialization; attempted to call method '"+n+"'")}):(r.length&&(n=k.widget.extend.apply(null,[n].concat(r))),this.each(function(){var e=k.data(this,a);e?(e.option(n||{}),e._init&&e._init()):k.data(this,a,new t(n,this))})),i}},k.Widget=function(){},k.Widget._childConstructors=[],k.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,t){t=k(t||this.defaultElement||this)[0],this.element=k(t),this.uuid=G++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=k(),this.hoverable=k(),this.focusable=k(),t!==this&&(k.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=k(t.style?t.ownerDocument:t.document||t),this.window=k(this.document[0].defaultView||this.document[0].parentWindow)),this.options=k.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:k.noop,_getCreateEventData:k.noop,_create:k.noop,_init:k.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(k.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:k.noop,widget:function(){return this.element},option:function(e,t){var n,r,i,o=e;if(0===arguments.length)return k.widget.extend({},this.options);if("string"==typeof e)if(o={},e=(n=e.split(".")).shift(),n.length){for(r=o[e]=k.widget.extend({},this.options[e]),i=0;i<n.length-1;i++)r[n[i]]=r[n[i]]||{},r=r[n[i]];if(e=n.pop(),1===arguments.length)return r[e]===undefined?null:r[e];r[e]=t}else{if(1===arguments.length)return this.options[e]===undefined?null:this.options[e];o[e]=t}return this._setOptions(o),this},_setOptions:function(e){for(var t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(i,o,e){var a,s=this;"boolean"!=typeof i&&(e=o,o=i,i=!1),e?(o=a=k(o),this.bindings=this.bindings.add(o)):(e=o,o=this.element,a=this.widget()),k.each(e,function(e,t){function n(){if(i||!0!==s.options.disabled&&!k(this).hasClass("ui-state-disabled"))return("string"==typeof t?s[t]:t).apply(s,arguments)}"string"!=typeof t&&(n.guid=t.guid=t.guid||n.guid||k.guid++);var e=e.match(/^([\w:-]*)\s*(.*)$/),r=e[1]+s.eventNamespace,e=e[2];e?a.delegate(e,r,n):o.bind(r,n)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t),this.bindings=k(this.bindings.not(e).get()),this.focusable=k(this.focusable.not(e).get()),this.hoverable=k(this.hoverable.not(e).get())},_delay:function(e,t){var n=this;return setTimeout(function(){return("string"==typeof e?n[e]:e).apply(n,arguments)},t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){k(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){k(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){k(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){k(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,t,n){var r,i,o=this.options[e];if(n=n||{},(t=k.Event(t)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],i=t.originalEvent)for(r in i)r in t||(t[r]=i[r]);return this.element.trigger(t,n),!(k.isFunction(o)&&!1===o.apply(this.element[0],[t].concat(n))||t.isDefaultPrevented())}},k.each({show:"fadeIn",hide:"fadeOut"},function(o,a){k.Widget.prototype["_"+o]=function(t,e,n){var r=(e="string"==typeof e?{effect:e}:e)?!0!==e&&"number"!=typeof e&&e.effect||a:o,i=!k.isEmptyObject(e="number"==typeof(e=e||{})?{duration:e}:e);e.complete=n,e.delay&&t.delay(e.delay),i&&k.effects&&k.effects.effect[r]?t[o](e):r!==o&&t[r]?t[r](e.duration,e.easing,n):t.queue(function(e){k(this)[o](),n&&n.call(t[0]),e()})}}),k.widget,!1);k(document).mouseup(function(){P=!1}),k.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(e){if(!0===k.data(e.target,t.widgetName+".preventClickEvent"))return k.removeData(e.target,t.widgetName+".preventClickEvent"),e.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){var t,n,r;if(!P)return this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),n=1===(this._mouseDownEvent=e).which,r=!("string"!=typeof(t=this).options.cancel||!e.target.nodeName)&&k(e.target).closest(this.options.cancel).length,n&&!r&&this._mouseCapture(e)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){t.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(e),!this._mouseStarted)?e.preventDefault():(!0===k.data(e.target,this.widgetName+".preventClickEvent")&&k.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return t._mouseMove(e)},this._mouseUpDelegate=function(e){return t._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),P=!0)),!0},_mouseMove:function(e){if(this._mouseMoved){if(k.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button)return this._mouseUp(e);if(!e.which)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&k.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),P=!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),k.widget("ui.sortable",k.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,n){return t<=e&&e<t+n},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),k.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;0<=e;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,t){var n=null,r=!1,i=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),k(e.target).parents().each(function(){if(k.data(this,i.widgetName+"-item")===i)return n=k(this),!1}),!!(n=k.data(e.target,i.widgetName+"-item")===i?k(e.target):n)&&(!(this.options.handle&&!t&&(k(this.options.handle,n).find("*").addBack().each(function(){this===e.target&&(r=!0)}),!r))&&(this.currentItem=n,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,t,n){var r,i,o=this.options;if((this.currentContainer=this).refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},k.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(i=this.document.find("body"),this.storedCursor=i.css("cursor"),i.css("cursor",o.cursor),this.storedStylesheet=k("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(i)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(r=this.containers.length-1;0<=r;r--)this.containers[r]._trigger("activate",e,this._uiHash(this));return k.ui.ddmanager&&(k.ui.ddmanager.current=this),k.ui.ddmanager&&!o.dropBehaviour&&k.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var t,n,r,i,o=this.options,a=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+o.scrollSpeed:e.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+o.scrollSpeed:e.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(e.pageY-this.document.scrollTop()<o.scrollSensitivity?a=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<o.scrollSensitivity&&(a=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),e.pageX-this.document.scrollLeft()<o.scrollSensitivity?a=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<o.scrollSensitivity&&(a=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),!1!==a&&k.ui.ddmanager&&!o.dropBehaviour&&k.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t=this.items.length-1;0<=t;t--)if(r=(n=this.items[t]).item[0],(i=this._intersectsWithPointer(n))&&n.instance===this.currentContainer&&!(r===this.currentItem[0]||this.placeholder[1===i?"next":"prev"]()[0]===r||k.contains(this.placeholder[0],r)||"semi-dynamic"===this.options.type&&k.contains(this.element[0],r))){if(this.direction=1===i?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(e,n),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),k.ui.ddmanager&&k.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,t){var n,r,i,o;if(e)return k.ui.ddmanager&&!this.options.dropBehaviour&&k.ui.ddmanager.drop(this,e),this.options.revert?(r=(n=this).placeholder.offset(),o={},(i=this.options.axis)&&"x"!==i||(o.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),i&&"y"!==i||(o.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,k(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){n._clear(e)})):this._clear(e,t),!1},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;0<=e;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),k.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?k(this.domPosition.prev).after(this.currentItem):k(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var e=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},k(e).each(function(){var e=(k(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);e&&n.push((t.key||e[1]+"[]")+"="+(t.key&&t.expression?e[1]:e[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(e){var t=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},t.each(function(){n.push(k(e.item||this).attr(e.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,o=e.left,a=o+e.width,s=e.top,l=s+e.height,c=this.offset.click.top,u=this.offset.click.left,c="x"===this.options.axis||s<r+c&&r+c<l,u="y"===this.options.axis||o<t+u&&t+u<a;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c&&u:o<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<a&&s<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),e="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),t=t&&e,e=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return!!t&&(this.floating?n&&"right"===n||"down"===e?2:1:e&&("down"===e?2:1))},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),e=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),n=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"===r&&e||"left"===r&&!e:n&&("down"===n&&t||"up"===n&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(0<e?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(0<e?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(e){var t,n,r,i,o=[],a=[],s=this._connectWith();if(s&&e)for(t=s.length-1;0<=t;t--)for(n=(r=k(s[t],this.document[0])).length-1;0<=n;n--)(i=k.data(r[n],this.widgetFullName))&&i!==this&&!i.options.disabled&&a.push([k.isFunction(i.options.items)?i.options.items.call(i.element):k(i.options.items,i.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),i]);function l(){o.push(this)}for(a.push([k.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):k(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),t=a.length-1;0<=t;t--)a[t][0].each(l);return k(o)},_removeCurrentsFromItems:function(){var n=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=k.grep(this.items,function(e){for(var t=0;t<n.length;t++)if(n[t]===e.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var t,n,r,i,o,a,s,l,c=this.items,u=[[k.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):k(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(t=h.length-1;0<=t;t--)for(n=(r=k(h[t],this.document[0])).length-1;0<=n;n--)(i=k.data(r[n],this.widgetFullName))&&i!==this&&!i.options.disabled&&(u.push([k.isFunction(i.options.items)?i.options.items.call(i.element[0],e,{item:this.currentItem}):k(i.options.items,i.element),i]),this.containers.push(i));for(t=u.length-1;0<=t;t--)for(o=u[t][1],l=(a=u[t][n=0]).length;n<l;n++)(s=k(a[n])).data(this.widgetName+"-item",o),c.push({item:s,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(e){var t,n,r,i;for(this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),t=this.items.length-1;0<=t;t--)(n=this.items[t]).instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(r=this.options.toleranceElement?k(this.options.toleranceElement,n.item):n.item,e||(n.width=r.outerWidth(),n.height=r.outerHeight()),i=r.offset(),n.left=i.left,n.top=i.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(t=this.containers.length-1;0<=t;t--)i=this.containers[t].element.offset(),this.containers[t].containerCache.left=i.left,this.containers[t].containerCache.top=i.top,this.containers[t].containerCache.width=this.containers[t].element.outerWidth(),this.containers[t].containerCache.height=this.containers[t].element.outerHeight();return this},_createPlaceholder:function(n){var r,i=(n=n||this).options;i.placeholder&&i.placeholder.constructor!==String||(r=i.placeholder,i.placeholder={element:function(){var e=n.currentItem[0].nodeName.toLowerCase(),t=k("<"+e+">",n.document[0]).addClass(r||n.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===e?n._createTrPlaceholder(n.currentItem.find("tr").eq(0),k("<tr>",n.document[0]).appendTo(t)):"tr"===e?n._createTrPlaceholder(n.currentItem,t):"img"===e&&t.attr("src",n.currentItem.attr("src")),r||t.css("visibility","hidden"),t},update:function(e,t){r&&!i.forcePlaceholderSize||(t.height()||t.height(n.currentItem.innerHeight()-parseInt(n.currentItem.css("paddingTop")||0,10)-parseInt(n.currentItem.css("paddingBottom")||0,10)),t.width()||t.width(n.currentItem.innerWidth()-parseInt(n.currentItem.css("paddingLeft")||0,10)-parseInt(n.currentItem.css("paddingRight")||0,10)))}}),n.placeholder=k(i.placeholder.element.call(n.element,n.currentItem)),n.currentItem.after(n.placeholder),i.placeholder.update(n,n.placeholder)},_createTrPlaceholder:function(e,t){var n=this;e.children().each(function(){k("<td>&#160;</td>",n.document[0]).attr("colspan",k(this).attr("colspan")||1).appendTo(t)})},_contactContainers:function(e){for(var t,n,r,i,o,a,s,l,c,u=null,h=null,d=this.containers.length-1;0<=d;d--)k.contains(this.currentItem[0],this.containers[d].element[0])||(this._intersectsWith(this.containers[d].containerCache)?u&&k.contains(this.containers[d].element[0],u.element[0])||(u=this.containers[d],h=d):this.containers[d].containerCache.over&&(this.containers[d]._trigger("out",e,this._uiHash(this)),this.containers[d].containerCache.over=0));if(u)if(1===this.containers.length)this.containers[h].containerCache.over||(this.containers[h]._trigger("over",e,this._uiHash(this)),this.containers[h].containerCache.over=1);else{for(n=1e4,r=null,i=(l=u.floating||this._isFloating(this.currentItem))?"left":"top",o=l?"width":"height",c=l?"clientX":"clientY",t=this.items.length-1;0<=t;t--)k.contains(this.containers[h].element[0],this.items[t].item[0])&&this.items[t].item[0]!==this.currentItem[0]&&(a=this.items[t].item.offset()[i],s=!1,e[c]-a>this.items[t][o]/2&&(s=!0),Math.abs(e[c]-a)<n&&(n=Math.abs(e[c]-a),r=this.items[t],this.direction=s?"up":"down"));(r||this.options.dropOnEmpty)&&(this.currentContainer===this.containers[h]?this.currentContainer.containerCache.over||(this.containers[h]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1):(r?this._rearrange(e,r,null,!0):this._rearrange(e,null,this.containers[h].element,!0),this._trigger("change",e,this._uiHash()),this.containers[h]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[h],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[h]._trigger("over",e,this._uiHash(this)),this.containers[h].containerCache.over=1))}},_createHelper:function(e){var t=this.options,e=k.isFunction(t.helper)?k(t.helper.apply(this.element[0],[e,this.currentItem])):"clone"===t.helper?this.currentItem.clone():this.currentItem;return e.parents("body").length||k("parent"!==t.appendTo?t.appendTo:this.currentItem[0].parentNode)[0].appendChild(e[0]),e[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),e[0].style.width&&!t.forceHelperSize||e.width(this.currentItem.width()),e[0].style.height&&!t.forceHelperSize||e.height(this.currentItem.height()),e},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),"left"in(e=k.isArray(e)?{left:+e[0],top:+e[1]||0}:e)&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&k.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),{top:(e=this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&k.ui.ie?{top:0,left:0}:e).top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){var e;return"relative"===this.cssPosition?{top:(e=this.currentItem.position()).top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}:{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,t,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),"document"!==n.containment&&"window"!==n.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=k(n.containment)[0],n=k(n.containment).offset(),t="hidden"!==k(e).css("overflow"),this.containment=[n.left+(parseInt(k(e).css("borderLeftWidth"),10)||0)+(parseInt(k(e).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(k(e).css("borderTopWidth"),10)||0)+(parseInt(k(e).css("paddingTop"),10)||0)-this.margins.top,n.left+(t?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(k(e).css("borderLeftWidth"),10)||0)-(parseInt(k(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(t?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(k(e).css("borderTopWidth"),10)||0)-(parseInt(k(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,t){t=t||this.position;var e="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&k.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(n[0].tagName);return{top:t.top+this.offset.relative.top*e+this.offset.parent.top*e-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():r?0:n.scrollTop())*e,left:t.left+this.offset.relative.left*e+this.offset.parent.left*e-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():r?0:n.scrollLeft())*e}},_generatePosition:function(e){var t=this.options,n=e.pageX,r=e.pageY,i="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&k.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(i[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),t.grid&&(e=this.originalPageY+Math.round((r-this.originalPageY)/t.grid[1])*t.grid[1],r=!this.containment||e-this.offset.click.top>=this.containment[1]&&e-this.offset.click.top<=this.containment[3]?e:e-this.offset.click.top>=this.containment[1]?e-t.grid[1]:e+t.grid[1],e=this.originalPageX+Math.round((n-this.originalPageX)/t.grid[0])*t.grid[0],n=!this.containment||e-this.offset.click.left>=this.containment[0]&&e-this.offset.click.left<=this.containment[2]?e:e-this.offset.click.left>=this.containment[0]?e-t.grid[0]:e+t.grid[0])),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:i.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:i.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i===this.counter&&this.refreshPositions(!r)})},_clear:function(e,t){this.reverting=!1;var n,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)"auto"!==this._storedCSS[n]&&"static"!==this._storedCSS[n]||(this._storedCSS[n]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();function i(t,n,r){return function(e){r._trigger(t,e,n._uiHash(n))}}for(this.fromOutside&&!t&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||r.push(function(e){this._trigger("update",e,this._uiHash())}),this===this.currentContainer||t||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer))),n=this.containers.length-1;0<=n;n--)t||r.push(i("deactivate",this,this.containers[n])),this.containers[n].containerCache.over&&(r.push(i("out",this,this.containers[n])),this.containers[n].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(n=0;n<r.length;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===k.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(e){var t=e||this;return{helper:t.helper,placeholder:t.placeholder||k([]),position:t.position,originalPosition:t.originalPosition,offset:t.positionAbs,item:t.currentItem,sender:e?e.element:null}}})},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-block-arrow-up"},_store:function(){return BI.Models.getModel("bi.model.block.arrow.up")},watch:{isShow:function(e){this.arrowBtn.setSelected(e),this.arrowPane.setVisible(e)}},render:function(){var t=this;return{type:"bi.vertical",cls:"bi-card",scrolly:!1,items:[{type:"bi.vertical_adapt",items:[{type:"bi.icon_text_item",selected:this.model.isShow,cls:"arrow-btn trigger-triangle-font",height:30,logic:{dynamic:!0},text:"更多设置",handler:function(){t.store.toggleArea()},ref:function(e){t.arrowBtn=e}}]},{type:"bi.vertical",cls:"bi-background",vgap:15,hgap:10,invisible:!this.model.isShow,items:[{type:"bi.vertical_adapt",items:[{type:"bi.label",width:80,textAlign:"left",text:"姓名"},{type:"bi.text_editor",watermark:"这个不允许为空",allowBlank:!1,errorText:"非空!",width:300}]},{type:"bi.vertical_adapt",items:[{type:"bi.label",width:80,textAlign:"left",text:"密码"},{type:"bi.text_editor",watermark:"这个不允许为空",allowBlank:!1,errorText:"非空!",width:300}]}],ref:function(e){t.arrowPane=e}}]}}}),BI.shortcut("bi.block.arrow.up",r)},function(e,t,n){"use strict";var r;r=BI.inherit(Fix.Model,{state:function(){return{isShow:!0}},computed:{},actions:{toggleArea:function(){this.model.isShow=!this.model.isShow}}}),BI.model("bi.model.block.arrow.up",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:""},_store:function(){return BI.Models.getModel("bi.model.block.setting")},beforeInit:function(e){this.store.initPage(e)},render:function(){var t=this;return{type:"bi.vtape",items:[{type:"bi.left_right_vertical_adapt",cls:"bi-card bi-border-bottom",height:40,items:{left:[{type:"bi.icon_button",cls:"setting-font",width:16,lgap:20,rgap:10},{type:"bi.label",text:"全局设置"}],right:[{type:"bi.button_group",layouts:[{type:"bi.left",rgap:10}],items:[{type:"bi.button",text:"取消",level:"ignore",handler:function(){t.fireEvent("EVENT_CHANGE")}},{type:"bi.button",text:"保存",handler:function(){t._validation()&&t.store.save(t.getValue(),function(e){t.fireEvent("EVENT_CHANGE")})}}]}]}},{type:"bi.absolute",items:[{el:{type:"bi.vertical",cls:"bi-card",items:[{type:"bi.vertical_adapt",items:[{type:"bi.label",width:80,textAlign:"left",text:"姓名"},{type:"bi.text_editor",watermark:"这个不允许为空",allowBlank:!1,errorText:"非空!",width:300,value:this.model.config.name,ref:function(e){t.nameRow=e}}]}]},top:10,left:10,right:10,bottom:10}]}]}},getValue:function(){return{name:this.nameRow.getValue()}},_validation:function(){return!BI.isEmptyString(this.nameRow.getValue())}}),BI.shortcut("bi.block.setting",r)},function(e,t,n){"use strict";var r;r=BI.inherit(Fix.Model,{state:function(){return{config:{}}},computed:{},actions:{initPage:function(e){this.model.config={name:"张三"},e()},save:function(e,t){t()}}}),BI.model("bi.model.block.setting",r)},function(e,t,n){"use strict";BI.constant("bi.constant.block.tab_pane",[{value:"1",text:"用户管理",cardType:""},{value:"2",text:"上传文件",cardType:""}])},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{},_store:function(){return BI.Models.getModel("bi.model.block.tab_pane")},watch:{activeTab:function(e){this.tab.setSelect(e)}},render:function(){var t=this;return{type:"bi.vtape",items:[{type:"bi.vertical_adapt",cls:"bi-card bi-border-bottom",height:40,items:[{type:"bi.icon_button",cls:"setting-font",hgap:20,handler:function(){t._createSettingLayer()}},{type:"bi.button_group",layouts:[{type:"bi.vertical_adapt"}],items:BI.map(BI.Constants.getConstant("bi.constant.block.tab_pane"),function(e,t){return BI.extend({type:"bi.line_segment_button",height:40},t)}),value:this.model.activeTab,listeners:[{eventName:BI.ButtonGroup.EVENT_CHANGE,action:function(e){t.store.setActiveTab(e)}}]}]},{type:"bi.absolute",items:[{el:{type:"bi.tab",cls:"bi-card",showIndex:this.model.activeTab,single:!0,cardCreator:BI.bind(this._createCard,this),ref:function(e){t.tab=e}},top:10,left:10,bottom:0,right:10}]}],ref:function(e){t.mainPage=e}}},_createCard:function(n){var e=BI.Constants.getConstant("bi.constant.block.tab_pane"),e=BI.find(e,function(e,t){return t.value===n});return e&&BI.isKey(e.cardType)?{type:e.cardType}:{type:"bi.label",text:n}},_createSettingLayer:function(){var e=BI.UUID();BI.Layers.create(e,null,{container:this,render:{type:"bi.block.setting",listeners:[{eventName:"EVENT_CHANGE",action:function(){BI.Layers.remove(e)}}]}}),BI.Layers.show(e)}}),BI.shortcut("bi.block.tab_pane",r)},function(e,t,n){"use strict";var r;r=BI.inherit(Fix.Model,{state:function(){return{activeTab:"1"}},computed:{},actions:{setActiveTab:function(e){this.model.activeTab=e}}}),BI.model("bi.model.block.tab_pane",r)},function(e,t,n){"use strict";BI.ExpandableSearchEditor=BI.inherit(BI.Widget,{props:{baseCls:"bi-expandable-search-editor",height:24,width:300,errorText:"",watermark:BI.i18nText("BI-Basic_Search"),validationChecker:BI.emptyFn,quitChecker:BI.emptyFn,direction:"right"},render:function(){var t=this,e=this.options;return this.isExpand=!1,{type:"bi.vertical_adapt",items:[{type:"left"===e.direction?"bi.right":"bi.left",width:e.width,items:[{type:"bi.expandable_search_input",cls:"expandable-editor-animation",direction:e.direction,height:e.height,width:24,endWidth:e.width,watermark:e.watermark,errorText:e.errorText,validationChecker:e.validationChecker,quitChecker:e.quitChecker,ref:function(e){t.expandableSearchInput=e},listeners:[{eventName:"EVENT_EXPAND",action:function(){t.isExpand?t.expandableSearchInput.element.css("width","24px"):(t.expandableSearchInput.element.css("width",e.width+"px"),t.expandableSearchInput.focus()),t.isExpand=!t.isExpand}}]}]}]}},getValue:function(){return this.expandableSearchInput.getValue()},getKeywords:function(){return this.expandableSearchInput.getKeywords()},getLastValidValue:function(){return this.expandableSearchInput.getLastValidValue()},setValue:function(e){this.expandableSearchInput.setValue(e)},isEditing:function(){return this.expandableSearchInput.isEditing()}}),BI.shortcut("bi.expandable_search_editor",BI.ExpandableSearchEditor)},function(e,t,n){"use strict";var i;(i=BI.inherit(BI.Widget,{props:{baseCls:"bi-search-editor bi-focus-shadow",height:24,errorText:"",watermark:BI.i18nText("BI-Basic_Search"),validationChecker:BI.emptyFn,quitChecker:BI.emptyFn,direction:"right"},render:function(){this.options.height-=2;var t=this,e=this.options,n=(this.editor=BI.createWidget({type:"bi.editor",cls:"bi-border-bottom",height:e.height,watermark:e.watermark,allowBlank:!0,hgap:1,errorText:e.errorText,validationChecker:e.validationChecker,quitChecker:e.quitChecker}),this.icon=BI.createWidget({type:"bi.icon_button",cls:"search-font"}),[{el:t.icon,width:24},{el:t.editor}]),r=[{el:t.editor},{el:t.icon,width:24}];return this.icon.on(BI.IconButton.EVENT_CHANGE,function(){t.fireEvent(i.EVENT_EXPAND,arguments)}),this.editor.on(BI.Controller.EVENT_CHANGE,function(){t.fireEvent(BI.Controller.EVENT_CHANGE,arguments)}),this.editor.on(BI.Editor.EVENT_FOCUS,function(){t.fireEvent(i.EVENT_FOCUS)}),this.editor.on(BI.Editor.EVENT_BLUR,function(){t.fireEvent(i.EVENT_BLUR)}),this.editor.on(BI.Editor.EVENT_CLICK,function(){t.fireEvent(i.EVENT_CLICK)}),this.editor.on(BI.Editor.EVENT_CHANGE,function(){t.fireEvent(i.EVENT_CHANGE)}),this.editor.on(BI.Editor.EVENT_KEY_DOWN,function(e){t.fireEvent(i.EVENT_KEY_DOWN,e)}),this.editor.on(BI.Editor.EVENT_SPACE,function(){t.fireEvent(i.EVENT_SPACE)}),this.editor.on(BI.Editor.EVENT_BACKSPACE,function(){t.fireEvent(i.EVENT_BACKSPACE)}),this.editor.on(BI.Editor.EVENT_VALID,function(){t.fireEvent(i.EVENT_VALID)}),this.editor.on(BI.Editor.EVENT_ERROR,function(){t.fireEvent(i.EVENT_ERROR)}),this.editor.on(BI.Editor.EVENT_ENTER,function(){t.fireEvent(i.EVENT_ENTER)}),this.editor.on(BI.Editor.EVENT_RESTRICT,function(){t.fireEvent(i.EVENT_RESTRICT)}),this.editor.on(BI.Editor.EVENT_EMPTY,function(){t.fireEvent(i.EVENT_EMPTY)}),this.editor.on(BI.Editor.EVENT_REMOVE,function(){t.fireEvent(i.EVENT_REMOVE)}),this.editor.on(BI.Editor.EVENT_CONFIRM,function(){t.fireEvent(i.EVENT_CONFIRM)}),this.editor.on(BI.Editor.EVENT_START,function(){t.fireEvent(i.EVENT_START)}),this.editor.on(BI.Editor.EVENT_PAUSE,function(){t.fireEvent(i.EVENT_PAUSE)}),this.editor.on(BI.Editor.EVENT_STOP,function(){t.fireEvent(i.EVENT_STOP)}),{type:"bi.htape",items:"left"===e.direction?r:n}},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},getValue:function(){var e;if(this.isValid())return e=this.editor.getValue().match(/[\S]+/g),BI.isNull(e)?"":e[e.length-1]},getKeywords:function(){var e=this.editor.getValue(),t=e.match(/[\S]+/g);return BI.isEndWithBlank(e)?t.concat([" "]):t},getLastValidValue:function(){return this.editor.getLastValidValue()},setValue:function(e){this.editor.setValue(e)},isEditing:function(){return this.editor.isEditing()},isValid:function(){return this.editor.isValid()}})).EVENT_EXPAND="EVENT_EXPAND",i.EVENT_CHANGE="EVENT_CHANGE",i.EVENT_FOCUS="EVENT_FOCUS",i.EVENT_BLUR="EVENT_BLUR",i.EVENT_CLICK="EVENT_CLICK",i.EVENT_KEY_DOWN="EVENT_KEY_DOWN",i.EVENT_SPACE="EVENT_SPACE",i.EVENT_BACKSPACE="EVENT_BACKSPACE",i.EVENT_START="EVENT_START",i.EVENT_PAUSE="EVENT_PAUSE",i.EVENT_STOP="EVENT_STOP",i.EVENT_CONFIRM="EVENT_CONFIRM",i.EVENT_VALID="EVENT_VALID",i.EVENT_ERROR="EVENT_ERROR",i.EVENT_ENTER="EVENT_ENTER",i.EVENT_RESTRICT="EVENT_RESTRICT",i.EVENT_REMOVE="EVENT_REMOVE",i.EVENT_EMPTY="EVENT_EMPTY",BI.shortcut("bi.expandable_search_input",i)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.NodeButton,{props:{baseCls:"bi-arrow-expander-node bi-list-item cursor-pointer",open:!1,height:24},render:function(){var t=this,e=this.options;return{type:"bi.vertical_adapt",items:[{el:{type:"bi.arrow.expander.node.checkbox",iconWidth:16,iconHeight:16,width:16,height:e.height,ref:function(e){t.checkbox=e},handler:function(e){e===BI.Events.CLICK&&t.setSelected(t.isSelected())}},lgap:15,rgap:5},{type:"bi.label",ref:function(e){t.text=e},textAlign:"left",whiteSpace:"nowrap",textHeight:e.height,height:e.height,hgap:e.hgap,text:e.text,value:e.value,py:e.py}]}},setOpened:function(e){r.superclass.setOpened.apply(this,arguments),this.checkbox.setSelected(e)}}),BI.shortcut("bi.arrow.expander.node",r)},function(e,t,n){"use strict";var i;i=[],BI.ExpandablePanel=BI.inherit(BI.Widget,{props:{baseCls:"bi-expandable-panel bi-background",width:300,borderGap:15,height:300},_store:function(){return BI.Models.getModel("bi.model.expandable.panel")},watch:{currentExpander:function(e){this._hideOtherExpander(e)}},render:function(){var e=this.options;return{type:"bi.vertical",width:e.width,height:e.height,items:this._createExpanders(e.items)}},_createExpanders:function(e){var n=[],r=this;return BI.each(e,function(t,e){i.push(t),n.push({type:"bi.expander",ref:function(e){r[t]=e},listeners:[{eventName:BI.Expander.EVENT_EXPAND,action:function(){r.store.changeExpander(t)}}],el:{type:"bi.arrow.expander.node",height:36,text:e.text,title:e.text},popup:e.popup}),n.push(r._getSplitLine())}),n},_getSplitLine:function(){return{type:"bi.layout",cls:"bi-border-bottom split-line",height:1,hgap:this.options.borderGap}},_hideOtherExpander:function(n){var r=this;BI.each(i,function(e,t){n!==t&&r[t].hideView()})}}),BI.shortcut("bi.expandable_panel",BI.ExpandablePanel)},function(e,t,n){"use strict";var r;r=BI.inherit(Fix.Model,{state:function(){return{currentExpander:null}},actions:{changeExpander:function(e){this.model.currentExpander=e}}}),BI.model("bi.model.expandable.panel",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.IconButton,{props:{extraCls:"bi-arrow-expander-node-checkbox expander-thin-right-font"},setSelected:function(e){r.superclass.setSelected.apply(this,arguments),e?this.element.removeClass("expander-thin-right-font").addClass("expander-thin-down-font"):this.element.removeClass("expander-thin-down-font").addClass("expander-thin-right-font")}}),BI.shortcut("bi.arrow.expander.node.checkbox",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-material-form-text-value-combo",errorText:"",height:24,width:200},render:function(){var e=this.options,t=this;return{type:"bi.absolute",items:[{el:{type:"bi.vertical",cls:"error-tip-wrapper",invisible:!0,items:[{type:"bi.label",cls:"error-text",text:e.errorText}],ref:function(e){t.error=e}},top:-18,left:0,height:18},{el:{type:"bi.text_value_combo",items:e.items,text:e.text,value:e.value,ref:function(){t.combo=this},listeners:[{eventName:"EVENT_CHANGE",action:function(){t.error.setVisible(!e.validationChecker(this.getValue()[0]))}}]},top:0,right:0,bottom:0,left:0}]}}}),BI.shortcut("bi.material.text_value_combo",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-material-form-editor",errorText:"",height:24,width:200},render:function(){var e=this.options,t=this;return{type:"bi.absolute",items:[{el:{type:"bi.vertical",cls:"error-tip-wrapper",invisible:!0,items:[{type:"bi.label",cls:"error-text",text:e.errorText}],ref:function(e){t.error=e}},top:-18,left:0,height:18},{el:{type:"bi.sign_editor",cls:"bi-border",height:e.height-2,watermark:e.watermark,ref:function(){t.editor=this},validationChecker:e.validationChecker,listeners:[{eventName:"EVENT_ERROR",action:function(){t.error.setVisible(!0)}},{eventName:"EVENT_VALID",action:function(){t.error.setVisible(!1)}}]},top:0,right:0,bottom:0,left:0}]}}}),BI.shortcut("bi.material.form_editor",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-material-form",items:[]},render:function(){var e=this.options,n=this;return this.refs=[],{type:"bi.vertical",vgap:20,items:BI.createItems(BI.map(e.items,function(e,t){return{items:[{type:"bi.label",text:t.tipText,textAlign:"left"},BI.extend(t.component,{ref:function(e){n.refs.push(e)}})]}}),{type:"bi.vertical_adapt",rgap:10})}},getValue:function(){return BI.map(this.refs,function(e,t){return t&&t.getValue()})}}),BI.shortcut("bi.material.form",r)},function(e,t,n){"use strict";var r;r=BI.inherit(BI.Widget,{props:{baseCls:"bi-material-single-select-group",errorText:"",height:24},render:function(){var e=this.options,t=this;return{type:"bi.button_group",items:BI.createItems(e.items,{type:"bi.single_select_radio_item",logic:{dynamic:!0}}),ref:function(){t.group=this},layouts:[{type:"bi.left"}]}},setValue:function(e){this.group.setValue(e)},getValue:function(){return this.group.getValue()}}),BI.shortcut("bi.material.single_select_group",r)},function(e,t,n){"use strict";BI.MaterialPreviewTable=BI.inherit(BI.Widget,{props:{baseCls:"bi-material-preview-table",isNeedFreeze:!0,showSequence:!1,showPartData:!1,freezeCols:[],columnSize:[],headerRowSize:30,rowSize:30,header:[],items:[]},mounted:function(){var n=this;this._resizeHandler=BI.debounce(function(){var e=n._getTableWidth(),t=n._getTableHeight();n.table.getWidth()===e&&n.table.getHeight()===t||(n.table.setWidth(e),n.table.setHeight(t),n.table.populate())},0),BI.Resizers.add(this.getName(),function(){n._resizeHandler()}),this._populate()},render:function(){var t=this,e=this.options;return{type:"bi.absolute",items:[{el:{type:"bi.page_table",rowSize:e.rowSize,headerRowSize:e.headerRowSize,ref:function(e){t.table=e},el:{type:"bi.sequence_table",el:{type:"bi.adaptive_table",el:{type:"bi.resizable_table",el:{type:"bi.grid_table"}}}}},top:0,right:0,bottom:0,left:0},{el:{type:"bi.label",disabled:!0,text:t.options.showPartData?BI.i18nText("BI-Conf_Current_Preview_Part_Data"):""},bottom:-17,right:10}]}},_getTableWidth:function(){return this.element.width()},_getTableHeight:function(){return this.element.height()},_populate:function(){this.populate(this.options.items,this.options.header)},_calculateColumnSize:function(){var e,r,n,i,o;return this.options.columnSize&&0<this.options.columnSize.length?this.options.columnSize:(t(this.options.header,e=[]),t(this.options.items,e,!0),r=BI.map(e,function(e,t){var n=2*Math.ceil(BI.average(BI.filter(t,function(e,t){return 0<=t}))),t=Math.ceil(BI.max(t));return n<60||t<60?60:n<t?n:t}),BI.each(this.options.header,function(e,t){BI.each(t,function(e,t){var n=!0===t.enableReName?25:0,n=(n+=!0===t.showRemove?25:0)+(BI.isNotNull(t.iconCls)?BI.isNumber(t.iconWidth)?t.iconWidth:25:0);r[e]+=n})}),n=this._getTableWidth()-10,i=r.reduce(function(e,t){return e+t},0),n<=i?r:(o=n-i,BI.map(r,function(e,t){return e===r.length-1?t+o:(o-=Math.ceil((n-i)/r.length),t+Math.ceil((n-i)/r.length))})));function t(e,r,i){BI.each(e,function(n,e){BI.each(e,function(e,t){r[e]=r[e]||[],r[e].push(12*(e=t.text,e=(e+="").replace(/[^\x00-\xff]/g,"xx"),Math.ceil(e.length/2))*1.2),i&&(t.cls=n%2!=0?"even-row ":"odd-row")})})}},populate:function(e,t){this.options.items=e,this.options.header=t,BI.each(t,function(e,t){BI.each(t,function(e,t){t.cls=(t.cls||"")+" header-row "})});var n=this._calculateColumnSize();this.table.attr("columnSize",n),this.table.setVerticalScroll(0),this.table.restore(),this.table.setWidth(this._getTableWidth()),this.table.setHeight(this._getTableHeight()),this.table.attr("regionColumnSize",[]),this.table.attr("minColumnSize",n),this.table.attr("isNeedFreeze",!0),this.table.attr("freezeCols",[]),this.table.attr("showSequence",!1),this.table.populate(e,t)},setHorizontalScroll:function(e){this.table.setRightHorizontalScroll(e)},destroyed:function(){BI.Resizers.remove(this.getName())}}),BI.shortcut("bi.material.preview_table",BI.MaterialPreviewTable)},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){}]);