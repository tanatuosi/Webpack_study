{"version":3,"file":"dom.js","sourceRoot":"","sources":["../../src/utils/dom.ts"],"names":[],"mappings":"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","sourcesContent":["import { Cell } from '../../types';\r\n\r\nexport function dpr(): number {\r\n    const screen = window.screen;\r\n    let pixelRatio = 1;\r\n\r\n    if (window.devicePixelRatio) {\r\n        pixelRatio = window.devicePixelRatio;\r\n    } else if (screen.systemXDPI && screen.logicalXDPI) {\r\n        pixelRatio = screen.systemXDPI / screen.logicalXDPI;\r\n    }\r\n\r\n    return pixelRatio > 1 ? Math.ceil(pixelRatio) : 1;\r\n}\r\n\r\nexport function px(o: number | string): string {\r\n    return `${~~`${o}`}px`;\r\n}\r\n\r\nexport function lineWidth(): number {\r\n    return 1;\r\n}\r\n\r\nconst heightCache: {\r\n    [key: string]: number;\r\n} = {};\r\n\r\nexport function determineFontHeight(fontStyle: string): number {\r\n    let result = heightCache[fontStyle];\r\n\r\n    if (!result) {\r\n        const canvas = document.createElement('canvas');\r\n        const ctx = canvas.getContext('2d', { alpha: false });\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n        ctx.textBaseline = 'top';\r\n        ctx.fillStyle = 'white';\r\n        ctx.font = fontStyle;\r\n        ctx.fillText('gM', 0, 0);\r\n        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;\r\n        let start = -1;\r\n        let end = -1;\r\n        for (let row = 0; row < canvas.height; row++) {\r\n            for (let column = 0; column < canvas.width; column++) {\r\n                const index = (row * canvas.width + column) * 4;\r\n                if (imageData[index] === 0) {\r\n                    if (column === canvas.width - 1 && start !== -1) {\r\n                        end = row;\r\n                        row = canvas.height;\r\n                        break;\r\n                    }\r\n                    continue;\r\n                } else {\r\n                    if (start === -1) {\r\n                        start = row;\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        result = end - start;\r\n        heightCache[fontStyle] = result;\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nexport function measureText(text: string, font: string): TextMetrics {\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d', { alpha: false });\r\n    ctx.font = font;\r\n\r\n    return ctx.measureText(text);\r\n}\r\n\r\nexport function setCtxFont(\r\n    ctx: CanvasRenderingContext2D,\r\n    style: { fontStyle?: string; fontWeight?: string | number; fontSize?: string; fontFamily?: string },\r\n): void {\r\n    const { fontStyle = '', fontWeight = '', fontSize = '', fontFamily = '' } = style;\r\n\r\n    ctx.font = `${fontStyle} ${fontWeight} ${fontSize} \"Helvetica Neue\"`; // 先设置一个默认字体，当fontFamily无效时使用此默认字体\r\n\r\n    ctx.font = `${fontStyle} ${fontWeight} ${fontSize} \"${fontFamily}\"`; // 设置字体样式大小和字体名称\r\n}\r\n\r\nexport function measureTextByStyle(\r\n    text: string,\r\n    style: { fontStyle?: string; fontWeight?: string | number; fontSize?: string; fontFamily?: string },\r\n): TextMetrics {\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d', { alpha: false });\r\n    setCtxFont(ctx, style);\r\n\r\n    return ctx.measureText(text);\r\n}\r\n\r\nconst fontCache = {};\r\n\r\nexport function baselineRatio(font): number {\r\n    if (fontCache[font]) {\r\n        return fontCache[font];\r\n    }\r\n\r\n    // Get the baseline in the context of whatever element is passed in.\r\n    const elem = document.createElement('div');\r\n    elem.style.font = font;\r\n    document.body.appendChild(elem);\r\n\r\n    // The container is a little defenseive.\r\n    const container = document.createElement('div');\r\n    container.style.display = 'block';\r\n    container.style.position = 'absolute';\r\n    container.style.bottom = '0';\r\n    container.style.right = '0';\r\n    container.style.width = '0px';\r\n    container.style.height = '0px';\r\n    container.style.margin = '0';\r\n    container.style.padding = '0';\r\n    container.style.visibility = 'hidden';\r\n    container.style.overflow = 'hidden';\r\n\r\n    // Intentionally unprotected style definition.\r\n    const small = document.createElement('span');\r\n    const large = document.createElement('span');\r\n\r\n    // Large numbers help improve accuracy.\r\n    small.style.fontSize = '0px';\r\n    large.style.fontSize = '2000px';\r\n\r\n    small.innerHTML = 'X';\r\n    large.innerHTML = 'X';\r\n\r\n    container.appendChild(small);\r\n    container.appendChild(large);\r\n\r\n    // Put the element in the DOM for a split second.\r\n    elem.appendChild(container);\r\n    const smalldims = small.getBoundingClientRect();\r\n    const largedims = large.getBoundingClientRect();\r\n    elem.removeChild(container);\r\n\r\n    // Calculate where the baseline was, percentage-wise.\r\n    const baselineposition = smalldims.top - largedims.top;\r\n    const height = largedims.height;\r\n    setTimeout((): void => {\r\n        document.body.removeChild(elem);\r\n    });\r\n    const result = 1 - baselineposition / height;\r\n    fontCache[font] = result;\r\n\r\n    return result;\r\n}\r\n\r\nfunction _parseMetrics(font) {\r\n    const container = document.createElement('div');\r\n    const img = document.createElement('img');\r\n    const span = document.createElement('span');\r\n\r\n    const body = document.body;\r\n    if (!body) {\r\n        throw new Error('');\r\n    }\r\n\r\n    container.style.visibility = 'hidden';\r\n    container.style.fontFamily = font.fontFamily;\r\n    container.style.fontSize = font.fontSize;\r\n    container.style.margin = '0';\r\n    container.style.padding = '0';\r\n    container.appendChild(document.createTextNode('Hidden Text'));\r\n\r\n    body.appendChild(container);\r\n\r\n    img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\r\n    img.width = 1;\r\n    img.height = Math.round(parseFloat(font.fontSize) / 10);\r\n\r\n    img.style.margin = '0';\r\n    img.style.padding = '0';\r\n    img.style.verticalAlign = 'baseline';\r\n\r\n    container.appendChild(span);\r\n    container.appendChild(img);\r\n    const baseline = Math.round(parseFloat(font.fontSize) / 3) + img.height + 1;\r\n\r\n    container.style.lineHeight = 'normal';\r\n    img.style.verticalAlign = 'super';\r\n\r\n    const middle = img.offsetTop - container.offsetTop + img.height + 1;\r\n    body.removeChild(container);\r\n\r\n    return { baseline, middle };\r\n}\r\n\r\nconst mCache = {};\r\nexport function getMetrics(font) {\r\n    const key = `${font.fontFamily} ${font.fontSize}`;\r\n    if (mCache[key] === undefined) {\r\n        mCache[key] = _parseMetrics(font);\r\n    }\r\n\r\n    return mCache[key];\r\n}\r\n\r\nexport function getBiasLines(x, y, width, height, backslash = false, nums) {\r\n    const result = [];\r\n    if (backslash === false) {\r\n        // 两条线的时候会奇怪点\r\n        if (nums === 1) {\r\n            result.push([\r\n                [x, y],\r\n                [x + width, y + height],\r\n            ]);\r\n        }\r\n        if (nums === 2) {\r\n            result.push([\r\n                [x, y],\r\n                [x + width, y + height * 2 / 3],\r\n            ]);\r\n            result.push([\r\n                [x, y],\r\n                [x + width * 2 / 3, y + height],\r\n            ]);\r\n        } else if (nums > 1) {\r\n            const criticalRadian = Math.atan(height / width);\r\n            const radian = Math.PI / 2 / (nums + 1);\r\n            let totalRadian = 0;\r\n            for (let i = 0; i < nums; i++) {\r\n                totalRadian += radian;\r\n                if (totalRadian < criticalRadian) {\r\n                    result.push([\r\n                        [x, y],\r\n                        [x + width, y + Math.ceil(Math.tan(totalRadian) * width)],\r\n                    ]);\r\n                } else {\r\n                    result.push([\r\n                        [x, y],\r\n                        [x + Math.ceil(height * Math.tan(Math.PI / 2 - totalRadian)), y + height],\r\n                    ]);\r\n                }\r\n            }\r\n        }\r\n    } else {\r\n        if (nums === 1) {\r\n            result.push([\r\n                [x, y + height],\r\n                [x + width, y],\r\n            ]);\r\n        }\r\n        if (nums === 2) {\r\n            result.push([\r\n                [x, y + height],\r\n                [x + width * 2 / 3, y],\r\n            ]);\r\n            result.push([\r\n                [x, y + height],\r\n                [x + width, y + height / 3],\r\n            ]);\r\n        } else if (nums > 1) {\r\n            const criticalRadian = Math.atan(width / height);\r\n            const radian = Math.PI / 2 / (nums + 1);\r\n            let totalRadian = 0;\r\n            for (let i = 0; i < nums; i++) {\r\n                totalRadian += radian;\r\n                if (totalRadian < criticalRadian) {\r\n                    result.push([\r\n                        [x, y + height],\r\n                        [x + Math.ceil(Math.tan(totalRadian) * height), y],\r\n                    ]);\r\n                } else {\r\n                    result.push([\r\n                        [x, y + height],\r\n                        [x + width, y + height - Math.ceil(Math.tan(Math.PI / 2 - totalRadian) * width)],\r\n                    ]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nexport function getSelection(): Selection {\r\n    if (window.getSelection) {\r\n        return window.getSelection();\r\n    } else if (document.getSelection) {\r\n        return document.getSelection();\r\n    }\r\n\r\n    return document.selection as Selection;\r\n}\r\n\r\nexport function copyAsHtml(_html: string) { }\r\n\r\nexport function transformCell2HTML(_cell: Cell): string {\r\n    return '';\r\n}\r\n"]}