{"version":3,"file":"contextmenu.js","sourceRoot":"","sources":["../../../src/component/memu/contextmenu.ts"],"names":[],"mappings":"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","sourcesContent":["import { Element, h } from '../element';\r\nimport { unbindClickoutside, bindClickoutside, emptyFn, blockContextMenu } from '../../utils';\r\nimport { MenuItem, OptionsType } from '../../../types';\r\n\r\n/**\r\n * 右键单元格的菜单\r\n */\r\nexport class ContextMenu {\r\n    public el: Element;\r\n\r\n    private clickHandler: Function;\r\n\r\n    private menuItems: MenuItem[];\r\n\r\n    public constructor(\r\n        menuItems: MenuItem[] = [\r\n            {\r\n                key: 'copy',\r\n                icon: '',\r\n                label: '复制',\r\n                accel: '',\r\n            },\r\n        ],\r\n    ) {\r\n        this.el = h('div', 'sheet-menu')\r\n            .css({\r\n                userSelect: 'none',\r\n            })\r\n            .hide();\r\n        this.clickHandler = emptyFn;\r\n        this.menuItems = menuItems;\r\n        this.buildItems();\r\n        blockContextMenu(this.el.el);\r\n        document.body.appendChild(this.el.el);\r\n    }\r\n\r\n    public show(x: number, y: number, options: OptionsType): void {\r\n        const { width, height } = this.el.show().offset();\r\n        this.configItems(options);\r\n        let top = y,\r\n            left = x;\r\n        if (window.innerHeight - y <= height) {\r\n            top -= height;\r\n        }\r\n        if (window.innerWidth - x <= width) {\r\n            left -= width;\r\n        }\r\n        this.el.offset({ left, top });\r\n        bindClickoutside(this.el);\r\n    }\r\n\r\n    public hide(): void {\r\n        this.el.hide();\r\n        unbindClickoutside(this.el);\r\n    }\r\n\r\n    public bindHandler(handler: Function): void {\r\n        this.clickHandler = handler;\r\n    }\r\n\r\n    public tear() {\r\n        document.body.removeChild(this.el.el);\r\n    }\r\n\r\n    private configItems(options: OptionsType) {\r\n        this.menuItems.forEach(item => {\r\n            options[item.key] ? this.el.childEnable(item.key) : this.el.disableChild(item.key);\r\n        });\r\n    }\r\n\r\n    private buildItems(): void {\r\n        this.menuItems.forEach(it => {\r\n            if (it.key === 'separator') {\r\n                this.el.children(h('div', 'sheet-menuseparator'));\r\n            }\r\n            this.el.children(\r\n                h('div', `sheet-menuitem ${it.key}`)\r\n                    .on('mousedown', e => {\r\n                        e.stopPropagation();\r\n                    })\r\n                    .on('click', () => {\r\n                        this.clickHandler(it.key);\r\n                        this.hide();\r\n                    })\r\n                    .children(\r\n                        h('div', 'sheet-menuitem-icon'),\r\n                        h('span', 'sheet-menuitem-label').text(it.label || ''),\r\n                        h('span', 'sheet-menuitem-accel').text(it.accel || ''),\r\n                    ),\r\n            );\r\n        });\r\n    }\r\n}\r\n"]}